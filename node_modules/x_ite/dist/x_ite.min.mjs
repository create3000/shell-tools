/* X_ITE v9.1.6 */var t={965:(e,t,i)=>{!function(e){function t(e){var t,n,r;return this.length?((t=this[0]).ownerDocument?r=t.ownerDocument:t=(r=t).documentElement,null==e?r.exitFullscreen||r.webkitExitFullscreen||r.webkitCancelFullScreen||r.msExitFullscreen||r.mozCancelFullScreen?(e=i(r))&&(r.fullscreenElement||r.webkitFullscreenElement||r.webkitCurrentFullScreenElement||r.msFullscreenElement||r.mozFullScreenElement)||e:null:e?((n=t.requestFullscreen||t.webkitRequestFullscreen||t.webkitRequestFullScreen||t.msRequestFullscreen||t.mozRequestFullScreen)&&n.call(t),this):((n=r.exitFullscreen||r.webkitExitFullscreen||r.webkitCancelFullScreen||r.msExitFullscreen||r.mozCancelFullScreen)&&i(r)&&n.call(r),this)):this}function i(e){return!!(e.fullscreenElement||e.msFullscreenElement||e.webkitIsFullScreen||e.mozFullScreen)}function n(t){e(document).trigger(new e.Event("fullscreenchange"))}function r(t){e(document).trigger(new e.Event("fullscreenerror"))}e.fn.fullScreen=t,e.fn.toggleFullScreen=function(){return t.call(this,!t.call(this))},function(){var t,i,s;(t=document).webkitCancelFullScreen?(i="webkitfullscreenchange",s="webkitfullscreenerror"):t.msExitFullscreen?(i="MSFullscreenChange",s="MSFullscreenError"):t.mozCancelFullScreen?(i="mozfullscreenchange",s="mozfullscreenerror"):(i="fullscreenchange",s="fullscreenerror"),e(document).bind(i,n),e(document).bind(s,r)}()}(i(328))},62:(e,t,i)=>{var n,r,s;r=[i(328)],void 0===(s="function"==typeof(n=function(e){var t,i,n=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],r="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],s=Array.prototype.slice;if(e.event.fixHooks)for(var o=n.length;o;)e.event.fixHooks[n[--o]]=e.event.mouseHooks;var a=e.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var t=r.length;t;)this.addEventListener(r[--t],l,!1);else this.onmousewheel=l;e.data(this,"mousewheel-line-height",a.getLineHeight(this)),e.data(this,"mousewheel-page-height",a.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var t=r.length;t;)this.removeEventListener(r[--t],l,!1);else this.onmousewheel=null;e.removeData(this,"mousewheel-line-height"),e.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var i=e(t),n=i["offsetParent"in e.fn?"offsetParent":"parent"]();return n.length||(n=e("body")),parseInt(n.css("fontSize"),10)||parseInt(i.css("fontSize"),10)||16},getPageHeight:function(t){return e(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};function l(n){var r=n||window.event,o=s.call(arguments,1),l=0,d=0,c=0,p=0,g=0,f=0;if((n=e.event.fix(r)).type="mousewheel","detail"in r&&(c=-1*r.detail),"wheelDelta"in r&&(c=r.wheelDelta),"wheelDeltaY"in r&&(c=r.wheelDeltaY),"wheelDeltaX"in r&&(d=-1*r.wheelDeltaX),"axis"in r&&r.axis===r.HORIZONTAL_AXIS&&(d=-1*c,c=0),l=0===c?d:c,"deltaY"in r&&(l=c=-1*r.deltaY),"deltaX"in r&&(d=r.deltaX,0===c&&(l=-1*d)),0!==c||0!==d){if(1===r.deltaMode){var m=e.data(this,"mousewheel-line-height");l*=m,c*=m,d*=m}else if(2===r.deltaMode){var _=e.data(this,"mousewheel-page-height");l*=_,c*=_,d*=_}if(p=Math.max(Math.abs(c),Math.abs(d)),(!i||p<i)&&(i=p,h(r,p)&&(i/=40)),h(r,p)&&(l/=40,d/=40,c/=40),l=Math[l>=1?"floor":"ceil"](l/i),d=Math[d>=1?"floor":"ceil"](d/i),c=Math[c>=1?"floor":"ceil"](c/i),a.settings.normalizeOffset&&this.getBoundingClientRect){var x=this.getBoundingClientRect();g=n.clientX-x.left,f=n.clientY-x.top}return n.deltaX=d,n.deltaY=c,n.deltaFactor=i,n.offsetX=g,n.offsetY=f,n.deltaMode=0,o.unshift(n,l,d,c),t&&clearTimeout(t),t=setTimeout(u,200),(e.event.dispatch||e.event.handle).apply(this,o)}}function u(){i=null}function h(e,t){return a.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120==0}e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})})?n.apply(t,r):n)||(e.exports=s)},328:function(e,t){var i,n,r;n="undefined"!=typeof window?window:this,r=function(n,r){var s=[],o=Object.getPrototypeOf,a=s.slice,l=s.flat?function(e){return s.flat.call(e)}:function(e){return s.concat.apply([],e)},u=s.push,h=s.indexOf,d={},c=d.toString,p=d.hasOwnProperty,g=p.toString,f=g.call(Object),m={},_=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item},x=function(e){return null!=e&&e===e.window},y=n.document,w={type:!0,src:!0,nonce:!0,noModule:!0};function b(e,t,i){var n,r,s=(i=i||y).createElement("script");if(s.text=e,t)for(n in w)(r=t[n]||t.getAttribute&&t.getAttribute(n))&&s.setAttribute(n,r);i.head.appendChild(s).parentNode.removeChild(s)}function S(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?d[c.call(e)]||"object":typeof e}var T="3.7.1",v=/HTML$/i,O=function(e,t){return new O.fn.init(e,t)};function E(e){var t=!!e&&"length"in e&&e.length,i=S(e);return!_(e)&&!x(e)&&("array"===i||0===t||"number"==typeof t&&t>0&&t-1 in e)}function C(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}O.fn=O.prototype={jquery:T,constructor:O,length:0,toArray:function(){return a.call(this)},get:function(e){return null==e?a.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=O.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return O.each(this,e)},map:function(e){return this.pushStack(O.map(this,(function(t,i){return e.call(t,i,t)})))},slice:function(){return this.pushStack(a.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(O.grep(this,(function(e,t){return(t+1)%2})))},odd:function(){return this.pushStack(O.grep(this,(function(e,t){return t%2})))},eq:function(e){var t=this.length,i=+e+(e<0?t:0);return this.pushStack(i>=0&&i<t?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:u,sort:s.sort,splice:s.splice},O.extend=O.fn.extend=function(){var e,t,i,n,r,s,o=arguments[0]||{},a=1,l=arguments.length,u=!1;for("boolean"==typeof o&&(u=o,o=arguments[a]||{},a++),"object"==typeof o||_(o)||(o={}),a===l&&(o=this,a--);a<l;a++)if(null!=(e=arguments[a]))for(t in e)n=e[t],"__proto__"!==t&&o!==n&&(u&&n&&(O.isPlainObject(n)||(r=Array.isArray(n)))?(i=o[t],s=r&&!Array.isArray(i)?[]:r||O.isPlainObject(i)?i:{},r=!1,o[t]=O.extend(u,s,n)):void 0!==n&&(o[t]=n));return o},O.extend({expando:"jQuery"+(T+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,i;return!(!e||"[object Object]"!==c.call(e)||(t=o(e))&&("function"!=typeof(i=p.call(t,"constructor")&&t.constructor)||g.call(i)!==f))},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,i){b(e,{nonce:t&&t.nonce},i)},each:function(e,t){var i,n=0;if(E(e))for(i=e.length;n<i&&!1!==t.call(e[n],n,e[n]);n++);else for(n in e)if(!1===t.call(e[n],n,e[n]))break;return e},text:function(e){var t,i="",n=0,r=e.nodeType;if(!r)for(;t=e[n++];)i+=O.text(t);return 1===r||11===r?e.textContent:9===r?e.documentElement.textContent:3===r||4===r?e.nodeValue:i},makeArray:function(e,t){var i=t||[];return null!=e&&(E(Object(e))?O.merge(i,"string"==typeof e?[e]:e):u.call(i,e)),i},inArray:function(e,t,i){return null==t?-1:h.call(t,e,i)},isXMLDoc:function(e){var t=e&&e.namespaceURI,i=e&&(e.ownerDocument||e).documentElement;return!v.test(t||i&&i.nodeName||"HTML")},merge:function(e,t){for(var i=+t.length,n=0,r=e.length;n<i;n++)e[r++]=t[n];return e.length=r,e},grep:function(e,t,i){for(var n=[],r=0,s=e.length,o=!i;r<s;r++)!t(e[r],r)!==o&&n.push(e[r]);return n},map:function(e,t,i){var n,r,s=0,o=[];if(E(e))for(n=e.length;s<n;s++)null!=(r=t(e[s],s,i))&&o.push(r);else for(s in e)null!=(r=t(e[s],s,i))&&o.push(r);return l(o)},guid:1,support:m}),"function"==typeof Symbol&&(O.fn[Symbol.iterator]=s[Symbol.iterator]),O.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(e,t){d["[object "+t+"]"]=t.toLowerCase()}));var N=s.pop,I=s.sort,F=s.splice,M="[\\x20\\t\\r\\n\\f]",D=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g");O.contains=function(e,t){var i=t&&t.parentNode;return e===i||!(!i||1!==i.nodeType||!(e.contains?e.contains(i):e.compareDocumentPosition&&16&e.compareDocumentPosition(i)))};var R=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function P(e,t){return t?"\0"===e?"ï¿½":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e}O.escapeSelector=function(e){return(e+"").replace(R,P)};var A=y,V=u;!function(){var e,t,i,r,o,l,u,d,c,g,f=V,_=O.expando,x=0,y=0,w=ee(),b=ee(),S=ee(),T=ee(),v=function(e,t){return e===t&&(o=!0),0},E="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",R="(?:\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",P="\\["+M+"*("+R+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+R+"))|)"+M+"*\\]",L=":("+R+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+P+")*)|.*)\\)|)",B=new RegExp(M+"+","g"),U=new RegExp("^"+M+"*,"+M+"*"),X=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),j=new RegExp(M+"|>"),k=new RegExp(L),z=new RegExp("^"+R+"$"),G={ID:new RegExp("^#("+R+")"),CLASS:new RegExp("^\\.("+R+")"),TAG:new RegExp("^("+R+"|[*])"),ATTR:new RegExp("^"+P),PSEUDO:new RegExp("^"+L),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+E+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},H=/^(?:input|select|textarea|button)$/i,q=/^h\d$/i,Y=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,W=/[+~]/,$=new RegExp("\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\([^\\r\\n\\f])","g"),J=function(e,t){var i="0x"+e.slice(1)-65536;return t||(i<0?String.fromCharCode(i+65536):String.fromCharCode(i>>10|55296,1023&i|56320))},K=function(){le()},Z=ce((function(e){return!0===e.disabled&&C(e,"fieldset")}),{dir:"parentNode",next:"legend"});try{f.apply(s=a.call(A.childNodes),A.childNodes),s[A.childNodes.length].nodeType}catch(e){f={apply:function(e,t){V.apply(e,a.call(t))},call:function(e){V.apply(e,a.call(arguments,1))}}}function Q(e,t,i,n){var r,s,o,a,u,h,p,g=t&&t.ownerDocument,x=t?t.nodeType:9;if(i=i||[],"string"!=typeof e||!e||1!==x&&9!==x&&11!==x)return i;if(!n&&(le(t),t=t||l,d)){if(11!==x&&(u=Y.exec(e)))if(r=u[1]){if(9===x){if(!(o=t.getElementById(r)))return i;if(o.id===r)return f.call(i,o),i}else if(g&&(o=g.getElementById(r))&&Q.contains(t,o)&&o.id===r)return f.call(i,o),i}else{if(u[2])return f.apply(i,t.getElementsByTagName(e)),i;if((r=u[3])&&t.getElementsByClassName)return f.apply(i,t.getElementsByClassName(r)),i}if(!(T[e+" "]||c&&c.test(e))){if(p=e,g=t,1===x&&(j.test(e)||X.test(e))){for((g=W.test(e)&&ae(t.parentNode)||t)==t&&m.scope||((a=t.getAttribute("id"))?a=O.escapeSelector(a):t.setAttribute("id",a=_)),s=(h=he(e)).length;s--;)h[s]=(a?"#"+a:":scope")+" "+de(h[s]);p=h.join(",")}try{return f.apply(i,g.querySelectorAll(p)),i}catch(t){T(e,!0)}finally{a===_&&t.removeAttribute("id")}}}return xe(e.replace(D,"$1"),t,i,n)}function ee(){var e=[];return function i(n,r){return e.push(n+" ")>t.cacheLength&&delete i[e.shift()],i[n+" "]=r}}function te(e){return e[_]=!0,e}function ie(e){var t=l.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ne(e){return function(t){return C(t,"input")&&t.type===e}}function re(e){return function(t){return(C(t,"input")||C(t,"button"))&&t.type===e}}function se(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&Z(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function oe(e){return te((function(t){return t=+t,te((function(i,n){for(var r,s=e([],i.length,t),o=s.length;o--;)i[r=s[o]]&&(i[r]=!(n[r]=i[r]))}))}))}function ae(e){return e&&void 0!==e.getElementsByTagName&&e}function le(e){var i,n=e?e.ownerDocument||e:A;return n!=l&&9===n.nodeType&&n.documentElement?(u=(l=n).documentElement,d=!O.isXMLDoc(l),g=u.matches||u.webkitMatchesSelector||u.msMatchesSelector,u.msMatchesSelector&&A!=l&&(i=l.defaultView)&&i.top!==i&&i.addEventListener("unload",K),m.getById=ie((function(e){return u.appendChild(e).id=O.expando,!l.getElementsByName||!l.getElementsByName(O.expando).length})),m.disconnectedMatch=ie((function(e){return g.call(e,"*")})),m.scope=ie((function(){return l.querySelectorAll(":scope")})),m.cssHas=ie((function(){try{return l.querySelector(":has(*,:jqfake)"),!1}catch(e){return!0}})),m.getById?(t.filter.ID=function(e){var t=e.replace($,J);return function(e){return e.getAttribute("id")===t}},t.find.ID=function(e,t){if(void 0!==t.getElementById&&d){var i=t.getElementById(e);return i?[i]:[]}}):(t.filter.ID=function(e){var t=e.replace($,J);return function(e){var i=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return i&&i.value===t}},t.find.ID=function(e,t){if(void 0!==t.getElementById&&d){var i,n,r,s=t.getElementById(e);if(s){if((i=s.getAttributeNode("id"))&&i.value===e)return[s];for(r=t.getElementsByName(e),n=0;s=r[n++];)if((i=s.getAttributeNode("id"))&&i.value===e)return[s]}return[]}}),t.find.TAG=function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):t.querySelectorAll(e)},t.find.CLASS=function(e,t){if(void 0!==t.getElementsByClassName&&d)return t.getElementsByClassName(e)},c=[],ie((function(e){var t;u.appendChild(e).innerHTML="<a id='"+_+"' href='' disabled='disabled'></a><select id='"+_+"-\r\\' disabled='disabled'><option selected=''></option></select>",e.querySelectorAll("[selected]").length||c.push("\\["+M+"*(?:value|"+E+")"),e.querySelectorAll("[id~="+_+"-]").length||c.push("~="),e.querySelectorAll("a#"+_+"+*").length||c.push(".#.+[+~]"),e.querySelectorAll(":checked").length||c.push(":checked"),(t=l.createElement("input")).setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),u.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&c.push(":enabled",":disabled"),(t=l.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||c.push("\\["+M+"*name"+M+"*="+M+"*(?:''|\"\")")})),m.cssHas||c.push(":has"),c=c.length&&new RegExp(c.join("|")),v=function(e,t){if(e===t)return o=!0,0;var i=!e.compareDocumentPosition-!t.compareDocumentPosition;return i||(1&(i=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!m.sortDetached&&t.compareDocumentPosition(e)===i?e===l||e.ownerDocument==A&&Q.contains(A,e)?-1:t===l||t.ownerDocument==A&&Q.contains(A,t)?1:r?h.call(r,e)-h.call(r,t):0:4&i?-1:1)},l):l}for(e in Q.matches=function(e,t){return Q(e,null,null,t)},Q.matchesSelector=function(e,t){if(le(e),d&&!T[t+" "]&&(!c||!c.test(t)))try{var i=g.call(e,t);if(i||m.disconnectedMatch||e.document&&11!==e.document.nodeType)return i}catch(e){T(t,!0)}return Q(t,l,null,[e]).length>0},Q.contains=function(e,t){return(e.ownerDocument||e)!=l&&le(e),O.contains(e,t)},Q.attr=function(e,i){(e.ownerDocument||e)!=l&&le(e);var n=t.attrHandle[i.toLowerCase()],r=n&&p.call(t.attrHandle,i.toLowerCase())?n(e,i,!d):void 0;return void 0!==r?r:e.getAttribute(i)},Q.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},O.uniqueSort=function(e){var t,i=[],n=0,s=0;if(o=!m.sortStable,r=!m.sortStable&&a.call(e,0),I.call(e,v),o){for(;t=e[s++];)t===e[s]&&(n=i.push(s));for(;n--;)F.call(e,i[n],1)}return r=null,e},O.fn.uniqueSort=function(){return this.pushStack(O.uniqueSort(a.apply(this)))},t=O.expr={cacheLength:50,createPseudo:te,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace($,J),e[3]=(e[3]||e[4]||e[5]||"").replace($,J),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||Q.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&Q.error(e[0]),e},PSEUDO:function(e){var t,i=!e[6]&&e[2];return G.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":i&&k.test(i)&&(t=he(i,!0))&&(t=i.indexOf(")",i.length-t)-i.length)&&(e[0]=e[0].slice(0,t),e[2]=i.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace($,J).toLowerCase();return"*"===e?function(){return!0}:function(e){return C(e,t)}},CLASS:function(e){var t=w[e+" "];return t||(t=new RegExp("(^|"+M+")"+e+"("+M+"|$)"))&&w(e,(function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")}))},ATTR:function(e,t,i){return function(n){var r=Q.attr(n,e);return null==r?"!="===t:!t||(r+="","="===t?r===i:"!="===t?r!==i:"^="===t?i&&0===r.indexOf(i):"*="===t?i&&r.indexOf(i)>-1:"$="===t?i&&r.slice(-i.length)===i:"~="===t?(" "+r.replace(B," ")+" ").indexOf(i)>-1:"|="===t&&(r===i||r.slice(0,i.length+1)===i+"-"))}},CHILD:function(e,t,i,n,r){var s="nth"!==e.slice(0,3),o="last"!==e.slice(-4),a="of-type"===t;return 1===n&&0===r?function(e){return!!e.parentNode}:function(t,i,l){var u,h,d,c,p,g=s!==o?"nextSibling":"previousSibling",f=t.parentNode,m=a&&t.nodeName.toLowerCase(),y=!l&&!a,w=!1;if(f){if(s){for(;g;){for(d=t;d=d[g];)if(a?C(d,m):1===d.nodeType)return!1;p=g="only"===e&&!p&&"nextSibling"}return!0}if(p=[o?f.firstChild:f.lastChild],o&&y){for(w=(c=(u=(h=f[_]||(f[_]={}))[e]||[])[0]===x&&u[1])&&u[2],d=c&&f.childNodes[c];d=++c&&d&&d[g]||(w=c=0)||p.pop();)if(1===d.nodeType&&++w&&d===t){h[e]=[x,c,w];break}}else if(y&&(w=c=(u=(h=t[_]||(t[_]={}))[e]||[])[0]===x&&u[1]),!1===w)for(;(d=++c&&d&&d[g]||(w=c=0)||p.pop())&&(!(a?C(d,m):1===d.nodeType)||!++w||(y&&((h=d[_]||(d[_]={}))[e]=[x,w]),d!==t)););return(w-=r)===n||w%n==0&&w/n>=0}}},PSEUDO:function(e,i){var n,r=t.pseudos[e]||t.setFilters[e.toLowerCase()]||Q.error("unsupported pseudo: "+e);return r[_]?r(i):r.length>1?(n=[e,e,"",i],t.setFilters.hasOwnProperty(e.toLowerCase())?te((function(e,t){for(var n,s=r(e,i),o=s.length;o--;)e[n=h.call(e,s[o])]=!(t[n]=s[o])})):function(e){return r(e,0,n)}):r}},pseudos:{not:te((function(e){var t=[],i=[],n=_e(e.replace(D,"$1"));return n[_]?te((function(e,t,i,r){for(var s,o=n(e,null,r,[]),a=e.length;a--;)(s=o[a])&&(e[a]=!(t[a]=s))})):function(e,r,s){return t[0]=e,n(t,null,s,i),t[0]=null,!i.pop()}})),has:te((function(e){return function(t){return Q(e,t).length>0}})),contains:te((function(e){return e=e.replace($,J),function(t){return(t.textContent||O.text(t)).indexOf(e)>-1}})),lang:te((function(e){return z.test(e||"")||Q.error("unsupported lang: "+e),e=e.replace($,J).toLowerCase(),function(t){var i;do{if(i=d?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(i=i.toLowerCase())===e||0===i.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(e){var t=n.location&&n.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===u},focus:function(e){return e===function(){try{return l.activeElement}catch(e){}}()&&l.hasFocus()&&!!(e.type||e.href||~e.tabIndex)},enabled:se(!1),disabled:se(!0),checked:function(e){return C(e,"input")&&!!e.checked||C(e,"option")&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!t.pseudos.empty(e)},header:function(e){return q.test(e.nodeName)},input:function(e){return H.test(e.nodeName)},button:function(e){return C(e,"input")&&"button"===e.type||C(e,"button")},text:function(e){var t;return C(e,"input")&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:oe((function(){return[0]})),last:oe((function(e,t){return[t-1]})),eq:oe((function(e,t,i){return[i<0?i+t:i]})),even:oe((function(e,t){for(var i=0;i<t;i+=2)e.push(i);return e})),odd:oe((function(e,t){for(var i=1;i<t;i+=2)e.push(i);return e})),lt:oe((function(e,t,i){var n;for(n=i<0?i+t:i>t?t:i;--n>=0;)e.push(n);return e})),gt:oe((function(e,t,i){for(var n=i<0?i+t:i;++n<t;)e.push(n);return e}))}},t.pseudos.nth=t.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})t.pseudos[e]=ne(e);for(e in{submit:!0,reset:!0})t.pseudos[e]=re(e);function ue(){}function he(e,i){var n,r,s,o,a,l,u,h=b[e+" "];if(h)return i?0:h.slice(0);for(a=e,l=[],u=t.preFilter;a;){for(o in n&&!(r=U.exec(a))||(r&&(a=a.slice(r[0].length)||a),l.push(s=[])),n=!1,(r=X.exec(a))&&(n=r.shift(),s.push({value:n,type:r[0].replace(D," ")}),a=a.slice(n.length)),t.filter)!(r=G[o].exec(a))||u[o]&&!(r=u[o](r))||(n=r.shift(),s.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return i?a.length:a?Q.error(e):b(e,l).slice(0)}function de(e){for(var t=0,i=e.length,n="";t<i;t++)n+=e[t].value;return n}function ce(e,t,i){var n=t.dir,r=t.next,s=r||n,o=i&&"parentNode"===s,a=y++;return t.first?function(t,i,r){for(;t=t[n];)if(1===t.nodeType||o)return e(t,i,r);return!1}:function(t,i,l){var u,h,d=[x,a];if(l){for(;t=t[n];)if((1===t.nodeType||o)&&e(t,i,l))return!0}else for(;t=t[n];)if(1===t.nodeType||o)if(h=t[_]||(t[_]={}),r&&C(t,r))t=t[n]||t;else{if((u=h[s])&&u[0]===x&&u[1]===a)return d[2]=u[2];if(h[s]=d,d[2]=e(t,i,l))return!0}return!1}}function pe(e){return e.length>1?function(t,i,n){for(var r=e.length;r--;)if(!e[r](t,i,n))return!1;return!0}:e[0]}function ge(e,t,i,n,r){for(var s,o=[],a=0,l=e.length,u=null!=t;a<l;a++)(s=e[a])&&(i&&!i(s,n,r)||(o.push(s),u&&t.push(a)));return o}function fe(e,t,i,n,r,s){return n&&!n[_]&&(n=fe(n)),r&&!r[_]&&(r=fe(r,s)),te((function(s,o,a,l){var u,d,c,p,g=[],m=[],_=o.length,x=s||function(e,t,i){for(var n=0,r=t.length;n<r;n++)Q(e,t[n],i);return i}(t||"*",a.nodeType?[a]:a,[]),y=!e||!s&&t?x:ge(x,g,e,a,l);if(i?i(y,p=r||(s?e:_||n)?[]:o,a,l):p=y,n)for(u=ge(p,m),n(u,[],a,l),d=u.length;d--;)(c=u[d])&&(p[m[d]]=!(y[m[d]]=c));if(s){if(r||e){if(r){for(u=[],d=p.length;d--;)(c=p[d])&&u.push(y[d]=c);r(null,p=[],u,l)}for(d=p.length;d--;)(c=p[d])&&(u=r?h.call(s,c):g[d])>-1&&(s[u]=!(o[u]=c))}}else p=ge(p===o?p.splice(_,p.length):p),r?r(null,o,p,l):f.apply(o,p)}))}function me(e){for(var n,r,s,o=e.length,a=t.relative[e[0].type],l=a||t.relative[" "],u=a?1:0,d=ce((function(e){return e===n}),l,!0),c=ce((function(e){return h.call(n,e)>-1}),l,!0),p=[function(e,t,r){var s=!a&&(r||t!=i)||((n=t).nodeType?d(e,t,r):c(e,t,r));return n=null,s}];u<o;u++)if(r=t.relative[e[u].type])p=[ce(pe(p),r)];else{if((r=t.filter[e[u].type].apply(null,e[u].matches))[_]){for(s=++u;s<o&&!t.relative[e[s].type];s++);return fe(u>1&&pe(p),u>1&&de(e.slice(0,u-1).concat({value:" "===e[u-2].type?"*":""})).replace(D,"$1"),r,u<s&&me(e.slice(u,s)),s<o&&me(e=e.slice(s)),s<o&&de(e))}p.push(r)}return pe(p)}function _e(e,n){var r,s=[],o=[],a=S[e+" "];if(!a){for(n||(n=he(e)),r=n.length;r--;)(a=me(n[r]))[_]?s.push(a):o.push(a);a=S(e,function(e,n){var r=n.length>0,s=e.length>0,o=function(o,a,u,h,c){var p,g,m,_=0,y="0",w=o&&[],b=[],S=i,T=o||s&&t.find.TAG("*",c),v=x+=null==S?1:Math.random()||.1,E=T.length;for(c&&(i=a==l||a||c);y!==E&&null!=(p=T[y]);y++){if(s&&p){for(g=0,a||p.ownerDocument==l||(le(p),u=!d);m=e[g++];)if(m(p,a||l,u)){f.call(h,p);break}c&&(x=v)}r&&((p=!m&&p)&&_--,o&&w.push(p))}if(_+=y,r&&y!==_){for(g=0;m=n[g++];)m(w,b,a,u);if(o){if(_>0)for(;y--;)w[y]||b[y]||(b[y]=N.call(h));b=ge(b)}f.apply(h,b),c&&!o&&b.length>0&&_+n.length>1&&O.uniqueSort(h)}return c&&(x=v,i=S),w};return r?te(o):o}(o,s)),a.selector=e}return a}function xe(e,i,n,r){var s,o,a,l,u,h="function"==typeof e&&e,c=!r&&he(e=h.selector||e);if(n=n||[],1===c.length){if((o=c[0]=c[0].slice(0)).length>2&&"ID"===(a=o[0]).type&&9===i.nodeType&&d&&t.relative[o[1].type]){if(!(i=(t.find.ID(a.matches[0].replace($,J),i)||[])[0]))return n;h&&(i=i.parentNode),e=e.slice(o.shift().value.length)}for(s=G.needsContext.test(e)?0:o.length;s--&&(a=o[s],!t.relative[l=a.type]);)if((u=t.find[l])&&(r=u(a.matches[0].replace($,J),W.test(o[0].type)&&ae(i.parentNode)||i))){if(o.splice(s,1),!(e=r.length&&de(o)))return f.apply(n,r),n;break}}return(h||_e(e,c))(r,i,!d,n,!i||W.test(e)&&ae(i.parentNode)||i),n}ue.prototype=t.filters=t.pseudos,t.setFilters=new ue,m.sortStable=_.split("").sort(v).join("")===_,le(),m.sortDetached=ie((function(e){return 1&e.compareDocumentPosition(l.createElement("fieldset"))})),O.find=Q,O.expr[":"]=O.expr.pseudos,O.unique=O.uniqueSort,Q.compile=_e,Q.select=xe,Q.setDocument=le,Q.tokenize=he,Q.escape=O.escapeSelector,Q.getText=O.text,Q.isXML=O.isXMLDoc,Q.selectors=O.expr,Q.support=O.support,Q.uniqueSort=O.uniqueSort}();var L=function(e,t,i){for(var n=[],r=void 0!==i;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(r&&O(e).is(i))break;n.push(e)}return n},B=function(e,t){for(var i=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&i.push(e);return i},U=O.expr.match.needsContext,X=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function j(e,t,i){return _(t)?O.grep(e,(function(e,n){return!!t.call(e,n,e)!==i})):t.nodeType?O.grep(e,(function(e){return e===t!==i})):"string"!=typeof t?O.grep(e,(function(e){return h.call(t,e)>-1!==i})):O.filter(t,e,i)}O.filter=function(e,t,i){var n=t[0];return i&&(e=":not("+e+")"),1===t.length&&1===n.nodeType?O.find.matchesSelector(n,e)?[n]:[]:O.find.matches(e,O.grep(t,(function(e){return 1===e.nodeType})))},O.fn.extend({find:function(e){var t,i,n=this.length,r=this;if("string"!=typeof e)return this.pushStack(O(e).filter((function(){for(t=0;t<n;t++)if(O.contains(r[t],this))return!0})));for(i=this.pushStack([]),t=0;t<n;t++)O.find(e,r[t],i);return n>1?O.uniqueSort(i):i},filter:function(e){return this.pushStack(j(this,e||[],!1))},not:function(e){return this.pushStack(j(this,e||[],!0))},is:function(e){return!!j(this,"string"==typeof e&&U.test(e)?O(e):e||[],!1).length}});var k,z=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(O.fn.init=function(e,t,i){var n,r;if(!e)return this;if(i=i||k,"string"==typeof e){if(!(n="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:z.exec(e))||!n[1]&&t)return!t||t.jquery?(t||i).find(e):this.constructor(t).find(e);if(n[1]){if(t=t instanceof O?t[0]:t,O.merge(this,O.parseHTML(n[1],t&&t.nodeType?t.ownerDocument||t:y,!0)),X.test(n[1])&&O.isPlainObject(t))for(n in t)_(this[n])?this[n](t[n]):this.attr(n,t[n]);return this}return(r=y.getElementById(n[2]))&&(this[0]=r,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):_(e)?void 0!==i.ready?i.ready(e):e(O):O.makeArray(e,this)}).prototype=O.fn,k=O(y);var G=/^(?:parents|prev(?:Until|All))/,H={children:!0,contents:!0,next:!0,prev:!0};function q(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}O.fn.extend({has:function(e){var t=O(e,this),i=t.length;return this.filter((function(){for(var e=0;e<i;e++)if(O.contains(this,t[e]))return!0}))},closest:function(e,t){var i,n=0,r=this.length,s=[],o="string"!=typeof e&&O(e);if(!U.test(e))for(;n<r;n++)for(i=this[n];i&&i!==t;i=i.parentNode)if(i.nodeType<11&&(o?o.index(i)>-1:1===i.nodeType&&O.find.matchesSelector(i,e))){s.push(i);break}return this.pushStack(s.length>1?O.uniqueSort(s):s)},index:function(e){return e?"string"==typeof e?h.call(O(e),this[0]):h.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(O.uniqueSort(O.merge(this.get(),O(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),O.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return L(e,"parentNode")},parentsUntil:function(e,t,i){return L(e,"parentNode",i)},next:function(e){return q(e,"nextSibling")},prev:function(e){return q(e,"previousSibling")},nextAll:function(e){return L(e,"nextSibling")},prevAll:function(e){return L(e,"previousSibling")},nextUntil:function(e,t,i){return L(e,"nextSibling",i)},prevUntil:function(e,t,i){return L(e,"previousSibling",i)},siblings:function(e){return B((e.parentNode||{}).firstChild,e)},children:function(e){return B(e.firstChild)},contents:function(e){return null!=e.contentDocument&&o(e.contentDocument)?e.contentDocument:(C(e,"template")&&(e=e.content||e),O.merge([],e.childNodes))}},(function(e,t){O.fn[e]=function(i,n){var r=O.map(this,t,i);return"Until"!==e.slice(-5)&&(n=i),n&&"string"==typeof n&&(r=O.filter(n,r)),this.length>1&&(H[e]||O.uniqueSort(r),G.test(e)&&r.reverse()),this.pushStack(r)}}));var Y=/[^\x20\t\r\n\f]+/g;function W(e){return e}function $(e){throw e}function J(e,t,i,n){var r;try{e&&_(r=e.promise)?r.call(e).done(t).fail(i):e&&_(r=e.then)?r.call(e,t,i):t.apply(void 0,[e].slice(n))}catch(e){i.apply(void 0,[e])}}O.Callbacks=function(e){e="string"==typeof e?function(e){var t={};return O.each(e.match(Y)||[],(function(e,i){t[i]=!0})),t}(e):O.extend({},e);var t,i,n,r,s=[],o=[],a=-1,l=function(){for(r=r||e.once,n=t=!0;o.length;a=-1)for(i=o.shift();++a<s.length;)!1===s[a].apply(i[0],i[1])&&e.stopOnFalse&&(a=s.length,i=!1);e.memory||(i=!1),t=!1,r&&(s=i?[]:"")},u={add:function(){return s&&(i&&!t&&(a=s.length-1,o.push(i)),function t(i){O.each(i,(function(i,n){_(n)?e.unique&&u.has(n)||s.push(n):n&&n.length&&"string"!==S(n)&&t(n)}))}(arguments),i&&!t&&l()),this},remove:function(){return O.each(arguments,(function(e,t){for(var i;(i=O.inArray(t,s,i))>-1;)s.splice(i,1),i<=a&&a--})),this},has:function(e){return e?O.inArray(e,s)>-1:s.length>0},empty:function(){return s&&(s=[]),this},disable:function(){return r=o=[],s=i="",this},disabled:function(){return!s},lock:function(){return r=o=[],i||t||(s=i=""),this},locked:function(){return!!r},fireWith:function(e,i){return r||(i=[e,(i=i||[]).slice?i.slice():i],o.push(i),t||l()),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!n}};return u},O.extend({Deferred:function(e){var t=[["notify","progress",O.Callbacks("memory"),O.Callbacks("memory"),2],["resolve","done",O.Callbacks("once memory"),O.Callbacks("once memory"),0,"resolved"],["reject","fail",O.Callbacks("once memory"),O.Callbacks("once memory"),1,"rejected"]],i="pending",r={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},catch:function(e){return r.then(null,e)},pipe:function(){var e=arguments;return O.Deferred((function(i){O.each(t,(function(t,n){var r=_(e[n[4]])&&e[n[4]];s[n[1]]((function(){var e=r&&r.apply(this,arguments);e&&_(e.promise)?e.promise().progress(i.notify).done(i.resolve).fail(i.reject):i[n[0]+"With"](this,r?[e]:arguments)}))})),e=null})).promise()},then:function(e,i,r){var s=0;function o(e,t,i,r){return function(){var a=this,l=arguments,u=function(){var n,u;if(!(e<s)){if((n=i.apply(a,l))===t.promise())throw new TypeError("Thenable self-resolution");u=n&&("object"==typeof n||"function"==typeof n)&&n.then,_(u)?r?u.call(n,o(s,t,W,r),o(s,t,$,r)):(s++,u.call(n,o(s,t,W,r),o(s,t,$,r),o(s,t,W,t.notifyWith))):(i!==W&&(a=void 0,l=[n]),(r||t.resolveWith)(a,l))}},h=r?u:function(){try{u()}catch(n){O.Deferred.exceptionHook&&O.Deferred.exceptionHook(n,h.error),e+1>=s&&(i!==$&&(a=void 0,l=[n]),t.rejectWith(a,l))}};e?h():(O.Deferred.getErrorHook?h.error=O.Deferred.getErrorHook():O.Deferred.getStackHook&&(h.error=O.Deferred.getStackHook()),n.setTimeout(h))}}return O.Deferred((function(n){t[0][3].add(o(0,n,_(r)?r:W,n.notifyWith)),t[1][3].add(o(0,n,_(e)?e:W)),t[2][3].add(o(0,n,_(i)?i:$))})).promise()},promise:function(e){return null!=e?O.extend(e,r):r}},s={};return O.each(t,(function(e,n){var o=n[2],a=n[5];r[n[1]]=o.add,a&&o.add((function(){i=a}),t[3-e][2].disable,t[3-e][3].disable,t[0][2].lock,t[0][3].lock),o.add(n[3].fire),s[n[0]]=function(){return s[n[0]+"With"](this===s?void 0:this,arguments),this},s[n[0]+"With"]=o.fireWith})),r.promise(s),e&&e.call(s,s),s},when:function(e){var t=arguments.length,i=t,n=Array(i),r=a.call(arguments),s=O.Deferred(),o=function(e){return function(i){n[e]=this,r[e]=arguments.length>1?a.call(arguments):i,--t||s.resolveWith(n,r)}};if(t<=1&&(J(e,s.done(o(i)).resolve,s.reject,!t),"pending"===s.state()||_(r[i]&&r[i].then)))return s.then();for(;i--;)J(r[i],o(i),s.reject);return s.promise()}});var K=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;O.Deferred.exceptionHook=function(e,t){n.console&&n.console.warn&&e&&K.test(e.name)&&n.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},O.readyException=function(e){n.setTimeout((function(){throw e}))};var Z=O.Deferred();function Q(){y.removeEventListener("DOMContentLoaded",Q),n.removeEventListener("load",Q),O.ready()}O.fn.ready=function(e){return Z.then(e).catch((function(e){O.readyException(e)})),this},O.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--O.readyWait:O.isReady)||(O.isReady=!0,!0!==e&&--O.readyWait>0||Z.resolveWith(y,[O]))}}),O.ready.then=Z.then,"complete"===y.readyState||"loading"!==y.readyState&&!y.documentElement.doScroll?n.setTimeout(O.ready):(y.addEventListener("DOMContentLoaded",Q),n.addEventListener("load",Q));var ee=function(e,t,i,n,r,s,o){var a=0,l=e.length,u=null==i;if("object"===S(i))for(a in r=!0,i)ee(e,t,a,i[a],!0,s,o);else if(void 0!==n&&(r=!0,_(n)||(o=!0),u&&(o?(t.call(e,n),t=null):(u=t,t=function(e,t,i){return u.call(O(e),i)})),t))for(;a<l;a++)t(e[a],i,o?n:n.call(e[a],a,t(e[a],i)));return r?e:u?t.call(e):l?t(e[0],i):s},te=/^-ms-/,ie=/-([a-z])/g;function ne(e,t){return t.toUpperCase()}function re(e){return e.replace(te,"ms-").replace(ie,ne)}var se=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function oe(){this.expando=O.expando+oe.uid++}oe.uid=1,oe.prototype={cache:function(e){var t=e[this.expando];return t||(t={},se(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,i){var n,r=this.cache(e);if("string"==typeof t)r[re(t)]=i;else for(n in t)r[re(n)]=t[n];return r},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][re(t)]},access:function(e,t,i){return void 0===t||t&&"string"==typeof t&&void 0===i?this.get(e,t):(this.set(e,t,i),void 0!==i?i:t)},remove:function(e,t){var i,n=e[this.expando];if(void 0!==n){if(void 0!==t){i=(t=Array.isArray(t)?t.map(re):(t=re(t))in n?[t]:t.match(Y)||[]).length;for(;i--;)delete n[t[i]]}(void 0===t||O.isEmptyObject(n))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!O.isEmptyObject(t)}};var ae=new oe,le=new oe,ue=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,he=/[A-Z]/g;function de(e,t,i){var n;if(void 0===i&&1===e.nodeType)if(n="data-"+t.replace(he,"-$&").toLowerCase(),"string"==typeof(i=e.getAttribute(n))){try{i=function(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:ue.test(e)?JSON.parse(e):e)}(i)}catch(e){}le.set(e,t,i)}else i=void 0;return i}O.extend({hasData:function(e){return le.hasData(e)||ae.hasData(e)},data:function(e,t,i){return le.access(e,t,i)},removeData:function(e,t){le.remove(e,t)},_data:function(e,t,i){return ae.access(e,t,i)},_removeData:function(e,t){ae.remove(e,t)}}),O.fn.extend({data:function(e,t){var i,n,r,s=this[0],o=s&&s.attributes;if(void 0===e){if(this.length&&(r=le.get(s),1===s.nodeType&&!ae.get(s,"hasDataAttrs"))){for(i=o.length;i--;)o[i]&&0===(n=o[i].name).indexOf("data-")&&(n=re(n.slice(5)),de(s,n,r[n]));ae.set(s,"hasDataAttrs",!0)}return r}return"object"==typeof e?this.each((function(){le.set(this,e)})):ee(this,(function(t){var i;if(s&&void 0===t)return void 0!==(i=le.get(s,e))||void 0!==(i=de(s,e))?i:void 0;this.each((function(){le.set(this,e,t)}))}),null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each((function(){le.remove(this,e)}))}}),O.extend({queue:function(e,t,i){var n;if(e)return t=(t||"fx")+"queue",n=ae.get(e,t),i&&(!n||Array.isArray(i)?n=ae.access(e,t,O.makeArray(i)):n.push(i)),n||[]},dequeue:function(e,t){t=t||"fx";var i=O.queue(e,t),n=i.length,r=i.shift(),s=O._queueHooks(e,t);"inprogress"===r&&(r=i.shift(),n--),r&&("fx"===t&&i.unshift("inprogress"),delete s.stop,r.call(e,(function(){O.dequeue(e,t)}),s)),!n&&s&&s.empty.fire()},_queueHooks:function(e,t){var i=t+"queueHooks";return ae.get(e,i)||ae.access(e,i,{empty:O.Callbacks("once memory").add((function(){ae.remove(e,[t+"queue",i])}))})}}),O.fn.extend({queue:function(e,t){var i=2;return"string"!=typeof e&&(t=e,e="fx",i--),arguments.length<i?O.queue(this[0],e):void 0===t?this:this.each((function(){var i=O.queue(this,e,t);O._queueHooks(this,e),"fx"===e&&"inprogress"!==i[0]&&O.dequeue(this,e)}))},dequeue:function(e){return this.each((function(){O.dequeue(this,e)}))},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var i,n=1,r=O.Deferred(),s=this,o=this.length,a=function(){--n||r.resolveWith(s,[s])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";o--;)(i=ae.get(s[o],e+"queueHooks"))&&i.empty&&(n++,i.empty.add(a));return a(),r.promise(t)}});var ce=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,pe=new RegExp("^(?:([+-])=|)("+ce+")([a-z%]*)$","i"),ge=["Top","Right","Bottom","Left"],fe=y.documentElement,me=function(e){return O.contains(e.ownerDocument,e)},_e={composed:!0};fe.getRootNode&&(me=function(e){return O.contains(e.ownerDocument,e)||e.getRootNode(_e)===e.ownerDocument});var xe=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&me(e)&&"none"===O.css(e,"display")};function ye(e,t,i,n){var r,s,o=20,a=n?function(){return n.cur()}:function(){return O.css(e,t,"")},l=a(),u=i&&i[3]||(O.cssNumber[t]?"":"px"),h=e.nodeType&&(O.cssNumber[t]||"px"!==u&&+l)&&pe.exec(O.css(e,t));if(h&&h[3]!==u){for(l/=2,u=u||h[3],h=+l||1;o--;)O.style(e,t,h+u),(1-s)*(1-(s=a()/l||.5))<=0&&(o=0),h/=s;h*=2,O.style(e,t,h+u),i=i||[]}return i&&(h=+h||+l||0,r=i[1]?h+(i[1]+1)*i[2]:+i[2],n&&(n.unit=u,n.start=h,n.end=r)),r}var we={};function be(e){var t,i=e.ownerDocument,n=e.nodeName,r=we[n];return r||(t=i.body.appendChild(i.createElement(n)),r=O.css(t,"display"),t.parentNode.removeChild(t),"none"===r&&(r="block"),we[n]=r,r)}function Se(e,t){for(var i,n,r=[],s=0,o=e.length;s<o;s++)(n=e[s]).style&&(i=n.style.display,t?("none"===i&&(r[s]=ae.get(n,"display")||null,r[s]||(n.style.display="")),""===n.style.display&&xe(n)&&(r[s]=be(n))):"none"!==i&&(r[s]="none",ae.set(n,"display",i)));for(s=0;s<o;s++)null!=r[s]&&(e[s].style.display=r[s]);return e}O.fn.extend({show:function(){return Se(this,!0)},hide:function(){return Se(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each((function(){xe(this)?O(this).show():O(this).hide()}))}});var Te,ve,Oe=/^(?:checkbox|radio)$/i,Ee=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Ce=/^$|^module$|\/(?:java|ecma)script/i;Te=y.createDocumentFragment().appendChild(y.createElement("div")),(ve=y.createElement("input")).setAttribute("type","radio"),ve.setAttribute("checked","checked"),ve.setAttribute("name","t"),Te.appendChild(ve),m.checkClone=Te.cloneNode(!0).cloneNode(!0).lastChild.checked,Te.innerHTML="<textarea>x</textarea>",m.noCloneChecked=!!Te.cloneNode(!0).lastChild.defaultValue,Te.innerHTML="<option></option>",m.option=!!Te.lastChild;var Ne={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function Ie(e,t){var i;return i=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&C(e,t)?O.merge([e],i):i}function Fe(e,t){for(var i=0,n=e.length;i<n;i++)ae.set(e[i],"globalEval",!t||ae.get(t[i],"globalEval"))}Ne.tbody=Ne.tfoot=Ne.colgroup=Ne.caption=Ne.thead,Ne.th=Ne.td,m.option||(Ne.optgroup=Ne.option=[1,"<select multiple='multiple'>","</select>"]);var Me=/<|&#?\w+;/;function De(e,t,i,n,r){for(var s,o,a,l,u,h,d=t.createDocumentFragment(),c=[],p=0,g=e.length;p<g;p++)if((s=e[p])||0===s)if("object"===S(s))O.merge(c,s.nodeType?[s]:s);else if(Me.test(s)){for(o=o||d.appendChild(t.createElement("div")),a=(Ee.exec(s)||["",""])[1].toLowerCase(),l=Ne[a]||Ne._default,o.innerHTML=l[1]+O.htmlPrefilter(s)+l[2],h=l[0];h--;)o=o.lastChild;O.merge(c,o.childNodes),(o=d.firstChild).textContent=""}else c.push(t.createTextNode(s));for(d.textContent="",p=0;s=c[p++];)if(n&&O.inArray(s,n)>-1)r&&r.push(s);else if(u=me(s),o=Ie(d.appendChild(s),"script"),u&&Fe(o),i)for(h=0;s=o[h++];)Ce.test(s.type||"")&&i.push(s);return d}var Re=/^([^.]*)(?:\.(.+)|)/;function Pe(){return!0}function Ae(){return!1}function Ve(e,t,i,n,r,s){var o,a;if("object"==typeof t){for(a in"string"!=typeof i&&(n=n||i,i=void 0),t)Ve(e,a,i,n,t[a],s);return e}if(null==n&&null==r?(r=i,n=i=void 0):null==r&&("string"==typeof i?(r=n,n=void 0):(r=n,n=i,i=void 0)),!1===r)r=Ae;else if(!r)return e;return 1===s&&(o=r,r=function(e){return O().off(e),o.apply(this,arguments)},r.guid=o.guid||(o.guid=O.guid++)),e.each((function(){O.event.add(this,t,r,n,i)}))}function Le(e,t,i){i?(ae.set(e,t,!1),O.event.add(e,t,{namespace:!1,handler:function(e){var i,n=ae.get(this,t);if(1&e.isTrigger&&this[t]){if(n)(O.event.special[t]||{}).delegateType&&e.stopPropagation();else if(n=a.call(arguments),ae.set(this,t,n),this[t](),i=ae.get(this,t),ae.set(this,t,!1),n!==i)return e.stopImmediatePropagation(),e.preventDefault(),i}else n&&(ae.set(this,t,O.event.trigger(n[0],n.slice(1),this)),e.stopPropagation(),e.isImmediatePropagationStopped=Pe)}})):void 0===ae.get(e,t)&&O.event.add(e,t,Pe)}O.event={global:{},add:function(e,t,i,n,r){var s,o,a,l,u,h,d,c,p,g,f,m=ae.get(e);if(se(e))for(i.handler&&(i=(s=i).handler,r=s.selector),r&&O.find.matchesSelector(fe,r),i.guid||(i.guid=O.guid++),(l=m.events)||(l=m.events=Object.create(null)),(o=m.handle)||(o=m.handle=function(t){return void 0!==O&&O.event.triggered!==t.type?O.event.dispatch.apply(e,arguments):void 0}),u=(t=(t||"").match(Y)||[""]).length;u--;)p=f=(a=Re.exec(t[u])||[])[1],g=(a[2]||"").split(".").sort(),p&&(d=O.event.special[p]||{},p=(r?d.delegateType:d.bindType)||p,d=O.event.special[p]||{},h=O.extend({type:p,origType:f,data:n,handler:i,guid:i.guid,selector:r,needsContext:r&&O.expr.match.needsContext.test(r),namespace:g.join(".")},s),(c=l[p])||((c=l[p]=[]).delegateCount=0,d.setup&&!1!==d.setup.call(e,n,g,o)||e.addEventListener&&e.addEventListener(p,o)),d.add&&(d.add.call(e,h),h.handler.guid||(h.handler.guid=i.guid)),r?c.splice(c.delegateCount++,0,h):c.push(h),O.event.global[p]=!0)},remove:function(e,t,i,n,r){var s,o,a,l,u,h,d,c,p,g,f,m=ae.hasData(e)&&ae.get(e);if(m&&(l=m.events)){for(u=(t=(t||"").match(Y)||[""]).length;u--;)if(p=f=(a=Re.exec(t[u])||[])[1],g=(a[2]||"").split(".").sort(),p){for(d=O.event.special[p]||{},c=l[p=(n?d.delegateType:d.bindType)||p]||[],a=a[2]&&new RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=s=c.length;s--;)h=c[s],!r&&f!==h.origType||i&&i.guid!==h.guid||a&&!a.test(h.namespace)||n&&n!==h.selector&&("**"!==n||!h.selector)||(c.splice(s,1),h.selector&&c.delegateCount--,d.remove&&d.remove.call(e,h));o&&!c.length&&(d.teardown&&!1!==d.teardown.call(e,g,m.handle)||O.removeEvent(e,p,m.handle),delete l[p])}else for(p in l)O.event.remove(e,p+t[u],i,n,!0);O.isEmptyObject(l)&&ae.remove(e,"handle events")}},dispatch:function(e){var t,i,n,r,s,o,a=new Array(arguments.length),l=O.event.fix(e),u=(ae.get(this,"events")||Object.create(null))[l.type]||[],h=O.event.special[l.type]||{};for(a[0]=l,t=1;t<arguments.length;t++)a[t]=arguments[t];if(l.delegateTarget=this,!h.preDispatch||!1!==h.preDispatch.call(this,l)){for(o=O.event.handlers.call(this,l,u),t=0;(r=o[t++])&&!l.isPropagationStopped();)for(l.currentTarget=r.elem,i=0;(s=r.handlers[i++])&&!l.isImmediatePropagationStopped();)l.rnamespace&&!1!==s.namespace&&!l.rnamespace.test(s.namespace)||(l.handleObj=s,l.data=s.data,void 0!==(n=((O.event.special[s.origType]||{}).handle||s.handler).apply(r.elem,a))&&!1===(l.result=n)&&(l.preventDefault(),l.stopPropagation()));return h.postDispatch&&h.postDispatch.call(this,l),l.result}},handlers:function(e,t){var i,n,r,s,o,a=[],l=t.delegateCount,u=e.target;if(l&&u.nodeType&&!("click"===e.type&&e.button>=1))for(;u!==this;u=u.parentNode||this)if(1===u.nodeType&&("click"!==e.type||!0!==u.disabled)){for(s=[],o={},i=0;i<l;i++)void 0===o[r=(n=t[i]).selector+" "]&&(o[r]=n.needsContext?O(r,this).index(u)>-1:O.find(r,this,null,[u]).length),o[r]&&s.push(n);s.length&&a.push({elem:u,handlers:s})}return u=this,l<t.length&&a.push({elem:u,handlers:t.slice(l)}),a},addProp:function(e,t){Object.defineProperty(O.Event.prototype,e,{enumerable:!0,configurable:!0,get:_(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[O.expando]?e:new O.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return Oe.test(t.type)&&t.click&&C(t,"input")&&Le(t,"click",!0),!1},trigger:function(e){var t=this||e;return Oe.test(t.type)&&t.click&&C(t,"input")&&Le(t,"click"),!0},_default:function(e){var t=e.target;return Oe.test(t.type)&&t.click&&C(t,"input")&&ae.get(t,"click")||C(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},O.removeEvent=function(e,t,i){e.removeEventListener&&e.removeEventListener(t,i)},O.Event=function(e,t){if(!(this instanceof O.Event))return new O.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Pe:Ae,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&O.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[O.expando]=!0},O.Event.prototype={constructor:O.Event,isDefaultPrevented:Ae,isPropagationStopped:Ae,isImmediatePropagationStopped:Ae,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Pe,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Pe,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Pe,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},O.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},O.event.addProp),O.each({focus:"focusin",blur:"focusout"},(function(e,t){function i(e){if(y.documentMode){var i=ae.get(this,"handle"),n=O.event.fix(e);n.type="focusin"===e.type?"focus":"blur",n.isSimulated=!0,i(e),n.target===n.currentTarget&&i(n)}else O.event.simulate(t,e.target,O.event.fix(e))}O.event.special[e]={setup:function(){var n;if(Le(this,e,!0),!y.documentMode)return!1;(n=ae.get(this,t))||this.addEventListener(t,i),ae.set(this,t,(n||0)+1)},trigger:function(){return Le(this,e),!0},teardown:function(){var e;if(!y.documentMode)return!1;(e=ae.get(this,t)-1)?ae.set(this,t,e):(this.removeEventListener(t,i),ae.remove(this,t))},_default:function(t){return ae.get(t.target,e)},delegateType:t},O.event.special[t]={setup:function(){var n=this.ownerDocument||this.document||this,r=y.documentMode?this:n,s=ae.get(r,t);s||(y.documentMode?this.addEventListener(t,i):n.addEventListener(e,i,!0)),ae.set(r,t,(s||0)+1)},teardown:function(){var n=this.ownerDocument||this.document||this,r=y.documentMode?this:n,s=ae.get(r,t)-1;s?ae.set(r,t,s):(y.documentMode?this.removeEventListener(t,i):n.removeEventListener(e,i,!0),ae.remove(r,t))}}})),O.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(e,t){O.event.special[e]={delegateType:t,bindType:t,handle:function(e){var i,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||O.contains(this,n))||(e.type=r.origType,i=r.handler.apply(this,arguments),e.type=t),i}}})),O.fn.extend({on:function(e,t,i,n){return Ve(this,e,t,i,n)},one:function(e,t,i,n){return Ve(this,e,t,i,n,1)},off:function(e,t,i){var n,r;if(e&&e.preventDefault&&e.handleObj)return n=e.handleObj,O(e.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"==typeof e){for(r in e)this.off(r,t,e[r]);return this}return!1!==t&&"function"!=typeof t||(i=t,t=void 0),!1===i&&(i=Ae),this.each((function(){O.event.remove(this,e,i,t)}))}});var Be=/<script|<style|<link/i,Ue=/checked\s*(?:[^=]|=\s*.checked.)/i,Xe=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function je(e,t){return C(e,"table")&&C(11!==t.nodeType?t:t.firstChild,"tr")&&O(e).children("tbody")[0]||e}function ke(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function ze(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Ge(e,t){var i,n,r,s,o,a;if(1===t.nodeType){if(ae.hasData(e)&&(a=ae.get(e).events))for(r in ae.remove(t,"handle events"),a)for(i=0,n=a[r].length;i<n;i++)O.event.add(t,r,a[r][i]);le.hasData(e)&&(s=le.access(e),o=O.extend({},s),le.set(t,o))}}function He(e,t){var i=t.nodeName.toLowerCase();"input"===i&&Oe.test(e.type)?t.checked=e.checked:"input"!==i&&"textarea"!==i||(t.defaultValue=e.defaultValue)}function qe(e,t,i,n){t=l(t);var r,s,o,a,u,h,d=0,c=e.length,p=c-1,g=t[0],f=_(g);if(f||c>1&&"string"==typeof g&&!m.checkClone&&Ue.test(g))return e.each((function(r){var s=e.eq(r);f&&(t[0]=g.call(this,r,s.html())),qe(s,t,i,n)}));if(c&&(s=(r=De(t,e[0].ownerDocument,!1,e,n)).firstChild,1===r.childNodes.length&&(r=s),s||n)){for(a=(o=O.map(Ie(r,"script"),ke)).length;d<c;d++)u=r,d!==p&&(u=O.clone(u,!0,!0),a&&O.merge(o,Ie(u,"script"))),i.call(e[d],u,d);if(a)for(h=o[o.length-1].ownerDocument,O.map(o,ze),d=0;d<a;d++)u=o[d],Ce.test(u.type||"")&&!ae.access(u,"globalEval")&&O.contains(h,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?O._evalUrl&&!u.noModule&&O._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")},h):b(u.textContent.replace(Xe,""),u,h))}return e}function Ye(e,t,i){for(var n,r=t?O.filter(t,e):e,s=0;null!=(n=r[s]);s++)i||1!==n.nodeType||O.cleanData(Ie(n)),n.parentNode&&(i&&me(n)&&Fe(Ie(n,"script")),n.parentNode.removeChild(n));return e}O.extend({htmlPrefilter:function(e){return e},clone:function(e,t,i){var n,r,s,o,a=e.cloneNode(!0),l=me(e);if(!(m.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||O.isXMLDoc(e)))for(o=Ie(a),n=0,r=(s=Ie(e)).length;n<r;n++)He(s[n],o[n]);if(t)if(i)for(s=s||Ie(e),o=o||Ie(a),n=0,r=s.length;n<r;n++)Ge(s[n],o[n]);else Ge(e,a);return(o=Ie(a,"script")).length>0&&Fe(o,!l&&Ie(e,"script")),a},cleanData:function(e){for(var t,i,n,r=O.event.special,s=0;void 0!==(i=e[s]);s++)if(se(i)){if(t=i[ae.expando]){if(t.events)for(n in t.events)r[n]?O.event.remove(i,n):O.removeEvent(i,n,t.handle);i[ae.expando]=void 0}i[le.expando]&&(i[le.expando]=void 0)}}}),O.fn.extend({detach:function(e){return Ye(this,e,!0)},remove:function(e){return Ye(this,e)},text:function(e){return ee(this,(function(e){return void 0===e?O.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)}))}),null,e,arguments.length)},append:function(){return qe(this,arguments,(function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||je(this,e).appendChild(e)}))},prepend:function(){return qe(this,arguments,(function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=je(this,e);t.insertBefore(e,t.firstChild)}}))},before:function(){return qe(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this)}))},after:function(){return qe(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)}))},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(O.cleanData(Ie(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map((function(){return O.clone(this,e,t)}))},html:function(e){return ee(this,(function(e){var t=this[0]||{},i=0,n=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Be.test(e)&&!Ne[(Ee.exec(e)||["",""])[1].toLowerCase()]){e=O.htmlPrefilter(e);try{for(;i<n;i++)1===(t=this[i]||{}).nodeType&&(O.cleanData(Ie(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)}),null,e,arguments.length)},replaceWith:function(){var e=[];return qe(this,arguments,(function(t){var i=this.parentNode;O.inArray(this,e)<0&&(O.cleanData(Ie(this)),i&&i.replaceChild(t,this))}),e)}}),O.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(e,t){O.fn[e]=function(e){for(var i,n=[],r=O(e),s=r.length-1,o=0;o<=s;o++)i=o===s?this:this.clone(!0),O(r[o])[t](i),u.apply(n,i.get());return this.pushStack(n)}}));var We=new RegExp("^("+ce+")(?!px)[a-z%]+$","i"),$e=/^--/,Je=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=n),t.getComputedStyle(e)},Ke=function(e,t,i){var n,r,s={};for(r in t)s[r]=e.style[r],e.style[r]=t[r];for(r in n=i.call(e),t)e.style[r]=s[r];return n},Ze=new RegExp(ge.join("|"),"i");function Qe(e,t,i){var n,r,s,o,a=$e.test(t),l=e.style;return(i=i||Je(e))&&(o=i.getPropertyValue(t)||i[t],a&&o&&(o=o.replace(D,"$1")||void 0),""!==o||me(e)||(o=O.style(e,t)),!m.pixelBoxStyles()&&We.test(o)&&Ze.test(t)&&(n=l.width,r=l.minWidth,s=l.maxWidth,l.minWidth=l.maxWidth=l.width=o,o=i.width,l.width=n,l.minWidth=r,l.maxWidth=s)),void 0!==o?o+"":o}function et(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(h){u.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",h.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",fe.appendChild(u).appendChild(h);var e=n.getComputedStyle(h);i="1%"!==e.top,l=12===t(e.marginLeft),h.style.right="60%",o=36===t(e.right),r=36===t(e.width),h.style.position="absolute",s=12===t(h.offsetWidth/3),fe.removeChild(u),h=null}}function t(e){return Math.round(parseFloat(e))}var i,r,s,o,a,l,u=y.createElement("div"),h=y.createElement("div");h.style&&(h.style.backgroundClip="content-box",h.cloneNode(!0).style.backgroundClip="",m.clearCloneStyle="content-box"===h.style.backgroundClip,O.extend(m,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),i},reliableMarginLeft:function(){return e(),l},scrollboxSize:function(){return e(),s},reliableTrDimensions:function(){var e,t,i,r;return null==a&&(e=y.createElement("table"),t=y.createElement("tr"),i=y.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="box-sizing:content-box;border:1px solid",t.style.height="1px",i.style.height="9px",i.style.display="block",fe.appendChild(e).appendChild(t).appendChild(i),r=n.getComputedStyle(t),a=parseInt(r.height,10)+parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)===t.offsetHeight,fe.removeChild(e)),a}}))}();var tt=["Webkit","Moz","ms"],it=y.createElement("div").style,nt={};function rt(e){var t=O.cssProps[e]||nt[e];return t||(e in it?e:nt[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),i=tt.length;i--;)if((e=tt[i]+t)in it)return e}(e)||e)}var st=/^(none|table(?!-c[ea]).+)/,ot={position:"absolute",visibility:"hidden",display:"block"},at={letterSpacing:"0",fontWeight:"400"};function lt(e,t,i){var n=pe.exec(t);return n?Math.max(0,n[2]-(i||0))+(n[3]||"px"):t}function ut(e,t,i,n,r,s){var o="width"===t?1:0,a=0,l=0,u=0;if(i===(n?"border":"content"))return 0;for(;o<4;o+=2)"margin"===i&&(u+=O.css(e,i+ge[o],!0,r)),n?("content"===i&&(l-=O.css(e,"padding"+ge[o],!0,r)),"margin"!==i&&(l-=O.css(e,"border"+ge[o]+"Width",!0,r))):(l+=O.css(e,"padding"+ge[o],!0,r),"padding"!==i?l+=O.css(e,"border"+ge[o]+"Width",!0,r):a+=O.css(e,"border"+ge[o]+"Width",!0,r));return!n&&s>=0&&(l+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-s-l-a-.5))||0),l+u}function ht(e,t,i){var n=Je(e),r=(!m.boxSizingReliable()||i)&&"border-box"===O.css(e,"boxSizing",!1,n),s=r,o=Qe(e,t,n),a="offset"+t[0].toUpperCase()+t.slice(1);if(We.test(o)){if(!i)return o;o="auto"}return(!m.boxSizingReliable()&&r||!m.reliableTrDimensions()&&C(e,"tr")||"auto"===o||!parseFloat(o)&&"inline"===O.css(e,"display",!1,n))&&e.getClientRects().length&&(r="border-box"===O.css(e,"boxSizing",!1,n),(s=a in e)&&(o=e[a])),(o=parseFloat(o)||0)+ut(e,t,i||(r?"border":"content"),s,n,o)+"px"}function dt(e,t,i,n,r){return new dt.prototype.init(e,t,i,n,r)}O.extend({cssHooks:{opacity:{get:function(e,t){if(t){var i=Qe(e,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(e,t,i,n){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var r,s,o,a=re(t),l=$e.test(t),u=e.style;if(l||(t=rt(a)),o=O.cssHooks[t]||O.cssHooks[a],void 0===i)return o&&"get"in o&&void 0!==(r=o.get(e,!1,n))?r:u[t];"string"==(s=typeof i)&&(r=pe.exec(i))&&r[1]&&(i=ye(e,t,r),s="number"),null!=i&&i==i&&("number"!==s||l||(i+=r&&r[3]||(O.cssNumber[a]?"":"px")),m.clearCloneStyle||""!==i||0!==t.indexOf("background")||(u[t]="inherit"),o&&"set"in o&&void 0===(i=o.set(e,i,n))||(l?u.setProperty(t,i):u[t]=i))}},css:function(e,t,i,n){var r,s,o,a=re(t);return $e.test(t)||(t=rt(a)),(o=O.cssHooks[t]||O.cssHooks[a])&&"get"in o&&(r=o.get(e,!0,i)),void 0===r&&(r=Qe(e,t,n)),"normal"===r&&t in at&&(r=at[t]),""===i||i?(s=parseFloat(r),!0===i||isFinite(s)?s||0:r):r}}),O.each(["height","width"],(function(e,t){O.cssHooks[t]={get:function(e,i,n){if(i)return!st.test(O.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?ht(e,t,n):Ke(e,ot,(function(){return ht(e,t,n)}))},set:function(e,i,n){var r,s=Je(e),o=!m.scrollboxSize()&&"absolute"===s.position,a=(o||n)&&"border-box"===O.css(e,"boxSizing",!1,s),l=n?ut(e,t,n,a,s):0;return a&&o&&(l-=Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-parseFloat(s[t])-ut(e,t,"border",!1,s)-.5)),l&&(r=pe.exec(i))&&"px"!==(r[3]||"px")&&(e.style[t]=i,i=O.css(e,t)),lt(0,i,l)}}})),O.cssHooks.marginLeft=et(m.reliableMarginLeft,(function(e,t){if(t)return(parseFloat(Qe(e,"marginLeft"))||e.getBoundingClientRect().left-Ke(e,{marginLeft:0},(function(){return e.getBoundingClientRect().left})))+"px"})),O.each({margin:"",padding:"",border:"Width"},(function(e,t){O.cssHooks[e+t]={expand:function(i){for(var n=0,r={},s="string"==typeof i?i.split(" "):[i];n<4;n++)r[e+ge[n]+t]=s[n]||s[n-2]||s[0];return r}},"margin"!==e&&(O.cssHooks[e+t].set=lt)})),O.fn.extend({css:function(e,t){return ee(this,(function(e,t,i){var n,r,s={},o=0;if(Array.isArray(t)){for(n=Je(e),r=t.length;o<r;o++)s[t[o]]=O.css(e,t[o],!1,n);return s}return void 0!==i?O.style(e,t,i):O.css(e,t)}),e,t,arguments.length>1)}}),O.Tween=dt,dt.prototype={constructor:dt,init:function(e,t,i,n,r,s){this.elem=e,this.prop=i,this.easing=r||O.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=n,this.unit=s||(O.cssNumber[i]?"":"px")},cur:function(){var e=dt.propHooks[this.prop];return e&&e.get?e.get(this):dt.propHooks._default.get(this)},run:function(e){var t,i=dt.propHooks[this.prop];return this.options.duration?this.pos=t=O.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):dt.propHooks._default.set(this),this}},dt.prototype.init.prototype=dt.prototype,dt.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=O.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){O.fx.step[e.prop]?O.fx.step[e.prop](e):1!==e.elem.nodeType||!O.cssHooks[e.prop]&&null==e.elem.style[rt(e.prop)]?e.elem[e.prop]=e.now:O.style(e.elem,e.prop,e.now+e.unit)}}},dt.propHooks.scrollTop=dt.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},O.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},O.fx=dt.prototype.init,O.fx.step={};var ct,pt,gt=/^(?:toggle|show|hide)$/,ft=/queueHooks$/;function mt(){pt&&(!1===y.hidden&&n.requestAnimationFrame?n.requestAnimationFrame(mt):n.setTimeout(mt,O.fx.interval),O.fx.tick())}function _t(){return n.setTimeout((function(){ct=void 0})),ct=Date.now()}function xt(e,t){var i,n=0,r={height:e};for(t=t?1:0;n<4;n+=2-t)r["margin"+(i=ge[n])]=r["padding"+i]=e;return t&&(r.opacity=r.width=e),r}function yt(e,t,i){for(var n,r=(wt.tweeners[t]||[]).concat(wt.tweeners["*"]),s=0,o=r.length;s<o;s++)if(n=r[s].call(i,t,e))return n}function wt(e,t,i){var n,r,s=0,o=wt.prefilters.length,a=O.Deferred().always((function(){delete l.elem})),l=function(){if(r)return!1;for(var t=ct||_t(),i=Math.max(0,u.startTime+u.duration-t),n=1-(i/u.duration||0),s=0,o=u.tweens.length;s<o;s++)u.tweens[s].run(n);return a.notifyWith(e,[u,n,i]),n<1&&o?i:(o||a.notifyWith(e,[u,1,0]),a.resolveWith(e,[u]),!1)},u=a.promise({elem:e,props:O.extend({},t),opts:O.extend(!0,{specialEasing:{},easing:O.easing._default},i),originalProperties:t,originalOptions:i,startTime:ct||_t(),duration:i.duration,tweens:[],createTween:function(t,i){var n=O.Tween(e,u.opts,t,i,u.opts.specialEasing[t]||u.opts.easing);return u.tweens.push(n),n},stop:function(t){var i=0,n=t?u.tweens.length:0;if(r)return this;for(r=!0;i<n;i++)u.tweens[i].run(1);return t?(a.notifyWith(e,[u,1,0]),a.resolveWith(e,[u,t])):a.rejectWith(e,[u,t]),this}}),h=u.props;for(function(e,t){var i,n,r,s,o;for(i in e)if(r=t[n=re(i)],s=e[i],Array.isArray(s)&&(r=s[1],s=e[i]=s[0]),i!==n&&(e[n]=s,delete e[i]),(o=O.cssHooks[n])&&"expand"in o)for(i in s=o.expand(s),delete e[n],s)i in e||(e[i]=s[i],t[i]=r);else t[n]=r}(h,u.opts.specialEasing);s<o;s++)if(n=wt.prefilters[s].call(u,e,h,u.opts))return _(n.stop)&&(O._queueHooks(u.elem,u.opts.queue).stop=n.stop.bind(n)),n;return O.map(h,yt,u),_(u.opts.start)&&u.opts.start.call(e,u),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always),O.fx.timer(O.extend(l,{elem:e,anim:u,queue:u.opts.queue})),u}O.Animation=O.extend(wt,{tweeners:{"*":[function(e,t){var i=this.createTween(e,t);return ye(i.elem,e,pe.exec(t),i),i}]},tweener:function(e,t){_(e)?(t=e,e=["*"]):e=e.match(Y);for(var i,n=0,r=e.length;n<r;n++)i=e[n],wt.tweeners[i]=wt.tweeners[i]||[],wt.tweeners[i].unshift(t)},prefilters:[function(e,t,i){var n,r,s,o,a,l,u,h,d="width"in t||"height"in t,c=this,p={},g=e.style,f=e.nodeType&&xe(e),m=ae.get(e,"fxshow");for(n in i.queue||(null==(o=O._queueHooks(e,"fx")).unqueued&&(o.unqueued=0,a=o.empty.fire,o.empty.fire=function(){o.unqueued||a()}),o.unqueued++,c.always((function(){c.always((function(){o.unqueued--,O.queue(e,"fx").length||o.empty.fire()}))}))),t)if(r=t[n],gt.test(r)){if(delete t[n],s=s||"toggle"===r,r===(f?"hide":"show")){if("show"!==r||!m||void 0===m[n])continue;f=!0}p[n]=m&&m[n]||O.style(e,n)}if((l=!O.isEmptyObject(t))||!O.isEmptyObject(p))for(n in d&&1===e.nodeType&&(i.overflow=[g.overflow,g.overflowX,g.overflowY],null==(u=m&&m.display)&&(u=ae.get(e,"display")),"none"===(h=O.css(e,"display"))&&(u?h=u:(Se([e],!0),u=e.style.display||u,h=O.css(e,"display"),Se([e]))),("inline"===h||"inline-block"===h&&null!=u)&&"none"===O.css(e,"float")&&(l||(c.done((function(){g.display=u})),null==u&&(h=g.display,u="none"===h?"":h)),g.display="inline-block")),i.overflow&&(g.overflow="hidden",c.always((function(){g.overflow=i.overflow[0],g.overflowX=i.overflow[1],g.overflowY=i.overflow[2]}))),l=!1,p)l||(m?"hidden"in m&&(f=m.hidden):m=ae.access(e,"fxshow",{display:u}),s&&(m.hidden=!f),f&&Se([e],!0),c.done((function(){for(n in f||Se([e]),ae.remove(e,"fxshow"),p)O.style(e,n,p[n])}))),l=yt(f?m[n]:0,n,c),n in m||(m[n]=l.start,f&&(l.end=l.start,l.start=0))}],prefilter:function(e,t){t?wt.prefilters.unshift(e):wt.prefilters.push(e)}}),O.speed=function(e,t,i){var n=e&&"object"==typeof e?O.extend({},e):{complete:i||!i&&t||_(e)&&e,duration:e,easing:i&&t||t&&!_(t)&&t};return O.fx.off?n.duration=0:"number"!=typeof n.duration&&(n.duration in O.fx.speeds?n.duration=O.fx.speeds[n.duration]:n.duration=O.fx.speeds._default),null!=n.queue&&!0!==n.queue||(n.queue="fx"),n.old=n.complete,n.complete=function(){_(n.old)&&n.old.call(this),n.queue&&O.dequeue(this,n.queue)},n},O.fn.extend({fadeTo:function(e,t,i,n){return this.filter(xe).css("opacity",0).show().end().animate({opacity:t},e,i,n)},animate:function(e,t,i,n){var r=O.isEmptyObject(e),s=O.speed(t,i,n),o=function(){var t=wt(this,O.extend({},e),s);(r||ae.get(this,"finish"))&&t.stop(!0)};return o.finish=o,r||!1===s.queue?this.each(o):this.queue(s.queue,o)},stop:function(e,t,i){var n=function(e){var t=e.stop;delete e.stop,t(i)};return"string"!=typeof e&&(i=t,t=e,e=void 0),t&&this.queue(e||"fx",[]),this.each((function(){var t=!0,r=null!=e&&e+"queueHooks",s=O.timers,o=ae.get(this);if(r)o[r]&&o[r].stop&&n(o[r]);else for(r in o)o[r]&&o[r].stop&&ft.test(r)&&n(o[r]);for(r=s.length;r--;)s[r].elem!==this||null!=e&&s[r].queue!==e||(s[r].anim.stop(i),t=!1,s.splice(r,1));!t&&i||O.dequeue(this,e)}))},finish:function(e){return!1!==e&&(e=e||"fx"),this.each((function(){var t,i=ae.get(this),n=i[e+"queue"],r=i[e+"queueHooks"],s=O.timers,o=n?n.length:0;for(i.finish=!0,O.queue(this,e,[]),r&&r.stop&&r.stop.call(this,!0),t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;t<o;t++)n[t]&&n[t].finish&&n[t].finish.call(this);delete i.finish}))}}),O.each(["toggle","show","hide"],(function(e,t){var i=O.fn[t];O.fn[t]=function(e,n,r){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(xt(t,!0),e,n,r)}})),O.each({slideDown:xt("show"),slideUp:xt("hide"),slideToggle:xt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(e,t){O.fn[e]=function(e,i,n){return this.animate(t,e,i,n)}})),O.timers=[],O.fx.tick=function(){var e,t=0,i=O.timers;for(ct=Date.now();t<i.length;t++)(e=i[t])()||i[t]!==e||i.splice(t--,1);i.length||O.fx.stop(),ct=void 0},O.fx.timer=function(e){O.timers.push(e),O.fx.start()},O.fx.interval=13,O.fx.start=function(){pt||(pt=!0,mt())},O.fx.stop=function(){pt=null},O.fx.speeds={slow:600,fast:200,_default:400},O.fn.delay=function(e,t){return e=O.fx&&O.fx.speeds[e]||e,t=t||"fx",this.queue(t,(function(t,i){var r=n.setTimeout(t,e);i.stop=function(){n.clearTimeout(r)}}))},function(){var e=y.createElement("input"),t=y.createElement("select").appendChild(y.createElement("option"));e.type="checkbox",m.checkOn=""!==e.value,m.optSelected=t.selected,(e=y.createElement("input")).value="t",e.type="radio",m.radioValue="t"===e.value}();var bt,St=O.expr.attrHandle;O.fn.extend({attr:function(e,t){return ee(this,O.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each((function(){O.removeAttr(this,e)}))}}),O.extend({attr:function(e,t,i){var n,r,s=e.nodeType;if(3!==s&&8!==s&&2!==s)return void 0===e.getAttribute?O.prop(e,t,i):(1===s&&O.isXMLDoc(e)||(r=O.attrHooks[t.toLowerCase()]||(O.expr.match.bool.test(t)?bt:void 0)),void 0!==i?null===i?void O.removeAttr(e,t):r&&"set"in r&&void 0!==(n=r.set(e,i,t))?n:(e.setAttribute(t,i+""),i):r&&"get"in r&&null!==(n=r.get(e,t))?n:null==(n=O.find.attr(e,t))?void 0:n)},attrHooks:{type:{set:function(e,t){if(!m.radioValue&&"radio"===t&&C(e,"input")){var i=e.value;return e.setAttribute("type",t),i&&(e.value=i),t}}}},removeAttr:function(e,t){var i,n=0,r=t&&t.match(Y);if(r&&1===e.nodeType)for(;i=r[n++];)e.removeAttribute(i)}}),bt={set:function(e,t,i){return!1===t?O.removeAttr(e,i):e.setAttribute(i,i),i}},O.each(O.expr.match.bool.source.match(/\w+/g),(function(e,t){var i=St[t]||O.find.attr;St[t]=function(e,t,n){var r,s,o=t.toLowerCase();return n||(s=St[o],St[o]=r,r=null!=i(e,t,n)?o:null,St[o]=s),r}}));var Tt=/^(?:input|select|textarea|button)$/i,vt=/^(?:a|area)$/i;function Ot(e){return(e.match(Y)||[]).join(" ")}function Et(e){return e.getAttribute&&e.getAttribute("class")||""}function Ct(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(Y)||[]}O.fn.extend({prop:function(e,t){return ee(this,O.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each((function(){delete this[O.propFix[e]||e]}))}}),O.extend({prop:function(e,t,i){var n,r,s=e.nodeType;if(3!==s&&8!==s&&2!==s)return 1===s&&O.isXMLDoc(e)||(t=O.propFix[t]||t,r=O.propHooks[t]),void 0!==i?r&&"set"in r&&void 0!==(n=r.set(e,i,t))?n:e[t]=i:r&&"get"in r&&null!==(n=r.get(e,t))?n:e[t]},propHooks:{tabIndex:{get:function(e){var t=O.find.attr(e,"tabindex");return t?parseInt(t,10):Tt.test(e.nodeName)||vt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),m.optSelected||(O.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),O.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){O.propFix[this.toLowerCase()]=this})),O.fn.extend({addClass:function(e){var t,i,n,r,s,o;return _(e)?this.each((function(t){O(this).addClass(e.call(this,t,Et(this)))})):(t=Ct(e)).length?this.each((function(){if(n=Et(this),i=1===this.nodeType&&" "+Ot(n)+" "){for(s=0;s<t.length;s++)r=t[s],i.indexOf(" "+r+" ")<0&&(i+=r+" ");o=Ot(i),n!==o&&this.setAttribute("class",o)}})):this},removeClass:function(e){var t,i,n,r,s,o;return _(e)?this.each((function(t){O(this).removeClass(e.call(this,t,Et(this)))})):arguments.length?(t=Ct(e)).length?this.each((function(){if(n=Et(this),i=1===this.nodeType&&" "+Ot(n)+" "){for(s=0;s<t.length;s++)for(r=t[s];i.indexOf(" "+r+" ")>-1;)i=i.replace(" "+r+" "," ");o=Ot(i),n!==o&&this.setAttribute("class",o)}})):this:this.attr("class","")},toggleClass:function(e,t){var i,n,r,s,o=typeof e,a="string"===o||Array.isArray(e);return _(e)?this.each((function(i){O(this).toggleClass(e.call(this,i,Et(this),t),t)})):"boolean"==typeof t&&a?t?this.addClass(e):this.removeClass(e):(i=Ct(e),this.each((function(){if(a)for(s=O(this),r=0;r<i.length;r++)n=i[r],s.hasClass(n)?s.removeClass(n):s.addClass(n);else void 0!==e&&"boolean"!==o||((n=Et(this))&&ae.set(this,"__className__",n),this.setAttribute&&this.setAttribute("class",n||!1===e?"":ae.get(this,"__className__")||""))})))},hasClass:function(e){var t,i,n=0;for(t=" "+e+" ";i=this[n++];)if(1===i.nodeType&&(" "+Ot(Et(i))+" ").indexOf(t)>-1)return!0;return!1}});var Nt=/\r/g;O.fn.extend({val:function(e){var t,i,n,r=this[0];return arguments.length?(n=_(e),this.each((function(i){var r;1===this.nodeType&&(null==(r=n?e.call(this,i,O(this).val()):e)?r="":"number"==typeof r?r+="":Array.isArray(r)&&(r=O.map(r,(function(e){return null==e?"":e+""}))),(t=O.valHooks[this.type]||O.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,r,"value")||(this.value=r))}))):r?(t=O.valHooks[r.type]||O.valHooks[r.nodeName.toLowerCase()])&&"get"in t&&void 0!==(i=t.get(r,"value"))?i:"string"==typeof(i=r.value)?i.replace(Nt,""):null==i?"":i:void 0}}),O.extend({valHooks:{option:{get:function(e){var t=O.find.attr(e,"value");return null!=t?t:Ot(O.text(e))}},select:{get:function(e){var t,i,n,r=e.options,s=e.selectedIndex,o="select-one"===e.type,a=o?null:[],l=o?s+1:r.length;for(n=s<0?l:o?s:0;n<l;n++)if(((i=r[n]).selected||n===s)&&!i.disabled&&(!i.parentNode.disabled||!C(i.parentNode,"optgroup"))){if(t=O(i).val(),o)return t;a.push(t)}return a},set:function(e,t){for(var i,n,r=e.options,s=O.makeArray(t),o=r.length;o--;)((n=r[o]).selected=O.inArray(O.valHooks.option.get(n),s)>-1)&&(i=!0);return i||(e.selectedIndex=-1),s}}}}),O.each(["radio","checkbox"],(function(){O.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=O.inArray(O(e).val(),t)>-1}},m.checkOn||(O.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}));var It=n.location,Ft={guid:Date.now()},Mt=/\?/;O.parseXML=function(e){var t,i;if(!e||"string"!=typeof e)return null;try{t=(new n.DOMParser).parseFromString(e,"text/xml")}catch(e){}return i=t&&t.getElementsByTagName("parsererror")[0],t&&!i||O.error("Invalid XML: "+(i?O.map(i.childNodes,(function(e){return e.textContent})).join("\n"):e)),t};var Dt=/^(?:focusinfocus|focusoutblur)$/,Rt=function(e){e.stopPropagation()};O.extend(O.event,{trigger:function(e,t,i,r){var s,o,a,l,u,h,d,c,g=[i||y],f=p.call(e,"type")?e.type:e,m=p.call(e,"namespace")?e.namespace.split("."):[];if(o=c=a=i=i||y,3!==i.nodeType&&8!==i.nodeType&&!Dt.test(f+O.event.triggered)&&(f.indexOf(".")>-1&&(m=f.split("."),f=m.shift(),m.sort()),u=f.indexOf(":")<0&&"on"+f,(e=e[O.expando]?e:new O.Event(f,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=m.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=i),t=null==t?[e]:O.makeArray(t,[e]),d=O.event.special[f]||{},r||!d.trigger||!1!==d.trigger.apply(i,t))){if(!r&&!d.noBubble&&!x(i)){for(l=d.delegateType||f,Dt.test(l+f)||(o=o.parentNode);o;o=o.parentNode)g.push(o),a=o;a===(i.ownerDocument||y)&&g.push(a.defaultView||a.parentWindow||n)}for(s=0;(o=g[s++])&&!e.isPropagationStopped();)c=o,e.type=s>1?l:d.bindType||f,(h=(ae.get(o,"events")||Object.create(null))[e.type]&&ae.get(o,"handle"))&&h.apply(o,t),(h=u&&o[u])&&h.apply&&se(o)&&(e.result=h.apply(o,t),!1===e.result&&e.preventDefault());return e.type=f,r||e.isDefaultPrevented()||d._default&&!1!==d._default.apply(g.pop(),t)||!se(i)||u&&_(i[f])&&!x(i)&&((a=i[u])&&(i[u]=null),O.event.triggered=f,e.isPropagationStopped()&&c.addEventListener(f,Rt),i[f](),e.isPropagationStopped()&&c.removeEventListener(f,Rt),O.event.triggered=void 0,a&&(i[u]=a)),e.result}},simulate:function(e,t,i){var n=O.extend(new O.Event,i,{type:e,isSimulated:!0});O.event.trigger(n,null,t)}}),O.fn.extend({trigger:function(e,t){return this.each((function(){O.event.trigger(e,t,this)}))},triggerHandler:function(e,t){var i=this[0];if(i)return O.event.trigger(e,t,i,!0)}});var Pt=/\[\]$/,At=/\r?\n/g,Vt=/^(?:submit|button|image|reset|file)$/i,Lt=/^(?:input|select|textarea|keygen)/i;function Bt(e,t,i,n){var r;if(Array.isArray(t))O.each(t,(function(t,r){i||Pt.test(e)?n(e,r):Bt(e+"["+("object"==typeof r&&null!=r?t:"")+"]",r,i,n)}));else if(i||"object"!==S(t))n(e,t);else for(r in t)Bt(e+"["+r+"]",t[r],i,n)}O.param=function(e,t){var i,n=[],r=function(e,t){var i=_(t)?t():t;n[n.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==i?"":i)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!O.isPlainObject(e))O.each(e,(function(){r(this.name,this.value)}));else for(i in e)Bt(i,e[i],t,r);return n.join("&")},O.fn.extend({serialize:function(){return O.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var e=O.prop(this,"elements");return e?O.makeArray(e):this})).filter((function(){var e=this.type;return this.name&&!O(this).is(":disabled")&&Lt.test(this.nodeName)&&!Vt.test(e)&&(this.checked||!Oe.test(e))})).map((function(e,t){var i=O(this).val();return null==i?null:Array.isArray(i)?O.map(i,(function(e){return{name:t.name,value:e.replace(At,"\r\n")}})):{name:t.name,value:i.replace(At,"\r\n")}})).get()}});var Ut=/%20/g,Xt=/#.*$/,jt=/([?&])_=[^&]*/,kt=/^(.*?):[ \t]*([^\r\n]*)$/gm,zt=/^(?:GET|HEAD)$/,Gt=/^\/\//,Ht={},qt={},Yt="*/".concat("*"),Wt=y.createElement("a");function $t(e){return function(t,i){"string"!=typeof t&&(i=t,t="*");var n,r=0,s=t.toLowerCase().match(Y)||[];if(_(i))for(;n=s[r++];)"+"===n[0]?(n=n.slice(1)||"*",(e[n]=e[n]||[]).unshift(i)):(e[n]=e[n]||[]).push(i)}}function Jt(e,t,i,n){var r={},s=e===qt;function o(a){var l;return r[a]=!0,O.each(e[a]||[],(function(e,a){var u=a(t,i,n);return"string"!=typeof u||s||r[u]?s?!(l=u):void 0:(t.dataTypes.unshift(u),o(u),!1)})),l}return o(t.dataTypes[0])||!r["*"]&&o("*")}function Kt(e,t){var i,n,r=O.ajaxSettings.flatOptions||{};for(i in t)void 0!==t[i]&&((r[i]?e:n||(n={}))[i]=t[i]);return n&&O.extend(!0,e,n),e}Wt.href=It.href,O.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:It.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(It.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Yt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":O.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Kt(Kt(e,O.ajaxSettings),t):Kt(O.ajaxSettings,e)},ajaxPrefilter:$t(Ht),ajaxTransport:$t(qt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var i,r,s,o,a,l,u,h,d,c,p=O.ajaxSetup({},t),g=p.context||p,f=p.context&&(g.nodeType||g.jquery)?O(g):O.event,m=O.Deferred(),_=O.Callbacks("once memory"),x=p.statusCode||{},w={},b={},S="canceled",T={readyState:0,getResponseHeader:function(e){var t;if(u){if(!o)for(o={};t=kt.exec(s);)o[t[1].toLowerCase()+" "]=(o[t[1].toLowerCase()+" "]||[]).concat(t[2]);t=o[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return u?s:null},setRequestHeader:function(e,t){return null==u&&(e=b[e.toLowerCase()]=b[e.toLowerCase()]||e,w[e]=t),this},overrideMimeType:function(e){return null==u&&(p.mimeType=e),this},statusCode:function(e){var t;if(e)if(u)T.always(e[T.status]);else for(t in e)x[t]=[x[t],e[t]];return this},abort:function(e){var t=e||S;return i&&i.abort(t),v(0,t),this}};if(m.promise(T),p.url=((e||p.url||It.href)+"").replace(Gt,It.protocol+"//"),p.type=t.method||t.type||p.method||p.type,p.dataTypes=(p.dataType||"*").toLowerCase().match(Y)||[""],null==p.crossDomain){l=y.createElement("a");try{l.href=p.url,l.href=l.href,p.crossDomain=Wt.protocol+"//"+Wt.host!=l.protocol+"//"+l.host}catch(e){p.crossDomain=!0}}if(p.data&&p.processData&&"string"!=typeof p.data&&(p.data=O.param(p.data,p.traditional)),Jt(Ht,p,t,T),u)return T;for(d in(h=O.event&&p.global)&&0==O.active++&&O.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!zt.test(p.type),r=p.url.replace(Xt,""),p.hasContent?p.data&&p.processData&&0===(p.contentType||"").indexOf("application/x-www-form-urlencoded")&&(p.data=p.data.replace(Ut,"+")):(c=p.url.slice(r.length),p.data&&(p.processData||"string"==typeof p.data)&&(r+=(Mt.test(r)?"&":"?")+p.data,delete p.data),!1===p.cache&&(r=r.replace(jt,"$1"),c=(Mt.test(r)?"&":"?")+"_="+Ft.guid+++c),p.url=r+c),p.ifModified&&(O.lastModified[r]&&T.setRequestHeader("If-Modified-Since",O.lastModified[r]),O.etag[r]&&T.setRequestHeader("If-None-Match",O.etag[r])),(p.data&&p.hasContent&&!1!==p.contentType||t.contentType)&&T.setRequestHeader("Content-Type",p.contentType),T.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Yt+"; q=0.01":""):p.accepts["*"]),p.headers)T.setRequestHeader(d,p.headers[d]);if(p.beforeSend&&(!1===p.beforeSend.call(g,T,p)||u))return T.abort();if(S="abort",_.add(p.complete),T.done(p.success),T.fail(p.error),i=Jt(qt,p,t,T)){if(T.readyState=1,h&&f.trigger("ajaxSend",[T,p]),u)return T;p.async&&p.timeout>0&&(a=n.setTimeout((function(){T.abort("timeout")}),p.timeout));try{u=!1,i.send(w,v)}catch(e){if(u)throw e;v(-1,e)}}else v(-1,"No Transport");function v(e,t,o,l){var d,c,y,w,b,S=t;u||(u=!0,a&&n.clearTimeout(a),i=void 0,s=l||"",T.readyState=e>0?4:0,d=e>=200&&e<300||304===e,o&&(w=function(e,t,i){for(var n,r,s,o,a=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===n&&(n=e.mimeType||t.getResponseHeader("Content-Type"));if(n)for(r in a)if(a[r]&&a[r].test(n)){l.unshift(r);break}if(l[0]in i)s=l[0];else{for(r in i){if(!l[0]||e.converters[r+" "+l[0]]){s=r;break}o||(o=r)}s=s||o}if(s)return s!==l[0]&&l.unshift(s),i[s]}(p,T,o)),!d&&O.inArray("script",p.dataTypes)>-1&&O.inArray("json",p.dataTypes)<0&&(p.converters["text script"]=function(){}),w=function(e,t,i,n){var r,s,o,a,l,u={},h=e.dataTypes.slice();if(h[1])for(o in e.converters)u[o.toLowerCase()]=e.converters[o];for(s=h.shift();s;)if(e.responseFields[s]&&(i[e.responseFields[s]]=t),!l&&n&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=s,s=h.shift())if("*"===s)s=l;else if("*"!==l&&l!==s){if(!(o=u[l+" "+s]||u["* "+s]))for(r in u)if((a=r.split(" "))[1]===s&&(o=u[l+" "+a[0]]||u["* "+a[0]])){!0===o?o=u[r]:!0!==u[r]&&(s=a[0],h.unshift(a[1]));break}if(!0!==o)if(o&&e.throws)t=o(t);else try{t=o(t)}catch(e){return{state:"parsererror",error:o?e:"No conversion from "+l+" to "+s}}}return{state:"success",data:t}}(p,w,T,d),d?(p.ifModified&&((b=T.getResponseHeader("Last-Modified"))&&(O.lastModified[r]=b),(b=T.getResponseHeader("etag"))&&(O.etag[r]=b)),204===e||"HEAD"===p.type?S="nocontent":304===e?S="notmodified":(S=w.state,c=w.data,d=!(y=w.error))):(y=S,!e&&S||(S="error",e<0&&(e=0))),T.status=e,T.statusText=(t||S)+"",d?m.resolveWith(g,[c,S,T]):m.rejectWith(g,[T,S,y]),T.statusCode(x),x=void 0,h&&f.trigger(d?"ajaxSuccess":"ajaxError",[T,p,d?c:y]),_.fireWith(g,[T,S]),h&&(f.trigger("ajaxComplete",[T,p]),--O.active||O.event.trigger("ajaxStop")))}return T},getJSON:function(e,t,i){return O.get(e,t,i,"json")},getScript:function(e,t){return O.get(e,void 0,t,"script")}}),O.each(["get","post"],(function(e,t){O[t]=function(e,i,n,r){return _(i)&&(r=r||n,n=i,i=void 0),O.ajax(O.extend({url:e,type:t,dataType:r,data:i,success:n},O.isPlainObject(e)&&e))}})),O.ajaxPrefilter((function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")})),O._evalUrl=function(e,t,i){return O.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){O.globalEval(e,t,i)}})},O.fn.extend({wrapAll:function(e){var t;return this[0]&&(_(e)&&(e=e.call(this[0])),t=O(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map((function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e})).append(this)),this},wrapInner:function(e){return _(e)?this.each((function(t){O(this).wrapInner(e.call(this,t))})):this.each((function(){var t=O(this),i=t.contents();i.length?i.wrapAll(e):t.append(e)}))},wrap:function(e){var t=_(e);return this.each((function(i){O(this).wrapAll(t?e.call(this,i):e)}))},unwrap:function(e){return this.parent(e).not("body").each((function(){O(this).replaceWith(this.childNodes)})),this}}),O.expr.pseudos.hidden=function(e){return!O.expr.pseudos.visible(e)},O.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},O.ajaxSettings.xhr=function(){try{return new n.XMLHttpRequest}catch(e){}};var Zt={0:200,1223:204},Qt=O.ajaxSettings.xhr();m.cors=!!Qt&&"withCredentials"in Qt,m.ajax=Qt=!!Qt,O.ajaxTransport((function(e){var t,i;if(m.cors||Qt&&!e.crossDomain)return{send:function(r,s){var o,a=e.xhr();if(a.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(o in e.xhrFields)a[o]=e.xhrFields[o];for(o in e.mimeType&&a.overrideMimeType&&a.overrideMimeType(e.mimeType),e.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest"),r)a.setRequestHeader(o,r[o]);t=function(e){return function(){t&&(t=i=a.onload=a.onerror=a.onabort=a.ontimeout=a.onreadystatechange=null,"abort"===e?a.abort():"error"===e?"number"!=typeof a.status?s(0,"error"):s(a.status,a.statusText):s(Zt[a.status]||a.status,a.statusText,"text"!==(a.responseType||"text")||"string"!=typeof a.responseText?{binary:a.response}:{text:a.responseText},a.getAllResponseHeaders()))}},a.onload=t(),i=a.onerror=a.ontimeout=t("error"),void 0!==a.onabort?a.onabort=i:a.onreadystatechange=function(){4===a.readyState&&n.setTimeout((function(){t&&i()}))},t=t("abort");try{a.send(e.hasContent&&e.data||null)}catch(e){if(t)throw e}},abort:function(){t&&t()}}})),O.ajaxPrefilter((function(e){e.crossDomain&&(e.contents.script=!1)})),O.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return O.globalEval(e),e}}}),O.ajaxPrefilter("script",(function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")})),O.ajaxTransport("script",(function(e){var t,i;if(e.crossDomain||e.scriptAttrs)return{send:function(n,r){t=O("<script>").attr(e.scriptAttrs||{}).prop({charset:e.scriptCharset,src:e.url}).on("load error",i=function(e){t.remove(),i=null,e&&r("error"===e.type?404:200,e.type)}),y.head.appendChild(t[0])},abort:function(){i&&i()}}}));var ei,ti=[],ii=/(=)\?(?=&|$)|\?\?/;O.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=ti.pop()||O.expando+"_"+Ft.guid++;return this[e]=!0,e}}),O.ajaxPrefilter("json jsonp",(function(e,t,i){var r,s,o,a=!1!==e.jsonp&&(ii.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&ii.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=_(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(ii,"$1"+r):!1!==e.jsonp&&(e.url+=(Mt.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return o||O.error(r+" was not called"),o[0]},e.dataTypes[0]="json",s=n[r],n[r]=function(){o=arguments},i.always((function(){void 0===s?O(n).removeProp(r):n[r]=s,e[r]&&(e.jsonpCallback=t.jsonpCallback,ti.push(r)),o&&_(s)&&s(o[0]),o=s=void 0})),"script"})),m.createHTMLDocument=((ei=y.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===ei.childNodes.length),O.parseHTML=function(e,t,i){return"string"!=typeof e?[]:("boolean"==typeof t&&(i=t,t=!1),t||(m.createHTMLDocument?((n=(t=y.implementation.createHTMLDocument("")).createElement("base")).href=y.location.href,t.head.appendChild(n)):t=y),s=!i&&[],(r=X.exec(e))?[t.createElement(r[1])]:(r=De([e],t,s),s&&s.length&&O(s).remove(),O.merge([],r.childNodes)));var n,r,s},O.fn.load=function(e,t,i){var n,r,s,o=this,a=e.indexOf(" ");return a>-1&&(n=Ot(e.slice(a)),e=e.slice(0,a)),_(t)?(i=t,t=void 0):t&&"object"==typeof t&&(r="POST"),o.length>0&&O.ajax({url:e,type:r||"GET",dataType:"html",data:t}).done((function(e){s=arguments,o.html(n?O("<div>").append(O.parseHTML(e)).find(n):e)})).always(i&&function(e,t){o.each((function(){i.apply(this,s||[e.responseText,t,e])}))}),this},O.expr.pseudos.animated=function(e){return O.grep(O.timers,(function(t){return e===t.elem})).length},O.offset={setOffset:function(e,t,i){var n,r,s,o,a,l,u=O.css(e,"position"),h=O(e),d={};"static"===u&&(e.style.position="relative"),a=h.offset(),s=O.css(e,"top"),l=O.css(e,"left"),("absolute"===u||"fixed"===u)&&(s+l).indexOf("auto")>-1?(o=(n=h.position()).top,r=n.left):(o=parseFloat(s)||0,r=parseFloat(l)||0),_(t)&&(t=t.call(e,i,O.extend({},a))),null!=t.top&&(d.top=t.top-a.top+o),null!=t.left&&(d.left=t.left-a.left+r),"using"in t?t.using.call(e,d):h.css(d)}},O.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each((function(t){O.offset.setOffset(this,e,t)}));var t,i,n=this[0];return n?n.getClientRects().length?(t=n.getBoundingClientRect(),i=n.ownerDocument.defaultView,{top:t.top+i.pageYOffset,left:t.left+i.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,i,n=this[0],r={top:0,left:0};if("fixed"===O.css(n,"position"))t=n.getBoundingClientRect();else{for(t=this.offset(),i=n.ownerDocument,e=n.offsetParent||i.documentElement;e&&(e===i.body||e===i.documentElement)&&"static"===O.css(e,"position");)e=e.parentNode;e&&e!==n&&1===e.nodeType&&((r=O(e).offset()).top+=O.css(e,"borderTopWidth",!0),r.left+=O.css(e,"borderLeftWidth",!0))}return{top:t.top-r.top-O.css(n,"marginTop",!0),left:t.left-r.left-O.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var e=this.offsetParent;e&&"static"===O.css(e,"position");)e=e.offsetParent;return e||fe}))}}),O.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(e,t){var i="pageYOffset"===t;O.fn[e]=function(n){return ee(this,(function(e,n,r){var s;if(x(e)?s=e:9===e.nodeType&&(s=e.defaultView),void 0===r)return s?s[t]:e[n];s?s.scrollTo(i?s.pageXOffset:r,i?r:s.pageYOffset):e[n]=r}),e,n,arguments.length)}})),O.each(["top","left"],(function(e,t){O.cssHooks[t]=et(m.pixelPosition,(function(e,i){if(i)return i=Qe(e,t),We.test(i)?O(e).position()[t]+"px":i}))})),O.each({Height:"height",Width:"width"},(function(e,t){O.each({padding:"inner"+e,content:t,"":"outer"+e},(function(i,n){O.fn[n]=function(r,s){var o=arguments.length&&(i||"boolean"!=typeof r),a=i||(!0===r||!0===s?"margin":"border");return ee(this,(function(t,i,r){var s;return x(t)?0===n.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(s=t.documentElement,Math.max(t.body["scroll"+e],s["scroll"+e],t.body["offset"+e],s["offset"+e],s["client"+e])):void 0===r?O.css(t,i,a):O.style(t,i,r,a)}),t,o?r:void 0,o)}}))})),O.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(e,t){O.fn[t]=function(e){return this.on(t,e)}})),O.fn.extend({bind:function(e,t,i){return this.on(e,null,t,i)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,i,n){return this.on(t,e,i,n)},undelegate:function(e,t,i){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",i)},hover:function(e,t){return this.on("mouseenter",e).on("mouseleave",t||e)}}),O.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(e,t){O.fn[t]=function(e,i){return arguments.length>0?this.on(t,null,e,i):this.trigger(t)}}));var ni=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;O.proxy=function(e,t){var i,n,r;if("string"==typeof t&&(i=e[t],t=e,e=i),_(e))return n=a.call(arguments,2),r=function(){return e.apply(t||this,n.concat(a.call(arguments)))},r.guid=e.guid=e.guid||O.guid++,r},O.holdReady=function(e){e?O.readyWait++:O.ready(!0)},O.isArray=Array.isArray,O.parseJSON=JSON.parse,O.nodeName=C,O.isFunction=_,O.isWindow=x,O.camelCase=re,O.type=S,O.now=Date.now,O.isNumeric=function(e){var t=O.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},O.trim=function(e){return null==e?"":(e+"").replace(ni,"$1")},void 0===(i=function(){return O}.apply(t,[]))||(e.exports=i);var ri=n.jQuery,si=n.$;return O.noConflict=function(e){return n.$===O&&(n.$=si),e&&n.jQuery===O&&(n.jQuery=ri),O},void 0===r&&(n.jQuery=n.$=O),O},"object"==typeof e.exports?e.exports=n.document?r(n,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return r(e)}:r(n)},981:e=>{var t={DEBUG:!1,assert:function(e,i){if(t.DEBUG&&!e)throw new Error("Assertion failed"+(i?": "+i:""))},GLU_TESS_MAX_COORD:1e150,TRUE_PROJECT:!1,GLU_TESS_DEFAULT_TOLERANCE:0,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111,GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,GLU_INVALID_VALUE:100901}};t.PQHandle,t.geom={},t.geom.vertEq=function(e,t){return e.s===t.s&&e.t===t.t},t.geom.vertLeq=function(e,t){return e.s<t.s||e.s===t.s&&e.t<=t.t},t.geom.edgeEval=function(e,t,i){var n=t.s-e.s,r=i.s-t.s;return n+r>0?n<r?t.t-e.t+(e.t-i.t)*(n/(n+r)):t.t-i.t+(i.t-e.t)*(r/(n+r)):0},t.geom.edgeSign=function(e,t,i){var n=t.s-e.s,r=i.s-t.s;return n+r>0?(t.t-i.t)*n+(t.t-e.t)*r:0},t.geom.transLeq=function(e,t){return e.t<t.t||e.t===t.t&&e.s<=t.s},t.geom.transEval=function(e,t,i){var n=t.t-e.t,r=i.t-t.t;return n+r>0?n<r?t.s-e.s+(e.s-i.s)*(n/(n+r)):t.s-i.s+(i.s-e.s)*(r/(n+r)):0},t.geom.transSign=function(e,t,i){var n=t.t-e.t,r=i.t-t.t;return n+r>0?(t.s-i.s)*n+(t.s-e.s)*r:0},t.geom.edgeGoesLeft=function(e){return t.geom.vertLeq(e.dst(),e.org)},t.geom.edgeGoesRight=function(e){return t.geom.vertLeq(e.org,e.dst())},t.geom.vertL1dist=function(e,t){return Math.abs(e.s-t.s)+Math.abs(e.t-t.t)},t.geom.vertCCW=function(e,t,i){return e.s*(t.t-i.t)+t.s*(i.t-e.t)+i.s*(e.t-t.t)>=0},t.geom.interpolate_=function(e,t,i,n){return(e=e<0?0:e)<=(i=i<0?0:i)?0===i?(t+n)/2:t+e/(e+i)*(n-t):n+i/(e+i)*(t-n)},t.geom.edgeIntersect=function(e,i,n,r,s){var o,a,l;t.geom.vertLeq(e,i)||(l=e,e=i,i=l),t.geom.vertLeq(n,r)||(l=n,n=r,r=l),t.geom.vertLeq(e,n)||(l=e,e=n,n=l,l=i,i=r,r=l),t.geom.vertLeq(n,i)?t.geom.vertLeq(i,r)?((o=t.geom.edgeEval(e,n,i))+(a=t.geom.edgeEval(n,i,r))<0&&(o=-o,a=-a),s.s=t.geom.interpolate_(o,n.s,a,i.s)):((o=t.geom.edgeSign(e,n,i))+(a=-t.geom.edgeSign(e,r,i))<0&&(o=-o,a=-a),s.s=t.geom.interpolate_(o,n.s,a,r.s)):s.s=(n.s+i.s)/2,t.geom.transLeq(e,i)||(l=e,e=i,i=l),t.geom.transLeq(n,r)||(l=n,n=r,r=l),t.geom.transLeq(e,n)||(l=e,e=n,n=l,l=i,i=r,r=l),t.geom.transLeq(n,i)?t.geom.transLeq(i,r)?((o=t.geom.transEval(e,n,i))+(a=t.geom.transEval(n,i,r))<0&&(o=-o,a=-a),s.t=t.geom.interpolate_(o,n.t,a,i.t)):((o=t.geom.transSign(e,n,i))+(a=-t.geom.transSign(e,r,i))<0&&(o=-o,a=-a),s.t=t.geom.interpolate_(o,n.t,a,r.t)):s.t=(n.t+i.t)/2},t.mesh={},t.mesh.makeEdge=function(e){var i=t.mesh.makeEdgePair_(e.eHead);return t.mesh.makeVertex_(i,e.vHead),t.mesh.makeVertex_(i.sym,e.vHead),t.mesh.makeFace_(i,e.fHead),i},t.mesh.meshSplice=function(e,i){var n=!1,r=!1;e!==i&&(i.org!==e.org&&(r=!0,t.mesh.killVertex_(i.org,e.org)),i.lFace!==e.lFace&&(n=!0,t.mesh.killFace_(i.lFace,e.lFace)),t.mesh.splice_(i,e),r||(t.mesh.makeVertex_(i,e.org),e.org.anEdge=e),n||(t.mesh.makeFace_(i,e.lFace),e.lFace.anEdge=e))},t.mesh.deleteEdge=function(e){var i=e.sym,n=!1;e.lFace!==e.rFace()&&(n=!0,t.mesh.killFace_(e.lFace,e.rFace())),e.oNext===e?t.mesh.killVertex_(e.org,null):(e.rFace().anEdge=e.oPrev(),e.org.anEdge=e.oNext,t.mesh.splice_(e,e.oPrev()),n||t.mesh.makeFace_(e,e.lFace)),i.oNext===i?(t.mesh.killVertex_(i.org,null),t.mesh.killFace_(i.lFace,null)):(e.lFace.anEdge=i.oPrev(),i.org.anEdge=i.oNext,t.mesh.splice_(i,i.oPrev())),t.mesh.killEdge_(e)},t.mesh.addEdgeVertex=function(e){var i=t.mesh.makeEdgePair_(e),n=i.sym;return t.mesh.splice_(i,e.lNext),i.org=e.dst(),t.mesh.makeVertex_(n,i.org),i.lFace=n.lFace=e.lFace,i},t.mesh.splitEdge=function(e){var i=t.mesh.addEdgeVertex(e).sym;return t.mesh.splice_(e.sym,e.sym.oPrev()),t.mesh.splice_(e.sym,i),e.sym.org=i.org,i.dst().anEdge=i.sym,i.sym.lFace=e.rFace(),i.winding=e.winding,i.sym.winding=e.sym.winding,i},t.mesh.connect=function(e,i){var n=!1,r=t.mesh.makeEdgePair_(e),s=r.sym;return i.lFace!==e.lFace&&(n=!0,t.mesh.killFace_(i.lFace,e.lFace)),t.mesh.splice_(r,e.lNext),t.mesh.splice_(s,i),r.org=e.dst(),s.org=i.org,r.lFace=s.lFace=e.lFace,e.lFace.anEdge=s,n||t.mesh.makeFace_(r,e.lFace),r},t.mesh.zapFace=function(e){var i,n=e.anEdge,r=n.lNext;do{if(r=(i=r).lNext,i.lFace=null,null===i.rFace()){i.oNext===i?t.mesh.killVertex_(i.org,null):(i.org.anEdge=i.oNext,t.mesh.splice_(i,i.oPrev()));var s=i.sym;s.oNext===s?t.mesh.killVertex_(s.org,null):(s.org.anEdge=s.oNext,t.mesh.splice_(s,s.oPrev())),t.mesh.killEdge_(i)}}while(i!==n);var o=e.prev,a=e.next;a.prev=o,o.next=a},t.mesh.meshUnion=function(e,t){var i=e.fHead,n=e.vHead,r=e.eHead,s=t.fHead,o=t.vHead,a=t.eHead;return s.next!==s&&(i.prev.next=s.next,s.next.prev=i.prev,s.prev.next=i,i.prev=s.prev),o.next!==o&&(n.prev.next=o.next,o.next.prev=n.prev,o.prev.next=n,n.prev=o.prev),a.next!==a&&(r.sym.next.sym.next=a.next,a.next.sym.next=r.sym.next,a.sym.next.sym.next=r,r.sym.next=a.sym.next),e},t.mesh.deleteMesh=function(e){},t.mesh.makeEdgePair_=function(e){var i=new t.GluHalfEdge,n=new t.GluHalfEdge,r=e.sym.next;return n.next=r,r.sym.next=i,i.next=e,e.sym.next=n,i.sym=n,i.oNext=i,i.lNext=n,n.sym=i,n.oNext=n,n.lNext=i,i},t.mesh.splice_=function(e,t){var i=e.oNext,n=t.oNext;i.sym.lNext=t,n.sym.lNext=e,e.oNext=n,t.oNext=i},t.mesh.makeVertex_=function(e,i){var n=i.prev,r=new t.GluVertex(i,n);n.next=r,i.prev=r,r.anEdge=e;var s=e;do{s.org=r,s=s.oNext}while(s!==e)},t.mesh.makeFace_=function(e,i){var n=i.prev,r=new t.GluFace(i,n);n.next=r,i.prev=r,r.anEdge=e,r.inside=i.inside;var s=e;do{s.lFace=r,s=s.lNext}while(s!==e)},t.mesh.killEdge_=function(e){var t=e.next,i=e.sym.next;t.sym.next=i,i.sym.next=t},t.mesh.killVertex_=function(e,t){var i=e.anEdge,n=i;do{n.org=t,n=n.oNext}while(n!==i);var r=e.prev,s=e.next;s.prev=r,r.next=s},t.mesh.killFace_=function(e,t){var i=e.anEdge,n=i;do{n.lFace=t,n=n.lNext}while(n!==i);var r=e.prev,s=e.next;s.prev=r,r.next=s},t.normal={},t.normal.S_UNIT_X_=1,t.normal.S_UNIT_Y_=0,t.normal.projectPolygon=function(e,i,n,r){var s=!1,o=[i,n,r];0===i&&0===n&&0===r&&(t.normal.computeNormal_(e,o),s=!0);var a,l=t.normal.longAxis_(o),u=e.mesh.vHead;if(t.TRUE_PROJECT){t.normal.normalize_(o);var h=[0,0,0],d=[0,0,0];h[l]=0,h[(l+1)%3]=t.normal.S_UNIT_X_,h[(l+2)%3]=t.normal.S_UNIT_Y_;var c=t.normal.dot_(h,o);for(h[0]-=c*o[0],h[1]-=c*o[1],h[2]-=c*o[2],t.normal.normalize_(h),d[0]=o[1]*h[2]-o[2]*h[1],d[1]=o[2]*h[0]-o[0]*h[2],d[2]=o[0]*h[1]-o[1]*h[0],t.normal.normalize_(d),a=u.next;a!==u;a=a.next)a.s=t.normal.dot_(a.coords,h),a.t=t.normal.dot_(a.coords,d)}else{var p=(l+1)%3,g=(l+2)%3,f=o[l]>0?1:-1;for(a=u.next;a!==u;a=a.next)a.s=a.coords[p],a.t=f*a.coords[g]}s&&t.normal.checkOrientation_(e)},t.normal.dot_=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},t.normal.normalize_=function(e){var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];t=Math.sqrt(t),e[0]/=t,e[1]/=t,e[2]/=t},t.normal.longAxis_=function(e){var t=0;return Math.abs(e[1])>Math.abs(e[0])&&(t=1),Math.abs(e[2])>Math.abs(e[t])&&(t=2),t},t.normal.computeNormal_=function(e,i){var n,r=[-2*t.GLU_TESS_MAX_COORD,-2*t.GLU_TESS_MAX_COORD,-2*t.GLU_TESS_MAX_COORD],s=[2*t.GLU_TESS_MAX_COORD,2*t.GLU_TESS_MAX_COORD,2*t.GLU_TESS_MAX_COORD],o=[],a=[],l=e.mesh.vHead;for(n=l.next;n!==l;n=n.next)for(var u=0;u<3;++u){var h=n.coords[u];h<s[u]&&(s[u]=h,a[u]=n),h>r[u]&&(r[u]=h,o[u]=n)}var d=0;if(r[1]-s[1]>r[0]-s[0]&&(d=1),r[2]-s[2]>r[d]-s[d]&&(d=2),s[d]>=r[d])return i[0]=0,i[1]=0,void(i[2]=1);var c=0,p=a[d],g=o[d],f=[0,0,0],m=[p.coords[0]-g.coords[0],p.coords[1]-g.coords[1],p.coords[2]-g.coords[2]],_=[0,0,0];for(n=l.next;n!==l;n=n.next){_[0]=n.coords[0]-g.coords[0],_[1]=n.coords[1]-g.coords[1],_[2]=n.coords[2]-g.coords[2],f[0]=m[1]*_[2]-m[2]*_[1],f[1]=m[2]*_[0]-m[0]*_[2],f[2]=m[0]*_[1]-m[1]*_[0];var x=f[0]*f[0]+f[1]*f[1]+f[2]*f[2];x>c&&(c=x,i[0]=f[0],i[1]=f[1],i[2]=f[2])}c<=0&&(i[0]=i[1]=i[2]=0,i[t.normal.longAxis_(m)]=1)},t.normal.checkOrientation_=function(e){for(var t=0,i=e.mesh.fHead,n=i.next;n!==i;n=n.next){var r=n.anEdge;if(!(r.winding<=0))do{t+=(r.org.s-r.dst().s)*(r.org.t+r.dst().t),r=r.lNext}while(r!==n.anEdge)}if(t<0)for(var s=e.mesh.vHead,o=s.next;o!==s;o=o.next)o.t=-o.t},t.render={},t.render.renderMesh=function(e,i,n){for(var r=!1,s=-1,o=i.fHead.prev;o!==i.fHead;o=o.prev)if(o.inside){r||(e.callBeginCallback(t.primitiveType.GL_TRIANGLES),r=!0);var a=o.anEdge;do{if(n){var l=a.rFace().inside?0:1;s!==l&&(s=l,e.callEdgeFlagCallback(!!s))}e.callVertexCallback(a.org.data),a=a.lNext}while(a!==o.anEdge)}r&&e.callEndCallback()},t.render.renderBoundary=function(e,i){for(var n=i.fHead.next;n!==i.fHead;n=n.next)if(n.inside){e.callBeginCallback(t.primitiveType.GL_LINE_LOOP);var r=n.anEdge;do{e.callVertexCallback(r.org.data),r=r.lNext}while(r!==n.anEdge);e.callEndCallback()}},t.sweep={},t.sweep.SENTINEL_COORD_=4*t.GLU_TESS_MAX_COORD,t.sweep.TOLERANCE_NONZERO_=!1,t.sweep.computeInterior=function(e){var i;for(e.fatalError=!1,t.sweep.removeDegenerateEdges_(e),t.sweep.initPriorityQ_(e),t.sweep.initEdgeDict_(e);null!==(i=e.pq.extractMin());){for(;;){var n=e.pq.minimum();if(null===n||!t.geom.vertEq(n,i))break;n=e.pq.extractMin(),t.sweep.spliceMergeVertices_(e,i.anEdge,n.anEdge)}t.sweep.sweepEvent_(e,i)}var r=e.dict.getMin().getKey();e.event=r.eUp.org,t.sweep.doneEdgeDict_(e),t.sweep.donePriorityQ_(e),t.sweep.removeDegenerateFaces_(e.mesh),e.mesh.checkMesh()},t.sweep.addWinding_=function(e,t){e.winding+=t.winding,e.sym.winding+=t.sym.winding},t.sweep.edgeLeq_=function(e,i,n){var r=e.event,s=i.eUp,o=n.eUp;return s.dst()===r?o.dst()===r?t.geom.vertLeq(s.org,o.org)?t.geom.edgeSign(o.dst(),s.org,o.org)<=0:t.geom.edgeSign(s.dst(),o.org,s.org)>=0:t.geom.edgeSign(o.dst(),r,o.org)<=0:o.dst()===r?t.geom.edgeSign(s.dst(),r,s.org)>=0:t.geom.edgeEval(s.dst(),r,s.org)>=t.geom.edgeEval(o.dst(),r,o.org)},t.sweep.deleteRegion_=function(e,t){t.fixUpperEdge,t.eUp.activeRegion=null,e.dict.deleteNode(t.nodeUp),t.nodeUp=null},t.sweep.fixUpperEdge_=function(e,i){t.mesh.deleteEdge(e.eUp),e.fixUpperEdge=!1,e.eUp=i,i.activeRegion=e},t.sweep.topLeftRegion_=function(e){var i=e.eUp.org;do{e=e.regionAbove()}while(e.eUp.org===i);if(e.fixUpperEdge){var n=t.mesh.connect(e.regionBelow().eUp.sym,e.eUp.lNext);t.sweep.fixUpperEdge_(e,n),e=e.regionAbove()}return e},t.sweep.topRightRegion_=function(e){var t=e.eUp.dst();do{e=e.regionAbove()}while(e.eUp.dst()===t);return e},t.sweep.addRegionBelow_=function(e,i,n){var r=new t.ActiveRegion;return r.eUp=n,r.nodeUp=e.dict.insertBefore(i.nodeUp,r),n.activeRegion=r,r},t.sweep.isWindingInside_=function(e,i){switch(e.windingRule){case t.windingRule.GLU_TESS_WINDING_ODD:return 0!=(1&i);case t.windingRule.GLU_TESS_WINDING_NONZERO:return 0!==i;case t.windingRule.GLU_TESS_WINDING_POSITIVE:return i>0;case t.windingRule.GLU_TESS_WINDING_NEGATIVE:return i<0;case t.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return i>=2||i<=-2}return!1},t.sweep.computeWinding_=function(e,i){i.windingNumber=i.regionAbove().windingNumber+i.eUp.winding,i.inside=t.sweep.isWindingInside_(e,i.windingNumber)},t.sweep.finishRegion_=function(e,i){var n=i.eUp,r=n.lFace;r.inside=i.inside,r.anEdge=n,t.sweep.deleteRegion_(e,i)},t.sweep.finishLeftRegions_=function(e,i,n){for(var r=i,s=i.eUp;r!==n;){r.fixUpperEdge=!1;var o=r.regionBelow(),a=o.eUp;if(a.org!==s.org){if(!o.fixUpperEdge){t.sweep.finishRegion_(e,r);break}a=t.mesh.connect(s.lPrev(),a.sym),t.sweep.fixUpperEdge_(o,a)}s.oNext!==a&&(t.mesh.meshSplice(a.oPrev(),a),t.mesh.meshSplice(s,a)),t.sweep.finishRegion_(e,r),s=o.eUp,r=o}return s},t.sweep.addRightEdges_=function(e,i,n,r,s,o){var a=!0,l=n;do{t.sweep.addRegionBelow_(e,i,l.sym),l=l.oNext}while(l!==r);null===s&&(s=i.regionBelow().eUp.rPrev());for(var u,h=i,d=s;(l=(u=h.regionBelow()).eUp.sym).org===d.org;)l.oNext!==d&&(t.mesh.meshSplice(l.oPrev(),l),t.mesh.meshSplice(d.oPrev(),l)),u.windingNumber=h.windingNumber-l.winding,u.inside=t.sweep.isWindingInside_(e,u.windingNumber),h.dirty=!0,!a&&t.sweep.checkForRightSplice_(e,h)&&(t.sweep.addWinding_(l,d),t.sweep.deleteRegion_(e,h),t.mesh.deleteEdge(d)),a=!1,h=u,d=l;h.dirty=!0,o&&t.sweep.walkDirtyRegions_(e,h)},t.sweep.callCombine_=function(e,i,n,r,s){var o=[i.coords[0],i.coords[1],i.coords[2]];i.data=null,i.data=e.callCombineCallback(o,n,r),null===i.data&&(s?e.fatalError||(e.callErrorCallback(t.errorType.GLU_TESS_NEED_COMBINE_CALLBACK),e.fatalError=!0):i.data=n[0])},t.sweep.spliceMergeVertices_=function(e,i,n){var r=[null,null,null,null];r[0]=i.org.data,r[1]=n.org.data,t.sweep.callCombine_(e,i.org,r,[.5,.5,0,0],!1),t.mesh.meshSplice(i,n)},t.sweep.vertexWeights_=function(e,i,n,r,s){var o=t.geom.vertL1dist(i,e),a=t.geom.vertL1dist(n,e),l=s,u=s+1;r[l]=.5*a/(o+a),r[u]=.5*o/(o+a),e.coords[0]+=r[l]*i.coords[0]+r[u]*n.coords[0],e.coords[1]+=r[l]*i.coords[1]+r[u]*n.coords[1],e.coords[2]+=r[l]*i.coords[2]+r[u]*n.coords[2]},t.sweep.getIntersectData_=function(e,i,n,r,s,o){var a=[0,0,0,0],l=[n.data,r.data,s.data,o.data];i.coords[0]=i.coords[1]=i.coords[2]=0,t.sweep.vertexWeights_(i,n,r,a,0),t.sweep.vertexWeights_(i,s,o,a,2),t.sweep.callCombine_(e,i,l,a,!0)},t.sweep.checkForRightSplice_=function(e,i){var n=i.regionBelow(),r=i.eUp,s=n.eUp;if(t.geom.vertLeq(r.org,s.org)){if(t.geom.edgeSign(s.dst(),r.org,s.org)>0)return!1;t.geom.vertEq(r.org,s.org)?r.org!==s.org&&(e.pq.remove(r.org.pqHandle),t.sweep.spliceMergeVertices_(e,s.oPrev(),r)):(t.mesh.splitEdge(s.sym),t.mesh.meshSplice(r,s.oPrev()),i.dirty=n.dirty=!0)}else{if(t.geom.edgeSign(r.dst(),s.org,r.org)<0)return!1;i.regionAbove().dirty=i.dirty=!0,t.mesh.splitEdge(r.sym),t.mesh.meshSplice(s.oPrev(),r)}return!0},t.sweep.checkForLeftSplice_=function(e,i){var n,r=i.regionBelow(),s=i.eUp,o=r.eUp;if(t.geom.vertLeq(s.dst(),o.dst())){if(t.geom.edgeSign(s.dst(),o.dst(),s.org)<0)return!1;i.regionAbove().dirty=i.dirty=!0,n=t.mesh.splitEdge(s),t.mesh.meshSplice(o.sym,n),n.lFace.inside=i.inside}else{if(t.geom.edgeSign(o.dst(),s.dst(),o.org)>0)return!1;i.dirty=r.dirty=!0,n=t.mesh.splitEdge(o),t.mesh.meshSplice(s.lNext,o.sym),n.rFace().inside=i.inside}return!0},t.sweep.checkForIntersect_=function(e,i){var n=i.regionBelow(),r=i.eUp,s=n.eUp,o=r.org,a=s.org,l=r.dst(),u=s.dst(),h=new t.GluVertex;if(o===a)return!1;if(Math.min(o.t,l.t)>Math.max(a.t,u.t))return!1;if(t.geom.vertLeq(o,a)){if(t.geom.edgeSign(u,o,a)>0)return!1}else if(t.geom.edgeSign(l,a,o)<0)return!1;t.geom.edgeIntersect(l,o,u,a,h),t.geom.vertLeq(h,e.event)&&(h.s=e.event.s,h.t=e.event.t);var d=t.geom.vertLeq(o,a)?o:a;if(t.geom.vertLeq(d,h)&&(h.s=d.s,h.t=d.t),t.geom.vertEq(h,o)||t.geom.vertEq(h,a))return t.sweep.checkForRightSplice_(e,i),!1;if(!t.geom.vertEq(l,e.event)&&t.geom.edgeSign(l,e.event,h)>=0||!t.geom.vertEq(u,e.event)&&t.geom.edgeSign(u,e.event,h)<=0){if(u===e.event)return t.mesh.splitEdge(r.sym),t.mesh.meshSplice(s.sym,r),r=(i=t.sweep.topLeftRegion_(i)).regionBelow().eUp,t.sweep.finishLeftRegions_(e,i.regionBelow(),n),t.sweep.addRightEdges_(e,i,r.oPrev(),r,r,!0),!0;if(l===e.event){t.mesh.splitEdge(s.sym),t.mesh.meshSplice(r.lNext,s.oPrev()),n=i;var c=(i=t.sweep.topRightRegion_(i)).regionBelow().eUp.rPrev();return n.eUp=s.oPrev(),s=t.sweep.finishLeftRegions_(e,n,null),t.sweep.addRightEdges_(e,i,s.oNext,r.rPrev(),c,!0),!0}return t.geom.edgeSign(l,e.event,h)>=0&&(i.regionAbove().dirty=i.dirty=!0,t.mesh.splitEdge(r.sym),r.org.s=e.event.s,r.org.t=e.event.t),t.geom.edgeSign(u,e.event,h)<=0&&(i.dirty=n.dirty=!0,t.mesh.splitEdge(s.sym),s.org.s=e.event.s,s.org.t=e.event.t),!1}return t.mesh.splitEdge(r.sym),t.mesh.splitEdge(s.sym),t.mesh.meshSplice(s.oPrev(),r),r.org.s=h.s,r.org.t=h.t,r.org.pqHandle=e.pq.insert(r.org),t.sweep.getIntersectData_(e,r.org,o,l,a,u),i.regionAbove().dirty=i.dirty=n.dirty=!0,!1},t.sweep.walkDirtyRegions_=function(e,i){for(var n=i.regionBelow();;){for(;n.dirty;)i=n,n=n.regionBelow();if(!i.dirty&&(n=i,null===(i=i.regionAbove())||!i.dirty))return;i.dirty=!1;var r=i.eUp,s=n.eUp;if(r.dst()!==s.dst()&&t.sweep.checkForLeftSplice_(e,i)&&(n.fixUpperEdge?(t.sweep.deleteRegion_(e,n),t.mesh.deleteEdge(s),s=(n=i.regionBelow()).eUp):i.fixUpperEdge&&(t.sweep.deleteRegion_(e,i),t.mesh.deleteEdge(r),r=(i=n.regionAbove()).eUp)),r.org!==s.org)if(r.dst()===s.dst()||i.fixUpperEdge||n.fixUpperEdge||r.dst()!==e.event&&s.dst()!==e.event)t.sweep.checkForRightSplice_(e,i);else if(t.sweep.checkForIntersect_(e,i))return;r.org===s.org&&r.dst()===s.dst()&&(t.sweep.addWinding_(s,r),t.sweep.deleteRegion_(e,i),t.mesh.deleteEdge(r),i=n.regionAbove())}},t.sweep.connectRightVertex_=function(e,i,n){var r,s=n.oNext,o=i.regionBelow(),a=i.eUp,l=o.eUp,u=!1;(a.dst()!==l.dst()&&t.sweep.checkForIntersect_(e,i),t.geom.vertEq(a.org,e.event)&&(t.mesh.meshSplice(s.oPrev(),a),s=(i=t.sweep.topLeftRegion_(i)).regionBelow().eUp,t.sweep.finishLeftRegions_(e,i.regionBelow(),o),u=!0),t.geom.vertEq(l.org,e.event)&&(t.mesh.meshSplice(n,l.oPrev()),n=t.sweep.finishLeftRegions_(e,o,null),u=!0),u)?t.sweep.addRightEdges_(e,i,n.oNext,s,s,!0):(r=t.geom.vertLeq(l.org,a.org)?l.oPrev():a,r=t.mesh.connect(n.lPrev(),r),t.sweep.addRightEdges_(e,i,r,r.oNext,r.oNext,!1),r.sym.activeRegion.fixUpperEdge=!0,t.sweep.walkDirtyRegions_(e,i))},t.sweep.connectLeftDegenerate_=function(e,i,n){var r=i.eUp;if(t.geom.vertEq(r.org,n))t.sweep.TOLERANCE_NONZERO_&&t.sweep.spliceMergeVertices_(e,r,n.anEdge);else{if(!t.geom.vertEq(r.dst(),n))return t.mesh.splitEdge(r.sym),i.fixUpperEdge&&(t.mesh.deleteEdge(r.oNext),i.fixUpperEdge=!1),t.mesh.meshSplice(n.anEdge,r),void t.sweep.sweepEvent_(e,n);if(t.sweep.TOLERANCE_NONZERO_){var s=(i=t.sweep.topRightRegion_(i)).regionBelow(),o=s.eUp.sym,a=o.oNext,l=a;s.fixUpperEdge&&(t.sweep.deleteRegion_(e,s),t.mesh.deleteEdge(o),o=a.oPrev()),t.mesh.meshSplice(n.anEdge,o),t.geom.edgeGoesLeft(a)||(a=null),t.sweep.addRightEdges_(e,i,o.oNext,l,a,!0)}}},t.sweep.connectLeftVertex_=function(e,i){var n=new t.ActiveRegion;n.eUp=i.anEdge.sym;var r=e.dict.search(n).getKey(),s=r.regionBelow(),o=r.eUp,a=s.eUp;if(0!==t.geom.edgeSign(o.dst(),i,o.org)){var l,u=t.geom.vertLeq(a.dst(),o.dst())?r:s;if(r.inside||u.fixUpperEdge){if(u===r)l=t.mesh.connect(i.anEdge.sym,o.lNext);else l=t.mesh.connect(a.dNext(),i.anEdge).sym;u.fixUpperEdge?t.sweep.fixUpperEdge_(u,l):t.sweep.computeWinding_(e,t.sweep.addRegionBelow_(e,r,l)),t.sweep.sweepEvent_(e,i)}else t.sweep.addRightEdges_(e,r,i.anEdge,i.anEdge,null,!0)}else t.sweep.connectLeftDegenerate_(e,r,i)},t.sweep.sweepEvent_=function(e,i){e.event=i;for(var n=i.anEdge;null===n.activeRegion;)if((n=n.oNext)===i.anEdge)return void t.sweep.connectLeftVertex_(e,i);var r=t.sweep.topLeftRegion_(n.activeRegion),s=r.regionBelow(),o=s.eUp,a=t.sweep.finishLeftRegions_(e,s,null);a.oNext===o?t.sweep.connectRightVertex_(e,r,a):t.sweep.addRightEdges_(e,r,a.oNext,o,o,!0)},t.sweep.addSentinel_=function(e,i){var n=new t.ActiveRegion,r=t.mesh.makeEdge(e.mesh);r.org.s=t.sweep.SENTINEL_COORD_,r.org.t=i,r.dst().s=-t.sweep.SENTINEL_COORD_,r.dst().t=i,e.event=r.dst(),n.eUp=r,n.windingNumber=0,n.inside=!1,n.fixUpperEdge=!1,n.sentinel=!0,n.dirty=!1,n.nodeUp=e.dict.insert(n)},t.sweep.initEdgeDict_=function(e){e.dict=new t.Dict(e,t.sweep.edgeLeq_),t.sweep.addSentinel_(e,-t.sweep.SENTINEL_COORD_),t.sweep.addSentinel_(e,t.sweep.SENTINEL_COORD_)},t.sweep.doneEdgeDict_=function(e){for(var i;null!==(i=e.dict.getMin().getKey());)i.sentinel,t.sweep.deleteRegion_(e,i);e.dict=null},t.sweep.removeDegenerateEdges_=function(e){for(var i,n=e.mesh.eHead,r=n.next;r!==n;r=i){i=r.next;var s=r.lNext;t.geom.vertEq(r.org,r.dst())&&r.lNext.lNext!==r&&(t.sweep.spliceMergeVertices_(e,s,r),t.mesh.deleteEdge(r),s=(r=s).lNext),s.lNext===r&&(s!==r&&(s!==i&&s!==i.sym||(i=i.next),t.mesh.deleteEdge(s)),r!==i&&r!==i.sym||(i=i.next),t.mesh.deleteEdge(r))}},t.sweep.initPriorityQ_=function(e){var i=new t.PriorityQ;e.pq=i;var n,r=e.mesh.vHead;for(n=r.next;n!==r;n=n.next)n.pqHandle=i.insert(n);i.init()},t.sweep.donePriorityQ_=function(e){e.pq.deleteQ(),e.pq=null},t.sweep.removeDegenerateFaces_=function(e){for(var i,n=e.fHead.next;n!==e.fHead;n=i){i=n.next;var r=n.anEdge;r.lNext.lNext===r&&(t.sweep.addWinding_(r.oNext,r),t.mesh.deleteEdge(r))}},t.tessmono={},t.tessmono.tessellateMonoRegion_=function(e){for(var i=e.anEdge;t.geom.vertLeq(i.dst(),i.org);i=i.lPrev());for(;t.geom.vertLeq(i.org,i.dst());i=i.lNext);for(var n,r=i.lPrev();i.lNext!==r;)if(t.geom.vertLeq(i.dst(),r.org)){for(;r.lNext!==i&&(t.geom.edgeGoesLeft(r.lNext)||t.geom.edgeSign(r.org,r.dst(),r.lNext.dst())<=0);)r=(n=t.mesh.connect(r.lNext,r)).sym;r=r.lPrev()}else{for(;r.lNext!==i&&(t.geom.edgeGoesRight(i.lPrev())||t.geom.edgeSign(i.dst(),i.org,i.lPrev().org)>=0);)n=t.mesh.connect(i,i.lPrev()),i=n.sym;i=i.lNext}for(;r.lNext.lNext!==i;)r=(n=t.mesh.connect(r.lNext,r)).sym},t.tessmono.tessellateInterior=function(e){for(var i,n=e.fHead.next;n!==e.fHead;n=i)i=n.next,n.inside&&t.tessmono.tessellateMonoRegion_(n)},t.tessmono.discardExterior=function(e){for(var i,n=e.fHead.next;n!==e.fHead;n=i)i=n.next,n.inside||t.mesh.zapFace(n)},t.tessmono.setWindingNumber=function(e,i,n){for(var r,s=e.eHead.next;s!==e.eHead;s=r)r=s.next,s.rFace().inside!==s.lFace.inside?s.winding=s.lFace.inside?i:-i:n?t.mesh.deleteEdge(s):s.winding=0},t.Dict=function(e,i){this.head_=new t.DictNode,this.frame_=e,this.leq_=i},t.Dict.prototype.deleteDict_=function(){},t.Dict.prototype.insertBefore=function(e,i){do{e=e.prev}while(null!==e.key&&!this.leq_(this.frame_,e.key,i));var n=new t.DictNode(i,e.next,e);return e.next.prev=n,e.next=n,n},t.Dict.prototype.insert=function(e){return this.insertBefore(this.head_,e)},t.Dict.prototype.deleteNode=function(e){e.next.prev=e.prev,e.prev.next=e.next},t.Dict.prototype.search=function(e){var t=this.head_;do{t=t.next}while(null!==t.key&&!this.leq_(this.frame_,e,t.key));return t},t.Dict.prototype.getMin=function(){return this.head_.next},t.Dict.prototype.getMax=function(){return this.head_.prev},t.DictNode=function(e,t,i){this.key=e||null,this.next=t||this,this.prev=i||this},t.DictNode.prototype.getKey=function(){return this.key},t.DictNode.prototype.getSuccessor=function(){return this.next},t.DictNode.prototype.getPredecessor=function(){return this.prev},t.GluTesselator=function(){this.state_=t.GluTesselator.tessState_.T_DORMANT,this.lastEdge_=null,this.mesh=null,this.errorCallback_=null,this.normal_=[0,0,0],this.windingRule=t.windingRule.GLU_TESS_WINDING_ODD,this.fatalError=!1,this.dict=null,this.pq=null,this.event=null,this.combineCallback_=null,this.boundaryOnly_=!1,this.beginCallback_=null,this.edgeFlagCallback_=null,this.vertexCallback_=null,this.endCallback_=null,this.meshCallback_=null,this.polygonData_=null},t.GluTesselator.tessState_={T_DORMANT:0,T_IN_POLYGON:1,T_IN_CONTOUR:2},t.GluTesselator.prototype.gluDeleteTess=function(){this.requireState_(t.GluTesselator.tessState_.T_DORMANT)},t.GluTesselator.prototype.gluTessProperty=function(e,i){switch(e){case t.gluEnum.GLU_TESS_TOLERANCE:return;case t.gluEnum.GLU_TESS_WINDING_RULE:var n=i;switch(n){case t.windingRule.GLU_TESS_WINDING_ODD:case t.windingRule.GLU_TESS_WINDING_NONZERO:case t.windingRule.GLU_TESS_WINDING_POSITIVE:case t.windingRule.GLU_TESS_WINDING_NEGATIVE:case t.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return void(this.windingRule=n)}break;case t.gluEnum.GLU_TESS_BOUNDARY_ONLY:return void(this.boundaryOnly_=!!i);default:return void this.callErrorCallback(t.gluEnum.GLU_INVALID_ENUM)}this.callErrorCallback(t.gluEnum.GLU_INVALID_VALUE)},t.GluTesselator.prototype.gluGetTessProperty=function(e){switch(e){case t.gluEnum.GLU_TESS_TOLERANCE:return 0;case t.gluEnum.GLU_TESS_WINDING_RULE:return this.windingRule;case t.gluEnum.GLU_TESS_BOUNDARY_ONLY:return this.boundaryOnly_;default:this.callErrorCallback(t.gluEnum.GLU_INVALID_ENUM)}return!1},t.GluTesselator.prototype.gluTessNormal=function(e,t,i){this.normal_[0]=e,this.normal_[1]=t,this.normal_[2]=i},t.GluTesselator.prototype.gluTessCallback=function(e,i){var n=i||null;switch(e){case t.gluEnum.GLU_TESS_BEGIN:case t.gluEnum.GLU_TESS_BEGIN_DATA:return void(this.beginCallback_=n);case t.gluEnum.GLU_TESS_EDGE_FLAG:case t.gluEnum.GLU_TESS_EDGE_FLAG_DATA:return void(this.edgeFlagCallback_=n);case t.gluEnum.GLU_TESS_VERTEX:case t.gluEnum.GLU_TESS_VERTEX_DATA:return void(this.vertexCallback_=n);case t.gluEnum.GLU_TESS_END:case t.gluEnum.GLU_TESS_END_DATA:return void(this.endCallback_=n);case t.gluEnum.GLU_TESS_ERROR:case t.gluEnum.GLU_TESS_ERROR_DATA:return void(this.errorCallback_=n);case t.gluEnum.GLU_TESS_COMBINE:case t.gluEnum.GLU_TESS_COMBINE_DATA:return void(this.combineCallback_=n);case t.gluEnum.GLU_TESS_MESH:return void(this.meshCallback_=n);default:return void this.callErrorCallback(t.gluEnum.GLU_INVALID_ENUM)}},t.GluTesselator.prototype.gluTessVertex=function(e,i){var n=!1,r=[0,0,0];this.requireState_(t.GluTesselator.tessState_.T_IN_CONTOUR);for(var s=0;s<3;++s){var o=e[s];o<-t.GLU_TESS_MAX_COORD&&(o=-t.GLU_TESS_MAX_COORD,n=!0),o>t.GLU_TESS_MAX_COORD&&(o=t.GLU_TESS_MAX_COORD,n=!0),r[s]=o}n&&this.callErrorCallback(t.errorType.GLU_TESS_COORD_TOO_LARGE),this.addVertex_(r,i)},t.GluTesselator.prototype.gluTessBeginPolygon=function(e){this.requireState_(t.GluTesselator.tessState_.T_DORMANT),this.state_=t.GluTesselator.tessState_.T_IN_POLYGON,this.mesh=new t.GluMesh,this.polygonData_=e},t.GluTesselator.prototype.gluTessBeginContour=function(){this.requireState_(t.GluTesselator.tessState_.T_IN_POLYGON),this.state_=t.GluTesselator.tessState_.T_IN_CONTOUR,this.lastEdge_=null},t.GluTesselator.prototype.gluTessEndContour=function(){this.requireState_(t.GluTesselator.tessState_.T_IN_CONTOUR),this.state_=t.GluTesselator.tessState_.T_IN_POLYGON},t.GluTesselator.prototype.gluTessEndPolygon=function(){if(this.requireState_(t.GluTesselator.tessState_.T_IN_POLYGON),this.state_=t.GluTesselator.tessState_.T_DORMANT,t.normal.projectPolygon(this,this.normal_[0],this.normal_[1],this.normal_[2]),t.sweep.computeInterior(this),!this.fatalError){var e=this.mesh;if(this.boundaryOnly_?t.tessmono.setWindingNumber(e,1,!0):t.tessmono.tessellateInterior(e),this.mesh.checkMesh(),this.beginCallback_||this.endCallback_||this.vertexCallback_||this.edgeFlagCallback_)if(this.boundaryOnly_)t.render.renderBoundary(this,this.mesh);else{var i=!!this.edgeFlagCallback_;t.render.renderMesh(this,this.mesh,i)}if(this.meshCallback_)return t.tessmono.discardExterior(this.mesh),this.meshCallback_(this.mesh),this.mesh=null,void(this.polygonData_=null)}t.mesh.deleteMesh(this.mesh),this.polygonData_=null,this.mesh=null},t.GluTesselator.prototype.requireState_=function(e){this.state_!==e&&this.gotoState_(e)},t.GluTesselator.prototype.gotoState_=function(e){for(;this.state_!==e;)if(this.state_<e)switch(this.state_){case t.GluTesselator.tessState_.T_DORMANT:this.callErrorCallback(t.errorType.GLU_TESS_MISSING_BEGIN_POLYGON),this.gluTessBeginPolygon(null);break;case t.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(t.errorType.GLU_TESS_MISSING_BEGIN_CONTOUR),this.gluTessBeginContour()}else switch(this.state_){case t.GluTesselator.tessState_.T_IN_CONTOUR:this.callErrorCallback(t.errorType.GLU_TESS_MISSING_END_CONTOUR),this.gluTessEndContour();break;case t.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(t.errorType.GLU_TESS_MISSING_END_POLYGON),this.gluTessEndPolygon()}},t.GluTesselator.prototype.addVertex_=function(e,i){var n=this.lastEdge_;null===n?(n=t.mesh.makeEdge(this.mesh),t.mesh.meshSplice(n,n.sym)):(t.mesh.splitEdge(n),n=n.lNext),n.org.data=i,n.org.coords[0]=e[0],n.org.coords[1]=e[1],n.org.coords[2]=e[2],n.winding=1,n.sym.winding=-1,this.lastEdge_=n},t.GluTesselator.prototype.callBeginCallback=function(e){this.beginCallback_&&this.beginCallback_(e,this.polygonData_)},t.GluTesselator.prototype.callVertexCallback=function(e){this.vertexCallback_&&this.vertexCallback_(e,this.polygonData_)},t.GluTesselator.prototype.callEdgeFlagCallback=function(e){this.edgeFlagCallback_&&this.edgeFlagCallback_(e,this.polygonData_)},t.GluTesselator.prototype.callEndCallback=function(){this.endCallback_&&this.endCallback_(this.polygonData_)},t.GluTesselator.prototype.callCombineCallback=function(e,t,i){return this.combineCallback_&&this.combineCallback_(e,t,i,this.polygonData_)||null},t.GluTesselator.prototype.callErrorCallback=function(e){this.errorCallback_&&this.errorCallback_(e,this.polygonData_)},t.GluFace=function(e,t){this.next=e||this,this.prev=t||this,this.anEdge=null,this.data=null,this.inside=!1},t.GluHalfEdge=function(e){this.next=e||this,this.sym=null,this.oNext=null,this.lNext=null,this.org=null,this.lFace=null,this.activeRegion=null,this.winding=0},t.GluHalfEdge.prototype.rFace=function(){return this.sym.lFace},t.GluHalfEdge.prototype.dst=function(){return this.sym.org},t.GluHalfEdge.prototype.oPrev=function(){return this.sym.lNext},t.GluHalfEdge.prototype.lPrev=function(){return this.oNext.sym},t.GluHalfEdge.prototype.dPrev=function(){return this.lNext.sym},t.GluHalfEdge.prototype.rPrev=function(){return this.sym.oNext},t.GluHalfEdge.prototype.dNext=function(){return this.rPrev().sym},t.GluHalfEdge.prototype.rNext=function(){return this.oPrev().sym},t.GluMesh=function(){this.vHead=new t.GluVertex,this.fHead=new t.GluFace,this.eHead=new t.GluHalfEdge,this.eHeadSym=new t.GluHalfEdge,this.eHead.sym=this.eHeadSym,this.eHeadSym.sym=this.eHead},t.GluMesh.prototype.checkMesh=function(){if(t.DEBUG){var e,i,n,r=this.fHead,s=this.vHead,o=this.eHead,a=r;for(a=r;(i=a.next)!==r;a=i){e=i.anEdge;do{e=e.lNext}while(e!==i.anEdge)}var l=s;for(l=s;(n=l.next)!==s;l=n){e=n.anEdge;do{e=e.oNext}while(e!==n.anEdge)}var u=o;for(u=o;(e=u.next)!==o;u=e);}},t.GluVertex=function(e,t){this.next=e||this,this.prev=t||this,this.anEdge=null,this.data=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0},t.PriorityQ=function(){this.verts_=[],this.order_=null,this.size_=0,this.initialized_=!1,this.heap_=new t.PriorityQHeap},t.PriorityQ.prototype.deleteQ=function(){this.heap_=null,this.order_=null,this.verts_=null},t.PriorityQ.prototype.init=function(){this.order_=[];for(var e=0;e<this.size_;e++)this.order_[e]=e;var i,n=(i=this.verts_,function(e,n){return t.geom.vertLeq(i[e],i[n])?1:-1});if(this.order_.sort(n),this.initialized_=!0,this.heap_.init(),t.DEBUG){var r=0+this.size_-1;for(e=0;e<r;++e);}},t.PriorityQ.prototype.insert=function(e){if(this.initialized_)return this.heap_.insert(e);var t=this.size_++;return this.verts_[t]=e,-(t+1)},t.PriorityQ.prototype.extractMin=function(){if(0===this.size_)return this.heap_.extractMin();var e=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var i=this.heap_.minimum();if(t.geom.vertLeq(i,e))return this.heap_.extractMin()}do{--this.size_}while(this.size_>0&&null===this.verts_[this.order_[this.size_-1]]);return e},t.PriorityQ.prototype.minimum=function(){if(0===this.size_)return this.heap_.minimum();var e=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var i=this.heap_.minimum();if(t.geom.vertLeq(i,e))return i}return e},t.PriorityQ.prototype.remove=function(e){if(e>=0)this.heap_.remove(e);else for(e=-(e+1),this.verts_[e]=null;this.size_>0&&null===this.verts_[this.order_[this.size_-1]];)--this.size_},t.PriorityQHeap=function(){this.heap_=t.PriorityQHeap.reallocNumeric_([0],t.PriorityQHeap.INIT_SIZE_+1),this.verts_=[null,null],this.handles_=[0,0],this.size_=0,this.max_=t.PriorityQHeap.INIT_SIZE_,this.freeList_=0,this.initialized_=!1,this.heap_[1]=1},t.PriorityQHeap.INIT_SIZE_=32,t.PriorityQHeap.reallocNumeric_=function(e,t){for(var i=new Array(t),n=0;n<e.length;n++)i[n]=e[n];for(;n<t;n++)i[n]=0;return i},t.PriorityQHeap.prototype.init=function(){for(var e=this.size_;e>=1;--e)this.floatDown_(e);this.initialized_=!0},t.PriorityQHeap.prototype.insert=function(e){var i,n=++this.size_;return 2*n>this.max_&&(this.max_*=2,this.handles_=t.PriorityQHeap.reallocNumeric_(this.handles_,this.max_+1)),0===this.freeList_?i=n:(i=this.freeList_,this.freeList_=this.handles_[this.freeList_]),this.verts_[i]=e,this.handles_[i]=n,this.heap_[n]=i,this.initialized_&&this.floatUp_(n),i},t.PriorityQHeap.prototype.isEmpty=function(){return 0===this.size_},t.PriorityQHeap.prototype.minimum=function(){return this.verts_[this.heap_[1]]},t.PriorityQHeap.prototype.extractMin=function(){var e=this.heap_,t=this.verts_,i=this.handles_,n=e[1],r=t[n];return this.size_>0&&(e[1]=e[this.size_],i[e[1]]=1,t[n]=null,i[n]=this.freeList_,this.freeList_=n,--this.size_>0&&this.floatDown_(1)),r},t.PriorityQHeap.prototype.remove=function(e){var i=this.heap_,n=this.verts_,r=this.handles_,s=r[e];if(i[s]=i[this.size_],r[i[s]]=s,s<=--this.size_)if(s<=1)this.floatDown_(s);else{var o=n[i[s]],a=n[i[s>>1]];t.geom.vertLeq(a,o)?this.floatDown_(s):this.floatUp_(s)}n[e]=null,r[e]=this.freeList_,this.freeList_=e},t.PriorityQHeap.prototype.floatDown_=function(e){for(var i=this.heap_,n=this.verts_,r=this.handles_,s=e,o=i[s];;){var a=s<<1;a<this.size_&&t.geom.vertLeq(n[i[a+1]],n[i[a]])&&(a+=1);var l=i[a];if(a>this.size_||t.geom.vertLeq(n[o],n[l]))return i[s]=o,void(r[o]=s);i[s]=l,r[l]=s,s=a}},t.PriorityQHeap.prototype.floatUp_=function(e){for(var i=this.heap_,n=this.verts_,r=this.handles_,s=e,o=i[s];;){var a=s>>1,l=i[a];if(0===a||t.geom.vertLeq(n[l],n[o]))return i[s]=o,void(r[o]=s);i[s]=l,r[l]=s,s=a}},t.ActiveRegion=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},t.ActiveRegion.prototype.regionBelow=function(){return this.nodeUp.getPredecessor().getKey()},t.ActiveRegion.prototype.regionAbove=function(){return this.nodeUp.getSuccessor().getKey()},e.exports=t},583:function(e,t){!function(e){var t=(e,t,i,n)=>{let r=65535&e|0,s=e>>>16&65535|0,o=0;for(;0!==i;){o=i>2e3?2e3:i,i-=o;do{r=r+t[n++]|0,s=s+r|0}while(--o);r%=65521,s%=65521}return r|s<<16|0};const i=new Uint32Array((()=>{let e,t=[];for(var i=0;i<256;i++){e=i;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t})());var n=(e,t,n,r)=>{const s=i,o=r+n;e^=-1;for(let i=r;i<o;i++)e=e>>>8^s[255&(e^t[i])];return-1^e};const r=16209,s=16191;var o=function(e,t){let i,n,o,a,l,u,h,d,c,p,g,f,m,_,x,y,w,b,S,T,v,O,E,C;const N=e.state;i=e.next_in,E=e.input,n=i+(e.avail_in-5),o=e.next_out,C=e.output,a=o-(t-e.avail_out),l=o+(e.avail_out-257),u=N.dmax,h=N.wsize,d=N.whave,c=N.wnext,p=N.window,g=N.hold,f=N.bits,m=N.lencode,_=N.distcode,x=(1<<N.lenbits)-1,y=(1<<N.distbits)-1;e:do{f<15&&(g+=E[i++]<<f,f+=8,g+=E[i++]<<f,f+=8),w=m[g&x];t:for(;;){if(b=w>>>24,g>>>=b,f-=b,b=w>>>16&255,0===b)C[o++]=65535&w;else{if(!(16&b)){if(0==(64&b)){w=m[(65535&w)+(g&(1<<b)-1)];continue t}if(32&b){N.mode=s;break e}e.msg="invalid literal/length code",N.mode=r;break e}S=65535&w,b&=15,b&&(f<b&&(g+=E[i++]<<f,f+=8),S+=g&(1<<b)-1,g>>>=b,f-=b),f<15&&(g+=E[i++]<<f,f+=8,g+=E[i++]<<f,f+=8),w=_[g&y];i:for(;;){if(b=w>>>24,g>>>=b,f-=b,b=w>>>16&255,!(16&b)){if(0==(64&b)){w=_[(65535&w)+(g&(1<<b)-1)];continue i}e.msg="invalid distance code",N.mode=r;break e}if(T=65535&w,b&=15,f<b&&(g+=E[i++]<<f,f+=8,f<b&&(g+=E[i++]<<f,f+=8)),T+=g&(1<<b)-1,T>u){e.msg="invalid distance too far back",N.mode=r;break e}if(g>>>=b,f-=b,b=o-a,T>b){if(b=T-b,b>d&&N.sane){e.msg="invalid distance too far back",N.mode=r;break e}if(v=0,O=p,0===c){if(v+=h-b,b<S){S-=b;do{C[o++]=p[v++]}while(--b);v=o-T,O=C}}else if(c<b){if(v+=h+c-b,b-=c,b<S){S-=b;do{C[o++]=p[v++]}while(--b);if(v=0,c<S){b=c,S-=b;do{C[o++]=p[v++]}while(--b);v=o-T,O=C}}}else if(v+=c-b,b<S){S-=b;do{C[o++]=p[v++]}while(--b);v=o-T,O=C}for(;S>2;)C[o++]=O[v++],C[o++]=O[v++],C[o++]=O[v++],S-=3;S&&(C[o++]=O[v++],S>1&&(C[o++]=O[v++]))}else{v=o-T;do{C[o++]=C[v++],C[o++]=C[v++],C[o++]=C[v++],S-=3}while(S>2);S&&(C[o++]=C[v++],S>1&&(C[o++]=C[v++]))}break}}break}}while(i<n&&o<l);S=f>>3,i-=S,f-=S<<3,g&=(1<<f)-1,e.next_in=i,e.next_out=o,e.avail_in=i<n?n-i+5:5-(i-n),e.avail_out=o<l?l-o+257:257-(o-l),N.hold=g,N.bits=f};const a=15,l=852,u=592,h=0,d=1,c=2,p=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),g=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),f=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),m=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var _=(e,t,i,n,r,s,o,_)=>{const x=_.bits;let y,w,b,S,T,v,O=0,E=0,C=0,N=0,I=0,F=0,M=0,D=0,R=0,P=0,A=null;const V=new Uint16Array(a+1),L=new Uint16Array(a+1);let B,U,X,j=null;for(O=0;O<=a;O++)V[O]=0;for(E=0;E<n;E++)V[t[i+E]]++;for(I=x,N=a;N>=1&&0===V[N];N--);if(I>N&&(I=N),0===N)return r[s++]=20971520,r[s++]=20971520,_.bits=1,0;for(C=1;C<N&&0===V[C];C++);for(I<C&&(I=C),D=1,O=1;O<=a;O++)if(D<<=1,D-=V[O],D<0)return-1;if(D>0&&(e===h||1!==N))return-1;for(L[1]=0,O=1;O<a;O++)L[O+1]=L[O]+V[O];for(E=0;E<n;E++)0!==t[i+E]&&(o[L[t[i+E]]++]=E);if(e===h?(A=j=o,v=20):e===d?(A=p,j=g,v=257):(A=f,j=m,v=0),P=0,E=0,O=C,T=s,F=I,M=0,b=-1,R=1<<I,S=R-1,e===d&&R>l||e===c&&R>u)return 1;for(;;){B=O-M,o[E]+1<v?(U=0,X=o[E]):o[E]>=v?(U=j[o[E]-v],X=A[o[E]-v]):(U=96,X=0),y=1<<O-M,w=1<<F,C=w;do{w-=y,r[T+(P>>M)+w]=B<<24|U<<16|X|0}while(0!==w);for(y=1<<O-1;P&y;)y>>=1;if(0!==y?(P&=y-1,P+=y):P=0,E++,0==--V[O]){if(O===N)break;O=t[i+o[E]]}if(O>I&&(P&S)!==b){for(0===M&&(M=I),T+=C,F=O-M,D=1<<F;F+M<N&&(D-=V[F+M],!(D<=0));)F++,D<<=1;if(R+=1<<F,e===d&&R>l||e===c&&R>u)return 1;b=P&S,r[b]=I<<24|F<<16|T-s|0}}return 0!==P&&(r[T+P]=O-M<<24|64<<16|0),_.bits=I,0},x={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const y=0,w=1,b=2,{Z_FINISH:S,Z_BLOCK:T,Z_TREES:v,Z_OK:O,Z_STREAM_END:E,Z_NEED_DICT:C,Z_STREAM_ERROR:N,Z_DATA_ERROR:I,Z_MEM_ERROR:F,Z_BUF_ERROR:M,Z_DEFLATED:D}=x,R=16180,P=16181,A=16182,V=16183,L=16184,B=16185,U=16186,X=16187,j=16188,k=16189,z=16190,G=16191,H=16192,q=16193,Y=16194,W=16195,$=16196,J=16197,K=16198,Z=16199,Q=16200,ee=16201,te=16202,ie=16203,ne=16204,re=16205,se=16206,oe=16207,ae=16208,le=16209,ue=16210,he=16211,de=852,ce=592,pe=15,ge=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function fe(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const me=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<R||t.mode>he?1:0},_e=e=>{if(me(e))return N;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=R,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(de),t.distcode=t.distdyn=new Int32Array(ce),t.sane=1,t.back=-1,O},xe=e=>{if(me(e))return N;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,_e(e)},ye=(e,t)=>{let i;if(me(e))return N;const n=e.state;return t<0?(i=0,t=-t):(i=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?N:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=i,n.wbits=t,xe(e))},we=(e,t)=>{if(!e)return N;const i=new fe;e.state=i,i.strm=e,i.window=null,i.mode=R;const n=ye(e,t);return n!==O&&(e.state=null),n};let be,Se,Te=!0;const ve=e=>{if(Te){be=new Int32Array(512),Se=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(_(w,e.lens,0,288,be,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;_(b,e.lens,0,32,Se,0,e.work,{bits:5}),Te=!1}e.lencode=be,e.lenbits=9,e.distcode=Se,e.distbits=5},Oe=(e,t,i,n)=>{let r;const s=e.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(s.window.set(t.subarray(i-s.wsize,i),0),s.wnext=0,s.whave=s.wsize):(r=s.wsize-s.wnext,r>n&&(r=n),s.window.set(t.subarray(i-n,i-n+r),s.wnext),(n-=r)?(s.window.set(t.subarray(i-n,i),0),s.wnext=n,s.whave=s.wsize):(s.wnext+=r,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=r))),0};var Ee={inflateReset:xe,inflateReset2:ye,inflateResetKeep:_e,inflateInit:e=>we(e,pe),inflateInit2:we,inflate:(e,i)=>{let r,s,a,l,u,h,d,c,p,g,f,m,x,he,de,ce,pe,fe,_e,xe,ye,we,be=0;const Se=new Uint8Array(4);let Te,Ee;const Ce=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(me(e)||!e.output||!e.input&&0!==e.avail_in)return N;r=e.state,r.mode===G&&(r.mode=H),u=e.next_out,a=e.output,d=e.avail_out,l=e.next_in,s=e.input,h=e.avail_in,c=r.hold,p=r.bits,g=h,f=d,we=O;e:for(;;)switch(r.mode){case R:if(0===r.wrap){r.mode=H;break}for(;p<16;){if(0===h)break e;h--,c+=s[l++]<<p,p+=8}if(2&r.wrap&&35615===c){0===r.wbits&&(r.wbits=15),r.check=0,Se[0]=255&c,Se[1]=c>>>8&255,r.check=n(r.check,Se,2,0),c=0,p=0,r.mode=P;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",r.mode=le;break}if((15&c)!==D){e.msg="unknown compression method",r.mode=le;break}if(c>>>=4,p-=4,ye=8+(15&c),0===r.wbits&&(r.wbits=ye),ye>15||ye>r.wbits){e.msg="invalid window size",r.mode=le;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=512&c?k:G,c=0,p=0;break;case P:for(;p<16;){if(0===h)break e;h--,c+=s[l++]<<p,p+=8}if(r.flags=c,(255&r.flags)!==D){e.msg="unknown compression method",r.mode=le;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=le;break}r.head&&(r.head.text=c>>8&1),512&r.flags&&4&r.wrap&&(Se[0]=255&c,Se[1]=c>>>8&255,r.check=n(r.check,Se,2,0)),c=0,p=0,r.mode=A;case A:for(;p<32;){if(0===h)break e;h--,c+=s[l++]<<p,p+=8}r.head&&(r.head.time=c),512&r.flags&&4&r.wrap&&(Se[0]=255&c,Se[1]=c>>>8&255,Se[2]=c>>>16&255,Se[3]=c>>>24&255,r.check=n(r.check,Se,4,0)),c=0,p=0,r.mode=V;case V:for(;p<16;){if(0===h)break e;h--,c+=s[l++]<<p,p+=8}r.head&&(r.head.xflags=255&c,r.head.os=c>>8),512&r.flags&&4&r.wrap&&(Se[0]=255&c,Se[1]=c>>>8&255,r.check=n(r.check,Se,2,0)),c=0,p=0,r.mode=L;case L:if(1024&r.flags){for(;p<16;){if(0===h)break e;h--,c+=s[l++]<<p,p+=8}r.length=c,r.head&&(r.head.extra_len=c),512&r.flags&&4&r.wrap&&(Se[0]=255&c,Se[1]=c>>>8&255,r.check=n(r.check,Se,2,0)),c=0,p=0}else r.head&&(r.head.extra=null);r.mode=B;case B:if(1024&r.flags&&(m=r.length,m>h&&(m=h),m&&(r.head&&(ye=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(s.subarray(l,l+m),ye)),512&r.flags&&4&r.wrap&&(r.check=n(r.check,s,m,l)),h-=m,l+=m,r.length-=m),r.length))break e;r.length=0,r.mode=U;case U:if(2048&r.flags){if(0===h)break e;m=0;do{ye=s[l+m++],r.head&&ye&&r.length<65536&&(r.head.name+=String.fromCharCode(ye))}while(ye&&m<h);if(512&r.flags&&4&r.wrap&&(r.check=n(r.check,s,m,l)),h-=m,l+=m,ye)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=X;case X:if(4096&r.flags){if(0===h)break e;m=0;do{ye=s[l+m++],r.head&&ye&&r.length<65536&&(r.head.comment+=String.fromCharCode(ye))}while(ye&&m<h);if(512&r.flags&&4&r.wrap&&(r.check=n(r.check,s,m,l)),h-=m,l+=m,ye)break e}else r.head&&(r.head.comment=null);r.mode=j;case j:if(512&r.flags){for(;p<16;){if(0===h)break e;h--,c+=s[l++]<<p,p+=8}if(4&r.wrap&&c!==(65535&r.check)){e.msg="header crc mismatch",r.mode=le;break}c=0,p=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=G;break;case k:for(;p<32;){if(0===h)break e;h--,c+=s[l++]<<p,p+=8}e.adler=r.check=ge(c),c=0,p=0,r.mode=z;case z:if(0===r.havedict)return e.next_out=u,e.avail_out=d,e.next_in=l,e.avail_in=h,r.hold=c,r.bits=p,C;e.adler=r.check=1,r.mode=G;case G:if(i===T||i===v)break e;case H:if(r.last){c>>>=7&p,p-=7&p,r.mode=se;break}for(;p<3;){if(0===h)break e;h--,c+=s[l++]<<p,p+=8}switch(r.last=1&c,c>>>=1,p-=1,3&c){case 0:r.mode=q;break;case 1:if(ve(r),r.mode=Z,i===v){c>>>=2,p-=2;break e}break;case 2:r.mode=$;break;case 3:e.msg="invalid block type",r.mode=le}c>>>=2,p-=2;break;case q:for(c>>>=7&p,p-=7&p;p<32;){if(0===h)break e;h--,c+=s[l++]<<p,p+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",r.mode=le;break}if(r.length=65535&c,c=0,p=0,r.mode=Y,i===v)break e;case Y:r.mode=W;case W:if(m=r.length,m){if(m>h&&(m=h),m>d&&(m=d),0===m)break e;a.set(s.subarray(l,l+m),u),h-=m,l+=m,d-=m,u+=m,r.length-=m;break}r.mode=G;break;case $:for(;p<14;){if(0===h)break e;h--,c+=s[l++]<<p,p+=8}if(r.nlen=257+(31&c),c>>>=5,p-=5,r.ndist=1+(31&c),c>>>=5,p-=5,r.ncode=4+(15&c),c>>>=4,p-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=le;break}r.have=0,r.mode=J;case J:for(;r.have<r.ncode;){for(;p<3;){if(0===h)break e;h--,c+=s[l++]<<p,p+=8}r.lens[Ce[r.have++]]=7&c,c>>>=3,p-=3}for(;r.have<19;)r.lens[Ce[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,Te={bits:r.lenbits},we=_(y,r.lens,0,19,r.lencode,0,r.work,Te),r.lenbits=Te.bits,we){e.msg="invalid code lengths set",r.mode=le;break}r.have=0,r.mode=K;case K:for(;r.have<r.nlen+r.ndist;){for(;be=r.lencode[c&(1<<r.lenbits)-1],de=be>>>24,ce=be>>>16&255,pe=65535&be,!(de<=p);){if(0===h)break e;h--,c+=s[l++]<<p,p+=8}if(pe<16)c>>>=de,p-=de,r.lens[r.have++]=pe;else{if(16===pe){for(Ee=de+2;p<Ee;){if(0===h)break e;h--,c+=s[l++]<<p,p+=8}if(c>>>=de,p-=de,0===r.have){e.msg="invalid bit length repeat",r.mode=le;break}ye=r.lens[r.have-1],m=3+(3&c),c>>>=2,p-=2}else if(17===pe){for(Ee=de+3;p<Ee;){if(0===h)break e;h--,c+=s[l++]<<p,p+=8}c>>>=de,p-=de,ye=0,m=3+(7&c),c>>>=3,p-=3}else{for(Ee=de+7;p<Ee;){if(0===h)break e;h--,c+=s[l++]<<p,p+=8}c>>>=de,p-=de,ye=0,m=11+(127&c),c>>>=7,p-=7}if(r.have+m>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=le;break}for(;m--;)r.lens[r.have++]=ye}}if(r.mode===le)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=le;break}if(r.lenbits=9,Te={bits:r.lenbits},we=_(w,r.lens,0,r.nlen,r.lencode,0,r.work,Te),r.lenbits=Te.bits,we){e.msg="invalid literal/lengths set",r.mode=le;break}if(r.distbits=6,r.distcode=r.distdyn,Te={bits:r.distbits},we=_(b,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,Te),r.distbits=Te.bits,we){e.msg="invalid distances set",r.mode=le;break}if(r.mode=Z,i===v)break e;case Z:r.mode=Q;case Q:if(h>=6&&d>=258){e.next_out=u,e.avail_out=d,e.next_in=l,e.avail_in=h,r.hold=c,r.bits=p,o(e,f),u=e.next_out,a=e.output,d=e.avail_out,l=e.next_in,s=e.input,h=e.avail_in,c=r.hold,p=r.bits,r.mode===G&&(r.back=-1);break}for(r.back=0;be=r.lencode[c&(1<<r.lenbits)-1],de=be>>>24,ce=be>>>16&255,pe=65535&be,!(de<=p);){if(0===h)break e;h--,c+=s[l++]<<p,p+=8}if(ce&&0==(240&ce)){for(fe=de,_e=ce,xe=pe;be=r.lencode[xe+((c&(1<<fe+_e)-1)>>fe)],de=be>>>24,ce=be>>>16&255,pe=65535&be,!(fe+de<=p);){if(0===h)break e;h--,c+=s[l++]<<p,p+=8}c>>>=fe,p-=fe,r.back+=fe}if(c>>>=de,p-=de,r.back+=de,r.length=pe,0===ce){r.mode=re;break}if(32&ce){r.back=-1,r.mode=G;break}if(64&ce){e.msg="invalid literal/length code",r.mode=le;break}r.extra=15&ce,r.mode=ee;case ee:if(r.extra){for(Ee=r.extra;p<Ee;){if(0===h)break e;h--,c+=s[l++]<<p,p+=8}r.length+=c&(1<<r.extra)-1,c>>>=r.extra,p-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=te;case te:for(;be=r.distcode[c&(1<<r.distbits)-1],de=be>>>24,ce=be>>>16&255,pe=65535&be,!(de<=p);){if(0===h)break e;h--,c+=s[l++]<<p,p+=8}if(0==(240&ce)){for(fe=de,_e=ce,xe=pe;be=r.distcode[xe+((c&(1<<fe+_e)-1)>>fe)],de=be>>>24,ce=be>>>16&255,pe=65535&be,!(fe+de<=p);){if(0===h)break e;h--,c+=s[l++]<<p,p+=8}c>>>=fe,p-=fe,r.back+=fe}if(c>>>=de,p-=de,r.back+=de,64&ce){e.msg="invalid distance code",r.mode=le;break}r.offset=pe,r.extra=15&ce,r.mode=ie;case ie:if(r.extra){for(Ee=r.extra;p<Ee;){if(0===h)break e;h--,c+=s[l++]<<p,p+=8}r.offset+=c&(1<<r.extra)-1,c>>>=r.extra,p-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=le;break}r.mode=ne;case ne:if(0===d)break e;if(m=f-d,r.offset>m){if(m=r.offset-m,m>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=le;break}m>r.wnext?(m-=r.wnext,x=r.wsize-m):x=r.wnext-m,m>r.length&&(m=r.length),he=r.window}else he=a,x=u-r.offset,m=r.length;m>d&&(m=d),d-=m,r.length-=m;do{a[u++]=he[x++]}while(--m);0===r.length&&(r.mode=Q);break;case re:if(0===d)break e;a[u++]=r.length,d--,r.mode=Q;break;case se:if(r.wrap){for(;p<32;){if(0===h)break e;h--,c|=s[l++]<<p,p+=8}if(f-=d,e.total_out+=f,r.total+=f,4&r.wrap&&f&&(e.adler=r.check=r.flags?n(r.check,a,f,u-f):t(r.check,a,f,u-f)),f=d,4&r.wrap&&(r.flags?c:ge(c))!==r.check){e.msg="incorrect data check",r.mode=le;break}c=0,p=0}r.mode=oe;case oe:if(r.wrap&&r.flags){for(;p<32;){if(0===h)break e;h--,c+=s[l++]<<p,p+=8}if(4&r.wrap&&c!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=le;break}c=0,p=0}r.mode=ae;case ae:we=E;break e;case le:we=I;break e;case ue:return F;default:return N}return e.next_out=u,e.avail_out=d,e.next_in=l,e.avail_in=h,r.hold=c,r.bits=p,(r.wsize||f!==e.avail_out&&r.mode<le&&(r.mode<se||i!==S))&&Oe(e,e.output,e.next_out,f-e.avail_out),g-=e.avail_in,f-=e.avail_out,e.total_in+=g,e.total_out+=f,r.total+=f,4&r.wrap&&f&&(e.adler=r.check=r.flags?n(r.check,a,f,e.next_out-f):t(r.check,a,f,e.next_out-f)),e.data_type=r.bits+(r.last?64:0)+(r.mode===G?128:0)+(r.mode===Z||r.mode===Y?256:0),(0===g&&0===f||i===S)&&we===O&&(we=M),we},inflateEnd:e=>{if(me(e))return N;let t=e.state;return t.window&&(t.window=null),e.state=null,O},inflateGetHeader:(e,t)=>{if(me(e))return N;const i=e.state;return 0==(2&i.wrap)?N:(i.head=t,t.done=!1,O)},inflateSetDictionary:(e,i)=>{const n=i.length;let r,s,o;return me(e)?N:(r=e.state,0!==r.wrap&&r.mode!==z?N:r.mode===z&&(s=1,s=t(s,i,n,0),s!==r.check)?I:(o=Oe(e,i,n,n),o?(r.mode=ue,F):(r.havedict=1,O)))},inflateInfo:"pako inflate (from Nodeca project)"};const Ce=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Ne=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(const t in i)Ce(i,t)&&(e[t]=i[t])}}return e},Ie={assign:Ne,flattenChunks:e=>{let t=0;for(let i=0,n=e.length;i<n;i++)t+=e[i].length;const i=new Uint8Array(t);for(let t=0,n=0,r=e.length;t<r;t++){let r=e[t];i.set(r,n),n+=r.length}return i}};let Fe=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Fe=!1}const Me=new Uint8Array(256);for(let e=0;e<256;e++)Me[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Me[254]=Me[254]=1;const De=(e,t)=>{if(t<65534&&e.subarray&&Fe)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let i="";for(let n=0;n<t;n++)i+=String.fromCharCode(e[n]);return i};var Re={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,i,n,r,s,o=e.length,a=0;for(r=0;r<o;r++)i=e.charCodeAt(r),55296==(64512&i)&&r+1<o&&(n=e.charCodeAt(r+1),56320==(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),r++)),a+=i<128?1:i<2048?2:i<65536?3:4;for(t=new Uint8Array(a),s=0,r=0;s<a;r++)i=e.charCodeAt(r),55296==(64512&i)&&r+1<o&&(n=e.charCodeAt(r+1),56320==(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),r++)),i<128?t[s++]=i:i<2048?(t[s++]=192|i>>>6,t[s++]=128|63&i):i<65536?(t[s++]=224|i>>>12,t[s++]=128|i>>>6&63,t[s++]=128|63&i):(t[s++]=240|i>>>18,t[s++]=128|i>>>12&63,t[s++]=128|i>>>6&63,t[s++]=128|63&i);return t},buf2string:(e,t)=>{const i=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let n,r;const s=new Array(2*i);for(r=0,n=0;n<i;){let t=e[n++];if(t<128){s[r++]=t;continue}let o=Me[t];if(o>4)s[r++]=65533,n+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&n<i;)t=t<<6|63&e[n++],o--;o>1?s[r++]=65533:t<65536?s[r++]=t:(t-=65536,s[r++]=55296|t>>10&1023,s[r++]=56320|1023&t)}}return De(s,r)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let i=t-1;for(;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+Me[e[i]]>t?i:t}},Pe={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function Ae(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Ve=Ae;function Le(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Be=Le;const Ue=Object.prototype.toString,{Z_NO_FLUSH:Xe,Z_FINISH:je,Z_OK:ke,Z_STREAM_END:ze,Z_NEED_DICT:Ge,Z_STREAM_ERROR:He,Z_DATA_ERROR:qe,Z_MEM_ERROR:Ye}=x;function We(e){this.options=Ie.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ve,this.strm.avail_out=0;let i=Ee.inflateInit2(this.strm,t.windowBits);if(i!==ke)throw new Error(Pe[i]);if(this.header=new Be,Ee.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Re.string2buf(t.dictionary):"[object ArrayBuffer]"===Ue.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=Ee.inflateSetDictionary(this.strm,t.dictionary),i!==ke)))throw new Error(Pe[i])}function $e(e,t){const i=new We(t);if(i.push(e),i.err)throw i.msg||Pe[i.err];return i.result}function Je(e,t){return(t=t||{}).raw=!0,$e(e,t)}We.prototype.push=function(e,t){const i=this.strm,n=this.options.chunkSize,r=this.options.dictionary;let s,o,a;if(this.ended)return!1;for(o=t===~~t?t:!0===t?je:Xe,"[object ArrayBuffer]"===Ue.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(n),i.next_out=0,i.avail_out=n),s=Ee.inflate(i,o),s===Ge&&r&&(s=Ee.inflateSetDictionary(i,r),s===ke?s=Ee.inflate(i,o):s===qe&&(s=Ge));i.avail_in>0&&s===ze&&i.state.wrap>0&&0!==e[i.next_in];)Ee.inflateReset(i),s=Ee.inflate(i,o);switch(s){case He:case qe:case Ge:case Ye:return this.onEnd(s),this.ended=!0,!1}if(a=i.avail_out,i.next_out&&(0===i.avail_out||s===ze))if("string"===this.options.to){let e=Re.utf8border(i.output,i.next_out),t=i.next_out-e,r=Re.buf2string(i.output,e);i.next_out=t,i.avail_out=n-t,t&&i.output.set(i.output.subarray(e,e+t),0),this.onData(r)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(s!==ke||0!==a){if(s===ze)return s=Ee.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},We.prototype.onData=function(e){this.chunks.push(e)},We.prototype.onEnd=function(e){e===ke&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Ie.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Ke=We,Ze=$e,Qe=Je,et=$e,tt=x,it={Inflate:Ke,inflate:Ze,inflateRaw:Qe,ungzip:et,constants:tt};e.Inflate=Ke,e.constants=tt,e.default=it,e.inflate=Ze,e.inflateRaw=Qe,e.ungzip=et,Object.defineProperty(e,"__esModule",{value:!0})}(t)},296:function(e,t){var i,n,r;n=[],void 0===(r="function"==typeof(i=function(){var e=function(e){return e.reduce((function(e,t){return 2*e+t}),0)},t=function(e){for(var t=[],i=7;i>=0;i--)t.push(!!(e&1<<i));return t},i=function(e){this.data=e,this.len=this.data.length,this.pos=0,this.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return e instanceof Uint8Array?e[this.pos++]:255&e.charCodeAt(this.pos++)},this.readBytes=function(e){for(var t=[],i=0;i<e;i++)t.push(this.readByte());return t},this.read=function(e){for(var t="",i=0;i<e;i++)t+=String.fromCharCode(this.readByte());return t},this.readUnsigned=function(){var e=this.readBytes(2);return(e[1]<<8)+e[0]}},n=function(e,t){for(var i,n,r=0,s=function(e){for(var i=0,n=0;n<e;n++)t.charCodeAt(r>>3)&1<<(7&r)&&(i|=1<<n),r++;return i},o=[],a=1<<e,l=a+1,u=e+1,h=[],d=function(){h=[],u=e+1;for(var t=0;t<a;t++)h[t]=[t];h[a]=[],h[l]=null};;)if(n=i,(i=s(u))!==a){if(i===l)break;if(i<h.length)n!==a&&h.push(h[n].concat(h[i][0]));else{if(i!==h.length)throw new Error("Invalid LZW code.");h.push(h[n].concat(h[n][0]))}o.push.apply(o,h[i]),h.length===1<<u&&u<12&&u++}else d();return o},r=function(i,r){r||(r={});var s=function(e){for(var t=[],n=0;n<e;n++)t.push(i.readBytes(3));return t},o=function(){var e,t;t="";do{e=i.readByte(),t+=i.read(e)}while(0!==e);return t},a=function(){var n={};if(n.sig=i.read(3),n.ver=i.read(3),"GIF"!==n.sig)throw new Error("Not a GIF file.");n.width=i.readUnsigned(),n.height=i.readUnsigned();var o=t(i.readByte());n.gctFlag=o.shift(),n.colorRes=e(o.splice(0,3)),n.sorted=o.shift(),n.gctSize=e(o.splice(0,3)),n.bgColor=i.readByte(),n.pixelAspectRatio=i.readByte(),n.gctFlag&&(n.gct=s(1<<n.gctSize+1)),r.hdr&&r.hdr(n)},l=function(n){var s=function(n){i.readByte();var s=t(i.readByte());n.reserved=s.splice(0,3),n.disposalMethod=e(s.splice(0,3)),n.userInput=s.shift(),n.transparencyGiven=s.shift(),n.delayTime=i.readUnsigned(),n.transparencyIndex=i.readByte(),n.terminator=i.readByte(),r.gce&&r.gce(n)},a=function(e){e.comment=o(),r.com&&r.com(e)},l=function(e){i.readByte(),e.ptHeader=i.readBytes(12),e.ptData=o(),r.pte&&r.pte(e)},u=function(e){var t=function(e){i.readByte(),e.unknown=i.readByte(),e.iterations=i.readUnsigned(),e.terminator=i.readByte(),r.app&&r.app.NETSCAPE&&r.app.NETSCAPE(e)},n=function(e){e.appData=o(),r.app&&r.app[e.identifier]&&r.app[e.identifier](e)};i.readByte(),e.identifier=i.read(8),e.authCode=i.read(3),"NETSCAPE"===e.identifier?t(e):n(e)},h=function(e){e.data=o(),r.unknown&&r.unknown(e)};switch(n.label=i.readByte(),n.label){case 249:n.extType="gce",s(n);break;case 254:n.extType="com",a(n);break;case 1:n.extType="pte",l(n);break;case 255:n.extType="app",u(n);break;default:n.extType="unknown",h(n)}},u=function(a){var l=function(e,t){for(var i=new Array(e.length),n=e.length/t,r=function(n,r){var s=e.slice(r*t,(r+1)*t);i.splice.apply(i,[n*t,t].concat(s))},s=[0,4,2,1],o=[8,8,4,2],a=0,l=0;l<4;l++)for(var u=s[l];u<n;u+=o[l])r(u,a),a++;return i};a.leftPos=i.readUnsigned(),a.topPos=i.readUnsigned(),a.width=i.readUnsigned(),a.height=i.readUnsigned();var u=t(i.readByte());a.lctFlag=u.shift(),a.interlaced=u.shift(),a.sorted=u.shift(),a.reserved=u.splice(0,2),a.lctSize=e(u.splice(0,3)),a.lctFlag&&(a.lct=s(1<<a.lctSize+1)),a.lzwMinCodeSize=i.readByte();var h=o();a.pixels=n(a.lzwMinCodeSize,h),a.interlaced&&(a.pixels=l(a.pixels,a.width)),r.img&&r.img(a)},h=function(){var e={};switch(e.sentinel=i.readByte(),String.fromCharCode(e.sentinel)){case"!":e.type="ext",l(e);break;case",":e.type="img",u(e);break;case";":e.type="eof",r.eof&&r.eof(e);break;default:throw new Error("Unknown block: 0x"+e.sentinel.toString(16))}"eof"!==e.type&&setTimeout(h,0)};a(),setTimeout(h,0)};return function(e){var t,n,s={vp_l:0,vp_t:0,vp_w:null,vp_h:null,c_w:null,c_h:null};for(var o in e)s[o]=e[o];s.vp_w&&s.vp_h&&(s.is_vp=!0);var a=null,l=!1,u=null,h=null,d=null,c=null,p=null,g=null,f=null,m=!0,_=!0,x=!1,y=[],w=[],b=s.gif;void 0===s.auto_play&&(s.auto_play=!b.getAttribute("rel:auto_play")||"1"==b.getAttribute("rel:auto_play"));var S,T,v,O,E=s.hasOwnProperty("on_end")?s.on_end:null,C=s.hasOwnProperty("on_error")?s.on_error:null,N=s.hasOwnProperty("loop_delay")?s.loop_delay:0,I=s.hasOwnProperty("loop_mode")?s.loop_mode:"auto",F=!s.hasOwnProperty("draw_while_loading")||s.draw_while_loading,M=!!F&&(!s.hasOwnProperty("show_progress_bar")||s.show_progress_bar),D=s.hasOwnProperty("progressbar_height")?s.progressbar_height:25,R=s.hasOwnProperty("progressbar_background_color")?s.progressbar_background_color:"rgba(255,255,255,0.4)",P=s.hasOwnProperty("progressbar_foreground_color")?s.progressbar_foreground_color:"rgba(255,0,22,.8)",A=function(){u=null,h=null,p=d,d=null,g=null},V=function(){try{r(t,$)}catch(e){X("parse")}},L=function(e,t){S.width=e*K(),S.height=t*K(),v.style.minWidth=e*K()+"px",O.width=e,O.height=t,O.style.width=e+"px",O.style.height=t+"px",O.getContext("2d").setTransform(1,0,0,1,0,0)},B=function(e,t){w[e]?(void 0!==t.x&&(w[e].x=t.x),void 0!==t.y&&(w[e].y=t.y)):w[e]=t},U=function(e,t,i){if(i&&M){var n,r,o,a=D;s.is_vp?x?(r=(s.vp_t+s.vp_h-a)/K(),a/=K(),n=s.vp_l/K()+e/t*(s.vp_w/K()),o=S.width/K()):(r=s.vp_t+s.vp_h-a,n=s.vp_l+e/t*s.vp_w,o=S.width):(r=(S.height-a)/(x?K():1),n=e/t*S.width/(x?K():1),o=S.width/(x?K():1),a/=x?K():1),T.fillStyle=R,T.fillRect(n,r,o-n,a),T.fillStyle=P,T.fillRect(0,r,n,a)}},X=function(e){var t=function(){T.fillStyle="black",T.fillRect(0,0,s.c_w?s.c_w:n.width,s.c_h?s.c_h:n.height),T.strokeStyle="red",T.lineWidth=3,T.moveTo(0,0),T.lineTo(s.c_w?s.c_w:n.width,s.c_h?s.c_h:n.height),T.moveTo(0,s.c_h?s.c_h:n.height),T.lineTo(s.c_w?s.c_w:n.width,0),T.stroke()};a=e,n={width:b.width,height:b.height},y=[],t(),e&&C(e)},j=function(e){L((n=e).width,n.height)},k=function(e){z(),A(),u=e.transparencyGiven?e.transparencyIndex:null,h=e.delayTime,d=e.disposalMethod},z=function(){g&&(y.push({data:g.getImageData(0,0,n.width,n.height),delay:h}),w.push({x:0,y:0}))},G=function(e){g||(g=O.getContext("2d"));var t=y.length,i=e.lctFlag?e.lct:n.gct;t>0&&(3===p?null!==c?g.putImageData(y[c].data,0,0):g.clearRect(f.leftPos,f.topPos,f.width,f.height):c=t-1,2===p&&g.clearRect(f.leftPos,f.topPos,f.width,f.height));var r=g.getImageData(e.leftPos,e.topPos,e.width,e.height);e.pixels.forEach((function(e,t){e!==u&&(r.data[4*t+0]=i[e][0],r.data[4*t+1]=i[e][1],r.data[4*t+2]=i[e][2],r.data[4*t+3]=255)})),g.putImageData(r,e.leftPos,e.topPos),x||(T.scale(K(),K()),x=!0),F&&(T.drawImage(O,0,0),F=s.auto_play),f=e},H=function(){var e,t,i,n=-1,r=0,o=function(){return(n+(_?1:-1)+y.length)%y.length},l=function(e){n+=e,h()},u=(e=!1,t=function(){null!==E&&E(b),r++,!1!==I||r<0?i():(e=!1,m=!1)},i=function(){if(e=m){l(1);var r=10*y[n].delay;r||(r=100),0===o()?(r+=N,setTimeout(t,r)):setTimeout(i,r)}},function(){e||setTimeout(i,0)}),h=function(){var e;(n=parseInt(n,10))>y.length-1&&(n=0),n<0&&(n=0),e=w[n],O.getContext("2d").putImageData(y[n].data,e.x,e.y),T.globalCompositeOperation="copy",T.drawImage(O,0,0)},d=function(){m=!0,u()};return{init:function(){a||(s.c_w&&s.c_h||T.scale(K(),K()),s.auto_play?u():(n=0,h()))},step:u,play:d,pause:function(){m=!1},playing:m,move_relative:l,current_frame:function(){return n},length:function(){return y.length},move_to:function(e){n=e,h()}}}(),q=function(e){U(t.pos,t.data.length,e)},Y=function(){},W=function(e,t){return function(i){e(i),q(t)}},$={hdr:W(j),gce:W(k),com:W(Y),app:{NETSCAPE:W(Y)},img:W(G,!0),eof:function(e){z(),q(!1),s.c_w&&s.c_h||(S.width=n.width*K(),S.height=n.height*K()),H.init(),l=!1,Q&&Q(b)}},J=function(){var e=b.parentNode,t=document.createElement("div");S=document.createElement("canvas"),T=S.getContext("2d"),v=document.createElement("div"),O=document.createElement("canvas"),t.width=S.width=b.width,t.height=S.height=b.height,v.style.minWidth=b.width+"px",t.className="jsgif",v.className="jsgif_toolbar",t.appendChild(S),t.appendChild(v),e.insertBefore(t,b),e.removeChild(b),s.c_w&&s.c_h&&L(s.c_w,s.c_h),Z=!0},K=function(){return s.max_width&&n&&n.width>s.max_width?s.max_width/n.width:1},Z=!1,Q=!1,ee=function(e){return!l&&(Q=e||!1,l=!0,y=[],A(),c=null,p=null,g=null,f=null,!0)},te=function(){return y.reduce((function(e,t){return e+t.delay}),0)};return{play:H.play,pause:H.pause,move_relative:H.move_relative,move_to:H.move_to,get_playing:function(){return m},get_canvas:function(){return S},get_canvas_scale:function(){return K()},get_loading:function(){return l},get_auto_play:function(){return s.auto_play},get_length:function(){return H.length()},get_frames:function(){return y},get_duration:function(){return te()},get_duration_ms:function(){return 10*te()},get_current_frame:function(){return H.current_frame()},load_url:function(e,n){if(ee(n)){var r=new XMLHttpRequest;r.open("GET",e,!0),"overrideMimeType"in r?r.overrideMimeType("text/plain; charset=x-user-defined"):"responseType"in r?r.responseType="arraybuffer":r.setRequestHeader("Accept-Charset","x-user-defined"),r.onloadstart=function(){Z||J()},r.onload=function(e){200!=this.status&&X("xhr - response"),"response"in this||(this.response=new VBArray(this.responseText).toArray().map(String.fromCharCode).join(""));var n=this.response;n.toString().indexOf("ArrayBuffer")>0&&(n=new Uint8Array(n)),t=new i(n),setTimeout(V,0)},r.onprogress=function(e){e.lengthComputable&&U(e.loaded,e.total,!0)},r.onerror=function(){X("xhr")},r.send()}},load:function(e){this.load_url(b.getAttribute("rel:animated_src")||b.src,e)},load_raw:function(e,n){ee(n)&&(Z||J(),t=new i(e),setTimeout(V,0))},set_frame_offset:B}}})?i.apply(t,n):i)||(e.exports=r)}},i={};function n(e){var r=i[e];if(void 0!==r)return r.exports;var s=i[e]={exports:{}};return t[e].call(s.exports,s,s.exports,n),s.exports}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};(()=>{n.d(r,{Z:()=>fM});const t=new Map;Object.defineProperty(t,"add",{value(e,i,n){if(t.hasOwnProperty(e));else{const i=window[Symbol.for("X_ITE.X3D-9.1.6")];i&&(i[e]=n),t[e]=n}t.set(i,n)}}),t.add("Namespace","x_ite/Namespace",t);const i=t;let s=0,o=0,a=0,l=0;const u={CONNECTION_ERROR:s++,BROWSER_EVENT:s++,INITIALIZED_EVENT:s++,SHUTDOWN_EVENT:s++,INITIALIZED_ERROR:s++,NOT_STARTED_STATE:o++,IN_PROGRESS_STATE:o++,COMPLETE_STATE:o++,FAILED_STATE:o++,initializeOnly:1,inputOnly:2,outputOnly:4,inputOutput:7,SFBool:a++,SFColor:a++,SFColorRGBA:a++,SFDouble:a++,SFFloat:a++,SFImage:a++,SFInt32:a++,SFMatrix3d:a++,SFMatrix3f:a++,SFMatrix4d:a++,SFMatrix4f:a++,SFNode:a++,SFRotation:a++,SFString:a++,SFTime:a++,SFVec2d:a++,SFVec2f:a++,SFVec3d:a++,SFVec3f:a++,SFVec4d:a++,SFVec4f:a++,VrmlMatrix:a++,MFBool:a++,MFColor:a++,MFColorRGBA:a++,MFDouble:a++,MFFloat:a++,MFImage:a++,MFInt32:a++,MFMatrix3d:a++,MFMatrix3f:a++,MFMatrix4d:a++,MFMatrix4f:a++,MFNode:a++,MFRotation:a++,MFString:a++,MFTime:a++,MFVec2d:a++,MFVec2f:a++,MFVec3d:a++,MFVec3f:a++,MFVec4d:a++,MFVec4f:a++,X3DBaseNode:l,[Symbol.toStringTag]:"X3DConstants"};Object.defineProperty(u,"addNode",{value({typeName:e}){this.hasOwnProperty(e)||(this[e]=++l)}});const h=u;i.add("X3DConstants","x_ite/Base/X3DConstants",h);const d=h,c={radians:e=>e*(Math.PI/180),degrees:e=>e*(180/Math.PI),random:(e,t)=>e+Math.random()*(t-e),fract:e=>e%1,clamp:(e,t,i)=>Math.min(Math.max(e,t),i),interval:(e,t,i)=>e>=i?(e-t)%(i-t)+t:e<t?(e-i)%(i-t)+i:e,roundToMultiple:(e,t)=>Math.ceil(e/t)*t,lerp:(e,t,i)=>e+i*(t-e),slerp(e,t,i){let n=e.dot(t);if(n>=1)return e;n<0&&(n=-n,t.negate());const r=Math.acos(n),s=Math.sin(r),o=Math.sin((1-i)*r)/s,a=Math.sin(i*r)/s;return e.x=e.x*o+t.x*a,e.y=e.y*o+t.y*a,e.z=e.z*o+t.z*a,e.w=e.w*o+t.w*a,e},simpleSlerp(e,t,i){const n=e.dot(t);if(n>=1)return e;const r=Math.acos(n),s=Math.sin(r),o=Math.sin((1-i)*r)/s,a=Math.sin(i*r)/s;return e.x=e.x*o+t.x*a,e.y=e.y*o+t.y*a,e.z=e.z*o+t.z*a,e.w=e.w*o+t.w*a,e},isPowerOfTwo:e=>0==(e-1&e),nextPowerOfTwo:e=>c.isPowerOfTwo(e)?e:1<<32-Math.clz32(e),bitCount:e=>16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24,cmp:(e,t)=>e>t?1:e<t?-1:0,less:(e,t)=>e<t,greater:(e,t)=>e>t,lowerBound(e,t,i,n,r=c.less){let s=0,o=0,a=i-t;for(;a>0;)o=a>>>1,s=t+o,r(e[s],n)?(t=++s,a-=o+1):a=o;return t},upperBound(e,t,i,n,r=c.less){let s=0,o=0,a=i-t;for(;a>0;)o=a>>>1,s=t+o,r(n,e[s])?a=o:(t=++s,a-=o+1);return t}},p=c;i.add("Algorithm","standard/Math/Algorithm",p);const g=p,f=function(e,t=""){if((t=String(t))&&!e.has(t))return t;let i=t=t.replace(/_\d+$/,""),n=1,r=1;for(;e.has(i)||!i;)n=r,r<<=1,i=`${t}_${n}`;if(n>>>=1,r>>>=1,n&&r){for(;n<r;){const i=n+r>>>1;e.has(`${t}_${i}`)?n=i+1:r=i}i=`${t}_${n}`}return i};function m({style:e="TIDY",indent:t="",precision:i=7,doublePrecision:n=15,html:r=!1,closingTags:s=!1}){this.string="",this.indent=t,this.listIndent=t,this.precision=g.clamp(i,1,21),this.doublePrecision=g.clamp(n,1,21),this.html=r,this.closingTags=r||s,this.floatFormat=new Intl.NumberFormat("en",{notation:"standard",maximumSignificantDigits:this.precision,useGrouping:!1}).format,this.floatExponentialFormat=new Intl.NumberFormat("en",{notation:"scientific",maximumSignificantDigits:this.precision,useGrouping:!1}).format,this.doubleFormat=new Intl.NumberFormat("en",{notation:"standard",maximumSignificantDigits:this.doublePrecision,useGrouping:!1}).format,this.doubleExponentialFormat=new Intl.NumberFormat("en",{notation:"scientific",maximumSignificantDigits:this.doublePrecision,useGrouping:!1}).format,this.Style(e),this.executionContextStack=[],this.importedNodesIndex=new Map,this.exportedNodesIndex=new Map,this.nodes=new Set,this.names=new Map,this.namesByNode=new Map,this.importedNames=new Map,this.routeNodes=new Set,this.level=0,this.containerFields=[],this.units=!0,this.unitCategories=[],this.PushExecutionContext(null)}Object.assign(m.prototype,{Style(e){switch(e){case"CLEAN":this.listIndent="",this.comma=" ",this.break=" ",this.tidyBreak="",this.tidySpace="",this.indentChar="",this.listEnclosure="",this.listBreak="",this.listIndentChar="",this.attribBreak=" ";break;case"SMALL":this.listIndent="",this.comma=",",this.break="\n",this.tidyBreak="\n",this.tidySpace="",this.indentChar="",this.listEnclosure="",this.listBreak="",this.listIndentChar="",this.attribBreak=" ";break;case"COMPACT":this.listIndent="",this.comma=",",this.break="\n",this.tidyBreak="\n",this.tidySpace=" ",this.indentChar="  ",this.listEnclosure=" ",this.listBreak=" ",this.listIndentChar="",this.attribBreak=" ";break;default:this.comma=",",this.break="\n",this.tidyBreak="\n",this.tidySpace=" ",this.indentChar="  ",this.listEnclosure="\n",this.listBreak="\n",this.listIndentChar="  ",this.attribBreak="\n"}},Comma(){return this.comma},Break(){return this.break},TidyBreak(){return this.tidyBreak},ForceBreak:()=>"\n",Space:()=>" ",TidySpace(){return this.tidySpace},ListStart(){return this.listEnclosure},ListEnd(){return this.listEnclosure},ListBreak(){return this.listBreak},AttribBreak(){return this.attribBreak},Indent(){return this.indent},ListIndent(){return this.listIndent},IncIndent(){return this.indent+=this.indentChar,this.listIndent+=this.listIndentChar,""},DecIndent(){return this.indent=this.indent.slice(0,this.indent.length-this.indentChar.length),this.listIndent=this.listIndent.slice(0,this.listIndent.length-this.listIndentChar.length),""},FloatFormat(e){if(Number.isFinite(e)){const t=Math.log10(Math.abs(e));return this.precision>t&&t>=-4||0===e?this.floatFormat(e):this.floatExponentialFormat(e).toLowerCase()}return String(e)},DoubleFormat(e){if(Number.isFinite(e)){const t=Math.log10(Math.abs(e));return this.doublePrecision>t&&t>=-4||0===e?this.doubleFormat(e):this.doubleExponentialFormat(e).toLowerCase()}return String(e)},PushExecutionContext(e){this.executionContextStack.push(e),this.names.has(e)||this.names.set(e,new Set),this.importedNodesIndex.has(e)||this.importedNodesIndex.set(e,new Set),this.exportedNodesIndex.has(e)||this.exportedNodesIndex.set(e,new Set)},PopExecutionContext(){this.executionContextStack.pop(),this.ExecutionContext()||(this.importedNodesIndex.clear(),this.exportedNodesIndex.clear())},ExecutionContext(){return this.executionContextStack.at(-1)},EnterScope(){++this.level},LeaveScope(){--this.level,0===this.level&&(this.nodes.clear(),this.namesByNode.clear(),this.importedNames.clear())},NamedNodes(e){const t=this.names.get(this.ExecutionContext()),i=this.namesByNode;for(const n of e)n.getNodeName().match(/^_\d+$/)||(t.add(n.getNodeName()),i.set(n.getValue(),n.getNodeName()))},ExportedNodes(e){const t=this.exportedNodesIndex.get(this.ExecutionContext());for(const i of e)t.add(i.getLocalNode())},ImportedNodes(e){const t=this.importedNodesIndex.get(this.ExecutionContext());for(const i of e)try{t.add(i.getInlineNode())}catch{}},AddImportedNode(e,t){this.importedNames.set(e,t)},AddRouteNode(e){this.routeNodes.add(e)},ExistsRouteNode(e){return this.namesByNode.get(e)||this.routeNodes.has(e)},IsSharedNode(e){return this.ExecutionContext()!==e.getExecutionContext()},AddNode(e){this.nodes.add(e),this.AddRouteNode(e)},ExistsNode(e){return this.nodes.has(e)},Name(e){const t=this.namesByNode.get(e);if(void 0!==t)return t;{const t=this.names.get(this.ExecutionContext()),i=e.getName();if(i.match(/^(?:_\d+)?$/)&&!this.NeedsName(e))return"";const n=f(t,i);return t.add(n),this.namesByNode.set(e,n),n}},NeedsName(e){if(e.getCloneCount()>1)return!0;if(e.hasRoutes())return!0;const t=e.getExecutionContext(),i=this.importedNodesIndex.get(t);if(!i){const i=this.exportedNodesIndex.get(t);return!(!i||!i.has(e))}return!!i.has(e)||void 0},LocalName(e){const t=this.importedNames.get(e);if(void 0!==t)return t;if(this.ExistsNode(e))return this.Name(e);throw new Error(`Couldn't get local name for node '${e.getTypeName()}'.`)},PushContainerField(e){this.containerFields.push(e)},PopContainerField(){this.containerFields.pop()},ContainerField(){return this.containerFields.length?this.containerFields[this.containerFields.length-1]:null},AccessType(e){switch(e){case d.initializeOnly:return"initializeOnly";case d.inputOnly:return"inputOnly";case d.outputOnly:return"outputOnly";case d.inputOutput:return"inputOutput"}},SetUnits(e){this.units=e},GetUnits(){return this.units},PushUnitCategory(e){this.unitCategories.push(e)},PopUnitCategory(){this.unitCategories.pop()},Unit(e){return 0==this.unitCategories.length?e:this.unitCategories.at(-1)},ToUnit(e,t){if(this.units){const i=this.ExecutionContext();if(i)return i.toUnit(e,t)}return t},XMLEncode:(()=>{const e={"\\":"\\\\","\r":"&#xD;","\n":"&#xA;","\t":"&#x9;",'"':'\\"',"'":"&apos;","<":"&lt;",">":"&gt;","&":"&amp;"},t=/([\\\r\n\t"'<>&])/g;return function(i){return i.replace(t,(t=>e[t]))}})(),XMLEncodeSourceText:(()=>{const e={"\\":"\\\\",'"':'\\"',"'":"&apos;","<":"&lt;",">":"&gt;","&":"&amp;"},t=/([\\"'<>&])/g;return function(i){return i.replace(t,(t=>e[t]))}})(),JSONEncode:(()=>{const e={"\\":"\\\\","\r":"\\r","\n":"\\n","\t":"\\t",'"':'\\"'},t=/([\\\t\n\r"])/g;return function(i){return i.replace(t,(t=>e[t]))}})(),JSONNumber(e){switch(e){case"NaN":case"Infinity":case"-Infinity":return'"'+e+'"';default:return e}},JSONRemoveComma(){this.string=this.string.trimEnd(),this.string.endsWith(",")&&(this.string=this.string.slice(0,-1)),this.string+=this.TidyBreak()}});for(const e of Object.keys(m.prototype))Object.defineProperty(m.prototype,e,{enumerable:!1});const _=m;i.add("Generator","x_ite/InputOutput/Generator",_);const x=_,y={assign:(()=>{function e(e,t){this.set(t,e)}return function(t,i){return t.clear(),i.forEach(e,t),t}})(),values:(()=>{function e(e){this.push(e)}return function(t,i){return t.length=0,i.forEach(e,t),t}})()},w=y;i.add("MapUtilities","standard/Utility/MapUtilities",w);const b=w;i.add("DEVELOPMENT","x_ite/DEVELOPMENT",false);const S=false,T=Symbol(),v=Symbol(),O=Symbol(),E=Symbol();function C(){}Object.assign(C.prototype,{[T]:"",[v]:new Map,[O]:[],[E]:new Map,getId(){return C.getId(this)},getTypeName(){return this.constructor.typeName},setName(e){this[T]=e},getName(){return this[T]},getDisplayName(){return this[T]},hasInterest(e,t){return this[v].has(C.getInterestId(e,t))},addInterest(e,t,...i){this[v]===C.prototype[v]&&(this[v]=new Map,this[O]=[]);const n=C.getInterestId(e,t),r=t[e];this[v].set(n,r.bind(t,...i,this))},removeInterest(e,t){this[v].delete(C.getInterestId(e,t))},getInterests(){return this[v]},processInterests(){if(this[v].size)for(const e of b.values(this[O],this[v]))e()},getUserData(e){return this[E].get(e)??this[E].map?.get(e)},setUserData(e,t){try{this[E]===C.prototype[E]&&(this[E]=new WeakMap),this[E].set(e,t)}catch{this[E].map||(this[E].map=new Map),this[E].map.set(e,t)}},removeUserData(e){this[E].delete(e)||this[E].map?.delete(e)},toString(e=Object.prototype){const t=new x(e);return e.scene&&t.PushExecutionContext(e.scene),this.toStream(t),t.string},toVRMLString(e=Object.prototype){const t=new x(e);return e.scene&&t.PushExecutionContext(e.scene),this.toVRMLStream(t),t.string},toXMLString(e=Object.prototype){const t=new x(e);return e.scene&&t.PushExecutionContext(e.scene),this.toXMLStream(t),t.string},toJSONString(e=Object.prototype){const t=new x(e);return e.scene&&t.PushExecutionContext(e.scene),this.toJSONStream(t),t.string},toStream(e){e.string=Object.prototype.toString.call(this)},dispose(){this[v].clear(),this[E].map?.clear()}});for(const e of Object.keys(C.prototype))Object.defineProperty(C.prototype,e,{enumerable:!1});Object.defineProperties(C.prototype,{[Symbol.toStringTag]:{get(){return this.getTypeName()}}}),Object.assign(C,{getId:(()=>{const e=new WeakMap;let t=0;return function(i){const n=e.get(i);return void 0!==n?n:(e.set(i,++t),t)}})(),getInterestId(e,t){return`${this.getId(t)}.${this.getId(t[e])}`}});const N=C;i.add("X3DObject","x_ite/Base/X3DObject",N);const I=N,F=Symbol(),M=Symbol(),D=Symbol(),R=Symbol();Symbol();function P(){I.call(this)}Object.assign(Object.setPrototypeOf(P.prototype,I.prototype),{[F]:0,[M]:!1,[D]:new Set,[R]:!1,isInitializable:()=>!0,isInput:()=>!1,isOutput:()=>!1,setModificationTime(e){this[F]=e},getModificationTime(){return this[F]},setTainted(e){this[M]=e},isTainted(){return this[M]},addEvent(){this.setModificationTime(Date.now());for(const e of this[D])e.addEvent(this)},addEventObject(e,t){this.setModificationTime(Date.now());for(const e of this[D])e.addEventObject(this,t)},processEvent(){this.setTainted(!1),this.processInterests()},isPrivate(){return this[R]},setPrivate(e){this[R]=e},collectCloneCount(){let e=0;for(const t of this[D])t[R]||(e+=t.collectCloneCount());return e},addParent(e){this[D]===P.prototype[D]&&(this[D]=new Set),this[D].add(e),this.parentsChanged()},removeParent(e){this[D].delete(e),this.parentsChanged()},getParents(){return this[D]},parentsChanged(){},dispose(){this[D].clear(),I.prototype.dispose.call(this)}});for(const e of Object.keys(P.prototype))Object.defineProperty(P.prototype,e,{enumerable:!1});const A=P;i.add("X3DChildObject","x_ite/Base/X3DChildObject",A);const V=A,L=Object.assign([],{create(e){const t=this.pop()??new Set;return t.field=e,t.clear(),t},copy(e){const t=this.create(e.field);for(const i of e)t.add(i);return t},from(e){const t=this.create(e);return t.add(e),t}});for(const e of Object.keys(L))Object.defineProperty(L,e,{enumerable:!1});const B=L;i.add("Events","x_ite/Base/Events",B);const U=B;function X(e,t,i){Object.defineProperties(this,{accessType:{value:e,enumerable:!0},dataType:{value:i.getType(),enumerable:!0},name:{value:t,enumerable:!0},value:{value:i}})}Object.setPrototypeOf(X.prototype,I.prototype);for(const e of Object.keys(X.prototype))Object.defineProperty(X.prototype,e,{enumerable:!1});Object.defineProperties(X,{typeName:{value:"X3DFieldDefinition",enumerable:!0}});const j=X;i.add("X3DFieldDefinition","x_ite/Base/X3DFieldDefinition",j);const k=j,z=Symbol(),G=Symbol(),H=Symbol(),q={get(e,t){const i=e[t];if(void 0!==i)return i;if("string"==typeof t){const i=+t;return Number.isInteger(i)?e[z][i]:void 0}},set:(e,t,i)=>void 0!==e[t]&&(e[t]=i,!0),has:(e,t)=>Number.isInteger(+t)?t<e[z].length:t in e,ownKeys:e=>Object.keys(e[z]),getOwnPropertyDescriptor(e,t){if("string"!=typeof t)return;const i=+t;if(Number.isInteger(i)&&i<e[z].length){const i=Object.getOwnPropertyDescriptor(e[z],t);return i&&(i.writable=!1),i}}};function Y(e,t){const i=new Proxy(this,q);V.call(this),this[z]=[],this[G]=new Map,this[H]=t;for(const[t,i]of e)this.add(t,i);return i}Object.assign(Object.setPrototypeOf(Y.prototype,V.prototype),{*[Symbol.iterator](){yield*this[z]},copy(){const e=new this.constructor;return e.assign(this),e},assign(e){if(!(e instanceof this.constructor))throw new Error("Couldn't assign info array, wrong type.");this[z]=Array.from(e[z]),this[G]=new Map(e[G]),this.addEvent()},equals(e){const t=this[z],i=e[z],n=t.length;if(t===i)return!0;if(n!==i.length)return!1;for(let e=0;e<n;++e)if(t[e]!==i[e])return!1;return!0},has(e){return this[G].has(e)},get(e){return this[G].get(e)},add(e,t){if(this[G].has(e))throw new Error(`Couldn't add value to ${this.getTypeName()}, key '${e}' already exists.`);if(!(t instanceof this[H]))throw new Error(`Couldn't add value to ${this.getTypeName()}, value for key '${e}' has wrong type.`);this[z].push(t),this[G].set(e,t),this.addEvent()},alias(e,t){this[G].set(e,t),this.addEvent()},update(e,t,i){if(!(i instanceof this[H]))throw new Error(`Couldn't update value of ${this.getTypeName()}, value for key '${key}' has wrong type.`);const n=this[G].get(e);if(e!==t&&this.remove(t),this[G].delete(e),this[G].set(t,i),void 0!==n){const e=this[z].indexOf(n);e>-1&&(this[z][e]=i)}else this[z].push(i);this.addEvent()},remove(e){const t=this[G].get(e);if(void 0===t)return;const i=this[z].indexOf(t);this[G].delete(e),i>-1&&this[z].splice(i,1),this.addEvent()},at:Array.prototype.at,entries:Array.prototype.entries,every:Array.prototype.every,filter(e,t){return new this.constructor(Array.prototype.filter.call(this,e,t))},find:Array.prototype.find,findIndex:Array.prototype.findIndex,findLast:Array.prototype.findLast,findLastIndex:Array.prototype.findLastIndex,forEach:Array.prototype.forEach,includes:Array.prototype.includes,indexOf:Array.prototype.indexOf,join:Array.prototype.join,keys:Array.prototype.keys,lastIndexOf:Array.prototype.lastIndexOf,map(e,t){return new this.constructor(Array.prototype.map.call(this,e,t))},reduce:Array.prototype.reduce,reduceRight:Array.prototype.reduceRight,slice(e,t){return new this.constructor(Array.prototype.slice.call(this,e,t))},some:Array.prototype.some,toReversed(){return new this.constructor([...this].reverse())},toSorted(e){return new this.constructor([...this].sort(e))},toSpliced(e,t,...i){const n=[...this];return n.splice(e,t,...i),new this.constructor(n)},values:Array.prototype.values,with(e,t){const i=[...this];return i[e]=t,new this.constructor(i)},toVRMLStream(e){for(const t of this[z])try{t.toVRMLStream(e),e.string+=e.Break(),this.getTypeName().match(/Proto/)&&(e.string+=e.TidyBreak())}catch(e){}},toXMLStream(e){for(const t of this[z])try{t.toXMLStream(e),e.string+=e.TidyBreak()}catch(e){}},toJSONStream(e,t){let i=!1;for(const t of this[z])try{t.toJSONStream(e,!0),e.string+=",",e.string+=e.TidyBreak(),i=!0}catch(e){}return i&&!t&&e.JSONRemoveComma(),i}});for(const e of Object.keys(Y.prototype))Object.defineProperty(Y.prototype,e,{enumerable:!1});Object.defineProperties(Y.prototype,{length:{get(){return this[z].length}}});const W=Y;i.add("X3DInfoArray","x_ite/Base/X3DInfoArray",W);const $=W;function J(e=[]){return $.call(this,Array.from(e,(e=>[e.name,e])),k)}Object.setPrototypeOf(J.prototype,$.prototype);for(const e of Object.keys(J.prototype))Object.defineProperty(J.prototype,e,{enumerable:!1});Object.defineProperties(J,{typeName:{value:"FieldDefinitionArray",enumerable:!0}});const K=J;i.add("FieldDefinitionArray","x_ite/Base/FieldDefinitionArray",K);const Z=K,Q=Symbol(),ee=Symbol(),te=Symbol(),ie=Symbol(),ne=Symbol(),re=Symbol(),se=Symbol(),oe=Symbol(),ae=Symbol(),le=Symbol(),ue=Symbol.for("X_ITE.X3DField.uniformLocation");function he(e){V.call(this),this[Q]=e}Object.assign(Object.setPrototypeOf(he.prototype,V.prototype),{[Q]:null,[ee]:d.initializeOnly,[te]:null,[ie]:new Set,[ne]:new Map,[re]:new Set,[se]:new Map,[oe]:new Set,[ae]:new Set,[le]:new Map,[ue]:null,create(){return new this.constructor},equals(e){return this[Q]===e.valueOf()},assign(e){this.set(e.getValue()),this.addEvent()},set(e){this[Q]=e},setValue(e){this.set(e instanceof this.constructor?e.getValue():e),this.addEvent()},getValue(){return this[Q]},getType(){return d[this.constructor.typeName]},setAccessType(e){this[ee]=e},getAccessType(){return this[ee]},isInitializable(){return!!(this[ee]&d.initializeOnly)},isInput(){return!!(this[ee]&d.inputOnly)},isOutput(){return!!(this[ee]&d.outputOnly)},isReadable(){return this[ee]!==d.inputOnly},isWritable(){return this[ee]!==d.outputOnly},setUnit(e){this[te]=e},getUnit(){return this[te]},hasReferences(){return 0!==this[ie].size},isReference(e){return e===this[ee]||e===d.inputOutput},addReference(e){const t=this.getReferences();if(!t.has(e)){switch(t.add(e),this.getAccessType()&e.getAccessType()){case d.initializeOnly:e.addFieldInterest(this),this.processEvent(U.from(e));break;case d.inputOnly:e.addFieldInterest(this);break;case d.outputOnly:this.addFieldInterest(e);break;case d.inputOutput:e.addFieldInterest(this),this.addFieldInterest(e),this.processEvent(U.from(e))}this.processReferencesCallbacks()}},removeReference(e){switch(this.getReferences().delete(e),this.getAccessType()&e.getAccessType()){case d.initializeOnly:case d.inputOnly:e.removeFieldInterest(this);break;case d.outputOnly:this.removeFieldInterest(e);break;case d.inputOutput:e.removeFieldInterest(this),this.removeFieldInterest(e)}this.processReferencesCallbacks()},getReferences(){return this[ie]===he.prototype[ie]&&(this[ie]=new Set),this[ie]},addReferencesCallback(e,t){this[ne]===he.prototype[ne]&&(this[ne]=new Map),this[ne].set(e,t)},removeReferencesCallback(e){this[ne].delete(e)},getReferencesCallbacks(){return this[ne]},processReferencesCallbacks:(()=>{const e=[];return function(){if(this[ne].size)for(const t of b.values(e,this[ne]))t()}})(),addFieldInterest(e){this[re]===he.prototype[re]&&(this[re]=new Set),this[re].add(e)},removeFieldInterest(e){this[re].delete(e)},getFieldInterests(){return this[re]},addFieldCallback(e,t){this[se]===he.prototype[se]&&(this[se]=new Map),this[se].set(e,t)},removeFieldCallback(e){this[se].delete(e)},getFieldCallbacks(){return this[se]},addInputRoute(e){this[oe]===he.prototype[oe]&&(this[oe]=new Set),this[oe].add(e),this.processRouteCallbacks()},removeInputRoute(e){this[oe].delete(e),this.processRouteCallbacks()},getInputRoutes(){return this[oe]},addOutputRoute(e){this[ae]===he.prototype[ae]&&(this[ae]=new Set),this[ae].add(e),this.processRouteCallbacks()},removeOutputRoute(e){this[ae].delete(e),this.processRouteCallbacks()},getOutputRoutes(){return this[ae]},addRouteCallback(e,t){this[le]===he.prototype[le]&&(this[le]=new Map),this[le].set(e,t)},removeRouteCallback(e){this[le].delete(e)},getRouteCallbacks(){return this[le]},processRouteCallbacks:(()=>{const e=[];return function(){if(this[le].size)for(const t of b.values(e,this[le]))t()}})(),processEvent:(()=>{const e=[];return function(t=U.create(this)){if(t.has(this))return;t.add(this),this.setTainted(!1);const i=t.field;i!==this&&this.set(i.getValue(),i.length),this.processInterests();let n=!0;for(const e of this[re])n?(n=!1,e.addEventObject(this,t)):e.addEventObject(this,U.copy(t));if(n&&U.push(t),this[se].size)for(const t of b.values(e,this[se]))t(this.valueOf())}})(),fromString(e,t){},dispose(){for(const e of this[ie])e.removeFieldInterest(this);for(const e of new Set(this[oe]))e.dispose();for(const e of new Set(this[ae]))e.dispose();this[ie].clear(),this[ne].clear(),this[re].clear(),this[se].clear(),this[oe].clear(),this[ae].clear(),this[le].clear(),V.prototype.dispose.call(this)}});for(const e of Object.keys(he.prototype))Object.defineProperty(he.prototype,e,{enumerable:!1});const de=he;i.add("X3DField","x_ite/Base/X3DField",de);const ce=de;function pe(e=[]){return $.call(this,Array.from(e,(e=>[e.getName(),e])),ce)}Object.setPrototypeOf(pe.prototype,$.prototype);for(const e of Object.keys(pe.prototype))Object.defineProperty(pe.prototype,e,{enumerable:!1});Object.defineProperties(pe,{typeName:{value:"FieldArray",enumerable:!0}});const ge=pe;i.add("FieldArray","x_ite/Base/FieldArray",ge);const fe=ge;function me(e){ce.call(this,!!e)}Object.assign(Object.setPrototypeOf(me.prototype,ce.prototype),{copy(){return new me(this.getValue())},isDefaultValue(){return!1===this.getValue()},set(e){ce.prototype.set.call(this,!!e)},valueOf:ce.prototype.getValue,toStream(e){e.string+=this.getValue()?"TRUE":"FALSE"},toVRMLStream(e){this.toStream(e)},toXMLStream(e){e.string+=this.getValue()?"true":"false"},toJSONStream(e){this.toJSONStreamValue(e)},toJSONStreamValue(e){e.string+=this.getValue()?"true":"false"}});for(const e of Object.keys(me.prototype))Object.defineProperty(me.prototype,e,{enumerable:!1});Object.defineProperties(me,{typeName:{value:"SFBool",enumerable:!0}});const _e=me;i.add("SFBool","x_ite/Fields/SFBool",_e);const xe=_e,{clamp:ye,interval:we,degrees:be}=g,Se=Symbol.for("X_ITE.Color3.r"),Te=Symbol.for("X_ITE.Color3.g"),ve=Symbol.for("X_ITE.Color3.b");function Oe(e,t,i){this[Se]=ye(e,0,1),this[Te]=ye(t,0,1),this[ve]=ye(i,0,1)}Object.assign(Oe.prototype,{*[Symbol.iterator](){yield this[Se],yield this[Te],yield this[ve]},copy(){const e=Object.create(Oe.prototype);return e[Se]=this[Se],e[Te]=this[Te],e[ve]=this[ve],e},assign(e){return this[Se]=e[Se],this[Te]=e[Te],this[ve]=e[ve],this},set(e,t,i){return this[Se]=ye(e,0,1),this[Te]=ye(t,0,1),this[ve]=ye(i,0,1),this},equals(e){return this[Se]===e[Se]&&this[Te]===e[Te]&&this[ve]===e[ve]},getHSV(e){let t,i,n;const r=Math.min(this[Se],this[Te],this[ve]),s=Math.max(this[Se],this[Te],this[ve]);n=s;const o=s-r;return 0!==s&&0!==o?(i=o/s,t=this[Se]===s?(this[Te]-this[ve])/o:this[Te]===s?2+(this[ve]-this[Se])/o:4+(this[Se]-this[Te])/o,t*=Math.PI/3,t<0&&(t+=2*Math.PI)):i=t=0,e[0]=t,e[1]=i,e[2]=n,e},setHSV(e,t,i){if(t=ye(t,0,1),i=ye(i,0,1),0===t)this[Se]=this[Te]=this[ve]=i;else{const n=be(we(e,0,2*Math.PI))/60,r=Math.floor(n),s=n-r,o=i*(1-t),a=i*(1-t*s),l=i*(1-t*(1-s));switch(r%6){case 0:this[Se]=i,this[Te]=l,this[ve]=o;break;case 1:this[Se]=a,this[Te]=i,this[ve]=o;break;case 2:this[Se]=o,this[Te]=i,this[ve]=l;break;case 3:this[Se]=o,this[Te]=a,this[ve]=i;break;case 4:this[Se]=l,this[Te]=o,this[ve]=i;break;default:this[Se]=i,this[Te]=o,this[ve]=a}}return this},toString(){return this[Se]+" "+this[Te]+" "+this[ve]}});const Ee={get(){return this[Se]},set(e){this[Se]=ye(e,0,1)}},Ce={get(){return this[Te]},set(e){this[Te]=ye(e,0,1)}},Ne={get(){return this[ve]},set(e){this[ve]=ye(e,0,1)}};Object.defineProperties(Oe.prototype,{length:{value:3},0:Ee,1:Ce,2:Ne,r:Object.assign({enumerable:!0},Ee),g:Object.assign({enumerable:!0},Ce),b:Object.assign({enumerable:!0},Ne)}),Object.assign(Oe,{Black:new Oe(0,0,0),White:new Oe(1,1,1),HSV(e,t,i){const n=Object.create(this.prototype);return n.setHSV(e,t,i),n},lerp(e,t,i,n){let[r,s,o]=e,[a,l,u]=t;0===s&&(r=a),0===l&&(a=r);const h=Math.abs(a-r);if(h<=Math.PI)return n[0]=r+i*(a-r),n[1]=s+i*(l-s),n[2]=o+i*(u-o),n;const d=2*Math.PI,c=(d-h)*i;let p=r<a?r-c:r+c;return p<0?p+=d:p>d&&(p-=d),n[0]=p,n[1]=s+i*(l-s),n[2]=o+i*(u-o),n}});const Ie=Oe;i.add("Color3","standard/Math/Numbers/Color3",Ie);const Fe=Ie;function Me(e,t,i){switch(arguments.length){case 0:ce.call(this,new Fe(0,0,0));break;case 1:ce.call(this,arguments[0]);break;case 3:ce.call(this,new Fe(+e,+t,+i));break;default:throw new Error("Invalid arguments.")}}Object.assign(Object.setPrototypeOf(Me.prototype,ce.prototype),{*[Symbol.iterator](){yield*this.getValue()},copy(){return new Me(this.getValue().copy())},equals(e){return this.getValue().equals(e.getValue())},isDefaultValue(){return this.getValue().equals(Fe.Black)},set(e){this.getValue().assign(e)},getHSV(){return this.getValue().getHSV([])},setHSV(e,t,i){this.getValue().setHSV(e,t,i),this.addEvent()},lerp:(()=>{const e=[],t=[],i=[];return function(n,r){const s=new Me;return this.getValue().getHSV(e),n.getValue().getHSV(t),Fe.lerp(e,t,r,i),s.setHSV(i[0],i[1],i[2]),s}})(),toStream(e){const t=this.getValue(),i=t.length-1;for(let n=0;n<i;++n)e.string+=e.FloatFormat(t[n]),e.string+=e.Space();e.string+=e.FloatFormat(t[i])},toVRMLStream(e){this.toStream(e)},toXMLStream(e){this.toStream(e)},toJSONStream(e){e.string+="[",e.string+=e.TidySpace(),this.toJSONStreamValue(e),e.string+=e.TidySpace(),e.string+="]"},toJSONStreamValue(e){const t=this.getValue(),i=t.length-1;for(let n=0;n<i;++n)e.string+=e.JSONNumber(e.FloatFormat(t[n])),e.string+=",",e.string+=e.TidySpace();e.string+=e.JSONNumber(e.FloatFormat(t[i]))}});for(const e of Object.keys(Me.prototype))Object.defineProperty(Me.prototype,e,{enumerable:!1});const De={get(){return this.getValue().r},set(e){this.getValue().r=+e,this.addEvent()}},Re={get(){return this.getValue().g},set(e){this.getValue().g=+e,this.addEvent()}},Pe={get(){return this.getValue().b},set(e){this.getValue().b=+e,this.addEvent()}};Object.defineProperties(Me.prototype,{0:De,1:Re,2:Pe,r:Object.assign({enumerable:!0},De),g:Object.assign({enumerable:!0},Re),b:Object.assign({enumerable:!0},Pe)}),Object.defineProperties(Me,{typeName:{value:"SFColor",enumerable:!0}});const Ae=Me;i.add("SFColor","x_ite/Fields/SFColor",Ae);const Ve=Ae,{clamp:Le}=g,Be=Symbol.for("X_ITE.Color3.r"),Ue=Symbol.for("X_ITE.Color3.g"),Xe=Symbol.for("X_ITE.Color3.b"),je=Symbol();function ke(e,t,i,n){this[Be]=Le(e,0,1),this[Ue]=Le(t,0,1),this[Xe]=Le(i,0,1),this[je]=Le(n,0,1)}Object.assign(ke.prototype,{*[Symbol.iterator](){yield this[Be],yield this[Ue],yield this[Xe],yield this[je]},copy(){const e=Object.create(ke.prototype);return e[Be]=this[Be],e[Ue]=this[Ue],e[Xe]=this[Xe],e[je]=this[je],e},assign(e){return this[Be]=e[Be],this[Ue]=e[Ue],this[Xe]=e[Xe],this[je]=e[je],this},set(e,t,i,n){return this[Be]=Le(e,0,1),this[Ue]=Le(t,0,1),this[Xe]=Le(i,0,1),this[je]=Le(n,0,1),this},equals(e){return this[Be]===e[Be]&&this[Ue]===e[Ue]&&this[Xe]===e[Xe]&&this[je]===e[je]},getHSVA(e){return Fe.prototype.getHSV.call(this,e),e[3]=this[je],e},setHSVA(e,t,i,n){return Fe.prototype.setHSV.call(this,e,t,i),this[je]=Le(n,0,1),this},toString(){return this[Be]+" "+this[Ue]+" "+this[Xe]+" "+this[je]}});const ze={get(){return this[Be]},set(e){this[Be]=Le(e,0,1)}},Ge={get(){return this[Ue]},set(e){this[Ue]=Le(e,0,1)}},He={get(){return this[Xe]},set(e){this[Xe]=Le(e,0,1)}},qe={get(){return this[je]},set(e){this[je]=Le(e,0,1)}};Object.defineProperties(ke.prototype,{length:{value:4},0:ze,1:Ge,2:He,3:qe,r:Object.assign({enumerable:!0},ze),g:Object.assign({enumerable:!0},Ge),b:Object.assign({enumerable:!0},He),a:Object.assign({enumerable:!0},qe)}),Object.assign(ke,{Transparent:new ke(0,0,0,0),Black:new ke(0,0,0,1),White:new ke(1,1,1,1),HSVA(e,t,i,n){const r=Object.create(this.prototype);return r.setHSVA(e,t,i,n),r},lerp(e,t,i,n){const r=e[3];return Fe.lerp(e,t,i,n),n[3]=r+i*(t[3]-r),n}});const Ye=ke;i.add("Color4","standard/Math/Numbers/Color4",Ye);const We=Ye;function $e(e,t,i,n){switch(arguments.length){case 0:ce.call(this,new We(0,0,0,0));break;case 1:ce.call(this,arguments[0]);break;case 4:ce.call(this,new We(+e,+t,+i,+n));break;default:throw new Error("Invalid arguments.")}}Object.assign(Object.setPrototypeOf($e.prototype,ce.prototype),{*[Symbol.iterator](){yield*this.getValue()},copy(){return new $e(this.getValue().copy())},equals:Ve.prototype.equals,isDefaultValue(){return this.getValue().equals(We.Transparent)},set:Ve.prototype.set,getHSVA(){return this.getValue().getHSVA([])},setHSVA(e,t,i,n){this.getValue().setHSVA(e,t,i,n),this.addEvent()},lerp:(()=>{const e=[],t=[],i=[];return function(n,r){const s=new $e;return this.getValue().getHSVA(e),n.getValue().getHSVA(t),We.lerp(e,t,r,i),s.setHSVA(i[0],i[1],i[2],i[3]),s}})(),toStream:Ve.prototype.toStream,toVRMLStream:Ve.prototype.toVRMLStream,toXMLStream:Ve.prototype.toXMLStream,toJSONStream:Ve.prototype.toJSONStream,toJSONStreamValue:Ve.prototype.toJSONStreamValue});for(const e of Object.keys($e.prototype))Object.defineProperty($e.prototype,e,{enumerable:!1});const Je={get(){return this.getValue().r},set(e){this.getValue().r=+e,this.addEvent()}},Ke={get(){return this.getValue().g},set(e){this.getValue().g=+e,this.addEvent()}},Ze={get(){return this.getValue().b},set(e){this.getValue().b=+e,this.addEvent()}},Qe={get(){return this.getValue().a},set(e){this.getValue().a=+e,this.addEvent()}};Object.defineProperties($e.prototype,{0:Je,1:Ke,2:Ze,3:Qe,r:Object.assign({enumerable:!0},Je),g:Object.assign({enumerable:!0},Ke),b:Object.assign({enumerable:!0},Ze),a:Object.assign({enumerable:!0},Qe)}),Object.defineProperties($e,{typeName:{value:"SFColorRGBA",enumerable:!0}});const et=$e;i.add("SFColorRGBA","x_ite/Fields/SFColorRGBA",et);const tt=et;function it(e){ce.call(this,arguments.length?+e:0)}Object.assign(Object.setPrototypeOf(it.prototype,ce.prototype),{copy(){return new it(this.getValue())},isDefaultValue(){return 0===this.getValue()},set(e){ce.prototype.set.call(this,+e)},valueOf:ce.prototype.getValue,toStream(e){const t=e.Unit(this.getUnit());e.string+=e.DoubleFormat(e.ToUnit(t,this.getValue()))},toVRMLStream(e){this.toStream(e)},toXMLStream(e){this.toStream(e)},toJSONStream(e){this.toJSONStreamValue(e)},toJSONStreamValue(e){const t=e.Unit(this.getUnit());e.string+=e.JSONNumber(e.DoubleFormat(e.ToUnit(t,this.getValue())))}});for(const e of Object.keys(it.prototype))Object.defineProperty(it.prototype,e,{enumerable:!1});Object.defineProperties(it,{typeName:{value:"SFDouble",enumerable:!0}});const nt=it;i.add("SFDouble","x_ite/Fields/SFDouble",nt);const rt=nt;function st(e){ce.call(this,arguments.length?+e:0)}Object.assign(Object.setPrototypeOf(st.prototype,ce.prototype),{copy(){return new st(this.getValue())},isDefaultValue(){return 0===this.getValue()},set(e){ce.prototype.set.call(this,+e)},valueOf:ce.prototype.getValue,toStream(e){const t=e.Unit(this.getUnit());e.string+=e.FloatFormat(e.ToUnit(t,this.getValue()))},toVRMLStream(e){this.toStream(e)},toXMLStream(e){this.toStream(e)},toJSONStream(e){this.toJSONStreamValue(e)},toJSONStreamValue(e){const t=e.Unit(this.getUnit());e.string+=e.JSONNumber(e.FloatFormat(e.ToUnit(t,this.getValue())))}});for(const e of Object.keys(st.prototype))Object.defineProperty(st.prototype,e,{enumerable:!1});Object.defineProperties(st,{typeName:{value:"SFFloat",enumerable:!0}});const ot=st;i.add("SFFloat","x_ite/Fields/SFFloat",ot);const at=ot;function lt(e){ce.call(this,0|e)}Object.assign(Object.setPrototypeOf(lt.prototype,ce.prototype),{copy(){return new lt(this.getValue())},isDefaultValue(){return 0===this.getValue()},set(e){ce.prototype.set.call(this,0|e)},valueOf:ce.prototype.getValue,toStream(e){e.string+=this.getValue().toString()},toVRMLStream(e){this.toStream(e)},toXMLStream(e){this.toStream(e)},toJSONStream(e){this.toStream(e)},toJSONStreamValue(e){this.toStream(e)}});for(const e of Object.keys(lt.prototype))Object.defineProperty(lt.prototype,e,{enumerable:!1});Object.defineProperties(lt,{typeName:{value:"SFInt32",enumerable:!0}});const ut=lt;i.add("SFInt32","x_ite/Fields/SFInt32",ut);const ht=ut;const dt=function(e,t,i,n,r){const s=r?"DoubleFormat":"FloatFormat";return Object.defineProperties(e,{typeName:{value:t,enumerable:!0}}),Object.assign(Object.setPrototypeOf(e.prototype,ce.prototype),{*[Symbol.iterator](){yield*this.getValue()},copy(){return new this.constructor(this.getValue().copy())},equals(e){return this.getValue().equals(e.getValue())},isDefaultValue(){return this.getValue().equals(i.Identity)},set(e){this.getValue().assign(e)},setTransform:function(){const e=[];return function(t,i,n,r,s){e.push(t?.getValue()??null,i?.getValue()??null,n?.getValue()??null,r?.getValue()??null,s?.getValue()??null);for(let t=e.length-1;t>-1&&null===e[t];--t)e.pop();this.getValue().set(...e),e.length=0}}(),getTransform:function(){const e=[];return function(t,i,n,r,s){e.push(t?.getValue()??null,i?.getValue()??null,n?.getValue()??null,r?.getValue()??null,s?.getValue()??null);for(let t=e.length-1;t>-1&&null===e[t];--t)e.pop();this.getValue().get(...e),t?.addEvent(),i?.addEvent(),n?.addEvent(),r?.addEvent(),e.length=0}}(),determinant(){return this.getValue().determinant()},transpose(){return new this.constructor(this.getValue().copy().transpose())},inverse(){return new this.constructor(this.getValue().copy().inverse())},multLeft(e){return new this.constructor(this.getValue().copy().multLeft(e.getValue()))},multRight(e){return new this.constructor(this.getValue().copy().multRight(e.getValue()))},multVecMatrix(e){return new n(this.getValue().multVecMatrix(e.getValue().copy()))},multMatrixVec(e){return new n(this.getValue().multMatrixVec(e.getValue().copy()))},multDirMatrix(e){return new n(this.getValue().multDirMatrix(e.getValue().copy()))},multMatrixDir(e){return new n(this.getValue().multMatrixDir(e.getValue().copy()))},toStream(e){const t=this.getValue(),i=t.length-1;for(let n=0;n<i;++n)e.string+=e[s](t[n]),e.string+=e.Space();e.string+=e[s](t[i])},toVRMLStream(e){this.toStream(e)},toXMLStream(e){this.toStream(e)},toJSONStream(e){e.string+="[",e.string+=e.TidySpace(),this.toJSONStreamValue(e),e.string+=e.TidySpace(),e.string+="]"},toJSONStreamValue(e){const t=this.getValue(),i=t.length-1;for(let n=0;n<i;++n)e.string+=e.JSONNumber(e[s](t[n])),e.string+=",",e.string+=e.TidySpace();e.string+=e.JSONNumber(e[s](t[i]))}})};i.add("SFMatrixPrototypeTemplate","x_ite/Fields/SFMatrixPrototypeTemplate",dt);const ct=dt;const pt=function(e,t,i,n){const r=n?"DoubleFormat":"FloatFormat";return Object.defineProperties(e,{typeName:{value:t,enumerable:!0}}),Object.assign(Object.setPrototypeOf(e.prototype,ce.prototype),{*[Symbol.iterator](){yield*this.getValue()},copy(){return new this.constructor(this.getValue().copy())},equals(e){return this.getValue().equals(e.getValue())},isDefaultValue(){return this.getValue().equals(i.Zero)},set(e){this.getValue().assign(e)},abs(){return new this.constructor(this.getValue().copy().abs())},add(e){return new this.constructor(this.getValue().copy().add(e.getValue()))},distance(e){return this.getValue().distance(e.getValue())},divide(e){return new this.constructor(this.getValue().copy().divide(e))},divVec(e){return new this.constructor(this.getValue().copy().divVec(e.getValue()))},dot(e){return this.getValue().dot(e.getValue())},inverse(){return new this.constructor(this.getValue().copy().inverse())},length(){return this.getValue().magnitude()},lerp(e,t){return new this.constructor(this.getValue().copy().lerp(e,t))},max(e){return new this.constructor(this.getValue().copy().max(e.getValue()))},min(e){return new this.constructor(this.getValue().copy().min(e.getValue()))},multiply(e){return new this.constructor(this.getValue().copy().multiply(e))},multVec(e){return new this.constructor(this.getValue().copy().multVec(e.getValue()))},negate(){return new this.constructor(this.getValue().copy().negate())},normalize(e){return new this.constructor(this.getValue().copy().normalize())},subtract(e){return new this.constructor(this.getValue().copy().subtract(e.getValue()))},toStream(e){const t=this.getValue(),i=t.length-1,n=e.Unit(this.getUnit());for(let s=0;s<i;++s)e.string+=e[r](e.ToUnit(n,t[s])),e.string+=e.Space();e.string+=e[r](e.ToUnit(n,t[i]))},toVRMLStream(e){this.toStream(e)},toXMLStream(e){this.toStream(e)},toJSONStream(e){e.string+="[",e.string+=e.TidySpace(),this.toJSONStreamValue(e),e.string+=e.TidySpace(),e.string+="]"},toJSONStreamValue(e){const t=this.getValue(),i=t.length-1,n=e.Unit(this.getUnit());for(let s=0;s<i;++s)e.string+=e.JSONNumber(e[r](e.ToUnit(n,t[s]))),e.string+=",",e.string+=e.TidySpace();e.string+=e.JSONNumber(e[r](e.ToUnit(n,t[i])))}})};i.add("SFVecPrototypeTemplate","x_ite/Fields/SFVecPrototypeTemplate",pt);const gt=pt;function ft(e,t){this.x=e,this.y=t}Object.assign(ft.prototype,{*[Symbol.iterator](){yield this.x,yield this.y},copy(){const e=Object.create(ft.prototype);return e.x=this.x,e.y=this.y,e},assign(e){return this.x=e.x,this.y=e.y,this},set(e,t){return this.x=e,this.y=t,this},equals(e){return this.x===e.x&&this.y===e.y},negate(){return this.x=-this.x,this.y=-this.y,this},inverse(){return this.x=1/this.x,this.y=1/this.y,this},add(e){return this.x+=e.x,this.y+=e.y,this},subtract(e){return this.x-=e.x,this.y-=e.y,this},multiply(e){return this.x*=e,this.y*=e,this},multVec(e){return this.x*=e.x,this.y*=e.y,this},divide(e){return this.x/=e,this.y/=e,this},divVec(e){return this.x/=e.x,this.y/=e.y,this},normalize(){const e=Math.hypot(this.x,this.y);return e&&(this.x/=e,this.y/=e),this},dot(e){return this.x*e.x+this.y*e.y},norm(){const{x:e,y:t}=this;return e*e+t*t},magnitude(){return Math.hypot(this.x,this.y)},distance(e){return Math.hypot(this.x-e.x,this.y-e.y)},lerp(e,t){const{x:i,y:n}=this;return this.x=i+t*(e.x-i),this.y=n+t*(e.y-n),this},abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},min(e){let{x:t,y:i}=this;for(const e of arguments)t=Math.min(t,e.x),i=Math.min(i,e.y);return this.x=t,this.y=i,this},max(e){let{x:t,y:i}=this;for(const e of arguments)t=Math.max(t,e.x),i=Math.max(i,e.y);return this.x=t,this.y=i,this},toString(){return this.x+" "+this.y}}),Object.defineProperties(ft.prototype,{length:{value:2},0:{get(){return this.x},set(e){this.x=e}},1:{get(){return this.y},set(e){this.y=e}}}),Object.assign(ft,{Zero:new ft(0,0),One:new ft(1,1),xAxis:new ft(1,0),yAxis:new ft(0,1)});const mt=ft;i.add("Vector2","standard/Math/Numbers/Vector2",mt);const _t=mt;function xt(e,t){function i(e,t){switch(arguments.length){case 0:ce.call(this,new _t(0,0));break;case 1:ce.call(this,arguments[0]);break;case 2:ce.call(this,new _t(+e,+t));break;default:throw new Error("Invalid arguments.")}}gt(i,e,_t,t);for(const e of Object.keys(i.prototype))Object.defineProperty(i.prototype,e,{enumerable:!1});const n={get(){return this.getValue().x},set(e){this.getValue().x=+e,this.addEvent()}},r={get(){return this.getValue().y},set(e){this.getValue().y=+e,this.addEvent()}};return Object.defineProperties(i.prototype,{0:n,1:r,x:Object.assign({enumerable:!0},n),y:Object.assign({enumerable:!0},r)}),i}const yt={SFVec2d:xt("SFVec2d",!0),SFVec2f:xt("SFVec2f",!1)};i.add("SFVec2","x_ite/Fields/SFVec2",yt);const wt=yt;function bt(e,t,i){this.x=e,this.y=t,this.z=i}Object.assign(bt.prototype,{*[Symbol.iterator](){yield this.x,yield this.y,yield this.z},copy(){const e=Object.create(bt.prototype);return e.x=this.x,e.y=this.y,e.z=this.z,e},assign(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},set(e,t,i){return this.x=e,this.y=t,this.z=i,this},equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z},negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},inverse(){return this.x=1/this.x,this.y=1/this.y,this.z=1/this.z,this},add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},subtract(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},multiply(e){return this.x*=e,this.y*=e,this.z*=e,this},multVec(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},divide(e){return this.x/=e,this.y/=e,this.z/=e,this},divVec(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},cross(e){const{x:t,y:i,z:n}=this,{x:r,y:s,z:o}=e;return this.x=i*o-n*s,this.y=n*r-t*o,this.z=t*s-i*r,this},normalize(){const e=Math.hypot(this.x,this.y,this.z);return e&&(this.x/=e,this.y/=e,this.z/=e),this},dot(e){return this.x*e.x+this.y*e.y+this.z*e.z},norm(){const{x:e,y:t,z:i}=this;return e*e+t*t+i*i},magnitude(){return Math.hypot(this.x,this.y,this.z)},distance(e){return Math.hypot(this.x-e.x,this.y-e.y,this.z-e.z)},lerp(e,t){const{x:i,y:n,z:r}=this;return this.x=i+t*(e.x-i),this.y=n+t*(e.y-n),this.z=r+t*(e.z-r),this},slerp:(()=>{const e=new bt(0,0,0);return function(t,i){return g.simpleSlerp(this,e.assign(t),i)}})(),abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this},min(e){let{x:t,y:i,z:n}=this;for(const e of arguments)t=Math.min(t,e.x),i=Math.min(i,e.y),n=Math.min(n,e.z);return this.x=t,this.y=i,this.z=n,this},max(e){let{x:t,y:i,z:n}=this;for(const e of arguments)t=Math.max(t,e.x),i=Math.max(i,e.y),n=Math.max(n,e.z);return this.x=t,this.y=i,this.z=n,this},toString(){return this.x+" "+this.y+" "+this.z}}),Object.defineProperties(bt.prototype,{length:{value:3},0:{get(){return this.x},set(e){this.x=e}},1:{get(){return this.y},set(e){this.y=e}},2:{get(){return this.z},set(e){this.z=e}}}),Object.assign(bt,{Zero:new bt(0,0,0),One:new bt(1,1,1),xAxis:new bt(1,0,0),yAxis:new bt(0,1,0),zAxis:new bt(0,0,1)});const St=bt;i.add("Vector3","standard/Math/Numbers/Vector3",St);const Tt=St;function vt(){if(arguments.length)for(let e=0;e<4;++e)this[e]=arguments[e];else this.identity()}Object.assign(vt.prototype,{*[Symbol.iterator](){for(let e=0;e<4;++e)yield this[e]},copy(){const e=Object.create(vt.prototype);for(let t=0;t<4;++t)e[t]=this[t];return e},assign(e){for(let t=0;t<4;++t)this[t]=e[t];return this},equals(e){return this[0]===e[0]&&this[1]===e[1]&&this[2]===e[2]&&this[3]===e[3]},set1(e,t,i){this[e*this.order+t]=i},get1(e,t){return this[e*this.order+t]},set(){switch(arguments.length){case 0:this.identity();break;case 4:for(let e=0;e<4;++e)this[e]=arguments[e]}return this},determinant1(){return this[0]},determinant(){const{0:e,1:t,2:i,3:n}=this;return e*n-t*i},transpose(){const e=this[1];return this[1]=this[2],this[2]=e,this},inverse(){const{0:e,1:t,2:i,3:n}=this,r=e*n-t*i;return this[0]=n/r,this[1]=-t/r,this[2]=-i/r,this[3]=e/r,this},multLeft(e){const{0:t,1:i,2:n,3:r}=this,{0:s,1:o,2:a,3:l}=e;return this[0]=t*s+n*o,this[1]=i*s+r*o,this[2]=t*a+n*l,this[3]=i*a+r*l,this},multRight(e){const{0:t,1:i,2:n,3:r}=this,{0:s,1:o,2:a,3:l}=e;return this[0]=s*t+a*i,this[1]=o*t+l*i,this[2]=s*n+a*r,this[3]=o*n+l*r,this},multVecMatrix(e){if("number"==typeof e){const t=e,i=t*this[1]+this[3];return(t*this[0]+this[2])/i}{const{x:t,y:i}=e;return e.x=t*this[0]+i*this[2],e.y=t*this[1]+i*this[3],e}},multMatrixVec(e){if("number"==typeof e){const t=e,i=t*this[2]+this[3];return(t*this[0]+this[1])/i}{const{x:t,y:i}=e;return e.x=t*this[0]+i*this[1],e.y=t*this[2]+i*this[3],e}},identity(){this[0]=1,this[1]=0,this[2]=0,this[3]=1},toString(){return Array.prototype.join.call(this," ")}}),Object.defineProperties(vt.prototype,{order:{value:2},length:{value:4},x:{get:(()=>{const e=new _t(0,0);return function(){return e.set(this[0],this[1])}})()},y:{get:(()=>{const e=new _t(0,0);return function(){return e.set(this[2],this[3])}})()},xAxis:{get(){return this[0]}},origin:{get(){return this[2]}},submatrix:{get(){return this[0]}}}),Object.assign(vt,{Identity:new vt});const Ot=vt;i.add("Matrix2","standard/Math/Numbers/Matrix2",Ot);const Et=Ot,Ct=[],Nt=[],It=[];const Ft=function(e,t){const i=e.order,n=e.length,r=t.values,s=t.vectors;let o,a,l,u,h,d,c,p,g,f,m,_,x;for(_=0;_<i;++_)for(Ct[_]=Ct[_]??[],Nt[_]=r[_]=e.get1(_,_),It[_]=0,x=0;x<i;++x)s[_][x]=_===x?1:0,Ct[_][x]=e.get1(x,_);for(_=0;_<50;++_){for(o=0,f=0;f<i-1;++f)for(m=f+1;m<i;++m)o+=Math.abs(Ct[f][m]);if(0===o)break;for(g=_<3?.2*o/n:0,f=0;f<i-1;++f)for(m=f+1;m<i;++m)if(p=100*Math.abs(Ct[f][m]),_>3&&Math.abs(r[f])+p===Math.abs(r[f])&&Math.abs(r[m])+p===Math.abs(r[m]))Ct[f][m]=0;else if(Math.abs(Ct[f][m])>g){for(c=r[m]-r[f],Math.abs(c)+p===Math.abs(c)?h=Ct[f][m]/c:(a=.5*c/Ct[f][m],h=1/(Math.abs(a)+Math.sqrt(1+a*a)),a<0&&(h=-h)),l=1/Math.sqrt(1+h*h),u=h*l,d=u/(1+l),c=h*Ct[f][m],It[f]-=c,It[m]+=c,r[f]-=c,r[m]+=c,Ct[f][m]=0,x=0;x<f;++x)p=Ct[x][f],c=Ct[x][m],Ct[x][f]=p-u*(c+p*d),Ct[x][m]=c+u*(p-c*d);for(x=f+1;x<m;++x)p=Ct[f][x],c=Ct[x][m],Ct[f][x]=p-u*(c+p*d),Ct[x][m]=c+u*(p-c*d);for(x=m+1;x<i;++x)p=Ct[f][x],c=Ct[m][x],Ct[f][x]=p-u*(c+p*d),Ct[m][x]=c+u*(p-c*d);for(x=0;x<i;++x)p=s[x][f],c=s[x][m],s[x][f]=p-u*(c+p*d),s[x][m]=c+u*(p-c*d)}for(f=0;f<i;++f)r[f]=Nt[f]+=It[f],It[f]=0}return t};i.add("eigen_decomposition","standard/Math/Algorithms/eigen_decomposition",Ft);const Mt=Ft;function Dt(){if(arguments.length)for(let e=0;e<9;++e)this[e]=arguments[e];else this.identity()}Object.assign(Dt.prototype,{*[Symbol.iterator](){for(let e=0;e<9;++e)yield this[e]},copy(){const e=Object.create(Dt.prototype);for(let t=0;t<9;++t)e[t]=this[t];return e},assign(e){for(let t=0;t<9;++t)this[t]=e[t];return this},equals(e){return this[0]===e[0]&&this[1]===e[1]&&this[2]===e[2]&&this[3]===e[3]&&this[4]===e[4]&&this[5]===e[5]&&this[6]===e[6]&&this[7]===e[7]&&this[8]===e[8]},rotation(){return Math.atan2(this[1],this[0])},set1(e,t,i){return this[e*this.order+t]=i,this},get1(e,t){return this[e*this.order+t]},set:(()=>{const e=new _t(0,0);return function(t,i,n,r,s){switch(arguments.length){case 0:this.identity();break;case 1:null===t&&(t=_t.Zero),this.identity(),this.translate(t);break;case 2:null===t&&(t=_t.Zero),null===i&&(i=0),this.identity(),this.translate(t),0!==i&&this.rotate(i);break;case 3:null===t&&(t=_t.Zero),null===i&&(i=0),null===n&&(n=_t.One),this.identity(),this.translate(t),0!==i&&this.rotate(i),n.equals(_t.One)||this.scale(n);break;case 4:if(null===t&&(t=_t.Zero),null===i&&(i=0),null===n&&(n=_t.One),null===r&&(r=0),this.identity(),this.translate(t),0!==i&&this.rotate(i),!n.equals(_t.One)){0!==r?(this.rotate(r),this.scale(n),this.rotate(-r)):this.scale(n)}break;case 5:{null===t&&(t=_t.Zero),null===i&&(i=0),null===n&&(n=_t.One),null===r&&(r=0),null===s&&(s=_t.Zero),this.identity(),this.translate(t);const o=!s.equals(_t.Zero);o&&this.translate(s),0!==i&&this.rotate(i),n.equals(_t.One)||(0!==r?(this.rotate(r),this.scale(n),this.rotate(-r)):this.scale(n)),o&&this.translate(e.assign(s).negate());break}case 9:for(let e=0;e<9;++e)this[e]=arguments[e]}return this}})(),get:(()=>{const e=new _t(0,0),t=new Tt(0,0,0),i=new _t(0,0),n=new Tt(0,0,0),r=new _t(0,0),s=new Et,o=new Et,a=new _t(0,0);return function(l,u,h,d,c){switch(null===l&&(l=e),null===u&&(u=t),null===h&&(h=i),null===d&&(d=n),null===c&&(c=r),arguments.length){case 1:l.set(this[6],this[7]);break;case 2:this.factor(l,s,i,o),u[0]=s[0],u[1]=s[1],u[2]=Math.atan2(s[1],s[0]);break;case 3:this.factor(l,s,h,o),u[0]=s[0],u[1]=s[1],u[2]=Math.atan2(s[1],s[0]);break;case 4:this.factor(l,s,h,o),u[0]=s[0],u[1]=s[1],u[2]=Math.atan2(s[1],s[0]),d[0]=o[0],d[1]=o[1],d[2]=Math.atan2(o[1],o[0]);break;case 5:Rt.set(a.assign(c).negate()),Rt.multLeft(this),Rt.translate(c),Rt.get(l,u,h,d)}}})(),factor:(()=>{const e=new Et,t=new Et,i=new Et,n={values:[],vectors:[[],[]]};return function(r,s,o,a){r.set(this[6],this[7]);const l=this.submatrix,u=l.determinant()<0?-1:1;i.assign(l).transpose().multLeft(l);const h=Mt(i,n);a.set(h.vectors[0][0],h.vectors[1][0],h.vectors[0][1],h.vectors[1][1]),o.x=u*Math.sqrt(h.values[0]),o.y=u*Math.sqrt(h.values[1]),e[0]=1/o.x,e[3]=1/o.y,s.assign(t.assign(a).transpose().multRight(e).multRight(a).multRight(l))}})(),determinant2(){const{0:e,1:t,3:i,4:n}=this;return e*n-t*i},determinant(){const{0:e,1:t,2:i,3:n,4:r,5:s,6:o,7:a,8:l}=this;return e*(r*l-s*a)-t*(n*l-s*o)+i*(n*a-r*o)},transpose(){let e;return e=this[1],this[1]=this[3],this[3]=e,e=this[2],this[2]=this[6],this[6]=e,e=this[5],this[5]=this[7],this[7]=e,this},inverse(){const{0:e,1:t,2:i,3:n,4:r,5:s,6:o,7:a,8:l}=this,u=e*r,h=e*a,d=n*t,c=n*a,p=o*t,g=o*r;let f=u*l-h*s-d*l+c*i+p*s-g*i;f=1/f;const m=(r*l-a*s)*f,_=-(t*l-a*i)*f,x=(t*s-r*i)*f,y=-(n*l-o*s)*f,w=(e*l-o*i)*f,b=-(e*s-n*i)*f;return this[0]=m,this[1]=_,this[2]=x,this[3]=y,this[4]=w,this[5]=b,this[6]=(c-g)*f,this[7]=-(h-p)*f,this[8]=(u-d)*f,this},multLeft(e){const{0:t,1:i,2:n,3:r,4:s,5:o,6:a,7:l,8:u}=this,{0:h,1:d,2:c,3:p,4:g,5:f,6:m,7:_,8:x}=e;return this[0]=t*h+r*d+a*c,this[1]=i*h+s*d+l*c,this[2]=n*h+o*d+u*c,this[3]=t*p+r*g+a*f,this[4]=i*p+s*g+l*f,this[5]=n*p+o*g+u*f,this[6]=t*m+r*_+a*x,this[7]=i*m+s*_+l*x,this[8]=n*m+o*_+u*x,this},multRight(e){const{0:t,1:i,2:n,3:r,4:s,5:o,6:a,7:l,8:u}=this,{0:h,1:d,2:c,3:p,4:g,5:f,6:m,7:_,8:x}=e;return this[0]=t*h+i*p+n*m,this[1]=t*d+i*g+n*_,this[2]=t*c+i*f+n*x,this[3]=r*h+s*p+o*m,this[4]=r*d+s*g+o*_,this[5]=r*c+s*f+o*x,this[6]=a*h+l*p+u*m,this[7]=a*d+l*g+u*_,this[8]=a*c+l*f+u*x,this},multVecMatrix(e){if(2===e.length){const{x:t,y:i}=e,n=t*this[2]+i*this[5]+this[8];return e.x=(t*this[0]+i*this[3]+this[6])/n,e.y=(t*this[1]+i*this[4]+this[7])/n,e}{const{x:t,y:i,z:n}=e;return e.x=t*this[0]+i*this[3]+n*this[6],e.y=t*this[1]+i*this[4]+n*this[7],e.z=t*this[2]+i*this[5]+n*this[8],e}},multMatrixVec(e){if(2===e.length){const{x:t,y:i}=e,n=t*this[6]+i*this[7]+this[8];return e.x=(t*this[0]+i*this[1]+this[2])/n,e.y=(t*this[3]+i*this[4]+this[5])/n,e}{const{x:t,y:i,z:n}=e;return e.x=t*this[0]+i*this[1]+n*this[2],e.y=t*this[3]+i*this[4]+n*this[5],e.z=t*this[6]+i*this[7]+n*this[8],e}},multDirMatrix(e){const{x:t,y:i}=e;return e.x=t*this[0]+i*this[3],e.y=t*this[1]+i*this[4],e},multMatrixDir(e){const{x:t,y:i}=e;return e.x=t*this[0]+i*this[1],e.y=t*this[3]+i*this[4],e},identity(){return this[0]=1,this[1]=0,this[2]=0,this[3]=0,this[4]=1,this[5]=0,this[6]=0,this[7]=0,this[8]=1,this},translate(e){const{x:t,y:i}=e;return this[6]+=this[0]*t+this[3]*i,this[7]+=this[1]*t+this[4]*i,this},rotate(e){return this.multLeft(Dt.Rotation(e))},scale(e){const{x:t,y:i}=e;return this[0]*=t,this[3]*=i,this[1]*=t,this[4]*=i,this},skewX(e){const t=Math.tan(e);return this[3]+=this[0]*t,this[4]+=this[1]*t,this[5]+=this[2]*t,this},skewY(e){const t=Math.tan(e);return this[0]+=this[3]*t,this[1]+=this[4]*t,this[2]+=this[5]*t,this},toString(){return Array.prototype.join.call(this," ")}}),Object.defineProperties(Dt.prototype,{order:{value:3},length:{value:9},x:{get:(()=>{const e=new Tt(0,0,0);return function(){return e.set(this[0],this[1],this[2])}})()},y:{get:(()=>{const e=new Tt(0,0,0);return function(){return e.set(this[3],this[4],this[5])}})()},z:{get:(()=>{const e=new Tt(0,0,0);return function(){return e.set(this[6],this[7],this[8])}})()},xAxis:{get:(()=>{const e=new _t(0,0);return function(){return e.set(this[0],this[1])}})()},yAxis:{get:(()=>{const e=new _t(0,0);return function(){return e.set(this[3],this[4])}})()},origin:{get:(()=>{const e=new _t(0,0);return function(){return e.set(this[6],this[7])}})()},submatrix:{get:(()=>{const e=new Et;return function(){return e[0]=this[0],e[1]=this[1],e[2]=this[3],e[3]=this[4],e}})()}}),Object.assign(Dt,{Identity:new Dt,Rotation(e){const t=Math.sin(e),i=Math.cos(e);return new Dt(i,t,0,-t,i,0,0,0,1)},Matrix2:e=>new Dt(e[0],e[1],0,e[2],e[3],0,0,0,1)});const Rt=new Dt,Pt=Dt;i.add("Matrix3","standard/Math/Numbers/Matrix3",Pt);const At=Pt;function Vt(e,t,i){function n(e,t,i,n,r,s,o,a,l){switch(arguments.length){case 0:ce.call(this,new At);break;case 1:ce.call(this,arguments[0]);break;case 3:{const e=arguments[0],t=arguments[1],i=arguments[2];ce.call(this,new At(e.x,e.y,e.z,t.x,t.y,t.z,i.x,i.y,i.z));break}case 9:ce.call(this,new At(+e,+t,+i,+n,+r,+s,+o,+a,+l));break;default:throw new Error("Invalid arguments.")}}Object.assign(ct(n,e,At,t,i),{setTransform:function(){const e=[];return function(t,i,n,r,s){e.push(t?.getValue()??null,i??null,n?.getValue()??null,r??null,s?.getValue()??null);for(let t=e.length-1;t>-1&&null===e[t];--t)e.pop();this.getValue().set(...e),e.length=0}}()});for(const e of Object.keys(n.prototype))Object.defineProperty(n.prototype,e,{enumerable:!1});function r(e){Object.defineProperty(n.prototype,e,{get(){return this.getValue()[e]},set(t){this.getValue()[e]=+t,this.addEvent()},enumerable:!0})}for(let e=0,t=At.prototype.length;e<t;++e)r(e);return n}const Lt={SFMatrix3d:Vt("SFMatrix3d",wt.SFVec2d,!0),SFMatrix3f:Vt("SFMatrix3f",wt.SFVec2f,!1)};i.add("SFMatrix3","x_ite/Fields/SFMatrix3",Lt);const Bt=Lt;function Ut(e,t){function i(e,t,i){switch(arguments.length){case 0:ce.call(this,new Tt(0,0,0));break;case 1:ce.call(this,arguments[0]);break;case 3:ce.call(this,new Tt(+e,+t,+i));break;default:throw new Error("Invalid arguments.")}}Object.assign(gt(i,e,Tt,t),{cross(e){return new this.constructor(this.getValue().copy().cross(e.getValue()))}});for(const e of Object.keys(i.prototype))Object.defineProperty(i.prototype,e,{enumerable:!1});const n={get(){return this.getValue().x},set(e){this.getValue().x=+e,this.addEvent()}},r={get(){return this.getValue().y},set(e){this.getValue().y=+e,this.addEvent()}},s={get(){return this.getValue().z},set(e){this.getValue().z=+e,this.addEvent()}};return Object.defineProperties(i.prototype,{0:n,1:r,2:s,x:Object.assign({enumerable:!0},n),y:Object.assign({enumerable:!0},r),z:Object.assign({enumerable:!0},s)}),i}const Xt={SFVec3d:Ut("SFVec3d",!0),SFVec3f:Ut("SFVec3f",!1)};i.add("SFVec3","x_ite/Fields/SFVec3",Xt);const jt=Xt;function kt(e,t,i,n){this.x=e,this.y=t,this.z=i,this.w=n}Object.assign(kt.prototype,{*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w},copy(){const e=Object.create(kt.prototype);return e.x=this.x,e.y=this.y,e.z=this.z,e.w=this.w,e},assign(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},getReal(e){return e.x=this.x/this.w,e.y=this.y/this.w,e.z=this.z/this.w,e},negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},inverse(){return this.x=1/this.x,this.y=1/this.y,this.z=1/this.z,this.w=1/this.w,this},add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},subtract(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},multiply(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},multVec(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this},divide(e){return this.x/=e,this.y/=e,this.z/=e,this.w/=e,this},divVec(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this},normalize(){const e=Math.hypot(this.x,this.y,this.z,this.w);return e&&(this.x/=e,this.y/=e,this.z/=e,this.w/=e),this},dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},norm(){const{x:e,y:t,z:i,w:n}=this;return e*e+t*t+i*i+n*n},magnitude(){return Math.hypot(this.x,this.y,this.z,this.w)},distance(e){return Math.hypot(this.x-e.x,this.y-e.y,this.z-e.z,this.w-e.w)},lerp(e,t){const{x:i,y:n,z:r,w:s}=this;return this.x=i+t*(e.x-i),this.y=n+t*(e.y-n),this.z=r+t*(e.z-r),this.w=s+t*(e.w-s),this},abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this.w=Math.abs(this.w),this},min(e){let{x:t,y:i,z:n,w:r}=this;for(const e of arguments)t=Math.min(t,e.x),i=Math.min(i,e.y),n=Math.min(n,e.z),r=Math.min(r,e.w);return this.x=t,this.y=i,this.z=n,this.w=r,this},max(e){let{x:t,y:i,z:n,w:r}=this;for(const e of arguments)t=Math.max(t,e.x),i=Math.max(i,e.y),n=Math.max(n,e.z),r=Math.max(r,e.w);return this.x=t,this.y=i,this.z=n,this.w=r,this},toString(){return this.x+" "+this.y+" "+this.z+" "+this.w}}),Object.defineProperties(kt.prototype,{length:{value:4},0:{get(){return this.x},set(e){this.x=e}},1:{get(){return this.y},set(e){this.y=e}},2:{get(){return this.z},set(e){this.z=e}},3:{get(){return this.w},set(e){this.w=e}}}),Object.assign(kt,{Zero:new kt(0,0,0,0),One:new kt(1,1,1,1),xAxis:new kt(1,0,0,0),yAxis:new kt(0,1,0,0),zAxis:new kt(0,0,1,0),wAxis:new kt(0,0,0,1)});const zt=kt;i.add("Vector4","standard/Math/Numbers/Vector4",zt);const Gt=zt;function Ht(e,t,i,n){this.x=e,this.y=t,this.z=i,this.w=n}Object.assign(Ht.prototype,{*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w},copy(){const e=Object.create(Ht.prototype);return e.x=this.x,e.y=this.y,e.z=this.z,e.w=this.w,e},assign(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},setMatrix(e){if(e[0]>e[4])var t=e[0]>e[8]?0:2;else t=e[4]>e[8]?1:2;const i=e[0]+e[4]+e[8];if(i>e[3*t+t]){this[3]=Math.sqrt(i+1)/2;const t=4*this[3];this[0]=(e[5]-e[7])/t,this[1]=(e[6]-e[2])/t,this[2]=(e[1]-e[3])/t}else{const i=(t+1)%3,n=(t+2)%3;this[t]=Math.sqrt(e[3*t+t]-e[3*i+i]-e[3*n+n]+1)/2;const r=4*this[t];this[i]=(e[3*t+i]+e[3*i+t])/r,this[n]=(e[3*t+n]+e[3*n+t])/r,this[3]=(e[3*i+n]-e[3*n+i])/r}return this},getMatrix(e=new At){const{x:t,y:i,z:n,w:r}=this,s=t*t,o=t*i,a=i*i,l=i*n,u=n*t,h=n*n,d=r*t,c=r*i,p=r*n;return e[0]=1-2*(a+h),e[1]=2*(o+p),e[2]=2*(u-c),e[3]=2*(o-p),e[4]=1-2*(h+s),e[5]=2*(l+d),e[6]=2*(u+c),e[7]=2*(l-d),e[8]=1-2*(a+s),e},setEuler(e,t,i,n="XYZ"){const r=Math.cos(e/2),s=Math.cos(t/2),o=Math.cos(i/2),a=Math.sin(e/2),l=Math.sin(t/2),u=Math.sin(i/2);switch(n){case"XYZ":this.x=a*s*o+r*l*u,this.y=r*l*o-a*s*u,this.z=r*s*u+a*l*o,this.w=r*s*o-a*l*u;break;case"ZYX":this.x=a*s*o-r*l*u,this.y=r*l*o+a*s*u,this.z=r*s*u-a*l*o,this.w=r*s*o+a*l*u;break;case"YXZ":this.x=a*s*o+r*l*u,this.y=r*l*o-a*s*u,this.z=r*s*u-a*l*o,this.w=r*s*o+a*l*u;break;case"ZXY":this.x=a*s*o-r*l*u,this.y=r*l*o+a*s*u,this.z=r*s*u+a*l*o,this.w=r*s*o-a*l*u;break;case"YZX":this.x=a*s*o+r*l*u,this.y=r*l*o+a*s*u,this.z=r*s*u-a*l*o,this.w=r*s*o-a*l*u;break;case"XZY":this.x=a*s*o-r*l*u,this.y=r*l*o-a*s*u,this.z=r*s*u+a*l*o,this.w=r*s*o+a*l*u}return this},getEuler(e=[],t="XYZ"){const{0:i,1:n,2:r,3:s,4:o,5:a,6:l,7:u,8:h}=this.getMatrix($t);switch(t){case"XYZ":e[1]=Math.asin(g.clamp(l,-1,1)),Math.abs(l)<.9999999?(e[0]=Math.atan2(-u,h),e[2]=Math.atan2(-s,i)):(e[0]=Math.atan2(a,o),e[2]=0);break;case"ZYX":e[1]=Math.asin(-g.clamp(r,-1,1)),Math.abs(r)<.9999999?(e[0]=Math.atan2(a,h),e[2]=Math.atan2(n,i)):(e[0]=0,e[2]=Math.atan2(-s,o));break;case"YXZ":e[0]=Math.asin(-g.clamp(u,-1,1)),Math.abs(u)<.9999999?(e[1]=Math.atan2(l,h),e[2]=Math.atan2(n,o)):(e[1]=Math.atan2(-r,i),e[2]=0);break;case"ZXY":e[0]=Math.asin(g.clamp(a,-1,1)),Math.abs(a)<.9999999?(e[1]=Math.atan2(-r,h),e[2]=Math.atan2(-s,o)):(e[1]=0,e[2]=Math.atan2(n,i));break;case"YZX":e[2]=Math.asin(g.clamp(n,-1,1)),Math.abs(n)<.9999999?(e[0]=Math.atan2(-u,o),e[1]=Math.atan2(-r,i)):(e[0]=0,e[1]=Math.atan2(l,h));break;case"XZY":e[2]=Math.asin(-g.clamp(s,-1,1)),Math.abs(s)<.9999999?(e[0]=Math.atan2(a,o),e[1]=Math.atan2(l,i)):(e[0]=Math.atan2(-u,h),e[1]=0)}return e},isReal(){return!(this.x||this.y||this.z)},isImag(){return!this.w},equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},inverse(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},subtract(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},multiply(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},multLeft(e){const{x:t,y:i,z:n,w:r}=this,{x:s,y:o,z:a,w:l}=e;return this.x=r*s+t*l+i*a-n*o,this.y=r*o+i*l+n*s-t*a,this.z=r*a+n*l+t*o-i*s,this.w=r*l-t*s-i*o-n*a,this},multRight(e){const{x:t,y:i,z:n,w:r}=this,{x:s,y:o,z:a,w:l}=e;return this.x=l*t+s*r+o*n-a*i,this.y=l*i+o*r+a*t-s*n,this.z=l*n+a*r+s*i-o*t,this.w=l*r-s*t-o*i-a*n,this},divide(e){return this.x/=e,this.y/=e,this.z/=e,this.w/=e,this},multVecQuat(e){const{x:t,y:i,z:n,w:r}=this,{x:s,y:o,z:a}=e,l=2*(i*a-n*o),u=2*(n*s-t*a),h=2*(t*o-i*s);return e.x+=r*l+i*h-n*u,e.y+=r*u+n*l-t*h,e.z+=r*h+t*u-i*l,e},multQuatVec(e){const{x:t,y:i,z:n,w:r}=this,{x:s,y:o,z:a}=e,l=2*(n*o-i*a),u=2*(t*a-n*s),h=2*(i*s-t*o);return e.x+=r*l-i*h+n*u,e.y+=r*u-n*l+t*h,e.z+=r*h-t*u+i*l,e},normalize(){const e=Math.hypot(this.x,this.y,this.z,this.w);return e&&(this.x/=e,this.y/=e,this.z/=e,this.w/=e),this},dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},norm(){const{x:e,y:t,z:i,w:n}=this;return e*e+t*t+i*i+n*n},magnitude(){return Math.hypot(this.x,this.y,this.z,this.w)},pow(t){if(t instanceof Ht)return this.assign(e.assign(t).multRight(this.log()).exp());if(this.isReal())return this.set(0,0,0,this.w**t);const i=this.magnitude(),n=i**t,r=t*Math.acos(this.w/i),s=n/this.imag.magnitude()*Math.sin(r);return this.x*=s,this.y*=s,this.z*=s,this.w=n*Math.cos(r),this},log(){if(this.isReal())return this.w>0?this.set(0,0,0,Math.log(this.w)):this.set(Math.PI,0,0,Math.log(-this.w));const e=this.magnitude(),t=this.imag.normalize().multiply(Math.acos(this.w/e)),i=Math.log(e);return this.x=t.x,this.y=t.y,this.z=t.z,this.w=i,this},exp(){if(this.isReal())return this.set(0,0,0,Math.exp(this.w));const e=this.imag,t=e.magnitude(),i=Math.exp(this.w),n=i*Math.cos(t),r=e.multiply(i*Math.sin(t)/t);return this.x=r.x,this.y=r.y,this.z=r.z,this.w=n,this},slerp(e,t){return g.slerp(this,qt.assign(e),t)},squad(e,t,i,n){return g.slerp(g.slerp(this,qt.assign(i),n),g.slerp(Yt.assign(e),Wt.assign(t),n),2*n*(1-n))},toString(){return this.x+" "+this.y+" "+this.z+" "+this.w}}),Object.defineProperties(Ht.prototype,{length:{value:4},0:{get(){return this.x},set(e){this.x=e}},1:{get(){return this.y},set(e){this.y=e}},2:{get(){return this.z},set(e){this.z=e}},3:{get(){return this.w},set(e){this.w=e}},real:{get(){return this.w}},imag:{get:(()=>{const e=new Tt(0,0,0);return function(){return e.set(this.x,this.y,this.z)}})()}}),Object.assign(Ht,{Identity:new Ht(0,0,0,1),spline:(()=>{const e=new Ht(0,0,0,1),t=new Ht(0,0,0,1),i=new Ht(0,0,0,1),n=new Ht(0,0,0,1);return function(r,s,o){return e.assign(r),t.assign(s),i.assign(o),e.dot(t)<0&&e.negate(),i.dot(t)<0&&i.negate(),n.assign(t).inverse(),t.multRight(qt.assign(n).multRight(e).log().add(Yt.assign(n).multRight(i).log()).divide(-4).exp()).normalize().copy()}})()});const qt=new Ht(0,0,0,1),Yt=new Ht(0,0,0,1),Wt=new Ht(0,0,0,1),$t=new At,Jt=Ht;i.add("Quaternion","standard/Math/Numbers/Quaternion",Jt);const Kt=Jt,Zt=Symbol(),Qt=Symbol(),ei=Symbol(),ti=Symbol(),ii=Symbol();function ni(e,t,i,n){switch(this[Zt]=0,this[Qt]=0,this[ei]=1,this[ti]=0,arguments.length){case 0:return void(this[ii]=new Kt(0,0,0,1));case 1:return this[ii]=arguments[0],void this.update();case 2:{const e=arguments[0],t=arguments[1];return this[ii]=new Kt(0,0,0,1),t instanceof Tt?this.setFromToVec(e,t):void this.set(e.x,e.y,e.z,t)}case 4:return this[ii]=new Kt(0,0,0,1),void this.set(e,t,i,n)}}Object.assign(ni.prototype,{*[Symbol.iterator](){yield this[Zt],yield this[Qt],yield this[ei],yield this[ti]},update(){const e=this.get();return this[Zt]=e.x,this[Qt]=e.y,this[ei]=e.z,this[ti]=e.w,this},copy(){const e=Object.create(ni.prototype);return e[Zt]=this[Zt],e[Qt]=this[Qt],e[ei]=this[ei],e[ti]=this[ti],e[ii]=this[ii].copy(),e},assign(e){return this[Zt]=e[Zt],this[Qt]=e[Qt],this[ei]=e[ei],this[ti]=e[ti],this[ii].assign(e[ii]),this},set(e,t,i,n){this[Zt]=e,this[Qt]=t,this[ei]=i,this[ti]=n;const r=Math.hypot(e,t,i);if(0===r)return this[ii].set(0,0,0,1),this;const s=g.interval(n/2,0,Math.PI),o=Math.sin(s)/r;return this[ii].set(e*o,t*o,i*o,Math.cos(s)),this},get:(()=>{const e=new Gt(0,0,0,0);return function(){const t=this[ii];if(Math.abs(t.w)>1)return Gt.zAxis;{const i=2*Math.acos(t.w),n=Math.sin(i/2);if(0===n)return Gt.zAxis;{const r=t.imag.divide(n);return e.set(r.x,r.y,r.z,i)}}}})(),setAxisAngle(e,t){return this.set(e.x,e.y,e.z,t)},setFromToVec:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0),i=new Tt(0,0,0),n=new Tt(0,0,0);return function(r,s){e.assign(r).normalize(),t.assign(s).normalize();const o=g.clamp(e.dot(t),-1,1),a=i.assign(e).cross(t).normalize();return 0===a.magnitude()?o>0?this[ii].set(0,0,0,1):(n.assign(e).cross(Tt.xAxis),0===n.norm()&&n.assign(e).cross(Tt.yAxis),n.normalize(),this[ii].set(n.x,n.y,n.z,0)):(a.multiply(Math.sqrt(Math.abs(1-o)/2)),this[ii].set(a.x,a.y,a.z,Math.sqrt(Math.abs(1+o)/2))),this.update(),this}})(),setAxis(e){this.set(e.x,e.y,e.z,this[ti])},getAxis(e=new Tt(0,0,0)){return e.set(this[Zt],this[Qt],this[ei])},setQuaternion(e){return this[ii].assign(e).normalize(),this.update(),this},getQuaternion(e=new Kt(0,0,0,1)){return e.assign(this[ii])},setMatrix(e){return this[ii].setMatrix(e).normalize(),this.update(),this},getMatrix(e=new At){return this[ii].getMatrix(e)},setEuler(e,t,i,n="XYZ"){return this[ii].setEuler(e,t,i,n),this.update(),this},getEuler(e=[],t="XYZ"){return this[ii].getEuler(e,t)},equals(e){return this[ii].equals(e[ii])},inverse(){return this[ii].inverse(),this.update(),this},multLeft(e){return this[ii].multLeft(e[ii]).normalize(),this.update(),this},multRight(e){return this[ii].multRight(e[ii]).normalize(),this.update(),this},multVecRot(e){return this[ii].multVecQuat(e)},multRotVec(e){return this[ii].multQuatVec(e)},normalize(){return this[ii].normalize(),this.update(),this},pow(e){return this[ii].pow(e),this.update(),this},slerp(e,t){return this[ii].slerp(e[ii],t),this.update(),this},squad(e,t,i,n){return this[ii].squad(e[ii],t[ii],i[ii],n),this.update(),this},toString(){return this[Zt]+" "+this[Qt]+" "+this[ei]+" "+this[ti]}});const ri={get(){return this[Zt]},set(e){this[Zt]=e,this.set(e,this[Qt],this[ei],this[ti])},enumerable:!0},si={get(){return this[Qt]},set(e){this[Qt]=e,this.set(this[Zt],e,this[ei],this[ti])},enumerable:!0},oi={get(){return this[ei]},set(e){this[ei]=e,this.set(this[Zt],this[Qt],e,this[ti])},enumerable:!0},ai={get(){return this[ti]},set(e){this[ti]=e,this.set(this[Zt],this[Qt],this[ei],e)},enumerable:!0};Object.defineProperties(ni.prototype,{length:{value:4},x:ri,y:si,z:oi,angle:ai}),ri.enumerable=!1,si.enumerable=!1,oi.enumerable=!1,ai.enumerable=!1,Object.defineProperties(ni.prototype,{0:ri,1:si,2:oi,3:ai}),Object.assign(ni,{Identity:new ni,fromQuaternion:e=>(new ni).setQuaternion(e),fromMatrix:e=>(new ni).setMatrix(e),fromEuler:(e,t,i,n="XYZ")=>(new ni).setEuler(e,t,i,n),spline(e,t,i){const n=Object.create(this.prototype);return n[ii]=Kt.spline(e[ii],t[ii],i[ii]),n.update(),n}});const li=ni;i.add("Rotation4","standard/Math/Numbers/Rotation4",li);const ui=li;function hi(){if(arguments.length)for(let e=0;e<16;++e)this[e]=arguments[e];else this.identity()}Object.assign(hi.prototype,{*[Symbol.iterator](){for(let e=0;e<16;++e)yield this[e]},copy(){const e=Object.create(hi.prototype);for(let t=0;t<16;++t)e[t]=this[t];return e},assign(e){for(let t=0;t<16;++t)this[t]=e[t];return this},equals(e){return this[0]===e[0]&&this[1]===e[1]&&this[2]===e[2]&&this[3]===e[3]&&this[4]===e[4]&&this[5]===e[5]&&this[6]===e[6]&&this[7]===e[7]&&this[8]===e[8]&&this[9]===e[9]&&this[10]===e[10]&&this[11]===e[11]&&this[12]===e[12]&&this[13]===e[13]&&this[14]===e[14]&&this[15]===e[15]},set1(e,t,i){return this[e*this.order+t]=i,this},get1(e,t){return this[e*this.order+t]},set:(()=>{const e=new ui,t=new Tt(0,0,0);return function(i,n,r,s,o){switch(arguments.length){case 0:this.identity();break;case 1:null===i&&(i=Tt.Zero),this.identity(),this.translate(i);break;case 2:null===i&&(i=Tt.Zero),null===n&&(n=ui.Identity),this.identity(),this.translate(i),n.equals(ui.Identity)||this.rotate(n);break;case 3:null===i&&(i=Tt.Zero),null===n&&(n=ui.Identity),null===r&&(r=Tt.One),this.identity(),this.translate(i),n.equals(ui.Identity)||this.rotate(n),r.equals(Tt.One)||this.scale(r);break;case 4:if(null===i&&(i=Tt.Zero),null===n&&(n=ui.Identity),null===r&&(r=Tt.One),null===s&&(s=ui.Identity),this.identity(),this.translate(i),n.equals(ui.Identity)||this.rotate(n),!r.equals(Tt.One)){!s.equals(ui.Identity)?(this.rotate(s),this.scale(r),this.rotate(e.assign(s).inverse())):this.scale(r)}break;case 5:{null===i&&(i=Tt.Zero),null===n&&(n=ui.Identity),null===r&&(r=Tt.One),null===s&&(s=ui.Identity),null===o&&(o=Tt.Zero),this.identity(),this.translate(i);const a=!o.equals(Tt.Zero);a&&this.translate(o),n.equals(ui.Identity)||this.rotate(n),r.equals(Tt.One)||(s.equals(ui.Identity)?this.scale(r):(this.rotate(s),this.scale(r),this.rotate(e.assign(s).inverse()))),a&&this.translate(t.assign(o).negate());break}case 16:for(let e=0;e<16;++e)this[e]=arguments[e]}return this}})(),get:(()=>{const e=new Tt(0,0,0),t=new ui,i=new Tt(0,0,0),n=new ui,r=new Tt(0,0,0),s=new At,o=new At,a=new Tt(0,0,0);return function(l,u,h,d,c){switch(null===l&&(l=e),null===u&&(u=t),null===h&&(h=i),null===d&&(d=n),null===c&&(c=r),arguments.length){case 1:l.set(this[12],this[13],this[14]);break;case 2:this.factor(l,s,i,o),u.setMatrix(s);break;case 3:this.factor(l,s,h,o),u.setMatrix(s);break;case 4:this.factor(l,s,h,o),u.setMatrix(s),d.setMatrix(o);break;case 5:ci.set(a.assign(c).negate()),ci.multLeft(this),ci.translate(c),ci.get(l,u,h,d)}}})(),setRotation(e){return this.setQuaternion(e.getQuaternion(di))},setQuaternion(e){const{x:t,y:i,z:n,w:r}=e,s=i*i,o=n*n,a=t*i,l=n*r,u=n*t,h=i*r,d=t*t,c=i*n,p=t*r;return this[0]=1-2*(s+o),this[1]=2*(a+l),this[2]=2*(u-h),this[3]=0,this[4]=2*(a-l),this[5]=1-2*(o+d),this[6]=2*(c+p),this[7]=0,this[8]=2*(u+h),this[9]=2*(c-p),this[10]=1-2*(s+d),this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},factor:(()=>{const e=new At,t=new At,i=new At,n={values:[],vectors:[[],[],[]]};return function(r,s,o,a){r.set(this[12],this[13],this[14]);const l=this.submatrix,u=l.determinant()<0?-1:1;i.assign(l).transpose().multLeft(l);const h=Mt(i,n);a.set(h.vectors[0][0],h.vectors[1][0],h.vectors[2][0],h.vectors[0][1],h.vectors[1][1],h.vectors[2][1],h.vectors[0][2],h.vectors[1][2],h.vectors[2][2]),o.x=u*Math.sqrt(h.values[0]),o.y=u*Math.sqrt(h.values[1]),o.z=u*Math.sqrt(h.values[2]),e[0]=1/o.x,e[4]=1/o.y,e[8]=1/o.z,s.assign(t.assign(a).transpose().multRight(e).multRight(a).multRight(l))}})(),determinant3(){const{0:e,1:t,2:i,4:n,5:r,6:s,8:o,9:a,10:l}=this;return e*(r*l-s*a)-t*(n*l-s*o)+i*(n*a-r*o)},determinant(){const{0:e,1:t,2:i,3:n,4:r,5:s,6:o,7:a,8:l,9:u,10:h,11:d,12:c,13:p,14:g,15:f}=this,m=h*f,_=g*d,x=o*f,y=g*a,w=o*d,b=h*a,S=i*f,T=g*n,v=i*d,O=h*n,E=i*a,C=o*n;return e*(m*s+y*u+w*p-_*s-x*u-b*p)+r*(_*t+S*u+O*p-m*t-T*u-v*p)+l*(x*t+T*s+E*p-y*t-S*s-C*p)+c*(b*t+v*s+C*u-w*t-O*s-E*u)},transpose(){let e;return e=this[1],this[1]=this[4],this[4]=e,e=this[2],this[2]=this[8],this[8]=e,e=this[3],this[3]=this[12],this[12]=e,e=this[6],this[6]=this[9],this[9]=e,e=this[7],this[7]=this[13],this[13]=e,e=this[11],this[11]=this[14],this[14]=e,this},inverse(){const{0:e,1:t,2:i,3:n,4:r,5:s,6:o,7:a,8:l,9:u,10:h,11:d,12:c,13:p,14:g,15:f}=this,m=h*f,_=g*d,x=o*f,y=g*a,w=o*d,b=h*a,S=i*f,T=g*n,v=i*d,O=h*n,E=i*a,C=o*n,N=l*p,I=c*u,F=r*p,M=c*s,D=r*u,R=l*s,P=e*p,A=c*t,V=e*u,L=l*t,B=e*s,U=r*t,X=m*s+y*u+w*p-(_*s+x*u+b*p),j=_*t+S*u+O*p-(m*t+T*u+v*p),k=x*t+T*s+E*p-(y*t+S*s+C*p),z=b*t+v*s+C*u-(w*t+O*s+E*u);let G=e*X+r*j+l*k+c*z;return G=1/G,this[0]=G*X,this[1]=G*j,this[2]=G*k,this[3]=G*z,this[4]=G*(_*r+x*l+b*c-m*r-y*l-w*c),this[5]=G*(m*e+T*l+v*c-_*e-S*l-O*c),this[6]=G*(y*e+S*r+C*c-x*e-T*r-E*c),this[7]=G*(w*e+O*r+E*l-b*e-v*r-C*l),this[8]=G*(N*a+M*d+D*f-I*a-F*d-R*f),this[9]=G*(I*n+P*d+L*f-N*n-A*d-V*f),this[10]=G*(F*n+A*a+B*f-M*n-P*a-U*f),this[11]=G*(R*n+V*a+U*d-D*n-L*a-B*d),this[12]=G*(F*h+R*g+I*o-D*g-N*o-M*h),this[13]=G*(V*g+N*i+A*h-P*h-L*g-I*i),this[14]=G*(P*o+U*g+M*i-B*g-F*i-A*o),this[15]=G*(B*h+D*i+L*o-V*o-U*h-R*i),this},multLeft(e){const{0:t,1:i,2:n,3:r,4:s,5:o,6:a,7:l,8:u,9:h,10:d,11:c,12:p,13:g,14:f,15:m}=this,{0:_,1:x,2:y,3:w,4:b,5:S,6:T,7:v,8:O,9:E,10:C,11:N,12:I,13:F,14:M,15:D}=e;return this[0]=t*_+s*x+u*y+p*w,this[1]=i*_+o*x+h*y+g*w,this[2]=n*_+a*x+d*y+f*w,this[3]=r*_+l*x+c*y+m*w,this[4]=t*b+s*S+u*T+p*v,this[5]=i*b+o*S+h*T+g*v,this[6]=n*b+a*S+d*T+f*v,this[7]=r*b+l*S+c*T+m*v,this[8]=t*O+s*E+u*C+p*N,this[9]=i*O+o*E+h*C+g*N,this[10]=n*O+a*E+d*C+f*N,this[11]=r*O+l*E+c*C+m*N,this[12]=t*I+s*F+u*M+p*D,this[13]=i*I+o*F+h*M+g*D,this[14]=n*I+a*F+d*M+f*D,this[15]=r*I+l*F+c*M+m*D,this},multRight(e){const{0:t,1:i,2:n,3:r,4:s,5:o,6:a,7:l,8:u,9:h,10:d,11:c,12:p,13:g,14:f,15:m}=this,{0:_,1:x,2:y,3:w,4:b,5:S,6:T,7:v,8:O,9:E,10:C,11:N,12:I,13:F,14:M,15:D}=e;return this[0]=t*_+i*b+n*O+r*I,this[1]=t*x+i*S+n*E+r*F,this[2]=t*y+i*T+n*C+r*M,this[3]=t*w+i*v+n*N+r*D,this[4]=s*_+o*b+a*O+l*I,this[5]=s*x+o*S+a*E+l*F,this[6]=s*y+o*T+a*C+l*M,this[7]=s*w+o*v+a*N+l*D,this[8]=u*_+h*b+d*O+c*I,this[9]=u*x+h*S+d*E+c*F,this[10]=u*y+h*T+d*C+c*M,this[11]=u*w+h*v+d*N+c*D,this[12]=p*_+g*b+f*O+m*I,this[13]=p*x+g*S+f*E+m*F,this[14]=p*y+g*T+f*C+m*M,this[15]=p*w+g*v+f*N+m*D,this},multVecMatrix(e){if(3===e.length){const{x:t,y:i,z:n}=e,r=1/(t*this[3]+i*this[7]+n*this[11]+this[15]);return e.x=(t*this[0]+i*this[4]+n*this[8]+this[12])*r,e.y=(t*this[1]+i*this[5]+n*this[9]+this[13])*r,e.z=(t*this[2]+i*this[6]+n*this[10]+this[14])*r,e}{const{x:t,y:i,z:n,w:r}=e;return e.x=t*this[0]+i*this[4]+n*this[8]+r*this[12],e.y=t*this[1]+i*this[5]+n*this[9]+r*this[13],e.z=t*this[2]+i*this[6]+n*this[10]+r*this[14],e.w=t*this[3]+i*this[7]+n*this[11]+r*this[15],e}},multMatrixVec(e){if(3===e.length){const{x:t,y:i,z:n}=e,r=1/(t*this[12]+i*this[13]+n*this[14]+this[15]);return e.x=(t*this[0]+i*this[1]+n*this[2]+this[3])*r,e.y=(t*this[4]+i*this[5]+n*this[6]+this[7])*r,e.z=(t*this[8]+i*this[9]+n*this[10]+this[11])*r,e}{const{x:t,y:i,z:n,w:r}=e;return e.x=t*this[0]+i*this[1]+n*this[2]+r*this[3],e.y=t*this[4]+i*this[5]+n*this[6]+r*this[7],e.z=t*this[8]+i*this[9]+n*this[10]+r*this[11],e.w=t*this[12]+i*this[13]+n*this[14]+r*this[15],e}},multDirMatrix(e){const{x:t,y:i,z:n}=e;return e.x=t*this[0]+i*this[4]+n*this[8],e.y=t*this[1]+i*this[5]+n*this[9],e.z=t*this[2]+i*this[6]+n*this[10],e},multMatrixDir(e){const{x:t,y:i,z:n}=e;return e.x=t*this[0]+i*this[1]+n*this[2],e.y=t*this[4]+i*this[5]+n*this[6],e.z=t*this[8]+i*this[9]+n*this[10],e},identity(){return this[0]=1,this[1]=0,this[2]=0,this[3]=0,this[4]=0,this[5]=1,this[6]=0,this[7]=0,this[8]=0,this[9]=0,this[10]=1,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},translate(e){const{x:t,y:i,z:n}=e;return this[12]+=this[0]*t+this[4]*i+this[8]*n,this[13]+=this[1]*t+this[5]*i+this[9]*n,this[14]+=this[2]*t+this[6]*i+this[10]*n,this},rotate(e){return this.multLeft(ci.setQuaternion(e.getQuaternion(di)))},scale(e){const{x:t,y:i,z:n}=e;return this[0]*=t,this[4]*=i,this[8]*=n,this[1]*=t,this[5]*=i,this[9]*=n,this[2]*=t,this[6]*=i,this[10]*=n,this},toString(){return Array.prototype.join.call(this," ")}}),Object.defineProperties(hi.prototype,{order:{value:4},length:{value:16},x:{get:(()=>{const e=new Gt(0,0,0,0);return function(){return e.set(this[0],this[1],this[2],this[3])}})()},y:{get:(()=>{const e=new Gt(0,0,0,0);return function(){return e.set(this[4],this[5],this[6],this[7])}})()},z:{get:(()=>{const e=new Gt(0,0,0,0);return function(){return e.set(this[8],this[9],this[10],this[11])}})()},w:{get:(()=>{const e=new Gt(0,0,0,0);return function(){return e.set(this[12],this[13],this[14],this[15])}})()},xAxis:{get:(()=>{const e=new Tt(0,0,0);return function(){return e.set(this[0],this[1],this[2])}})()},yAxis:{get:(()=>{const e=new Tt(0,0,0);return function(){return e.set(this[4],this[5],this[6])}})()},zAxis:{get:(()=>{const e=new Tt(0,0,0);return function(){return e.set(this[8],this[9],this[10])}})()},origin:{get:(()=>{const e=new Tt(0,0,0);return function(){return e.set(this[12],this[13],this[14])}})()},submatrix:{get:(()=>{const e=new At;return function(){return e[0]=this[0],e[1]=this[1],e[2]=this[2],e[3]=this[4],e[4]=this[5],e[5]=this[6],e[6]=this[8],e[7]=this[9],e[8]=this[10],e}})()}}),Object.assign(hi,{Identity:new hi,Rotation(e){return Object.create(this.prototype).setQuaternion(e.getQuaternion(di))},Quaternion(e){return Object.create(this.prototype).setQuaternion(e)},Matrix3:e=>new hi(e[0],e[1],0,0,e[3],e[4],0,0,0,0,1,0,e[6],e[7],0,1),SubMatrix:e=>new hi(e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1)});const di=new Kt,ci=new hi,pi=hi;i.add("Matrix4","standard/Math/Numbers/Matrix4",pi);const gi=pi;function fi(e,t,i){function n(e,t,i,n,r,s,o,a,l,u,h,d,c,p,g,f){switch(arguments.length){case 0:ce.call(this,new gi);break;case 1:ce.call(this,arguments[0]);break;case 4:{const e=arguments[0],t=arguments[1],i=arguments[2],n=arguments[3];ce.call(this,new gi(e.x,e.y,e.z,e.w,t.x,t.y,t.z,t.w,i.x,i.y,i.z,i.w,n.x,n.y,n.z,n.w));break}case 16:ce.call(this,new gi(+e,+t,+i,+n,+r,+s,+o,+a,+l,+u,+h,+d,+c,+p,+g,+f));break;default:throw new Error("Invalid arguments.")}}ct(n,e,gi,t,i);for(const e of Object.keys(n.prototype))Object.defineProperty(n.prototype,e,{enumerable:!1});function r(e){Object.defineProperty(n.prototype,e,{get(){return this.getValue()[e]},set(t){this.getValue()[e]=t,this.addEvent()},enumerable:!0})}for(let e=0,t=gi.prototype.length;e<t;++e)r(e);return n}const mi={SFMatrix4d:fi("SFMatrix4d",jt.SFVec3d,!0),SFMatrix4f:fi("SFMatrix4f",jt.SFVec3f,!1),VrmlMatrix:fi("VrmlMatrix",jt.SFVec3f,!1)};i.add("SFMatrix4","x_ite/Fields/SFMatrix4",mi);const _i=mi,xi=new WeakMap;function yi(){const e=this.getValue();e?.dispose(),Ci.prototype.dispose.call(this),xi.delete(e)}const wi={get(e){const t=xi.get(e);if(t)return t;{const t=new Ci(e);return t.dispose=yi,xi.set(e,t),t}},add(e,t){xi.set(e,t)},delete(e){xi.delete(e)}};i.add("SFNodeCache","x_ite/Fields/SFNodeCache",wi);const bi=wi,Si=Symbol(),Ti=Symbol(),vi={get(e,t){try{const i=e[t];if(void 0!==i)return i;const n=e.getValue().getField(t);if(n.getAccessType()===d.inputOnly)return;return n.valueOf()}catch{return}},set(e,t,i){if(t in e)return e[t]=i,!0;try{const n=e.getValue().getField(t);return n.getAccessType()!==d.outputOnly&&n.setValue(i),!0}catch(i){return console.error(e,t,i),!1}},has(e,t){try{return!!e.getValue().getField(t)}catch{return t in e}},ownKeys(e){const t=e.getValue(),i=[];if(t)for(const e of t.getFieldDefinitions())i.push(e.name);return i},getOwnPropertyDescriptor(e,t){const i=e.getValue();if(i){const n=i.getFieldDefinitions().get(t);if(n)return{value:this.get(e,t),writable:n.accessType!==d.outputOnly,enumerable:!0,configurable:!0}}}};function Oi(e){const t=new Proxy(this,vi);return this[Si]=this,this[Ti]=t,e?(e.addParent(t),ce.call(this,e)):ce.call(this,null),t}Object.assign(Object.setPrototypeOf(Oi.prototype,ce.prototype),{[Si]:null,[Ti]:null,copy(e){const t=this[Si].getValue();return t?new Oi(e?t.copy(e):t):new Oi},equals(e){const t=this[Si];return e?t.getValue()===e.getValue():null===t.getValue()},isDefaultValue(){return null===this[Si].getValue()},set(e){const t=this[Si],i=t.getValue();i&&i.removeParent(t[Ti]),e?(e.addParent(t[Ti]),ce.prototype.set.call(t,e)):ce.prototype.set.call(t,null)},getNodeTypeName(){const e=this[Si].getValue();if(e)return e.getTypeName();throw new Error("SFNode.getNodeTypeName: node is null.")},getNodeName(){const e=this[Si].getValue();if(e)return e.getName();throw new Error("SFNode.getNodeName: node is null.")},getNodeDisplayName(){const e=this[Si].getValue();if(e)return e.getDisplayName();throw new Error("SFNode.getNodeDisplayName: node is null.")},getNodeType(){const e=this[Si].getValue();if(e)return Array.from(e.getType());throw new Error("SFNode.getNodeType: node is null.")},getFieldDefinitions(){const e=this[Si].getValue();if(e)return e.getFieldDefinitions();throw new Error("SFNode.getFieldDefinitions: node is null.")},getField(e){const t=this[Si].getValue();if(t)return t.getField(e);throw new Error("SFNode is disposed.")},addFieldCallback(e,t,i){const n=this[Si];switch(arguments.length){case 2:return ce.prototype.addFieldCallback.apply(n,arguments);case 3:{const r=n.getValue();if(r)return r.getField(e).addFieldCallback(t,i);throw new Error("SFNode.addFieldCallback: node is null.")}}},removeFieldCallback(e,t){const i=this[Si];switch(arguments.length){case 1:return ce.prototype.removeFieldCallback.apply(i,arguments);case 2:{const n=i.getValue();if(n)return n.getField(e).removeFieldCallback(t);throw new Error("SFNode.removeFieldCallback: node is null.")}}},getNodeUserData(e){const t=this[Si].getValue();if(t)return t.getUserData(e);throw new Error("SFNode.getNodeUserData: node is null.")},setNodeUserData(e,t){const i=this[Si].getValue();if(i)return i.setUserData(e,t);throw new Error("SFNode.setNodeUserData: node is null.")},removeNodeUserData(e){const t=this[Si].getValue();if(t)return t.removeUserData(e);throw new Error("SFNode.removeNodeUserData: node is null.")},valueOf(){const e=this[Si].getValue();return e?bi.get(e):null},toStream(e){const t=this[Si].getValue();t?t.toStream(e):e.string+="NULL"},toVRMLStream(e){const t=this[Si].getValue();t?t.toVRMLStream(e):e.string+="NULL"},toXMLStream(e){const t=this[Si].getValue();t?t.toXMLStream(e):e.string+="\x3c!-- NULL --\x3e"},toJSONStream(e){this.toJSONStreamValue(e)},toJSONStreamValue(e){const t=this[Si].getValue();t?t.toJSONStream(e):e.string+="null"},dispose(){const e=this[Si];e.set(null),e.processInterests(),ce.prototype.dispose.call(e)}});for(const e of Object.keys(Oi.prototype))Object.defineProperty(Oi.prototype,e,{enumerable:!1});Object.defineProperties(Oi,{typeName:{value:"SFNode",enumerable:!0}});const Ei=Oi;i.add("SFNode","x_ite/Fields/SFNode",Ei);const Ci=Ei,Ni=jt.SFVec3d,Ii=jt.SFVec3f,Fi=Bt.SFMatrix3d,Mi=Bt.SFMatrix3f;function Di(e,t,i,n){switch(arguments.length){case 0:ce.call(this,new ui);break;case 1:if(arguments[0]instanceof Fi||arguments[0]instanceof Mi){ce.call(this,(new ui).setMatrix(arguments[0].getValue()));break}ce.call(this,arguments[0]);break;case 2:if(arguments[1]instanceof Ni||arguments[1]instanceof Ii){ce.call(this,new ui(arguments[0].getValue(),arguments[1].getValue()));break}ce.call(this,new ui(arguments[0].getValue(),+arguments[1]));break;case 4:ce.call(this,new ui(+e,+t,+i,+n));break;default:throw new Error("Invalid arguments.")}}Object.assign(Object.setPrototypeOf(Di.prototype,ce.prototype),{*[Symbol.iterator](){yield*this.getValue()},copy(){return new Di(this.getValue().copy())},equals(e){return this.getValue().equals(e.getValue())},isDefaultValue(){return this.getValue().equals(ui.Identity)},set(e){this.getValue().assign(e)},setAxis(e){this.getValue().setAxis(e.getValue()),this.addEvent()},getAxis(){return new Ii(this.getValue().getAxis())},setMatrix(e){this.getValue().setMatrix(e.getValue()),this.addEvent()},getMatrix(){return new Mi(this.getValue().getMatrix())},inverse(){return new Di(this.getValue().copy().inverse())},multiply(e){return new Di(this.getValue().copy().multRight(e.getValue()))},multVec(e){return new e.constructor(this.getValue().multVecRot(e.getValue().copy()))},slerp(e,t){return new Di(this.getValue().copy().slerp(e.getValue(),t))},toStream(e){const{x:t,y:i,z:n,angle:r}=this.getValue();e.string+=e.DoubleFormat(t),e.string+=e.Space(),e.string+=e.DoubleFormat(i),e.string+=e.Space(),e.string+=e.DoubleFormat(n),e.string+=e.Space(),e.string+=e.DoubleFormat(e.ToUnit("angle",r))},toVRMLStream(e){this.toStream(e)},toXMLStream(e){this.toStream(e)},toJSONStream(e){e.string+="[",e.string+=e.TidySpace(),this.toJSONStreamValue(e),e.string+=e.TidySpace(),e.string+="]"},toJSONStreamValue(e){const{x:t,y:i,z:n,angle:r}=this.getValue();e.string+=e.JSONNumber(e.DoubleFormat(t)),e.string+=",",e.string+=e.TidySpace(),e.string+=e.JSONNumber(e.DoubleFormat(i)),e.string+=",",e.string+=e.TidySpace(),e.string+=e.JSONNumber(e.DoubleFormat(n)),e.string+=",",e.string+=e.TidySpace(),e.string+=e.JSONNumber(e.DoubleFormat(e.ToUnit("angle",r)))}});for(const e of Object.keys(Di.prototype))Object.defineProperty(Di.prototype,e,{enumerable:!1});const Ri={get(){return this.getValue().x},set(e){this.getValue().x=+e,this.addEvent()}},Pi={get(){return this.getValue().y},set(e){this.getValue().y=+e,this.addEvent()}},Ai={get(){return this.getValue().z},set(e){this.getValue().z=+e,this.addEvent()}},Vi={get(){return this.getValue().angle},set(e){this.getValue().angle=+e,this.addEvent()}};Object.defineProperties(Di.prototype,{0:Ri,1:Pi,2:Ai,3:Vi,x:Object.assign({enumerable:!0},Ri),y:Object.assign({enumerable:!0},Pi),z:Object.assign({enumerable:!0},Ai),angle:Object.assign({enumerable:!0},Vi)}),Object.defineProperties(Di,{typeName:{value:"SFRotation",enumerable:!0}});const Li=Di;i.add("SFRotation","x_ite/Fields/SFRotation",Li);const Bi=Li;function Ui(e){ce.call(this,arguments.length?String(e):"")}Object.assign(Object.setPrototypeOf(Ui.prototype,ce.prototype),{*[Symbol.iterator](){yield*this.getValue()},copy(){return new Ui(this.getValue())},isDefaultValue(){return""===this.getValue()},set(e){ce.prototype.set.call(this,String(e))},valueOf:ce.prototype.getValue,toStream(e){e.string+='"',e.string+=Ui.escape(this.getValue()),e.string+='"'},toVRMLStream(e){this.toStream(e)},toXMLStream(e,t=!1){e.string+=t?e.XMLEncodeSourceText(this.getValue()):e.XMLEncode(this.getValue())},toJSONStream(e){this.toJSONStreamValue(e)},toJSONStreamValue(e){e.string+='"',e.string+=e.JSONEncode(this.getValue()),e.string+='"'}});for(const e of Object.keys(Ui.prototype))Object.defineProperty(Ui.prototype,e,{enumerable:!1});Object.defineProperty(Ui.prototype,"length",{get(){return this.getValue().length}}),Object.defineProperties(Ui,{typeName:{value:"SFString",enumerable:!0}}),Object.assign(Ui,{unescape:e=>e.replace(/\\([\\"])/g,"$1"),escape:e=>e.replace(/([\\"])/g,"\\$1")});const Xi=Ui;i.add("SFString","x_ite/Fields/SFString",Xi);const ji=Xi;function ki(e){ce.call(this,arguments.length?+e:0)}Object.assign(Object.setPrototypeOf(ki.prototype,ce.prototype),{copy(){return new ki(this.getValue())},isDefaultValue(){return 0===this.getValue()},set(e){ce.prototype.set.call(this,+e)},valueOf:ce.prototype.getValue,toStream(e){e.string+=this.getValue()},toVRMLStream(e){this.toStream(e)},toXMLStream(e){this.toStream(e)},toJSONStream(e){this.toJSONStreamValue(e)},toJSONStreamValue(e){e.string+=e.JSONNumber(e.DoubleFormat(this.getValue()))}});for(const e of Object.keys(ki.prototype))Object.defineProperty(ki.prototype,e,{enumerable:!1});Object.defineProperties(ki,{typeName:{value:"SFTime",enumerable:!0}});const zi=ki;i.add("SFTime","x_ite/Fields/SFTime",zi);const Gi=zi;function Hi(e,t){function i(e,t,i,n){switch(arguments.length){case 0:ce.call(this,new Gt(0,0,0,0));break;case 1:ce.call(this,arguments[0]);break;case 4:ce.call(this,new Gt(+e,+t,+i,+n));break;default:throw new Error("Invalid arguments.")}}gt(i,e,Gt,t);for(const e of Object.keys(i.prototype))Object.defineProperty(i.prototype,e,{enumerable:!1});const n={get(){return this.getValue().x},set(e){this.getValue().x=+e,this.addEvent()}},r={get(){return this.getValue().y},set(e){this.getValue().y=+e,this.addEvent()}},s={get(){return this.getValue().z},set(e){this.getValue().z=+e,this.addEvent()}},o={get(){return this.getValue().w},set(e){this.getValue().w=+e,this.addEvent()}};return Object.defineProperties(i.prototype,{0:n,1:r,2:s,3:o,x:Object.assign({enumerable:!0},n),y:Object.assign({enumerable:!0},r),z:Object.assign({enumerable:!0},s),w:Object.assign({enumerable:!0},o)}),i}const qi={SFVec4d:Hi("SFVec4d",!0),SFVec4f:Hi("SFVec4f",!1)};i.add("SFVec4","x_ite/Fields/SFVec4",qi);const Yi=qi;function Wi(e){ce.call(this,e)}Object.assign(Object.setPrototypeOf(Wi.prototype,ce.prototype),{at:Array.prototype.at,entries:Array.prototype.entries,every:Array.prototype.every,fill:Array.prototype.fill,filter(){const e=new this.constructor;for(const t of Array.prototype.filter.call(this,...arguments))e.push(t);return e},find:Array.prototype.find,findIndex:Array.prototype.findIndex,findLast:Array.prototype.findLast,findLastIndex:Array.prototype.findLastIndex,forEach:Array.prototype.forEach,includes:Array.prototype.includes,indexOf:Array.prototype.indexOf,join:Array.prototype.join,keys:Array.prototype.keys,lastIndexOf:Array.prototype.lastIndexOf,map(){const e=new this.constructor;for(const t of Array.prototype.map.call(this,...arguments))e.push(t);return e},reduce:Array.prototype.reduce,reduceRight:Array.prototype.reduceRight,reverse:Array.prototype.reverse,slice(){const e=new this.constructor;for(const t of Array.prototype.slice.call(this,...arguments))e.push(t);return e},some:Array.prototype.some,sort:Array.prototype.sort,toReversed(){return this.copy().reverse()},toSorted(){return this.copy().sort(...arguments)},toSpliced(){const e=this.copy();return e.splice(...arguments),e},values:Array.prototype.values,with(e,t){const i=this.copy();return i[e]=t,i}});for(const e of Object.keys(Wi.prototype))Object.defineProperty(Wi.prototype,e,{enumerable:!1});const $i=Wi;i.add("X3DArrayField","x_ite/Base/X3DArrayField",$i);const Ji=$i,Ki=Symbol(),Zi=Symbol(),Qi=Symbol(),en=Symbol(),tn={get(e,t){const i=e[t];if(void 0!==i)return i;if("string"==typeof t){const i=e.getValue(),n=+t;return Number.isInteger(n)?(n>=i.length&&e.resize(n+1),i[n].valueOf()):e[t]}},set(e,t,i){if(t in e)return e[t]=i,!0;const n=e.getValue(),r=+t;return r>=n.length&&e.resize(r+1),n[r].setValue(i),!0},has:(e,t)=>Number.isInteger(+t)?t<e.getValue().length:t in e,ownKeys:e=>Object.keys(e.getValue()),getOwnPropertyDescriptor(e,t){if("string"!=typeof t)return;const i=+t;return Number.isInteger(i)&&i<e.getValue().length?Object.getOwnPropertyDescriptor(e.getValue(),t):void 0}};function nn(e){const t=new Proxy(this,tn);Ji.call(this,[]),this[Ki]=this,this[Zi]=t;for(const t of e)this.push(t);return t}Object.assign(Object.setPrototypeOf(nn.prototype,Ji.prototype),{[Ki]:null,[Zi]:null,*[Symbol.iterator](){const e=this[Ki].getValue();for(const t of e)yield t.valueOf()},getTarget(){return this[Ki]},copy(){const e=this[Ki],t=e.create();return t.assign(e),t.setModificationTime(0),t},equals(e){const t=this[Ki].getValue(),i=e.getValue(),n=t.length;if(t===i)return!0;if(n!==i.length)return!1;for(let e=0;e<n;++e)if(!t[e].equals(i[e]))return!1;return!0},isDefaultValue(){return 0===this.length},set(e){const t=this[Ki],i=t.getValue(),n=e.length;t.resize(n,void 0,!0);for(let t=0;t<n;++t)i[t].set(e[t]instanceof ce?e[t].getValue():e[t])},setValue(e){const t=this[Ki];t.set(e instanceof nn?e.getValue():e),t.addEvent()},unshift(e){const t=this[Ki],i=t.getValue();for(let e=arguments.length-1;e>=0;--e){const n=new(t.getSingleType());n.setValue(arguments[e]),t.addChildObject(n),i.unshift(n)}return t.addEvent(),i.length},shift(){const e=this[Ki],t=e.getValue();if(t.length){const i=t.shift(),n=i.valueOf();return e.removeChildObject(i),e.addEvent(),n}},push(e){const t=this[Ki],i=t.getValue();for(const e of arguments){const n=new(t.getSingleType());n.setValue(e),t.addChildObject(n),i.push(n)}return t.addEvent(),i.length},pop(){const e=this[Ki],t=e.getValue();if(t.length){const i=t.pop(),n=i.valueOf();return e.removeChildObject(i),e.addEvent(),n}},splice(e,t,...i){const n=this[Ki],r=n.getValue().length;if(0===arguments.length)return new n.constructor;arguments.length<2&&(t=r);const s=n[en](e,t);return i.length&&n[Qi](e,i),s},[Qi](e,t){const i=this[Ki],n=[];for(const e of t){const t=new(i.getSingleType());t.setValue(e),i.addChildObject(t),n.push(t)}i.getValue().splice(e,0,...n),i.addEvent()},[en](e,t){const i=this[Ki],n=i.getValue().splice(e,t),r=new i.constructor;for(const e of n)r.push(e),i.removeChildObject(e);return i.addEvent(),r},resize(e,t,i){const n=this[Ki],r=n.getValue(),s=r.length;if(e<s){for(let t=e;t<s;++t)n.removeChildObject(r[t]);r.length=e,i||n.addEvent()}else if(e>s){for(let i=s;i<e;++i){const e=new(n.getSingleType());void 0!==t&&e.setValue(t),n.addChildObject(e),r.push(e)}i||n.addEvent()}},addChildObject(e){e.addParent(this[Zi])},removeChildObject(e){e.removeParent(this[Zi]),e.dispose()},reverse(){const e=this[Ki];return e.getValue().reverse(),e.addEvent(),e[Zi]},sort(e){const t=this[Ki];return Array.prototype.sort.call(this,e),t.addEvent(),t[Zi]},toStream(e){const t=this[Ki],i=t.getValue();switch(i.length){case 0:e.string+="[",e.string+=e.TidySpace(),e.string+="]";break;case 1:e.PushUnitCategory(t.getUnit()),i[0].toStream(e),e.PopUnitCategory();break;default:e.PushUnitCategory(t.getUnit()),e.string+="[",e.string+=e.ListStart(),e.IncIndent();for(let t=0,n=i.length-1;t<n;++t)e.string+=e.ListIndent(),i[t].toStream(e),e.string+=e.Comma(),e.string+=e.ListBreak();e.string+=e.ListIndent(),i.at(-1).toStream(e),e.string+=e.ListEnd(),e.DecIndent(),e.string+=e.ListIndent(),e.string+="]",e.PopUnitCategory()}},toVRMLStream(e){this.toStream(e)},toXMLStream(e){const t=this[Ki];if(t.length){const i=t.getValue();e.PushUnitCategory(t.getUnit());for(let t=0,n=i.length-1;t<n;++t)i[t].toXMLStream(e),e.string+=e.Comma(),e.string+=e.TidySpace();i.at(-1).toXMLStream(e),e.PopUnitCategory()}},toJSONStream(e){const t=this[Ki],i=t.length;if(i){const n=this.getValue();e.PushUnitCategory(t.getUnit()),e.string+="[",e.string+=e.ListBreak(),e.string+=e.IncIndent();for(let t=0,r=i-1;t<r;++t)e.string+=e.ListIndent(),n[t].toJSONStreamValue(e),e.string+=",",e.string+=e.ListBreak();e.string+=e.ListIndent(),n.at(-1).toJSONStreamValue(e),e.string+=e.ListBreak(),e.string+=e.DecIndent(),e.string+=e.ListIndent(),e.string+="]",e.PopUnitCategory()}else e.string+="[",e.string+=e.TidySpace(),e.string+="]"}});for(const e of Object.keys(nn.prototype))Object.defineProperty(nn.prototype,e,{enumerable:!1});Object.defineProperty(nn.prototype,"length",{get(){return this[Ki].getValue().length},set(e){this[Ki].resize(e)}});const rn=nn;i.add("X3DObjectArrayField","x_ite/Base/X3DObjectArrayField",rn);const sn=rn,on=Symbol(),an=Symbol(),ln=Symbol(),un=Symbol(),hn=Symbol(),dn=Symbol(),cn=Symbol(),pn=Symbol(),gn={get(e,t){const i=e[t];if(void 0!==i)return i;if("string"==typeof t){const i=+t;if(Number.isInteger(i)){const t=e.getComponents(),n=e.getValueType();let r=e.getValue();return i>=e[hn]&&(r=e.resize(i+1)),1===t?n(r[i]):e[ln][i]??(e[ln][i]=mn(e,i,t,n))}return e[t]}},set(e,t,i){if(t in e)return e[t]=i,!0;const n=e.getComponents();let r=+t,s=e.getValue();if(r>=e[hn]&&(s=e.resize(r+1)),1===n){const t=e.getValueType();s[r]=t(i)}else{r*=n;for(let e=0;e<n;++e,++r)s[r]=i[e]}return e.addEvent(),!0},has:(e,t)=>Number.isInteger(+t)?t<e[hn]:t in e,ownKeys(e){const t=[];for(let i=0,n=e[hn];i<n;++i)t.push(String(i));return t},getOwnPropertyDescriptor(e,t){if("string"!=typeof t)return;const i=+t;return Number.isInteger(i)&&i<e[hn]?Object.getOwnPropertyDescriptor(e.getValue(),t):void 0}};function fn(e){const t=new Proxy(this,gn);Ji.call(this,new(this.getArrayType())(16)),this[on]=this,this[an]=t,this.getComponents()>1&&(this[ln]=[],this[un]=[]);for(const t of e)this.push(t);return t}Object.assign(Object.setPrototypeOf(fn.prototype,Ji.prototype),{[on]:null,[un]:null,[hn]:0,*[Symbol.iterator](){const e=this[on],t=e.getValue(),i=e.getComponents(),n=e.getValueType(),r=e[hn];if(1===i)for(let e=0;e<r;++e)yield n(t[e]);else{const t=e[ln];for(let s=0;s<r;++s)yield t[s]??(t[s]=mn(e,s,i,n))}},getTarget(){return this[on]},copy(){const e=this[on],t=e.getValue(),i=e.create(),n=new(e.getArrayType())(t);return i[hn]=e[hn],Ji.prototype.set.call(i,n),i.setModificationTime(0),i},equals(e){const t=this[on],i=e[on],n=t[hn];if(t===i)return!0;if(n!==i[hn])return!1;const r=t.getValue(),s=i.getValue();for(let e=0,i=n*t.getComponents();e<i;++e)if(r[e]!==s[e])return!1;return!0},assign(e){const t=this[on];t.set(e.getValue(),e.length),t.addEvent()},set(e,t){const i=this[on],n=i.getComponents(),r=i[hn];let s=i.getValue(),o=void 0!==t?t*n:e.length;const a=o%n;a&&(o-=a,console.warn(`Array length must be multiple of components size, which is ${n}.`)),o/=n,s.length<e.length?(s=i[pn](e.length),s.set(e),a&&s.fill(0,o*n,o*n+a)):(s.set(e),o<r&&s.fill(0,o*n,r*n)),i[hn]=o},isDefaultValue(){return 0===this[hn]},setValue(e){const t=this[on];e instanceof t.constructor?t.assign(e):(t.set(e),t.addEvent())},unshift(e){const t=this[on],i=t.getComponents(),n=t[hn],r=arguments.length,s=t[pn]((n+r)*i);if(s.copyWithin(r*i,0,n*i),1===i){const e=t.getValueType();for(let t=0;t<r;++t)s[t]=e(arguments[t])}else for(let e=0,t=0;t<r;++t){const n=arguments[t];for(let t=0;t<i;++t,++e)s[e]=n[t]}return t[hn]+=r,t.addEvent(),t[hn]},shift(){const e=this[on],t=e[hn];if(t){const n=e.getValue(),r=e.getComponents(),s=e.getValueType(),o=t-1;if(1===r)var i=s(n[0]);else{const t=e[un];for(let e=0;e<r;++e)t[e]=n[e];i=new s(...t)}return n.copyWithin(0,r,t*r),n.fill(0,r*o,t*r),e[hn]=o,e.addEvent(),i}},push(e){const t=this[on],i=t.getComponents(),n=t[hn],r=arguments.length,s=t[pn]((n+r)*i);if(1===i){const e=t.getValueType();for(let t=0,i=n;t<r;++t,++i)s[i]=e(arguments[t])}else for(let e=n*i,t=0;t<r;++t){const n=arguments[t];for(let t=0;t<i;++t,++e)s[e]=n[t]}return t[hn]+=r,t.addEvent(),t[hn]},pop(){const e=this[on],t=e[hn];if(t){const n=e.getValue(),r=e.getComponents(),s=e.getValueType(),o=t-1;if(1===r)var i=s(n[t-1]);else{const t=e[un];for(let e=0,i=o*r;e<r;++e,++i)t[e]=n[i];i=new s(...t)}return n.fill(0,o*r,t*r),e[hn]=o,e.addEvent(),i}},splice(e,t,...i){const n=this[on],r=n[hn];if(0===arguments.length)return new n.constructor;e=Math.min(0|e,r),arguments.length<2&&(t=r),e+(t|=0)>r&&(t=r-e);const s=n[cn](e,e+t);return i.length&&n[dn](e,i),n.addEvent(),s},[dn](e,t){const i=this[on],n=i.getComponents(),r=i[hn],s=t.length,o=i[pn]((r+s)*n);if(e*=n,o.copyWithin(e+s*n,e,r*n),1===n){const n=i.getValueType();for(let i=0,r=e;i<s;++i,++r)o[r]=n(t[i])}else for(let i=0,r=e;i<s;++i){const e=t[i];for(let t=0;t<n;++t,++r)o[r]=e[t]}i[hn]+=s},[cn](e,t){const i=this[on],n=i.getValue(),r=i.getComponents(),s=t-e,o=i[hn],a=o-s,l=i[an].slice(e,t);return e*=r,t*=r,n.copyWithin(e,t,o*r),n.fill(0,a*r,o*r),i[hn]=a,r>1&&(i[ln].length=a),i.addEvent(),l},resize(e,t,i){const n=this[on],r=n[hn],s=n.getComponents();let o=n.getValue();if(e<r)o.fill(0,e*s,r*s),s>1&&(n[ln].length=e),i||n.addEvent();else if(e>r){if(o=n[pn](e*s),void 0!==t)if(1===s)o.fill(t,r*s,e*s);else for(let i=r*s,n=e*s;i<n;)for(let e=0;e<s;++e,++i)o[i]=t[e];i||n.addEvent()}return n[hn]=e,o},[pn](e){const t=this[on],i=t.getValue();if(e<i.length)return i;const n=g.nextPowerOfTwo(e),r=new(t.getArrayType())(n);return r.set(i),Ji.prototype.set.call(t,r),r},shrinkToFit(){const e=this[on],t=e.getValue(),i=e[hn]*e.getComponents();if(t.length==i)return t;const n=t.subarray(0,i);return Ji.prototype.set.call(e,n),n},reverse(){const e=this[on],t=e.getValue(),i=e.getComponents(),n=e[hn]*i,r=Math.floor(e[hn]/2)*i;if(1===i)for(let e=0;e<r;++e){const i=n-e-1,r=t[e];t[e]=t[i],t[i]=r}else for(let e=0;e<r;e+=i)for(let r=0;r<i;++r){const s=e+r,o=n-e-1-(i-r-1),a=t[s];t[s]=t[o],t[o]=a}return e.addEvent(),e[an]},sort(e){const t=this[on],i=t.getValue(),n=t.getComponents(),r=t[hn];if(1===n){const n=t.getValueType(),s=e?(t,i)=>e(n(t),n(i)):g.cmp;t.set(i.subarray(0,r).sort(s))}else{const s=Array.from(t[an],(e=>e.copy())).sort(e??((e,t)=>{for(let i=0;i<n;++i){if(e[i]<t[i])return-1;if(t[i]<e[i])return 1}return 0}));for(let e=0;e<r;++e){const t=s[e];for(let r=0,s=e*n;r<n;++r,++s)i[s]=t[r]}}return t.addEvent(),t[an]},toStream(e){const t=this[on],i=t.getValue(),n=t[hn],r=t.getComponents(),s=new(t.getSingleType());switch(n){case 0:e.string+="[",e.string+=e.TidySpace(),e.string+="]";break;case 1:if(e.PushUnitCategory(t.getUnit()),1===r)s.set(i[0]),s.toStream(e);else{for(let e=0,t=0;e<r;++e,++t)s[e]=i[t];s.toStream(e)}e.PopUnitCategory();break;default:if(e.PushUnitCategory(t.getUnit()),e.string+="[",e.string+=e.ListStart(),e.IncIndent(),1===r){for(let t=0,o=n-1;t<o;++t)e.string+=e.ListIndent(),s.set(i[t*r]),s.toStream(e),e.string+=e.Comma(),e.string+=e.ListBreak();e.string+=e.ListIndent(),s.set(i[(n-1)*r]),s.toStream(e)}else{for(let t=0,o=n-1;t<o;++t){e.string+=e.ListIndent();for(let e=0,n=t*r;e<r;++e,++n)s[e]=i[n];s.toStream(e),e.string+=e.Comma(),e.string+=e.ListBreak()}e.string+=e.ListIndent();for(let e=0,t=(n-1)*r;e<r;++e,++t)s[e]=i[t];s.toStream(e)}e.string+=e.ListEnd(),e.DecIndent(),e.string+=e.ListIndent(),e.string+="]",e.PopUnitCategory()}},toVRMLStream(e){this.toStream(e)},toXMLStream(e){const t=this[on],i=t[hn];if(i){const n=t.getValue(),r=t.getComponents(),s=new(t.getSingleType());if(e.PushUnitCategory(t.getUnit()),1===r){for(let t=0,o=i-1;t<o;++t)s.set(n[t*r]),s.toXMLStream(e),e.string+=e.Comma(),e.string+=e.TidySpace();s.set(n[(i-1)*r]),s.toXMLStream(e)}else{for(let t=0,o=i-1;t<o;++t){for(let e=0,i=t*r;e<r;++e,++i)s[e]=n[i];s.toXMLStream(e),e.string+=e.Comma(),e.string+=e.TidySpace()}for(let e=0,t=(i-1)*r;e<r;++e,++t)s[e]=n[t];s.toXMLStream(e)}e.PopUnitCategory()}},toJSONStream(e){const t=this[on],i=t.length;if(i){const n=t.getValue(),r=t.getComponents(),s=new(t.getSingleType());if(e.PushUnitCategory(t.getUnit()),e.string+="[",e.string+=e.ListBreak(),e.string+=e.IncIndent(),1===r){for(let t=0,o=i-1;t<o;++t)e.string+=e.ListIndent(),s.set(n[t*r]),s.toJSONStreamValue(e),e.string+=",",e.string+=e.ListBreak();e.string+=e.ListIndent(),s.set(n[(i-1)*r]),s.toJSONStreamValue(e)}else{for(let t=0,o=i-1;t<o;++t){e.string+=e.ListIndent();for(let e=0,i=t*r;e<r;++e,++i)s[e]=n[i];s.toJSONStreamValue(e),e.string+=",",e.string+=e.ListBreak()}e.string+=e.ListIndent();for(let e=0,t=(i-1)*r;e<r;++e,++t)s[e]=n[t];s.toJSONStreamValue(e)}e.string+=e.ListBreak(),e.string+=e.DecIndent(),e.string+=e.ListIndent(),e.string+="]",e.PopUnitCategory()}else e.string+="[",e.string+=e.TidySpace(),e.string+="]"},dispose(){Ji.prototype.dispose.call(this[on])}});for(const e of Object.keys(fn.prototype))Object.defineProperty(fn.prototype,e,{enumerable:!1});function mn(e,t,i,n){const r=new n,s=r.getValue(),o=t*i;return r.addEvent=xn.bind(e,o,i,s),r.getValue=_n.bind(e,o,i,s),r}function _n(e,t,i){const n=this.getValue();for(let r=0;r<t;++r,++e)i[r]=n[e];return i}function xn(e,t,i){const n=this.getValue();for(let r=0;r<t;++r,++e)n[e]=i[r];this.addEvent()}Object.defineProperty(fn.prototype,"length",{get(){return this[hn]},set(e){this[on].resize(e)}});const yn=fn;i.add("X3DTypedArrayField","x_ite/Base/X3DTypedArrayField",yn);const wn=yn,{SFMatrix3d:bn,SFMatrix3f:Sn}=Bt,{SFMatrix4d:Tn,SFMatrix4f:vn}=_i,{SFVec2d:On,SFVec2f:En}=wt,{SFVec3d:Cn,SFVec3f:Nn}=jt,{SFVec4d:In,SFVec4f:Fn}=Yi;function Mn(...e){return sn.call(this,e)}Object.assign(Object.setPrototypeOf(Mn.prototype,sn.prototype),{getSingleType:()=>Ci,copy(e){if(e){const t=new Mn;for(const i of this.getValue())t.push(i.copy(e));return t.setModificationTime(0),t}return sn.prototype.copy.call(this)},toStream(e){const t=this.getTarget(),i=t.getValue(),n=i.length;switch(n){case 0:e.string+="[",e.string+=e.TidySpace(),e.string+="]";break;case 1:e.PushUnitCategory(t.getUnit()),i[0].toStream(e),e.PopUnitCategory();break;default:e.PushUnitCategory(t.getUnit()),e.string+="[",e.string+=e.TidyBreak(),e.IncIndent();for(let t=0;t<n;++t)e.string+=e.Indent(),i[t].toStream(e),e.string+="}"===e.string.at(-1)?e.TidyBreak():e.Break();e.DecIndent(),e.string+=e.Indent(),e.string+="]",e.PopUnitCategory()}},toVRMLStream(e){const t=this.getTarget().getValue();switch(t.length){case 0:e.string+="[",e.string+=e.TidySpace(),e.string+="]";break;case 1:e.EnterScope(),t[0].toVRMLStream(e),e.LeaveScope();break;default:e.EnterScope(),e.string+="[",e.string+=e.TidyBreak(),e.IncIndent();for(const i of t)e.string+=e.Indent(),i.toVRMLStream(e),e.string+="}"===e.string.at(-1)?e.TidyBreak():e.Break();e.DecIndent(),e.string+=e.Indent(),e.string+="]",e.LeaveScope()}},toXMLStream(e){const t=this.getTarget(),i=t.length;if(i){e.EnterScope();const n=t.getValue();for(let t=0,r=i-1;t<r;++t){const i=n[t].getValue();if(i)i.toXMLStream(e),e.string+=e.TidyBreak();else{e.string+=e.Indent(),e.string+="<",e.string+="NULL";const t=e.ContainerField();t&&(e.string+=e.Space(),e.string+="containerField='",e.string+=e.XMLEncode(t.getName()),e.string+="'"),e.string+=e.closingTags?"></NULL>":"/>"}}const r=n.at(-1).getValue();if(r)r.toXMLStream(e);else{e.string+=e.Indent(),e.string+="<",e.string+="NULL";const t=e.ContainerField();t&&(e.string+=e.Space(),e.string+="containerField='",e.string+=e.XMLEncode(t.getName()),e.string+="'"),e.string+=e.closingTags?"></NULL>":"/>"}e.LeaveScope()}},toJSONStream(e){const t=this.getTarget(),i=t.length;if(i){const n=t.getValue();e.EnterScope(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent();for(let t=0,r=i-1;t<r;++t)e.string+=e.Indent(),n[t]?n[t].toJSONStreamValue(e):e.string+="null",e.string+=",",e.string+=e.TidyBreak();e.string+=e.Indent(),n.at(-1)?n.at(-1).toJSONStreamValue(e):e.string+="null",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]",e.LeaveScope()}else e.string+="[",e.string+=e.TidySpace(),e.string+="]"},dispose(){const e=this.getTarget();e.resize(0,void 0,!1),e.processInterests(),sn.prototype.dispose.call(e)}});for(const e of Object.keys(Mn.prototype))Object.defineProperty(Mn.prototype,e,{enumerable:!1});function Dn(...e){return sn.call(this,e)}Object.defineProperties(Mn,{typeName:{value:"MFNode",enumerable:!0}}),Object.assign(Object.setPrototypeOf(Dn.prototype,sn.prototype),{getSingleType:()=>ji,toXMLStream(e,t=!1){const i=this.getTarget(),n=i.length;if(n){const r=i.getValue();for(let i=0,s=n-1;i<s;++i)e.string+='"',r[i].toXMLStream(e,t),e.string+='"',e.string+=e.Comma(),e.string+=e.TidySpace();e.string+='"',r.at(-1).toXMLStream(e,t),e.string+='"'}}});for(const e of Object.keys(Dn.prototype))Object.defineProperty(Dn.prototype,e,{enumerable:!1});function Rn(...e){return sn.call(this,e)}Object.defineProperties(Dn,{typeName:{value:"MFString",enumerable:!0}}),Object.assign(Object.setPrototypeOf(Rn.prototype,sn.prototype),{getSingleType:()=>Yn});for(const e of Object.keys(Rn.prototype))Object.defineProperty(Rn.prototype,e,{enumerable:!1});function Pn(e,t,i,n,r){function s(...e){return wn.call(this,e)}Object.assign(Object.setPrototypeOf(s.prototype,wn.prototype),{getSingleType:()=>t,getValueType:()=>i,getArrayType:()=>n,getComponents:()=>r});for(const e of Object.keys(s.prototype))Object.defineProperty(s.prototype,e,{enumerable:!1});return Object.defineProperties(s,{typeName:{value:e,enumerable:!0}}),s}Object.defineProperties(Rn,{typeName:{value:"MFImage",enumerable:!0}});const An=e=>e,Vn={MFBool:Pn("MFBool",xe,Boolean,Uint8Array,1),MFColor:Pn("MFColor",Ve,Ve,Float32Array,3),MFColorRGBA:Pn("MFColorRGBA",tt,tt,Float32Array,4),MFDouble:Pn("MFDouble",rt,An,Float64Array,1),MFFloat:Pn("MFFloat",at,An,Float32Array,1),MFImage:Rn,MFInt32:Pn("MFInt32",ht,An,Int32Array,1),MFMatrix3d:Pn("MFMatrix3d",bn,bn,Float64Array,9),MFMatrix3f:Pn("MFMatrix3f",Sn,Sn,Float32Array,9),MFMatrix4d:Pn("MFMatrix4d",Tn,Tn,Float64Array,16),MFMatrix4f:Pn("MFMatrix4f",vn,vn,Float32Array,16),MFNode:Mn,MFRotation:Pn("MFRotation",Bi,Bi,Float64Array,4),MFString:Dn,MFTime:Pn("MFTime",Gi,An,Float64Array,1),MFVec2d:Pn("MFVec2d",On,On,Float64Array,2),MFVec2f:Pn("MFVec2f",En,En,Float32Array,2),MFVec3d:Pn("MFVec3d",Cn,Cn,Float64Array,3),MFVec3f:Pn("MFVec3f",Nn,Nn,Float32Array,3),MFVec4d:Pn("MFVec4d",In,In,Float64Array,4),MFVec4f:Pn("MFVec4f",Fn,Fn,Float32Array,4)};i.add("ArrayFields","x_ite/Fields/ArrayFields",Vn);const Ln=Vn,Bn=Ln.MFInt32;function Un(e,t,i,n){this.width=Math.max(0|e,0),this.height=Math.max(0|t,0),this.comp=g.clamp(0|i,0,4),this.array=new Bn,this.array.setValue(n),this.array.length=this.width*this.height}Object.assign(Un.prototype,{copy(){return new Un(this.width,this.height,this.comp,this.array)},equals(e){return this.width===e.width&&this.height===e.height&&this.comp===e.comp&&this.array.equals(e.array)},assign(e){this.width=e.width,this.height=e.height,this.comp=e.comp,this.array.assign(e.array)},set(e,t,i,n){this.width=0|e,this.height=0|t,this.comp=0|i,this.array.assign(n)},setWidth(e){this.width=Math.max(0|e,0),this.array.length=this.width*this.height},getWidth(){return this.width},setHeight(e){this.height=Math.max(0|e,0),this.array.length=this.width*this.height},getHeight(){return this.height},setComp(e){this.comp=g.clamp(0|e,0,4)},getComp(){return this.comp},setArray(e){this.array.setValue(e),this.array.length=this.width*this.height},getArray(){return this.array}});const Xn=Symbol();function jn(e,t,i,n){switch(arguments.length){case 0:ce.call(this,new Un(0,0,0,new Bn));break;case 1:ce.call(this,arguments[0]);break;case 3:ce.call(this,new Un(e,t,i,new Bn));break;case 4:ce.call(this,new Un(e,t,i,n));break;default:throw new Error("Invalid arguments.")}this.getValue().getArray().addParent(this),this.addInterest(Xn,this)}Object.assign(Object.setPrototypeOf(jn.prototype,ce.prototype),{[Xn](){this.getValue().getArray().length=this.width*this.height},*[Symbol.iterator](){yield this.width,yield this.height,yield this.comp,yield this.array},copy(){return new jn(this.getValue().copy())},equals(e){return this.getValue().equals(e.getValue())},isDefaultValue(){return 0===this.width&&0===this.height&&0===this.comp},set(e){this.getValue().assign(e)},toStream(e){const t=this.width,i=this.height,n=new Uint32Array(this.array.getValue().buffer);e.string+=t,e.string+=e.Space(),e.string+=i,e.string+=e.Space(),e.string+=this.comp,e.string+=e.AttribBreak(),e.IncIndent();for(let r=0;r<i;++r){e.string+=e.ListIndent();const s=r*t;for(let i=0;i<t;++i)e.string+="0x",e.string+=n[i+s].toString(16),i!==t-1&&(e.string+=e.Space());r!==i-1&&(e.string+=e.AttribBreak())}e.DecIndent()},toVRMLStream(e){this.toStream(e)},toXMLStream(e){this.toStream(e)},toJSONStream(e){e.string+="[",e.string+=e.ListBreak(),e.string+=e.IncIndent(),e.string+=e.ListIndent(),this.toJSONStreamValue(e),e.string+=e.DecIndent(),e.string+=e.ListBreak(),e.string+=e.ListIndent(),e.string+="]"},toJSONStreamValue(e){const t=this.width,i=this.height,n=new Uint32Array(this.array.getValue().buffer),r=this.array.length;if(e.string+=t,e.string+=",",e.string+=e.TidySpace(),e.string+=i,e.string+=",",e.string+=e.TidySpace(),e.string+=this.comp,e.string+=",",t&&i){e.string+=e.ListBreak(),e.string+=e.IncIndent();for(let s=0;s<i;++s){e.string+=e.ListIndent();const o=s*t;for(let i=0;i<t;++i)e.string+=n[i+o],i+o!==r-1&&(e.string+=","),i!==t-1&&(e.string+=e.TidySpace());s!==i-1&&(e.string+=e.ListBreak())}e.string+=e.DecIndent()}}});for(const e of Object.keys(jn.prototype))Object.defineProperty(jn.prototype,e,{enumerable:!1});const kn={get(){return this.getValue().getWidth()},set(e){this.getValue().setWidth(e),this.addEvent()}},zn={get(){return this.getValue().getHeight()},set(e){this.getValue().setHeight(e),this.addEvent()}},Gn={get(){return this.getValue().getComp()},set(e){this.getValue().setComp(e),this.addEvent()}},Hn={get(){return this.getValue().getArray()},set(e){this.getValue().setArray(e),this.addEvent()}};Object.defineProperties(jn.prototype,{x:kn,y:zn,width:Object.assign({enumerable:!0},kn),height:Object.assign({enumerable:!0},zn),comp:Object.assign({enumerable:!0},Gn),array:Object.assign({enumerable:!0},Hn)}),Object.defineProperties(jn,{typeName:{value:"SFImage",enumerable:!0}});const qn=jn;i.add("SFImage","x_ite/Fields/SFImage",qn);const Yn=qn,Wn={SFBool:xe,SFColor:Ve,SFColorRGBA:tt,SFDouble:rt,SFFloat:at,SFImage:Yn,SFInt32:ht,...Bt,..._i,SFNode:Ci,SFRotation:Bi,SFString:ji,SFTime:Gi,...wt,...jt,...Yi,...Ln};i.add("Fields","x_ite/Fields",Wn);const $n=Wn,Jn=new Map,Kn=new Map,Zn={addConcreteNode({typeName:e,fieldDefinitions:t}){if(!Jn.has(e)){this.addNodeTypeName(e);for(const{name:e,accessType:i}of t)i&d.initializeOnly&&this.addFieldName(e)}},addNodeTypeName(e){Jn.set(e,e),Jn.set(e.toUpperCase(),e)},getNodeTypeName:e=>Jn.get(e),addFieldName(e){Kn.set(e,e),Kn.set(e.toLowerCase(),e)},getFieldName:e=>Kn.get(e)};i.add("HTMLSupport","x_ite/Parser/HTMLSupport",Zn);const Qn=Zn,er=Symbol(),tr=Symbol(),ir=Symbol(),nr=Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions"),rr=Symbol(),sr=Symbol(),or=Symbol(),ar=Symbol(),lr=Symbol(),ur=Symbol();function hr(e,t=e.getBrowser()){if(!this[tr]){V.call(this),this[er]=t,this[tr]=e,this[ir]=[d.X3DBaseNode],this[nr]=this.constructor.fieldDefinitions??this[nr],this[rr]=new fe,this[sr]=new fe,this[or]=[],this[lr]=!0,this[ar]=!1,this.canUserDefinedFields()&&(this[nr]=new Z(this[nr])),this.addChildObjects(d.outputOnly,"name_changed",new $n.SFTime,d.outputOnly,"typeName_changed",new $n.SFTime,d.outputOnly,"parents_changed",new $n.SFTime);for(const e of this[nr])this.addPredefinedField(e)}}Object.assign(Object.setPrototypeOf(hr.prototype,V.prototype),{[nr]:new Z([]),setName(e){V.prototype.setName.call(this,e),this._name_changed=this[er].getCurrentTime()},getBrowser(){return this[er]},getMainScene(){let e=this[tr].getScene();for(;!e.isMainScene();)e=e.getScene();return e},getScene(){let e=this[tr];for(;!e.isScene();)e=e.getExecutionContext();return e},getExecutionContext(){return this[tr]},setExecutionContext(e){this[tr]=e},addType(e){this[ir].push(e)},getType(){return this[ir]},create(e=this[tr]){return new this.constructor(e)},copy(e){const t=this.create(e);for(const e of this[rr])t.getPredefinedFields().get(e.getName()).assign(e);if(this.canUserDefinedFields())for(const e of this[sr])t.addUserDefinedField(e.getAccessType(),e.getName(),e.copy());return t.setup(),t},setup(){Object.freeze(this[ir]),this[nr].addParent(this),this[rr].addParent(this),this[sr].addParent(this);for(const e of this[or])e.setTainted(!1);for(const e of this[rr])e.setTainted(!1);for(const e of this[sr])e.setTainted(!1);this.initialize(),this[ar]=!0},initialize(){},isInitialized(){return this[ar]},getInnerNode(){return this},isLive(){return this[lr]},setLive(e){this[lr]=e.valueOf(),this[ur]()},getLive:(()=>{function e(){return this._live}return function(){return Object.defineProperty(this,"getLive",{value:e}),this.addChildObjects(d.outputOnly,"live",new $n.SFBool(this.getLiveState())),this._live.removeParent(this),this.getOuterNode?.()?this.getOuterNode().getLive().addInterest(ur,this):this[tr]!==this&&this[tr].getLive().addInterest(ur,this),this._live}})(),getLiveState(){return this.getOuterNode?.()?this[lr]&&this.getOuterNode().getLive().getValue():this!==this[tr]?this[lr]&&this[tr].getLive().getValue():this[lr]},[ur](){const e=this._live;if(e)if(this.getLiveState()){if(e.getValue())return;e.set(!0),e.processEvent()}else e.getValue()&&(e.set(!1),e.processEvent())},addChildObjects(){for(let e=0,t=arguments.length;e<t;e+=3)this.addChildObject(arguments[e],arguments[e+1],arguments[e+2])},addChildObject(e,t,i){this[or].push(i),i.setPrivate(!0),i.setTainted(!0),i.addParent(this),i.setName(t),i.setAccessType(e),Object.defineProperty(this,`_${t}`,{get:()=>i,set(e){i.setValue(e)}})},getFieldDefinitions(){return this[nr]},getField(e){const t=dr(this[sr],e)??dr(this[rr],e);if(t)return t;throw new Error(`Unknown field '${e}' in node class ${this.getTypeName()}.`)},getFields(){return[...this[rr],...this[sr]]},addPredefinedField({accessType:e,name:t,value:i}){const n=i.copy();n.setTainted(!this[ar]),n.addParent(this),n.setName(t),n.setAccessType(e),this[rr].add(t,n),Object.defineProperty(this,`_${t}`,{get:()=>n,set(e){n.setValue(e)},configurable:!0})},addAlias(e,t){this[rr].alias(e,t),t.isInitializable()&&Qn.addFieldName(e)},removePredefinedField(e){const t=this[rr].get(e);t&&(t.removeParent(this),this[rr].remove(e),delete this[`_${t.getName()}`])},getPredefinedField(e){const t=dr(this[rr],e);if(t)return t;throw new Error(`Unknown predefined field '${e}' in node class ${this.getTypeName()}.`)},getPredefinedFields(){return this[rr]},canUserDefinedFields:()=>!1,addUserDefinedField(e,t,i){if(!this.canUserDefinedFields())throw new Error("Couldn't add user-defined field, node does not support this.");this[sr].has(t)&&this.removeUserDefinedField(t),i.setTainted(!this[ar]),i.addParent(this),i.setName(t),i.setAccessType(e),this[nr].remove(t),this[nr].add(t,new k(e,t,i)),this[sr].add(t,i)},removeUserDefinedField(e){const t=this[sr].get(e);t&&(t.removeParent(this),this[nr].remove(e),this[sr].remove(e))},getUserDefinedField(e){const t=dr(this[sr],e);if(t)return t;throw new Error(`Unknown user-defined field '${e}' in node class ${this.getTypeName()}.`)},getUserDefinedFields(){return this[sr]},getChangedFields(e){const t=[];if(e)for(const e of this[sr])t.push(e);for(const i of this[rr])if(e&&(i.getInputRoutes().size||i.getOutputRoutes().size))t.push(i);else{if(0===i.getReferences().size){if(!i.isInitializable())continue;if(this.isDefaultValue(i))continue}t.push(i)}return t},isDefaultValue(e){if((this[sr].get(e.getName())??this[rr].get(e.getName()))===e)var t=this[nr].get(e.getName());else if(this.constructor.fieldDefinitions)t=this.constructor.fieldDefinitions.get(e.getName());return t?t.value!==e&&t.value.equals(e):!e.getModificationTime()},hasRoutes(){for(const e of this[rr])if(e.getInputRoutes().size||e.getOutputRoutes().size)return!0;for(const e of this[sr])if(e.getInputRoutes().size||e.getOutputRoutes().size)return!0;for(const e of this[tr].getImportedNodes())if(e.hasRoutes(this))return!0;return!1},getExtendedEventHandling:()=>!0,addEvent(e){e.isTainted()||(e.setTainted(!0),this.addEventObject(e,U.create(e)))},addEventObject(e,t){const i=this[er];i.addTaintedField(e,t),i.addBrowserEvent(),this.isTainted()||(e.isInput()||this.getExtendedEventHandling()&&e.isInitializable())&&this.addNodeEvent()},addNodeEvent(){if(this.isTainted())return;const e=this[er];this.setTainted(!0),e.addTaintedNode(this),e.addBrowserEvent()},parentsChanged(){const e=this[er].getCurrentTime();this[tr]._sceneGraph_changed=e,this._parents_changed=e},dispose(){this.setLive(!1);for(const e of this[or])e.dispose();for(const e of this[rr])e.dispose();for(const e of this[sr])e.dispose();V.prototype.dispose.call(this)}});const dr=(()=>{const e=/^set_(.*?)$/,t=/^(.*?)_changed$/;return function(i,n){const r=i.get(n);if(r)return r;const s=n.match(e);if(s){const e=i.get(s[1]);if(e?.getAccessType()===d.inputOutput)return e}else{const e=n.match(t);if(e){const t=i.get(e[1]);if(t?.getAccessType()===d.inputOutput)return t}}}})();for(const e of Object.keys(hr.prototype))Object.defineProperty(hr.prototype,e,{enumerable:!1});Object.defineProperties(hr.prototype,{name_changed:{get(){return this._name_changed},enumerable:!1},typeName_changed:{get(){return this._typeName_changed},enumerable:!1},parents_changed:{get(){return this._parents_changed},enumerable:!1}});const cr=hr;i.add("X3DBaseNode","x_ite/Base/X3DBaseNode",cr);const pr=cr;var gr=n(328);const fr={elements(e,t){e.length&&(console.warn("Use of <X3DCanvas> element is depreciated, please use <x3d-canvas> element instead. See https://create3000.github.io/x_ite/#embedding-x_ite-within-a-web-page."),gr.map(e,(e=>new t(e))))},browser(e){const t=e.getElement();"X3DCANVAS"===t.prop("nodeName").toUpperCase()&&(t.attr("src")?e.attributeChangedCallback("src",void 0,t.attr("src")):t.attr("url")&&e.attributeChangedCallback("url",void 0,t.attr("url")),t.attr("tabindex",t.attr("tabindex")??0))},error(e,t){console.error(t),e.children(".x_ite-private-browser").hide(),e.children(":not(.x_ite-private-browser)").show()}},mr=fr;i.add("Legacy","x_ite/Browser/Legacy",mr);const _r=mr,xr="9.1.6";i.add("BROWSER_VERSION","x_ite/BROWSER_VERSION",xr);const yr=xr;function wr(e){pr.call(this,e),this.addType(d.X3DNode)}Object.assign(Object.setPrototypeOf(wr.prototype,pr.prototype),{getComponentInfo(){return this.constructor.componentInfo},getContainerField(){return this.constructor.containerField},getSpecificationRange(){return this.constructor.specificationRange},copy(e){if(!e||e.getType().includes(d.X3DExecutionContext))return pr.prototype.copy.call(this,e);{const t=e.getBody();if(this.getName().length){const e=t.getNamedNodes().get(this.getName());if(e)return e.getValue()}const i=this.create(t);this.getNeedsName()&&this.getExecutionContext().updateNamedNode(this.getExecutionContext().getUniqueName(),this),this.getName().length&&t.updateNamedNode(this.getName(),i);for(const t of this.getPredefinedFields())try{const n=i.getPredefinedField(t.getName());if(t.hasReferences())for(const i of t.getReferences())try{n.addReference(e.getField(i.getName()))}catch(e){console.error(e)}else if(t.getAccessType()&d.initializeOnly)switch(t.getType()){case d.SFNode:case d.MFNode:n.assign(t.copy(e));break;default:n.assign(t)}n.setModificationTime(t.getModificationTime())}catch(e){console.error(e)}for(const t of this.getUserDefinedFields()){const n=t.copy(e);if(i.addUserDefinedField(t.getAccessType(),t.getName(),n),t.hasReferences())for(const i of t.getReferences())try{n.addReference(e.getField(i.getName()))}catch(t){console.error(`No reference '${i.getName()}' inside execution context ${e.getTypeName()} '${e.getName()}'.`)}n.setModificationTime(t.getModificationTime())}return i.setup(),i}},getDisplayName(){return this.getName().replace(/_\d+$/,"")},getNeedsName(){if(this.getName().length)return!1;if(this.getCloneCount()>1)return!0;if(this.hasRoutes())return!0;const e=this.getExecutionContext();for(const t of e.getImportedNodes())if(t.getInlineNode()===this)return!0;if(e.isScene())for(const t of e.getExportedNodes())if(t.getLocalNode()===this)return!0;return!1},getCloneCount(){return pr.prototype.collectCloneCount.call(this)},collectCloneCount:()=>1,getSourceText:()=>null,traverse(){},toStream(e){e.string+=this.getTypeName()+" { }"},toVRMLStream(e){e.EnterScope();const t=e.Name(this);if(t.length&&e.ExistsNode(this))return e.string+="USE",e.string+=e.Space(),e.string+=t,void e.LeaveScope();t.length&&(e.AddNode(this),e.string+="DEF",e.string+=e.Space(),e.string+=t,e.string+=e.Space()),e.string+=this.getTypeName(),e.string+=e.TidySpace(),e.string+="{";const i=this.getChangedFields(),n=this.getUserDefinedFields();if(this.canUserDefinedFields()&&n.length){let t=0,r=0;for(const i of n)t=Math.max(t,i.getTypeName().length),r=Math.max(r,e.AccessType(i.getAccessType()).length);const s=n.at(-1);e.string+=e.TidyBreak(),e.IncIndent();for(const i of n)this.toVRMLStreamUserDefinedField(e,i,t,r),e.string+=i===s?e.TidyBreak():e.Break();e.DecIndent(),0!==i.length&&(e.string+=e.TidyBreak())}if(0===i.length)n.length?e.string+=e.Indent():e.string+=e.TidySpace();else{const t=i.at(-1);0===n.length&&(e.string+=e.TidyBreak()),e.IncIndent();for(const n of i)this.toVRMLStreamField(e,n),e.string+=n===t?e.TidyBreak():e.Break();e.DecIndent(),e.string+=e.Indent()}e.string+="}",e.LeaveScope()},toVRMLStreamUserDefinedField(e,t,i,n){const r=e.IsSharedNode(this);if(0===t.getReferences().size||!e.ExecutionContext()||r)e.string+=e.Indent(),e.string+=e.AccessType(t.getAccessType()).padEnd(n," "),e.string+=e.Space(),e.string+=t.getTypeName().padEnd(i," "),e.string+=e.Space(),e.string+=t.getName(),t.isInitializable()&&(e.string+=e.Space(),t.toVRMLStream(e));else{let r=0,s=!1;for(const o of t.getReferences())s=s||o.isInitializable(),e.string+=e.Indent(),e.string+=e.AccessType(t.getAccessType()).padEnd(n," "),e.string+=e.Space(),e.string+=t.getTypeName().padEnd(i," "),e.string+=e.Space(),e.string+=t.getName(),e.string+=e.Space(),e.string+="IS",e.string+=e.Space(),e.string+=o.getName(),++r,r!==t.getReferences().size&&(e.string+=e.Break());t.getAccessType()!==d.inputOutput||s||t.isDefaultValue()||(e.string+=e.Break(),e.string+=e.Indent(),e.string+=e.AccessType(t.getAccessType()).padEnd(n," "),e.string+=e.Space(),e.string+=t.getTypeName().padEnd(i," "),e.string+=e.Space(),e.string+=t.getName(),t.isInitializable()&&(e.string+=e.Space(),t.toVRMLStream(e)))}},toVRMLStreamField(e,t){const i=e.IsSharedNode(this);if(0===t.getReferences().size||!e.ExecutionContext()||i)t.isInitializable()&&(e.string+=e.Indent(),e.string+=t.getName(),e.string+=e.Space(),t.toVRMLStream(e));else{let i=0,n=!1;for(const r of t.getReferences())n=n||r.isInitializable(),e.string+=e.Indent(),e.string+=t.getName(),e.string+=e.Space(),e.string+="IS",e.string+=e.Space(),e.string+=r.getName(),++i,i!==t.getReferences().size&&(e.string+=e.Break());t.getAccessType()!==d.inputOutput||n||this.isDefaultValue(t)||(e.string+=e.Break(),e.string+=e.Indent(),e.string+=t.getName(),e.string+=e.Space(),t.toVRMLStream(e))}},toXMLStream(e){const t=e.IsSharedNode(this);e.EnterScope();const i=e.Name(this);if(i.length&&e.ExistsNode(this)){e.string+=e.Indent(),e.string+="<",e.string+=this.getTypeName(),e.html&&"Script"===this.getTypeName()&&(e.string+=e.Space(),e.string+="type='model/x3d+xml'"),e.string+=e.Space(),e.string+="USE='",e.string+=e.XMLEncode(i),e.string+="'";const t=e.ContainerField();return t&&t.getName()!==this.getContainerField()&&(e.string+=e.Space(),e.string+="containerField='",e.string+=e.XMLEncode(t.getName()),e.string+="'"),e.closingTags?(e.string+="></",e.string+=this.getTypeName(),e.string+=">"):e.string+="/>",void e.LeaveScope()}e.string+=e.Indent(),e.string+="<",e.string+=this.getTypeName(),e.html&&"Script"===this.getTypeName()&&(e.string+=e.Space(),e.string+="type='model/x3d+xml'"),i.length&&(e.AddNode(this),e.string+=e.Space(),e.string+="DEF='",e.string+=e.XMLEncode(i),e.string+="'");const n=e.ContainerField();n&&n.getName()!==this.getContainerField()&&(e.string+=e.Space(),e.string+="containerField='",e.string+=e.XMLEncode(n.getName()),e.string+="'");const r=this.getChangedFields(),s=this.getUserDefinedFields(),o=[],a=[];let l=this.getSourceText();(0===l?.length||e.html&&"Script"!==this.getTypeName())&&(l=null),e.IncIndent(),e.IncIndent();for(const i of r){let n=!1;if(e.ExecutionContext()&&i.getAccessType()===d.inputOutput&&0!==i.getReferences().size&&([...i.getReferences()].some((e=>e.isInitializable()))||(n=!this.isDefaultValue(i))),0===i.getReferences().size||!e.ExecutionContext()||t||n){if(n&&o.push(i),i.isInitializable())switch(i.getType()){case d.SFNode:case d.MFNode:a.push(i);break;default:if(i===l)break;e.string+=e.AttribBreak(),e.string+=e.ListIndent(),e.string+=i.getName(),e.string+="='",i.toXMLStream(e,i===this.getSourceText()),e.string+="'"}}else o.push(i)}if(e.DecIndent(),e.DecIndent(),this.canUserDefinedFields()&&s.length||o.length&&!t||a.length||l){if(e.string+=">",e.string+=e.TidyBreak(),e.IncIndent(),this.canUserDefinedFields())for(const i of s){e.string+=e.Indent(),e.string+="<field",e.string+=e.Space(),e.string+="accessType='",e.string+=e.AccessType(i.getAccessType()),e.string+="'",e.string+=e.Space(),e.string+="type='",e.string+=i.getTypeName(),e.string+="'",e.string+=e.Space(),e.string+="name='",e.string+=e.XMLEncode(i.getName()),e.string+="'";let n=!1;if(e.ExecutionContext()&&i.getAccessType()===d.inputOutput&&0!==i.getReferences().size&&([...i.getReferences()].some((e=>e.isInitializable()))||(n=!0)),0===i.getReferences().size||!e.ExecutionContext()||t||n)if(n&&e.ExecutionContext()&&o.push(i),!i.isInitializable()||i.isDefaultValue())e.string+=e.closingTags?"></field>":"/>",e.string+=e.TidyBreak();else switch(i.getType()){case d.SFNode:case d.MFNode:e.PushContainerField(null),e.string+=">",e.string+=e.TidyBreak(),e.IncIndent(),i.toXMLStream(e),e.string+=e.TidyBreak(),e.DecIndent(),e.string+=e.Indent(),e.string+="</field>",e.string+=e.TidyBreak(),e.PopContainerField();break;default:e.string+=e.Space(),e.string+="value='",i.toXMLStream(e),e.string+="'",e.string+=e.closingTags?"></field>":"/>",e.string+=e.TidyBreak()}else e.ExecutionContext()&&o.push(i),e.string+=e.closingTags?"></field>":"/>",e.string+=e.TidyBreak()}if(o.length&&!t){e.string+=e.Indent(),e.string+="<IS>",e.string+=e.TidyBreak(),e.IncIndent();for(const t of o){const i=t.getReferences();for(const n of i)e.string+=e.Indent(),e.string+="<connect",e.string+=e.Space(),e.string+="nodeField='",e.string+=e.XMLEncode(t.getName()),e.string+="'",e.string+=e.Space(),e.string+="protoField='",e.string+=e.XMLEncode(n.getName()),e.string+="'",e.string+=e.closingTags?"></connect>":"/>",e.string+=e.TidyBreak()}e.DecIndent(),e.string+=e.Indent(),e.string+="</IS>",e.string+=e.TidyBreak()}for(const t of a)e.PushContainerField(t),t.toXMLStream(e),e.string+=e.TidyBreak(),e.PopContainerField();if(l)for(const t of l)e.string+="<![CDATA[",e.string+=t,e.string+="]]>",e.string+=e.TidyBreak();e.DecIndent(),e.string+=e.Indent(),e.string+="</",e.string+=this.getTypeName(),e.string+=">"}else e.closingTags?(e.string+="></",e.string+=this.getTypeName(),e.string+=">"):e.string+="/>";e.LeaveScope()},toJSONStream(e){const t=e.IsSharedNode(this);e.EnterScope();const i=e.Name(this);if(i.length&&e.ExistsNode(this))return e.string+="{",e.string+=e.TidySpace(),e.string+='"',e.string+=this.getTypeName(),e.string+='"',e.string+=":",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@USE",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(i),e.string+='"',e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",void e.LeaveScope();e.string+="{",e.string+=e.TidySpace(),e.string+='"',e.string+=this.getTypeName(),e.string+='"',e.string+=":",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),i.length&&(e.AddNode(this),e.string+=e.Indent(),e.string+='"',e.string+="@DEF",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(i),e.string+='"',e.string+=",",e.string+=e.TidyBreak());const n=this.getChangedFields(),r=this.getUserDefinedFields(),s=[];let o=this.getSourceText();if(o&&1!==o.length&&(o=null),n.length){const i=[];for(const r of n){let n=!1;e.ExecutionContext()&&r.getAccessType()===d.inputOutput&&0!==r.getReferences().size&&([...r.getReferences()].some((e=>e.isInitializable()))||(n=!this.isDefaultValue(r))),0===r.getReferences().size||!e.ExecutionContext()||t||n?(n&&s.push(r),r!==o&&i.push(r)):s.push(r)}for(const t of i)if(t.isInitializable()){switch(t.getType()){case d.SFNode:case d.MFNode:e.string+=e.Indent(),e.string+='"',e.string+="-",e.string+=t.getName(),e.string+='"',e.string+=":",e.string+=e.TidySpace(),t.toJSONStream(e);break;default:e.string+=e.Indent(),e.string+='"',e.string+="@",e.string+=t.getName(),e.string+='"',e.string+=":",e.string+=e.TidySpace(),t.toJSONStream(e)}e.string+=",",e.string+=e.TidyBreak()}}if(this.canUserDefinedFields()&&r.length){e.string+=e.Indent(),e.string+='"',e.string+="field",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent();for(const i of r){e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@accessType",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.AccessType(i.getAccessType()),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@type",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=i.getTypeName(),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@name",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(i.getName()),e.string+='"';let n=!1;if(e.ExecutionContext()&&i.getAccessType()===d.inputOutput&&0!==i.getReferences().size&&([...i.getReferences()].some((e=>e.isInitializable()))||(n=!0)),0===i.getReferences().size||!e.ExecutionContext()||t||n)if(n&&e.ExecutionContext()&&s.push(i),!i.isInitializable()||i.isDefaultValue());else switch(e.string+=",",e.string+=e.TidyBreak(),i.getType()){case d.SFNode:e.string+=e.Indent(),e.string+='"',e.string+="-children",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),i.toJSONStream(e),e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]";break;case d.MFNode:e.string+=e.Indent(),e.string+='"',e.string+="-children",e.string+='"',e.string+=":",e.string+=e.TidySpace(),i.toJSONStream(e);break;default:e.string+=e.Indent(),e.string+='"',e.string+="@value",e.string+='"',e.string+=":",e.string+=e.TidySpace(),i.toJSONStream(e)}else e.ExecutionContext()&&s.push(i);e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",i!==r.at(-1)&&(e.string+=","),e.string+=e.TidyBreak()}e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]",e.string+=",",e.string+=e.TidyBreak()}else;if(o){e.string+=e.Indent(),e.string+='"',e.string+="#sourceCode",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent();const t=o[0].split("\n");for(let i=0,n=t.length;i<n;++i)e.string+=e.ListIndent(),e.string+='"',e.string+=e.JSONEncode(t[i]),e.string+='"',i!==n-1&&(e.string+=","),e.string+=e.TidyBreak();e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]",e.string+=",",e.string+=e.TidyBreak()}if(s.length&&!t){e.string+=e.Indent(),e.string+='"',e.string+="IS",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="connect",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent();for(const t of s){const i=[...t.getReferences()];for(const n of i)e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@nodeField",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(t.getName()),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@protoField",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(n.getName()),e.string+='"',e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",t===s.at(-1)&&n===i.at(-1)||(e.string+=","),e.string+=e.TidyBreak()}e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak()}e.JSONRemoveComma(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.LeaveScope()},dispose(){const e=this.getExecutionContext();if(this.getName()&&e.removeNamedNode(this.getName()),e.isScene()){if(!e.isMainScene()){const t=e.getExecutionContext();for(const e of[...t.getImportedNodes()])try{e.getExportedNode()===this&&t.removeImportedNode(e.getImportedName())}catch(e){}}for(const t of[...e.getExportedNodes()])t.getLocalNode()===this&&e.removeExportedNode(t.getExportedName())}for(const e of new Set(this.getParents()))if(e instanceof $n.SFNode)for(const t of new Set(e.getParents()))t instanceof $n.MFNode&&t.setValue([...t].filter((e=>e?.getValue()!==this)));for(const e of new Set(this.getParents()))e instanceof $n.SFNode&&e.setValue(null);pr.prototype.dispose.call(this)}});for(const e of Object.keys(wr.prototype))Object.defineProperty(wr.prototype,e,{enumerable:!1});Object.defineProperties(wr,{typeName:{value:"X3DNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Core",level:1}),enumerable:!0}});const br=wr;i.add("X3DNode","x_ite/Components/Core/X3DNode",br);const Sr=br;function Tr(e){this.addType(d.X3DMetadataObject)}Object.assign(Tr.prototype,{initialize(){},dispose(){}}),Object.defineProperties(Tr,{typeName:{value:"X3DMetadataObject",enumerable:!0},componentInfo:{value:Object.freeze({name:"Core",level:1}),enumerable:!0}});const vr=Tr;i.add("X3DMetadataObject","x_ite/Components/Core/X3DMetadataObject",vr);const Or=vr;i.add("LATEST_VERSION","x_ite/LATEST_VERSION","4.0");const Er="4.0";function Cr(e){Sr.call(this,e),Or.call(this,e),this.addType(d.MetadataBoolean)}Object.assign(Object.setPrototypeOf(Cr.prototype,Sr.prototype),Or.prototype,{initialize(){Sr.prototype.initialize.call(this),Or.prototype.initialize.call(this)},getContainerField(e=Er){return e<=3.3?"metadata":Sr.prototype.getContainerField.call(this)},dispose(){Or.prototype.dispose.call(this),Sr.prototype.dispose.call(this)}}),Object.defineProperties(Cr,{typeName:{value:"MetadataBoolean",enumerable:!0},componentInfo:{value:Object.freeze({name:"Core",level:1}),enumerable:!0},containerField:{value:"value",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.3",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"name",new $n.SFString),new k(d.inputOutput,"reference",new $n.SFString),new k(d.inputOutput,"value",new $n.MFBool)]),enumerable:!0}});const Nr=Cr;i.add("MetadataBoolean","x_ite/Components/Core/MetadataBoolean",Nr);const Ir=Nr;function Fr(e){Sr.call(this,e),Or.call(this,e),this.addType(d.MetadataDouble)}Object.assign(Object.setPrototypeOf(Fr.prototype,Sr.prototype),Or.prototype,{initialize(){Sr.prototype.initialize.call(this),Or.prototype.initialize.call(this)},getContainerField(e=Er){return e<=3.3?"metadata":Sr.prototype.getContainerField.call(this)},dispose(){Or.prototype.dispose.call(this),Sr.prototype.dispose.call(this)}}),Object.defineProperties(Fr,{typeName:{value:"MetadataDouble",enumerable:!0},componentInfo:{value:Object.freeze({name:"Core",level:1}),enumerable:!0},containerField:{value:"value",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"name",new $n.SFString),new k(d.inputOutput,"reference",new $n.SFString),new k(d.inputOutput,"value",new $n.MFDouble)]),enumerable:!0}});const Mr=Fr;i.add("MetadataDouble","x_ite/Components/Core/MetadataDouble",Mr);const Dr=Mr;function Rr(e){Sr.call(this,e),Or.call(this,e),this.addType(d.MetadataFloat)}Object.assign(Object.setPrototypeOf(Rr.prototype,Sr.prototype),Or.prototype,{initialize(){Sr.prototype.initialize.call(this),Or.prototype.initialize.call(this)},getContainerField(e=Er){return e<=3.3?"metadata":Sr.prototype.getContainerField.call(this)},dispose(){Or.prototype.dispose.call(this),Sr.prototype.dispose.call(this)}}),Object.defineProperties(Rr,{typeName:{value:"MetadataFloat",enumerable:!0},componentInfo:{value:Object.freeze({name:"Core",level:1}),enumerable:!0},containerField:{value:"value",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"name",new $n.SFString),new k(d.inputOutput,"reference",new $n.SFString),new k(d.inputOutput,"value",new $n.MFFloat)]),enumerable:!0}});const Pr=Rr;i.add("MetadataFloat","x_ite/Components/Core/MetadataFloat",Pr);const Ar=Pr;function Vr(e){Sr.call(this,e),Or.call(this,e),this.addType(d.MetadataInteger)}Object.assign(Object.setPrototypeOf(Vr.prototype,Sr.prototype),Or.prototype,{initialize(){Sr.prototype.initialize.call(this),Or.prototype.initialize.call(this)},getContainerField(e=Er){return e<=3.3?"metadata":Sr.prototype.getContainerField.call(this)},dispose(){Or.prototype.dispose.call(this),Sr.prototype.dispose.call(this)}}),Object.defineProperties(Vr,{typeName:{value:"MetadataInteger",enumerable:!0},componentInfo:{value:Object.freeze({name:"Core",level:1}),enumerable:!0},containerField:{value:"value",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"name",new $n.SFString),new k(d.inputOutput,"reference",new $n.SFString),new k(d.inputOutput,"value",new $n.MFInt32)]),enumerable:!0}});const Lr=Vr;i.add("MetadataInteger","x_ite/Components/Core/MetadataInteger",Lr);const Br=Lr;function Ur(e){Sr.call(this,e),Or.call(this,e),this.addType(d.MetadataSet)}Object.assign(Object.setPrototypeOf(Ur.prototype,Sr.prototype),Or.prototype,{initialize(){Sr.prototype.initialize.call(this),Or.prototype.initialize.call(this)},getContainerField(e=Er){return e<=3.3?"metadata":Sr.prototype.getContainerField.call(this)},dispose(){Or.prototype.dispose.call(this),Sr.prototype.dispose.call(this)}}),Object.defineProperties(Ur,{typeName:{value:"MetadataSet",enumerable:!0},componentInfo:{value:Object.freeze({name:"Core",level:1}),enumerable:!0},containerField:{value:"value",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"name",new $n.SFString),new k(d.inputOutput,"reference",new $n.SFString),new k(d.inputOutput,"value",new $n.MFNode)]),enumerable:!0}});const Xr=Ur;i.add("MetadataSet","x_ite/Components/Core/MetadataSet",Xr);const jr=Xr;function kr(e){Sr.call(this,e),Or.call(this,e),this.addType(d.MetadataString)}Object.assign(Object.setPrototypeOf(kr.prototype,Sr.prototype),Or.prototype,{initialize(){Sr.prototype.initialize.call(this),Or.prototype.initialize.call(this)},getContainerField(e=Er){return e<=3.3?"metadata":Sr.prototype.getContainerField.call(this)},dispose(){Or.prototype.dispose.call(this),Sr.prototype.dispose.call(this)}}),Object.defineProperties(kr,{typeName:{value:"MetadataString",enumerable:!0},componentInfo:{value:Object.freeze({name:"Core",level:1}),enumerable:!0},containerField:{value:"value",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"name",new $n.SFString),new k(d.inputOutput,"reference",new $n.SFString),new k(d.inputOutput,"value",new $n.MFString)]),enumerable:!0}});const zr=kr;i.add("MetadataString","x_ite/Components/Core/MetadataString",zr);const Gr=zr;function Hr(e){this.getExecutionContext()||(Sr.call(this,e),this.addType(d.X3DChildNode),this.addChildObjects(d.outputOnly,"isCameraObject",new $n.SFBool,d.outputOnly,"isPickableObject",new $n.SFBool))}Object.assign(Object.setPrototypeOf(Hr.prototype,Sr.prototype),{setCameraObject(e){e!==this._isCameraObject.getValue()&&(this._isCameraObject=e)},isCameraObject(){return this._isCameraObject.getValue()},setPickableObject(e){e!==this._isPickableObject.getValue()&&(this._isPickableObject=e)},isPickableObject(){return this._isPickableObject.getValue()},getMustDisplay:()=>!1}),Object.defineProperties(Hr,{typeName:{value:"X3DChildNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Core",level:1}),enumerable:!0}});const qr=Hr;i.add("X3DChildNode","x_ite/Components/Core/X3DChildNode",qr);const Yr=qr;function Wr(e){Yr.call(this,e),this.addType(d.X3DInfoNode)}Object.setPrototypeOf(Wr.prototype,Yr.prototype),Object.defineProperties(Wr,{typeName:{value:"X3DInfoNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Core",level:1}),enumerable:!0}});const $r=Wr;i.add("X3DInfoNode","x_ite/Components/Core/X3DInfoNode",$r);const Jr=$r;function Kr(e){Jr.call(this,e),this.addType(d.WorldInfo)}Object.assign(Object.setPrototypeOf(Kr.prototype,Jr.prototype),{initialize(){Jr.prototype.initialize.call(this),this.getExecutionContext().addWorldInfo(this)},dispose(){this.getExecutionContext().removeWorldInfo(this),Jr.prototype.dispose.call(this)}}),Object.defineProperties(Kr,{typeName:{value:"WorldInfo",enumerable:!0},componentInfo:{value:Object.freeze({name:"Core",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"title",new $n.SFString),new k(d.inputOutput,"info",new $n.MFString)]),enumerable:!0}});const Zr=Kr;i.add("WorldInfo","x_ite/Components/Core/WorldInfo",Zr);const Qr=Zr;let es=0;function ts(e){Yr.call(this,e),this.addType(d.X3DBindableNode),this.modificationCount=0}Object.assign(Object.setPrototypeOf(ts.prototype,Yr.prototype),{initialize(){Yr.prototype.initialize.call(this),this._set_bind.addInterest("set_bind__",this)},isCameraObject:()=>!0,getModificationCount(){return this.modificationCount},transitionStart(){},set_bind__(){this.modificationCount=++es}}),Object.defineProperties(ts,{typeName:{value:"X3DBindableNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Core",level:1}),enumerable:!0},getModificationCount:{value:function(){return es},enumerable:!1}});const is=ts;i.add("X3DBindableNode","x_ite/Components/Core/X3DBindableNode",is);const ns=is;function rs(e=[]){return $.call(this,Array.from(e,(e=>[e.getNodeName(),e])),Ci)}Object.setPrototypeOf(rs.prototype,$.prototype);for(const e of Object.keys(rs.prototype))Object.defineProperty(rs.prototype,e,{enumerable:!1});Object.defineProperties(rs,{typeName:{value:"NamedNodesArray",enumerable:!0}});const ss=rs;i.add("NamedNodesArray","x_ite/Execution/NamedNodesArray",ss);const os=ss,as=Symbol(),ls=Symbol(),us=Symbol(),hs=Symbol();function ds(e,t,i,n){Sr.call(this,e),this[as]=t,this[ls]=i,this[us]=n,this[hs]=new Set,this[as]._loadState.addInterest("set_loadState__",this)}Object.assign(Object.setPrototypeOf(ds.prototype,Sr.prototype),{getInlineNode(){return this[as]},getExportedName(){return this[ls]},getExportedNode(){return this[as].getInternalScene().getExportedNode(this[ls]).getValue()},getImportedName(){return this[us]},hasRoutes(e){for(const t of this[hs]){if(t.sourceNode===e)return!0;if(t.destinationNode===e)return!0}return!1},addRoute(e,t,i,n){const r={sourceNode:e,sourceField:t,destinationNode:i,destinationField:n};this[hs].add(r),this[as].checkLoadState()===d.COMPLETE_STATE&&this.resolveRoute(r)},resolveRoute(e){try{const t=e.sourceField,i=e.destinationField;let n=e.sourceNode,r=e.destinationNode;e.real&&e.real.dispose(),n instanceof ds&&(n=n.getExportedNode()),r instanceof ds&&(r=r.getExportedNode()),e.real=this.getExecutionContext().addSimpleRoute(n,t,r,i)}catch(e){console.error(e.message)}},deleteRoute(e){for(const t of this[hs])t.real===e&&this[hs].delete(t)},deleteRoutes(){for(const e of this[hs]){const t=e.real;t&&(delete e.real,this.getExecutionContext().deleteSimpleRoute(t))}},set_loadState__(){switch(this[as].checkLoadState()){case d.NOT_STARTED_STATE:case d.FAILED_STATE:this.deleteRoutes();break;case d.COMPLETE_STATE:this.deleteRoutes();for(const e of this[hs])this.resolveRoute(e)}},toStream(e){I.prototype.toStream.call(this,e)},toVRMLStream(e){if(!e.ExistsNode(this.getInlineNode()))throw new Error("X3DImportedNode.toXMLStream: Inline node does not exist.");e.string+=e.Indent(),e.string+="IMPORT",e.string+=e.Space(),e.string+=e.Name(this.getInlineNode()),e.string+=".",e.string+=this.getExportedName(),this.getImportedName()!==this.getExportedName()&&(e.string+=e.Space(),e.string+="AS",e.string+=e.Space(),e.string+=this.getImportedName());try{e.AddRouteNode(this),e.AddImportedNode(this.getExportedNode(),this.getImportedName())}catch{for(const t of this[hs]){const i=t.sourceNode,n=t.sourceField,r=t.destinationNode,s=t.destinationField;if(e.ExistsRouteNode(i)&&e.ExistsRouteNode(r)){const t=i instanceof ds?i.getImportedName():e.Name(i),o=r instanceof ds?r.getImportedName():e.Name(r);e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+="ROUTE",e.string+=e.Space(),e.string+=t,e.string+=".",e.string+=n,e.string+=e.Space(),e.string+="TO",e.string+=e.Space(),e.string+=o,e.string+=".",e.string+=s}}}},toXMLStream(e){if(!e.ExistsNode(this.getInlineNode()))throw new Error("X3DImportedNode.toXMLStream: Inline node does not exist.");e.string+=e.Indent(),e.string+="<IMPORT",e.string+=e.Space(),e.string+="inlineDEF='",e.string+=e.XMLEncode(e.Name(this.getInlineNode())),e.string+="'",e.string+=e.Space(),e.string+="importedDEF='",e.string+=e.XMLEncode(this.getExportedName()),e.string+="'",this.getImportedName()!==this.getExportedName()&&(e.string+=e.Space(),e.string+="AS='",e.string+=e.XMLEncode(this.getImportedName()),e.string+="'"),e.string+=e.closingTags?"></IMPORT>":"/>";try{e.AddRouteNode(this),e.AddImportedNode(this.getExportedNode(),this.getImportedName())}catch{for(const t of this[hs]){const i=t.sourceNode,n=t.sourceField,r=t.destinationNode,s=t.destinationField;if(e.ExistsRouteNode(i)&&e.ExistsRouteNode(r)){const t=i instanceof ds?i.getImportedName():e.Name(i),o=r instanceof ds?r.getImportedName():e.Name(r);e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+="<ROUTE",e.string+=e.Space(),e.string+="fromNode='",e.string+=e.XMLEncode(t),e.string+="'",e.string+=e.Space(),e.string+="fromField='",e.string+=e.XMLEncode(n),e.string+="'",e.string+=e.Space(),e.string+="toNode='",e.string+=e.XMLEncode(o),e.string+="'",e.string+=e.Space(),e.string+="toField='",e.string+=e.XMLEncode(s),e.string+="'",e.string+=e.closingTags?"></ROUTE>":"/>"}}}},toJSONStream(e){if(!e.ExistsNode(this.getInlineNode()))throw new Error("X3DImportedNode.toJSONStream: Inline node does not exist.");e.string+=e.Indent(),e.string+="{",e.string+=e.TidySpace(),e.string+='"',e.string+="IMPORT",e.string+='"',e.string+=":",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@inlineDEF",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(e.Name(this.getInlineNode())),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@importedDEF",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(this.getExportedName()),e.string+='"',this.getImportedName()!==this.getExportedName()?(e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@AS",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(this.getImportedName()),e.string+='"',e.string+=e.TidyBreak()):e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}";try{e.AddRouteNode(this),e.AddImportedNode(this.getExportedNode(),this.getImportedName())}catch{for(const t of this[hs]){const i=t.sourceNode,n=t.sourceField,r=t.destinationNode,s=t.destinationField;if(e.ExistsRouteNode(i)&&e.ExistsRouteNode(r)){const t=i instanceof ds?i.getImportedName():e.Name(i),o=r instanceof ds?r.getImportedName():e.Name(r);e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+="{",e.string+=e.TidySpace(),e.string+='"',e.string+="ROUTE",e.string+='"',e.string+=":",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@fromNode",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(t),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@fromField",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(n),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@toNode",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(o),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@toField",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(s),e.string+='"',e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}"}}}},dispose(){this[as]._loadState.removeInterest("set_loadState__",this),this.deleteRoutes(),Sr.prototype.dispose.call(this)}});for(const e of Object.keys(ds.prototype))Object.defineProperty(ds.prototype,e,{enumerable:!1});Object.defineProperties(ds.prototype,{inlineNode:{get(){return bi.get(this[as])},enumerable:!0},exportedName:{get(){return this[ls]},enumerable:!0},exportedNode:{get(){return this[as].getInternalScene().getExportedNode(this[ls])},enumerable:!0},importedName:{get(){return this[us]},enumerable:!0}}),Object.defineProperties(ds,{typeName:{value:"X3DImportedNode",enumerable:!0}});const cs=ds;i.add("X3DImportedNode","x_ite/Execution/X3DImportedNode",cs);const ps=cs;function gs(e=[]){return $.call(this,Array.from(e,(e=>[e.getImportedName(),e])),ps)}Object.setPrototypeOf(gs.prototype,$.prototype);for(const e of Object.keys(gs.prototype))Object.defineProperty(gs.prototype,e,{enumerable:!1});Object.defineProperties(gs,{typeName:{value:"ImportedNodesArray",enumerable:!0}});const fs=gs;i.add("ImportedNodesArray","x_ite/Execution/ImportedNodesArray",fs);const ms=fs,_s=Symbol(),xs=Symbol(),ys=Symbol(),ws=Symbol();function bs(e){this.addType(d.X3DUrlObject),this.addChildObjects(d.outputOnly,"loadState",new $n.SFInt32(d.NOT_STARTED_STATE),d.inputOutput,"loadData",new $n.SFTime),this[_s]=!0,this[xs]=Date.now()}Object.assign(bs.prototype,{initialize(){this.getLive().addInterest("set_live__",this),this._load.addInterest("set_load__",this),this._url.addInterest("set_url__",this),this._loadData.addInterest("loadData",this),this._autoRefresh.addInterest("set_autoRefresh__",this),this._autoRefreshTimeLimit.addInterest("set_autoRefresh__",this)},setLoadState(e,t=!0){if(this._loadState=e,e===d.COMPLETE_STATE&&(this[ys]=Date.now(),this.setAutoRefreshTimer(this._autoRefresh.getValue())),t)switch(e){case d.NOT_STARTED_STATE:break;case d.IN_PROGRESS_STATE:this.getScene().addLoadingObject(this);break;case d.COMPLETE_STATE:case d.FAILED_STATE:this.getScene().removeLoadingObject(this)}},checkLoadState(){return this._loadState.getValue()},getLoadState(){return this._loadState},setCache(e){this[_s]=e},getCache(){return this[_s]&&this.getBrowser().getBrowserOption("Cache")},requestImmediateLoad(e=!0){return new Promise(((t,i)=>{const n=()=>{const e=Symbol();this._loadState.addFieldCallback(e,(()=>{switch(this.checkLoadState()){case d.COMPLETE_STATE:this._loadState.removeFieldCallback(e),t();break;case d.FAILED_STATE:this._loadState.removeFieldCallback(e),i()}}))};switch(this.checkLoadState()){case d.IN_PROGRESS_STATE:return void n();case d.COMPLETE_STATE:return void t();case d.FAILED_STATE:return void i()}const r=this.getBrowser();r.getBrowserOption("LoadUrlObjects")||this.getExecutionContext()===r.getPrivateScene()||this.isExternProto?this._load.getValue()?0!==this._url.length?(this.setCache(e),this.setLoadState(d.IN_PROGRESS_STATE),this.isInitialized()?this._loadData=this.getBrowser().getCurrentTime():this.loadData(),n()):t():i():t()}))},loadNow(){return this.setLoadState(d.NOT_STARTED_STATE),this.requestImmediateLoad()},loadData(){},requestUnload(){const e=this.checkLoadState();e!==d.NOT_STARTED_STATE&&e!==d.FAILED_STATE&&(this.setLoadState(d.NOT_STARTED_STATE),this.unloadData())},unloadNow(){this.requestUnload()},unloadData(){},setAutoRefreshTimer(e){if(clearTimeout(this[ws]),this._autoRefresh.getValue()<=0)return;const t=this._autoRefreshTimeLimit.getValue();0!==t&&(Date.now()-this[xs])/1e3>t-e||(this[ws]=setTimeout(this.performAutoRefresh.bind(this),1e3*e))},performAutoRefresh(){this.setLoadState(d.NOT_STARTED_STATE),this.requestImmediateLoad(!1).catch(Function.prototype)},set_live__(){this.getLive().getValue()?this.set_autoRefresh__():clearTimeout(this[ws])},set_load__(){this._load.getValue()?this.requestImmediateLoad().catch(Function.prototype):this.requestUnload()},set_url__(){this._load.getValue()&&(this.setLoadState(d.NOT_STARTED_STATE),this.requestImmediateLoad().catch(Function.prototype))},set_autoRefresh__(){if(this.checkLoadState()!==d.COMPLETE_STATE)return;const e=(Date.now()-this[ys])/1e3,t=this._autoRefresh.getValue();let i=t-e;i<0&&(i=Math.ceil(e/t)*t-e),this.setAutoRefreshTimer(i)},dispose(){}}),Object.defineProperties(bs,{typeName:{value:"X3DUrlObject",enumerable:!0},componentInfo:{value:Object.freeze({name:"Networking",level:1}),enumerable:!0}});const Ss=bs;i.add("X3DUrlObject","x_ite/Components/Networking/X3DUrlObject",Ss);const Ts=Ss;function vs(e){pr.call(this,e),this.addType(d.X3DProtoDeclarationNode),this.addChildObjects(d.outputOnly,"updateInstances",new $n.SFTime)}Object.assign(Object.setPrototypeOf(vs.prototype,pr.prototype),{canUserDefinedFields:()=>!0,createInstance(e,t=!0){if(!1===t)return new Wh(e,this);{const t=new Wh(e,this);return t.setup(),bi.get(t)}},newInstance(){return this.createInstance(this.getExecutionContext())},requestUpdateInstances(){this._updateInstances=this.getBrowser().getCurrentTime()},updateInstances(){this._updateInstances.processEvent()}});for(const e of Object.keys(vs.prototype))Object.defineProperty(vs.prototype,e,{enumerable:!1});Object.defineProperties(vs,{typeName:{value:"X3DProtoDeclarationNode",enumerable:!0}}),d.addNode(vs);const Os=vs;i.add("X3DProtoDeclarationNode","x_ite/Prototype/X3DProtoDeclarationNode",Os);const Es=Os;var Cs=n(328);function Ns(e){this.scene=e,this.executionContexts=[e],this.prototypes=[]}Object.assign(Ns.prototype,{getBrowser(){return this.scene.getBrowser()},getScene(){return this.scene},getExecutionContext(){return this.executionContexts.at(-1)},pushExecutionContext(e){return this.executionContexts.push(e)},popExecutionContext(){this.executionContexts.pop()},getPrototype(){return this.prototypes.at(-1)},pushPrototype(e){return this.prototypes.push(e)},popPrototype(){this.prototypes.pop()},isInsideProtoDefinition(){return!!this.prototypes.length},loadComponents(){const e=this.getBrowser(),t=this.getScene();return Promise.all([e.loadComponents(t.getProfile()||e.getProfile("Full")),e.loadComponents(t.getComponents())])},setUnits(e){e?delete this.fromUnit:this.fromUnit=function(e,t){return t}},fromUnit(e,t){return this.scene.fromUnit(e,t)},convertColor(e,t="white"){const i=Cs("<div></div>").hide().css("color",t).appendTo(Cs("body")),n=Cs("<div></div>").css("color",e).appendTo(i),r=window.getComputedStyle(n[0]).color.replace(/^rgba?\(|\)$/g,"").split(/[\s,]+/).map((e=>parseFloat(e)));return i.remove(),r[0]/=255,r[1]/=255,r[2]/=255,"number"!=typeof r[3]&&(r[3]=1),r},sanitizeName:(e="")=>e=(e=(e=(e=e.replace(/^[\x30-\x39\x00-\x20\x22\x23\x27\x2b\x2c\x2d\x2e\x5b\x5c\x5d\x7b\x7d\x7f]*/,"")).replace(/[\x00-\x20\x22\x23\x27\x2c\x2e\x5b\x5c\x5d\x7b\x7d\x7f]+/g,"-")).trim().replace(/[\s_-]+/g,"-")).replace(/^-+|-+$/g,"")});const Is=Ns;i.add("X3DParser","x_ite/Parser/X3DParser",Is);const Fs=Is;function Ms(e){return this.lastIndex=e.lastIndex,e.result=this.exec(e.input),!!e.result&&(e.lastIndex=this.lastIndex,!0)}function Ds(e){const t=e.lastIndex,i=this.parse(e);return e.lastIndex=t,i}const Rs=function(e){for(const t of Object.values(e))t.parse=Ms,t.lookahead=Ds;return e};i.add("Expressions","x_ite/Parser/Expressions",Rs);const Ps=Rs,As=Symbol();function Vs(e){Es.call(this,e),this.addType(d.X3DProtoDeclaration),this[As]=new jh(e,this),this[As].setLive(!1),this.setLive(!1)}Object.assign(Object.setPrototypeOf(Vs.prototype,Es.prototype),{initialize(){Es.prototype.initialize.call(this),this[As].setup()},getProtoDeclaration(){return this},getBody(){return this[As]},canUserDefinedFields:()=>!0,toVRMLStream(e){e.string+=e.Indent(),e.string+="PROTO",e.string+=e.Space(),e.string+=this.getName(),e.string+=e.TidySpace(),e.string+="[",e.EnterScope();const t=this.getUserDefinedFields();if(0===t.length)e.string+=e.TidySpace();else{let i=0,n=0;for(const r of t)i=Math.max(i,r.getTypeName().length),n=Math.max(n,e.AccessType(r.getAccessType()).length);e.string+=e.TidyBreak(),e.IncIndent();for(const r of t)this.toVRMLStreamUserDefinedField(e,r,i,n),e.string+=e.Break();e.DecIndent(),e.string+=e.Indent()}e.LeaveScope(),e.string+="]",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.IncIndent(),this[As].toVRMLStream(e),e.DecIndent(),e.string+=e.Indent(),e.string+="}"},toVRMLStreamUserDefinedField(e,t,i,n){e.string+=e.Indent(),e.string+=e.AccessType(t.getAccessType()).padEnd(n," "),e.string+=e.Space(),e.string+=t.getTypeName().padEnd(i," "),e.string+=e.Space(),e.string+=t.getName(),t.isInitializable()&&(e.string+=e.Space(),t.toVRMLStream(e))},toXMLStream(e){e.string+=e.Indent(),e.string+="<ProtoDeclare",e.string+=e.Space(),e.string+="name='",e.string+=e.XMLEncode(this.getName()),e.string+="'",e.string+=">",e.string+=e.TidyBreak(),e.EnterScope();const t=this.getUserDefinedFields();if(0!==t.length){e.IncIndent(),e.string+=e.Indent(),e.string+="<ProtoInterface>",e.string+=e.TidyBreak(),e.IncIndent();for(const i of t)if(e.string+=e.Indent(),e.string+="<field",e.string+=e.Space(),e.string+="accessType='",e.string+=e.AccessType(i.getAccessType()),e.string+="'",e.string+=e.Space(),e.string+="type='",e.string+=i.getTypeName(),e.string+="'",e.string+=e.Space(),e.string+="name='",e.string+=e.XMLEncode(i.getName()),e.string+="'",i.isDefaultValue())e.string+=e.closingTags?"></field>":"/>",e.string+=e.TidyBreak();else switch(i.getType()){case d.SFNode:case d.MFNode:e.PushContainerField(i),e.string+=">",e.string+=e.TidyBreak(),e.IncIndent(),i.toXMLStream(e),e.string+=e.TidyBreak(),e.DecIndent(),e.string+=e.Indent(),e.string+="</field>",e.string+=e.TidyBreak(),e.PopContainerField();break;default:e.string+=e.Space(),e.string+="value='",i.toXMLStream(e),e.string+="'",e.string+=e.closingTags?"></field>":"/>",e.string+=e.TidyBreak()}e.DecIndent(),e.string+=e.Indent(),e.string+="</ProtoInterface>",e.string+=e.TidyBreak(),e.DecIndent()}e.LeaveScope(),e.IncIndent(),e.string+=e.Indent(),e.string+="<ProtoBody>",e.string+=e.TidyBreak(),e.IncIndent(),this[As].toXMLStream(e),e.DecIndent(),e.string+=e.Indent(),e.string+="</ProtoBody>",e.string+=e.TidyBreak(),e.DecIndent(),e.string+=e.Indent(),e.string+="</ProtoDeclare>"},toJSONStream(e){e.string+=e.Indent(),e.string+="{",e.string+=e.TidySpace(),e.string+='"',e.string+="ProtoDeclare",e.string+='"',e.string+=":",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@name",e.string+='"',e.string+=":",e.string+='"',e.string+=e.JSONEncode(this.getName()),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="ProtoInterface",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.EnterScope();const t=this.getUserDefinedFields();if(t.length){e.string+=e.Indent(),e.string+='"',e.string+="field",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent();for(const i of t){if(e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@accessType",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.AccessType(i.getAccessType()),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@type",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=i.getTypeName(),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@name",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(i.getName()),e.string+='"',i.isDefaultValue())e.string+=e.TidyBreak();else switch(e.string+=",",e.string+=e.TidyBreak(),i.getType()){case d.SFNode:e.string+=e.Indent(),e.string+='"',e.string+="-children",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),i.toJSONStream(e),e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]",e.string+=e.TidyBreak();break;case d.MFNode:e.string+=e.Indent(),e.string+='"',e.string+="-children",e.string+='"',e.string+=":",e.string+=e.TidySpace(),i.toJSONStream(e),e.string+=e.TidyBreak();break;default:e.string+=e.Indent(),e.string+='"',e.string+="@value",e.string+='"',e.string+=":",e.string+=e.TidySpace(),i.toJSONStream(e),e.string+=e.TidyBreak()}e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",i!==t.at(-1)&&(e.string+=","),e.string+=e.TidyBreak()}e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]"}e.string+=e.DecIndent(),e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+="}",e.string+=",",e.string+=e.TidyBreak(),e.LeaveScope(),e.string+=e.Indent(),e.string+='"',e.string+="ProtoBody",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="-children",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),this[As].toJSONStream(e),e.JSONRemoveComma(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}"}});for(const e of Object.keys(Vs.prototype))Object.defineProperty(Vs.prototype,e,{enumerable:!1});Object.defineProperties(Vs.prototype,{name:{get:Vs.prototype.getName,enumerable:!0},fields:{get:Vs.prototype.getFieldDefinitions,enumerable:!0},isExternProto:{value:!1,enumerable:!0}}),Object.defineProperties(Vs,{typeName:{value:"X3DProtoDeclaration",enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode)]),enumerable:!0}}),d.addNode(Vs);const Ls=Vs;i.add("X3DProtoDeclaration","x_ite/Prototype/X3DProtoDeclaration",Ls);const Bs=Ls;var Us=n(328);const Xs=Ps({Whitespaces:/([\x20\n,\t\r]+)/gy,Comment:/#(.*?)(?=[\n\r])/gy,Break:/\r?\n/g,Header:/^#(VRML|X3D) V(.*?) (utf8)(?:[ \t]+(.*?))?[ \t]*[\n\r]/gy,AS:/AS/gy,COMPONENT:/COMPONENT/gy,DEF:/DEF/gy,EXPORT:/EXPORT/gy,EXTERNPROTO:/EXTERNPROTO/gy,FALSE:/FALSE|false/gy,IMPORT:/IMPORT/gy,IS:/IS/gy,META:/META/gy,NULL:/NULL/gy,TRUE:/TRUE|true/gy,PROFILE:/PROFILE/gy,PROTO:/PROTO/gy,ROUTE:/ROUTE/gy,TO:/TO/gy,UNIT:/UNIT/gy,USE:/USE/gy,OpenBrace:/\{/gy,CloseBrace:/\}/gy,OpenBracket:/\[/gy,CloseBracket:/\]/gy,Period:/\./gy,Colon:/\:/gy,Id:/([^\x30-\x39\x00-\x20\x22\x23\x27\x2b\x2c\x2d\x2e\x5b\x5c\x5d\x7b\x7d\x7f]{1}[^\x00-\x20\x22\x23\x27\x2c\x2e\x5b\x5c\x5d\x7b\x7d\x7f]*)/gy,ComponentNameId:/([^\x30-\x39\x00-\x20\x22\x23\x27\x2b\x2c\x2d\x2e\x5b\x5c\x5d\x7b\x7d\x7f\x3a]{1}[^\x00-\x20\x22\x23\x27\x2c\x2e\x5b\x5c\x5d\x7b\x7d\x7f\x3a]*)/gy,initializeOnly:/initializeOnly/gy,inputOnly:/inputOnly/gy,outputOnly:/outputOnly/gy,inputOutput:/inputOutput/gy,field:/field/gy,eventIn:/eventIn/gy,eventOut:/eventOut/gy,exposedField:/exposedField/gy,FieldType:/([SM]F(?:Bool|ColorRGBA|Color|Double|Float|Image|Int32|Matrix3d|Matrix3f|Matrix4d|Matrix4f|Node|Rotation|String|Time|Vec2d|Vec2f|Vec3d|Vec3f|Vec4d|Vec4f))/gy,int32:/((?:0[xX][\da-fA-F]+)|(?:[+-]?\d+))/gy,double:/([+-]?(?:(?:(?:\d*\.\d+)|(?:\d+(?:\.)?))(?:[eE][+-]?\d+)?))/gy,string:/"((?:[^\\"]|\\\\|\\")*)"/gy,CONSTANTS:/([+-]?)\b(NAN|INFINITY|INF|PI|PI2|PI1_4|PI2_4|PI3_4|PI4_4|PI5_4|PI6_4|PI7_4|PI8_4|PI1_2|PI2_2|PI3_2|PI4_2|PI1_3|PI2_3|PI3_3|PI4_3|PI5_3|PI6_3|SQRT1_2|SQRT2)\b/giy,HTMLColor:/([a-zA-Z]+|0[xX][\da-fA-F]+|rgba?\(.*?\))/gy});function js(e){Fs.call(this,e)}Object.assign(Object.setPrototypeOf(js.prototype,Fs.prototype),{accessTypes:{field:d.initializeOnly,eventIn:d.inputOnly,eventOut:d.outputOnly,exposedField:d.inputOutput,initializeOnly:d.initializeOnly,inputOnly:d.inputOnly,outputOnly:d.outputOnly,inputOutput:d.inputOutput},SFImage:new $n.SFImage,SFNode:new $n.SFNode,MFString:new $n.MFString,Color3:new Fe(0,0,0),Color4:new We(0,0,0,0),Matrix3:new At,Matrix4:new gi,Rotation4:new ui,Vector2:new _t(0,0),Vector3:new Tt(0,0,0),Vector4:new Gt(0,0,0,0),CONSTANTS:{NAN:Number.NaN,INFINITY:Number.POSITIVE_INFINITY,INF:Number.POSITIVE_INFINITY,PI:Math.PI,PI2:2*Math.PI,PI1_4:1*Math.PI/4,PI2_4:2*Math.PI/4,PI3_4:3*Math.PI/4,PI4_4:4*Math.PI/4,PI5_4:5*Math.PI/4,PI6_4:6*Math.PI/4,PI7_4:7*Math.PI/4,PI8_4:8*Math.PI/4,PI1_2:1*Math.PI/2,PI2_2:2*Math.PI/2,PI3_2:3*Math.PI/2,PI4_2:4*Math.PI/2,PI1_3:1*Math.PI/3,PI2_3:2*Math.PI/3,PI3_3:3*Math.PI/3,PI4_3:4*Math.PI/3,PI5_3:5*Math.PI/3,PI6_3:6*Math.PI/3,SQRT1_2:Math.SQRT1_2,SQRT2:Math.SQRT2},getEncoding:()=>"STRING",setInput(e){this.input=e,this.lineNumber=1,this.lastIndex=0},isValid(){return"string"==typeof this.input&&!!this.input.match(/^(?:#X3D|#VRML|(?:[\x20\n,\t\r]*|#.*?[\r\n])*(PROFILE|COMPONENT|META|UNIT|EXTERNPROTO|PROTO|DEF|NULL|IMPORT|EXPORT|ROUTE|\w+(?:[\x20\n,\t\r]*|#.*?[\r\n])\{|$))/)},parseIntoScene(e,t){try{this.resolve=e,this.reject=t,this.getScene().setEncoding("VRML"),this.getScene().setProfile(this.getBrowser().getProfile("Full")),this.x3dScene()}catch(e){throw new Error(this.getError(e))}},throwOrWarn(e){if(this.getBrowser().isStrict())throw new Error(e);console.warn(e)},getError(e){const t=e.message,i=this.lastIndex===this.input.length?"Unexpected end of file. ":"";let n=this.getLine(),r=this.getLastLine(),s=this.getLastLine(),o=r.length-n.length+1;r.length>80&&(r=r.substr(o-40,80),s="",o=40);let a=this.getExecutionContext().getWorldURL();a.startsWith("data:")&&(a=a.substring(0,a.indexOf(",")));return`\n********************************************************************************\nParser error at line ${this.lineNumber}:${o}\nin '${a}'\n\n${s}\n${r}\n${Array(o).join(" ")}^\n${i}${t}\n********************************************************************************\n`},getLine(){let e=this.input,t=this.lastIndex,i="";for(;t<e.length&&"\n"!==e[t]&&"\r"!==e[t];)i+=e[t++];return this.lastIndex=t,i},getLastLine(){let e=this.input,t=Math.min(this.lastIndex,this.input.length-1),i="";for(t<e.length&&("\n"!==e[t]||"\r"!==e[t])&&--t;t>=0&&"\n"!==e[t]&&"\r"!==e[t];)i=e[t--]+i;return this.lastIndex=t,i},comments(){for(;this.comment(););},comment(){return!!this.whitespaces()||Xs.Comment.parse(this)},whitespaces(){return!!Xs.Whitespaces.parse(this)&&(this.lines(this.result[1]),!0)},lines(e){const t=e.match(Xs.Break);t&&(this.lineNumber+=t.length)},x3dScene:(()=>{const e=["EnvironmentalSensor","PointingDeviceSensor","Scripting","Sound","Text"];return function(){const t=this.getBrowser(),i=this.getScene();if(this.headerStatement(),this.profileStatement(),this.componentStatements(),this.unitStatements(),this.metaStatements(),"2.0"===i.getSpecificationVersion()){i.setProfile(t.getProfile("Interchange"));for(const n of e)i.updateComponent(t.getComponent(n))}if(this.resolve)this.loadComponents().then((()=>{try{if(this.statements(this.getExecutionContext().rootNodes),this.lastIndex<this.input.length)throw new Error("Unknown statement.");this.resolve(i)}catch(e){throw new Error(this.getError(e))}})).catch(this.reject);else if(this.statements(this.getExecutionContext().rootNodes),this.lastIndex<this.input.length)throw new Error("Unknown statement.")}})(),headerStatement(){Xs.Header.lastIndex=0;const e=Xs.Header.exec(this.input);return!!e&&(this.getScene().setSpecificationVersion(e[2]),this.getScene().setEncoding("VRML"),!0)},profileStatement(){if(this.comments(),Xs.PROFILE.parse(this)){if(this.profileNameId()){const e=this.getBrowser().getProfile(this.result[1]);return void this.getScene().setProfile(e)}throw new Error("Expected a profile name.")}},componentStatements(){let e;for(;e=this.componentStatement();)this.getScene().updateComponent(e)},componentStatement(){if(this.comments(),Xs.COMPONENT.parse(this)){if(this.componentNameId()){const e=this.result[1];if(this.comments(),Xs.Colon.parse(this)){if(this.componentSupportLevel()){const t=this.value;return this.getBrowser().getComponent(e,t)}throw new Error("Expected a component support level.")}throw new Error("Expected a ':' after component name.")}throw new Error("Expected a component name.")}return null},componentSupportLevel(){return this.int32()},unitStatements(){for(;this.unitStatement(););},unitStatement(){if(this.comments(),Xs.UNIT.parse(this)){if(this.categoryNameId()){const e=this.result[1];if(this.unitNameId()){const t=this.result[1];if(this.unitConversionFactor()){const i=this.value;try{return this.getScene().updateUnit(e,t,i),!0}catch(e){return console.warn(e.message),!0}}throw new Error("Expected unit conversion factor.")}throw new Error("Expected unit name identifier.")}throw new Error("Expected category name identifier after UNIT statement.")}return!1},unitConversionFactor(){return this.double()},metaStatements(){for(;this.metaStatement(););},metaStatement(){if(this.comments(),Xs.META.parse(this)){if(this.metaKey()){const e=this.value;if(this.metaValue()){const t=this.value;return this.getScene().addMetaData(e,t),!0}throw new Error("Expected metadata value.")}throw new Error("Expected metadata key.")}return!1},metaKey(){return this.string()},metaValue(){return this.string()},exportStatement(){if(this.comments(),Xs.EXPORT.parse(this)){if(this.nodeNameId()){const t=this.result[1];this.comments();const i=this.getScene().getLocalNode(t);if(Xs.AS.parse(this)){if(!this.exportedNodeNameId())throw new Error("No name given after AS.");var e=this.result[1]}else e=t;if(this.getScene()===this.getExecutionContext())return this.getScene().updateExportedNode(e,i),!0;throw new Error("Export statement not allowed here.")}throw new Error("No name given after EXPORT.")}return!1},importStatement(){if(this.comments(),Xs.IMPORT.parse(this)){if(this.nodeNameId()){const t=this.result[1],i=this.getExecutionContext().getNamedNode(t);if(this.comments(),Xs.Period.parse(this)){if(this.exportedNodeNameId()){const t=this.result[1];if(this.comments(),Xs.AS.parse(this)){if(!this.nodeNameId())throw new Error("No name given after AS.");var e=this.result[1]}else e=t;return this.getExecutionContext().updateImportedNode(i,t,e),!0}throw new Error("Expected exported node name.")}throw new Error("Expected a '.' after exported node name.")}throw new Error("No name given after IMPORT statement.")}return!1},statements(e){for(;this.statement(e););},statement(e){if(this.protoStatement())return!0;if(this.routeStatement())return!0;if(this.importStatement())return!0;if(this.exportStatement())return!0;const t=this.nodeStatement();return!1!==t&&(e.push(t),!0)},nodeStatement(){if(this.comments(),Xs.DEF.parse(this)){if(this.nodeNameId())return this.node(this.result[1]);throw new Error("No name given after DEF.")}if(Xs.USE.parse(this)){if(this.nodeNameId())return this.getExecutionContext().getNamedNode(this.result[1]).getValue();throw new Error("No name given after USE.")}return Xs.NULL.parse(this)?null:this.node("")},protoStatement(){return!!this.proto()||!!this.externproto()},protoStatements(){for(;this.protoStatement(););},proto(){if(this.comments(),Xs.PROTO.parse(this)){if(this.nodeTypeId()){const e=this.result[1];if(this.comments(),Xs.OpenBracket.parse(this)){const t=this.interfaceDeclarations();if(this.comments(),Xs.CloseBracket.parse(this)){if(this.comments(),Xs.OpenBrace.parse(this)){const i=new Bs(this.getExecutionContext());for(const e of t)i.addUserDefinedField(e.getAccessType(),e.getName(),e);if(this.pushPrototype(i),this.pushExecutionContext(i.getBody()),this.protoBody(i.getBody().rootNodes),this.popExecutionContext(),this.popPrototype(),this.comments(),Xs.CloseBrace.parse(this)){i.setup();try{const t=this.getExecutionContext().getProtoDeclaration(e);this.getExecutionContext().updateProtoDeclaration(this.getExecutionContext().getUniqueProtoName(e),t)}catch{}return this.getExecutionContext().updateProtoDeclaration(e,i),!0}throw new Error("Expected a '}' at the end of PROTO body.")}throw new Error("Expected a '{' at the beginning of PROTO body.")}throw new Error("Expected a ']' at the end of PROTO interface declaration.")}throw new Error("Expected a '[' at the beginning of PROTO interface declaration.")}throw new Error("Invalid PROTO definition name.")}return!1},protoBody(e){this.protoStatements();const t=this.rootNodeStatement();!1!==t&&e.push(t),this.statements(e)},rootNodeStatement(){if(this.comments(),Xs.DEF.parse(this)){if(this.nodeNameId()){const e=this.result[0],t=this.node(e);if(!1!==t)return t;throw new Error("Expected node type name after DEF.")}throw new Error("No name given after DEF.")}const e=this.node("");return!1!==e&&e},interfaceDeclarations(){const e=[];let t;for(;t=this.interfaceDeclaration();)e.push(t);return e},restrictedInterfaceDeclaration(){if(this.comments(),Xs.inputOnly.parse(this)||Xs.eventIn.parse(this)){if(this.fieldType()){const e=this.result[1];if(this.inputOnlyId()){const t=this.result[1],i=new $n[e];return i.setAccessType(d.inputOnly),i.setName(t),i}throw new Error("Expected a name for field.")}throw this.Id(),new Error(`Unknown event or field type: '${this.result[1]}'.`)}if(Xs.outputOnly.parse(this)||Xs.eventOut.parse(this)){if(this.fieldType()){const e=this.result[1];if(this.outputOnlyId()){const t=this.result[1],i=new $n[e];return i.setAccessType(d.outputOnly),i.setName(t),i}throw new Error("Expected a name for field.")}throw this.Id(),new Error(`Unknown event or field type: '${this.result[1]}'.`)}if(Xs.initializeOnly.parse(this)||Xs.field.parse(this)){if(this.fieldType()){const e=this.result[1];if(this.initializeOnlyId()){const t=this.result[1],i=new $n[e];if(this.fieldValue(i))return i.setAccessType(d.initializeOnly),i.setName(t),i;throw new Error(`Couldn't read value for field '${t}'.`)}throw new Error("Expected a name for field.")}throw this.Id(),new Error(`Unknown event or field type: '${this.result[1]}'.`)}return null},interfaceDeclaration(){const e=this.restrictedInterfaceDeclaration();if(e)return e;if(this.comments(),Xs.inputOutput.parse(this)||Xs.exposedField.parse(this)){if(this.fieldType()){const e=this.result[1];if(this.inputOutputId()){const t=this.result[1],i=new $n[e];if(this.fieldValue(i))return i.setAccessType(d.inputOutput),i.setName(t),i;throw new Error(`Couldn't read value for field '${t}'.`)}throw new Error("Expected a name for field.")}throw this.Id(),new Error(`Unknown event or field type: '${this.result[1]}'.`)}return null},externproto(){if(this.comments(),Xs.EXTERNPROTO.parse(this)){if(this.nodeTypeId()){const e=this.result[1];if(this.comments(),Xs.OpenBracket.parse(this)){const t=this.externInterfaceDeclarations();if(this.comments(),Xs.CloseBracket.parse(this)){if(this.URLList(this.MFString)){const i=new fh(this.getExecutionContext(),this.MFString);for(const e of t)i.addUserDefinedField(e.getAccessType(),e.getName(),e);i.setup();try{const t=this.getExecutionContext().getExternProtoDeclaration(e);this.getExecutionContext().updateExternProtoDeclaration(this.getExecutionContext().getUniqueExternProtoName(e),t)}catch{}return this.getExecutionContext().updateExternProtoDeclaration(e,i),!0}throw new Error(`Expected a URL list after EXTERNPROTO interface declaration '${e}'.`)}throw new Error("Expected a ']' at the end of EXTERNPROTO interface declaration.")}throw new Error("Expected a '[' at the beginning of EXTERNPROTO interface declaration.")}throw new Error("Invalid EXTERNPROTO definition name.")}return!1},externInterfaceDeclarations(){const e=[];let t;for(;t=this.externInterfaceDeclaration();)e.push(t);return e},externInterfaceDeclaration(){if(this.comments(),Xs.inputOnly.parse(this)||Xs.eventIn.parse(this)){if(this.fieldType()){const e=this.result[1];if(this.inputOnlyId()){const t=this.result[1],i=new $n[e];return i.setAccessType(d.inputOnly),i.setName(t),i}throw new Error("Expected a name for field.")}throw this.Id(),new Error(`Unknown event or field type: '${this.result[1]}'.`)}if(Xs.outputOnly.parse(this)||Xs.eventOut.parse(this)){if(this.fieldType()){const e=this.result[1];if(this.outputOnlyId()){const t=this.result[1],i=new $n[e];return i.setAccessType(d.outputOnly),i.setName(t),i}throw new Error("Expected a name for field.")}throw this.Id(),new Error(`Unknown event or field type: '${this.result[1]}'.`)}if(Xs.initializeOnly.parse(this)||Xs.field.parse(this)){if(this.fieldType()){const e=this.result[1];if(this.initializeOnlyId()){const t=this.result[1],i=new $n[e];return i.setAccessType(d.initializeOnly),i.setName(t),i}throw new Error("Expected a name for field.")}throw this.Id(),new Error(`Unknown event or field type: '${this.result[1]}'.`)}if(Xs.inputOutput.parse(this)||Xs.exposedField.parse(this)){if(this.fieldType()){const e=this.result[1];if(this.inputOutputId()){const t=this.result[1],i=new $n[e];return i.setAccessType(d.inputOutput),i.setName(t),i}throw new Error("Expected a name for field.")}throw this.Id(),new Error(`Unknown event or field type: '${this.result[1]}'.`)}return null},URLList(e){return this.mfstringValue(e)},routeStatement(){if(this.comments(),Xs.ROUTE.parse(this)){if(this.nodeNameId()){const e=this.result[1],t=this.getExecutionContext().getLocalNode(e);if(this.comments(),Xs.Period.parse(this)){if(this.outputOnlyId()){const e=this.result[1];if(this.comments(),Xs.TO.parse(this)){if(this.nodeNameId()){const i=this.result[1],n=this.getExecutionContext().getLocalNode(i);if(this.comments(),Xs.Period.parse(this)){if(this.inputOnlyId())try{const i=this.result[1];return this.getExecutionContext().addRoute(t,e,n,i),!0}catch(e){return this.throwOrWarn(e.message),!0}throw new Error("Bad ROUTE specification: Expected a field name.")}throw new Error("Bad ROUTE specification: Expected a '.' after node name.")}throw new Error("Bad ROUTE specification: Expected a node name.")}throw new Error("Bad ROUTE specification: Expected a 'TO'.")}throw new Error("Bad ROUTE specification: Expected a field name.")}throw new Error("Bad ROUTE specification: Expected a '.' after node name.")}throw new Error("Bad ROUTE specification: Expected a node name.")}return!1},node(e){if(this.nodeTypeId()){const t=this.result[1],i=this.getExecutionContext().createNode(t,!1)??this.getExecutionContext().createProto(t,!1);if(!i)throw new Error(`Unknown node type or proto '${t}', you probably have insufficient component/profile statements, and/or an inappropriate specification version.`);if(e.length){try{const t=this.getExecutionContext().getNamedNode(e);this.getExecutionContext().updateNamedNode(this.getExecutionContext().getUniqueName(e),t)}catch{}this.getExecutionContext().updateNamedNode(e,i)}if(this.comments(),Xs.OpenBrace.parse(this)){if(i.canUserDefinedFields()?this.scriptBody(i):this.nodeBody(i),this.comments(),Xs.CloseBrace.parse(this))return this.isInsideProtoDefinition()||i.setup(),i;throw new Error("Expected '}' at the end of node body.")}throw new Error("Expected '{' at the beginning of node body.")}return!1},scriptBody(e){for(;this.scriptBodyElement(e););},scriptBodyElement(e){const t=this.lastIndex,i=this.lineNumber;if(this.Id()){const t=this.accessTypes[this.result[1]];if(t&&this.fieldType()){const i=this.result[1];if(this.Id()){const r=this.result[1];if(this.comments(),Xs.IS.parse(this)){if(this.isInsideProtoDefinition()){if(this.Id()){const s=this.result[1];try{var n=this.getPrototype().getField(s)}catch{return this.throwOrWarn(`No such event or field '${s}' inside PROTO ${this.getPrototype().getName()} interface declaration.`),!0}if(d[i]===n.getType()){if(n.isReference(t)){let s=Us.try((()=>e.getUserDefinedField(r)));if(s||(s=new $n[i],e.addUserDefinedField(t,r,s)),t===s.getAccessType()&&n.getType()===s.getType())return s.addReference(n),!0;throw new Error(`Couldn't add field '${r}', field already exists with different access type or data type.`)}throw new Error(`Field '${r}' and '${n.getName()}' in PROTO '${this.getPrototype().getName()}' are incompatible as an IS mapping.`)}throw new Error(`Field '${r}' and '${n.getName()}' in PROTO '${this.getPrototype().getName()}' have different types.`)}throw new Error("No name give after IS statement.")}throw new Error("IS statement outside PROTO definition.")}}}}this.lastIndex=t,this.lineNumber=i;const r=this.interfaceDeclaration();if(r){const t=Us.try((()=>e.getUserDefinedField(r.getName())));if(t){if(t.getAccessType()===r.getAccessType()&&t.getType()===r.getType())return t.assign(r),!0;throw new Error(`Couldn't set value for field '${r.getName()}', field already exists with different access type or data type.`)}return e.addUserDefinedField(r.getAccessType(),r.getName(),r),!0}return this.nodeBodyElement(e)},nodeBody(e){for(;this.nodeBodyElement(e););},nodeBodyElement(e){if(this.protoStatement())return!0;if(this.routeStatement())return!0;if(this.Id()){const n=this.result[1];try{var t=e.getPredefinedField(n)}catch{throw new Error(`Unknown field '${n}' in class '${e.getTypeName()}'.`)}if(this.comments(),Xs.IS.parse(this)){if(this.isInsideProtoDefinition()){if(this.Id()){const e=this.result[1];try{var i=this.getPrototype().getField(e)}catch{return this.throwOrWarn(`No such event or field '${e}' inside PROTO ${this.getPrototype().getName()}`),!0}if(t.getType()===i.getType()){if(i.isReference(t.getAccessType()))return t.addReference(i),!0;throw new Error(`Field '${t.getName()}' and '${i.getName()}' in PROTO ${this.getPrototype().getName()} are incompatible as an IS mapping.`)}throw new Error(`Field '${t.getName()}' and '${i.getName()}' in PROTO ${this.getPrototype().getName()} have different types.`)}throw new Error("No name give after IS statement.")}throw new Error("IS statement outside PROTO definition.")}if(t.isInitializable()){if(this.fieldValue(t))return!0;throw new Error(`Couldn't read value for field '${n}'.`)}throw new Error(`Couldn't assign value to ${this.accessTypeToString(t.getAccessType())} field '${n}'.`)}return!1},profileNameId(){return this.Id()},componentNameId(){return this.comments(),Xs.ComponentNameId.parse(this)},categoryNameId(){return this.Id()},unitNameId(){return this.Id()},exportedNodeNameId(){return this.Id()},nodeNameId(){return this.Id()},nodeTypeId(){return this.Id()},initializeOnlyId(){return this.Id()},inputOnlyId(){return this.Id()},outputOnlyId(){return this.Id()},inputOutputId(){return this.Id()},Id(){return this.comments(),Xs.Id.parse(this)},fieldType(){return this.comments(),Xs.FieldType.parse(this)},fieldValue(e){return this[e.getType()](e,e.getUnit())},bool(){return this.comments(),Xs.TRUE.parse(this)?(this.value=!0,!0):!!Xs.FALSE.parse(this)&&(this.value=!1,!0)},double(){return this.comments(),Xs.double.parse(this)?(this.value=parseFloat(this.result[1]),!0):!!Xs.CONSTANTS.parse(this)&&(this.value=this.CONSTANTS[this.result[2].toUpperCase()],"-"===this.result[1]&&(this.value=-this.value),!0)},int32(){return this.comments(),!!Xs.int32.parse(this)&&(this.value=parseInt(this.result[1]),!0)},string(){return this.comments(),!!Xs.string.parse(this)&&(this.value=$n.SFString.unescape(this.result[1]),this.lines(this.value),!0)},sfboolValue(e){return!!this.bool()&&(e.setValue(this.value),!0)},mfboolValue(e){if(e.length=0,this.bool())return e.push(this.value),!0;if(Xs.OpenBracket.parse(this)){if(this.sfboolValues(e),Xs.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfboolValues(e){for(e.length=0,e=e.getTarget();this.bool();)e.push(this.value)},sfcolorValue(e){const t=this.lastIndex;if(this.double()){const t=this.value;if(this.double()){const i=this.value;if(this.double()){const n=this.value;return e.r=t,e.g=i,e.b=n,!0}}}if(this.lastIndex=t,this.comments(),Xs.HTMLColor.parse(this)){const t=this.convertColor(this.result[1].replace(/0x/i,"#"));return e.r=t[0],e.g=t[1],e.b=t[2],!0}return!1},mfcolorValue(e){if(e.length=0,this.sfcolorValue(this.Color3))return e.push(this.Color3),!0;if(Xs.OpenBracket.parse(this)){if(this.sfcolorValues(e),Xs.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfcolorValues(e){e.length=0,e=e.getTarget();const t=this.Color3;for(;this.sfcolorValue(t);)e.push(t)},sfcolorrgbaValue(e){const t=this.lastIndex;if(this.double()){const t=this.value;if(this.double()){const i=this.value;if(this.double()){const n=this.value;if(this.double()){const r=this.value;return e.r=t,e.g=i,e.b=n,e.a=r,!0}}}}if(this.lastIndex=t,this.comments(),Xs.HTMLColor.parse(this)){const t=this.convertColor(this.result[1].replace(/0x/i,"#"));return e.r=t[0],e.g=t[1],e.b=t[2],e.a=t[3],!0}return!1},mfcolorrgbaValue(e){if(e.length=0,this.sfcolorrgbaValue(this.Color4))return e.push(this.Color4),!0;if(Xs.OpenBracket.parse(this)){if(this.sfcolorrgbaValues(e),Xs.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfcolorrgbaValues(e){e.length=0,e=e.getTarget();const t=this.Color4;for(;this.sfcolorrgbaValue(t);)e.push(t)},sfdoubleValue(e){return!!this.double()&&(e.setValue(this.fromUnit(e.getUnit(),this.value)),!0)},mfdoubleValue(e){if(e.length=0,this.double())return e.push(this.fromUnit(e.getUnit(),this.value)),!0;if(Xs.OpenBracket.parse(this)){if(this.sfdoubleValues(e),Xs.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfdoubleValues(e){e.length=0;const t=(e=e.getTarget()).getUnit();for(;this.double();)e.push(this.fromUnit(t,this.value))},sfimageValue(e){if(this.int32()){const t=this.value;if(this.int32()){const i=this.value;if(this.int32()){const n=this.value,r=t*i;e.width=t,e.height=i,e.comp=n;const s=e.array;for(let e=0;e<r;++e){if(!this.int32())return!1;s[e]=this.value}return!0}}}return!1},mfimageValue(e){if(e.length=0,this.sfimageValue(this.SFImage))return e.push(this.SFImage),!0;if(Xs.OpenBracket.parse(this)){if(this.sfimageValues(e),Xs.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfimageValues(e){e.length=0,e=e.getTarget();const t=this.SFImage;for(;this.sfimageValue(t);)e.push(t)},sfint32Value(e){return!!this.int32()&&(e.setValue(this.value),!0)},mfint32Value(e){if(e.length=0,this.int32())return e.push(this.value),!0;if(Xs.OpenBracket.parse(this)){if(this.sfint32Values(e),Xs.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfint32Values(e){for(e.length=0,e=e.getTarget();this.int32();)e.push(this.value)},sfmatrix3Value(e){if(this.double()){const t=this.value;if(this.double()){const i=this.value;if(this.double()){const n=this.value;if(this.double()){const r=this.value;if(this.double()){const s=this.value;if(this.double()){const o=this.value;if(this.double()){const a=this.value;if(this.double()){const l=this.value;if(this.double()){const u=this.value;return e[0]=t,e[1]=i,e[2]=n,e[3]=r,e[4]=s,e[5]=o,e[6]=a,e[7]=l,e[8]=u,!0}}}}}}}}}return!1},mfmatrix3Value(e){if(e.length=0,this.sfmatrix3Value(this.Matrix3))return e.push(this.Matrix3),!0;if(Xs.OpenBracket.parse(this)){if(this.sfmatrix3Values(e),Xs.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfmatrix3Values(e){e.length=0,e=e.getTarget();const t=this.Matrix3;for(;this.sfmatrix3Value(t);)e.push(t)},sfmatrix4Value(e){if(this.double()){const t=this.value;if(this.double()){const i=this.value;if(this.double()){const n=this.value;if(this.double()){const r=this.value;if(this.double()){const s=this.value;if(this.double()){const o=this.value;if(this.double()){const a=this.value;if(this.double()){const l=this.value;if(this.double()){const u=this.value;if(this.double()){const h=this.value;if(this.double()){const d=this.value;if(this.double()){const c=this.value;if(this.double()){const p=this.value;if(this.double()){const g=this.value;if(this.double()){const f=this.value;if(this.double()){const m=this.value;return e[0]=t,e[1]=i,e[2]=n,e[3]=r,e[4]=s,e[5]=o,e[6]=a,e[7]=l,e[8]=u,e[9]=h,e[10]=d,e[11]=c,e[12]=p,e[13]=g,e[14]=f,e[15]=m,!0}}}}}}}}}}}}}}}}return!1},mfmatrix4Value(e){if(e.length=0,this.sfmatrix4Value(this.Matrix4))return e.push(this.Matrix4),!0;if(Xs.OpenBracket.parse(this)){if(this.sfmatrix4Values(e),Xs.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfmatrix4Values(e){e.length=0,e=e.getTarget();const t=this.Matrix4;for(;this.sfmatrix4Value(t);)e.push(t)},sfnodeValue(e){const t=this.nodeStatement();return!1!==t&&(e.setValue(t),!0)},mfnodeValue(e){e.length=0;const t=this.nodeStatement();if(!1!==t)return e.push(t),!0;if(Xs.OpenBracket.parse(this)){if(this.nodeStatements(e),Xs.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},nodeStatements(e){this.statements(e)},sfrotationValue(e){if(this.double()){const t=this.value;if(this.double()){const i=this.value;if(this.double()){const n=this.value;if(this.double()){const r=this.value;return e.x=t,e.y=i,e.z=n,e.angle=this.fromUnit("angle",r),!0}}}}return!1},mfrotationValue(e){if(e.length=0,this.sfrotationValue(this.Rotation4))return e.push(this.Rotation4),!0;if(Xs.OpenBracket.parse(this)){if(this.sfrotationValues(e),Xs.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfrotationValues(e){e.length=0,e=e.getTarget();const t=this.Rotation4;for(;this.sfrotationValue(t);)e.push(t)},sfstringValue(e){return!!this.string()&&(e.setValue(this.value),!0)},mfstringValue(e){if(e.length=0,this.string())return e.push(this.value),!0;if(Xs.OpenBracket.parse(this)){if(this.sfstringValues(e),Xs.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfstringValues(e){for(e.length=0,e=e.getTarget();this.string();)e.push(this.value)},sfvec2Value(e,t){if(this.double()){const i=this.value;if(this.double()){const n=this.value;return e.x=this.fromUnit(t,i),e.y=this.fromUnit(t,n),!0}}return!1},mfvec2Value(e){if(e.length=0,this.sfvec2Value(this.Vector2,e.getUnit()))return e.push(this.Vector2),!0;if(Xs.OpenBracket.parse(this)){if(this.sfvec2Values(e),Xs.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec2Values(e){e.length=0,e=e.getTarget();const t=this.Vector2,i=e.getUnit();for(;this.sfvec2Value(t,i);)e.push(t)},sfvec3Value(e,t){if(this.double()){const i=this.value;if(this.double()){const n=this.value;if(this.double()){const r=this.value;return e.x=this.fromUnit(t,i),e.y=this.fromUnit(t,n),e.z=this.fromUnit(t,r),!0}}}return!1},mfvec3Value(e){if(e.length=0,this.sfvec3Value(this.Vector3,e.getUnit()))return e.push(this.Vector3),!0;if(Xs.OpenBracket.parse(this)){if(this.sfvec3Values(e),Xs.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec3Values(e){e.length=0,e=e.getTarget();const t=this.Vector3,i=e.getUnit();for(;this.sfvec3Value(t,i);)e.push(t)},sfvec4Value(e,t){if(this.double()){const i=this.value;if(this.double()){const n=this.value;if(this.double()){const r=this.value;if(this.double()){const s=this.value;return e.x=this.fromUnit(t,i),e.y=this.fromUnit(t,n),e.z=this.fromUnit(t,r),e.w=this.fromUnit(t,s),!0}}}}return!1},mfvec4Value(e){if(e.length=0,this.sfvec4Value(this.Vector4,e.getUnit()))return e.push(this.Vector4),!0;if(Xs.OpenBracket.parse(this)){if(this.sfvec4Values(e),Xs.CloseBracket.parse(this))return!0;throw new Error("Expected ']'.")}return!1},sfvec4Values(e){e.length=0,e=e.getTarget();const t=this.Vector4,i=e.getUnit();for(;this.sfvec4Value(t,i);)e.push(t)},accessTypeToString(e){switch(e){case d.initializeOnly:return"initializeOnly";case d.inputOnly:return"inputOnly";case d.outputOnly:return"outputOnly";case d.inputOutput:return"inputOutput"}}}),Object.assign(js.prototype,{[d.SFBool]:js.prototype.sfboolValue,[d.SFColor]:js.prototype.sfcolorValue,[d.SFColorRGBA]:js.prototype.sfcolorrgbaValue,[d.SFDouble]:js.prototype.sfdoubleValue,[d.SFFloat]:js.prototype.sfdoubleValue,[d.SFImage]:js.prototype.sfimageValue,[d.SFInt32]:js.prototype.sfint32Value,[d.SFMatrix3f]:js.prototype.sfmatrix3Value,[d.SFMatrix3d]:js.prototype.sfmatrix3Value,[d.SFMatrix4f]:js.prototype.sfmatrix4Value,[d.SFMatrix4d]:js.prototype.sfmatrix4Value,[d.SFNode]:js.prototype.sfnodeValue,[d.SFRotation]:js.prototype.sfrotationValue,[d.SFString]:js.prototype.sfstringValue,[d.SFTime]:js.prototype.sfdoubleValue,[d.SFVec2d]:js.prototype.sfvec2Value,[d.SFVec2f]:js.prototype.sfvec2Value,[d.SFVec3d]:js.prototype.sfvec3Value,[d.SFVec3f]:js.prototype.sfvec3Value,[d.SFVec4d]:js.prototype.sfvec4Value,[d.SFVec4f]:js.prototype.sfvec4Value,[d.MFBool]:js.prototype.mfboolValue,[d.MFColor]:js.prototype.mfcolorValue,[d.MFColorRGBA]:js.prototype.mfcolorrgbaValue,[d.MFDouble]:js.prototype.mfdoubleValue,[d.MFFloat]:js.prototype.mfdoubleValue,[d.MFImage]:js.prototype.mfimageValue,[d.MFInt32]:js.prototype.mfint32Value,[d.MFMatrix3d]:js.prototype.mfmatrix3Value,[d.MFMatrix3f]:js.prototype.mfmatrix3Value,[d.MFMatrix4d]:js.prototype.mfmatrix4Value,[d.MFMatrix4f]:js.prototype.mfmatrix4Value,[d.MFNode]:js.prototype.mfnodeValue,[d.MFRotation]:js.prototype.mfrotationValue,[d.MFString]:js.prototype.mfstringValue,[d.MFTime]:js.prototype.mfdoubleValue,[d.MFVec2d]:js.prototype.mfvec2Value,[d.MFVec2f]:js.prototype.mfvec2Value,[d.MFVec3d]:js.prototype.mfvec3Value,[d.MFVec3f]:js.prototype.mfvec3Value,[d.MFVec4d]:js.prototype.mfvec4Value,[d.MFVec4f]:js.prototype.mfvec4Value}),ce.prototype.fromString=function(e,t){const i=new js(t);if(i.setUnits(!!t),i.setInput(e),!i.fieldValue(this))throw new Error(`Couldn't read value for field '${this.getName()}'.`)};const ks=js;i.add("VRMLParser","x_ite/Parser/VRMLParser",ks);const zs=ks;var Gs=n(328);const Hs={initializeOnly:d.initializeOnly,inputOnly:d.inputOnly,outputOnly:d.outputOnly,inputOutput:d.inputOutput};function qs(e){Fs.call(this,e),this.protoDeclarations=[],this.parents=[],this.parser=new zs(e),this.url=new $n.MFString,this.protoNames=new Map,this.protoFields=new WeakMap}Object.assign(Object.setPrototypeOf(qs.prototype,Fs.prototype),{getEncoding:()=>"XML",setInput(e){try{"string"==typeof e&&(e=Gs.parseXML(e)),this.input=e,this.xml=this.isXML(e),this.xml||Object.assign(this,Ys)}catch{this.input=void 0}},isValid(){return this.input instanceof XMLDocument||this.input instanceof HTMLElement||null===this.input},isXML:e=>!(e instanceof HTMLElement),parseIntoScene(e,t){this.resolve=e,this.reject=t,this.getScene().setEncoding("XML"),this.getScene().setProfile(this.getBrowser().getProfile("Full")),this.xmlElement(this.input)},xmlElement(e){if(null===e)return this.resolve?.(this.getScene());switch(e.nodeName){case"#document":{const t=Gs(e).children("X3D");if(t.length)for(const e of t)this.x3dElement(e);else this.resolve?this.loadComponents().then((()=>{this.childrenElements(e),this.resolve(this.getScene())})).catch(this.reject):this.childrenElements(e);break}case"X3D":this.x3dElement(e);break;case"Scene":case"SCENE":this.resolve?this.loadComponents().then((()=>{this.sceneElement(e),this.resolve(this.getScene())})).catch(this.reject):this.sceneElement(e);break;default:this.resolve?this.loadComponents().then((()=>{this.childrenElements(e),this.resolve(this.getScene())})).catch(this.reject):this.childrenElements(e)}},x3dElement(e){try{const t=e.getAttribute("profile"),i=this.getBrowser().getProfile(t||"Full");Gs.data(this.scene,"X3D",e),this.getScene().setProfile(i)}catch(e){console.error(e)}const t=e.getAttribute("version");t&&this.getScene().setSpecificationVersion(t);for(const t of e.childNodes)this.x3dElementChildHead(t);if(this.xml||this.headElement(e),this.resolve)this.loadComponents().then((()=>{for(const t of e.childNodes)this.x3dElementChildScene(t);this.resolve(this.getScene())})).catch(this.reject);else for(const t of e.childNodes)this.x3dElementChildScene(t)},x3dElementChildHead(e){switch(e.nodeName){case"head":case"HEAD":return void this.headElement(e)}},x3dElementChildScene(e){switch(e.nodeName){case"Scene":case"SCENE":return void this.sceneElement(e)}},headElement(e){for(const t of e.childNodes)this.headElementChild(t)},headElementChild(e){switch(e.nodeName){case"component":case"COMPONENT":return void this.componentElement(e);case"unit":case"UNIT":return void this.unitElement(e);case"meta":case"META":return void this.metaElement(e)}},componentElement(e){try{const t=e.getAttribute("name"),i=parseInt(e.getAttribute("level"));if(null===t)return console.warn("XML Parser Error: Bad component statement. Expected name attribute.");if(null===i)return console.warn("XML Parser Error: Bad component statement. Expected level attribute.");const n=this.getBrowser().getComponent(t,i);this.getScene().updateComponent(n)}catch(e){console.log(e.message)}},unitElement(e){const t=e.getAttribute("category"),i=e.getAttribute("name"),n=e.getAttribute("conversionFactor");return null===t?console.warn("XML Parser Error: Bad unit statement. Expected category attribute."):null===i?console.warn("XML Parser Error: Bad unit statement. Expected name attribute."):null===n?console.warn("XML Parser Error: Bad unit statement. Expected conversionFactor attribute."):void this.getScene().updateUnit(t,i,parseFloat(n))},metaElement(e){const t=e.getAttribute("name"),i=e.getAttribute("content");return null===t?console.warn("XML Parser Error: Bad meta statement. Expected name attribute."):null===i?console.warn("XML Parser Error: Bad meta statement. Expected content attribute."):void this.getScene().addMetaData(t,i)},sceneElement(e){Gs.data(e,"node",this.scene),this.childrenElements(e)},childrenElements(e){for(const t of e.childNodes)this.childElement(t)},childElement(e){switch(e.nodeName){case"#comment":case"#text":return;case"#cdata-section":return void this.cdataNode(e);case"ExternProtoDeclare":case"EXTERNPROTODECLARE":return void this.externProtoDeclareElement(e);case"ProtoDeclare":case"PROTODECLARE":return void this.protoDeclareElement(e);case"IS":return void this.isElement(e);case"ProtoInstance":case"PROTOINSTANCE":return void this.protoInstanceElement(e);case"fieldValue":case"FIELDVALUE":return void this.fieldValueElement(e);case"field":case"FIELD":return void this.fieldElement(e);case"ROUTE":return void this.routeElement(e);case"IMPORT":return void this.importElement(e);case"EXPORT":return void this.exportElement(e);default:return void this.nodeElement(e)}},externProtoDeclareElement(e){const t=e.getAttribute("name");if(this.id(t)){const i=e.getAttribute("url");this.parser.setInput(i??""),this.parser.sfstringValues(this.url),this.url.length||console.warn("XML Parser Error: Bad ExternProtoDeclare statement. Expected url attribute with value.");const n=new fh(this.getExecutionContext(),this.url);this.pushParent(n),this.protoInterfaceElement(e),this.popParent(),this.addProtoFieldNames(n),n.setup();try{const e=this.getExecutionContext().getExternProtoDeclaration(t);this.getExecutionContext().updateExternProtoDeclaration(this.getExecutionContext().getUniqueExternProtoName(t),e)}catch{}this.getExecutionContext().updateExternProtoDeclaration(t,n),this.addProtoName(t)}},protoDeclareElement(e){const t=e.getAttribute("name");if(this.id(t)){const i=new Bs(this.getExecutionContext());for(const t of e.childNodes){switch(t.nodeName){case"ProtoInterface":case"PROTOINTERFACE":this.pushParent(i),this.protoInterfaceElement(t),this.popParent(),this.addProtoFieldNames(i);break;default:continue}break}for(const t of e.childNodes){switch(t.nodeName){case"ProtoBody":case"PROTOBODY":this.pushPrototype(i),this.pushExecutionContext(i.getBody()),this.pushParent(i),this.protoBodyElement(t),this.popParent(),this.popExecutionContext(),this.popPrototype();break;default:continue}break}i.setup();try{const e=this.getExecutionContext().getProtoDeclaration(t);this.getExecutionContext().updateProtoDeclaration(this.getExecutionContext().getUniqueProtoName(t),e)}catch{}this.getExecutionContext().updateProtoDeclaration(t,i),this.addProtoName(t)}},protoInterfaceElement(e){for(const t of e.childNodes)this.protoInterfaceElementChild(t)},protoInterfaceElementChild(e){switch(e.nodeName){case"field":case"FIELD":return void this.fieldElement(e)}},fieldElement(e){try{if(0===this.getParents().length)return;const t=this.getParent();if(!(t instanceof pr))return;if(!t.canUserDefinedFields())return;const i=Hs[e.getAttribute("accessType")]||d.initializeOnly,n=$n[e.getAttribute("type")];if(!n)return;const r=e.getAttribute("name");if(!this.id(r))return;const s=new n;i&d.initializeOnly&&(this.fieldValue(s,e.getAttribute("value")),this.pushParent(s),this.childrenElements(e),this.popParent()),t.addUserDefinedField(i,r,s)}catch(e){console.error(e)}},protoBodyElement(e){this.childrenElements(e)},isElement(e){if(this.isInsideProtoDefinition())for(const t of e.childNodes)this.isElementChild(t)},isElementChild(e){switch(e.nodeName){case"connect":case"CONNECT":return void this.connectElement(e)}},connectElement(e){const t=e.getAttribute("nodeField"),i=e.getAttribute("protoField");if(null===t)return console.warn("XML Parser Error: Bad connect statement. Expected nodeField attribute.");if(null===i)return console.warn("XML Parser Error: Bad connect statement. Expected protoField attribute.");try{if(0===this.getParents().length)return;const e=this.getParent(),n=this.getPrototype();if(!(e instanceof Sr))return;const r=e.getField(t),s=n.getField(i);if(r.getType()!==s.getType())throw new Error(`Field '${r.getName()}' and '${s.getName()}' in PROTO ${this.proto.getName()} have different types.`);if(!s.isReference(r.getAccessType()))throw new Error(`Field '${r.getName()}' and '${s.getName()}' in PROTO ${n.getName()} are incompatible as an IS mapping.`);r.addReference(s)}catch(e){console.warn(`XML Parser Error: Couldn't create IS reference. ${e.message}`)}},protoInstanceElement(e){try{if(this.useAttribute(e))return;const t=e.getAttribute("name");if(this.id(t)){const i=this.getExecutionContext().createProto(t,!1);if(!i)throw new Error(`Unknown proto or externproto type '${t}'.`);Gs.data(e,"node",i),this.defAttribute(e,i),this.addNode(e,i),this.pushParent(i),this.childrenElements(e),this.isInsideProtoDefinition()||i.setup(),this.popParent()}}catch(e){console.warn("XML Parser Error: ",e.message)}},fieldValueElement(e){try{if(0===this.getParents().length)return;const t=this.getParent(),i=e.getAttribute("name");if(!(t instanceof Wh))return;if(!this.id(i))return;const n=t.getField(i);n.getAccessType()&d.initializeOnly&&(n.getType()===d.MFNode&&(n.length=0),this.fieldValue(n,e.getAttribute("value")),this.pushParent(n),this.childrenElements(e),this.popParent())}catch(e){console.warn(`XML Parser Error: Couldn't assign field value. ${e.message}`)}},nodeElement(e){try{if(this.useAttribute(e))return;const t=this.getExecutionContext().createNode(this.nodeNameToCamelCase(e.nodeName),!1)??this.getExecutionContext().createProto(this.protoNameToCamelCase(e.nodeName),!1);if(!t)throw new Error(`Unknown node type '${e.nodeName}', you probably have insufficient component/profile statements and/or an inappropriate specification version.`);Gs.data(e,"node",t),"SCRIPT"===e.nodeName&&this.scriptElement(e),this.defAttribute(e,t),this.addNode(e,t),this.pushParent(t),this.nodeAttributes(e,t),this.childrenElements(e),this.isInsideProtoDefinition()||t.setup(),this.popParent()}catch(t){if("NULL"==e.nodeName)return void this.addNode(e,null);console.error(`XML Parser Error: ${t.message}`)}},scriptElement(e){const t=(new DOMParser).parseFromString(e.outerHTML,"application/xml").children[0].childNodes;e.textContent="// Content moved into childNodes.";for(const i of t)1!==i.nodeType&&4!==i.nodeType||e.appendChild(i)},routeElement(e){try{const t=e.getAttribute("fromNode"),i=e.getAttribute("fromField"),n=e.getAttribute("toNode"),r=e.getAttribute("toField");if(null===t)throw new Error("Bad ROUTE statement: Expected fromNode attribute.");if(null===i)throw new Error("Bad ROUTE statement: Expected fromField attribute.");if(null===n)throw new Error("Bad ROUTE statement: Expected toNode attribute.");if(null===r)throw new Error("Bad ROUTE statement: Expected toField attribute.");const s=this.getExecutionContext(),o=s.getLocalNode(t),a=s.getLocalNode(n),l=s.addRoute(o,i,a,r);Gs.data(e,"node",l)}catch(e){console.warn(`XML Parser Error: ${e.message}`)}},importElement(e){try{const t=e.getAttribute("inlineDEF"),i=e.getAttribute("importedDEF")||e.getAttribute("exportedDEF"),n=e.getAttribute("AS")||i;if(null===t)throw new Error("Bad IMPORT statement: Expected inlineDEF attribute.");if(null===i)throw new Error("Bad IMPORT statement: Expected importedDEF attribute.");const r=this.getExecutionContext().getNamedNode(t);this.getExecutionContext().updateImportedNode(r,i,n)}catch(e){console.warn(`XML Parser Error: ${e.message}`)}},exportElement(e){try{if(this.getScene()!==this.getExecutionContext())return void console.warn("XML Parser Error: Export statement not allowed here.");const t=e.getAttribute("localDEF"),i=e.getAttribute("AS")||t;if(null===t)throw new Error("Bad EXPORT statement: Expected localDEF attribute.");const n=this.getExecutionContext().getLocalNode(t);this.getScene().updateExportedNode(i,n)}catch(e){console.warn(`XML Parser Error: ${e.message}`)}},cdataNode(e){if(0===this.getParents().length)return;const t=this.getParent();t instanceof Sr&&t.getSourceText()?.push(e.data)},useAttribute(e){try{const t=e.getAttribute("USE");if(this.id(t)){const i=this.getExecutionContext().getNamedNode(t);return this.addNode(e,i.getValue()),!0}}catch(e){console.warn(`Invalid USE name: ${e.message}`)}return!1},defAttribute(e,t){try{const i=e.getAttribute("DEF");if(i){try{const e=this.getExecutionContext().getNamedNode(i);this.getExecutionContext().updateNamedNode(this.getExecutionContext().getUniqueName(i),e)}catch{}this.getExecutionContext().updateNamedNode(i,t)}}catch(e){console.warn(`Invalid DEF name: ${e.message}`)}},nodeAttributes(e,t){for(const i of e.attributes)this.nodeAttribute(i,t)},nodeAttribute(e,t){try{const i=t.getPredefinedField(this.attributeToCamelCase(t,e.name));i.isInitializable()&&this.fieldValue(i,e.value)}catch(e){}},fieldValue(e,t){null!==t&&(this.parser.pushExecutionContext(this.getExecutionContext()),this.parser.setInput(t),this[e.getType()].call(this.parser,e,e.getUnit()),this.parser.popExecutionContext())},id:e=>null!==e&&0!==e.length,getParents(){return this.parents},getParent(){return this.parents.at(-1)},pushParent(e){return this.parents.push(e)},popParent(){this.parents.pop()},addNode(e,t){if(0===this.parents.length||this.getParent()instanceof Bs)return void this.getExecutionContext().rootNodes.push(t);const i=this.getParent();if(i instanceof ce)switch(i.getType()){case d.SFNode:return void i.setValue(t);case d.MFNode:return void i.push(t)}else try{const n=e.getAttribute("containerField")||t?.getContainerField(this.getExecutionContext().getSpecificationVersion());if(!n)return void console.warn("Node must have a container field attribute.");const r=i.getField(n);switch(r.getType()){case d.SFNode:return void r.setValue(t);case d.MFNode:return void r.push(t)}}catch(i){t?.getType().includes(d.X3DMetadataObject)&&(e.setAttribute("containerField","metadata"),this.addNode(e,t))}},addProtoName(e){},addProtoFieldNames(e){},protoNameToCamelCase:e=>e,nodeNameToCamelCase:e=>e,attributeToCamelCase:(e,t)=>t}),Object.assign(qs.prototype,{[d.SFBool]:zs.prototype.sfboolValue,[d.SFColor]:zs.prototype.sfcolorValue,[d.SFColorRGBA]:zs.prototype.sfcolorrgbaValue,[d.SFDouble]:zs.prototype.sfdoubleValue,[d.SFFloat]:zs.prototype.sfdoubleValue,[d.SFImage]:zs.prototype.sfimageValue,[d.SFInt32]:zs.prototype.sfint32Value,[d.SFMatrix3f]:zs.prototype.sfmatrix3Value,[d.SFMatrix3d]:zs.prototype.sfmatrix3Value,[d.SFMatrix4f]:zs.prototype.sfmatrix4Value,[d.SFMatrix4d]:zs.prototype.sfmatrix4Value,[d.SFNode](e){e.setValue(null)},[d.SFRotation]:zs.prototype.sfrotationValue,[d.SFString](e){e.setValue($n.SFString.unescape(this.input))},[d.SFTime]:zs.prototype.sfdoubleValue,[d.SFVec2d]:zs.prototype.sfvec2Value,[d.SFVec2f]:zs.prototype.sfvec2Value,[d.SFVec3d]:zs.prototype.sfvec3Value,[d.SFVec3f]:zs.prototype.sfvec3Value,[d.SFVec4d]:zs.prototype.sfvec4Value,[d.SFVec4f]:zs.prototype.sfvec4Value,[d.MFBool]:zs.prototype.sfboolValues,[d.MFColor]:zs.prototype.sfcolorValues,[d.MFColorRGBA]:zs.prototype.sfcolorrgbaValues,[d.MFDouble]:zs.prototype.sfdoubleValues,[d.MFFloat]:zs.prototype.sfdoubleValues,[d.MFImage]:zs.prototype.sfimageValues,[d.MFInt32]:zs.prototype.sfint32Values,[d.MFMatrix3d]:zs.prototype.sfmatrix3Values,[d.MFMatrix3f]:zs.prototype.sfmatrix3Values,[d.MFMatrix4d]:zs.prototype.sfmatrix4Values,[d.MFMatrix4f]:zs.prototype.sfmatrix4Values,[d.MFNode](e){e.length=0},[d.MFRotation]:zs.prototype.sfrotationValues,[d.MFString]:zs.prototype.sfstringValues,[d.MFTime]:zs.prototype.sfdoubleValues,[d.MFVec2d]:zs.prototype.sfvec2Values,[d.MFVec2f]:zs.prototype.sfvec2Values,[d.MFVec3d]:zs.prototype.sfvec3Values,[d.MFVec3f]:zs.prototype.sfvec3Values,[d.MFVec4d]:zs.prototype.sfvec4Values,[d.MFVec4f]:zs.prototype.sfvec4Values});const Ys={addProtoName(e){this.protoNames.set(e,e),this.protoNames.set(e.toUpperCase(),e)},addProtoFieldNames:(()=>{const e=new Set;for(const t of["DEF","USE","containerField"])e.add(t).add(t.toLowerCase());return function(t){const i=new Map;this.protoFields.set(t,i);for(const{name:n}of t.getFieldDefinitions())e.has(n)||(i.set(n,n),i.set(n.toLowerCase(),n))}})(),protoNameToCamelCase(e){return this.protoNames.get(e)},nodeNameToCamelCase:e=>Qn.getNodeTypeName(e),attributeToCamelCase(e,t){return e instanceof Wh?this.protoFields.get(e.getProtoNode()).get(t):Qn.getFieldName(t)}},Ws=qs;i.add("XMLParser","x_ite/Parser/XMLParser",Ws);const $s=Ws;function Js(e){Fs.call(this,e),this.namespace="http://www.web3d.org/specifications/x3d-namespace"}Object.assign(Object.setPrototypeOf(Js.prototype,Fs.prototype),{getEncoding:()=>"JSON",setInput(e){try{"string"==typeof e&&(e=JSON.parse(e)),this.input=e}catch{this.input=void 0}},isValid(){return this.input instanceof Object},parseIntoScene(e,t){const i=this.createElement("X3D");this.convertToDOM(this.input,"",i);const n=new $s(this.getScene());n.setInput(i),n.parseIntoScene(e,t),this.getScene().setEncoding("JSON")},elementSetAttribute(e,t,i){switch(t){case"SON schema":case"ncoding":break;default:"function"==typeof e.setAttribute&&e.setAttribute(t,i)}},convertChildren(e,t,i){for(const n in t)"object"==typeof t[n]&&(isNaN(parseInt(n))?this.convertObject(n,t,i,e.substr(1)):this.convertToDOM(t[n],n,i,e.substr(1)))},createElement(e,t){if(void 0===this.namespace)var i=document.createElement(e);else null==(i=document.createElementNS(this.namespace,e))&&(console.error("Trouble creating element for",e),i=document.createElement(e));return void 0!==t&&this.elementSetAttribute(i,"containerField",t),i},createCDATA(e,t,i){const n=(new DOMParser).parseFromString("<xml></xml>","application/xml").createCDATASection(i);t.appendChild(n)},convertObject(e,t,i,n){if(null!==t&&"object"==typeof t[e])if("@"===e.substr(0,1))this.convertToDOM(t[e],e,i);else if("-"===e.substr(0,1))this.convertChildren(e,t[e],i);else if("#comment"===e)for(const n in t[e]){const r=document.createComment(this.commentStringToXML(t[e][n]));i.appendChild(r)}else if("#sourceCode"===e||"@sourceCode"===e||"#sourceText"===e)this.createCDATA(document,i,t[e].join("\n"));else if("connect"===e||"fieldValue"===e||"field"===e||"meta"===e||"component"===e||"unit"===e){for(const r in t[e])if("object"==typeof t[e][r]){const s=this.createElement(e,n);this.convertToDOM(t[e][r],r,s),i.appendChild(s),i.appendChild(document.createTextNode("\n"))}}else{const r=this.createElement(e,n);this.convertToDOM(t[e],e,r),i.appendChild(r),i.appendChild(document.createTextNode("\n"))}},commentStringToXML:e=>e.replace(/\\\\/g,"\\"),SFStringToXML:e=>e.replace(/([\\"])/g,"\\$1"),JSONStringToXML:e=>e=(e=e.replace(/\\/g,"\\\\")).replace(/\n/g,"\\n"),convertToDOM(e,t,i,n){let r=!1,s=[],o=!1;for(const t in e)if(r=!isNaN(parseInt(t)),r)switch(typeof e[t]){case"number":case"boolean":s.push(e[t]);break;case"string":s.push(e[t]),o=!0;break;case"object":this.convertToDOM(e[t],t,i);break;case"undefined":break;default:console.error("Unknown type found in array "+typeof e[t])}else switch(typeof e[t]){case"object":"X3D"===t?this.convertToDOM(e[t],t,i):this.convertObject(t,e,i,n);break;case"number":case"boolean":this.elementSetAttribute(i,t.substr(1),e[t]);break;case"string":if("#comment"!==t)this.elementSetAttribute(i,t.substr(1),this.JSONStringToXML(e[t]));else{const n=document.createComment(this.commentStringToXML(e[t]));i.appendChild(n)}break;case"undefined":break;default:console.error("Unknown type found in object "+typeof e[t]),console.error(e)}if(r){if("@"===t.substr(0,1))if(o){o=!1;for(const e in s)s[e]=this.SFStringToXML(s[e]);this.elementSetAttribute(i,t.substr(1),'"'+s.join('" "')+'"')}else this.elementSetAttribute(i,t.substr(1),s.join(" "));r=!1}return i}});const Ks=Js;i.add("JSONParser","x_ite/Parser/JSONParser",Ks);const Zs=Ks;function Qs(){}Object.assign(Qs.prototype,{removeGroups:!1,removeEmptyGroups:!1,combineGroupingNodes:!1,optimizeInterpolators:!1,optimizeSceneGraph(e){const t=[];e.setValue(this.optimizeNodes(e,!0,t)),t.forEach((e=>e.dispose()))},optimizeNodes(e,t,i){return[...e].flatMap((e=>this.optimizeNode(e,t,i)))},optimizeNode(e,t,i){if(!e)return[];switch(this.optimizeInterpolators&&this.removeInterpolatorsWithOnlyOneValue(e,i),e.getNodeTypeName()){case"Transform":e.children=this.optimizeNodes(e.children,!0,i);break;case"Anchor":case"Group":if(e.children=this.optimizeNodes(e.children,!0,i),this.removeEmptyGroups&&0===e.children.length)return[];if(this.removeGroups)break;return e;case"Collision":case"LOD":case"Switch":return this.optimizeNodes(e.children,!1,i),e;case"HAnimJoint":case"HAnimSegment":case"HAnimSite":return e.children=this.optimizeNodes(e.children,!0,i),e;case"HAnimHumanoid":return e.skeleton=this.optimizeNodes(e.skeleton,!0,i),e.skin=this.optimizeNodes(e.skin,!0,i),e;default:return e}if(!t)return e;if(this.removeEmptyGroups&&0===e.children.length)return[];if(!this.combineGroupingNodes)return e;if(e.getValue().hasRoutes())return e;if("Transform"===e.getNodeTypeName()){if(e=this.combineSingleChild(e,i),!e.translation?.getValue().equals(Tt.Zero))return e;if(!e.rotation?.getValue().equals(ui.Identity))return e;if(!e.scale?.getValue().equals(Tt.One))return e}return e.children?(i.push(e),[...e.children]):e},removeInterpolatorsWithOnlyOneValue(e,t){for(const i of e.getValue().getFields()){if(1!==i.getInputRoutes().size)continue;const n=Array.from(i.getInputRoutes())[0],r=n.sourceNode;r.getNodeType().includes(d.X3DInterpolatorNode)&&(1===r.key.length&&(e[n.destinationField]=r.keyValue[0],t.push(r),n.dispose()))}},combineSingleChild(e,t){if(1!==e.children.length)return e;const i=e.children[0];if(i.getValue().getCloneCount()>1)return e;if(i.getValue().hasRoutes())return e;switch(i.getNodeTypeName()){case"Transform":case"HAnimHumanoid":return this.combineTransform(e,i,t);case"DirectionalLight":case"PointLight":case"SpotLight":return this.combineLight(e,i,t);default:return e}},combineTransform(e,t,i){const n=new Tt(0,0,0),r=new ui,s=new Tt(1,1,1),o=new ui,a=new gi,l=new gi;if(a.set(e.translation.getValue(),e.rotation.getValue(),e.scale.getValue(),e.scaleOrientation.getValue(),e.center.getValue()),l.set(t.translation.getValue(),t.rotation.getValue(),t.scale.getValue(),t.scaleOrientation.getValue(),t.center.getValue()),a.multLeft(l),a.get(n,r,s,o,t.center.getValue()),t.translation=n,t.rotation=r,t.scale=s,t.scaleOrientation=o,!t.getNodeTypeName()&&e.getNodeTypeName()){const i=t.getExecutionContext();i.addNamedNode(i.getUniqueName(e.getNodeTypeName()),t)}return i.push(e),t},combineLight(e,t,i){const n=new gi;return n.set(e.translation.getValue(),e.rotation.getValue(),e.scale.getValue(),e.scaleOrientation.getValue(),e.center.getValue()),t.location&&(t.location=n.multVecMatrix(t.location.getValue())),t.direction&&(t.direction=n.multDirMatrix(t.direction.getValue()).normalize()),i.push(e),t}});const eo=Qs;i.add("X3DOptimizer","x_ite/Parser/X3DOptimizer",eo);const to=eo,io={get ENVIRONMENT(){return"MODULE"}};i.add("Features","x_ite/Features",io);const no=io,ro={getScriptURL:(()=>{switch(no.ENVIRONMENT){case"NODE":var e=n.g.require("url").pathToFileURL(__filename).href;break;case"BROWSER":e=document.currentScript?.src??document.location.href;break;case"MODULE":e=import.meta.url}return function(){return e}})(),getProviderURL(e){return e?(this.getScriptURL().match(/\.min\.js$/)&&(e+=".min"),new URL("assets/components/"+e+".js",this.getScriptURL()).href):"https://create3000.github.io/x_ite/"},getFontsURL(e){return new URL("assets/fonts/"+e,this.getScriptURL()).href},getLinetypeURL(){return new URL("assets/linetype/linetypes.png",this.getScriptURL()).href},getHatchingURL(e){return new URL("assets/hatching/"+e+".png",this.getScriptURL()).href},getLibraryURL(e){return new URL("assets/lib/"+e,this.getScriptURL()).href}};i.add("URLs","x_ite/Browser/Networking/URLs",ro);const so=ro;var oo=n(328);function ao(e){Fs.call(this,e),to.call(this),this.removeGroups=!1,this.removeEmptyGroups=!0,this.combineGroupingNodes=!0,this.optimizeInterpolators=!0,this.extensions=new Set,this.lights=[],this.envLights=[],this.usedLights=0,this.buffers=[],this.bufferViews=[],this.accessors=[],this.samplers=[],this.materials=[],this.defaultAppearance=[],this.textureTransformNodes=[],this.meshes=[],this.cameras=[],this.viewpoints=0,this.nodes=[],this.skins=[],this.joints=new Set,this.animations=0}Object.assign(Object.setPrototypeOf(ao.prototype,Fs.prototype),to.prototype,{getEncoding:()=>"JSON",setInput(e){try{"string"==typeof e&&(e=JSON.parse(e)),this.input=e}catch{this.input=void 0}},isValid:(()=>{const e=new Set(["asset","extra","extensions","extensionsRequired","extensionsUsed","buffers","bufferViews","accessors","samplers","images","textures","materials","meshes","cameras","skins","nodes","scenes","scene","animations"]);return function(){if(!(this.input instanceof Object))return!1;if(!Object.keys(this.input).every((t=>e.has(t))))return!1;const t=this.input.asset;return t instanceof Object&&"2.0"===t.version}})(),setBuffers(e){this.buffers=e},parseIntoScene(e,t){this.rootObject(this.input).then(e).catch(t)},rootObject:async function(e){if(!(e instanceof Object))return;const t=this.getBrowser(),i=this.getScene();i.setEncoding("GLTF"),i.setProfile(t.getProfile("Interchange")),e.skins&&i.addComponent(t.getComponent("HAnim")),this.assetObject(e.asset),this.extensionsArray(e.extensionsUsed,this.extensions),this.extensionsArray(e.extensionsRequired,this.extensions),this.extensionsObject(e.extensions),await this.loadComponents(),await this.buffersArray(e.buffers),this.extensions.has("KHR_draco_mesh_compression")&&(this.draco=await this.createDraco()),this.bufferViewsArray(e.bufferViews),this.accessorsArray(e.accessors),this.samplersArray(e.samplers),await this.imagesArray(e.images),this.texturesArray(e.textures),this.materialsArray(e.materials),this.meshesArray(e.meshes),this.camerasArray(e.cameras),this.skinsArray(e.skins),this.nodesArray(e.nodes),this.scenesArray(e.scenes,e.scene),this.animationsArray(e.animations);try{this.optimizeSceneGraph(this.getExecutionContext().getRootNodes())}catch(e){console.error(e)}return this.getScene()},assetObject(e){if(!(e instanceof Object))return;const t=this.getExecutionContext(),i=t.getWorldURL(),n=t.createNode("WorldInfo",!1);for(const[t,i]of Object.entries(e))"string"==typeof i&&n._info.push(`${t}: ${i}`);if(e.extras instanceof Object)for(const[t,i]of Object.entries(e.extras))"string"==typeof i&&("title"===t?n._title=i:n._info.push(`${t}: ${i}`));n._info.sort(),n._title.getValue()||(n._title=decodeURI(new URL(i).pathname.split("/").at(-1)||i)),n.setup(),t.getRootNodes().push(n)},extensionsArray(e,t){if(!(e instanceof Array))return;const i=this.getBrowser(),n=this.getExecutionContext();for(const r of e)switch(t.add(r),r){case"EXT_lights_image_based":{const e=i.getComponent("CubeMapTexturing",3);n.hasComponent(e)||n.addComponent(e);break}case"KHR_texture_transform":{const e=i.getComponent("Texturing3D",2);n.hasComponent(e)||n.addComponent(e);break}}},extensionsObject(e){if(e instanceof Object)for(const[t,i]of Object.entries(e))switch(t){case"KHR_lights_punctual":return this.khrLightsPunctualObject(i);case"EXT_lights_image_based":return this.extLightsImageBasedObject(i)}},khrLightsPunctualObject(e){e instanceof Object&&this.lightsArray(e.lights)},lightsArray(e){e instanceof Array&&(this.lights=e)},lightObject(e,t=this.lights[e]){if(!(t instanceof Object))return null;if(t.node)return t.node;const i=this.lightType(t);if(!i)return null;const n=this.getExecutionContext(),r=this.sanitizeName(t.name)||`Light${e}`,s=new Fe(1,1,1);return this.vectorValue(t.color,s)&&(i._color=s),i._global=!0,i._intensity=this.numberValue(t.intensity,1),i.setup(),n.addNamedNode(n.getUniqueName(r),i),n.addExportedNode(n.getUniqueExportName(r),i),t.node=i},lightType(e){switch(e.type){case"directional":return this.directionalLight(e);case"spot":return this.spotLight(e);case"point":return this.pointLight(e)}},directionalLight(e){return this.getExecutionContext().createNode("DirectionalLight",!1)},spotLight(e){const t=this.getExecutionContext().createNode("SpotLight",!1);return t._radius=this.numberValue(e.range,0)||-1,t._cutOffAngle=this.numberValue(e.outerConeAngle,Math.PI/4),t._beamWidth=this.numberValue(e.innerConeAngle,0),t._attenuation=new Tt(0,0,1),t},pointLight(e){const t=this.getExecutionContext().createNode("PointLight",!1);return t._radius=this.numberValue(e.range,0)||-1,t._attenuation=new Tt(0,0,1),t},extLightsImageBasedObject(e){e instanceof Object&&this.envLightsArray(e.lights)},envLightsArray(e){e instanceof Array&&(this.envLights=e)},envLightObject(e,t=this.envLights[e]){if(!(t instanceof Object))return null;if(t.node)return t.node;const i=this.getExecutionContext(),n=i.createNode("EnvironmentLight",!1),r=`EnvironmentLight${e}`,s=new Kt(0,0,0,1);if(i.addNamedNode(i.getUniqueName(r),n),i.addExportedNode(i.getUniqueExportName(r),n),n._global=!1,n._intensity=this.numberValue(t.intensity,1),this.vectorValue(n.rotation,s)&&(n._rotation=new ui(s)),t.irradianceCoefficients instanceof Array)for(const e of t.irradianceCoefficients)e instanceof Array&&n._diffuseCoefficients.push(...e);if(t.specularImages instanceof Array){const e=i.createNode("ComposedCubeMapTexture",!1),r=t.specularImages[0];if(r instanceof Array){const t=["right","left","top","bottom","front","back"];for(const[n,s]of r.map((e=>this.images[e])).entries()){const r=i.createNode("ImageTexture",!1),o=this.sanitizeName(s?.name);o&&i.addNamedNode(i.getUniqueName(o),r),r._description=s?.name??"",r._url=s?[s.uri]:[],r.setup(),e[`_${t[n]}Texture`]=r}e.setup(),n._specularTexture=e}}return n.setup(),t.node=n},buffersArray:async function(e){e instanceof Array&&(this.buffers=await Promise.all(e.map(((e,t)=>this.bufferObject(e,t)))))},bufferObject:async function(e,t){if(!(e instanceof Object))return;if(!e.uri)return this.buffers[t];const i=new URL(e.uri,this.getExecutionContext().getBaseURL()),n=await fetch(i),r=await n.blob(),s=await r.arrayBuffer();return oo.ungzip(s)},bufferViewsArray(e){if(e instanceof Array){this.bufferViews=e;for(const t of e)t.buffer=this.bufferViewObject(t)}},bufferViewObject(e){if(!(e instanceof Object))return;const t=this.buffers[e.buffer];if(!t)return;const i=e.byteOffset||0,n=e.byteLength;return t.slice(i,i+n)},accessorsArray(e){if(e instanceof Array){this.accessors=e;for(const t of e)this.accessorObject(t)}},accessorObject:(()=>{const e=new Map([[5120,Int8Array],[5121,Uint8Array],[5122,Int16Array],[5123,Uint16Array],[5124,Int32Array],[5125,Uint32Array],[5126,Float32Array]]),t=new Map([["SCALAR",1],["VEC2",2],["VEC3",3],["VEC4",4],["MAT2",4],["MAT3",9],["MAT4",16]]);return function(i){i instanceof Object&&(Object.defineProperty(i,"array",{get:()=>{const n=e.get(i.componentType),r=this.bufferViews[i.bufferView||0],s=i.byteOffset||0,o=r.byteStride||0,a=t.get(i.type),l=i.count||0,u=o?o/n.BYTES_PER_ELEMENT:a,h=Math.min(u*l,(r.byteLength-s)/n.BYTES_PER_ELEMENT),d=new n(r.buffer,s,h);if(u===a){const e=this.sparseObject(i.sparse,d,a);return Object.defineProperty(i,"array",{value:e}),e}{const e=l*a,t=new n(e);for(let i=0,n=0;i<e;n+=u)for(let e=0;e<a;++e,++i)t[i]=d[n+e];const r=this.sparseObject(i.sparse,t,a);return Object.defineProperty(i,"array",{value:r}),r}},configurable:!0}),Object.defineProperty(i,"normalizedArray",{get:()=>{switch(i.componentType){case 5120:var e=Float32Array.from(i.array,(e=>Math.max(e/127,-1)));break;case 5121:e=Float32Array.from(i.array,(e=>e/255));break;case 5122:e=Float32Array.from(i.array,(e=>Math.max(e/32767,-1)));break;case 5123:e=Float32Array.from(i.array,(e=>e/65535));break;case 5124:e=Float32Array.from(i.array,(e=>Math.max(e/2147483647,-1)));break;case 5125:e=Float32Array.from(i.array,(e=>e/4294967295));break;case 5126:e=i.array}return Object.defineProperty(i,"normalizedArray",{value:e}),e},configurable:!0}))}})(),sparseObject:(()=>{const e=new Map([[5121,Uint8Array],[5123,Uint16Array],[5125,Uint32Array]]);return function(t,i,n){if(!(t instanceof Object))return i;if(!(t.indices instanceof Object))return i;if(!(t.values instanceof Object))return i;const r=e.get(t.indices.componentType),s=this.bufferViews[t.indices.bufferView],o=t.indices.byteOffset,a=new r(s.buffer,o,t.count),l=i.constructor,u=this.bufferViews[t.values.bufferView],h=t.values.byteOffset,d=new l(u.buffer,h,t.count*n);i=i.slice();let c=0;for(const e of a)for(let t=0;t<n;++t,++c)i[e*n+t]=d[c];return i}})(),samplersArray(e){if(e instanceof Array){this.samplers=e;for(const t of e)this.samplerObject(t)}},samplerObject:(()=>{const e=new Map([[9728,["NEAREST_PIXEL",!1]],[9729,["AVG_PIXEL",!1]],[9984,["NEAREST_PIXEL_NEAREST_MIPMAP",!0]],[9985,["AVG_PIXEL_NEAREST_MIPMAP",!0]],[9986,["NEAREST_PIXEL_AVG_MIPMAP",!0]],[9987,["AVG_PIXEL_AVG_MIPMAP",!0]]]),t=new Map([[9728,"NEAREST_PIXEL"],[9729,"AVG_PIXEL"]]),i=new Map([[33071,"CLAMP_TO_EDGE"],[33648,"MIRRORED_REPEAT"],[10497,"REPEAT"]]);return function(n){n instanceof Object&&Object.defineProperty(n,"texturePropertiesNode",{get:()=>{const r=this.getExecutionContext(),s=r.createNode("TextureProperties",!1),o=this.sanitizeName(n.name);o&&r.addNamedNode(r.getUniqueName(o),s);const a=e.get(n.minFilter)??["AVG_PIXEL",!1];return s._minificationFilter=a[0],s._generateMipMaps=a[1],s._magnificationFilter=t.get(n.magFilter)??"AVG_PIXEL",s._boundaryModeS=i.get(n.wrapS)??"REPEAT",s._boundaryModeT=i.get(n.wrapT)??"REPEAT",s.setup(),Object.defineProperty(n,"texturePropertiesNode",{value:s}),s},configurable:!0})}})(),imagesArray:async function(e){e instanceof Array&&(this.images=await Promise.all(e.map((e=>this.imageObject(e)))))},imageObject:async function(e){if(!(e instanceof Object))return;if(e.uri)return e;const t=this.bufferViews[e.bufferView];if(!t)return e;const i=t.buffer,n=new Blob([new Uint8Array(i)],{type:e.mimeType}),r=await this.blobToDataUrl(n);return e.uri=r,e},blobToDataUrl:e=>new Promise(((t,i)=>{const n=new FileReader;n.onload=t,n.onerror=i,n.readAsDataURL(e)})).then((e=>e.target.result)),texturesArray(e){e instanceof Array&&(this.textures=e)},textureObject(e){if(!(e instanceof Object))return;const t=this.textureImageObject(e);if(!t.length)return null;if(e.textureNode)return e.textureNode;const i=this.getExecutionContext(),n=i.createNode("ImageTexture",!1),r=this.sanitizeName(e.name||t[0].name);r&&i.addNamedNode(i.getUniqueName(r),n),n._url=t.map((e=>e.uri)),n._colorSpaceConversion=!1;const s=this.samplers[e.sampler];return s instanceof Object&&(n._textureProperties=s.texturePropertiesNode),n.setup(),e.textureNode=n},textureImageObject(e){const t=[this.images[e.source]];return this.extensions.has("KHR_texture_basisu")&&t.unshift(this.images[e.extensions?.KHR_texture_basisu?.source]),this.extensions.has("EXT_texture_webp")&&t.unshift(this.images[e.extensions?.EXT_texture_webp?.source]),t.filter((e=>e))},materialsArray(e){e instanceof Array&&(this.materials=e)},materialObject({material:e,mode:t=4}){if(!(e instanceof Object))return this.getDefaultAppearance(t);if(e.appearanceNode)return e.appearanceNode;const i=this.texCoordIndices("",e);this.texCoordIndex=Array.from(i).reduce(Math.max,-1),this.textureTransformNodes=[],this.texCoordMappings=new Map,e.texCoordMappings=this.texCoordMappings;const n=this.getExecutionContext(),r=n.createNode("Appearance",!1),s=this.refineMaterial(t,this.createMaterial(e,t)),o=this.sanitizeName(e.name),a=new Fe(0,0,0);this.vectorValue(e.emissiveFactor,a)&&(s._emissiveColor=a),s._emissiveTexture=this.textureInfo(e.emissiveTexture),s._emissiveTextureMapping=this.textureMapping(e.emissiveTexture),this.occlusionTextureInfo(e.occlusionTexture,s),this.normalTextureInfo(e.normalTexture,s),this.materialExtensions(e.extensions,s),s.setup();for(const e of i){const t=`TEXCOORD_${e}`;if(this.textureTransformNodes.length&&this.textureTransformNodes.every((e=>e._mapping!==t))){const e=n.createNode("TextureTransform",!1);e._mapping=t,e._translation.y=-1,e._scale.y=-1,e.setup(),this.textureTransformNodes.push(e)}this.texCoordMappings.set(t,e)}return o&&n.addNamedNode(n.getUniqueName(o),r),r._alphaMode=this.stringValue(e.alphaMode,"OPAQUE"),r._alphaCutoff=this.numberValue(e.alphaCutoff,.5),r._material=s,r._textureTransform=this.createMultiTextureTransform(s),r.setup(),e.appearanceNode=r},refineMaterial(e,t){if(e>3)return t;switch(t.getTypeName()){default:return t;case"Material":{const e=this.getExecutionContext().createNode("UnlitMaterial",!1);return e._emissiveColor=t._diffuseColor,e._emissiveTextureMapping=t._diffuseTextureMapping,e._emissiveTexture=t._diffuseTexture,t.dispose(),e}case"PhysicalMaterial":{const e=this.getExecutionContext().createNode("UnlitMaterial",!1);return e._emissiveColor=t._baseColor,e._emissiveTextureMapping=t._baseTextureMapping,e._emissiveTexture=t._baseTexture,t.dispose(),e}}},texCoordIndices(e,t,i=new Set){if(!(t instanceof Object))return i;e.endsWith("Texture")&&!t?.extensions?.KHR_texture_transform&&i.add(t.texCoord||0);for(const[e,n]of Object.entries(t))this.texCoordIndices(e,n,i);return i},createMaterial(e,t){const i=[this.pbrMetallicRoughnessObject.bind(this,e.pbrMetallicRoughness),this.pbrSpecularGlossinessObject.bind(this,e.extensions?.KHR_materials_pbrSpecularGlossiness),this.pbrMetallicRoughnessObject.bind(this,{})];for(const e of i){const i=e(t);if(i)return i}},pbrMetallicRoughnessObject(e,t){if(!(e instanceof Object))return null;const i=this.getExecutionContext().createNode("PhysicalMaterial",!1),n=new We(0,0,0,0),r=new Fe(0,0,0);return this.vectorValue(e.baseColorFactor,n)&&(i._baseColor=r.set(...n),i._transparency=1-n.a),i._metallic=this.numberValue(e.metallicFactor,1),i._roughness=this.numberValue(e.roughnessFactor,1),i._baseTexture=this.textureInfo(e.baseColorTexture),i._baseTextureMapping=this.textureMapping(e.baseColorTexture),i._metallicRoughnessTexture=this.textureInfo(e.metallicRoughnessTexture),i._metallicRoughnessTextureMapping=this.textureMapping(e.metallicRoughnessTexture),i},pbrSpecularGlossinessObject(e){if(!(e instanceof Object))return null;const t=this.getExecutionContext().createNode("Material",!1),i=new We(0,0,0,0),n=new Fe(0,0,0),r=new Fe(0,0,0);return this.vectorValue(e.diffuseFactor,i)?(t._diffuseColor=n.set(...i),t._transparency=1-i.a):t._diffuseColor=Fe.White,this.vectorValue(e.specularFactor,r)?t._specularColor=r:t._specularColor=Fe.White,t._shininess=this.numberValue(e.glossinessFactor,1),t._diffuseTexture=this.textureInfo(e.diffuseTexture),t._diffuseTextureMapping=this.textureMapping(e.diffuseTexture),t._specularTexture=this.textureInfo(e.specularGlossinessTexture),t._specularTextureMapping=this.textureMapping(e.specularGlossinessTexture),t._shininessTexture=this.textureInfo(e.specularGlossinessTexture),t._shininessTextureMapping=this.textureMapping(e.specularGlossinessTexture),t},occlusionTextureInfo(e,t){if(!(e instanceof Object))return null;t._occlusionStrength=this.numberValue(e.strength,1),t._occlusionTexture=this.textureInfo(e),t._occlusionTextureMapping=this.textureMapping(e)},normalTextureInfo(e,t){if(!(e instanceof Object))return null;t._normalScale=this.numberValue(e.scale,1),t._normalTexture=this.textureInfo(e),t._normalTextureMapping=this.textureMapping(e)},textureInfo(e){return e instanceof Object?(e.extensions instanceof Object?e.mapping=this.textureTransformObject(e.extensions.KHR_texture_transform,e.texCoord||0):e.mapping=`TEXCOORD_${e.texCoord||0}`,this.textureObject(this.textures[e.index])):null},textureMapping:e=>e instanceof Object?e.mapping:"",materialExtensions(e,t){if(e instanceof Object)for(const[i,n]of Object.entries(e))switch(i){case"KHR_materials_unlit":this.khrMaterialsUnlitObject(t);break;case"KHR_materials_emissive_strength":this.khrMaterialsEmissiveStrengthObject(n,t)}},khrMaterialsUnlitObject(e){switch(e.getTypeName()){case"PhysicalMaterial":e._emissiveColor=e._baseColor,e._emissiveTextureMapping=e._baseTextureMapping,e._emissiveTexture=e._baseTexture,e._baseColor=Fe.Black,e._baseTextureMapping="",e._baseTexture=null;break;case"Material":e._emissiveColor=e._diffuseColor,e._emissiveTextureMapping=e._diffuseTextureMapping,e._emissiveTexture=e._diffuseTexture,e._diffuseColor=Fe.Black,e._diffuseTextureMapping="",e._diffuseTexture=null}},khrMaterialsEmissiveStrengthObject(e,t){if(!(e instanceof Object))return;const i=this.numberValue(e.emissiveStrength,1);t._emissiveColor.r*=i,t._emissiveColor.g*=i,t._emissiveColor.b*=i},textureTransformObject(e,t){if(!(e instanceof Object))return;if(!this.extensions.has("KHR_texture_transform"))return;const i=this.getExecutionContext().createNode("TextureTransformMatrix3D",!1),n=`TEXCOORD_${this.texCoordIndex+this.textureTransformNodes.length+1}`,r=new _t(0,0),s=new _t(1,1),o=new gi;return o.scale(new Tt(1,-1,1)),o.translate(new Tt(0,-1,0)),this.vectorValue(e.offset,r)&&o.translate(new Tt(...r,0)),o.rotate(new ui(0,0,-1,this.numberValue(e.rotation,0))),this.vectorValue(e.scale,s)&&o.scale(new Tt(...s,1)),i._mapping=n,i._matrix=o,i.setup(),this.textureTransformNodes.push(i),this.texCoordMappings.set(n,e.texCoord??t),n},meshesArray(e){e instanceof Array&&(this.meshes=e)},meshObject(e,t){if(!(e instanceof Object))return;if(e.shapeNodes){const i=e.primitives;if(!(i instanceof Array))return e.shapeNodes;for(const e of i)this.attributesJointsArray(t,e.attributes?.JOINTS,e.attributes?.WEIGHTS);return e.shapeNodes}const i=this.primitivesArray(e,t),n=this.getExecutionContext(),r=this.sanitizeName(e.name);if(r)for(const e of i)n.addNamedNode(n.getUniqueName(r),e);return e.shapeNodes=i},primitivesArray({primitives:e,weights:t},i){if(!(e instanceof Array))return[];const n=[];for(const r of e)this.primitiveObject(r,t,i,n);return n},primitiveObject(e,t,i,n){e instanceof Object&&(this.attributesObject(e.attributes),this.targetsArray(e.targets),e.indices=this.accessors[e.indices],e.material=this.materials[e.material],this.primitiveExtensionsObject(e.extensions,e),n.push(e.shapeNode=this.createShape(e,t,i)))},attributesObject(e){if(e instanceof Object){for(const t in e)e[t]=this.accessors[e[t]];e.TEXCOORD=[],e.COLOR=[],e.JOINTS=[],e.WEIGHTS=[];for(let t=0;e["TEXCOORD_"+t];++t)e.TEXCOORD.push(e["TEXCOORD_"+t]);for(let t=0;e["COLOR_"+t];++t)e.COLOR.push(e["COLOR_"+t]);for(let t=0;e["JOINTS_"+t];++t)e.JOINTS.push(e["JOINTS_"+t]);for(let t=0;e["WEIGHTS_"+t];++t)e.WEIGHTS.push(e["WEIGHTS_"+t])}},targetsArray(e){},primitiveExtensionsObject(e,t){if(e instanceof Object)for(const[i,n]of Object.entries(e))if("KHR_draco_mesh_compression"===i)return this.khrDracoMeshCompressionObject(n,t)},khrDracoMeshCompressionObject(e,t){if(!(e instanceof Object))return;if(!this.draco)return;const i=t.attributes,n=new Uint8Array(this.bufferViews[e.bufferView].buffer);this.dracoDecodeMesh(this.draco,n,e.attributes,(function(e){Object.defineProperty(t.indices,"array",{value:e})}),(function(e,t){i[e]&&Object.defineProperty(i[e],"array",{value:t})}))},dracoDecodeMesh(e,t,i,n,r){const s=new e.DecoderBuffer,o=new e.Decoder;let a,l;s.Init(t,t.byteLength);try{const t=o.GetEncodedGeometryType(s);switch(t){case e.TRIANGULAR_MESH:a=new e.Mesh,l=o.DecodeBufferToMesh(s,a);break;case e.POINT_CLOUD:a=new e.PointCloud,l=o.DecodeBufferToPointCloud(s,a);break;default:throw new Error(`Invalid geometry type ${t}.`)}if(!l.ok()||!a.ptr)throw new Error(l.error_msg());if(t===e.TRIANGULAR_MESH){const t=3*a.num_faces(),i=4*t,r=e._malloc(i);try{const s=new Uint32Array(t);o.GetTrianglesUInt32Array(a,i,r),s.set(new Uint32Array(e.HEAPF32.buffer,r,t)),n(s)}finally{e._free(r)}}for(const[t,n]of Object.entries(i)){const i=o.GetAttributeByUniqueId(a,n),s=i.num_components(),l=a.num_points()*s,u=l*Float32Array.BYTES_PER_ELEMENT,h=e._malloc(u);try{const n=new Float32Array(l);o.GetAttributeDataArrayForAllPoints(a,i,e.DT_FLOAT32,u,h),n.set(new Float32Array(e.HEAPF32.buffer,h,l)),r(t,n)}finally{e._free(h)}}}finally{a&&e.destroy(a),e.destroy(o),e.destroy(s)}},createDraco:async function(){if(this.constructor.draco)return this.constructor.draco;{const e=await fetch(so.getLibraryURL("draco_decoder_gltf.js")),t=await e.text(),i=await new Function(t)()();return this.constructor.draco=i}},camerasArray(e){e instanceof Array&&(this.cameras=e)},cameraObject(e){if(!(e instanceof Object))return null;if(void 0!==e.viewpointNode)return e.viewpointNode;const t=this.cameraType(e);if(!t)return e.viewpointNode=null;const i=this.getExecutionContext(),n=this.sanitizeName(e.name);return n&&(i.addNamedNode(i.getUniqueName(n),t),i.addExportedNode(i.getUniqueExportName(n),t)),t._description=e.name?this.description(e.name):"Viewpoint "+ ++this.viewpoints,t._position=Tt.Zero,t._centerOfRotation=new Tt(0,0,-10),e.viewpointNode=t},cameraType(e){switch(e.type){case"orthographic":return this.orthographicCamera(e.orthographic);case"perspective":return this.perspectiveCamera(e.perspective);default:return null}},orthographicCamera(e){const t=this.getExecutionContext().createNode("OrthoViewpoint",!1);return"number"==typeof e.xmag&&(t._fieldOfView[0]=-e.xmag/2,t._fieldOfView[2]=+e.xmag/2),"number"==typeof e.ymag&&(t._fieldOfView[1]=-e.ymag/2,t._fieldOfView[3]=+e.ymag/2),"number"==typeof e.znear&&(t._nearDistance=e.znear),"number"==typeof e.zfar&&(t._farDistance=e.zfar),t.setup(),t},perspectiveCamera(e){const t=this.getExecutionContext().createNode("Viewpoint",!1);return"number"==typeof e.yfov&&(t._fieldOfView=e.yfov),"number"==typeof e.znear&&(t._nearDistance=e.znear),"number"==typeof e.zfar&&(t._farDistance=e.zfar),t.setup(),t},nodesArray(e){e instanceof Array&&(this.nodes=e.map(((e,t)=>this.nodeObject(e,t))),this.nodes.forEach((e=>this.nodeSkeleton(e))),this.nodes.forEach((e=>this.nodeChildren(e))))},nodeObject(e,t){if(!(e instanceof Object))return{};if(e.transformNode)return e;const i=this.getExecutionContext(),n=this.joints.has(t)?"HAnimJoint":"Transform",r=i.createNode(n,!1);e.transformNode=r;const s=this.skins[e.skin];return s&&(s.humanoidNode||(s.humanoidNode=i.createNode("HAnimHumanoid",!1)),e.humanoidNode=s.humanoidNode),e.childNode=e.humanoidNode??e.transformNode,e},nodeSkeleton(e){const t=this.skins[e.skin];if(!t)return;const i=this.nodes[t.skeleton],n=t.humanoidNode;i&&(i.humanoidNode=n,i.childNode=n)},nodeChildren(e){const t=this.getExecutionContext(),i=e.transformNode,n=this.sanitizeName(e.name);n&&(t.addNamedNode(t.getUniqueName(n),i),"HAnimJoint"===i.getTypeName()&&(i._name=e.name));const r=new Tt(0,0,0),s=new ui,o=new Tt(1,1,1),a=new ui,l=new Kt(0,0,0,1),u=new gi;this.vectorValue(e.matrix,u)?(u.get(r,s,o,a),i._translation=r,i._rotation=s,i._scale=o,i._scaleOrientation=a):(this.vectorValue(e.translation,r)&&(i._translation=r),this.vectorValue(e.rotation,l)&&(i._rotation=new ui(l)),this.vectorValue(e.scale,o)&&(i._scale=o));const h=this.skins[e.skin],d=this.meshObject(this.meshes[e.mesh],h),c=this.cameraObject(this.cameras[e.camera]);if(c&&i._children.push(c),this.nodeLight(e.extensions?.KHR_lights_punctual,i),i._children.push(...this.nodeChildrenArray(e.children)),d&&i._children.push(...this.meshInstancing(e.extensions?.EXT_mesh_gpu_instancing,d)),i.setup(),!h)return;const p=h.humanoidNode;if(!p.isInitialized()){const n=this.sanitizeName(h.name)||i.getName();n&&t.addNamedNode(t.getUniqueName(n),p),p._name=h.name??e.name??"",p._version="2.0",p._skeletalConfiguration="GLTF";const a=this.nodes[h.skeleton]?.transformNode;a&&p._skeleton.push(a);for(const[e,t]of h.joints.entries()){const i=this.nodes[t]?.transformNode,n=h.inverseBindMatrices[e]??gi.Identity;i&&(n.get(r,s,o),p._joints.push(i),p._jointBindingPositions.push(r),p._jointBindingRotations.push(s),p._jointBindingScales.push(o))}p.setup()}d?.length&&(p._skinNormal=d[0]._geometry.normal,p._skinCoord=d[0]._geometry.coord),p._skin.push(i)},nodeLight(e,t){if(!(e instanceof Object))return;const i=this.lightObject(e.light);i&&(++this.usedLights,t._children.push(i))},meshInstancing(e,t){if(!(e instanceof Object))return t;let i=e.attributes,n=this.accessors[i?.TRANSLATION],r=this.accessors[i?.ROTATION],s=this.accessors[i?.SCALE],o=Math.max(n?.count??0,r?.count??0,s?.count??0);if(!o)return t;"VEC3"!==n?.type&&(n=null),"VEC4"!==r?.type&&(r=null),"VEC3"!==s?.type&&(s=null);const a=this.getScene(),l=[],u=n?.array,h=r?.normalizedArray,d=s?.array;for(let e=0;e<o;++e){const i=a.createNode("Transform",!1);n&&e<n.count&&(i._translation=new Tt(u[3*e+0],u[3*e+1],u[3*e+2])),r&&e<r.count&&(i._rotation=new ui(new Kt(h[4*e+0],h[4*e+1],h[4*e+2],h[4*e+3]))),s&&e<s.count&&(i._scale=new Tt(d[3*e+0],d[3*e+1],d[3*e+2])),i._children=t,i.setup(),l.push(i)}return l},nodeChildrenArray(e){if(!(e instanceof Array))return[];return Array.from(new Set(e.map((e=>this.nodes[e]?.childNode)).filter((e=>e)).filter((e=>"HAnimHumanoid"!==e.getTypeName()||!e.getCloneCount()))))},skinsArray(e){if(e instanceof Array){this.skins=e;for(const t of e)this.skinObject(t)}},skinObject:function(e){if(!(e instanceof Object))return;const t=this.getScene();e.joints=this.jointsArray(e.joints),e.skeleton=e.skeleton??this.skeleton(e.joints),e.inverseBindMatrices=this.inverseBindMatricesAccessors(this.accessors[e.inverseBindMatrices]),e.textureCoordinateNode=t.createNode("TextureCoordinate",!1),e.multiTextureCoordinateNode=t.createNode("MultiTextureCoordinate",!1),e.normalNode=t.createNode("Normal",!1),e.coordinateNode=t.createNode("Coordinate",!1),e.textureCoordinateNode._mapping="TEXCOORD_0",e.textureCoordinateNode.setup(),e.multiTextureCoordinateNode.setup(),e.normalNode.setup(),e.coordinateNode.setup()},jointsArray:function(e){return e instanceof Array?(e.forEach((e=>this.joints.add(e))),e):[]},skeleton:function(e){const t=new Set(e.map((e=>this.nodes[e])).filter((e=>e instanceof Object)).filter((e=>e.children instanceof Array)).flatMap((e=>e.children)));return e.filter((e=>!t.has(e)))[0]},inverseBindMatricesAccessors:function(e){if(!e)return[];const t=e.array,i=t.length,n=[];for(let e=0;e<i;e+=16)n.push(new gi(...t.subarray(e,e+16)));return n},scenesArray(e,t=0){if(!(e instanceof Array))return;const i=this.getExecutionContext(),n=e.map((e=>this.sceneObject(e))).filter((e=>e));switch(n.length){case 0:return;case 1:if(0===t)return this.usedLights&&i.getRootNodes().push(this.createNavigationInfo()),void i.getRootNodes().push(n[0]);default:{this.usedLights&&i.getRootNodes().push(this.createNavigationInfo());const e=i.createNode("Switch",!1);return i.addNamedNode(i.getUniqueName("Scenes"),e),i.addExportedNode(i.getUniqueExportName("Scenes"),e),e._whichChoice=t,e._children=n,e.setup(),void i.getRootNodes().push(e)}}},sceneObject(e){if(!(e instanceof Object))return null;const t=this.envLightObject(e.extensions?.EXT_lights_image_based?.light),i=this.sceneNodesArray(e.nodes);switch(t&&i.unshift(t),i.length){case 0:return null;case 1:return i[0];default:{const e=this.getExecutionContext(),t=e.createNode("Group",!1),n=this.sanitizeName(e.name);return n&&e.addNamedNode(e.getUniqueName(n),t),t._children=i,t.setup(),t}}},sceneNodesArray(e){return this.nodeChildrenArray(e)},animationsArray(e){if(!(e instanceof Array))return;const t=e.map((e=>this.animationObject(e))).filter((e=>e));if(!t.length)return;const i=this.getExecutionContext(),n=i.createNode("Group",!1);i.addNamedNode(i.getUniqueName("Animations"),n),i.addExportedNode(i.getUniqueExportName("Animations"),n),n._visible=!1,n._children=t,n.setup(),i.getRootNodes().push(n)},animationObject(e){if(!(e instanceof Object))return null;const t=this.getExecutionContext(),i=t.createNode("TimeSensor",!1),n=this.animationChannelsArray(e.channels,e.samplers,i);if(!n.length)return null;const r=t.createNode("Group",!1),s=this.sanitizeName(e.name);return++this.animations,t.addNamedNode(t.getUniqueName(s||`Animation${this.animations}`),r),t.addNamedNode(t.getUniqueName(`Timer${this.animations}`),i),t.addExportedNode(t.getUniqueExportName(s||`Animation${this.animations}`),r),t.addExportedNode(t.getUniqueExportName(`Timer${this.animations}`),i),i._description=this.description(e.name)||`Animation ${this.animations}`,r._visible=!1,r._children.push(i,...n),i.setup(),r.setup(),r},animationChannelsArray(e,t,i){if(!(e instanceof Array))return[];if(!(t instanceof Array))return[];const n=t.map((e=>this.accessors[e.input])).filter((e=>e?.array.length)).reduce(((e,t)=>Math.max(e,t.array.at(-1))),0);return i._cycleInterval=n,e.flatMap((e=>this.animationChannelObject(e,t,i)))},animationChannelObject(e,t,i){if(!(e instanceof Object))return[];const n=e.target;if(!(n instanceof Object))return[];const r=this.nodes[n.node]?.transformNode;if(!r)return[];const s=t[e.sampler];if(!s)return[];const o=this.accessors[s.input];if(!o)return[];if(!o.array.length)return[];const a=this.accessors[s.output];return a&&a.array.length?this.createInterpolator(i,r,n,s.interpolation,o.array,a,i._cycleInterval.getValue()):[]},createNavigationInfo(){const e=this.getExecutionContext().createNode("NavigationInfo",!1);return e._headlight=!1,e.setup(),e},createShape(e,t,i){const n=this.getExecutionContext().createNode("Shape",!1),r=this.materialObject(e),s=this.createGeometry(e,t,i);return n._appearance=r,n._geometry=s,n.setup(),n},getDefaultAppearance(e){if(e=e>3,this.defaultAppearance[e])return this.defaultAppearance[e];const t=this.getExecutionContext(),i=t.createNode("Appearance",!1),n=t.createNode(e?"PhysicalMaterial":"UnlitMaterial",!1);return i._alphaMode="OPAQUE",i._material=n,e&&(n._metallic=0),n.setup(),i.setup(),this.defaultAppearance[e]=i},createMultiTextureTransform(e){if(!+e.getTextureBits())return null;const t=this.textureTransformNodes.sort(((e,t)=>g.cmp(e._mapping.getValue(),t._mapping.getValue())));switch(t.length){case 0:{if(this.textureTransformNode)return this.textureTransformNode;const e=this.getExecutionContext().createNode("TextureTransform",!1);return e._translation.y=-1,e._scale.y=-1,e.setup(),this.textureTransformNode=e}case 1:return t[0];default:{const e=this.getExecutionContext().createNode("MultiTextureTransform",!1);return e._textureTransform=t,e.setup(),e}}},createGeometry(e,t,i){switch(e.mode){case 0:return this.createPointSet(e,t,i);case 1:return e.indices?this.createIndexedLineSet(e,t,i,1):this.createLineSet(e,t,i);case 2:return this.createIndexedLineSet(e,t,i,2);case 3:return this.createIndexedLineSet(e,t,i,3);default:case 4:return e.indices?this.createIndexedTriangleSet(e,t,i):this.createTriangleSet(e,t,i);case 5:return e.indices?this.createIndexedTriangleStripSet(e,t,i):this.createTriangleStripSet(e,t,i);case 6:return e.indices?this.createIndexedTriangleFanSet(e,t,i):this.createTriangleFanSet(e,t,i)}},createPointSet({attributes:e,material:t,targets:i},n,r){const s=this.getExecutionContext().createNode("PointSet",!1);return s._color=this.createColor(e.COLOR[0],t),s._normal=this.createNormal(e.NORMAL,i,n),s._coord=this.createCoordinate(e.POSITION,i,n),this.attributesJointsArray(r,e.JOINTS,e.WEIGHTS),this.skinGeometry(r,s),s.setup(),s},createIndexedLineSet({attributes:e,indices:t,material:i,targets:n},r,s,o){const a=this.getExecutionContext().createNode("IndexedLineSet",!1);switch(a._color=this.createColor(e.COLOR[0],i),a._normal=this.createNormal(e.NORMAL,n,r),a._coord=this.createCoordinate(e.POSITION,n,r),o){case 1:{const e=a._coordIndex,i=t.array,n=i.length;for(let t=0;t<n;t+=2)e.push(i[t],i[t+1],-1);break}case 2:{const e=a._coordIndex;if(t){for(const i of t.array)e.push(i);e.length&&e.push(e[0],-1)}else{const t=a._coord;if(t?.point.length){for(const i of t.point.keys())e.push(i);e.push(0,-1)}}break}case 3:{const e=a._coordIndex;if(t){for(const i of t.array)e.push(i);e.length&&e.push(-1)}else{const t=a._coord;if(t?.point.length){for(const i of t.point.keys())e.push(i);e.push(-1)}}break}}return this.attributesJointsArray(s,e.JOINTS,e.WEIGHTS),this.skinGeometry(s,a),a.setup(),a},createLineSet({attributes:e,material:t,targets:i},n,r){const s=this.getExecutionContext().createNode("LineSet",!1);return s._color=this.createColor(e.COLOR[0],t),s._normal=this.createNormal(e.NORMAL,i,n),s._coord=this.createCoordinate(e.POSITION,i,n),this.attributesJointsArray(r,e.JOINTS,e.WEIGHTS),this.skinGeometry(r,s),s.setup(),s},createIndexedTriangleSet({attributes:e,indices:t,material:i,targets:n},r,s){const o=this.getExecutionContext().createNode("IndexedTriangleSet",!1);return o._solid=!i?.doubleSided,o._index=t.array,o._color=this.createColor(e.COLOR[0],i),o._texCoord=this.createMultiTextureCoordinate(e.TEXCOORD,i),o._normal=this.createNormal(e.NORMAL,n,r),o._coord=this.createCoordinate(e.POSITION,n,r),o._normalPerVertex=!!o._normal.getValue(),this.attributesJointsArray(s,e.JOINTS,e.WEIGHTS),this.skinGeometry(s,o),o.setup(),o},createTriangleSet({attributes:e,material:t,targets:i},n,r){const s=this.getExecutionContext().createNode("TriangleSet",!1);return s._solid=!t?.doubleSided,s._color=this.createColor(e.COLOR[0],t),s._texCoord=this.createMultiTextureCoordinate(e.TEXCOORD,t),s._normal=this.createNormal(e.NORMAL,i,n),s._coord=this.createCoordinate(e.POSITION,i,n),s._normalPerVertex=!!s._normal.getValue(),this.attributesJointsArray(r,e.JOINTS,e.WEIGHTS),this.skinGeometry(r,s),s.setup(),s},createIndexedTriangleStripSet({attributes:e,indices:t,material:i,targets:n},r,s){const o=this.getExecutionContext().createNode("IndexedTriangleStripSet",!1);return o._solid=!i?.doubleSided,o._index=t.array,o._color=this.createColor(e.COLOR[0],i),o._texCoord=this.createMultiTextureCoordinate(e.TEXCOORD,i),o._normal=this.createNormal(e.NORMAL,n,r),o._coord=this.createCoordinate(e.POSITION,n,r),o._normalPerVertex=!!o._normal.getValue(),this.attributesJointsArray(s,e.JOINTS,e.WEIGHTS),this.skinGeometry(s,o),o.setup(),o},createTriangleStripSet({attributes:e,material:t,targets:i},n,r){const s=this.getExecutionContext().createNode("TriangleStripSet",!1);s._solid=!t?.doubleSided,s._color=this.createColor(e.COLOR[0],t),s._texCoord=this.createMultiTextureCoordinate(e.TEXCOORD,t),s._normal=this.createNormal(e.NORMAL,i,n),s._coord=this.createCoordinate(e.POSITION,i,n),s._normalPerVertex=!!s._normal.getValue();const o=s._coord;return o&&o.point.length&&(s._stripCount=[o.point.length]),this.attributesJointsArray(r,e.JOINTS,e.WEIGHTS),this.skinGeometry(r,s),s.setup(),s},createIndexedTriangleFanSet({attributes:e,indices:t,material:i,targets:n},r,s){const o=this.getExecutionContext().createNode("IndexedTriangleFanSet",!1);return o._solid=!i?.doubleSided,o._index=t.array,o._color=this.createColor(e.COLOR[0],i),o._texCoord=this.createMultiTextureCoordinate(e.TEXCOORD,i),o._normal=this.createNormal(e.NORMAL,n,r),o._coord=this.createCoordinate(e.POSITION,n,r),o._normalPerVertex=!!o._normal.getValue(),this.attributesJointsArray(s,e.JOINTS,e.WEIGHTS),this.skinGeometry(s,o),o.setup(),o},createTriangleFanSet({attributes:e,material:t,targets:i},n,r){const s=this.getExecutionContext().createNode("TriangleFanSet",!1);s._solid=!t?.doubleSided,s._color=this.createColor(e.COLOR[0],t),s._texCoord=this.createMultiTextureCoordinate(e.TEXCOORD,t),s._normal=this.createNormal(e.NORMAL,i,n),s._coord=this.createCoordinate(e.POSITION,i,n),s._normalPerVertex=!!s._normal.getValue();const o=s._coord;return o&&o.point.length&&(s._fanCount=[o.point.length]),this.attributesJointsArray(r,e.JOINTS,e.WEIGHTS),this.skinGeometry(r,s),s.setup(),s},createColor:(()=>{const e=new Map([["VEC3","Color"],["VEC4","ColorRGBA"]]);return function(t,i){if(!(t instanceof Object))return null;const n=e.get(t.type);if(!n)return null;if(t.colorNode)return t.colorNode;const r=this.getExecutionContext(),s="OPAQUE"===this.materialObject({material:i})._alphaMode.getValue(),o=r.createNode(s?"Color":n,!1);return o._color=s&&"Color"!==n?t.normalizedArray.filter(((e,t)=>(t+1)%4)):t.normalizedArray,o.setup(),t.colorNode=o}})(),createMultiTextureCoordinate(e,t){if(!+this.materialObject({material:t})._material.getValue().getTextureBits())return null;if(e.textureCoordinateNode)return e.textureCoordinateNode;switch(t.texCoordMappings.size){case 0:return null;case 1:return e.textureCoordinateNode=Array.from(t.texCoordMappings.entries(),(([t,i])=>this.createTextureCoordinate(e[i],t)))[0];default:{const i=Array.from(t.texCoordMappings.entries(),(([t,i])=>this.createTextureCoordinate(e[i],t))).filter((e=>e)).sort(((e,t)=>g.cmp(e._mapping.getValue(),t._mapping.getValue())));if(!i.length)return null;const n=this.getExecutionContext().createNode("MultiTextureCoordinate",!1);return n._texCoord=i,n.setup(),e.textureCoordinateNode=n}}},createTextureCoordinate(e,t){if("VEC2"!==e?.type)return null;if(e[t])return e[t];const i=this.getExecutionContext().createNode("TextureCoordinate",!1);return i._mapping=t,i._point=e.normalizedArray,i.setup(),e[t]=i},createNormal(e,t,i){if("VEC3"!==e?.type)return null;if(e.normalNode)return e.normalNode;const n=this.getExecutionContext().createNode("Normal",!1);if(n._vector=e.normalizedArray,t instanceof Array&&i instanceof Array){e.field=n._vector.copy();const r=this.applyMorphTargets(n._vector,t,"NORMAL",i);n._vector.length=0;for(const e of r)n._vector.push(e)}else e.field=n._vector;return n.setup(),e.normalNode=n},createCoordinate(e,t,i){if("VEC3"!==e?.type)return null;if(e.coordinateNode)return e.coordinateNode;const n=this.getExecutionContext().createNode("Coordinate",!1);if(n._point=e.array,t instanceof Array&&i instanceof Array){e.field=n._point.copy();const r=this.applyMorphTargets(n._point,t,"POSITION",i);n._point.length=0;for(const e of r)n._point.push(e)}else e.field=n._point;return n.setup(),e.coordinateNode=n},attributesJointsArray:function(e,t,i){if(e instanceof Object&&t instanceof Array&&i instanceof Array)for(let n=0,r=t.length;n<r;++n)this.attributesJointsObject(e,t[n],i[n])},attributesJointsObject:function(e,t,i){if("VEC4"!==t?.type)return;if("VEC4"!==i?.type)return;const n=e.coordinateNode._point.length,r=t.array,s=i.normalizedArray,o=r.length/4;for(let t=0;t<o;++t)for(let i=0;i<4;++i){const o=s[4*t+i];if(0===o)continue;const a=e.joints[r[4*t+i]],l=this.nodes[a]?.transformNode;l&&(l._skinCoordIndex.push(t+n),l._skinCoordWeight.push(o))}},skinGeometry:function(e,t){if(!(e instanceof Object))return;const i=e.coordinateNode,n=i._point.length,r=t._texCoord?.getValue(),s=t._normal?.getValue(),o=t._coord?.getValue();if(t._coordIndex&&(t._coordIndex=t._coordIndex.map((e=>e<0?-1:e+n))),t._index&&(t._index=t._index.map((e=>e<0?-1:e+n))),r)switch(r.getTypeName()){case"TextureCoordinate":{const i=e.textureCoordinateNode,s=i._point;r._point.forEach(((e,t)=>s[t+n]=e)),t._texCoord=i;break}case"MultiTextureCoordinate":{const i=e.multiTextureCoordinateNode;for(const t of r._texCoord){let r=i._texCoord.find((e=>e.mapping===t.mapping))?.getValue();r||("TEXCOORD_0"===t.mapping?r=e.textureCoordinateNode:(r=this.getScene().createNode("TextureCoordinate",!1),r._mapping=t.mapping,r.setup()),i._texCoord.push(r));const s=r._point;t.point.forEach(((e,t)=>s[t+n]=e))}t._texCoord=i;break}}if(s){const i=e.normalNode,r=i._vector;s._vector.forEach(((e,t)=>r[t+n]=e)),t._normal=i}if(o){const e=i._point;o._point.forEach(((t,i)=>e[i+n]=t)),t._coord=i}},createInterpolator(e,t,i,n,r,s,o){const a=this.getExecutionContext();switch(i.path){case"translation":{const i=this.createPositionInterpolator(n,r,s.array,o);return a.addNamedNode(a.getUniqueName("TranslationInterpolator"),i),a.addRoute(e,"fraction_changed",i,"set_fraction"),a.addRoute(i,"value_changed",t,"set_translation"),i}case"rotation":{const i=this.createOrientationInterpolator(n,r,s.normalizedArray,o);return a.addNamedNode(a.getUniqueName("RotationInterpolator"),i),a.addRoute(e,"fraction_changed",i,"set_fraction"),a.addRoute(i,"value_changed",t,"set_rotation"),i}case"scale":{const i=this.createPositionInterpolator(n,r,s.array,o);return a.addNamedNode(a.getUniqueName("ScaleInterpolator"),i),a.addRoute(e,"fraction_changed",i,"set_fraction"),a.addRoute(i,"value_changed",t,"set_scale"),i}case"weights":{const t=this.nodes[i.node],l=this.meshes[t.mesh],u=l?.primitives,h=[];if(!(u instanceof Array))return null;for(const{shapeNode:t,targets:i,attributes:l}of u){const u=t._geometry.getValue();if(!u)continue;const d=this.createArrayInterpolator("CoordinateInterpolator",n,r,s.normalizedArray,o,i,l,"POSITION",!1);d&&(h.push(d),a.addRoute(e,"fraction_changed",d,"set_fraction"),a.addRoute(d,"value_changed",u._coord,"set_point"));const c=this.createArrayInterpolator("NormalInterpolator",n,r,s.normalizedArray,o,i,l,"NORMAL",!0);c&&(h.push(c),a.addRoute(e,"fraction_changed",c,"set_fraction"),a.addRoute(c,"value_changed",u._normal,"set_vector"))}return h}default:return[]}},createPositionInterpolator(e,t,i,n){const r=this.getExecutionContext();switch(e){case"STEP":{const e=r.createNode("PositionInterpolator",!1);e._key.push(t[0]/n);for(let i=1,r=t.length;i<r;++i)e._key.push(t[i]/n,t[i]/n);e._keyValue.push(new Tt(i[0],i[1],i[2]));for(let t=0,n=i.length-3;t<n;t+=3)e._keyValue.push(new Tt(i[t+0],i[t+1],i[t+2]),new Tt(i[t+3],i[t+4],i[t+5]));return e.setup(),e}default:case"LINEAR":{const e=r.createNode("PositionInterpolator",!1);return e._key=t.map((e=>e/n)),e._keyValue=i,e.setup(),e}case"CUBICSPLINE":{const e=r.createNode("PositionInterpolator",!1),s=[];for(let e=0,t=i.length;e<t;e+=3)s.push(new Tt(i[e+0],i[e+1],i[e+2]));const o=Math.floor(30*t.at(-1)),a=Array.from({length:o},((e,i)=>i/(o-1)*t.at(-1)));for(const i of a)e._key.push(i/n),e._keyValue.push(this.cubicSplineVector(i,t,s));return e.setup(),e}}},createOrientationInterpolator(e,t,i,n){const r=this.getExecutionContext();switch(e){case"STEP":{const e=r.createNode("OrientationInterpolator",!1);e._key.push(t[0]/n);for(let i=1,r=t.length;i<r;++i)e._key.push(t[i]/n,t[i]/n);e._keyValue.push(new ui(new Kt(i[0],i[1],i[2],i[3])));for(let t=0,n=i.length-4;t<n;t+=4)e._keyValue.push(new ui(new Kt(i[t+0],i[t+1],i[t+2],i[t+3])),new ui(new Kt(i[t+4],i[t+5],i[t+6],i[t+7])));return e.setup(),e}default:case"LINEAR":{const e=r.createNode("OrientationInterpolator",!1);e._key=t.map((e=>e/n));for(let t=0,n=i.length;t<n;t+=4)e._keyValue.push(new ui(new Kt(i[t+0],i[t+1],i[t+2],i[t+3])));return e.setup(),e}case"CUBICSPLINE":{const e=r.createNode("OrientationInterpolator",!1),s=[];for(let e=0,t=i.length;e<t;e+=4)s.push(new Kt(i[e+0],i[e+1],i[e+2],i[e+3]));const o=Math.floor(30*t.at(-1)),a=Array.from({length:o},((e,i)=>i/(o-1)*t.at(-1)));for(const i of a){const r=this.cubicSplineVector(i,t,s).normalize();e._key.push(i/n),e._keyValue.push(new ui(r))}return e.setup(),e}}},createArrayInterpolator(e,t,i,n,r,s,o,a,l){const u=this.getExecutionContext(),h=o[a];if(!h)return null;switch(t){case"STEP":{const t=u.createNode(e,!1);t._key.push(i[0]/r);for(let e=1,n=i.length;e<n;++e)t._key.push(i[e]/r,i[e]/r);const o=Array.from(s.keys(),(e=>n[e]));for(const e of this.applyMorphTargets(h.field,s,a,o,l))t._keyValue.push(e);for(let e=1,r=i.length;e<r;++e){const i=Array.from(s.keys(),(t=>n[e*s.length+t])),r=this.applyMorphTargets(h.field,s,a,i,l);for(const e of r)t._keyValue.push(e);for(const e of r)t._keyValue.push(e)}return t.setup(),t}default:case"LINEAR":{const t=u.createNode(e,!1);t._key=i.map((e=>e/r));for(const e of i.keys()){const i=Array.from(s.keys(),(t=>n[e*s.length+t]));for(const e of this.applyMorphTargets(h.field,s,a,i,l))t._keyValue.push(e)}return t.setup(),t}case"CUBICSPLINE":{const t=u.createNode(e,!1),o=Math.floor(30*i.at(-1)),d=Array.from({length:o},((e,t)=>t/(o-1)*i.at(-1)));for(const e of d){t._key.push(e/r);const o=Array.from(s.keys(),(t=>this.cubicSplineScalarArray(e,i,n,s.length,t)));for(const e of this.applyMorphTargets(h.field,s,a,o,l))t._keyValue.push(e)}return t.setup(),t}}},applyMorphTargets:function(){const e=new Tt(0,0,0);return function(t,i,n,r,s){const o=Array.from(t,(e=>e.getValue().copy()));for(const[t,a]of i.entries()){const i=r[t];if(!i)continue;const l=this.accessors[a[n]];if("VEC3"!==l?.type)continue;const u=l[s?"normalizedArray":"array"],h=u.length;for(let t=0,n=0;t<h;t+=3,++n)o[n].add(e.set(u[t],u[t+1],u[t+2]).multiply(i))}return o}}(),cubicSplineVector(e,t,i){const n=g.clamp(g.upperBound(t,0,t.length,e),1,t.length-1),r=n-1,s=t[n]-t[r],o=(e-t[r])/s,a=o*o,l=a*o,u=i[3*r+1].copy(),h=i[3*r+2].copy(),d=i[3*n+1].copy(),c=i[3*n+0].copy();return u.multiply(2*l-3*a+1),h.multiply(s*(l-2*a+o)),d.multiply(-2*l+3*a),c.multiply(s*(l-a)),u.add(h).add(d).add(c)},cubicSplineScalarArray(e,t,i,n,r){const s=g.clamp(g.upperBound(t,0,t.length,e),1,t.length-1),o=s-1,a=t[s]-t[o],l=(e-t[o])/a,u=l*l,h=u*l,d=i[(o+1)*n+r],c=i[(o+2)*n+r],p=i[(s+1)*n+r],f=i[(s+0)*n+r];return d*=2*h-3*u+1,c*=a*(h-2*u+l),p*=-2*h+3*u,f*=a*(h-u),d+c+p+f},vectorValue:(e,t)=>e instanceof Array&&(e.length===t.length&&(t.set(...e),!0)),numberValue:(e,t)=>"number"!=typeof e?t:e,stringValue:(e,t)=>"string"!=typeof e?t:e,description:e=>e?.replace(/_+/g," ").trim()??""});const lo=ao;i.add("GLTF2Parser","x_ite/Parser/GLTF2Parser",lo);const uo=lo;var ho=n(328);function co(e){Fs.call(this,e),this.json=[],this.buffers=[]}Object.assign(Object.setPrototypeOf(co.prototype,Fs.prototype),{getEncoding:()=>"ARRAY_BUFFER",setInput(e){this.arrayBuffer=e,this.dataView=new DataView(e)},isValid(){return this.arrayBuffer instanceof ArrayBuffer&&(!(this.dataView.byteLength<12)&&(1179937895===this.dataView.getUint32(0,!0)&&(2===this.dataView.getUint32(4,!0)&&this.dataView.getUint32(8,!0)===this.dataView.byteLength)))},parseIntoScene(e,t){this.glb().then(e).catch(t)},glb:async function(){this.chunks();const e=new uo(this.getScene());e.setBuffers(this.buffers);for(const t of this.json)e.setInput(t),e.isValid()&&await e.rootObject(e.input);return this.getScene()},chunks(){for(let e=12;e<this.dataView.byteLength;){const t=this.dataView.getUint32(e,!0),i=this.dataView.getUint32(e+4,!0);switch(e+=8,i){case 1313821514:this.json.push(ho.decodeText(this.arrayBuffer.slice(e,e+t)));break;case 5130562:this.buffers.push(this.arrayBuffer.slice(e,e+t))}e+=t}return this.getScene()}});const po=co;i.add("GLB2Parser","x_ite/Parser/GLB2Parser",po);const go=po;var fo=n(328);const mo=Ps({whitespaces:/[\x20\n\t\r]+/gy,whitespacesNoLineTerminator:/[\x20\t]+/gy,comment:/#.*?(?=[\n\r])/gy,untilEndOfLine:/([^\r\n]+)/gy,mtllib:/\bmtllib\b/gy,usemtl:/\busemtl\b/gy,newmtl:/\bnewmtl\b/gy,Ka:/\bKa\b/gy,Kd:/\bKd\b/gy,Ks:/\bKs\b/gy,Ns:/\bNs\b/gy,d:/\bd\b/gy,Tr:/\bTr\b/gy,illum:/\billum\b/gy,map_Kd:/\bmap_Kd\b/gy,o:/\bo\b/gy,v:/\bv\b/gy,vt:/\bvt\b/gy,vn:/\bvn\b/gy,g:/\bg\b/gy,s:/\bs\b/gy,off:/\boff\b/gy,f:/\bf\b/gy,slash:/\//gy,int32:/((?:0[xX][\da-fA-F]+)|(?:[+-]?\d+))/gy,double:/([+-]?(?:(?:(?:\d*\.\d+)|(?:\d+(?:\.)?))(?:[eE][+-]?\d+)?))/gy,constants:/([+-])((?:NAN|INF|INFINITY))/giy});function _o(e){Fs.call(this,e),to.call(this),this.removeGroups=!0,this.removeEmptyGroups=!0,this.combineGroupingNodes=!1,this.smoothingGroup=0,this.smoothingGroups=new Map,this.groups=new Map,this.materials=new Map,this.textures=new Map,this.point2=new _t,this.point3=new Tt,this.lastIndex=0}function xo(e,t){this.executionContext=e,this.input=t,this.material=e.createNode("Material"),this.materials=new Map,this.textures=new Map,this.color3=new Fe(0,0,0),this.id=""}Object.assign(Object.setPrototypeOf(_o.prototype,Fs.prototype),to.prototype,{CONSTANTS:new Map([["NAN",NaN],["INF",1/0],["INFINITY",1/0]]),getEncoding:()=>"STRING",setInput(e){this.input=e},isValid(){return"string"==typeof this.input&&!!this.input.match(/^(?:[\x20\n\t\r]+|#.*?[\r\n])*\b(?:mtllib|usemtl|o|g|s|vt|vn|v|f)\b/)},parseIntoScene(e,t){this.obj().then(e).catch(t)},obj:async function(){const e=this.getBrowser(),t=this.getScene();return t.setEncoding("OBJ"),t.setProfile(e.getProfile("Interchange")),await this.loadComponents(),this.object=t.createNode("Transform"),this.group=t.createNode("Group"),this.defaultMaterial=t.createNode("Material"),this.texCoord=t.createNode("TextureCoordinate"),this.normal=t.createNode("Normal"),this.coord=t.createNode("Coordinate"),this.object.children.push(this.group),t.getRootNodes().push(this.object),await this.statements(),this.optimizeSceneGraph(t.getRootNodes()),this.getScene()},comments(){for(;this.comment(););},comment(){return this.whitespaces(),!!mo.comment.parse(this)},whitespaces(){mo.whitespaces.parse(this)},whitespacesNoLineTerminator(){mo.whitespacesNoLineTerminator.parse(this)},statements:async function(){for(;await this.statement(););},statement:async function(){return!!await this.mtllibs()||(!!this.usemtl()||(!!this.o()||(!!this.g()||(!!this.s()||(!!this.vts()||(!!this.vns()||(!!this.vs()||(!!this.fs()||!!mo.untilEndOfLine.parse(this)))))))))},mtllibs:async function(){if(this.comments(),mo.mtllib.parse(this)){if(this.whitespacesNoLineTerminator(),mo.untilEndOfLine.parse(this)){const e=this.result[1].trim().split(/\s+/);await Promise.all(e.map((e=>this.mtllib(e))))}return!0}return!1},mtllib:async function(e){try{const t=this.getExecutionContext(),i=new URL(e,t.getBaseURL()),n=await fetch(i),r=await n.arrayBuffer(),s=new xo(t,fo.decodeText(fo.ungzip(r)));s.parse();for(const[e,i]of s.materials){const n=this.sanitizeName(e);n&&(t.addNamedNode(t.getUniqueName(n),i),t.addExportedNode(t.getUniqueExportName(n),i)),this.materials.set(e,i)}for(const[e,i]of s.textures){const n=this.sanitizeName(e);n&&(t.addNamedNode(t.getUniqueName(n),i),t.addExportedNode(t.getUniqueExportName(n),i)),this.textures.set(e,i)}}catch(e){console.warn(e)}},usemtl(){if(this.comments(),mo.usemtl.parse(this)){if(this.whitespacesNoLineTerminator(),mo.untilEndOfLine.parse(this)){const e=this.result[1];this.material=this.materials.get(e)||this.defaultMaterial,this.texture=this.textures.get(e);const t=this.smoothingGroups.get(this.group.getNodeName());t&&t.delete(this.smoothingGroup)}return!0}return!1},o(){if(this.comments(),mo.o.parse(this)){if(this.whitespacesNoLineTerminator(),mo.untilEndOfLine.parse(this)){const e=this.getExecutionContext(),t=this.sanitizeName(this.result[1]);this.group.children.length&&(this.object=e.createNode("Transform"),this.group=e.createNode("Group"),this.object.children.push(this.group),e.getRootNodes().push(this.object)),t&&(e.addNamedNode(e.getUniqueName(t),this.object),e.addExportedNode(e.getUniqueExportName(t),this.object))}return!0}return!1},g(){if(this.comments(),mo.g.parse(this)){if(this.whitespacesNoLineTerminator(),mo.untilEndOfLine.parse(this)){const e=this.getExecutionContext(),t=this.result[1],i=this.sanitizeName(t),n=this.groups.get(t);n?this.group=n:this.group.children.length&&(this.group=e.createNode("Group"),this.object.children.push(this.group)),this.groups.set(t,this.group),i&&(e.addNamedNode(e.getUniqueName(i),this.group),e.addExportedNode(e.getUniqueExportName(i),this.group)),this.smoothingGroup=0}return!0}return!1},s(){return this.comments(),!!mo.s.parse(this)&&(this.whitespacesNoLineTerminator(),mo.off.parse(this)?(this.smoothingGroup=0,!0):!this.int32()||(this.smoothingGroup=this.value,!0))},vts(){const e=this.texCoord.point;let t=!1;for(;this.vt(e);)t=!0;return t},vt(e){if(this.comments(),mo.vt.parse(this)){if(this.vec2())return e.push(this.point2),!0;throw new Error("Expected a texture coordinate.")}return!1},vns(){const e=this.normal.vector;let t=!1;for(;this.vn(e);)t=!0;return t},vn(e){if(this.comments(),mo.vn.parse(this)){if(this.vec3())return e.push(this.point3),!0;throw new Error("Expected a normal vector.")}return!1},vs(){const e=this.coord.point;let t=!1;for(;this.v(e);)t=!0;return t},v(e){if(this.comments(),mo.v.parse(this)){if(this.vec3())return e.push(this.point3),!0;throw new Error("Expected a vertex coordinate.")}return!1},fs(){if(this.comments(),mo.f.lookahead(this)){try{this.shape=this.smoothingGroups.get(this.group.getNodeName()).get(this.smoothingGroup),this.geometry=this.shape.geometry}catch{const e=this.getExecutionContext(),t=e.createNode("Appearance");this.geometry=e.createNode("IndexedFaceSet"),this.shape=e.createNode("Shape"),t.material=this.material,t.texture=this.texture,this.geometry.creaseAngle=this.smoothingGroup?Math.PI:0,this.shape.appearance=t,this.shape.geometry=this.geometry,this.group.children.push(this.shape),this.smoothingGroups.has(this.group.getNodeName())||this.smoothingGroups.set(this.group.getNodeName(),new Map),this.smoothingGroups.get(this.group.getNodeName()).set(this.smoothingGroup,this.shape)}for(;this.f(););return this.geometry.texCoordIndex.length&&(this.geometry.texCoord=this.texCoord),this.geometry.normalIndex.length&&(this.geometry.normal=this.normal),this.geometry.coord=this.coord,!0}return!1},f(){if(this.comments(),mo.f.parse(this)){const e=this.geometry,t=e.texCoordIndex,i=e.normalIndex,n=e.coordIndex,r=t.length,s=i.length,o=this.texCoord.point.length,a=this.normal.vector.length,l=this.coord.point.length;for(;this.indices(t,i,n,o,a,l););return t.length!==r&&t.push(-1),i.length!==s&&i.push(-1),n.push(-1),!0}return!1},indices(e,t,i,n,r,s){return!!this.int32()&&(i.push(this.index(this.value,s)),mo.slash.parse(this)&&(this.int32()&&e.push(this.index(this.value,n)),mo.slash.parse(this)&&this.int32()&&t.push(this.index(this.value,r))),!0)},index(e,t){if(0===e)throw new Error("Invalid index.");return e<0?t+e:e-1},int32(){return this.whitespaces(),!!mo.int32.parse(this)&&(this.value=parseInt(this.result[1]),!0)},double(){return this.whitespaces(),mo.double.parse(this)?(this.value=parseFloat(this.result[1]),!0):!!mo.constants.parse(this)&&(this.value=this.CONSTANTS.get(this.result[2].toUpperCase()),"-"===this.result[1]&&(this.value=-this.value),!0)},vec2(){return!(!this.double()||(this.point2.x=this.value,!this.double()))&&(this.point2.y=this.value,!0)},vec3(){return!!(this.double()&&(this.point3.x=this.value,this.double()&&(this.point3.y=this.value,this.double())))&&(this.point3.z=this.value,!0)}}),Object.assign(xo.prototype,{CONSTANTS:new Map([["NAN",NaN],["INF",1/0],["INFINITY",1/0]]),parse(){try{this.statements()}catch(e){S}},comments(){for(;this.comment(););},comment(){return this.whitespaces(),!!mo.comment.parse(this)},whitespaces(){mo.whitespaces.parse(this)},whitespacesNoLineTerminator(){mo.whitespacesNoLineTerminator.parse(this)},statements(){for(;this.statement(););},statement(){return!!this.newmtl()||(!!this.Ka()||(!!this.Kd()||(!!this.Ks()||(!!this.Ns()||(!!this.d()||(!!this.Tr()||(!!this.illum()||(!!this.map_Kd()||!!mo.untilEndOfLine.parse(this)))))))))},newmtl(){return this.comments(),!!mo.newmtl.parse(this)&&(this.whitespacesNoLineTerminator(),this.id="",mo.untilEndOfLine.parse(this)?(this.id=this.result[1],this.material=this.executionContext.createNode("Material"),this.materials.set(this.id,this.material),!0):(mo.untilEndOfLine.parse(this),!0))},Ka(){if(this.comments(),mo.Ka.parse(this)){if(this.col3()){const e=this.color3.getHSV([]);return this.material.ambientIntensity=e[2],!0}return mo.untilEndOfLine.parse(this),!0}return!1},Kd(){return this.comments(),!!mo.Kd.parse(this)&&(this.col3()?(this.material.diffuseColor=this.color3,!0):(mo.untilEndOfLine.parse(this),!0))},Ks(){return this.comments(),!!mo.Ks.parse(this)&&(this.col3()?(this.material.specularColor=this.color3,!0):(mo.untilEndOfLine.parse(this),!0))},Ns(){return this.comments(),!!mo.Ns.parse(this)&&(this.double()?(this.material.shininess=this.value/1e3,!0):(mo.untilEndOfLine.parse(this),!0))},d(){return this.comments(),!!mo.d.parse(this)&&(this.double()?(this.material.transparency=1-this.value,!0):(mo.untilEndOfLine.parse(this),!0))},Tr(){return this.comments(),!!mo.Tr.parse(this)&&(this.double()?(this.material.transparency=this.value,!0):(mo.untilEndOfLine.parse(this),!0))},illum(){return this.comments(),!!mo.illum.parse(this)&&(this.int32()||mo.untilEndOfLine.parse(this),!0)},map_Kd(){if(this.comments(),mo.map_Kd.parse(this)){if(this.whitespacesNoLineTerminator(),mo.untilEndOfLine.parse(this)){const e=this.result[1];if(e.length&&this.id.length){const t=e.trim().split(/\s+/);if(t.length){const e=this.executionContext.createNode("ImageTexture"),i=t.at(-1).replace(/\\/g,"/");e.url=[i],this.textures.set(this.id,e)}}return!0}return mo.untilEndOfLine.parse(this),!0}return!1},int32(){return this.whitespaces(),!!mo.int32.parse(this)&&(this.value=parseInt(this.result[1]),!0)},double(){return this.whitespaces(),mo.double.parse(this)?(this.value=parseFloat(this.result[1]),!0):!!mo.constants.parse(this)&&(this.value=this.CONSTANTS.get(this.result[2].toUpperCase()),"-"===this.result[1]&&(this.value=-this.value),!0)},col3(){return!!(this.double()&&(this.color3.r=this.value,this.double()&&(this.color3.g=this.value,this.double())))&&(this.color3.b=this.value,!0)}});const yo=_o;i.add("OBJParser","x_ite/Parser/OBJParser",yo);const wo=yo,bo=Ps({whitespaces:/[\x20\n\t\r]+/gy,whitespacesNoLineTerminator:/[\x20\t]+/gy,comment:/;.*?(?=[\n\r])/gy,untilEndOfLine:/([^\r\n]+)/gy,solid:/solid/gy,facet:/facet/gy,normal:/normal/gy,outer:/outer/gy,loop:/loop/gy,vertex:/vertex/gy,endloop:/endloop/gy,endfacet:/endfacet/gy,endsolid:/endsolid/gy,name:/(\w+)/gy,double:/([+-]?(?:(?:(?:\d*\.\d+)|(?:\d+(?:\.)?))(?:[eE][+-]?\d+)?))/gy,constants:/([+-])((?:NAN|INF|INFINITY))/giy});function So(e){Fs.call(this,e),this.vector=[],this.point=[]}Object.assign(Object.setPrototypeOf(So.prototype,Fs.prototype),{CONSTANTS:new Map([["NAN",NaN],["INF",1/0],["INFINITY",1/0]]),getEncoding:()=>"STRING",setInput(e){this.input=e},isValid(){return"string"==typeof this.input&&!!this.input.match(/^(?:[\x20\n\t\r]+|;.*?[\r\n])*\b(?:solid)\b/)},parseIntoScene(e,t){this.stl().then(e).catch(t)},stl:async function(){const e=this.getBrowser(),t=this.getScene();return t.setEncoding("STL"),t.setProfile(e.getProfile("Interchange")),await this.loadComponents(),this.material=t.createNode("Material"),this.appearance=t.createNode("Appearance"),this.material.diffuseColor=Fe.White,this.appearance.material=this.material,this.statements(),this.getScene()},comments(){for(;this.comment(););},comment(){return this.whitespaces(),!!bo.comment.parse(this)},whitespaces(){bo.whitespaces.parse(this)},whitespacesNoLineTerminator(){bo.whitespacesNoLineTerminator.parse(this)},statements(){for(;this.solid(););},solid(){if(this.comments(),bo.solid.parse(this)){this.whitespacesNoLineTerminator();const e=this.getExecutionContext(),t=e.createNode("Shape"),i=e.createNode("TriangleSet"),n=e.createNode("Normal"),r=e.createNode("Coordinate"),s=this.sanitizeName(bo.name.parse(this)?this.result[1]:"");if(bo.untilEndOfLine.parse(this),this.facets(),t.appearance=this.appearance,t.geometry=i,i.normalPerVertex=!1,i.normal=n,i.coord=r,n.vector=this.vector,r.point=this.point,s&&(e.addNamedNode(e.getUniqueName(s),t),e.addExportedNode(e.getUniqueExportName(s),t)),e.getRootNodes().push(t),this.comments(),bo.endsolid.parse(this))return!0;throw new Error("Expected 'endsolid' statement.")}return!1},facets(){for(this.vector.length=0,this.point.length=0;this.facet(););},facet(){if(this.comments(),bo.facet.parse(this)&&this.normal()&&this.loop()){if(this.comments(),bo.endfacet.parse(this))return!0;throw new Error("Expected 'endfacet' statement.")}return!1},normal(){if(this.whitespacesNoLineTerminator(),bo.normal.parse(this)){if(this.double()){if(this.vector.push(this.value),this.double()){if(this.vector.push(this.value),this.double())return this.vector.push(this.value),!0;throw new Error("Expected a double.")}throw new Error("Expected a double.")}throw new Error("Expected a double.")}throw new Error("Expected 'normal' statement.")},loop(){if(this.comments(),bo.outer.parse(this)){if(this.whitespacesNoLineTerminator(),bo.loop.parse(this)&&this.vertex()&&this.vertex()&&this.vertex()){if(this.comments(),bo.endloop.parse(this))return!0;throw new Error("Expected 'endloop' statement.")}throw new Error("Expected 'loop' statement.")}throw new Error("Expected 'outer' statement.")},vertex(){if(this.comments(),bo.vertex.parse(this)){if(this.double()){if(this.point.push(this.value),this.double()){if(this.point.push(this.value),this.double())return this.point.push(this.value),!0;throw new Error("Expected a double.")}throw new Error("Expected a double.")}throw new Error("Expected a double.")}throw new Error("Expected 'vertex' statement.")},double(){return this.whitespacesNoLineTerminator(),bo.double.parse(this)?(this.value=parseFloat(this.result[1]),!0):!!bo.constants.parse(this)&&(this.value=this.CONSTANTS.get(this.result[2].toUpperCase()),"-"===this.result[1]&&(this.value=-this.value),!0)}});const To=So;i.add("STLAParser","x_ite/Parser/STLAParser",To);const vo=To;function Oo(e){Fs.call(this,e)}Object.assign(Object.setPrototypeOf(Oo.prototype,Fs.prototype),{getEncoding:()=>"ARRAY_BUFFER",setInput(e){this.arrayBuffer=e,this.dataView=new DataView(e)},isValid(){if(!(this.arrayBuffer instanceof ArrayBuffer))return!1;if(this.dataView.byteLength<84)return!1;return 50*this.dataView.getUint32(80,!0)+84===this.dataView.byteLength},parseIntoScene(e,t){this.stl().then(e).catch(t)},stl:async function(){const e=this.getBrowser(),t=this.getScene();return t.setEncoding("STL"),t.setProfile(e.getProfile("Interchange")),await this.loadComponents(),this.material=t.createNode("Material"),this.appearance=t.createNode("Appearance"),this.material.diffuseColor=Fe.White,this.appearance.material=this.material,this.shape(),this.getScene()},shape(){const e=this.getExecutionContext(),t=e.createNode("Shape"),i=e.createNode("TriangleSet"),n=e.createNode("Normal"),r=e.createNode("Coordinate"),s=this.dataView,o=this.dataView.byteLength,a=[],l=[];for(let e=84;e<o;e+=50){for(let t=0;t<3;++t)a.push(s.getFloat32(e+4*t,!0));for(let t=3;t<12;++t)l.push(s.getFloat32(e+4*t,!0))}t.appearance=this.appearance,t.geometry=i,i.normalPerVertex=!1,i.normal=n,i.coord=r,n.vector=a,r.point=l,e.getRootNodes().push(t)}});const Eo=Oo;i.add("STLBParser","x_ite/Parser/STLBParser",Eo);const Co=Eo,No=Ps({whitespaces:/[\x20\n\t\r]+/gy,whitespacesNoLineTerminator:/[\x20\t]+/gy,untilEndOfLine:/([^\r\n]+)/gy,line:/.*?\r?\n/gy,ply:/ply/gy,format:/format ascii 1.0/gy,comment:/\bcomment\b/gy,element:/\belement\b/gy,elementName:/\b(\S+)\b/gy,property:/\bproperty\b/gy,propertyList:/\blist\b/gy,propertyType:/\b(char|uchar|short|ushort|int|uint|float|double|int8|uint8|int16|uint16|int32|uint32|float32|float64)\b/gy,propertyName:/\b(\S+)\b/gy,endHeader:/\bend_header\b/gy,double:/([+-]?(?:(?:(?:\d*\.\d+)|(?:\d+(?:\.)?))(?:[eE][+-]?\d+)?))/gy,int32:/((?:0[xX][\da-fA-F]+)|(?:[+-]?\d+))/gy});function Io(e){Fs.call(this,e),this.comments=[],this.attrib=[],this.typeMapping=new Map([["char",this.int32],["uchar",this.int32],["short",this.int32],["ushort",this.int32],["int",this.int32],["uint",this.int32],["float",this.double],["double",this.double],["int8",this.int32],["uint8",this.int32],["int16",this.int32],["uint16",this.int32],["int32",this.int32],["uint32",this.int32],["float32",this.double],["float64",this.double]])}Object.assign(Object.setPrototypeOf(Io.prototype,Fs.prototype),{getEncoding:()=>"STRING",setInput(e){this.input=e},isValid(){return this.input.match(/^ply\r?\nformat ascii 1.0/)},parseIntoScene(e,t){this.ply().then(e).catch(t)},ply:async function(){const e=this.getBrowser(),t=this.getScene();return t.setEncoding("PLY"),t.setProfile(e.getProfile("Interchange")),await this.loadComponents(),await this.processElements(this.header([])),this.getScene()},whitespacesOrComments(){for(;this.whitespaces()||this.comment(););},whitespaces(){return No.whitespaces.parse(this)},whitespacesNoLineTerminator(){No.whitespacesNoLineTerminator.parse(this)},comment(){return!(!No.comment.parse(this)||!No.untilEndOfLine.parse(this))&&(this.comments.push(this.result[1].trim()),!0)},double(){return this.whitespacesNoLineTerminator(),!!No.double.parse(this)&&(this.value=parseFloat(this.result[1]),!0)},int32(){return this.whitespacesNoLineTerminator(),!!No.int32.parse(this)&&(this.value=parseInt(this.result[1]),!0)},convertColor(e,t){switch(t){case"uchar":case"uint8":return e/255;case"ushort":case"uint16":return e/1048575;case"uint":case"uint32":return e/4294967295;case"float":case"float32":case"double":case"float64":return e}},header(e){No.ply.parse(this),No.whitespaces.parse(this),No.format.parse(this),this.headings(e);const t=this.getScene(),i=t.createNode("WorldInfo");return i.title=new URL(t.worldURL).pathname.split("/").at(-1),i.info=this.comments,t.rootNodes.push(i),e},headings(e){for(;this.head(e););},head(e){return!!this.element(e)||!No.endHeader.parse(this)&&!!No.untilEndOfLine.parse(this)},element(e){if(this.whitespacesOrComments(),No.element.parse(this)&&(this.whitespacesNoLineTerminator(),No.elementName.parse(this))){const t=this.result[1];if(this.int32()){const i={name:t,count:this.value,properties:[]};return this.properties(i.properties),e.push(i),!0}}return!1},properties(e){for(;this.property(e););},property(e){if(this.whitespacesOrComments(),No.property.parse(this)){if(this.whitespacesNoLineTerminator(),No.propertyType.parse(this)){const t=this.result[1],i=this.typeMapping.get(t);if(this.whitespacesNoLineTerminator(),No.propertyName.parse(this)){const n=this.result[1];return e.push({type:t,value:i,name:n}),!0}}if(No.propertyList.parse(this)&&(this.whitespacesNoLineTerminator(),No.propertyType.parse(this))){const t=this.typeMapping.get(this.result[1]);if(this.whitespacesNoLineTerminator(),No.propertyType.parse(this)){const i=this.result[1],n=this.typeMapping.get(i);if(this.whitespacesNoLineTerminator(),No.propertyName.parse(this)){const r=this.result[1];return e.push({count:t,type:i,value:n,name:r}),!0}}}}return!1},async processElements(e){for(const t of e)await this.processElement(t);if(!this.coord)return;const t=this.getScene(),i=t.createNode("Shape"),n=t.createNode("Appearance"),r=t.createNode(this.geometry?"Material":"UnlitMaterial"),s=this.geometry??t.createNode("PointSet");if(n.material=r,this.texCoord){const e=t.createNode("TextureTransform");e.translation.y=-1,e.scale.y=-1,n.textureTransform=e}"PointSet"!==s.getNodeTypeName()&&(s.solid=!1,s.texCoord=this.texCoord),s.attrib=this.attrib,s.color=this.color,s.normal=this.normal,s.coord=this.coord,i.appearance=n,i.geometry=s,t.rootNodes.push(i)},async processElement(e){switch(e.name){case"vertex":await this.parseVertices(e);break;case"face":this.parseFaces(e);break;case"multi_texture_vertex":this.parseMultiTextureVertices(e);break;case"multi_texture_face":this.parseMultiTextureFaces(e);break;default:this.parseUnknown(e)}},async parseVertices({count:e,properties:t}){const i=this.getScene(),n=[],r=i.createNode("TextureCoordinate"),s=[],o=i.createNode("Normal"),a=[],l=i.createNode("Coordinate"),u=[],h=new Map;for(const{name:e}of t)e.match(/^(?:red|green|blue|alpha|r|g|b|a|s|t|u|v|nx|ny|nz|x|y|z)$/)||h.set(e,[]);for(let i=0;i<e;++i){this.whitespaces();for(const{value:e,name:i,type:r}of t){if(!e.call(this))throw new Error(`Couldn't parse value for property ${i}.`);switch(i){default:h.get(i).push(this.value);break;case"red":case"green":case"blue":case"alpha":case"r":case"g":case"b":case"a":n.push(this.convertColor(this.value,r));break;case"s":case"t":case"u":case"v":s.push(this.value);break;case"nx":case"ny":case"nz":a.push(this.value);break;case"x":case"y":case"z":u.push(this.value)}}}if(h.size){i.addComponent(this.getBrowser().getComponent("Shaders",1)),await this.loadComponents();for(const[e,t]of h){const n=i.createNode("FloatVertexAttribute");n.name=e,n.numComponents=1,n.value=t,this.attrib.push(n)}}const d=t.some((e=>e.name.match(/^(?:alpha|a)$/))),c=d&&n.some(((e,t)=>t%4==3&&e<1)),p=i.createNode(c?"ColorRGBA":"Color");p.color=c||!d?n:n.filter(((e,t)=>t%4!=3)),r.point=s,o.vector=a,l.point=u,this.color=n.length?p:null,this.texCoord=s.length?r:null,this.normal=a.length?o:null,this.coord=l},parseFaces({count:e,properties:t}){const i=this.getScene().createNode("IndexedFaceSet"),n=[];for(let i=0;i<e;++i){this.whitespaces();for(const{count:e,value:i,name:r}of t){if(!e.call(this))throw new Error(`Couldn't parse property count for ${r}.`);const t=this.value;for(let e=0;e<t;++e){if(!i.call(this))throw new Error(`Couldn't parse a property value for ${r}.`);n.push(this.value)}n.push(-1)}}i.coordIndex=n,this.geometry=i},parseMultiTextureVertices({count:e,properties:t}){const i=this.getScene().createNode("TextureCoordinate"),n=[];for(let i=0;i<e;++i){this.whitespaces();for(const{value:e,name:i}of t){if(!e.call(this))throw new Error(`Couldn't parse value for property ${i}.`);switch(i){case"s":case"t":case"u":case"v":n.push(this.value)}}}i.point=n,this.texCoord=n.length?i:null},parseMultiTextureFaces({count:e,properties:t}){const i=[];for(let n=0;n<e;++n)for(const{count:e,value:n,name:r}of t)if(e){if(!e.call(this))throw new Error(`Couldn't parse property count for ${r}.`);const t=this.value;for(let e=0;e<t;++e){if(!n.call(this))throw new Error(`Couldn't parse value for property ${r}.`);i.push(this.value)}i.push(-1)}else if(!n.call(this))throw new Error(`Couldn't parse value for property ${r}.`);this.geometry&&(this.geometry.texCoordIndex=i)},parseUnknown({count:e}){this.whitespaces();for(let t=0;t<e;++t)No.line.parse(this)}});const Fo=Io;i.add("PLYAParser","x_ite/Parser/PLYAParser",Fo);const Mo=Fo;function Do(e){Mo.call(this,e),this.typeMapping=new Map([["char",this.binaryInt8],["uchar",this.binaryUint8],["short",this.binaryInt16],["ushort",this.binaryUint16],["int",this.binaryInt32],["uint",this.binaryUint32],["float",this.binaryFloat32],["double",this.binaryFloat64],["int8",this.binaryInt8],["uint8",this.binaryUint8],["int16",this.binaryInt16],["uint16",this.binaryUint16],["int32",this.binaryInt32],["uint32",this.binaryUint32],["float32",this.binaryFloat32],["float64",this.binaryFloat64]]),this.binaryInt8.bytes=1,this.binaryUint8.bytes=1,this.binaryInt16.bytes=2,this.binaryUint16.bytes=2,this.binaryInt32.bytes=4,this.binaryUint32.bytes=4,this.binaryFloat32.bytes=4,this.binaryFloat64.bytes=8}Object.assign(Object.setPrototypeOf(Do.prototype,Mo.prototype),{getEncoding:()=>["ARRAY_BUFFER","STRING"],setInput(e){this.arrayBuffer=e[0],this.dataView=new DataView(this.arrayBuffer),this.input=e[1],this.magic=this.input.match(/^ply\r?\nformat (binary_(?:little|big)_endian) 1.0.*?end_header\r?\n/s),this.byteOffset=this.magic?.[0].length,this.littleEndian="binary_little_endian"===this.magic?.[1]},isValid(){return this.arrayBuffer instanceof ArrayBuffer&&!!this.magic},binaryInt8(){return this.value=this.dataView.getInt8(this.byteOffset,this.littleEndian),this.byteOffset+=1,!0},binaryUint8(){return this.value=this.dataView.getUint8(this.byteOffset,this.littleEndian),this.byteOffset+=1,!0},binaryInt16(){return this.value=this.dataView.getInt16(this.byteOffset,this.littleEndian),this.byteOffset+=2,!0},binaryUint16(){return this.value=this.dataView.getUint16(this.byteOffset,this.littleEndian),this.byteOffset+=2,!0},binaryInt32(){return this.value=this.dataView.getInt32(this.byteOffset,this.littleEndian),this.byteOffset+=4,!0},binaryUint32(){return this.value=this.dataView.getUint32(this.byteOffset,this.littleEndian),this.byteOffset+=4,!0},binaryFloat32(){return this.value=this.dataView.getFloat32(this.byteOffset,this.littleEndian),this.byteOffset+=4,!0},binaryFloat64(){return this.value=this.dataView.getFloat64(this.byteOffset,this.littleEndian),this.byteOffset+=8,!0},processElements(e){return this.whitespaces=Function.prototype,Mo.prototype.processElements.call(this,e)},parseUnknown({count:e,properties:t}){for(let i=0;i<e;++i)for(const{count:e,type:i}of t)e?(e.call(this),this.byteOffset+=this.value*this.typeMapping.get(i).bytes):this.byteOffset+=this.typeMapping.get(i).bytes}});const Ro=Do;i.add("PLYBParser","x_ite/Parser/PLYBParser",Ro);const Po=Ro;function Ao(e,t){this.real=e,this.imag=t}Object.assign(Ao.prototype,{*[Symbol.iterator](){yield this.real,yield this.imag},copy(){const e=Object.create(Ao.prototype);return e.real=this.real,e.imag=this.imag,e},assign(e){return this.real=e.real,this.imag=e.imag,this},equals(e){return this.real===e.real&&this.imag===e.imag},set(e,t){return this.real=e,this.imag=t,this},setPolar(e,t){return this.real=e*Math.cos(t),this.imag=e*Math.sin(t),this},conjugate(){return this.imag=-this.imag,this},negate(){return this.real=-this.real,this.imag=-this.imag,this},inverse(){const e=this.real*this.real+this.imag*this.imag;return this.real/=e,this.imag/=-e,this},add(e){return this.real+=e.real,this.imag+=e.imag,this},subtract(e){return this.real-=e.real,this.imag-=e.imag,this},multiply(e){return this.real*=e,this.imag*=e,this},multComp(e){const{real:t,imag:i}=this,{real:n,imag:r}=e;return this.real=t*n-i*r,this.imag=t*r+i*n,this},divide(e){return this.real/=e,this.imag/=e,this},divComp(e){const{real:t,imag:i}=this,{real:n,imag:r}=e,s=n*n+r*r;return this.real=(t*n+i*r)/s,this.imag=(i*n-t*r)/s,this},toString(){let e="";return e+=this.real,this.imag<0?(e+=this.imag,e+="i"):this.imag>0&&(e+="+",e+=this.imag,e+="i"),e}}),Object.defineProperties(Ao.prototype,{length:{value:2},0:{get(){return this.real},set(e){this.real=e}},1:{get(){return this.imag},set(e){this.imag=e}},magnitude:{get(){return this.real?this.imag?Math.hypot(this.real,this.imag):Math.abs(this.real):Math.abs(this.imag)},set(e){this.setPolar(e,this.angle)}},angle:{get(){return Math.atan2(this.imag,this.real)},set(e){this.setPolar(this.magnitude,e)}}}),Object.assign(Ao,{Polar:(e,t)=>Object.create(Ao.prototype).setPolar(e,t),multiply:(e,t)=>e.copy().multiply(t)});const Vo=Ao;i.add("Complex","standard/Math/Numbers/Complex",Vo);const Lo=Vo;function Bo(){this.matrix=new At,this.set(...arguments)}Object.assign(Bo.prototype,{copy(){const e=Object.create(Bo.prototype);return e.matrix=this.matrix.copy(),e},assign(e){return this.matrix.assign(e.matrix),this},equals(e){return this.matrix.equals(e.matrix)},set(e,t){switch(arguments.length){case 0:return this.matrix.set(0,0,0,0,0,0,0,0,0),this;case 2:return this.matrix.set(e.x/2,0,0,0,e.y/2,0,t.x,t.y,1),this}},setExtents(e,t){const i=(t.x-e.x)/2,n=(t.y-e.y)/2,r=(t.x+e.x)/2,s=(t.y+e.y)/2;return this.matrix.set(i,0,0,0,n,0,r,s,1),this},isEmpty(){return 0===this.matrix[8]},add:(()=>{const e=new _t(0,0),t=new _t(0,0),i=new _t(0,0),n=new _t(0,0);return function(r){return this.isEmpty()?this.assign(r):r.isEmpty()?this:(this.getExtents(e,t),r.getExtents(i,n),this.setExtents(e.min(i),t.max(n)))}})(),multLeft(e){return this.matrix.multLeft(e),this},multRight(e){return this.matrix.multRight(e),this},getExtents(e,t){this.getAbsoluteExtents(e,t),e.add(this.center),t.add(this.center)},getAbsoluteExtents:(()=>{const e=new _t(0,0);return function(t,i){const n=this.matrix,r=n.xAxis,s=n.yAxis;e.assign(r).add(s);const o=s.subtract(r);t.assign(e).min(o),i.assign(e).max(o),e.negate(),o.negate(),t.min(e,o),i.max(e,o)}})(),containsPoint:(()=>{const e=new _t(0,0),t=new _t(0,0);return function(i){return this.getExtents(e,t),e.x<=i.x&&t.x>=i.x&&e.y<=i.y&&t.y>=i.y}})(),toString(){return`${this.size}, ${this.center}`}}),Object.assign(Bo,{Extents:(e,t)=>(new Bo).setExtents(e,t),Points(e){const t=new _t(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new _t(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const n of e)t.min(n),i.max(n);return(new Bo).setExtents(t,i)}}),Object.defineProperties(Bo.prototype,{size:{get:(()=>{const e=new _t(0,0),t=new _t(0,0);return function(){return this.getAbsoluteExtents(e,t),t.subtract(e)}})(),enumerable:!0},center:{get(){return this.matrix.origin},enumerable:!0}});const Uo=Bo;i.add("Box2","standard/Math/Geometry/Box2",Uo);const Xo=Uo,{interval:jo}=g,ko={quadric:(()=>{const e=new At(1,0,0,-2,2,0,1,-2,1),t=new At;return function(i,n,r,s,o,a,l,u,h,d,c){t.set(i,n,r,s,o,a,l,u,h).multLeft(e);for(let e=0,i=d-1;e<d;++e){const n=e/i;c.push(t.multVecMatrix(new Tt(1,n,n*n)))}}})(),cubic:(()=>{const e=new Gt(0,0,0,0),t=new gi(1,0,0,0,-3,3,0,0,3,-6,3,0,-1,3,-3,1),i=new gi;return function(n,r,s,o,a,l,u,h,d,c,p,g,f,m){i.set(n,r,s,0,o,a,l,0,u,h,d,0,c,p,g,0).multLeft(t);for(let t=0,n=f-1;t<f;++t){const r=t/n;i.multVecMatrix(e.set(1,r,r*r,r*r*r)),m.push(new Tt(e.x,e.y,e.z))}}})(),arc(e,t,i,n,r,s,o,a,l,u,h){if(e===a&&t===l)return void h.push(new Tt(a,l,0));if(i=Math.abs(i),n=Math.abs(n),0===i||0===n)return void h.push(new Tt(e,t,0),new Tt(a,l,0));const d=i*i,c=n*n;r=jo(r,0,2*Math.PI);const p=Math.sin(r),g=Math.cos(r),f=new _t(e-a,t-l).divide(2),m=new _t(g*f.x+p*f.y,-p*f.x+g*f.y),_=m.copy().multVec(m),x=_.x/d+_.y/c;x>1&&(i=Math.sqrt(x)*i,n=Math.sqrt(x)*n);let y=(d*c-d*_.y-c*_.x)/(d*_.y+c*_.x);y=Math.max(0,y);const w=(s!==o?1:-1)*Math.sqrt(y),b=new _t(w*i*m.y/n,-w*n*m.x/i),S=new _t(g*b.x-p*b.y+(e+a)/2,p*b.x+g*b.y+(t+l)/2),T=new _t((m.x-b.x)/i,(m.y-b.y)/n),v=new _t((-m.x-b.x)/i,(-m.y-b.y)/n),O=e=>e>0?e:2*Math.PI+e,E=O(Math.atan2(T.y,T.x));let C=O(Math.atan2(v.y,v.x))-E;s?C<0&&(C+=2*Math.PI):C>0&&(C-=2*Math.PI),o&&C<0?C+=2*Math.PI:!o&&C>0&&(C-=2*Math.PI);const N=Math.max(4,Math.abs(C)*u/(2*Math.PI))-1;h.push(new Tt(e,t,0));for(let e=1;e<N;++e){const t=E+C*(e/N),r=i*Math.cos(t),s=n*Math.sin(t);h.push(new Tt(g*r-p*s+S.x,p*r+g*s+S.y,0))}h.push(new Tt(a,l,0))}},zo=ko;i.add("Bezier","standard/Math/Algorithms/Bezier",zo);const Go=zo;const Ho=function(e){return Object.assign([new e],{top:0,set(e){this[this.top].assign(e)},get(){return this[this.top]},push(){const e=++this.top;e<this.length?this[e].assign(this[e-1]):this[e]=this[e-1].copy()},pushMatrix(e){const t=++this.top;t<this.length?this[t].assign(e):this[t]=e.copy()},pop(){--this.top},clear(){this.top=0},size(){return this.top+1},identity(){this[this.top].identity()},multLeft(e){this[this.top].multLeft(e)},translate(e){this[this.top].translate(e)},rotate(e){this[this.top].rotate(e)},scale(e){this[this.top].scale(e)}})};i.add("MatrixStack","standard/Math/Utility/MatrixStack",Ho);const qo=Ho;var Yo=n(328),Wo=n(981);const $o=Ps({whitespaces:/[\x20\n\t\r]+/gy,comma:/,/gy,openParenthesis:/\(/gy,closeParenthesis:/\)/gy,length:/(em|ex|px|in|cm|mm|pt|pc|%)/gy,percent:/%/gy,int32:/((?:0[xX][\da-fA-F]+)|(?:[+-]?\d+))/gy,double:/([+-]?(?:(?:(?:\d*\.\d+)|(?:\d+(?:\.)?))(?:[eE][+-]?\d+)?))/gy,constants:/([+-])((?:NAN|INF|INFINITY))/giy,matrix:/matrix/gy,translate:/translate/gy,rotate:/rotate/gy,scale:/scale/gy,skewX:/skewX/gy,skewY:/skewY/gy,color:/([a-zA-Z]+|#[\da-fA-F]+|rgba?\(.*?\))/gy,url:/url\("?(.*?)"?\)/gy,path:/([mMlLhHvVqQtTcCsSaAzZ])/gy}),Jo=.0254,Ko=Jo/90,Zo=16;function Qo(e){Fs.call(this,e),to.call(this),this.removeGroups=!0,this.removeEmptyGroups=!0,this.combineGroupingNodes=!1,this.solid=!1,this.viewBox=new Gt(0,0,100,100),this.modelMatrix=new qo(gi),this.fillGeometries=new Map,this.strokeGeometries=new Map,this.lineProperties=new Map,this.tessy=this.createTesselator(),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.styles=[{display:"inline",fillType:"COLOR",fillColor:We.Black,fillURL:"",fillOpacity:1,fillRule:"nonzero",strokeType:"none",strokeColor:We.Black,strokeURL:"",strokeOpacity:1,strokeWidth:1,opacity:1,stopColor:We.Black,stopOpacity:1,vectorEffect:"none"}];const t=e.getBrowser();switch(t.getBrowserOption("PrimitiveQuality")){case"LOW":this.BEZIER_STEPS=6,this.CIRCLE_STEPS=20;break;case"HIGH":this.BEZIER_STEPS=10,this.CIRCLE_STEPS=64;break;default:this.BEZIER_STEPS=8,this.CIRCLE_STEPS=32}switch(t.getBrowserOption("TextureQuality")){case"LOW":this.GRADIENT_SIZE=128;break;case"HIGH":this.GRADIENT_SIZE=512;break;default:this.GRADIENT_SIZE=256}this.canvas.width=this.GRADIENT_SIZE,this.canvas.height=this.GRADIENT_SIZE}Object.assign(Object.setPrototypeOf(Qo.prototype,Fs.prototype),to.prototype,{CONSTANTS:new Map([["NAN",NaN],["INF",1/0],["INFINITY",1/0]]),getEncoding:()=>"XML",setInput(e){try{"string"==typeof e&&(e=Yo.parseXML(e)),this.input=e}catch{this.input=void 0}},isValid(){return this.input instanceof XMLDocument&&(!!Yo(this.input).children("svg").length||"svg"===this.input.nodeName)},parseIntoScene(e,t){this.xmlElement(this.input).then(e).catch(t)},xmlElement:async function(e){switch(e.nodeName){case"#document":{const t=Yo(e).children("svg");for(const e of t)await this.svgElement(e);break}case"svg":await this.svgElement(e)}return this.getScene()},svgElement:async function(e){const t=this.getBrowser(),i=this.getScene();i.setEncoding("SVG"),i.setProfile(t.getProfile("Interchange")),i.addComponent(t.getComponent("Geometry2D",2)),await this.loadComponents(),this.document=this.input,this.rootTransform=i.createNode("Transform"),this.groupNodes=[this.rootTransform],this.texturePropertiesNode=this.createTextureProperties();const n=i.createNode("Background");n.skyColor=[1,1,1],i.getRootNodes().push(n);const r=i.createNode("NavigationInfo");r.type=["PLANE_create3000.github.io","PLANE","EXAMINE","ANY"],i.getRootNodes().push(r);const s=this.lengthAttribute(e.getAttribute("width"),300,"width"),o=this.lengthAttribute(e.getAttribute("height"),150,"height"),a=this.viewBox.set(0,0,s,o),l=this.viewBoxAttribute(e.getAttribute("viewBox"),a),u=this.lengthAttribute(e.getAttribute("width"),l[2],"width"),h=this.lengthAttribute(e.getAttribute("height"),l[3],"height");{const e=u/h;l[2]/l[3]>e?l[3]+=l[2]/e-l[3]:l[2]+=l[3]*e-l[2]}const d=i.createNode("OrthoViewpoint"),c=(l.x+u/2)*Ko,p=-(l.y+h/2)*Ko;d.position=new Tt(c,p,10),d.centerOfRotation=new Tt(c,p,0),d.fieldOfView=[-u/2*Ko,-h/2*Ko,u/2*Ko,h/2*Ko],i.getRootNodes().push(d);const g=new Tt(u*Ko/l[2],-h*Ko/l[3],1),f=new Tt(-l.x,l.y,0).multVec(g);this.rootTransform.translation=f,this.rootTransform.scale=g,this.elements(e),i.addNamedNode(i.getUniqueName("ViewBox"),this.rootTransform),i.addExportedNode(i.getUniqueExportName("ViewBox"),this.rootTransform),i.getRootNodes().push(this.rootTransform),this.optimizeSceneGraph(i.getRootNodes())},elements(e){for(const t of e.childNodes)this.element(t)},element(e){switch(e.nodeName){case"use":return this.useElement(e);case"g":return this.gElement(e);case"switch":return this.switchElement(e);case"a":return this.aElement(e);case"rect":return this.rectElement(e);case"circle":return this.circleElement(e);case"ellipse":return this.ellipseElement(e);case"text":return this.textElement(e);case"image":return this.imageElement(e);case"polyline":return this.polylineElement(e);case"polygon":return this.polygonElement(e);case"path":return this.pathElement(e)}},useElement(e){const t=this.hrefAttribute(e.getAttribute("href")||e.getAttribute("xlink:href"));if(!t)return;if(!this.styleAttributes(e))return;const i=this.lengthAttribute(e.getAttribute("x"),0,"width"),n=this.lengthAttribute(e.getAttribute("y"),0,"height"),r=(this.lengthAttribute(e.getAttribute("width"),0,"width"),this.lengthAttribute(e.getAttribute("height"),0,"height"),this.createTransform(e,new _t(i,n)));this.groupNodes.push(r),this.element(t),this.popAll()},gElement(e){if(!this.styleAttributes(e))return;const t=this.createTransform(e);this.groupNodes.push(t),this.elements(e),this.popAll()},switchElement(e){if(!this.styleAttributes(e))return;const t=this.getExecutionContext(),i=this.createTransform(e),n=t.createNode("Switch");i.children.push(n),n.whichChoice=0,this.groupNodes.push(n),this.elements(e),this.popAll()},aElement(e){if(!this.styleAttributes(e))return;const t=e.getAttribute("href")||e.getAttribute("xlink:href"),i=e.getAttribute("title")||e.getAttribute("xlink:title"),n=e.getAttribute("target"),r=this.getExecutionContext(),s=this.createTransform(e),o=r.createNode("Anchor");s.children.push(o),o.description=i,o.url=[t],n&&(o.parameter=[`target=${n}`]),this.groupNodes.push(o),this.elements(e),this.popAll()},rectElement(e){const t=this.lengthAttribute(e.getAttribute("x"),0,"width"),i=this.lengthAttribute(e.getAttribute("y"),0,"height"),n=this.lengthAttribute(e.getAttribute("width"),0,"width"),r=this.lengthAttribute(e.getAttribute("height"),0,"height");let s=Math.max(0,this.lengthAttribute(e.getAttribute("rx"),0,"width")),o=Math.max(0,this.lengthAttribute(e.getAttribute("ry"),0,"height"));if(0===s&&0===o){if(!this.styleAttributes(e))return;const s=this.getExecutionContext(),o=new _t(n,r),a=new _t(t+n/2,i+r/2),l=new Xo(o,a),u=this.createTransform(e,a);if(this.groupNodes.push(u),"none"!==this.style.fillType){const t=s.createNode("Shape"),i=this.fillGeometries.get(e);if(u.children.push(t),t.appearance=this.createFillAppearance(l),i)t.geometry=i;else{const i=s.createNode("Rectangle2D");this.fillGeometries.set(e,i),t.geometry=i,i.solid=this.solid,i.size=o}}if("none"!==this.style.strokeType){const t=s.createNode("Shape"),i=this.strokeGeometries.get(e);if(u.children.push(t),t.appearance=this.createStrokeAppearance(),i)t.geometry=i;else{const i=s.createNode("Polyline2D"),o=n/2,a=r/2;this.strokeGeometries.set(e,i),t.geometry=i,i.lineSegments=[o,a,-o,a,-o,-a,o,-a,o,a]}}this.popAll()}else{s&&!o&&(o=s),o&&!s&&(s=o),s=Math.min(s,n/2),o=Math.min(o,r/2);const a=[t+n-s,t+s,t+s,t+n-s],l=[i+r-o,i+r-o,i+o,i+o],u=Object.assign([],{closed:!0});for(let e=0;e<4;++e){const t=e*Math.PI/2;for(let i=0,n=this.CIRCLE_STEPS/4;i<n;++i){const r=Lo.Polar(1,t+Math.PI/2*i/(n-1));u.push(new Tt(a[e]+r.real*s,l[e]+r.imag*o,0))}}u.pop(),this.pathLikeElement(e,[u])}},circleElement(e){if(!this.styleAttributes(e))return;const t=this.lengthAttribute(e.getAttribute("cx"),0,"width"),i=this.lengthAttribute(e.getAttribute("cy"),0,"height"),n=this.lengthAttribute(e.getAttribute("r"),0),r=this.getExecutionContext(),s=new Xo(new _t(2*n,2*n),new _t(t,i)),o=this.createTransform(e,new _t(t,i));if(this.groupNodes.push(o),"none"!==this.style.fillType){const t=r.createNode("Shape"),i=this.fillGeometries.get(e);if(o.children.push(t),t.appearance=this.createFillAppearance(s),i)t.geometry=i;else{const i=r.createNode("Disk2D");this.fillGeometries.set(e,i),t.geometry=i,i.solid=this.solid,i.outerRadius=n}}if("none"!==this.style.strokeType){const t=r.createNode("Shape"),i=this.strokeGeometries.get(e);if(o.children.push(t),t.appearance=this.createStrokeAppearance(),i)t.geometry=i;else{const i=r.createNode("Circle2D");this.strokeGeometries.set(e,i),t.geometry=i,i.radius=n}}this.popAll()},ellipseElement(e){if(!this.styleAttributes(e))return;const t=this.lengthAttribute(e.getAttribute("cx"),0,"width"),i=this.lengthAttribute(e.getAttribute("cy"),0,"height"),n=this.lengthAttribute(e.getAttribute("rx"),0,"width"),r=this.lengthAttribute(e.getAttribute("ry"),0,"height"),s=this.getExecutionContext(),o=Math.min(n,r),a=new Xo(new _t(2*n,2*r),new _t(t,i)),l=this.createTransform(e,new _t(t,i),new _t(n/o,r/o));if(this.groupNodes.push(l),"none"!==this.style.fillType){const t=s.createNode("Shape"),i=this.fillGeometries.get(e);if(l.children.push(t),t.appearance=this.createFillAppearance(a),i)t.geometry=i;else{const i=s.createNode("Disk2D");this.fillGeometries.set(e,i),t.geometry=i,i.solid=this.solid,i.outerRadius=o}}if("none"!==this.style.strokeType){const t=s.createNode("Shape"),i=this.strokeGeometries.get(e);if(l.children.push(t),t.appearance=this.createStrokeAppearance(),i)t.geometry=i;else{const i=s.createNode("Circle2D");this.strokeGeometries.set(e,i),t.geometry=i,i.radius=o}}this.popAll()},textElement(e){},imageElement(e){const t=this.fillGeometries.get(e);if(t)this.groupNodes.at(-1).children.push(t);else{if(!this.styleAttributes(e))return;const t=this.lengthAttribute(e.getAttribute("x"),0,"width"),i=this.lengthAttribute(e.getAttribute("y"),0,"height"),n=this.lengthAttribute(e.getAttribute("width"),0,"width"),r=this.lengthAttribute(e.getAttribute("height"),0,"height"),s=e.getAttribute("href")||e.getAttribute("xlink:href"),o=this.getExecutionContext(),a=this.createTransform(e,new _t(t+n/2,i+r/2),new _t(1,-1));this.fillGeometries.set(e,a),this.groupNodes.push(a);const l=o.createNode("Shape"),u=o.createNode("Appearance"),h=o.createNode("ImageTexture"),d=o.createNode("Rectangle2D");l.appearance=u,l.geometry=d,u.texture=h,h.url=[s],h.textureProperties=this.texturePropertiesNode,d.solid=this.solid,d.size=new _t(n,r),a.children.push(l),this.popAll()}},polylineElement(e){const t=[];this.pointsAttribute(e.getAttribute("points"),t)&&this.pathLikeElement(e,[t])},polygonElement(e){const t=Object.assign([],{closed:!0});this.pointsAttribute(e.getAttribute("points"),t)&&this.pathLikeElement(e,[t])},pathElement(e){const t=[];this.dAttribute(e.getAttribute("d"),t)&&this.pathLikeElement(e,t)},pathLikeElement(e,t){if(!this.styleAttributes(e))return;t=t.map((e=>e.closed?Object.assign(e.filter(((e,t,i)=>e.distance(i[(t+1)%i.length])>1e-9)),{closed:!0}):e.filter(((e,t,i)=>!t||e.distance(i[t-1])>1e-9)))).filter((e=>e.length>2)),t.forEach(((e,t,i)=>e.index=t?i[t-1].index+i[t-1].length:0));const i=this.getExecutionContext(),n=this.createTransform(e),r=new Xo;for(const e of t)r.add(Xo.Points(e));this.groupNodes.push(n);const s=i.createNode("Coordinate");for(const e of t)s.point.push(...e);if("none"!==this.style.fillType){const o=i.createNode("Shape"),a=this.fillGeometries.get(e);if(n.children.push(o),o.appearance=this.createFillAppearance(r),a)o.geometry=a;else{const n=i.createNode("IndexedTriangleSet");this.fillGeometries.set(e,n),o.geometry=n,n.solid=this.solid,n.index=this.triangulatePolygon(t,s),n.texCoord=this.createTextureCoordinate(s,r,o.appearance),n.coord=s}}if("none"!==this.style.strokeType){const r=i.createNode("Shape"),o=this.strokeGeometries.get(e);if(n.children.push(r),r.appearance=this.createStrokeAppearance(),o)r.geometry=o;else{const n=i.createNode("IndexedLineSet");this.strokeGeometries.set(e,n),r.geometry=n,n.coord=s;const o=n.coordIndex;for(const e of t){for(const t of e.keys())o.push(e.index+t);e.closed&&o.push(e.index),o.push(-1)}}}this.popAll()},linearGradientElementUrl(e,t){const i=this.linearGradientElement(e,t,{stops:[]}),n=this.context.createLinearGradient(i.x1,i.y1,i.x2,i.y2);return this.drawGradient(n,i,t)},linearGradientElement(e,t,i){if("linearGradient"!==e.nodeName)return;const n=this.hrefAttribute(e.getAttribute("href")||e.getAttribute("xlink:href"));n&&this.gradientElement(n,t,i),i.x1=this.lengthAttribute(e.getAttribute("x1"),i.x1||0,"width"),i.y1=this.lengthAttribute(e.getAttribute("y1"),i.y1||0,"height"),i.x2=this.lengthAttribute(e.getAttribute("x2"),i.x2||1,"width"),i.y2=this.lengthAttribute(e.getAttribute("y2"),i.y2||0,"height"),i.units=e.getAttribute("gradientUnits")||"objectBoundingBox",i.transform=this.transformAttribute(e.getAttribute("gradientTransform"));const r=new At,s=new _t(i.x1,i.y1);r.translate(s),r.scale(new _t(Zo,Zo)),r.translate(s.negate()),i.spreadMatrix=r;for(const t of e.childNodes)this.gradientChild(t,i);return i},radialGradientElementUrl(e,t){const i=this.radialGradientElement(e,t,{stops:[]}),n=this.context.createRadialGradient(i.fx,i.fy,i.fr,i.cx,i.cy,i.r);return this.drawGradient(n,i,t)},radialGradientElement(e,t,i){const n=this.hrefAttribute(e.getAttribute("href")||e.getAttribute("xlink:href"));n&&this.gradientElement(n,t,i),i.cx=this.lengthAttribute(e.getAttribute("cx"),i.cx||.5,"width"),i.cy=this.lengthAttribute(e.getAttribute("cy"),i.cy||.5,"height"),i.r=this.lengthAttribute(e.getAttribute("r"),i.r||.5),i.fx=this.lengthAttribute(e.getAttribute("fx"),i.fx||i.cx,"width"),i.fy=this.lengthAttribute(e.getAttribute("fy"),i.fy||i.cy,"height"),i.fr=this.lengthAttribute(e.getAttribute("fr"),i.fr||0),i.units=e.getAttribute("gradientUnits")||"objectBoundingBox",i.spreadMethod=e.getAttribute("spreadMethod"),i.transform=this.transformAttribute(e.getAttribute("gradientTransform"));const r=new At,s=new _t(i.fx,i.fy);r.translate(s),r.scale(new _t(Zo,Zo)),r.translate(s.negate()),i.spreadMatrix=r;for(const t of e.childNodes)this.gradientChild(t,i);return i},gradientElement(e,t,i){if(e)switch(e.nodeName){case"linearGradient":return this.linearGradientElement(e,t,i);case"radialGradient":return this.radialGradientElement(e,t,i)}},gradientChild(e,t){if("stop"===e.nodeName)return this.stopElement(e,t)},stopElement(e,t){if(!this.styleAttributes(e))return;const i=this.percentAttribute(e.getAttribute("offset"),0);if(i<0||i>1)return;const{stopColor:n,stopOpacity:r}=this.style;t.stops.push([i,n,r]),this.styles.pop()},drawGradient(e,t,i){switch(t.spreadMethod){default:t.spreadMatrix.identity();for(const[i,n,r]of t.stops)e.addColorStop(i,this.cssColor(n,r));break;case"repeat":for(let i=0;i<Zo;++i){const n=i/Zo;for(const[i,r,s]of t.stops)e.addColorStop(n+i/Zo,this.cssColor(r,s))}break;case"reflect":for(let i=0;i<Zo;++i){const n=i/Zo;for(const[r,s,o]of t.stops)e.addColorStop(n+(i%2?1-r:r)/Zo,this.cssColor(s,o))}}const n=new At;n.scale(new _t(this.GRADIENT_SIZE/2,this.GRADIENT_SIZE/2)),n.translate(_t.One),n.scale(new _t(1,-1)),"userSpaceOnUse"===t.units?n.multLeft(i.matrix.copy().inverse()):n.multLeft(new At(2,0,0,0,2,0,-1,-1,1)),n.multLeft(t.transform),n.multLeft(t.spreadMatrix);const r=this.context;return r.fillStyle=e,r.save(),r.clearRect(0,0,this.GRADIENT_SIZE,this.GRADIENT_SIZE),r.rect(0,0,this.GRADIENT_SIZE,this.GRADIENT_SIZE),r.transform(n[0],n[1],n[3],n[4],n[6],n[7]),r.fill(),r.restore(),this.canvas.toDataURL("image/png")},patternUrl(e){},idAttribute(e,t){if(null===e)return;const i=this.getExecutionContext(),n=this.sanitizeName(e);n&&(i.addNamedNode(i.getUniqueName(n),t),i.addExportedNode(i.getUniqueExportName(n),t))},viewBoxAttribute(e,t){if(null===e)return t;if(this.parseValue(e),this.double()){const e=this.value;if(this.double()){const t=this.value;if(this.double()){const i=this.value;if(this.double()){const n=this.value;return new Gt(e,t,i,n)}}}}return t},hrefAttribute(e){if(!e)return;const t=this.getExecutionContext(),i=new URL(e,t.getBaseURL()).hash.slice(1);return this.document.getElementById(i)},lengthAttribute(e,t,i){if(null===e)return t;if(this.parseValue(e),this.double()){let e=this.value;if($o.length.parse(this))switch(this.result[1]){case"em":e*=16;break;case"ex":case"px":break;case"in":e*=90;break;case"cm":e*=.01/Ko;break;case"mm":e*=.001/Ko;break;case"pt":e*=1.25;break;case"pc":e*=14.999999999999998;break;case"%":switch(i){case"width":e*=this.viewBox[2]/100;break;case"height":e*=this.viewBox[3]/100;break;default:e*=Math.hypot(this.viewBox[2],this.viewBox[3])/100}}return e}return t},percentAttribute(e,t){if(this.parseValue(e),this.double()){let e=this.value;return $o.percent.parse(this)&&(e/=100),g.clamp(e,0,1)}return t},pointsAttribute(e,t){if(null===e)return!1;for(this.parseValue(e);;){if(this.double()){const e=this.value;if(this.comma()&&this.double()){const i=this.value;if(t.push(new Tt(e,i,0)),this.comma())continue}}break}return!!t.length},dAttribute(e,t){if(null===e)return!1;this.parseValue(e);let i=[],n="",r="",s=!1,o=0,a=0,l=0,u=0;for(;this.whitespaces(),$o.path.parse(this);){switch(n=r,r=this.result[1],s=r===r.toLowerCase(),r){case"m":case"M":for(i.length>2&&t.push(Object.assign(i,{closed:!1})),i=[];;){if(this.double()){let e=this.value;if(this.comma(),this.double()){let t=this.value;s&&(e+=o,t+=a),i.push(new Tt(e,t,0)),o=e,a=t,this.comma();continue}}break}continue;case"l":case"L":for(;;){if(this.double()){let e=this.value;if(this.comma(),this.double()){let t=this.value;s&&(e+=o,t+=a),i.push(new Tt(e,t,0)),o=e,a=t,this.comma();continue}}break}continue;case"h":case"H":for(;this.double();){let e=this.value;s&&(e+=o),i.push(new Tt(e,a,0)),o=e,this.comma()}continue;case"v":case"V":for(;this&&this.double();){let e=this.value;s&&(e+=a),i.push(new Tt(o,e,0)),a=e,this.comma()}continue;case"q":case"Q":for(;;){if(this.double()){let e=this.value;if(this.comma(),this.double()){let t=this.value;if(this.comma(),this.double()){let n=this.value;if(this.comma(),this.double()){let r=this.value;s&&(e+=o,t+=a,n+=o,r+=a),Go.quadric(o,a,0,e,t,0,n,r,0,this.BEZIER_STEPS,i),o=n,a=r,l=e,u=t,this.comma();continue}}}}break}continue;case"t":case"T":for(;;){if(this.double()){let e=this.value;if(this.comma(),this.double()){let t=this.value;switch(s&&(e+=o,t+=a),n){case"Q":case"q":case"T":case"t":h=o+(o-l),d=a+(a-u);break;default:h=o,d=a}Go.quadric(o,a,0,h,d,0,e,t,0,this.BEZIER_STEPS,i),o=e,a=t,this.comma();continue}}break}continue;case"c":case"C":for(;;){if(this.double()){let e=this.value;if(this.comma(),this.double()){let t=this.value;if(this.comma(),this.double()){let n=this.value;if(this.comma(),this.double()){let r=this.value;if(this.comma(),this.double()){let h=this.value;if(this.comma(),this.double()){let d=this.value;s&&(e+=o,t+=a,n+=o,r+=a,h+=o,d+=a),Go.cubic(o,a,0,e,t,0,n,r,0,h,d,0,this.BEZIER_STEPS,i),o=h,a=d,l=n,u=r,this.comma();continue}}}}}}break}continue;case"s":case"S":for(;;){if(this.double()){let e=this.value;if(this.comma(),this.double()){let t=this.value;if(this.comma(),this.double()){let r=this.value;if(this.comma(),this.double()){let c=this.value;switch(s&&(e+=o,t+=a,r+=o,c+=a),n){case"C":case"c":case"S":case"s":var h=o+(o-l),d=a+(a-u);break;default:h=o,d=a}Go.cubic(o,a,0,h,d,0,e,t,0,r,c,0,this.BEZIER_STEPS,i),o=r,a=c,l=e,u=t,this.comma();continue}}}}break}continue;case"a":case"A":for(;;){if(this.double()){let e=this.value;if(this.comma(),this.double()){let t=this.value;if(this.comma(),this.double()){let n=g.radians(this.value);if(this.comma(),this.int32()){let r=this.value;if(this.comma(),this.int32()){let l=this.value;if(this.comma(),this.double()){let u=this.value;if(this.comma(),this.double()){let h=this.value;s&&(u+=o,h+=a),Go.arc(o,a,e,t,n,r,l,u,h,this.CIRCLE_STEPS,i),o=u,a=h,this.comma();continue}}}}}}}break}continue;case"z":case"Z":i.length>2&&(o=i[0].x,a=i[0].y,t.push(Object.assign(i,{closed:!0}))),i=[],this.comma();continue}break}return i.length>2&&t.push(Object.assign(i,{closed:!1})),!!t.length},transformAttribute(e){const t=new At;if(null===e)return t;for(this.parseValue(e);;){if(this.comma(),this.whitespaces(),$o.matrix.parse(this)){if(this.whitespaces(),$o.openParenthesis.parse(this)&&this.double()){const e=this.value;if(this.comma()&&this.double()){const i=this.value;if(this.comma()&&this.double()){const n=this.value;if(this.comma()&&this.double()){const r=this.value;if(this.comma()&&this.double()){const s=this.value;if(this.comma()&&this.double()){const o=this.value;if(this.whitespaces(),$o.closeParenthesis.parse(this)){t.multLeft(new At(e,i,0,n,r,0,s,o,1));continue}}}}}}}}else if($o.translate.parse(this)){if(this.whitespaces(),$o.openParenthesis.parse(this)&&this.double()){const e=this.value;if(this.comma()){if(this.double())var i=this.value}else i=0;if(this.whitespaces(),$o.closeParenthesis.parse(this)){t.translate(new _t(e,i));continue}}}else if($o.rotate.parse(this)){if(this.whitespaces(),$o.openParenthesis.parse(this)&&this.double()){const e=this.value;if(this.whitespaces(),$o.closeParenthesis.parse(this)){t.rotate(g.radians(e));continue}if(this.comma()&&this.double()){const i=this.value;if(this.comma()&&this.double()){const n=this.value;if(this.whitespaces(),$o.closeParenthesis.parse(this)){t.translate(new _t(i,n)),t.rotate(g.radians(e)),t.translate(new _t(-i,-n));continue}}}}}else if($o.scale.parse(this)){if(this.whitespaces(),$o.openParenthesis.parse(this)&&this.double()){const e=this.value;if(this.comma()){if(this.double())var n=this.value}else n=e;if(this.whitespaces(),$o.closeParenthesis.parse(this)){t.scale(new _t(e,n));continue}}}else if($o.skewX.parse(this)){if(this.whitespaces(),$o.openParenthesis.parse(this)&&this.double()){const e=this.value;if(this.whitespaces(),$o.closeParenthesis.parse(this)){t.skewX(g.radians(e));continue}}}else if($o.skewY.parse(this)&&(this.whitespaces(),$o.openParenthesis.parse(this)&&this.double())){const e=this.value;if(this.whitespaces(),$o.closeParenthesis.parse(this)){t.skewY(g.radians(e));continue}}break}return t},styleAttributes(e){const t=Object.assign({},this.styles.at(-1));if("none"===this.style.display)return!1;this.styles.push(t);for(const t of e.attributes)this.parseStyle(t.name,t.value);return this.styleAttribute(e.getAttribute("style")),!0},styleAttribute(e){if(null===e)return;const t=e.split(";");for(const e of t){const t=e.split(":");2===t.length&&this.parseStyle(t[0].trim(),t[1].trim())}},parseStyle(e,t){if("inherit"!==t&&"unset"!=t)switch(this.parseValue(t),e){case"display":this.displayStyle(t);break;case"fill":this.fillStyle(t);break;case"fill-opacity":this.fillOpacityStyle(t);break;case"fill-rule":this.fillRuleStyle(t);break;case"stroke":this.strokeStyle(t);break;case"stroke-opacity":this.strokeOpacityStyle(t);break;case"stroke-width":this.strokeWidthStyle(t);break;case"opacity":this.opacityStyle(t);break;case"stop-color":this.stopColorStyle(t);break;case"stop-opacity":this.stopOpacityStyle(t);break;case"vector-effect":this.vectorEffectStyle(t)}},displayStyle(e){this.style.display="default"!==e?e:"inline"},fillStyle(e){if("default"===e)return this.style.fillType=this.styles[0].fillType,this.style.fillColor=this.styles[0].fillColor,void(this.style.fillURL=this.styles[0].fillURL);if("transparent"!==e){if("none"!==e)return this.urlValue()?(this.style.fillType="URL",void(this.style.fillURL=this.result[1].trim())):this.colorValue(this.styles.at(-1).fillColor)?(this.style.fillType="COLOR",void(this.style.fillColor=this.value.copy())):void 0;this.style.fillType="none"}else this.style.fillType="none"},fillOpacityStyle(e){"default"!==e?"transparent"!==e?this.double()&&(this.style.fillOpacity=g.clamp(this.value,0,1)):this.style.fillOpacity=0:this.style.fillOpacity=this.styles[0].fillOpacity},fillRuleStyle(e){this.style.fillRule="default"!==e?e:this.styles[0].fillRule},strokeStyle(e){if("default"===e)return this.style.strokeType=this.styles[0].strokeType,this.style.strokeColor=this.styles[0].strokeColor,void(this.style.strokeURL=this.styles[0].strokeURL);if("transparent"!==e){if("none"!==e)return this.urlValue()?(this.style.strokeType="URL",void(this.style.strokeURL=this.result[1].trim())):this.colorValue(this.styles.at(-1).strokeColor)?(this.style.strokeType="COLOR",void(this.style.strokeColor=this.value.copy())):void 0;this.style.strokeType="none"}else this.style.strokeType="none"},strokeOpacityStyle(e){"default"!==e?"transparent"!==e?this.double()&&(this.style.strokeOpacity=g.clamp(this.value,0,1)):this.style.strokeOpacity=0:this.style.strokeOpacity=this.styles[0].strokeOpacity},strokeWidthStyle(e){"default"!==e?"none"!==e?this.double()&&(this.style.strokeWidth=this.lengthAttribute(this.value,1)):this.style.strokeWidth=0:this.style.strokeWidth=this.styles[0].strokeWidth},opacityStyle(e){"default"!==e?"transparent"!==e?this.double()&&(this.style.opacity=g.clamp(this.value,0,1)*this.styles.at(-1).opacity):this.style.opacity=0:this.style.opacity=this.styles[0].opacity},stopColorStyle(e){"default"!==e?this.colorValue(We.Black)&&(this.style.stopColor=this.value.copy()):this.style.stopColor=this.styles[0].stopColor},stopOpacityStyle(e){"default"!==e?"transparent"!==e?this.double()&&(this.style.stopOpacity=g.clamp(this.value,0,1)):this.style.stopOpacity=0:this.style.stopOpacity=this.styles[0].stopOpacity},vectorEffectStyle(e){this.style.vectorEffect="default"!==e?e:this.styles[0].vectorEffect},parseValue(e){this.input=e,this.lastIndex=0,this.value=void 0},whitespaces(){return $o.whitespaces.parse(this)},comma(){return!!(this.whitespaces()|$o.comma.parse(this))},int32(){return this.whitespaces(),!!$o.int32.parse(this)&&(this.value=parseInt(this.result[1]),!0)},double(){return this.whitespaces(),$o.double.parse(this)?(this.value=parseFloat(this.result[1]),!0):!!$o.constants.parse(this)&&(this.value=this.CONSTANTS.get(this.result[2].toUpperCase()),"-"===this.result[1]&&(this.value=-this.value),!0)},colorValue:(()=>{const e=new We(0,0,0,0);return function(t){if(!$o.color.parse(this))return!1;const i=this.cssColor(t);return this.value=e.set(...this.convertColor(this.result[1],i)),!0}})(),urlValue(){return $o.url.parse(this)},cssColor:(e,t=e.a)=>`rgba(${255*e.r},${255*e.g},${255*e.b},${t})`,createTransform(e,t=_t.Zero,i=_t.One){const n=this.getExecutionContext(),r=this.transformAttribute(e.getAttribute("transform"));this.modelMatrix.push(),this.modelMatrix.multLeft(gi.Matrix3(r)),r.translate(t),r.scale(i);const s=n.createNode("Transform"),o=gi.Matrix3(r),a=new Tt(0,0,0),l=new ui,u=new Tt(1,1,1),h=new ui;return o.get(a,l,u,h),s.translation=a,s.rotation=l,s.scale=u,s.scaleOrientation=h,this.idAttribute(e.getAttribute("id"),s),this.groupNodes.at(-1).children.push(s),s},popAll(){this.groupNodes.pop(),this.modelMatrix.pop(),this.styles.pop()},createFillAppearance(e){const t=this.getExecutionContext(),i=t.createNode("Appearance");switch(this.style.fillType){case"none":return null;case"COLOR":{const e=t.createNode("UnlitMaterial");i.material=e,e.emissiveColor=new Fe(...this.style.fillColor),e.transparency=1-this.style.fillOpacity*this.style.opacity;break}case"URL":{const t=this.getExecutionContext().createNode("ImageTexture"),n=this.getFillUrl(this.style.fillURL,e);if(!n)return null;t.url=[n],t.textureProperties=this.texturePropertiesNode,i.texture=t;break}}return i},getFillUrl(e,t){const i=this.hrefAttribute(e);if(i)switch(i.nodeName){case"linearGradient":return this.linearGradientElementUrl(i,t);case"radialGradient":return this.radialGradientElementUrl(i,t);case"pattern":return this.patternUrl(i)}},createStrokeAppearance(){const e=this.getExecutionContext(),t=e.createNode("Appearance"),i=e.createNode("UnlitMaterial");t.material=i,i.emissiveColor=new Fe(...this.style.strokeColor),i.transparency=1-this.style.strokeOpacity*this.style.opacity;const n="non-scaling-stroke"===this.vectorEffect?this.style.strokeWidth:this.getStokeWidth();return n>1&&(t.lineProperties=this.getLineProperties(n)),t},getStokeWidth(){const e=this.modelMatrix.get().multDirMatrix(new Tt(this.style.strokeWidth,this.style.strokeWidth,0));return(e.x+e.y)/2},getLineProperties(e){const t=this.lineProperties.get(e);if(t)return t;{const t=this.getExecutionContext().createNode("LineProperties");return t.linewidthScaleFactor=e,this.lineProperties.set(e,t),t}},createTextureProperties(){const e=this.getExecutionContext().createNode("TextureProperties");return e.generateMipMaps=!0,e.minificationFilter="NICEST",e.magnificationFilter="NICEST",e.boundaryModeS="CLAMP_TO_EDGE",e.boundaryModeT="CLAMP_TO_EDGE",e.boundaryModeR="CLAMP_TO_EDGE",e.textureCompression="DEFAULT",e},createTextureCoordinate(e,t,i){if(!i||!i.texture)return null;const n=this.getExecutionContext().createNode("TextureCoordinate"),r=t.matrix.copy().inverse();for(const t of e.point)n.point.push(r.multVecMatrix(new _t(t.x,t.y)).add(_t.One).divide(2));return n},createTesselator(){const e=new Wo.GluTesselator;return e.gluTessCallback(Wo.gluEnum.GLU_TESS_VERTEX_DATA,(function(e,t){t.push(e)})),e.gluTessNormal(0,0,1),e},triangulatePolygon(e,t){const i=this.tessy,n="evenodd"===this.style.fillRule?"GLU_TESS_WINDING_ODD":"GLU_TESS_WINDING_NONZERO",r=[];i.gluTessProperty(Wo.gluEnum.GLU_TESS_WINDING_RULE,Wo.windingRule[n]),i.gluTessCallback(Wo.gluEnum.GLU_TESS_COMBINE,(function(e,i,n){const r=t.point.length;return t.point.push(new Tt(...e)),r})),i.gluTessBeginPolygon(r);for(const t of e){i.gluTessBeginContour();for(const[e,n]of t.entries())i.gluTessVertex(n,t.index+e);i.gluTessEndContour()}return i.gluTessEndPolygon(),r}}),Object.defineProperty(Qo.prototype,"style",{get(){return this.styles.at(-1)}});const ea=Qo;i.add("SVGParser","x_ite/Parser/SVGParser",ea);const ta=ea;var ia=n(328);function na(e){Fs.call(this,e),this.inputs=new Map}Object.assign(Object.setPrototypeOf(na.prototype,Fs.prototype),{parseIntoScene(e,t,i){for(const n of na.Parser)try{const r=new n(this.getScene()),s=this.getInput(r.getEncoding(),e);if(Array.isArray(s)?s.some((e=>void 0===e)):void 0===s)continue;if(r.setInput(s),!r.isValid())continue;return r.pushExecutionContext(this.getExecutionContext()),void r.parseIntoScene(t,i)}catch(e){if(!i)throw e;return void i(e)}throw this.getScene().worldURL.startsWith("data:")?new Error("Couldn't parse X3D. No suitable file handler found for 'data:' URL."):new Error(`Couldn't parse X3D. No suitable file handler found for '${this.getScene().worldURL}'.`)},getInput(e,t){if(Array.isArray(e))return e.map((e=>this.getInput(e)));{if(this.inputs.has(e))return this.inputs.get(e);const i=this.createInput(e,t);return this.inputs.set(e,i),i}},createInput(e,t){try{switch(e){case"STRING":return ia.decodeText(t);case"XML":return ia.parseXML(this.getInput("STRING",t));case"JSON":return JSON.parse(this.getInput("STRING",t));case"ARRAY_BUFFER":return t instanceof ArrayBuffer?t:void 0}}catch{return}}}),na.Parser=[ta,$s,uo,go,Zs,zs,wo,vo,Co,Mo,Po];const ra=na;i.add("GoldenGate","x_ite/Parser/GoldenGate",ra);const sa=ra,oa=new Tt(0,0,0),aa=new Tt(0,0,0),la=new gi;function ua(e,t){this.normal=t.copy(),this.distanceFromOrigin=t.dot(e)}Object.assign(ua.prototype,{copy(){const e=Object.create(ua.prototype);return e.normal=this.normal.copy(),e.distanceFromOrigin=this.distanceFromOrigin,e},assign(e){return this.normal.assign(e.normal),this.distanceFromOrigin=e.distanceFromOrigin,this},set(e,t){return this.normal.assign(t),this.distanceFromOrigin=t.dot(e),this},multRight(e){return aa.assign(this.normal).multiply(this.distanceFromOrigin),la.assign(e).inverse(),la.multMatrixDir(oa.assign(this.normal)).normalize(),e.multVecMatrix(aa),this.normal.assign(oa),this.distanceFromOrigin=oa.dot(aa),this},multLeft(e){return aa.assign(this.normal).multiply(this.distanceFromOrigin),la.assign(e).inverse(),la.multDirMatrix(oa.assign(this.normal)).normalize(),e.multMatrixVec(aa),this.normal.assign(oa),this.distanceFromOrigin=oa.dot(aa),this},getDistanceToPoint(e){return e.dot(this.normal)-this.distanceFromOrigin},intersectsLine(e,t){const{point:i,direction:n}=e,r=n.dot(this.normal);if(0===r)return!1;const s=(this.distanceFromOrigin-this.normal.dot(i))/r;return t.x=i.x+n.x*s,t.y=i.y+n.y*s,t.z=i.z+n.z*s,!0},toString(){return`${this.normal} ${this.distanceFromOrigin}`}});const ha=ua;i.add("Plane3","standard/Math/Geometry/Plane3",ha);const da=ha;var ca=n(981);const pa={area:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0);return function(i,n,r){return e.assign(n).subtract(i).cross(t.assign(r).subtract(i)).magnitude()/2}})(),normal(e,t,i,n){const r=i.x-t.x,s=i.y-t.y,o=i.z-t.z,a=e.x-t.x,l=e.y-t.y,u=e.z-t.z;return n.set(s*u-o*l,o*a-r*u,r*l-s*a),n.normalize()},quadNormal(e,t,i,n,r){const s=i.x-e.x,o=i.y-e.y,a=i.z-e.z,l=n.x-t.x,u=n.y-t.y,h=n.z-t.z;return r.set(o*h-a*u,a*l-s*h,s*u-o*l),r.normalize()},triangulatePolygon:(()=>{const e=new ca.GluTesselator;return e.gluTessCallback(ca.gluEnum.GLU_TESS_VERTEX_DATA,(function(e,t){t.push(e)})),e.gluTessCallback(ca.gluEnum.GLU_TESS_COMBINE,(function(e,t,i){return t[0]})),e.gluTessProperty(ca.gluEnum.GLU_TESS_WINDING_RULE,ca.windingRule.GLU_TESS_WINDING_ODD),function(t,i){e.gluTessBeginPolygon(i),e.gluTessBeginContour();for(const i of t)e.gluTessVertex(i,i.index);return e.gluTessEndContour(),e.gluTessEndPolygon(),i}})(),triangulateConvexPolygon(e,t){for(let i=1,n=e.length-1;i<n;++i)t.push(e[0],e[i],e[i+1])}},ga=pa;i.add("Triangle3","standard/Math/Geometry/Triangle3",ga);const fa=ga,ma={min:0,max:0},_a={min:0,max:0};function xa(){}function ya(e,t,i){i.min=Number.POSITIVE_INFINITY,i.max=Number.NEGATIVE_INFINITY;for(const n of e){const e=n.dot(t);e<i.min&&(i.min=e),e>i.max&&(i.max=e)}}function wa(e,t,i){return t<=e&&e<=i}xa.isSeparated=function(e,t,i){for(const o of e)if(ya(t,o,ma),ya(i,o,_a),s=_a.max,!wa(r=_a.min,n=ma.min,ma.max)&&!wa(n,r,s))return!0;var n,r,s;return!1};const ba=xa;i.add("SAT","standard/Math/Algorithms/SAT",ba);const Sa=ba;function Ta(e,t,i){this.viewport=new Gt(0,0,0,0),this.scissor=new Gt(0,0,0,0),this.points=[new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0)],this.normals=[new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0)],this.edges=[new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0)],this.planes=[new da(Tt.Zero,Tt.Zero),new da(Tt.Zero,Tt.Zero),new da(Tt.Zero,Tt.Zero),new da(Tt.Zero,Tt.Zero),new da(Tt.Zero,Tt.Zero),new da(Tt.Zero,Tt.Zero)],arguments.length&&this.set(e,t,i)}Object.assign(Ta.prototype,{set:(()=>{const e=new gi;return function(t,i,n){this.viewport.assign(i),this.scissor.assign(n);const[r,s,o,a,l,u,h,d]=this.points,c=n[0],p=c+n[2],g=n[1],f=g+n[3];e.assign(t).inverse(),Ta.unProjectPointMatrix(c,g,0,e,i,r),Ta.unProjectPointMatrix(p,g,0,e,i,s),Ta.unProjectPointMatrix(p,f,0,e,i,o),Ta.unProjectPointMatrix(c,f,0,e,i,a),Ta.unProjectPointMatrix(c,g,1,e,i,l),Ta.unProjectPointMatrix(p,g,1,e,i,u),Ta.unProjectPointMatrix(p,f,1,e,i,h),Ta.unProjectPointMatrix(c,f,1,e,i,d);const m=this.normals;fa.normal(r,s,o,m[0]),fa.normal(d,l,r,m[1]),fa.normal(h,o,s,m[2]),fa.normal(o,h,d,m[3]),fa.normal(s,r,l,m[4]),fa.normal(l,d,h,m[5]);const _=this.planes;return _[0].set(s,m[0]),_[1].set(l,m[1]),_[2].set(o,m[2]),_[3].set(h,m[3]),_[4].set(r,m[4]),_[5].set(d,m[5]),this.edges.tainted=!0,this}})(),getViewport(){return this.viewport},getScissor(){return this.scissor},getEdges(){const e=this.edges;if(e.tainted){const[t,i,n,r,s,o,a,l]=this.points;e[0].assign(t).subtract(i),e[1].assign(i).subtract(n),e[2].assign(n).subtract(r),e[3].assign(r).subtract(t),e[4].assign(t).subtract(s),e[5].assign(i).subtract(o),e[6].assign(n).subtract(a),e[7].assign(r).subtract(l),e.tainted=!1}return e},intersectsSphere(e,t){const[i,n,r,s,o,a,l,u]=this.planes;return!(i.getDistanceToPoint(t)>e)&&(!(n.getDistanceToPoint(t)>e)&&(!(r.getDistanceToPoint(t)>e)&&(!(s.getDistanceToPoint(t)>e)&&(!(o.getDistanceToPoint(t)>e)&&!(a.getDistanceToPoint(t)>e)))))},intersectsBox:(()=>{const e=[new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0)],t=[new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0)],i=[new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0)],n=[];for(let e=0;e<24;++e)n.push(new Tt(0,0,0));return function(r){r.getPoints(e);const s=this.points;if(Sa.isSeparated(r.getNormals(t),e,s))return!1;if(Sa.isSeparated(this.normals,e,s))return!1;r.getAxes(i);const o=this.getEdges();for(let e=0;e<3;++e)for(let t=0;t<8;++t)n[3*e+t].assign(i[e]).cross(o[t]);return!Sa.isSeparated(n,e,s)}})()}),Object.assign(Ta,{unProjectPoint:(()=>{const e=new gi;return function(t,i,n,r,s,o,a){return this.unProjectPointMatrix(t,i,n,e.assign(r).multRight(s).inverse(),o,a)}})(),unProjectPointMatrix:(()=>{const e=new Gt(0,0,0,0);return function(t,i,n,r,s,o){e.set((t-s[0])/s[2]*2-1,(i-s[1])/s[3]*2-1,2*n-1,1),r.multVecMatrix(e);const a=1/e.w;return o.set(e.x*a,e.y*a,e.z*a,1)}})(),unProjectRay:(()=>{const e=new gi;return function(t,i,n,r,s,o){return this.unProjectRayMatrix(t,i,e.assign(n).multRight(r).inverse(),s,o)}})(),unProjectRayMatrix:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0);return function(i,n,r,s,o){return Ta.unProjectPointMatrix(i,n,0,r,s,e),Ta.unProjectPointMatrix(i,n,.9,r,s,t),o.setPoints(e,t)}})(),projectPoint:(()=>{const e=new Gt(0,0,0,0);return function(t,i,n,r,s){4===t.length?e.assign(t):e.set(t.x,t.y,t.z,1),n.multVecMatrix(i.multVecMatrix(e));const o=1/(2*e.w);return s.set((e.x*o+.5)*r[2]+r[0],(e.y*o+.5)*r[3]+r[1],e.z*o+.5)}})(),projectPointMatrix:(()=>{const e=new Gt(0,0,0,0);return function(t,i,n,r){4===t.length?e.assign(t):e.set(t.x,t.y,t.z,1),i.multVecMatrix(e);const s=1/(2*e.w);return r.set((e.x*s+.5)*n[2]+n[0],(e.y*s+.5)*n[3]+n[1],e.z*s+.5)}})(),projectLine:(()=>{const e=new gi;return function(t,i,n,r,s){return this.projectLineMatrix(t,e.assign(i).multRight(n),r,s)}})(),projectLineMatrix:(()=>{const e=new _t(0,0),t=new _t(0,0),i=new Tt(0,0,0);return function(n,r,s,o){return Ta.projectPointMatrix(n.point,r,s,e),Ta.projectPointMatrix(i.assign(n.direction).multiply(1e9).add(n.point),r,s,t),o.setPoints(e,t)}})()});const va=Ta;i.add("ViewVolume","standard/Math/Geometry/ViewVolume",va);const Oa=va;function Ea(e,t,i,n=!1){const r=e.getContext();if(this.context=r,this.width=t,this.height=i,Object.defineProperty(this,"array",{get(){const e=n?new Float32Array(t*i*4):new Uint8Array(t*i*4);return Object.defineProperty(this,"array",{value:e}),e},configurable:!0}),this.frameBuffer=r.createFramebuffer(),r.bindFramebuffer(r.FRAMEBUFFER,this.frameBuffer),this.colorTexture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.colorTexture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),n?r.texImage2D(r.TEXTURE_2D,0,r.getVersion()>1?r.RGBA32F:r.RGBA,t,i,0,r.RGBA,r.FLOAT,null):r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t,i,0,r.RGBA,r.UNSIGNED_BYTE,null),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.colorTexture,0),r.HAS_FEATURE_DEPTH_TEXTURE){this.depthTexture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.depthTexture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST);const e=r.getVersion()>=2?r.DEPTH_COMPONENT24:r.DEPTH_COMPONENT;r.texImage2D(r.TEXTURE_2D,0,e,t,i,0,r.DEPTH_COMPONENT,r.UNSIGNED_INT,null),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,this.depthTexture,0)}else this.depthBuffer=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,this.depthBuffer),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,t,i),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,this.depthBuffer);if(!(r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE))throw new Error("Couldn't create frame buffer.")}Object.assign(Ea.prototype,{getWidth(){return this.width},getHeight(){return this.height},getColorTexture(){return this.colorTexture},getDepthTexture(){return this.depthTexture},readPixels(){const{context:e,array:t,width:i,height:n}=this;return e.readPixels(0,0,i,n,e.RGBA,e.UNSIGNED_BYTE,t),t},readDepth:(()=>{const e=new gi,t=new Tt(0,0,0);return function(i,n){const{context:r,array:s,width:o,height:a}=this;r.readPixels(0,0,o,a,r.RGBA,r.FLOAT,s);let l=0,u=0,h=Number.POSITIVE_INFINITY;for(let e=0,t=0;e<a;++e)for(let i=0;i<o;++i,t+=4){const n=s[t];n<h&&(l=i,u=e,h=n)}return e.assign(i).inverse(),Oa.unProjectPointMatrix(l,u,h,e,n,t),t.z}})(),bind(){const e=this.context;e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer)},delete(){const e=this.context;e.deleteFramebuffer(this.frameBuffer),e.deleteTexture(this.colorTexture),e.HAS_FEATURE_DEPTH_TEXTURE?e.deleteTexture(this.depthTexture):e.deleteRenderbuffer(this.depthBuffer)}});for(const e of Object.keys(Ea.prototype))Object.defineProperty(Ea.prototype,e,{enumerable:!1});const Ca=Ea;i.add("TextureBuffer","x_ite/Rendering/TextureBuffer",Ca);const Na=Ca;let Ia=0;const Fa={POINTER:Ia++,CAMERA:Ia++,PICKING:Ia++,COLLISION:Ia++,SHADOW:Ia++,DISPLAY:Ia++};i.add("TraverseType","x_ite/Rendering/TraverseType",Fa);const Ma=Fa;function Da(e,t){this.array=e,this.auxiliary=[],t&&(this.compare=t)}Object.assign(Da.prototype,{compare:(e,t)=>e<t,sort(e,t){this.mergeSort(e,t-1)},mergeSort(e,t){if(e<t){const i=e+t>>>1;this.mergeSort(e,i),this.mergeSort(i+1,t),this.merge(e,i,t)}},merge(e,t,i){const{array:n,auxiliary:r,compare:s}=this;let o,a,l;for(o=0,a=e;a<=t;)r[o++]=n[a++];for(o=0,l=e;l<a&&a<=i;)s(n[a],r[o])?n[l++]=n[a++]:n[l++]=r[o++];for(;l<a;)n[l++]=r[o++]}});const Ra=Da;i.add("MergeSort","standard/Math/Algorithms/MergeSort",Ra);const Pa=Ra,Aa={frustum(e,t,i,n,r,s,o){const a=t-e,l=n-i,u=s-r,h=2*r,d=(t+e)/a,c=(n+i)/l,p=-(s+r)/u,g=-h*s/u,f=h/a,m=h/l;return o.set(f,0,0,0,0,m,0,0,d,c,p,-1,0,0,g,0)},perspective(e,t,i,n,r,s){const o=Math.tan(e/2)*t;if(n>r){const e=n*o/r;return this.frustum(-e,e,-o,o,t,i,s)}{const e=r*o/n;return this.frustum(-o,o,-e,e,t,i,s)}},perspective2(e,t,i,n,r,s){const o=Math.tan(e/2)*t;return this.frustum(-o,o,-o,o,t,i,s)},ortho(e,t,i,n,r,s,o){const a=t-e,l=n-i,u=s-r,h=2/a,d=2/l,c=-2/u,p=-(t+e)/a,g=-(n+i)/l,f=-(s+r)/u;return o.set(h,0,0,0,0,d,0,0,0,0,c,0,p,g,f,1)},orthoBox:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0);return function(i,n){return i.getExtents(e,t),this.ortho(e.x,t.x,e.y,t.y,-t.z,-e.z,n)}})()},Va=Aa;i.add("Camera","standard/Math/Geometry/Camera",Va);const La=Va;function Ba(){this.matrix=new gi,this.set(...arguments)}Object.assign(Ba.prototype,{copy(){const e=Object.create(Ba.prototype);return e.matrix=this.matrix.copy(),e},assign(e){return this.matrix.assign(e.matrix),this},equals(e){return this.matrix.equals(e.matrix)},getMatrix(){return this.matrix},set(e,t){switch(arguments.length){case 0:return this.matrix.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this;case 2:return this.matrix.set(e.x/2,0,0,0,0,e.y/2,0,0,0,0,e.z/2,0,t.x,t.y,t.z,1),this}},setExtents(e,t){const i=(t.x-e.x)/2,n=(t.y-e.y)/2,r=(t.z-e.z)/2,s=(t.x+e.x)/2,o=(t.y+e.y)/2,a=(t.z+e.z)/2;return this.matrix.set(i,0,0,0,0,n,0,0,0,0,r,0,s,o,a,1),this},getExtents(e,t){this.getAbsoluteExtents(e,t),e.add(this.center),t.add(this.center)},getAbsoluteExtents:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0),i=new Tt(0,0,0);return function(n,r){const s=this.matrix,o=s.xAxis,a=s.yAxis,l=s.zAxis;e.assign(a).add(l);const u=l.subtract(a);t.assign(o).add(e),i.assign(o).add(u);const h=e.subtract(o),d=u.subtract(o);n.assign(t).min(h,d,i),r.assign(t).max(h,d,i),t.negate(),h.negate(),d.negate(),i.negate(),n.min(t,h,d,i),r.max(t,h,d,i)}})(),getPoints:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0),i=new Tt(0,0,0),n=new Tt(0,0,0);return function(r){const s=this.matrix;e.assign(s.xAxis),t.assign(s.yAxis),i.assign(s.zAxis),n.assign(t).add(i);const o=i.subtract(t);r[0].assign(e).add(n),r[1].assign(n).subtract(e),r[2].assign(o).subtract(e),r[3].assign(e).add(o),r[4].assign(r[2]).negate(),r[5].assign(r[3]).negate(),r[6].assign(r[0]).negate(),r[7].assign(r[1]).negate();const a=this.center;return r[0].add(a),r[1].add(a),r[2].add(a),r[3].add(a),r[4].add(a),r[5].add(a),r[6].add(a),r[7].add(a),r}})(),getAxes(e){const t=this.matrix;return e[0].assign(t.xAxis),e[1].assign(t.yAxis),e[2].assign(t.zAxis),e},getNormals:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0),i=new Tt(0,0,0),n=[Tt.xAxis,Tt.yAxis,Tt.zAxis];return function(r){const s=this.matrix;if(e.assign(s.xAxis),t.assign(s.yAxis),i.assign(s.zAxis),0===e.norm()&&(e.assign(t).cross(i),0===e.norm())){for(const i of n)if(e.assign(i).cross(t),0!==e.norm())break;if(0===e.norm()){for(const t of n)if(e.assign(t).cross(i),0!==e.norm())break;0===e.norm()&&e.assign(Tt.xAxis)}}if(0===t.norm()&&(t.assign(i).cross(e),0===t.norm())){for(const e of n)if(t.assign(e).cross(i),0!==t.norm())break;if(0===t.norm()){for(const i of n)if(t.assign(i).cross(e),0!==t.norm())break;0===t.norm()&&t.assign(Tt.yAxis)}}if(0===i.norm()&&(i.assign(e).cross(t),0===i.norm())){for(const t of n)if(i.assign(t).cross(e),0!==i.norm())break;if(0===i.norm()){for(const e of n)if(i.assign(e).cross(t),0!==i.norm())break;0===i.norm()&&i.assign(Tt.zAxis)}}return r[0].assign(t).cross(i).normalize(),r[1].assign(i).cross(e).normalize(),r[2].assign(e).cross(t).normalize(),r}})(),isEmpty(){return 0===this.matrix[15]},add:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0),i=new Tt(0,0,0),n=new Tt(0,0,0);return function(r){return this.isEmpty()?this.assign(r):r.isEmpty()?this:(this.getExtents(e,t),r.getExtents(i,n),this.setExtents(e.min(i),t.max(n)))}})(),multLeft(e){return this.matrix.multLeft(e),this},multRight(e){return this.matrix.multRight(e),this},containsPoint:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0);return function(i){return this.getExtents(e,t),e.x<=i.x&&t.x>=i.x&&e.y<=i.y&&t.y>=i.y&&e.z<=i.z&&t.z>=i.z}})(),intersectsBox:(()=>{const e=[new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0)],t=[new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0)],i=[new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0)],n=[new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0)],r=[new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0)],s=[new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0)];return function(o){if(this.isEmpty())return!1;if(o.isEmpty())return!1;if(this.getPoints(e),o.getPoints(t),Sa.isSeparated(this.getNormals(s),e,t))return!1;if(Sa.isSeparated(o.getNormals(s),e,t))return!1;this.getAxes(i),o.getAxes(n);for(let e=0;e<3;++e)for(let t=0;t<3;++t)r[3*e+t].assign(i[e]).cross(n[t]);return!Sa.isSeparated(r,e,t)}})(),intersectsTriangle:(()=>{const e=[new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0)],t=[new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0)],i=[new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0)],n=[new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0)],r=[],s=[new Tt(0,0,0)],o=[new Tt(0,0,0),new Tt(0,0,0),new Tt(0,0,0)];return function(a,l,u){if(this.isEmpty())return!1;if(this.getPoints(e),r[0]=a,r[1]=l,r[2]=u,Sa.isSeparated(this.getNormals(n),e,r))return!1;if(fa.normal(a,l,u,s[0]),Sa.isSeparated(s,e,r))return!1;this.getAxes(t),o[0].assign(a).subtract(l),o[1].assign(l).subtract(u),o[2].assign(u).subtract(a);for(let e=0;e<3;++e)for(let n=0;n<3;++n)i[3*e+n].assign(t[e]).cross(o[n]);return!Sa.isSeparated(i,e,r)}})(),toString(){return`${this.size}, ${this.center}`}}),Object.assign(Ba,{Extents:(e,t)=>(new Ba).setExtents(e,t),Points(e){const t=new Tt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new Tt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const n of e)t.min(n),i.max(n);return(new Ba).setExtents(t,i)}}),Object.defineProperties(Ba.prototype,{size:{get:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0);return function(){return this.getAbsoluteExtents(e,t),t.subtract(e)}})(),enumerable:!0},center:{get(){return this.matrix.origin},enumerable:!0}});const Ua=Ba;i.add("Box3","standard/Math/Geometry/Box3",Ua);const Xa=Ua;function ja(e,t){this.point=e.copy(),this.direction=t.copy()}Object.assign(ja.prototype,{copy(){const e=Object.create(ja.prototype);return e.point=this.point.copy(),e.direction=this.direction.copy(),e},assign(e){return this.point.assign(e.point),this.direction.assign(e.direction),this},set(e,t){return this.point.assign(e),this.direction.assign(t),this},setPoints(e,t){return this.point.assign(e),this.direction.assign(t).subtract(e).normalize(),this},multMatrixLine(e){return e.multMatrixVec(this.point),e.multMatrixDir(this.direction).normalize(),this},multLineMatrix(e){return e.multVecMatrix(this.point),e.multDirMatrix(this.direction).normalize(),this},getClosestPointToPoint(e,t){const i=t.assign(e).subtract(this.point).dot(this.direction);return t.assign(this.direction).multiply(i).add(this.point)},getClosestPointToLine:(()=>{const e=new Tt(0,0,0);return function(t,i){const{point:n,direction:r}=this,{point:s,direction:o}=t;let a=r.dot(o);return!(Math.abs(a)>=1)&&(e.assign(s).subtract(n),a=(e.dot(r)-a*e.dot(o))/(1-a*a),i.assign(r).multiply(a).add(n),!0)}})(),getPerpendicularVectorToPoint:(()=>{const e=new Tt(0,0,0);return function(t,i){return i.assign(this.point).subtract(t),i.subtract(e.assign(this.direction).multiply(i.dot(this.direction)))}})(),getPerpendicularVectorToLine:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0);return function(i,n){const r=n;e.assign(this.point).subtract(i.point);const s=e.dot(this.direction),o=e.dot(i.direction),a=this.direction.dot(i.direction),l=a*a,u=(s-o*a)/(1-l),h=-(o-s*a)/(1-l);return t.assign(this.direction).multiply(u),r.assign(i.direction).multiply(h),r.subtract(t).add(e)}})(),intersectsTriangle:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0);return function(i,n,r,s){const o=n.subtract(i),a=r.subtract(i);e.assign(this.direction).cross(a);const l=o.dot(e);if(0===l)return!1;const u=1/l;t.assign(this.point).subtract(i);const h=t.dot(e)*u;if(h<0||h>1)return!1;const d=t.cross(o),c=this.direction.dot(d)*u;return!(c<0||h+c>1)&&(s.u=h,s.v=c,s.t=1-h-c,!0)}})(),toString(){return`${this.point}, ${this.direction}`}}),Object.assign(ja,{Points(e,t){const i=Object.create(ja.prototype);return i.point=e.copy(),i.direction=t.copy().subtract(e).normalize(),i}});const ka=ja;i.add("Line3","standard/Math/Geometry/Line3",ka);const za=ka,Ga=Symbol();function Ha(e=0){this[Ga]=e>>>0}Object.assign(Ha.prototype,{*[Symbol.iterator](){let e=this[Ga],t=0;for(;e;)1&e&&(yield t),e>>>=1,++t},get(e){const t=1<<e;return!!(this[Ga]&t)},set(e,t){t?this.add(e):this.remove(e)},add(e,t=1){this[Ga]|=t<<e,this[Ga]>>>=0},remove(e,t=1){this[Ga]&=~(t<<e),this[Ga]>>>=0},clear(){this[Ga]=0},*entries(){for(const e of this)yield[e,e]},valueOf(){return this[Ga]},toString(e){return this[Ga].toString(e)}}),Ha.prototype.keys=Ha.prototype[Symbol.iterator],Ha.prototype.values=Ha.prototype[Symbol.iterator],Object.defineProperty(Ha.prototype,"size",{get(){return g.bitCount(this[Ga])}});const qa=Ha;i.add("BitSet","standard/Utility/BitSet",qa);const Ya=qa;const Wa=class{#e=0;#t=0;cycles=0;elapsedTime=0;start(){this.#e=Date.now()}stop(){this.#e<=this.#t||(this.#t=Date.now(),this.cycles+=1,this.elapsedTime+=this.#t-this.#e)}reset(){this.#e=0,this.#t=0,this.cycles=0,this.elapsedTime=0}get averageTime(){return this.cycles?this.elapsedTime/this.cycles:0}};i.add("StopWatch","standard/Time/StopWatch",Wa);const $a=Wa;function Ja(e){const t=e.getBrowser();this.renderBits=new Ya,this.renderCount=0,this.viewVolumes=[],this.cameraSpaceMatrix=new qo(gi),this.viewMatrix=new qo(gi),this.projectionMatrix=new qo(gi),this.modelViewMatrix=new qo(gi),this.viewportArray=new Int32Array(4),this.projectionMatrixArray=new Float32Array(16),this.cameraSpaceMatrixArray=new Float32Array(16),this.hitRay=new za(Tt.Zero,Tt.Zero),this.sensors=[[]],this.viewpointGroups=[],this.localObjectsKeys=[],this.globalLightsKeys=[],this.globalLights=[],this.localObjects=[],this.lights=[],this.globalShadows=[!1],this.localShadows=[!1],this.localFogs=[null],this.layouts=[],this.humanoids=[],this.generatedCubeMapTextures=[],this.collisions=[],this.collisionTime=new $a,this.numPointingShapes=0,this.numCollisionShapes=0,this.numShadowShapes=0,this.numOpaqueShapes=0,this.numTransparentShapes=0,this.pointingShapes=[],this.collisionShapes=[],this.activeCollisions=[],this.shadowShapes=[],this.opaqueShapes=[],this.transparentShapes=[],this.transparencySorter=new Pa(this.transparentShapes,((e,t)=>e.distance<t.distance)),this.speed=0,this.depthBuffer=new Na(t,16,16,!0)}function Ka(e,t){for(var i=0,n=t.length;i<n;++i)e[i]=t[i];e.length=n}Object.assign(Ja.prototype,{initialize(){},isIndependent:()=>!0,getRenderBits(){return this.renderBits},getRenderCount(){return this.renderCount},getNextRenderCount:function(){let e=0;return function(){return e>>>=0,++e}}(),getViewVolumes(){return this.viewVolumes},getViewVolume(){return this.viewVolumes.at(-1)},getCameraSpaceMatrix(){return this.cameraSpaceMatrix},getViewMatrix(){return this.viewMatrix},getProjectionMatrix(){return this.projectionMatrix},getModelViewMatrix(){return this.modelViewMatrix},getViewportArray(){return this.viewportArray},getProjectionMatrixArray(){return this.projectionMatrixArray},getCameraSpaceMatrixArray(){return this.cameraSpaceMatrixArray},getHitRay(){return this.hitRay},getSensors(){return this.sensors},getViewpointGroups(){return this.viewpointGroups},getGlobalLights(){return this.globalLights},getLocalObjects(){return this.localObjects},getLocalObjectsKeys(){return this.localObjectsKeys},getLights(){return this.lights},pushGlobalShadows(e){this.globalShadows.push(e||this.globalShadows.at(-1))},getGlobalShadows(){return this.globalShadows},pushLocalShadows(e){this.localShadows.push(e||this.localShadows.at(-1))},popLocalShadows(){this.localShadows.pop()},setGlobalFog:(()=>{const e=new gi;return function(t){if(t.getFogType()){const i=this.localFogs[0]||t.getFogs().pop();e.assign(t.getModelMatrix()).multRight(this.getViewMatrix().get()),i.set(t,e),this.localFogs[0]=i}else this.localFogs[0]=null}})(),getLocalFogs(){return this.localFogs},getLayouts(){return this.layouts},getParentLayout(){return this.layouts.at(-1)},getHumanoids(){return this.humanoids},getGeneratedCubeMapTextures(){return this.generatedCubeMapTextures},getCollisions(){return this.collisions},getCollisionTime(){return this.collisionTime},setNumPointingShapes(e){this.numPointingShapes=e},getNumPointingShapes(){return this.numPointingShapes},getPointingShapes(){return this.pointingShapes},setNumCollisionShapes(e){this.numCollisionShapes=e},getNumCollisionShapes(){return this.numCollisionShapes},getCollisionShapes(){return this.collisionShapes},setNumShadowShapes(e){this.numShadowShapes=e},getNumShadowShapes(){return this.numShadowShapes},getShadowShapes(){return this.shadowShapes},setNumOpaqueShapes(e){this.numOpaqueShapes=e},getNumOpaqueShapes(){return this.numOpaqueShapes},getOpaqueShapes(){return this.opaqueShapes},setNumTransparentShapes(e){this.numTransparentShapes=e},getNumTransparentShapes(){return this.numTransparentShapes},getTransparentShapes(){return this.transparentShapes},constrainTranslation(e,t){const i=this.getDistance(e)-this.getNavigationInfo().getCollisionRadius();if(i>0){return e.magnitude()>i?e.normalize().multiply(i):e}return t?this.constrainTranslation(e.normalize().multiply(i),!1):e.assign(Tt.Zero)},getDistance:(()=>{const e=new gi,t=new gi,i=new ui,n=new Tt(0,0,0),r=new ui;return function(s){this.collisionTime.start();const o=this.getViewpoint(),a=this.getNavigationInfo(),l=a.getCollisionRadius(),u=a.getStepHeight()-a.getAvatarHeight(),h=a.getNearValue(),d=a.getAvatarHeight();La.ortho(-l,l,Math.min(u,-l),l,h,Math.max(2*l,2*d),e),i.assign(o._orientation.getValue()).inverse().multRight(o.getOrientation()),r.setFromToVec(Tt.zAxis,n.assign(s).negate()).multRight(i),o.straightenHorizon(r),t.assign(o.getModelMatrix()),t.translate(o.getUserPosition()),t.rotate(r),t.inverse(),t.multRight(e),t.multLeft(o.getCameraSpaceMatrix()),this.getProjectionMatrix().pushMatrix(t);const c=this.getDepth(e);return this.getProjectionMatrix().pop(),this.collisionTime.stop(),-c}})(),getDepth:(()=>{const e=new Gt(0,0,16,16),t=new Oa;return t.set(gi.Identity,e,e),function(i){this.depthBuffer.bind(),this.viewVolumes.push(t),this.depth(this.collisionShapes,this.numCollisionShapes);const n=this.depthBuffer.readDepth(i,e);return this.viewVolumes.pop(),n}})(),render(e,t,i){switch(e){case Ma.POINTER:this.numPointingShapes=0,t.call(i,e,this),this.pointing(this.pointingShapes,this.numPointingShapes);break;case Ma.COLLISION:this.numCollisionShapes=0,t.call(i,e,this),this.collide(),this.gravite();break;case Ma.SHADOW:this.numShadowShapes=0,t.call(i,e,this),this.depth(this.shadowShapes,this.numShadowShapes);break;case Ma.DISPLAY:this.lightIndex=0,this.numOpaqueShapes=0,this.numTransparentShapes=0,this.setGlobalFog(this.getFog()),t.call(i,e,this),this.draw()}},setHitRay(e,t,i){Oa.unProjectRay(i.x,i.y,gi.Identity,e,t,this.hitRay)},addPointingShape:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0);return function(i){const n=this.getModelViewMatrix().get();n.multDirMatrix(e.assign(i.getBBoxSize())),n.multVecMatrix(t.assign(i.getBBoxCenter()));const r=e.magnitude()/2,s=this.viewVolumes.at(-1);if(s.intersectsSphere(r,t)){const e=this.numPointingShapes++;e===this.pointingShapes.length&&this.pointingShapes.push({renderObject:this,modelViewMatrix:new Float32Array(16),clipPlanes:[],sensors:[]});const t=this.pointingShapes[e];return t.modelViewMatrix.set(n),t.shapeNode=i,t.scissor=s.getScissor(),t.humanoidNode=this.humanoids.at(-1),Ka(t.clipPlanes,this.localObjects),Ka(t.sensors,this.sensors.at(-1)),!0}return!1}})(),addCollisionShape:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0);return function(i){const n=this.getModelViewMatrix().get();n.multDirMatrix(e.assign(i.getBBoxSize())),n.multVecMatrix(t.assign(i.getBBoxCenter()));const r=e.magnitude()/2,s=this.viewVolumes.at(-1);if(s.intersectsSphere(r,t)){const e=this.numCollisionShapes++;e===this.collisionShapes.length&&this.collisionShapes.push({renderObject:this,modelViewMatrix:new Float32Array(16),collisions:[],clipPlanes:[]});const t=this.collisionShapes[e];return t.modelViewMatrix.set(n),t.shapeNode=i,t.scissor=s.getScissor(),Ka(t.collisions,this.collisions),Ka(t.clipPlanes,this.localObjects),!0}return!1}})(),addShadowShape:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0);return function(i){const n=this.getModelViewMatrix().get();n.multDirMatrix(e.assign(i.getBBoxSize())),n.multVecMatrix(t.assign(i.getBBoxCenter()));const r=e.magnitude()/2,s=this.viewVolumes.at(-1);if(s.intersectsSphere(r,t)){const e=this.numShadowShapes++;e===this.shadowShapes.length&&this.shadowShapes.push({renderObject:this,modelViewMatrix:new Float32Array(16),clipPlanes:[]});const t=this.shadowShapes[e];return t.modelViewMatrix.set(n),t.shapeNode=i,t.scissor=s.getScissor(),t.humanoidNode=this.humanoids.at(-1),Ka(t.clipPlanes,this.localObjects),!0}return!1}})(),addDisplayShape:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0);return function(i){const n=this.getModelViewMatrix().get();n.multDirMatrix(e.assign(i.getBBoxSize())),n.multVecMatrix(t.assign(i.getBBoxCenter()));const r=e.magnitude()/2,s=this.viewVolumes.at(-1);if(s.intersectsSphere(r,t)){if(i.isTransparent()){const e=this.numTransparentShapes++;e===this.transparentShapes.length&&this.transparentShapes.push(this.createRenderContext(!0)),(o=this.transparentShapes[e]).distance=t.z}else{const e=this.numOpaqueShapes++;e===this.opaqueShapes.length&&this.opaqueShapes.push(this.createRenderContext(!1));var o=this.opaqueShapes[e]}return o.modelViewMatrix.set(n),o.scissor.assign(s.getScissor()),o.shadows=this.localShadows.at(-1),o.fogNode=this.localFogs.at(-1),o.shapeNode=i,o.appearanceNode=i.getAppearance(),o.humanoidNode=this.humanoids.at(-1),Ka(o.localObjects,this.localObjects),Ka(o.objectsKeys,this.localObjectsKeys),!0}return!1}})(),createRenderContext(e){return{renderObject:this,transparent:e,modelViewMatrix:new Float32Array(16),scissor:new Gt(0,0,0,0),localObjects:[],objectsKeys:[]}},pointing:(()=>{const e=new Float32Array(16);return function(t,i){const n=this.getBrowser(),r=n.getContext(),s=this.getViewVolume().getViewport(),[o,a]=n.getPointer();e.set(this.getProjectionMatrix().get()),r.viewport(s[0]-o,s[1]-a,s[2],s[3]),r.scissor(0,0,1,1),r.clear(r.DEPTH_BUFFER_BIT),r.disable(r.CULL_FACE);for(let s=0;s<i;++s){const i=t[s],{scissor:l,clipPlanes:u,modelViewMatrix:h,shapeNode:d,humanoidNode:c}=i,p=d.getAppearance(),g=d.getGeometryContext(),f=p.getDepthMode(),m=p.getStyleProperties(g.geometryType),_=n.getPointingShader(u.length,d,c),x=n.addPointingShape(i);r.scissor(l.x-o,l.y-a,l.z,l.w),_.enable(r),_.setClipPlanes(r,u),r.uniformMatrix4fv(_.x3d_ProjectionMatrix,!1,e),r.uniformMatrix4fv(_.x3d_ModelViewMatrix,!1,h),r.uniform1f(_.x3d_Id,x),f?.enable(r),m?.setShaderUniforms(r,_),c?.setShaderUniforms(r,_),d.displaySimple(r,i,_),f?.disable(r),n.resetTextureUnits()}}})(),collide:(()=>{const e=new gi,t=new gi,i=new Xa(Tt.Zero,Tt.Zero),n=new Tt(0,0,0);return function(){const r=[],s=2.2*this.getNavigationInfo().getCollisionRadius();n.set(s,s,s);for(let s=0,o=this.numCollisionShapes;s<o;++s){const o=this.collisionShapes[s],a=o.collisions;if(a.length&&(i.set(n,Tt.Zero),i.multRight(e.assign(o.modelViewMatrix).inverse()),o.shapeNode.intersectsBox(i,o.clipPlanes,t.assign(o.modelViewMatrix))))for(const e of a)r.push(e)}if(this.activeCollisions.length){const e=r.length?this.activeCollisions.filter((e=>!r.includes(e))):this.activeCollisions;for(const t of e)t.set_active(!1)}this.activeCollisions=r;for(const e of r)e.set_active(!0)}})(),gravite:(()=>{const e=new gi,t=new gi,i=new Tt(0,0,0),n=new ui;return function(){const r=this.getBrowser();if(r.getActiveLayer()===this){if("WALK"!==r.getCurrentViewer())return}else if("WALK"!==this.getNavigationInfo().getViewer())return;const s=this.getNavigationInfo(),o=this.getViewpoint(),a=s.getCollisionRadius(),l=s.getNearValue(),u=s.getAvatarHeight(),h=s.getStepHeight();La.ortho(-a,a,-a,a,l,Math.max(2*a,2*u),e);const d=o.getUpVector(),c=n.setFromToVec(Tt.zAxis,d);t.assign(o.getModelMatrix()),t.translate(o.getUserPosition()),t.rotate(c),t.inverse(),t.multRight(e),t.multLeft(o.getCameraSpaceMatrix()),this.getProjectionMatrix().pushMatrix(t);let p=-this.getDepth(e);this.getProjectionMatrix().pop(),p-=u;const g=n.setFromToVec(Tt.yAxis,d);if(p>0){const e=this.speed?r.getCurrentFrameRate():1e6;this.speed-=r.getBrowserOptions()._Gravity.getValue()/e;let t=this.speed/e;t<-p&&(t=-p,this.speed=0),o._positionOffset=o._positionOffset.getValue().add(g.multVecRot(i.set(0,t,0)))}else this.speed=0,p=-p,p>.01&&p<h&&(this.constrainTranslation(g.multVecRot(i.set(0,p,0)),!1),o._positionOffset=i.add(o._positionOffset.getValue()))}})(),depth:(()=>{const e=new Float32Array(16);return function(t,i){const n=this.getBrowser(),r=n.getContext(),s=this.getViewVolume().getViewport();e.set(this.getProjectionMatrix().get()),r.viewport(...s),r.scissor(...s),r.clearColor(1,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.disable(r.CULL_FACE);for(let s=0;s<i;++s){const i=t[s],{scissor:o,clipPlanes:a,modelViewMatrix:l,shapeNode:u,humanoidNode:h}=i,d=u.getAppearance(),c=u.getGeometryContext(),p=d.getStyleProperties(c.geometryType),g=n.getDepthShader(a.length,u,h);r.scissor(...o),g.enable(r),g.setClipPlanes(r,a),r.uniformMatrix4fv(g.x3d_ProjectionMatrix,!1,e),r.uniformMatrix4fv(g.x3d_ModelViewMatrix,!1,l),p?.setShaderUniforms(r,g),h?.setShaderUniforms(r,g),u.displaySimple(r,i,g),n.resetTextureUnits()}}})(),draw(){const e=this.getBrowser(),t=e.getContext(),i=e.getFrameBuffer(),n=this.getViewVolume().getViewport(),r=this.lights,s=this.globalLightsKeys,o=this.globalLights,a=this.generatedCubeMapTextures,l=this.globalShadows,u=l.at(-1),h=this.getNavigationInfo()._headlight.getValue(),d=i.getOIT();if(this.renderCount=this.getNextRenderCount(),this.renderBits.set(0,e.getRenderingProperty("LogarithmicDepthBuffer")||this.getViewpoint().getLogarithmicDepthBuffer()),this.renderBits.set(1,e.getBrowserOption("OrderIndependentTransparency")),this.isIndependent()){for(const e of r)e.renderShadowMap(this);for(const e of a)e.renderTexture(this);i.bind()}h&&e.getHeadlight().setGlobalVariables(this);for(const e of r)e.setGlobalVariables(this);for(const e of o)s.push(e.lightNode.getLightKey());this.viewportArray.set(n),this.cameraSpaceMatrixArray.set(this.getCameraSpaceMatrix().get()),this.projectionMatrixArray.set(this.getProjectionMatrix().get()),t.viewport(...n),t.scissor(...n),t.clear(t.DEPTH_BUFFER_BIT),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),this.getBackground().display(t,this,n);const c=this.opaqueShapes;for(let i=0,n=this.numOpaqueShapes;i<n;++i){const n=c[i];t.scissor(...n.scissor),n.shadows=n.shadows||u,n.objectsKeys.push(...s),n.shapeNode.display(t,n),e.resetTextureUnits()}const p=this.transparentShapes;d?i.bindTransparency():this.transparencySorter.sort(0,this.numTransparentShapes),t.depthMask(!1),t.enable(t.BLEND);for(let i=0,n=this.numTransparentShapes;i<n;++i){const n=p[i];t.scissor(...n.scissor),n.shadows=n.shadows||u,n.objectsKeys.push(...s),n.shapeNode.display(t,n),e.resetTextureUnits()}if(t.depthMask(!0),t.disable(t.BLEND),d&&i.compose(),this.isIndependent()){const t=e.getLocalObjects();for(const e of t)e.dispose();t.length=0;for(const e of o)e.dispose()}s.length=0,o.length=0,r.length=0,l.length=1,a.length=0}});const Za=Ja;i.add("X3DRenderObject","x_ite/Rendering/X3DRenderObject",Za);const Qa=Za;function el(e,t){pr.call(this,e),this.nodes=[t]}Object.assign(Object.setPrototypeOf(el.prototype,pr.prototype),{get(){return this.nodes},top(){return this.nodes.at(-1)},pushOnTop(e){e!==this.nodes[0]&&(this.nodes.at(-1)._isBound=!1,this.nodes.push(e)),e._isBound=!0,e._bindTime=this.getBrowser().getCurrentTime(),this.addNodeEvent()},update(e,t,i){if(!t.length&&!i.length)return;const n=this.top(),r=this.nodes.at(-1);for(const e of t){const t=this.nodes.indexOf(e);t>0&&this.nodes.splice(t,1)}r!==this.nodes[0]&&i.some((e=>!e._set_bind.getValue()&&e===r))&&this.nodes.pop();for(const e of i)if(e._set_bind.getValue()){const t=this.nodes.indexOf(e);t>-1&&this.nodes.splice(t,1),this.nodes.push(e)}const s=this.nodes.at(-1);s!==r&&(r._isBound=!1,s._isBound=!0,s._bindTime=this.getBrowser().getCurrentTime()),s.transitionStart(e,n),this.addNodeEvent()}});for(const e of Object.keys(el.prototype))Object.defineProperty(el.prototype,e,{enumerable:!1});Object.defineProperties(el,{typeName:{value:"BindableStack",enumerable:!0}});const tl=el;i.add("BindableStack","x_ite/Execution/BindableStack",tl);const il=tl;function nl(e,t){pr.call(this,e),this.modificationCount=0,this.nodes=[t],this.collectedNodes=[t],this.changedNodes=[],this.removedNodes=[]}Object.assign(Object.setPrototypeOf(nl.prototype,pr.prototype),{get(){return this.nodes},getBound(e){const t=this.nodes.length;if(1===t)return this.nodes[0];if(e)for(let i=1;i<t;++i){const t=this.nodes[i];if((t.getExecutionContext().getOuterNode()?.getScene()??t.getScene()).isMainScene()&&t.getName()==e)return t}for(let e=1;e<t;++e){const t=this.nodes[e];if((t.getExecutionContext().getOuterNode()?.getScene()??t.getScene()).isMainScene()&&t._isBound.getValue())return t}for(let e=1;e<t;++e){const t=this.nodes[e];if((t.getExecutionContext().getOuterNode()?.getScene()??t.getScene()).isMainScene())return t}return this.nodes[0]},push(e){return this.collectedNodes.push(e)},update(e,t){const{collectedNodes:i,changedNodes:n,removedNodes:r}=this;for(const e of i)e.getModificationCount()>this.modificationCount&&n.push(e);if(!function(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}(i,this.nodes)){for(const e of this.nodes)i.includes(e)||r.push(e);const e=this.nodes;this.nodes=i,this.collectedNodes=e}this.collectedNodes.length=1,t.update(e,r,n),n.length=0,r.length=0,this.modificationCount=ns.getModificationCount()}});for(const e of Object.keys(nl.prototype))Object.defineProperty(nl.prototype,e,{enumerable:!1});Object.defineProperties(nl,{typeName:{value:"BindableList",enumerable:!0}});const rl=nl;i.add("BindableList","x_ite/Execution/BindableList",rl);const sl=rl,ol={TELEPORT:!0,LINEAR:!0,ANIMATE:!0};function al(e){ns.call(this,e),this.addType(d.NavigationInfo),this.addChildObjects(d.outputOnly,"transitionStart",new $n.SFBool,d.outputOnly,"transitionActive",new $n.SFBool,d.outputOnly,"availableViewers",new $n.MFString,d.outputOnly,"viewer",new $n.SFString("EXAMINE")),this._avatarSize.setUnit("length"),this._speed.setUnit("speed"),this._visibilityLimit.setUnit("speed")}Object.assign(Object.setPrototypeOf(al.prototype,ns.prototype),{initialize(){ns.prototype.initialize.call(this),this._type.addInterest("set_type__",this),this._headlight.addInterest("set_headlight__",this),this._transitionStart.addInterest("set_transitionStart__",this),this._transitionComplete.addInterest("set_transitionComplete__",this),this._isBound.addInterest("set_isBound__",this),this.set_type__(),this.set_headlight__()},getViewer(){return this._viewer.getValue()},getCollisionRadius(){return this._avatarSize.length>0&&this._avatarSize[0]>0?this._avatarSize[0]:.25},getAvatarHeight(){return this._avatarSize.length>1?this._avatarSize[1]:1.6},getStepHeight(){return this._avatarSize.length>2?this._avatarSize[2]:.75},getNearValue(){const e=this.getCollisionRadius();return 0===e?1e-5:e/2},getFarValue(e){return this._visibilityLimit.getValue()?this._visibilityLimit.getValue():e.getMaxFarValue()},getTransitionType(){for(const e of this._transitionType){if(ol[e])return e}return"LINEAR"},set_type__(){this._viewer="EXAMINE";for(const e of this._type){switch(e){case"EXAMINE":case"WALK":case"FLY":case"LOOKAT":case"PLANE":case"NONE":this._viewer=e;break;case"PLANE_create3000.github.io":case"PLANE_create3000.de":this._viewer="PLANE";break;default:continue}break}let e=!1,t=!1,i=!1,n=!1,r=!1,s=!1;if(this._type.length)for(const o of this._type){switch(o){case"EXAMINE":default:e=!0;continue;case"WALK":t=!0;continue;case"FLY":i=!0;continue;case"LOOKAT":s=!0;continue;case"PLANE":n=!0;continue;case"NONE":r=!0;continue;case"ANY":e=!0,t=!0,i=!0,n=!0,r=!0,s=!0}break}else e=!0,t=!0,i=!0,n=!0,r=!0,s=!0;this._availableViewers.length=0,e&&this._availableViewers.push("EXAMINE"),t&&this._availableViewers.push("WALK"),i&&this._availableViewers.push("FLY"),n&&this._availableViewers.push("PLANE"),s&&this._availableViewers.push("LOOKAT"),r&&this._availableViewers.push("NONE")},set_headlight__(){this._headlight.getValue()?delete this.enable:this.enable=Function.prototype},set_transitionStart__(){this._transitionActive.getValue()||(this._transitionActive=!0)},set_transitionComplete__(){this._transitionActive.getValue()&&(this._transitionActive=!1)},set_isBound__(){this._isBound.getValue()||this._transitionActive.getValue()&&(this._transitionActive=!1)},enable(e,t){e===Ma.DISPLAY&&this._headlight.getValue()&&t.getGlobalLights().push(this.getBrowser().getHeadlight())},traverse(e,t){e===Ma.CAMERA&&t.getLayer().getNavigationInfos().push(this)}}),Object.defineProperties(al,{typeName:{value:"NavigationInfo",enumerable:!0},componentInfo:{value:Object.freeze({name:"Navigation",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_bind",new $n.SFBool),new k(d.inputOutput,"type",new $n.MFString("EXAMINE","ANY")),new k(d.inputOutput,"avatarSize",new $n.MFFloat(.25,1.6,.75)),new k(d.inputOutput,"speed",new $n.SFFloat(1)),new k(d.inputOutput,"headlight",new $n.SFBool(!0)),new k(d.inputOutput,"visibilityLimit",new $n.SFFloat),new k(d.inputOutput,"transitionType",new $n.MFString("LINEAR")),new k(d.inputOutput,"transitionTime",new $n.SFTime(1)),new k(d.outputOnly,"transitionComplete",new $n.SFBool),new k(d.outputOnly,"isBound",new $n.SFBool),new k(d.outputOnly,"bindTime",new $n.SFTime)]),enumerable:!0}});const ll=al;i.add("NavigationInfo","x_ite/Components/Navigation/NavigationInfo",ll);const ul=ll;const hl=function(e){return Object.assign([],{top:0,pop(){return 0!==this.top?this[--this.top]:new e},push(e){this[this.top++]=e},clear(){this.length=0,this.top=0}})};i.add("ObjectCache","standard/Utility/ObjectCache",hl);const dl=hl,cl=dl(pl);function pl(){this.fogMatrix=new Float32Array(9)}function gl(e){this.addType(d.X3DFogObject),this.addChildObjects(d.inputOutput,"hidden",new $n.SFBool),this._visibilityRange.setUnit("length"),this.colorArray=new Float32Array(3)}Object.assign(pl.prototype,{set(e,t){this.fogNode=e,this.fogMatrix.set(t.submatrix.inverse())},getFogType(){return this.fogNode.getFogType()},setShaderUniforms(e,t){if(t.hasFog(this))return;const i=this.fogNode;e.uniform3fv(t.x3d_FogColor,i.colorArray),e.uniform1f(t.x3d_FogVisibilityRange,i.visibilityRange),e.uniformMatrix3fv(t.x3d_FogMatrix,!1,this.fogMatrix)},dispose(){cl.push(this)}}),Object.assign(gl.prototype,{initialize(){this._hidden.addInterest("set_fogType__",this),this._fogType.addInterest("set_fogType__",this),this._color.addInterest("set_color__",this),this._visibilityRange.addInterest("set_visibilityRange__",this),this.set_color__(),this.set_visibilityRange__()},isHidden(){return this._hidden.getValue()},setHidden(e){e!==this._hidden.getValue()&&(this._hidden=e)},getFogType(){return this.fogType},getFogs:()=>cl,set_fogType__:(()=>{const e=new Map([["LINEAR",1],["EXPONENTIAL",2]]);return function(){this._hidden.getValue()||0===this.visibilityRange?this.fogType=0:this.fogType=e.get(this._fogType.getValue())||1}})(),set_color__(){const e=this._color.getValue(),t=this.colorArray;t[0]=e.r,t[1]=e.g,t[2]=e.b},set_visibilityRange__(){this.visibilityRange=Math.max(0,this._visibilityRange.getValue()),this.set_fogType__()},dispose(){}}),Object.defineProperties(gl,{typeName:{value:"X3DFogObject",enumerable:!0},componentInfo:{value:Object.freeze({name:"EnvironmentalEffects",level:1}),enumerable:!0}});const fl=gl;i.add("X3DFogObject","x_ite/Components/EnvironmentalEffects/X3DFogObject",fl);const ml=fl;function _l(e){ns.call(this,e),ml.call(this,e),this.addType(d.Fog),this.modelMatrix=new gi}Object.assign(Object.setPrototypeOf(_l.prototype,ns.prototype),ml.prototype,{initialize(){ns.prototype.initialize.call(this),ml.prototype.initialize.call(this)},getModelMatrix(){return this.modelMatrix},traverse(e,t){e===Ma.CAMERA&&(t.getLayer().getFogs().push(this),this.modelMatrix.assign(t.getModelViewMatrix().get()))},dispose(){ml.prototype.dispose.call(this),ns.prototype.dispose.call(this)}}),Object.defineProperties(_l,{typeName:{value:"Fog",enumerable:!0},componentInfo:{value:Object.freeze({name:"EnvironmentalEffects",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_bind",new $n.SFBool),new k(d.inputOutput,"fogType",new $n.SFString("LINEAR")),new k(d.inputOutput,"color",new $n.SFColor(1,1,1)),new k(d.inputOutput,"visibilityRange",new $n.SFFloat),new k(d.outputOnly,"isBound",new $n.SFBool),new k(d.outputOnly,"bindTime",new $n.SFTime)]),enumerable:!0}});const xl=_l;i.add("Fog","x_ite/Components/EnvironmentalEffects/Fog",xl);const yl=xl;function wl(e){this.gl=e,this.vertexArrays=new Map}Object.assign(wl.prototype,{update(e=!0){return e&&this.delete(),this},enable(e){const t=this.vertexArrays.get(e);if(t)return this.gl.bindVertexArray(t),!1;{this.vertexArrays.size>100&&this.delete();const t=this.gl.createVertexArray();return this.vertexArrays.set(e,t),this.gl.bindVertexArray(t),!0}},delete(){for(const e of this.vertexArrays.values())this.gl.deleteVertexArray(e);this.vertexArrays.clear()}});const bl=wl;i.add("VertexArray","x_ite/Rendering/VertexArray",bl);const Sl=bl;let Tl=0;const vl={POINT:Tl++,WIREFRAME:Tl++,FLAT:Tl++,GOURAUD:Tl++,PHONG:Tl++};i.add("Shading","x_ite/Browser/Core/Shading",vl);const Ol=vl,El=[new Tt(0,0,1),new Tt(0,0,-1),new Tt(0,1,0),new Tt(0,-1,0),new Tt(1,0,0)];function Cl(e){Sr.call(this,e),this.addType(d.X3DGeometryNode),this.addChildObjects(d.outputOnly,"transparent",new $n.SFBool,d.outputOnly,"bbox_changed",new $n.SFTime,d.outputOnly,"rebuild",new $n.SFTime);const t=this.getBrowser();this.min=new Tt(0,0,0),this.max=new Tt(0,0,0),this.bbox=Xa.Extents(this.min,this.max),this.solid=!0,this.primitiveMode=t.getContext().TRIANGLES,this.geometryType=3,this.flatShading=void 0,this.colorMaterial=!1,this.attribNodes=[],this.attribArrays=[],this.textureCoordinateMapping=new Map,this.multiTexCoords=[],this.coordIndices=Cl.createArray(),this.texCoords=Cl.createArray(),this.fogDepths=Cl.createArray(),this.colors=Cl.createArray(),this.normals=Cl.createArray(),this.flatNormals=Cl.createArray(),this.vertices=Cl.createArray(),this.hasFogCoords=!1,this.hasNormals=!1,this.geometryKey="",this.vertexCount=0,this.planes=[];for(let e=0;e<5;++e)this.planes[e]=new da(Tt.Zero,Tt.zAxis)}Object.defineProperty(Cl,"createArray",{value(){const e=[];return e.typedArray=new Float32Array,e.assign=function(e){const t=e.length;for(let i=0;i<t;++i)this[i]=e[i];this.length=t},e.getValue=function(){return this.typedArray},e.shrinkToFit=function(){this.length===this.typedArray.length?this.typedArray.set(this):this.typedArray=new Float32Array(this)},e}}),Object.assign(Object.setPrototypeOf(Cl.prototype,Sr.prototype),{setup(){Sr.prototype.setup.call(this),this.rebuild()},initialize(){Sr.prototype.initialize.call(this);const e=this.getBrowser(),t=e.getContext();this.getLive().addInterest("set_live__",this),this.addInterest("requestRebuild",this),this._rebuild.addInterest("rebuild",this),this.frontFace=t.CCW,this.backFace=new Map([[t.CCW,t.CW],[t.CW,t.CCW]]),this.coordIndexBuffer=t.createBuffer(),this.attribBuffers=[],this.textureCoordinateNode=e.getDefaultTextureCoordinate(),this.texCoordBuffers=Array.from({length:e.getMaxTexCoords()},(()=>t.createBuffer())),this.fogDepthBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer(),this.normalBuffer=t.createBuffer(),this.vertexBuffer=t.createBuffer(),this.vertexArrayObject=new Sl(t),this.set_live__()},setGeometryType(e){this.geometryType=e},getGeometryType(){return this.geometryType},setTransparent(e){e!==this._transparent.getValue()&&(this._transparent=e)},isTransparent(){return this._transparent.getValue()},getBBox(){return this.bbox},setBBox(e){if(!e.equals(this.bbox)){e.getExtents(this.min,this.max),this.bbox.assign(e);for(let e=0;e<5;++e)this.planes[e].set(e%2?this.min:this.max,El[e]);this._bbox_changed.addEvent()}},getMin(){return this.min},getMax(){return this.max},getMatrix:()=>gi.Identity,setPrimitiveMode(e){this.primitiveMode=e},getPrimitiveMode(){return this.primitiveMode},setSolid(e){this.solid=e},setCCW(e){const t=this.getBrowser().getContext();this.frontFace=e?t.CCW:t.CW},getCoordIndices(){return this.coordIndices},getAttrib(){return this.attribNodes},getAttribs(){return this.attribArrays},getAttribBuffers(){return this.attribBuffers},setFogDepths(e){this.fogDepths.assign(e)},getFogDepths(){return this.fogDepths},setColors(e){this.colors.assign(e)},getColors(){return this.colors},setMultiTexCoords(e){const t=this.multiTexCoords,i=e.length;for(let n=0;n<i;++n)t[n]=e[n];t.length=i},getMultiTexCoords(){return this.multiTexCoords},getTexCoords(){return this.texCoords},getTextureCoordinate(){return this.textureCoordinateNode},setTextureCoordinate(e){this.textureCoordinateNode.removeInterest("updateTextureCoordinateMapping",this),this.textureCoordinateNode=e??this.getBrowser().getDefaultTextureCoordinate(),this.textureCoordinateNode.addInterest("updateTextureCoordinateMapping",this),this.updateTextureCoordinateMapping()},getTextureCoordinateMapping(){return this.textureCoordinateMapping},updateTextureCoordinateMapping(){this.textureCoordinateMapping.clear(),this.textureCoordinateNode.getTextureCoordinateMapping(this.textureCoordinateMapping)},setNormals(e){this.normals.assign(e)},getNormals(){return this.normals},setVertices(e){this.vertices.assign(e)},getVertices(){return this.vertices},updateVertexArrays(){this.vertexArrayObject.update(),this.updateParticles=!0},buildTexCoords(){const e=this.texCoords;if(0===e.length){const t=this.getTexCoordParams(),i=t.min,n=t.Sindex,r=t.Tindex,s=t.Ssize,o=i[n],a=i[r],l=this.vertices.getValue();for(let t=0,i=l.length;t<i;t+=4)e.push((l[t+n]-o)/s,(l[t+r]-a)/s,0,1);e.shrinkToFit()}this.getMultiTexCoords().push(e)},getTexCoordParams:(()=>{const e={min:new Tt(0,0,0),Ssize:0,Sindex:0,Tindex:0};return function(){const t=this.getBBox(),i=t.size,n=i.x,r=i.y,s=i.z;return e.min.assign(t.center).subtract(i.divide(2)),n>=r&&n>=s?(e.Ssize=n,e.Sindex=0,e.Tindex=r>=s?1:2):r>=n&&r>=s?(e.Ssize=r,e.Sindex=1,e.Tindex=n>=s?0:2):(e.Ssize=s,e.Sindex=2,e.Tindex=n>=r?0:1),e}})(),refineNormals(e,t,i){if(0===i)return t;const n=Math.cos(g.clamp(i,0,Math.PI)),r=[];for(const i of e.values())for(const e of i){const s=t[e],o=new Tt(0,0,0);for(const e of i){const i=t[e];i.dot(s)>=n&&o.add(i)}r[e]=o.normalize()}return r},transformLine(e){},transformMatrix(e){},isClipped:(e,t)=>t.some((t=>t.isClipped(e))),intersectsLine:(()=>{const e=new gi,t={u:0,v:0,t:0},i=new Tt(0,0,0),n=new Tt(0,0,0),r=new Tt(0,0,0),s=new Tt(0,0,0);return function(o,a,l,u){if(this.intersectsBBox(o)){this.transformLine(o),this.transformMatrix(e.assign(a));const h=this.multiTexCoords[0].getValue(),d=this.normals.getValue(),c=this.vertices.getValue(),p=this.vertexCount;for(let a=0;a<p;a+=3){const p=4*a;if(i.x=c[p],i.y=c[p+1],i.z=c[p+2],n.x=c[p+4],n.y=c[p+5],n.z=c[p+6],r.x=c[p+8],r.y=c[p+9],r.z=c[p+10],o.intersectsTriangle(i,n,r,t)){const i=t.u,n=t.v,r=t.t,o=new Tt(r*c[p]+i*c[p+4]+n*c[p+8],r*c[p+1]+i*c[p+5]+n*c[p+9],r*c[p+2]+i*c[p+6]+n*c[p+10]);if(l.length&&this.isClipped(e.multVecMatrix(s.assign(o)),l))continue;const g=new _t(r*h[p]+i*h[p+4]+n*h[p+8],r*h[p+1]+i*h[p+5]+n*h[p+9]),f=3*a,m=new Tt(r*d[f]+i*d[f+3]+n*d[f+6],r*d[f+1]+i*d[f+4]+n*d[f+7],r*d[f+2]+i*d[f+5]+n*d[f+8]);u.push({texCoord:g,normal:m,point:this.getMatrix().multVecMatrix(o)})}}}return u.length}})(),getPlanesWithOffset:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0),i=[];for(let e=0;e<5;++e)i[e]=new da(Tt.Zero,Tt.zAxis);return function(n,r,s,o,a,l){e.set(n,r,s),t.set(o,a,l);for(let n=0;n<5;++n)i[n].set(n%2?e:t,El[n]);return i}})(),intersectsBBox:(()=>{const e=new Tt(0,0,0);return function(t,i){if(i)var n=this.min,r=this.max,s=n.x-i.x,o=r.x+i.x,a=n.y-i.y,l=r.y+i.y,u=n.z-i.z,h=r.z+i.z,d=this.getPlanesWithOffset(s,a,u,o,l,h);else n=this.min,r=this.max,s=n.x,o=r.x,a=n.y,l=r.y,u=n.z,h=r.z,d=this.planes;return!!(d[0].intersectsLine(t,e)&&e.x>=s&&e.x<=o&&e.y>=a&&e.y<=l)||(!!(d[1].intersectsLine(t,e)&&e.x>=s&&e.x<=o&&e.y>=a&&e.y<=l)||(!!(d[2].intersectsLine(t,e)&&e.x>=s&&e.x<=o&&e.z>=u&&e.z<=h)||(!!(d[3].intersectsLine(t,e)&&e.x>=s&&e.x<=o&&e.z>=u&&e.z<=h)||!!(d[4].intersectsLine(t,e)&&e.y>=a&&e.y<=l&&e.z>=u&&e.z<=h))))}})(),intersectsBox:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0),i=new Tt(0,0,0),n=new gi,r=new Tt(0,0,0);return function(s,o,a){if(s.intersectsBox(this.bbox)){s.multRight(n.assign(this.getMatrix()).inverse()),this.transformMatrix(a);const l=this.vertices.getValue();for(let n=0,u=this.vertexCount;n<u;n+=3){const u=4*n;if(e.x=l[u],e.y=l[u+1],e.z=l[u+2],t.x=l[u+4],t.y=l[u+5],t.z=l[u+6],i.x=l[u+8],i.y=l[u+9],i.z=l[u+10],s.intersectsTriangle(e,t,i)){if(o.length){if(this.isClipped(a.multVecMatrix(r.assign(e)),o))continue;if(this.isClipped(a.multVecMatrix(r.assign(t)),o))continue;if(this.isClipped(a.multVecMatrix(r.assign(i)),o))continue}return!0}}}return!1}})(),set_live__(){this.getLive().getValue()?this.getBrowser().getBrowserOptions()._Shading.addInterest("set_shading__",this):this.getBrowser().getBrowserOptions()._Shading.removeInterest("set_shading__",this)},set_shading__:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0),i=new Tt(0,0,0),n=new Tt(0,0,0);return function(r){const s=this.getBrowser(),o=s.getContext();if(this.geometryType<2)o.bindBuffer(o.ARRAY_BUFFER,this.normalBuffer),o.bufferData(o.ARRAY_BUFFER,this.normals.getValue(),o.DYNAMIC_DRAW);else{const r=s.getBrowserOptions().getShading()===Ol.FLAT;if(r===this.flatShading)return;if(this.flatShading=r,r&&!this.flatNormals.length){const r=this.frontFace===o.CW,s=this.flatNormals,a=this.vertices.getValue();for(let o=0,l=a.length;o<l;o+=12)fa.normal(e.set(a[o],a[o+1],a[o+2]),t.set(a[o+4],a[o+5],a[o+6]),i.set(a[o+8],a[o+9],a[o+10]),n),r&&n.negate(),s.push(n.x,n.y,n.z,n.x,n.y,n.z,n.x,n.y,n.z);s.shrinkToFit()}o.bindBuffer(o.ARRAY_BUFFER,this.normalBuffer),o.bufferData(o.ARRAY_BUFFER,r?this.flatNormals.getValue():this.normals.getValue(),o.DYNAMIC_DRAW)}}})(),requestRebuild(){this._rebuild.addEvent()},rebuild:(()=>{const e=new Tt(0,0,0);return function(){this.clear(),this.build();for(const e of this.attribArrays)e.shrinkToFit();for(const e of this.multiTexCoords)e.shrinkToFit();this.coordIndices.shrinkToFit(),this.fogDepths.shrinkToFit(),this.colors.shrinkToFit(),this.normals.shrinkToFit(),this.vertices.shrinkToFit();const t=this.vertices.getValue(),i=this.min,n=this.max;if(t.length){if(i.x===Number.POSITIVE_INFINITY)for(let r=0,s=t.length;r<s;r+=4)e.set(t[r],t[r+1],t[r+2]),i.min(e),n.max(e);this.bbox.setExtents(i,n)}else this.bbox.setExtents(i.set(0,0,0),n.set(0,0,0));this._bbox_changed.addEvent();for(let e=0;e<5;++e)this.planes[e].set(e%2?i:n,El[e]);0===this.multiTexCoords.length&&this.buildTexCoords(),this.transfer(),this.updateGeometryKey(),this.updateRenderFunctions()}})(),clear(){this.min.set(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),this.max.set(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);{const e=this.attribArrays;for(const t of e)t.length=0;const t=this.attribNodes.length;for(let i=e.length;i<t;++i)e[i]=new $n.MFFloat;e.length=t}this.flatShading=void 0,this.coordIndices.length=0,this.fogDepths.length=0,this.colors.length=0,this.multiTexCoords.length=0,this.texCoords.length=0,this.normals.length=0,this.flatNormals.length=0,this.vertices.length=0},transfer(){const e=this.getBrowser().getContext();e.bindBuffer(e.ARRAY_BUFFER,this.coordIndexBuffer),e.bufferData(e.ARRAY_BUFFER,this.coordIndices.getValue(),e.DYNAMIC_DRAW);for(let t=this.attribBuffers.length,i=this.attribArrays.length;t<i;++t)this.attribBuffers.push(e.createBuffer());for(let t=0,i=this.attribArrays.length;t<i;++t)e.bindBuffer(e.ARRAY_BUFFER,this.attribBuffers[t]),e.bufferData(e.ARRAY_BUFFER,this.attribArrays[t].getValue(),e.DYNAMIC_DRAW);const t=this.hasFogCoords;e.bindBuffer(e.ARRAY_BUFFER,this.fogDepthBuffer),e.bufferData(e.ARRAY_BUFFER,this.fogDepths.getValue(),e.DYNAMIC_DRAW),this.hasFogCoords=!!this.fogDepths.length,this.hasFogCoords!==t&&this.updateVertexArrays();const i=this.colorMaterial;e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,this.colors.getValue(),e.DYNAMIC_DRAW),this.colorMaterial=!!this.colors.length,this.colorMaterial!==i&&this.updateVertexArrays();for(let t=0,i=this.multiTexCoords.length;t<i;++t)e.bindBuffer(e.ARRAY_BUFFER,this.texCoordBuffers[t]),e.bufferData(e.ARRAY_BUFFER,this.multiTexCoords[t].getValue(),e.DYNAMIC_DRAW);const n=this.hasNormals;this.set_shading__(this.getBrowser().getBrowserOptions()._Shading),this.hasNormals=!!this.normals.length,this.hasNormals!==n&&this.updateVertexArrays(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices.getValue(),e.DYNAMIC_DRAW),this.vertexCount=this.vertices.length/4},updateGeometryKey(){this.geometryKey="",this.geometryKey+=this.geometryType,this.geometryKey+=this.hasFogCoords?"1":"0",this.geometryKey+=this.colorMaterial?"1":"0",this.geometryKey+=this.hasNormals?"1":"0"},updateRenderFunctions(){this.vertexCount?(delete this.displaySimple,delete this.display,delete this.displaySimpleParticles,delete this.displayParticles):(this.displaySimple=Function.prototype,this.display=Function.prototype,this.displaySimpleParticles=Function.prototype,this.displayParticles=Function.prototype)},traverse(e,t){},displaySimple(e,t,i){this.vertexArrayObject.enable(i.getProgram())&&(this.coordIndices.length&&i.enableCoordIndexAttribute(e,this.coordIndexBuffer,0,0),this.multiTexCoords.length&&i.enableTexCoordAttribute(e,this.texCoordBuffers,0,0),this.hasNormals&&i.enableNormalAttribute(e,this.normalBuffer,0,0),i.enableVertexAttribute(e,this.vertexBuffer,0,0)),e.drawArrays(this.primitiveMode,0,this.vertexCount)},display(e,t){const i=this.getBrowser(),n=t.appearanceNode,r=n.getShader(this,t);if(this.solid||!n.getBackMaterial()||i.getWireframe())this.displayGeometry(e,t,n,r,!0,!0);else{const i=n.getBackShader(this,t);this.displayGeometry(e,t,n,i,!0,!1),this.displayGeometry(e,t,n,r,!1,!0)}},displayGeometry(e,t,i,n,r,s){const o=this.getBrowser(),a=i.getRenderModes(),l=this.attribNodes,u=this.attribBuffers,h=o.getPrimitiveMode(this.primitiveMode);for(const t of a)t.enable(e);if(n.enable(e),n.setUniforms(e,this,t,s),this.vertexArrayObject.enable(n.getProgram())){this.coordIndices.length&&n.enableCoordIndexAttribute(e,this.coordIndexBuffer,0,0);for(let t=0,i=l.length;t<i;++t)l[t].enable(e,n,u[t]);this.hasFogCoords&&n.enableFogDepthAttribute(e,this.fogDepthBuffer,0,0),this.colorMaterial&&n.enableColorAttribute(e,this.colorBuffer,0,0),n.enableTexCoordAttribute(e,this.texCoordBuffers,0,0),n.enableNormalAttribute(e,this.normalBuffer,0,0),n.enableVertexAttribute(e,this.vertexBuffer,0,0)}if(o.getWireframe())for(let t=0,i=this.vertexCount;t<i;t+=3)e.drawArrays(h,t,3);else{const i=gi.prototype.determinant3.call(t.modelViewMatrix)>0;e.frontFace(i?this.frontFace:this.backFace.get(this.frontFace)),t.transparent||r!==s?(e.enable(e.CULL_FACE),r&&!this.solid&&(e.cullFace(e.FRONT),e.drawArrays(h,0,this.vertexCount)),s&&(e.cullFace(e.BACK),e.drawArrays(h,0,this.vertexCount))):(this.solid?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.drawArrays(h,0,this.vertexCount))}for(const t of a)t.disable(e)},displaySimpleParticles(e,t,i){const n=i.outputParticles;if(n.vertexArrayObject.update(this.updateParticles).enable(t.getProgram())){const{particleStride:r,particleOffset:s,matrixOffset:o}=i;t.enableParticleAttribute(e,n,r,s,1),t.enableParticleMatrixAttribute(e,n,r,o,1),t.enableTexCoordAttribute(e,this.texCoordBuffers,0,0),t.enableNormalAttribute(e,this.normalBuffer,0,0),t.enableVertexAttribute(e,this.vertexBuffer,0,0),this.updateParticles=!1}e.drawArraysInstanced(this.primitiveMode,0,this.vertexCount,i.numParticles)},displayParticles(e,t,i){const n=this.getBrowser(),r=t.appearanceNode,s=r.getShader(this,t);if(this.solid||!r.getBackMaterial()||n.getWireframe())this.displayParticlesGeometry(e,t,r,s,!0,!0,i);else{const n=r.getBackShader(this,t);this.displayParticlesGeometry(e,t,r,n,!0,!1,i),this.displayParticlesGeometry(e,t,r,s,!1,!0,i)}},displayParticlesGeometry(e,t,i,n,r,s,o){const a=this.getBrowser(),l=i.getRenderModes(),u=this.attribNodes,h=this.attribBuffers,d=a.getPrimitiveMode(this.primitiveMode);for(const t of l)t.enable(e);n.enable(e),n.setUniforms(e,this,t,s);const c=o.outputParticles;if(c.vertexArrayObject.update(this.updateParticles).enable(n.getProgram())){const{particleStride:t,particleOffset:i,matrixOffset:r}=o;n.enableParticleAttribute(e,c,t,i,1),n.enableParticleMatrixAttribute(e,c,t,r,1);for(let t=0,i=u.length;t<i;++t)u[t].enable(e,n,h[t]);this.hasFogCoords&&n.enableFogDepthAttribute(e,this.fogDepthBuffer,0,0),this.colorMaterial&&n.enableColorAttribute(e,this.colorBuffer,0,0),n.enableTexCoordAttribute(e,this.texCoordBuffers,0,0),n.enableNormalAttribute(e,this.normalBuffer,0,0),n.enableVertexAttribute(e,this.vertexBuffer,0,0),this.updateParticles=!1}const p=gi.prototype.determinant3.call(t.modelViewMatrix)>0;e.frontFace(p?this.frontFace:this.backFace.get(this.frontFace)),t.transparent||r!==s?(e.enable(e.CULL_FACE),r&&!this.solid&&(e.cullFace(e.FRONT),e.drawArraysInstanced(d,0,this.vertexCount,o.numParticles)),s&&(e.cullFace(e.BACK),e.drawArraysInstanced(d,0,this.vertexCount,o.numParticles))):(this.solid?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.drawArraysInstanced(d,0,this.vertexCount,o.numParticles));for(const t of l)t.disable(e)}}),Object.defineProperties(Cl,{typeName:{value:"X3DGeometryNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Rendering",level:1}),enumerable:!0}});const Nl=Cl;i.add("X3DGeometryNode","x_ite/Components/Rendering/X3DGeometryNode",Nl);const Il=Nl;let Fl=0;const Ml={AUTO:Fl++,OPAQUE:Fl++,MASK:Fl++,BLEND:Fl++};i.add("AlphaMode","x_ite/Browser/Shape/AlphaMode",Ml);const Dl=Ml;function Rl(e={}){Object.assign(this,{alphaMode:Dl.OPAQUE,geometryType:3,hasFogCoords:!1,colorMaterial:!1,hasNormals:!1,textureNode:null,objectsKeys:[],textureCoordinateMapping:new Map,textureCoordinateNode:null},e),this.updateGeometryKey()}Object.assign(Rl.prototype,{updateGeometryKey:Il.prototype.updateGeometryKey,getTextureCoordinateMapping(){return this.textureCoordinateMapping},getTextureCoordinate(){return this.textureCoordinateNode}});const Pl=Rl;i.add("GeometryContext","x_ite/Browser/Rendering/GeometryContext",Pl);const Al=Pl,Vl=Math.SQRT2/2;function Ll(e){ns.call(this,e),this.addType(d.X3DBackgroundNode),this.addChildObjects(d.inputOutput,"hidden",new $n.SFBool),this._skyAngle.setUnit("angle"),this._groundAngle.setUnit("angle"),this.projectionMatrixArray=new Float32Array(16),this.modelMatrix=new gi,this.modelViewMatrixArray=new Float32Array(16),this.clipPlanes=[],this.colors=[],this.sphere=[],this.textureNodes=new Array(6),this.textureBits=new Ya,this.sphereContext=new Al({colorMaterial:!0}),this.sphereAlphaContext=new Al({colorMaterial:!0,alphaMode:Dl.BLEND}),this.texturesContext=new Al({})}Object.assign(Object.setPrototypeOf(Ll.prototype,ns.prototype),{initialize(){ns.prototype.initialize.call(this);const e=this.getBrowser().getContext();this.colorBuffer=e.createBuffer(),this.sphereBuffer=e.createBuffer(),this.texCoordBuffers=[e.createBuffer()],this.textureBuffers=Array.from({length:6},(()=>e.createBuffer())),this.sphereArrayObject=new Sl(e),this.textureArrayObjects=Array.from({length:6},(()=>new Sl(e))),this._groundAngle.addInterest("build",this),this._groundColor.addInterest("build",this),this._skyAngle.addInterest("build",this),this._skyColor.addInterest("build",this),this.build(),this.transferRectangle()},isHidden(){return this._hidden.getValue()},setHidden(e){e!==this._hidden.getValue()&&(this._hidden=e)},isTransparent(){if(this._hidden.getValue())return!0;if(this._transparency.getValue()<=0)return!1;if(6!==this.textureBits.size)return!0;for(const e of this.textureBits)if(this.textureNodes[e]._transparent.getValue())return!0;return!1},set_texture__(e,t){this.textureNodes[e]?.removeInterest(`set_loadState${e}__`,this),this.textureNodes[e]=t,t?.addInterest(`set_loadState${e}__`,this,e,t),this.set_loadState__(e,t)},set_loadState__(e,t){this.setTextureBit(e,t?.checkLoadState())},setTextureBit(e,t){this.textureBits.set(e,t===d.COMPLETE_STATE)},getColor:(e,t,i)=>t[g.upperBound(i,0,i.length,e)],build(){const e=Vl;if(this.colors.length=0,this.sphere.length=0,0===this._groundColor.length&&1==this._skyColor.length){this.sphere.vertices=36,this.sphere.push(e,e,-e,1,-e,e,-e,1,-e,-e,-e,1,e,e,-e,1,-e,-e,-e,1,e,-e,-e,1,-e,e,e,1,e,e,e,1,-e,-e,e,1,-e,-e,e,1,e,e,e,1,e,-e,e,1,-e,e,-e,1,-e,e,e,1,-e,-e,e,1,-e,e,-e,1,-e,-e,e,1,-e,-e,-e,1,e,e,e,1,e,e,-e,1,e,-e,e,1,e,-e,e,1,e,e,-e,1,e,-e,-e,1,e,e,e,1,-e,e,e,1,-e,e,-e,1,e,e,e,1,-e,e,-e,1,e,e,-e,1,-e,-e,e,1,e,-e,e,1,-e,-e,-e,1,-e,-e,-e,1,e,-e,e,1,e,-e,-e,1);const t=this._skyColor[0];for(let e=0,i=this.sphere.vertices;e<i;++e)this.colors.push(...t,1)}else{if(this._skyColor.length>this._skyAngle.length){const e=this._skyAngle.slice();(0===e.length||e[0]>0)&&e.unshift(0),e.at(-1)<Math.PI&&e.push(Math.PI),2===e.length&&e.splice(1,0,(e[0]+e[1])/2),this.buildSphere(1,e,this._skyAngle,this._skyColor,!1)}if(this._groundColor.length>this._groundAngle.length){const e=this._groundAngle.slice().reverse();(0===e.length||e[0]<Math.PI/2)&&e.unshift(Math.PI/2),e.at(-1)>0&&e.push(0),this.buildSphere(1,e,this._groundAngle,this._groundColor,!0)}}this.transferSphere()},buildSphere:(()=>{const e=new Lo(0,0),t=new Lo(0,0),i=new Lo(0,0),n=new Lo(0,0),r=new Lo(0,0),s=new Lo(0,0);return function(o,a,l,u,h){const d=h?Math.PI/2:Math.PI,c=a.length-1;for(let p=0;p<c;++p){let c=g.clamp(a[p],0,d),f=g.clamp(a[p+1],0,d);h&&(c=Math.PI-c,f=Math.PI-f),e.setPolar(o,c),t.setPolar(o,f);const m=this.getColor(a[p],u,l),_=this.getColor(a[p+1],u,l);for(let o=0;o<20;++o){const a=o<19?o+1:0;let l=2*Math.PI*(o/20);i.setPolar(-e.imag,l),n.setPolar(-t.imag,l),l=2*Math.PI*(a/20),r.setPolar(-t.imag,l),s.setPolar(-e.imag,l),this.colors.push(...m,1,..._,1,..._,1,...m,1,...m,1,..._,1),this.sphere.push(i.imag,e.real,i.real,1,r.imag,t.real,r.real,1,n.imag,t.real,n.real,1,i.imag,e.real,i.real,1,s.imag,e.real,s.real,1,r.imag,t.real,r.real,1)}}}})(),transferSphere(){const e=this.getBrowser().getContext();e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.colors),e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.sphereBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.sphere),e.DYNAMIC_DRAW),this.sphereCount=this.sphere.length/4},transferRectangle:(()=>{const e=Vl,t=new Float32Array([1,1,0,1,0,1,0,1,0,0,0,1,1,1,0,1,0,0,0,1,1,0,0,1]),i=[new Float32Array([e,e,-e,1,-e,e,-e,1,-e,-e,-e,1,e,e,-e,1,-e,-e,-e,1,e,-e,-e,1]),new Float32Array([-e,e,e,1,e,e,e,1,e,-e,e,1,-e,e,e,1,e,-e,e,1,-e,-e,e,1]),new Float32Array([-e,e,-e,1,-e,e,e,1,-e,-e,e,1,-e,e,-e,1,-e,-e,e,1,-e,-e,-e,1]),new Float32Array([e,e,e,1,e,e,-e,1,e,-e,-e,1,e,e,e,1,e,-e,-e,1,e,-e,e,1]),new Float32Array([e,e,e,1,-e,e,e,1,-e,e,-e,1,e,e,e,1,-e,e,-e,1,e,e,-e,1]),new Float32Array([e,-e,-e,1,-e,-e,-e,1,-e,-e,e,1,e,-e,-e,1,-e,-e,e,1,e,-e,e,1])];return function(){const e=this.getBrowser().getContext();e.bindBuffer(e.ARRAY_BUFFER,this.texCoordBuffers[0]),e.bufferData(e.ARRAY_BUFFER,t,e.DYNAMIC_DRAW);for(let t=0;t<6;++t)e.bindBuffer(e.ARRAY_BUFFER,this.textureBuffers[t]),e.bufferData(e.ARRAY_BUFFER,i[t],e.DYNAMIC_DRAW)}})(),traverse(e,t){switch(e){case Ma.CAMERA:return t.getLayer().getBackgrounds().push(this),void this.modelMatrix.assign(t.getModelViewMatrix().get());case Ma.DISPLAY:{const e=t.getLocalObjects(),i=this.clipPlanes;let n=0;for(let t=0,r=e.length;t<r;++t)e[t].isClipped&&(i[n++]=e[t]);i.length=n;for(let e=0;e<n;++e)this.sphereContext.objectsKeys[e]=0,this.texturesContext.objectsKeys[e]=0;return this.sphereContext.objectsKeys.length=n,void(this.texturesContext.objectsKeys.length=n)}}},display:(()=>{const e=new gi,t=new ui,i=new Tt(0,0,0);return function(n,r,s){this._hidden.getValue()||(n.disable(n.DEPTH_TEST),n.depthMask(!1),n.enable(n.CULL_FACE),n.frontFace(n.CCW),this.projectionMatrixArray.set(r.getViewpoint().getProjectionMatrixWithLimits(.125,2e5,s)),e.assign(this.modelMatrix),e.multRight(r.getViewMatrix().get()),e.get(null,t),e.identity(),e.rotate(t),e.scale(i.set(1e5,1e5,1e5)),this.modelViewMatrixArray.set(e),this.drawSphere(r),+this.textureBits&&this.drawCube(r),n.depthMask(!0),n.enable(n.DEPTH_TEST),n.disable(n.BLEND))}})(),drawSphere(e){const t=g.clamp(this._transparency.getValue(),0,1);if(1===t)return;const i=this.getBrowser(),n=i.getContext(),r=i.getDefaultMaterial().getShader(t?this.sphereAlphaContext:this.sphereContext);r.enable(n),r.setClipPlanes(n,this.clipPlanes),n.uniformMatrix4fv(r.x3d_ProjectionMatrix,!1,this.projectionMatrixArray),n.uniformMatrix4fv(r.x3d_ModelViewMatrix,!1,this.modelViewMatrixArray),n.uniform3f(r.x3d_EmissiveColor,1,1,1),n.uniform1f(r.x3d_Transparency,t),n.uniform1i(r.x3d_TextureCoordinateGeneratorMode[0],0),this.sphereArrayObject.enable(r.getProgram())&&(r.enableColorAttribute(n,this.colorBuffer,0,0),r.enableVertexAttribute(n,this.sphereBuffer,0,0)),t?n.enable(n.BLEND):n.disable(n.BLEND),n.drawArrays(n.TRIANGLES,0,this.sphereCount)},drawCube:(()=>{const e=new Float32Array(gi.Identity);return function(t){const i=this.getBrowser(),n=i.getContext(),r=this.texturesContext;for(const s of this.textureBits){const o=this.textureNodes[s];r.alphaMode=o._transparent.getValue()?Dl.BLEND:Dl.OPAQUE,r.textureNode=o;const a=i.getDefaultMaterial().getShader(r);a.enable(n),a.setClipPlanes(n,this.clipPlanes),n.uniformMatrix4fv(a.x3d_ProjectionMatrix,!1,this.projectionMatrixArray),n.uniformMatrix4fv(a.x3d_ModelViewMatrix,!1,this.modelViewMatrixArray),n.uniformMatrix4fv(a.x3d_TextureMatrix[0],!1,e),n.uniform3f(a.x3d_EmissiveColor,1,1,1),n.uniform1f(a.x3d_Transparency,0),n.uniform1i(a.x3d_TextureCoordinateGeneratorMode[0],0),this.drawRectangle(n,i,a,t,o,this.textureBuffers[s],this.textureArrayObjects[s])}}})(),drawRectangle(e,t,i,n,r,s,o){r.setShaderUniforms(e,i,n),o.enable(i.getProgram())&&(i.enableTexCoordAttribute(e,this.texCoordBuffers,0,0),i.enableVertexAttribute(e,s,0,0)),r._transparent.getValue()?e.enable(e.BLEND):e.disable(e.BLEND),e.drawArrays(e.TRIANGLES,0,6),t.resetTextureUnits()}}),Object.defineProperties(Ll,{typeName:{value:"X3DBackgroundNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"EnvironmentalEffects",level:1}),enumerable:!0}});for(let e=0;e<6;++e)Ll.prototype[`set_loadState${e}__`]=function(e,t){this.set_loadState__(e,t)};const Bl=Ll;i.add("X3DBackgroundNode","x_ite/Components/EnvironmentalEffects/X3DBackgroundNode",Bl);const Ul=Bl;function Xl(e){Sr.call(this,e),this.addType(d.X3DAppearanceChildNode)}Object.setPrototypeOf(Xl.prototype,Sr.prototype),Object.defineProperties(Xl,{typeName:{value:"X3DAppearanceChildNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Shape",level:1}),enumerable:!0}});const jl=Xl;i.add("X3DAppearanceChildNode","x_ite/Components/Shape/X3DAppearanceChildNode",jl);const kl=jl;function zl(e){kl.call(this,e),this.addType(d.X3DTextureNode),this.addChildObjects(d.outputOnly,"transparent",new $n.SFBool)}Object.assign(Object.setPrototypeOf(zl.prototype,kl.prototype),{setTransparent(e){e!==this._transparent.getValue()&&(this._transparent=e)},isTransparent(){return this._transparent.getValue()}}),Object.defineProperties(zl,{typeName:{value:"X3DTextureNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Texturing",level:1}),enumerable:!0}});const Gl=zl;i.add("X3DTextureNode","x_ite/Components/Texturing/X3DTextureNode",Gl);const Hl=Gl;const ql=function(e,t,i=!0){try{if(t&&(t instanceof $n.SFNode&&(t=t.getValue()),t&&(i&&(t=t.getInnerNode()),t.getType().includes(e))))return t}catch{}return null};i.add("X3DCast","x_ite/Base/X3DCast",ql);const Yl=ql;function Wl(e){Hl.call(this,e),this.addType(d.X3DSingleTextureNode),this.addChildObjects(d.outputOnly,"linear",new $n.SFBool),this.matrix=new Float32Array(gi.Identity)}Object.assign(Object.setPrototypeOf(Wl.prototype,Hl.prototype),{initialize(){Hl.prototype.initialize.call(this),this._textureProperties.addInterest("set_textureProperties__",this,!0);const e=this.getBrowser().getContext();this.texture=e.createTexture(),this.set_textureProperties__(!1)},getCount:()=>1,getTextureTypeString(){switch(this.getTextureType()){case 1:case 2:return"2D";case 3:return"3D";case 4:return"CUBE"}},getTexture(){return this.texture},setTexture(e){this.getBrowser().getContext().deleteTexture(this.texture),this.texture=e,this.addNodeEvent()},isLinear(){return this._linear.getValue()},setLinear(e){e!==this._linear.getValue()&&(this._linear=e)},getMatrix(){return this.matrix},isImageTransparent(e){const t=e.length;for(let i=3;i<t;i+=4)if(255!==e[i])return!0;return!1},set_textureProperties__(e){this.texturePropertiesNode&&this.texturePropertiesNode.removeInterest("updateTextureParameters",this),this.texturePropertiesNode=Yl(d.TextureProperties,this._textureProperties)??this.getBrowser().getDefaultTextureProperties(),this.texturePropertiesNode.addInterest("updateTextureParameters",this),e&&this.updateTextureParameters()},updateTextureParameters:(()=>{const e=["EXT_texture_filter_anisotropic","MOZ_EXT_texture_filter_anisotropic","WEBKIT_EXT_texture_filter_anisotropic"];return function(t,i,n,r,s,o,a,l){const u=this.getBrowser().getContext();u.bindTexture(t,this.getTexture()),!i&&Math.max(r,s)<this.getBrowser().getMinTextureSize()?(u.texParameteri(t,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(t,u.TEXTURE_MAG_FILTER,u.NEAREST)):!this.isLinear()||i?(this.isLinear()||n._generateMipMaps.getValue()&&u.generateMipmap(t),u.texParameteri(t,u.TEXTURE_MIN_FILTER,u[n.getMinificationFilter()]),u.texParameteri(t,u.TEXTURE_MAG_FILTER,u[n.getMagnificationFilter()])):(u.texParameteri(t,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(t,u.TEXTURE_MAG_FILTER,u.LINEAR)),i?(u.texParameteri(t,u.TEXTURE_WRAP_S,u[n.getBoundaryModeS()]),u.texParameteri(t,u.TEXTURE_WRAP_T,u[n.getBoundaryModeT()]),u.getVersion()>=2&&u.texParameteri(t,u.TEXTURE_WRAP_R,u[n.getBoundaryModeR()])):(u.texParameteri(t,u.TEXTURE_WRAP_S,o?u.REPEAT:u.CLAMP_TO_EDGE),u.texParameteri(t,u.TEXTURE_WRAP_T,a?u.REPEAT:u.CLAMP_TO_EDGE),u.getVersion()>=2&&u.texParameteri(t,u.TEXTURE_WRAP_R,l?u.REPEAT:u.CLAMP_TO_EDGE));for(const i of e){const e=u.getExtension(i);if(e){u.texParameterf(t,e.TEXTURE_MAX_ANISOTROPY_EXT,n._anisotropicDegree.getValue());break}}}})(),getTextureBits(){return this.isLinear()<<3|this.getTextureType()},updateTextureBits(e,t=0){e.add(4*t,this.getTextureBits())},getShaderOptions(e,t=0){e.push(`X3D_TEXTURE${t}_${this.getTextureTypeString()}`),1===this.getTextureType()&&e.push(`X3D_TEXTURE${t}_FLIP_Y`),this.isLinear()&&e.push(`X3D_TEXTURE${t}_LINEAR`)}}),Object.defineProperties(Wl,{typeName:{value:"X3DSingleTextureNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Texturing",level:1}),enumerable:!0}});const $l=Wl;i.add("X3DSingleTextureNode","x_ite/Components/Texturing/X3DSingleTextureNode",$l);const Jl=$l,Kl=new Uint8Array([255,255,255,255]);function Zl(e){Jl.call(this,e),this.addType(d.X3DTexture2DNode);const t=this.getBrowser().getContext();this.target=t.TEXTURE_2D,this.width=0,this.height=0}Object.assign(Object.setPrototypeOf(Zl.prototype,Jl.prototype),{initialize(){Jl.prototype.initialize.call(this),this._repeatS.addInterest("updateTextureParameters",this),this._repeatT.addInterest("updateTextureParameters",this);const e=this.getBrowser().getContext();e.bindTexture(e.TEXTURE_2D,this.getTexture()),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,Kl)},getTarget(){return this.target},getWidth(){return this.width},setWidth(e){this.width=e},getHeight(){return this.height},setHeight(e){this.height=e},clearTexture(){this.setTextureFromData(1,1,!1,!1,Kl)},setTextureFromData(e,t,i,n,r){this.width=e,this.height=t;const s=this.getBrowser().getContext();s.bindTexture(s.TEXTURE_2D,this.getTexture()),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,i?s.BROWSER_DEFAULT_WEBGL:s.NONE),1===s.getVersion()&&this.getType().includes(d.MovieTexture)?s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,r):s.texImage2D(s.TEXTURE_2D,0,s.RGBA,e,t,0,s.RGBA,s.UNSIGNED_BYTE,r),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,s.BROWSER_DEFAULT_WEBGL),this.setTransparent(n),this.updateTextureParameters(),this.addNodeEvent()},updateTextureFromData(e){const t=this.getBrowser().getContext();t.bindTexture(t.TEXTURE_2D,this.getTexture()),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,e),this.texturePropertiesNode._generateMipMaps.getValue()&&t.generateMipmap(t.TEXTURE_2D),this.addNodeEvent()},updateTextureParameters(){Jl.prototype.updateTextureParameters.call(this,this.target,this._textureProperties.getValue(),this.texturePropertiesNode,this.width,this.height,this._repeatS.getValue(),this._repeatT.getValue(),!1)},setShaderUniforms(e,t,i,n=t.x3d_Texture[0]){const r=this.getBrowser().getTexture2DUnit();e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_2D,this.getTexture()),e.uniform1i(n.texture2D,r)}}),Object.defineProperties(Zl,{typeName:{value:"X3DTexture2DNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Texturing",level:1}),enumerable:!0}});const Ql=Zl;i.add("X3DTexture2DNode","x_ite/Components/Texturing/X3DTexture2DNode",Ql);const eu=Ql;var tu=n(328);function iu(e){eu.call(this,e),Ts.call(this,e),this.addType(d.ImageTexture),this.image=tu("<img></img>"),this.urlStack=new $n.MFString,this.getMatrix().set([1,0,0,0,0,-1,0,0,0,0,1,0,0,1,0,1])}Object.assign(Object.setPrototypeOf(iu.prototype,eu.prototype),Ts.prototype,{initialize(){eu.prototype.initialize.call(this),Ts.prototype.initialize.call(this),this._colorSpaceConversion.addInterest("loadNow",this),this.image.on("load",this.setImage.bind(this)),this.image.on("abort error",this.setError.bind(this)),this.image.prop("crossOrigin","Anonymous"),this.requestImmediateLoad().catch(Function.prototype)},getTextureType:()=>1,unloadData(){this.clearTexture()},loadData(){this.urlStack.setValue(this._url),this.loadNext()},loadNext(){if(0===this.urlStack.length)return this.clearTexture(),void this.setLoadState(d.FAILED_STATE);this.URL=new URL(this.urlStack.shift(),this.getExecutionContext().getBaseURL()),this.URL.pathname.match(/\.ktx2?(?:\.gz)?$/)||this.URL.href.match(/^data:image\/ktx2[;,]/)?(this.setLinear(!0),this.getBrowser().getKTXDecoder().then((e=>e.loadKTXFromURL(this.URL,this.getCache()))).then((e=>this.setKTXTexture(e))).catch((e=>this.setError({type:e.message})))):(this.setLinear(!1),"data:"!==this.URL.protocol&&(this.getCache()||this.URL.searchParams.set("_",Date.now())),this.image.attr("src",this.URL.href))},setError(e){"data:"!==this.URL.protocol&&console.warn(`Error loading image '${decodeURI(this.URL.href)}'`,e.type),this.loadNext()},async setKTXTexture(e){if(e.target!==this.getTarget())return this.setError({type:"Invalid KTX texture target, must be 'TEXTURE_2D'."});try{this.setTexture(e),this.setTransparent(!1),this.setWidth(e.baseWidth),this.setHeight(e.baseHeight),this.updateTextureParameters(),this.setLoadState(d.COMPLETE_STATE)}catch(e){this.setError({type:e.message})}},async setImage(){try{const e=this.getBrowser().getContext(),t=this.image[0];if(1===e.getVersion()){const e=document.createElement("canvas"),i=e.getContext("2d",{willReadFrequently:!0});let n=t.width,r=t.height;g.isPowerOfTwo(n)&&g.isPowerOfTwo(r)||(n=g.nextPowerOfTwo(n),r=g.nextPowerOfTwo(r)),e.width=n,e.height=r,i.clearRect(0,0,n,r),i.drawImage(t,0,0,t.width,t.height,0,0,n,r);const s=i.getImageData(0,0,n,r).data,o=this.isImageTransparent(s);this.setTextureFromData(n,r,!1,o,s),this.setLoadState(d.COMPLETE_STATE)}else{const{width:e,height:i}=t;this.setTextureFromData(e,i,this._colorSpaceConversion.getValue(),this.isTransparent(),t),this.setTransparent(this.isImageTransparent(await this.getTextureData(this.getTexture(),e,i))),this.setLoadState(d.COMPLETE_STATE),this.addNodeEvent()}}catch(e){this.setError({type:e.message})}},async getTextureData(e,t,i){const n=this.getBrowser().getContext(),r=n.createFramebuffer(),s=new Uint8Array(t*i*4);return n.bindFramebuffer(n.FRAMEBUFFER,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0),await n.readPixelsAsync(0,0,t,i,n.RGBA,n.UNSIGNED_BYTE,s),n.deleteFramebuffer(r),s},dispose(){Ts.prototype.dispose.call(this),eu.prototype.dispose.call(this)}}),Object.defineProperties(iu,{typeName:{value:"ImageTexture",enumerable:!0},componentInfo:{value:Object.freeze({name:"Texturing",level:1}),enumerable:!0},containerField:{value:"texture",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"load",new $n.SFBool(!0)),new k(d.inputOutput,"url",new $n.MFString),new k(d.inputOutput,"autoRefresh",new $n.SFTime),new k(d.inputOutput,"autoRefreshTimeLimit",new $n.SFTime(3600)),new k(d.initializeOnly,"colorSpaceConversion",new $n.SFBool(!0)),new k(d.initializeOnly,"repeatS",new $n.SFBool(!0)),new k(d.initializeOnly,"repeatT",new $n.SFBool(!0)),new k(d.initializeOnly,"textureProperties",new $n.SFNode)]),enumerable:!0}});const nu=iu;i.add("ImageTexture","x_ite/Components/Texturing/ImageTexture",nu);const ru=nu;function su(e){Ul.call(this,e),this.addType(d.Background)}Object.assign(Object.setPrototypeOf(su.prototype,Ul.prototype),{initialize(){Ul.prototype.initialize.call(this);const e=new ru(this.getExecutionContext()),t=new ru(this.getExecutionContext()),i=new ru(this.getExecutionContext()),n=new ru(this.getExecutionContext()),r=new ru(this.getExecutionContext()),s=new ru(this.getExecutionContext()),o=this.getBrowser().getBackgroundTextureProperties();this._frontUrl.addFieldInterest(e._url),this._backUrl.addFieldInterest(t._url),this._leftUrl.addFieldInterest(i._url),this._rightUrl.addFieldInterest(n._url),this._topUrl.addFieldInterest(r._url),this._bottomUrl.addFieldInterest(s._url),e._url=this._frontUrl,t._url=this._backUrl,i._url=this._leftUrl,n._url=this._rightUrl,r._url=this._topUrl,s._url=this._bottomUrl,e._textureProperties=o,t._textureProperties=o,i._textureProperties=o,n._textureProperties=o,r._textureProperties=o,s._textureProperties=o,e.setup(),t.setup(),i.setup(),n.setup(),r.setup(),s.setup(),this.set_texture__(0,e),this.set_texture__(1,t),this.set_texture__(2,i),this.set_texture__(3,n),this.set_texture__(4,r),this.set_texture__(5,s)}}),Object.defineProperties(su,{typeName:{value:"Background",enumerable:!0},componentInfo:{value:Object.freeze({name:"EnvironmentalEffects",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_bind",new $n.SFBool),new k(d.inputOutput,"frontUrl",new $n.MFString),new k(d.inputOutput,"backUrl",new $n.MFString),new k(d.inputOutput,"leftUrl",new $n.MFString),new k(d.inputOutput,"rightUrl",new $n.MFString),new k(d.inputOutput,"topUrl",new $n.MFString),new k(d.inputOutput,"bottomUrl",new $n.MFString),new k(d.inputOutput,"skyAngle",new $n.MFFloat),new k(d.inputOutput,"skyColor",new $n.MFColor(new Fe(0,0,0))),new k(d.inputOutput,"groundAngle",new $n.MFFloat),new k(d.inputOutput,"groundColor",new $n.MFColor),new k(d.inputOutput,"transparency",new $n.SFFloat),new k(d.outputOnly,"isBound",new $n.SFBool),new k(d.outputOnly,"bindTime",new $n.SFTime)]),enumerable:!0}});const ou=su;i.add("Background","x_ite/Components/EnvironmentalEffects/Background",ou);const au=ou;function lu(e,t,i){Sr.call(this,e),Qa.call(this,e),this.addType(d.X3DLayerNode),this.addChildObjects(d.inputOutput,"hidden",new $n.SFBool,d.outputOnly,"display",new $n.SFBool(!0)),e.getSpecificationVersion()<=3.3&&this.addAlias("isPickable",this._pickable),this.groupNode=i,this.viewportNode=null,this.defaultNavigationInfo=new ul(e),this.defaultViewpoint=t,this.defaultBackground=new au(e),this.defaultFog=new yl(e),this.navigationInfoStack=new il(e,this.defaultNavigationInfo),this.viewpointStack=new il(e,this.defaultViewpoint),this.backgroundStack=new il(e,this.defaultBackground),this.fogStack=new il(e,this.defaultFog),this.navigationInfos=new sl(e,this.defaultNavigationInfo),this.viewpoints=new sl(e,this.defaultViewpoint),this.backgrounds=new sl(e,this.defaultBackground),this.fogs=new sl(e,this.defaultFog),this.defaultBackground.setHidden(!0),this.defaultFog.setHidden(!0)}Object.assign(Object.setPrototypeOf(lu.prototype,Sr.prototype),Qa.prototype,{layer0:!1,initialize(){Sr.prototype.initialize.call(this),Qa.prototype.initialize.call(this),this.defaultNavigationInfo.setup(),this.defaultViewpoint.setup(),this.defaultBackground.setup(),this.defaultFog.setup(),this.navigationInfoStack.setup(),this.viewpointStack.setup(),this.backgroundStack.setup(),this.fogStack.setup(),this.navigationInfos.setup(),this.viewpoints.setup(),this.backgrounds.setup(),this.fogs.setup(),this._hidden.addInterest("set_visible_and_hidden__",this),this._visible.addInterest("set_visible_and_hidden__",this),this._viewport.addInterest("set_viewport__",this),this.set_visible_and_hidden__(),this.set_viewport__()},isHidden(){return this._hidden.getValue()},setHidden(e){e!==this._hidden.getValue()&&(this._hidden=e)},getBBox(e,t){return this.groupNode.getBBox(e,t)},setLayer0(e){this.layer0=e,this.defaultBackground.setHidden(!e)},getLayer(){return this},getGroup(){return this.groupNode},getViewport(){return this.viewportNode},getBackground(){return this.backgroundStack.top()},getFog(){return this.fogStack.top()},getNavigationInfo(){return this.navigationInfoStack.top()},getViewpoint(){return this.viewpointStack.top()},getBackgrounds(){return this.backgrounds},getFogs(){return this.fogs},getNavigationInfos(){return this.navigationInfos},getViewpoints(){return this.viewpoints},getUserViewpoints(){return this.viewpoints.get().filter((e=>e._description.length))},getBackgroundStack(){return this.backgroundStack},getFogStack(){return this.fogStack},getNavigationInfoStack(){return this.navigationInfoStack},getViewpointStack(){return this.viewpointStack},getCollisionTime(){return this.collisionTime},viewAll(e=1,t=1,i=!1){const n=this.getViewpoint(),r=this.getBBox(new Xa).multRight(n.getModelMatrix().copy().inverse());n.lookAt(this,r.center,n.getLookAtDistance(r),e,t,i)},straightenView(){this.getViewpoint().straightenView(this)},set_visible_and_hidden__(){const e=this._visible.getValue()&&!this._hidden.getValue();e!==this._display.getValue()&&(this._display=e)},set_viewport__(){this.viewportNode=Yl(d.X3DViewportNode,this._viewport),this.viewportNode||(this.viewportNode=this.getBrowser().getDefaultViewport())},bindBindables(e){this.traverse(Ma.CAMERA,this);const t=this.navigationInfos.getBound(),i=this.backgrounds.getBound(),n=this.fogs.getBound(),r=this.viewpoints.getBound(e);this.navigationInfoStack.pushOnTop(t),this.viewpointStack.pushOnTop(r),this.backgroundStack.pushOnTop(i),this.fogStack.pushOnTop(n),r.resetUserOffsets(),r._viewAll.getValue()&&r.viewAll(this.getBBox(new Xa))},traverse(e,t=this){const i=this.getViewpoint();switch(this.getProjectionMatrix().pushMatrix(i.getProjectionMatrix(this)),this.getCameraSpaceMatrix().pushMatrix(i.getCameraSpaceMatrix()),this.getViewMatrix().pushMatrix(i.getViewMatrix()),e){case Ma.POINTER:this.pointer(e,t);break;case Ma.CAMERA:this.camera(e,t);break;case Ma.PICKING:this.picking(e,t);break;case Ma.COLLISION:this.collision(e,t);break;case Ma.SHADOW:case Ma.DISPLAY:this.display(e,t)}this.getViewMatrix().pop(),this.getCameraSpaceMatrix().pop(),this.getProjectionMatrix().pop()},pointer(e,t){const i=this.getBrowser(),n=this.viewportNode.getRectangle();if(i.getPointingLayer()){if(i.getPointingLayer()!==this)return}else if(!i.isPointerInRectangle(n))return;this.setHitRay(this.getProjectionMatrix().get(),n,i.getPointer()),this.getNavigationInfo().enable(e,t),this.getModelViewMatrix().pushMatrix(this.getViewMatrix().get()),this.viewportNode.push(this),t.render(e,this.groupNode.traverse,this.groupNode),this.viewportNode.pop(this),this.getModelViewMatrix().pop()},camera(e,t){this._display.getValue()&&(this.getModelViewMatrix().pushMatrix(gi.Identity),this.viewportNode.push(this),this.groupNode.traverse(e,t),this.viewportNode.pop(this),this.getModelViewMatrix().pop(),this.navigationInfos.update(this,this.navigationInfoStack),this.viewpoints.update(this,this.viewpointStack),this.backgrounds.update(this,this.backgroundStack),this.fogs.update(this,this.fogStack),this.getViewpoint().update())},picking(e,t){this._pickable.getValue()&&(this.getModelViewMatrix().pushMatrix(gi.Identity),this.viewportNode.push(this),this.groupNode.traverse(e,t),this.viewportNode.pop(this),this.getModelViewMatrix().pop())},collision:(()=>{const e=new gi;return function(t,i){if(this._display.getValue()){const n=this.getNavigationInfo();if(n._transitionActive.getValue())return;const r=n.getCollisionRadius(),s=n.getAvatarHeight(),o=Math.max(2*r,2*s);La.ortho(-o,o,-o,o,-o,o,e),this.getProjectionMatrix().pushMatrix(e),this.getModelViewMatrix().pushMatrix(this.getViewMatrix().get()),this.viewportNode.push(this),i.render(t,this.groupNode.traverse,this.groupNode),this.viewportNode.pop(this),this.getModelViewMatrix().pop(),this.getProjectionMatrix().pop()}}})(),display(e,t){this._display.getValue()&&(this.getNavigationInfo().enable(e,t),this.getModelViewMatrix().pushMatrix(this.getViewMatrix().get()),this.viewportNode.push(this),t.render(e,this.groupNode.traverse,this.groupNode),this.viewportNode.pop(this),this.getModelViewMatrix().pop())}}),Object.defineProperties(lu,{typeName:{value:"X3DLayerNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Layering",level:1}),enumerable:!0}});const uu=lu;i.add("X3DLayerNode","x_ite/Components/Layering/X3DLayerNode",uu);const hu=uu;function du(e){Yr.call(this,e),this.addType(d.X3DSensorNode)}Object.setPrototypeOf(du.prototype,Yr.prototype),Object.defineProperties(du,{typeName:{value:"X3DSensorNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Core",level:1}),enumerable:!0}});const cu=du;i.add("X3DSensorNode","x_ite/Components/Core/X3DSensorNode",cu);const pu=cu;function gu(e){this.addType(d.X3DTimeDependentNode),this.addChildObjects(d.outputOnly,"initialized",new $n.SFTime,d.inputOutput,"isEvenLive",new $n.SFBool),this.startTimeValue=0,this.pauseTimeValue=0,this.resumeTimeValue=0,this.stopTimeValue=0,this.start=0,this.pause=0,this.pauseInterval=0,this.timeouts=new Map,this.disabled=!1}Object.assign(Object.setPrototypeOf(gu.prototype,Yr.prototype),{initialize(){this.getLive().addInterest("set_live__",this),this._isEvenLive.addInterest("set_live__",this),this._initialized.addInterest("set_loop__",this),this._enabled.addInterest("set_enabled__",this),this._loop.addInterest("set_loop__",this),this._startTime.addInterest("set_startTime__",this),this._pauseTime.addInterest("set_pauseTime__",this),this._resumeTime.addInterest("set_resumeTime__",this),this._stopTime.addInterest("set_stopTime__",this),this.startTimeValue=this._startTime.getValue(),this.pauseTimeValue=this._pauseTime.getValue(),this.resumeTimeValue=this._resumeTime.getValue(),this.stopTimeValue=this._stopTime.getValue(),this._initialized=this.getBrowser().getCurrentTime()},getLiveState(){return this.isLive()&&(this.getExecutionContext().getLive().getValue()||this._isEvenLive.getValue())},getElapsedTime(){return this.getBrowser().getCurrentTime()-this.start-this.pauseInterval},resetElapsedTime(){this.start=this.getBrowser().getCurrentTime(),this.pause=this.getBrowser().getCurrentTime(),this.pauseInterval=0},set_live__(){this.getLive().getValue()||this._isEvenLive.getValue()?this.disabled&&(this.disabled=!1,this._isActive.getValue()&&!this._isPaused.getValue()&&this.real_resume()):this.disabled||!this._isActive.getValue()||this._isPaused.getValue()||(this.disabled=!0,this.real_pause())},set_enabled__(){this._enabled.getValue()?this.set_loop__():this.stop()},set_loop__(){this._enabled.getValue()&&this._loop.getValue()&&this.stopTimeValue<=this.startTimeValue&&this.startTimeValue<=this.getBrowser().getCurrentTime()&&this.do_start(),this.set_loop()},set_startTime__(){this.startTimeValue=this._startTime.getValue(),this._enabled.getValue()&&(this.removeTimeout("start"),this.startTimeValue<=this.getBrowser().getCurrentTime()?this.do_start():this.addTimeout("start","do_start",this.startTimeValue))},set_pauseTime__(){if(this.pauseTimeValue=this._pauseTime.getValue(),this._enabled.getValue()){if(this.removeTimeout("pause"),this.pauseTimeValue<=this.resumeTimeValue)return;this.pauseTimeValue<=this.getBrowser().getCurrentTime()?this.do_pause():this.addTimeout("pause","do_pause",this.pauseTimeValue)}},set_resumeTime__(){if(this.resumeTimeValue=this._resumeTime.getValue(),this._enabled.getValue()){if(this.removeTimeout("resume"),this.resumeTimeValue<=this.pauseTimeValue)return;this.resumeTimeValue<=this.getBrowser().getCurrentTime()?this.do_resume():this.addTimeout("resume","do_resume",this.resumeTimeValue)}},set_stopTime__(){if(this.stopTimeValue=this._stopTime.getValue(),this._enabled.getValue()){if(this.removeTimeout("stop"),this.stopTimeValue<=this.startTimeValue)return;this.stopTimeValue<=this.getBrowser().getCurrentTime()?this.do_stop():this.addTimeout("stop","do_stop",this.stopTimeValue)}},do_start(){this._isActive.getValue()||(this.resetElapsedTime(),this._isActive=!0,this._elapsedTime=0,this.set_start(),this.getLive().getValue()?this.getBrowser().timeEvents().addInterest("set_time",this):(this.disabled=!0,this.real_pause()))},do_pause(){this._isActive.getValue()&&!this._isPaused.getValue()&&(this._isPaused=!0,this.pauseTimeValue!==this.getBrowser().getCurrentTime()&&(this.pauseTimeValue=this.getBrowser().getCurrentTime()),this.getLive().getValue()&&this.real_pause())},real_pause(){this.pause=Date.now()/1e3,this.set_pause(),this.getBrowser().timeEvents().removeInterest("set_time",this)},do_resume(){this._isActive.getValue()&&this._isPaused.getValue()&&(this._isPaused=!1,this.resumeTimeValue!==this.getBrowser().getCurrentTime()&&(this.resumeTimeValue=this.getBrowser().getCurrentTime()),this.getLive().getValue()&&this.real_resume())},real_resume(){const e=Date.now()/1e3-this.pause;this.pauseInterval+=e,this.set_resume(e),this.getBrowser().timeEvents().addInterest("set_time",this),this.getBrowser().addBrowserEvent()},do_stop(){this.stop()},stop(){this._isActive.getValue()&&(this.set_stop(),this._elapsedTime=this.getElapsedTime(),this._isPaused.getValue()&&(this._isPaused=!1),this._isActive=!1,this.getBrowser().timeEvents().removeInterest("set_time",this))},addTimeout(e,t,i){this.removeTimeout(e),this.timeouts.set(e,setTimeout(this.processTimeout.bind(this,t),1e3*(i-this.getBrowser().getCurrentTime())))},removeTimeout(e){clearTimeout(this.timeouts.get(e)),this.timeouts.delete(e)},processTimeout(e){this._enabled.getValue()&&(this.getLive().getValue()||this._isEvenLive.getValue())&&(this.getBrowser().advanceTime(),this[e]())},set_loop:Function.prototype,set_start:Function.prototype,set_pause:Function.prototype,set_resume:Function.prototype,set_stop:Function.prototype,set_time:Function.prototype,dispose(){for(const e of[...this.timeouts.keys()])this.removeTimeout(e)}}),Object.defineProperties(gu,{typeName:{value:"X3DTimeDependentNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Time",level:1}),enumerable:!0}});const fu=gu;i.add("X3DTimeDependentNode","x_ite/Components/Time/X3DTimeDependentNode",fu);const mu=fu;function _u(e){pu.call(this,e),mu.call(this,e),this.addType(d.TimeSensor),this.addChildObjects(d.inputOutput,"range",new $n.MFFloat(0,0,1)),this.cycle=0,this.interval=0,this.fraction=0,this.first=0,this.last=1,this.scale=1}Object.assign(Object.setPrototypeOf(_u.prototype,pu.prototype),mu.prototype,{initialize(){pu.prototype.initialize.call(this),mu.prototype.initialize.call(this),this._cycleInterval.addInterest("set_cycleInterval__",this),this._range.addInterest("set_range__",this)},setRange(e,t,i,n){const r=this.getBrowser().getCurrentTime(),s=this._startTime.getValue(),o=this._cycleInterval.getValue();this.first=g.clamp(t,0,1),this.last=g.clamp(i,0,1),this.scale=this.last-this.first,this.interval=o*this.scale,this.offset=n&&this.interval?(r-s)/this.interval:0,this.fraction=g.fract(e+this.offset),this.cycle=r-(this.fraction-this.first)*o},set_cycleInterval__(){this._isActive.getValue()&&this.setRange(this.fraction,this._range[1],this._range[2],!1)},set_range__(){this._isActive.getValue()&&(this.setRange(this._range[0],this._range[1],this._range[2],!1),this._isPaused.getValue()||this.set_fraction(this.getBrowser().getCurrentTime()))},set_start(){this.setRange(this._range[0],this._range[1],this._range[2],!0);const e=this.getBrowser().getCurrentTime();this._cycleTime=e,this._fraction_changed=this.fraction,this._time=e},set_resume(e){this.setRange(this.fraction,this._range[1],this._range[2],!1)},set_fraction(e){this._fraction_changed=this.fraction=this.first+(this.interval?g.fract((e-this.cycle)/this.interval):0)*this.scale},set_time(){const e=this.getBrowser().getCurrentTime();e-this.cycle>=this.interval?this._loop.getValue()?this.interval&&(this.cycle+=this.interval*Math.floor((e-this.cycle)/this.interval),this._elapsedTime=this.getElapsedTime(),this._cycleTime=e,this.set_fraction(e)):(this._fraction_changed=this.fraction=this.last,this.stop()):(this._elapsedTime=this.getElapsedTime(),this.set_fraction(e)),this._time=e},dispose(){mu.prototype.dispose.call(this),pu.prototype.dispose.call(this)}}),Object.defineProperties(_u,{typeName:{value:"TimeSensor",enumerable:!0},componentInfo:{value:Object.freeze({name:"Time",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"cycleInterval",new $n.SFTime(1)),new k(d.inputOutput,"loop",new $n.SFBool),new k(d.inputOutput,"startTime",new $n.SFTime),new k(d.inputOutput,"resumeTime",new $n.SFTime),new k(d.inputOutput,"pauseTime",new $n.SFTime),new k(d.inputOutput,"stopTime",new $n.SFTime),new k(d.outputOnly,"isPaused",new $n.SFBool),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"cycleTime",new $n.SFTime),new k(d.outputOnly,"elapsedTime",new $n.SFTime),new k(d.outputOnly,"fraction_changed",new $n.SFFloat),new k(d.outputOnly,"time",new $n.SFTime)]),enumerable:!0}});const xu=_u;i.add("TimeSensor","x_ite/Components/Time/TimeSensor",xu);const yu=xu;function wu(e){Yr.call(this,e),this.addType(d.X3DInterpolatorNode)}Object.assign(Object.setPrototypeOf(wu.prototype,Yr.prototype),{setup(){this.set_key__(),this._key.length&&this.interpolate(0,0,0),Yr.prototype.setup.call(this)},initialize(){Yr.prototype.initialize.call(this),this._set_fraction.addInterest("set_fraction__",this),this._key.addInterest("set_key__",this)},set_fraction__(){const e=this._key,t=e.length,i=this._set_fraction.getValue();switch(t){case 0:return;case 1:return this.interpolate(0,0,0);default:{if(i<=e[0])return this.interpolate(0,1,0);const n=g.upperBound(e,0,t,i);if(n!==t){const t=n-1,r=(i-e[t])/(e[n]-e[t]);this.interpolate(t,n,g.clamp(r,0,1))}else this.interpolate(t-2,t-1,1)}}},set_key__(){this.set_keyValue__()},set_keyValue__(){},interpolate(){}}),Object.defineProperties(wu,{typeName:{value:"X3DInterpolatorNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Interpolation",level:1}),enumerable:!0}});const bu=wu;i.add("X3DInterpolatorNode","x_ite/Components/Interpolation/X3DInterpolatorNode",bu);const Su=bu;function Tu(e){Su.call(this,e),this.addType(d.EaseInEaseOut)}Object.assign(Object.setPrototypeOf(Tu.prototype,Su.prototype),{initialize(){Su.prototype.initialize.call(this),this._easeInEaseOut.addInterest("set_keyValue__",this)},set_keyValue__(){this._easeInEaseOut.length<this._key.length&&this._easeInEaseOut.resize(this._key.length,this._easeInEaseOut.length?this._easeInEaseOut[this._easeInEaseOut.length-1]:new $n.SFVec2f)},interpolate(e,t,i){let n=this._easeInEaseOut[e].y,r=this._easeInEaseOut[t].x;const s=n+r;if(s<0)this._modifiedFraction_changed=i;else{s>1&&(r/=s,n/=s);const e=1/(2-n-r);if(i<n)this._modifiedFraction_changed=e/n*i*i;else if(i<=1-r)this._modifiedFraction_changed=e*(2*i-n);else{const t=1-i;this._modifiedFraction_changed=1-e*t*t/r}}}}),Object.defineProperties(Tu,{typeName:{value:"EaseInEaseOut",enumerable:!0},componentInfo:{value:Object.freeze({name:"Interpolation",level:4}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.2",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_fraction",new $n.SFFloat),new k(d.inputOutput,"key",new $n.MFFloat),new k(d.inputOutput,"easeInEaseOut",new $n.MFVec2f),new k(d.outputOnly,"modifiedFraction_changed",new $n.SFFloat)]),enumerable:!0}});const vu=Tu;i.add("EaseInEaseOut","x_ite/Components/Interpolation/EaseInEaseOut",vu);const Ou=vu;function Eu(e){Su.call(this,e),this.addType(d.PositionInterpolator)}Object.assign(Object.setPrototypeOf(Eu.prototype,Su.prototype),{initialize(){Su.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__(){const e=this._key,t=this._keyValue;t.length<e.length&&t.resize(e.length,t.length?t[t.length-1]:new $n.SFVec3f)},interpolate:(()=>{const e=new Tt(0,0,0);return function(t,i,n){this._value_changed=e.assign(this._keyValue[t].getValue()).lerp(this._keyValue[i].getValue(),n)}})()}),Object.defineProperties(Eu,{typeName:{value:"PositionInterpolator",enumerable:!0},componentInfo:{value:Object.freeze({name:"Interpolation",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_fraction",new $n.SFFloat),new k(d.inputOutput,"key",new $n.MFFloat),new k(d.inputOutput,"keyValue",new $n.MFVec3f),new k(d.outputOnly,"value_changed",new $n.SFVec3f)]),enumerable:!0}});const Cu=Eu;i.add("PositionInterpolator","x_ite/Components/Interpolation/PositionInterpolator",Cu);const Nu=Cu;function Iu(e){Su.call(this,e),this.addType(d.OrientationInterpolator),this._keyValue.setUnit("angle"),this._value_changed.setUnit("angle")}Object.assign(Object.setPrototypeOf(Iu.prototype,Su.prototype),{initialize(){Su.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__(){const e=this._key,t=this._keyValue;t.length<e.length&&t.resize(e.length,t.length?t[t.length-1]:new $n.SFRotation)},interpolate:(()=>{const e=new ui,t=new ui;return function(i,n,r){e.assign(this._keyValue[i].getValue()),t.assign(this._keyValue[n].getValue()),this._value_changed=e.slerp(t,r)}})()}),Object.defineProperties(Iu,{typeName:{value:"OrientationInterpolator",enumerable:!0},componentInfo:{value:Object.freeze({name:"Interpolation",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_fraction",new $n.SFFloat),new k(d.inputOutput,"key",new $n.MFFloat),new k(d.inputOutput,"keyValue",new $n.MFRotation),new k(d.outputOnly,"value_changed",new $n.SFRotation)]),enumerable:!0}});const Fu=Iu;i.add("OrientationInterpolator","x_ite/Components/Interpolation/OrientationInterpolator",Fu);const Mu=Fu;function Du(e){Su.call(this,e),this.addType(d.ScalarInterpolator)}Object.assign(Object.setPrototypeOf(Du.prototype,Su.prototype),{initialize(){Su.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__(){const e=this._key,t=this._keyValue;t.length<e.length&&t.resize(e.length,t.length?t[t.length-1]:0)},interpolate(e,t,i){this._value_changed=g.lerp(this._keyValue[e],this._keyValue[t],i)}}),Object.defineProperties(Du,{typeName:{value:"ScalarInterpolator",enumerable:!0},componentInfo:{value:Object.freeze({name:"Interpolation",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_fraction",new $n.SFFloat),new k(d.inputOutput,"key",new $n.MFFloat),new k(d.inputOutput,"keyValue",new $n.MFFloat),new k(d.outputOnly,"value_changed",new $n.SFFloat)]),enumerable:!0}});const Ru=Du;i.add("ScalarInterpolator","x_ite/Components/Interpolation/ScalarInterpolator",Ru);const Pu=Ru;function Au(e){ns.call(this,e),this.addType(d.X3DViewpointNode),this.addChildObjects(d.inputOutput,"positionOffset",new $n.SFVec3f,d.inputOutput,"orientationOffset",new $n.SFRotation,d.inputOutput,"scaleOffset",new $n.SFVec3f(1,1,1),d.inputOutput,"scaleOrientationOffset",new $n.SFRotation,d.inputOutput,"centerOfRotationOffset",new $n.SFVec3f,d.inputOutput,"fieldOfViewScale",new $n.SFFloat(1)),this.descriptions=[],this.userPosition=new Tt(0,1,0),this.userOrientation=new ui,this.userCenterOfRotation=new Tt(0,0,0),this.modelMatrix=new gi,this.cameraSpaceMatrix=new gi(1,0,0,0,0,1,0,0,0,0,1,0,0,0,10,1),this.viewMatrix=new gi(1,0,0,0,0,1,0,0,0,0,1,0,0,0,-10,1);const t=this.getBrowser();this.timeSensor=new yu(t.getPrivateScene()),this.easeInEaseOut=new Ou(t.getPrivateScene()),this.positionInterpolator=new Nu(t.getPrivateScene()),this.orientationInterpolator=new Mu(t.getPrivateScene()),this.scaleInterpolator=new Nu(t.getPrivateScene()),this.scaleOrientationInterpolator=new Mu(t.getPrivateScene()),this.fieldOfViewScaleInterpolator=new Pu(t.getPrivateScene())}Object.assign(Object.setPrototypeOf(Au.prototype,ns.prototype),{initialize(){ns.prototype.initialize.call(this),this.timeSensor._stopTime=1,this.timeSensor.setup(),this.easeInEaseOut._key=new $n.MFFloat(0,1),this.easeInEaseOut._easeInEaseOut=new $n.MFVec2f(new $n.SFVec2f(0,0),new $n.SFVec2f(0,0)),this.easeInEaseOut.setup(),this.positionInterpolator._key=new $n.MFFloat(0,1),this.orientationInterpolator._key=new $n.MFFloat(0,1),this.scaleInterpolator._key=new $n.MFFloat(0,1),this.scaleOrientationInterpolator._key=new $n.MFFloat(0,1),this.fieldOfViewScaleInterpolator._key=new $n.MFFloat(0,1),this.positionInterpolator.setup(),this.orientationInterpolator.setup(),this.scaleInterpolator.setup(),this.scaleOrientationInterpolator.setup(),this.fieldOfViewScaleInterpolator.setup(),this.timeSensor._fraction_changed.addFieldInterest(this.easeInEaseOut._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.positionInterpolator._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.orientationInterpolator._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.scaleInterpolator._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.scaleOrientationInterpolator._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.fieldOfViewScaleInterpolator._set_fraction),this.positionInterpolator._value_changed.addFieldInterest(this._positionOffset),this.orientationInterpolator._value_changed.addFieldInterest(this._orientationOffset),this.scaleInterpolator._value_changed.addFieldInterest(this._scaleOffset),this.scaleOrientationInterpolator._value_changed.addFieldInterest(this._scaleOrientationOffset),this.fieldOfViewScaleInterpolator._value_changed.addFieldInterest(this._fieldOfViewScale),this._nearDistance.addInterest("set_nearDistance__",this),this._farDistance.addInterest("set_farDistance__",this),this._viewAll.addInterest("set_viewAll__",this),this._navigationInfo.addInterest("set_navigationInfo__",this),this._isBound.addInterest("set_bound__",this),this.set_nearDistance__(),this.set_farDistance__(),this.set_navigationInfo__()},set_nearDistance__(){const e=this._nearDistance.getValue();this.nearDistance=e>=0?e:void 0},set_farDistance__(){const e=this._farDistance.getValue();this.farDistance=e>=0?e:void 0},set_viewAll__(){this._viewAll.getValue()&&this._isBound.getValue()&&(this._set_bind=!0)},set_navigationInfo__(){this.navigationInfoNode&&this._isBound.removeFieldInterest(this.navigationInfoNode._set_bind),this.navigationInfoNode=Yl(d.NavigationInfo,this._navigationInfo),this.navigationInfoNode&&this._isBound.addFieldInterest(this.navigationInfoNode._set_bind)},set_bound__(){const e=this.getBrowser();this._isBound.getValue()?e.getNotification()._string=this._description:this.timeSensor._stopTime=e.getCurrentTime()},set_active__(e,t){t.getValue()||(this.timeSensor._isActive.removeInterest("set_active__",this),this._isBound.getValue()&&1===this.timeSensor._fraction_changed.getValue()&&(e._transitionComplete=!0))},getDescriptions(){return this.descriptions},setInterpolators(){},getPosition(){return this._position.getValue()},getUserPosition(){return this.userPosition.assign(this.getPosition()).add(this._positionOffset.getValue())},getOrientation(){return this._orientation.getValue()},getUserOrientation(){return this.userOrientation.assign(this.getOrientation()).multRight(this._orientationOffset.getValue())},getCenterOfRotation(){return this._centerOfRotation.getValue()},getUserCenterOfRotation(){return this.userCenterOfRotation.assign(this.getCenterOfRotation()).add(this._centerOfRotationOffset.getValue())},getProjectionMatrix(e){const t=e.getNavigationInfo();return this.getProjectionMatrixWithLimits(this.nearDistance??t.getNearValue(),this.farDistance??t.getFarValue(this),e.getLayer().getViewport().getRectangle())},getCameraSpaceMatrix(){return this.cameraSpaceMatrix},getViewMatrix(){return this.viewMatrix},getModelMatrix(){return this.modelMatrix},getMaxFarValue(){return this.getBrowser().getRenderingProperty("LogarithmicDepthBuffer")?1e10:1e5},getUpVector:()=>Tt.yAxis,getSpeedFactor:()=>1,setVRMLTransition(e){this.VRMLTransition=e},getVRMLTransition(){return this.VRMLTransition},transitionStart(e,t){if(this._jump.getValue()){const i=this.getRelativeTransformation(t);this._retainUserOffsets.getValue()||this.resetUserOffsets(),this._viewAll.getValue()&&this.viewAll(e.getBBox(new Xa));const n=e.getNavigationInfo(),r=n._transitionTime.getValue();let s=n.getTransitionType();switch(2==this.getExecutionContext().getSpecificationVersion()&&(s=this.getVRMLTransition()?"LINEAR":"TELEPORT"),this.setVRMLTransition(!1),r<=0&&(s="TELEPORT"),this.constructor!==t.constructor&&(s="TELEPORT"),s){case"TELEPORT":return void(n._transitionComplete=!0);case"ANIMATE":this.easeInEaseOut._easeInEaseOut=new $n.MFVec2f(new $n.SFVec2f(0,1),new $n.SFVec2f(1,0));break;default:this.easeInEaseOut._easeInEaseOut=new $n.MFVec2f(new $n.SFVec2f(0,0),new $n.SFVec2f(0,0))}n._transitionStart=!0,this.timeSensor._cycleInterval=r,this.timeSensor._stopTime=this.getBrowser().getCurrentTime(),this.timeSensor._startTime=this.getBrowser().getCurrentTime(),this.timeSensor._isActive.addInterest("set_active__",this,n),this.positionInterpolator._keyValue=new $n.MFVec3f(i.position,this._positionOffset),this.orientationInterpolator._keyValue=new $n.MFRotation(i.orientation,this._orientationOffset),this.scaleInterpolator._keyValue=new $n.MFVec3f(i.scale,this._scaleOffset),this.scaleOrientationInterpolator._keyValue=new $n.MFRotation(i.scaleOrientation,this._scaleOrientationOffset),this._positionOffset=i.position,this._orientationOffset=i.orientation,this._scaleOffset=i.scale,this._scaleOrientationOffset=i.scaleOrientation,this.setInterpolators(t,i)}else{e.getNavigationInfo()._transitionComplete=!0;const i=this.getRelativeTransformation(t);this._positionOffset=i.position,this._orientationOffset=i.orientation,this._scaleOffset=i.scale,this._scaleOrientationOffset=i.scaleOrientation,this.setInterpolators(t,i)}},transitionStop(){this.timeSensor._stopTime=this.getBrowser().getCurrentTime(),this.timeSensor._isActive.removeInterest("set_active__",this)},resetUserOffsets(){this._positionOffset=Tt.Zero,this._orientationOffset=ui.Identity,this._scaleOffset=Tt.One,this._scaleOrientationOffset=ui.Identity,this._centerOfRotationOffset=Tt.Zero,this._fieldOfViewScale=1,this.set_nearDistance__(),this.set_farDistance__()},getRelativeTransformation:(()=>{const e=new Tt(0,0,0),t=new ui,i=new Tt(0,0,0),n=new ui;return function(r){return this.modelMatrix.copy().multRight(r.getViewMatrix()).inverse().get(e,t,i,n),e.subtract(this.getPosition()),t.multLeft(this.getOrientation().copy().inverse()),{position:e,orientation:t,scale:i,scaleOrientation:n}}})(),getLookAtRotation:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0),i=new Tt(0,0,0),n=new At,r=new ui;return function(s,o){const a=this.getUpVector(!0);return i.assign(s).subtract(o).normalize(),e.assign(a).cross(i).normalize(),t.assign(i).cross(e).normalize(),n.set(...e,...t,...i),r.setMatrix(n),r}})(),lookAtPoint(e,t,i=1,n=1,r=!1){this.getCameraSpaceMatrix().multVecMatrix(t),this.getModelMatrix().copy().inverse().multVecMatrix(t);const s=2*e.getNavigationInfo().getNearValue();this.lookAt(e,t,s,1,1,!1)},lookAtBBox(e,t,i=1,n,r){t=t.copy().multRight(this.getModelMatrix().copy().inverse()),this.lookAt(e,t.center,this.getLookAtDistance(t),i,n,r)},lookAt(e,t,i,n=1,r=1,s=!1){const o=t.copy().add(this.getUserOrientation().multVecRot(new Tt(0,0,i))).subtract(this.getPosition());e.getNavigationInfo()._transitionStart=!0,this.timeSensor._cycleInterval=n,this.timeSensor._stopTime=this.getBrowser().getCurrentTime(),this.timeSensor._startTime=this.getBrowser().getCurrentTime(),this.timeSensor._isActive.addInterest("set_active__",this,e.getNavigationInfo()),this.easeInEaseOut._easeInEaseOut=new $n.MFVec2f(new $n.SFVec2f(0,1),new $n.SFVec2f(1,0));const a=this._positionOffset.getValue().copy().lerp(o,r),l=this.getPosition().copy().add(a).subtract(t);let u=this._orientationOffset.getValue().copy().multRight(new ui(this.getUserOrientation().multVecRot(new Tt(0,0,1)),l));s&&(u=this.getOrientation().copy().inverse().multRight(this.straightenHorizon(this.getOrientation().copy().multRight(u)))),this.positionInterpolator._keyValue=new $n.MFVec3f(this._positionOffset,a),this.orientationInterpolator._keyValue=new $n.MFRotation(this._orientationOffset,u),this.scaleInterpolator._keyValue=new $n.MFVec3f(this._scaleOffset,Tt.One),this.scaleOrientationInterpolator._keyValue=new $n.MFRotation(this._scaleOrientationOffset,this._scaleOrientationOffset);const h=this.getRelativeTransformation(this);this._fieldOfViewScale=1,this._centerOfRotationOffset=t.copy().subtract(this.getCenterOfRotation()),this.nearDistance=.0125*i,this.farDistance=this.nearDistance*this.getMaxFarValue()/.125,this.setInterpolators(this,h)},straightenView(e){e.getNavigationInfo()._transitionStart=!0,this.timeSensor._cycleInterval=1,this.timeSensor._stopTime=this.getBrowser().getCurrentTime(),this.timeSensor._startTime=this.getBrowser().getCurrentTime(),this.timeSensor._isActive.addInterest("set_active__",this,e.getNavigationInfo()),this.easeInEaseOut._easeInEaseOut=new $n.MFVec2f(new $n.SFVec2f(0,1),new $n.SFVec2f(1,0));const t=this.getOrientation().copy().inverse().multRight(this.straightenHorizon(this.getUserOrientation()));this.positionInterpolator._keyValue=new $n.MFVec3f(this._positionOffset,this._positionOffset),this.orientationInterpolator._keyValue=new $n.MFRotation(this._orientationOffset,t),this.scaleInterpolator._keyValue=new $n.MFVec3f(this._scaleOffset,this._scaleOffset),this.scaleOrientationInterpolator._keyValue=new $n.MFRotation(this._scaleOrientationOffset,this._scaleOrientationOffset);const i=this.getRelativeTransformation(this);this._fieldOfViewScale=1,this.setInterpolators(this,i)},straightenHorizon:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0),i=new ui;return function(n,r=this.getUpVector(!0)){n.multVecRot(e.assign(Tt.xAxis).negate()),n.multVecRot(t.assign(Tt.zAxis));const s=t.cross(r);return Math.abs(t.dot(r))>=1||Math.abs(s.dot(e))>=1?n:(i.setFromToVec(e,s),n.multRight(i))}})(),viewAll(e){e.copy().multRight(this.modelMatrix.copy().inverse());const t=this.getUserPosition().copy().subtract(e.center).normalize(),i=this.getLookAtDistance(e),n=e.center.copy().add(t.multiply(i)),r=this.getLookAtRotation(n,e.center);this._positionOffset=n.subtract(this.getPosition()),this._orientationOffset=this.getOrientation().copy().inverse().multRight(r),this._centerOfRotationOffset=e.center.copy().subtract(this.getCenterOfRotation()),this._fieldOfViewScale=1,this.nearDistance=.0125*i,this.farDistance=this.nearDistance*this.getMaxFarValue()/.125},traverse(e,t){if(e===Ma.CAMERA){if(this.navigationInfoNode&&this.navigationInfoNode.traverse(e,t),this.descriptions.length=0,this._description.getValue()&&t.getViewpointGroups().every((e=>e._displayed.getValue()))){for(const e of t.getViewpointGroups())e._description.getValue()&&this.descriptions.push(e._description.getValue());this.descriptions.push(this._description.getValue())}t.getLayer().getViewpoints().push(this),this.modelMatrix.assign(t.getModelViewMatrix().get())}},update(){this.cameraSpaceMatrix.set(this.getUserPosition(),this.getUserOrientation(),this._scaleOffset.getValue(),this._scaleOrientationOffset.getValue()),this.cameraSpaceMatrix.multRight(this.modelMatrix),this.viewMatrix.assign(this.cameraSpaceMatrix).inverse()}}),Object.defineProperties(Au,{typeName:{value:"X3DViewpointNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Navigation",level:1}),enumerable:!0}});const Vu=Au;i.add("X3DViewpointNode","x_ite/Components/Navigation/X3DViewpointNode",Vu);const Lu=Vu;function Bu(e){Lu.call(this,e),this.addType(d.Viewpoint),this._position.setUnit("length"),this._centerOfRotation.setUnit("length"),this._fieldOfView.setUnit("angle"),this.projectionMatrix=new gi}Object.assign(Object.setPrototypeOf(Bu.prototype,Lu.prototype),{getRelativeTransformation(e){const t=Lu.prototype.getRelativeTransformation.call(this,e);return e.constructor===this.constructor&&(t.fieldOfView=e.getFieldOfView()),t},setInterpolators(e,t){if(e.constructor===this.constructor){const e=t.fieldOfView/this.getFieldOfView();this.fieldOfViewScaleInterpolator._keyValue=new $n.MFFloat(e,this._fieldOfViewScale.getValue()),this._fieldOfViewScale=e}else this.fieldOfViewScaleInterpolator._keyValue=new $n.MFFloat(this._fieldOfViewScale.getValue(),this._fieldOfViewScale.getValue()),this._fieldOfViewScale=this._fieldOfViewScale.getValue()},getLogarithmicDepthBuffer:()=>!1,getFieldOfView(){const e=this._fieldOfView.getValue()*this._fieldOfViewScale.getValue();return e>0&&e<Math.PI?e:Math.PI/4},getScreenScale(e,t,i){const n=t[2],r=t[3];let s=Math.abs(e.z)*Math.tan(this.getFieldOfView()/2)*2;return s/=n>r?r:n,i.set(s,s,s)},getViewportSize:(()=>{const e=new _t(0,0);return function(t,i){const n=t[2],r=t[3],s=i*Math.tan(this.getFieldOfView()/2)*2,o=n/r;return o>1?e.set(s*o,s):e.set(s,s/o)}})(),getLookAtDistance(e){return e.size.magnitude()/2/Math.tan(this.getFieldOfView()/2)},getProjectionMatrixWithLimits(e,t,i){return La.perspective(this.getFieldOfView(),e,t,i[2],i[3],this.projectionMatrix)}}),Object.defineProperties(Bu,{typeName:{value:"Viewpoint",enumerable:!0},componentInfo:{value:Object.freeze({name:"Navigation",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_bind",new $n.SFBool),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"position",new $n.SFVec3f(0,0,10)),new k(d.inputOutput,"orientation",new $n.SFRotation),new k(d.inputOutput,"centerOfRotation",new $n.SFVec3f),new k(d.inputOutput,"fieldOfView",new $n.SFFloat(.785398)),new k(d.inputOutput,"nearDistance",new $n.SFFloat(-1)),new k(d.inputOutput,"farDistance",new $n.SFFloat(-1)),new k(d.inputOutput,"viewAll",new $n.SFBool),new k(d.inputOutput,"jump",new $n.SFBool(!0)),new k(d.inputOutput,"retainUserOffsets",new $n.SFBool),new k(d.outputOnly,"isBound",new $n.SFBool),new k(d.outputOnly,"bindTime",new $n.SFTime),new k(d.inputOutput,"navigationInfo",new $n.SFNode)]),enumerable:!0}});const Uu=Bu;i.add("Viewpoint","x_ite/Components/Navigation/Viewpoint",Uu);const Xu=Uu;function ju(e){this.addType(d.X3DBoundedObject),this.addChildObjects(d.inputOutput,"hidden",new $n.SFBool,d.outputOnly,"display",new $n.SFBool(!0),d.outputOnly,"transformSensors_changed",new $n.SFTime),this._bboxSize.setUnit("length"),this._bboxCenter.setUnit("length"),this.childBBox=new Xa,this.transformSensorNodes=new Set}Object.assign(ju.prototype,{initialize(){this._hidden.addInterest("set_visible_and_hidden__",this),this._visible.addInterest("set_visible_and_hidden__",this),this.set_visible_and_hidden__()},isHidden(){return this._hidden.getValue()},setHidden(e){e!==this._hidden.getValue()&&(this._hidden=e)},getDefaultBBoxSize:(()=>{const e=new Tt(-1,-1,-1);return function(){return e}})(),getBBox(e,t,i){const n=this.childBBox;t.set();for(const r of e)r.getBBox&&t.add(r.getBBox(n,i));return t},displayBBox:(()=>{const e=new Xa,t=new gi;return function(i,n){const r=n.getModelViewMatrix();this.getBBox(e),t.set(e.center,null,e.size),r.push(),r.multLeft(t),this.getBrowser().getBBoxNode().traverse(i,n),r.pop()}})(),addTransformSensor(e){this.transformSensorNodes.add(e),this._transformSensors_changed=this.getBrowser().getCurrentTime()},removeTransformSensor(e){this.transformSensorNodes.delete(e),this._transformSensors_changed=this.getBrowser().getCurrentTime()},getTransformSensors(){return this.transformSensorNodes},set_visible_and_hidden__(){const e=this._visible.getValue()&&!this._hidden.getValue();e!==this._display.getValue()&&(this._display=e)},dispose(){}}),Object.defineProperties(ju,{typeName:{value:"X3DBoundedObject",enumerable:!0},componentInfo:{value:Object.freeze({name:"Grouping",level:1}),enumerable:!0}});const ku=ju;i.add("X3DBoundedObject","x_ite/Components/Grouping/X3DBoundedObject",ku);const zu=ku;function Gu(e){Yr.call(this,e),zu.call(this,e),this.addType(d.X3DGroupingNode),this.allowedTypes=new Set,this.clipPlaneNodes=[],this.localFogNodes=[],this.lightNodes=[],this.pointingDeviceSensorNodes=[],this.maybeCameraObjects=[],this.cameraObjects=[],this.maybePickableSensorNodes=[],this.pickableSensorNodes=[],this.pickableObjects=[],this.childNodes=[],this.displayNodes=[],this.visibleNodes=[],this.boundedObjects=[],this.sensors=[]}function Hu(e,t){const i=new Set(t);return e.filter((e=>!i.has(e)))}Object.assign(Object.setPrototypeOf(Gu.prototype,Yr.prototype),zu.prototype,{initialize(){Yr.prototype.initialize.call(this),zu.prototype.initialize.call(this),this._transformSensors_changed.addInterest("set_transformSensors__",this),this._addChildren.addInterest("set_addChildren__",this),this._removeChildren.addInterest("set_removeChildren__",this),this._children.addInterest("set_children__",this),this.set_children__()},getBBox(e,t){return this.getSubBBox(e,t)},getSubBBox(e,t){return this._bboxSize.getValue().equals(this.getDefaultBBoxSize())?zu.prototype.getBBox.call(this,this.visibleNodes,e,t):e.set(this._bboxSize.getValue(),this._bboxCenter.getValue())},setAllowedTypes(){const e=this.allowedTypes;e.clear();for(const t of arguments)e.add(t)},set_addChildren__(){0!==this._addChildren.length&&(this._addChildren.setTainted(!0),this._addChildren.assign(Hu(this._addChildren,this._children)),this._children.isTainted()||(this._children.removeInterest("set_children__",this),this._children.addInterest("connectChildren",this)),this._children.splice(this._children.length,0,...this._addChildren),this.add(this._addChildren),this._addChildren.length=0,this._addChildren.setTainted(!1))},set_removeChildren__(){0!==this._removeChildren.length&&(this._removeChildren.setTainted(!0),this._children.length>0&&(this._children.isTainted()||(this._children.removeInterest("set_children__",this),this._children.addInterest("connectChildren",this)),this._children.assign(Hu(this._children,this._removeChildren)),this.remove(this._removeChildren)),this._removeChildren.length=0,this._removeChildren.setTainted(!1))},set_children__(){this.clear(),this.add(this._children)},connectChildren(){this._children.removeInterest("connectChildren",this),this._children.addInterest("set_children__",this)},clear(){for(const e of this.maybePickableSensorNodes)e._isPickableObject.removeInterest("set_pickableObjects__",this);for(const e of this.childNodes)e._isCameraObject.removeInterest("set_cameraObjects__",this),e._isPickableObject.removeInterest("set_pickableObjects__",this),Yl(d.X3DBoundedObject,e)&&(e._display.removeInterest("set_displays_",this),e._bboxDisplay.removeInterest("set_bboxDisplays__",this));this.clipPlaneNodes.length=0,this.localFogNodes.length=0,this.lightNodes.length=0,this.pointingDeviceSensorNodes.length=0,this.maybeCameraObjects.length=0,this.maybePickableSensorNodes.length=0,this.childNodes.length=0},add(e){for(const t of e){const e=Yl(d.X3DChildNode,t);if(!e)continue;const i=e.getType();for(let t=i.length-1;t>=0;--t){switch(i[t]){case d.X3DPointingDeviceSensorNode:this.pointingDeviceSensorNodes.push(e);break;case d.ClipPlane:this.clipPlaneNodes.push(e);break;case d.LocalFog:this.localFogNodes.push(e);break;case d.X3DLightNode:this.lightNodes.push(e);break;case d.X3DBindableNode:this.maybeCameraObjects.push(e);break;case d.TransformSensor:case d.X3DPickSensorNode:e._isPickableObject.addInterest("set_pickableObjects__",this),this.maybePickableSensorNodes.push(e);break;case d.Sound:case d.SpatialSound:case d.X3DBackgroundNode:case d.X3DChildNode:e._isCameraObject.addInterest("set_cameraObjects__",this),e._isPickableObject.addInterest("set_pickableObjects__",this),Yl(d.X3DBoundedObject,e)&&(e._display.addInterest("set_displays_",this),e._bboxDisplay.addInterest("set_bboxDisplays__",this)),this.maybeCameraObjects.push(e),this.childNodes.push(e);break;case d.BooleanFilter:case d.BooleanToggle:case d.CollisionCollection:case d.HAnimMotion:case d.NurbsOrientationInterpolator:case d.NurbsPositionInterpolator:case d.NurbsSurfaceInterpolator:case d.RigidBodyCollection:case d.TimeSensor:case d.X3DFollowerNode:case d.X3DInfoNode:case d.X3DInterpolatorNode:case d.X3DKeyDeviceSensorNode:case d.X3DLayoutNode:case d.X3DScriptNode:case d.X3DSequencerNode:case d.X3DSoundNode:case d.X3DTriggerNode:break;default:continue}break}e.getMustDisplay()&&(this.childNodes.includes(e)||this.childNodes.push(e))}this.set_pickableObjects__(),this.set_displayNodes__(),this.set_displays_(),this.set_bboxDisplays__()},remove(e){for(const i of e){const e=Yl(d.X3DChildNode,i);if(!e)continue;if(e.getMustDisplay()){const t=this.childNodes.indexOf(e);t>=0&&this.childNodes.splice(t,1)}const n=e.getType();for(let i=n.length-1;i>=0;--i){switch(n[i]){case d.X3DPointingDeviceSensorNode:{const t=this.pointingDeviceSensorNodes.indexOf(e);t>=0&&this.pointingDeviceSensorNodes.splice(t,1);break}case d.ClipPlane:{const t=this.clipPlaneNodes.indexOf(e);t>=0&&this.clipPlaneNodes.splice(t,1);break}case d.LocalFog:{const t=this.localFogNodes.indexOf(e);t>=0&&this.localFogNodes.splice(t,1);break}case d.X3DLightNode:{const t=this.lightNodes.indexOf(e);t>=0&&this.lightNodes.splice(t,1);break}case d.X3DBindableNode:{const t=this.maybeCameraObjects.indexOf(e);t>=0&&this.maybeCameraObjects.splice(t,1);break}case d.TransformSensor:case d.X3DPickSensorNode:{e._isPickableObject.removeInterest("set_pickableObjects__",this);const t=this.maybePickableSensorNodes.indexOf(e);t>=0&&this.maybePickableSensorNodes.splice(t,1);break}case d.Sound:case d.SpatialSound:case d.X3DBackgroundNode:case d.X3DChildNode:var t;e._isCameraObject.removeInterest("set_cameraObjects__",this),e._isPickableObject.removeInterest("set_pickableObjects__",this),Yl(d.X3DBoundedObject,e)&&(e._display.removeInterest("set_displays_",this),e._bboxDisplay.removeInterest("set_bboxDisplays__",this)),(t=this.maybeCameraObjects.indexOf(e))>=0&&this.maybeCameraObjects.splice(t,1),(t=this.childNodes.indexOf(e))>=0&&this.childNodes.splice(t,1);break;case d.BooleanFilter:case d.BooleanToggle:case d.CollisionCollection:case d.HAnimMotion:case d.NurbsOrientationInterpolator:case d.NurbsPositionInterpolator:case d.NurbsSurfaceInterpolator:case d.RigidBodyCollection:case d.TimeSensor:case d.X3DFollowerNode:case d.X3DInfoNode:case d.X3DInterpolatorNode:case d.X3DKeyDeviceSensorNode:case d.X3DLayoutNode:case d.X3DScriptNode:case d.X3DSequencerNode:case d.X3DSoundNode:case d.X3DTriggerNode:break;default:continue}break}}this.set_displayNodes__(),this.set_displays_(),this.set_bboxDisplays__()},set_cameraObjects__(){const e=this.cameraObjects;e.length=0;for(const t of this.maybeCameraObjects)t.isCameraObject()&&(Yl(d.X3DBoundedObject,t)?t._display.getValue()&&e.push(t):e.push(t));this.setCameraObject(!!e.length)},set_pickableObjects__(){const e=this.pickableSensorNodes,t=this.pickableObjects;e.length=0,t.length=0;for(const t of this.maybePickableSensorNodes)t.isPickableObject()&&e.push(t);for(const e of this.visibleNodes)e.isPickableObject()&&t.push(e);this.set_transformSensors__()},set_transformSensors__(){this.setPickableObject(!!(this.getTransformSensors().size||this.pickableSensorNodes.length||this.pickableObjects.length))},set_displayNodes__(){const e=this.displayNodes;e.length=0;for(const t of this.clipPlaneNodes)e.push(t);for(const t of this.localFogNodes)e.push(t);for(const t of this.lightNodes)e.push(t)},set_displays_(){const e=this.visibleNodes;e.length=0;for(const t of this.childNodes)Yl(d.X3DBoundedObject,t)?t._display.getValue()&&e.push(t):e.push(t);this.set_cameraObjects__(),this.set_pickableObjects__()},set_bboxDisplays__(){const e=this.boundedObjects;e.length=0;for(const t of this.childNodes)Yl(d.X3DBoundedObject,t)&&t._bboxDisplay.getValue()&&e.push(t)},traverse(e,t){switch(e){case Ma.POINTER:{const i=this.pointingDeviceSensorNodes,n=this.clipPlaneNodes,r=this.sensors;if(r.length=0,i.length){for(const e of i)e.push(t,r);r.length&&t.getSensors().push(r)}for(const e of n)e.push(t);for(const i of this.visibleNodes)i.traverse(e,t);for(const e of n)e.pop(t);return void(r.length&&t.getSensors().pop())}case Ma.CAMERA:for(const i of this.cameraObjects)i.traverse(e,t);return;case Ma.PICKING:{if(this.getTransformSensors().size){const e=t.getModelViewMatrix().get();for(const t of this.getTransformSensors())t.collect(e)}for(const i of this.pickableSensorNodes)i.traverse(e,t);const i=this.getBrowser(),n=i.getPickingHierarchy();if(n.push(this),i.getPickable().at(-1))for(const i of this.visibleNodes)i.traverse(e,t);else for(const i of this.pickableObjects)i.traverse(e,t);return void n.pop()}case Ma.COLLISION:{const i=this.clipPlaneNodes;for(const e of i)e.push(t);for(const i of this.visibleNodes)i.traverse(e,t);for(const e of i)e.pop(t);return}case Ma.SHADOW:{const i=this.clipPlaneNodes;for(const e of i)e.push(t);for(const i of this.visibleNodes)i.traverse(e,t);for(const e of i)e.push(t);return}case Ma.DISPLAY:{const i=this.displayNodes;for(const e of i)e.push(t,this);for(const i of this.visibleNodes)i.traverse(e,t);for(const i of this.boundedObjects)i.displayBBox(e,t);for(const e of i)e.pop(t);return}}},dispose(){zu.prototype.dispose.call(this),Yr.prototype.dispose.call(this)}}),Object.defineProperties(Gu,{typeName:{value:"X3DGroupingNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Grouping",level:1}),enumerable:!0}});const qu=Gu;i.add("X3DGroupingNode","x_ite/Components/Grouping/X3DGroupingNode",qu);const Yu=qu;function Wu(e){Yu.call(this,e),this.addType(d.Group)}Object.setPrototypeOf(Wu.prototype,Yu.prototype),Object.defineProperties(Wu,{typeName:{value:"Group",enumerable:!0},componentInfo:{value:Object.freeze({name:"Grouping",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"visible",new $n.SFBool(!0)),new k(d.inputOutput,"bboxDisplay",new $n.SFBool),new k(d.initializeOnly,"bboxSize",new $n.SFVec3f(-1,-1,-1)),new k(d.initializeOnly,"bboxCenter",new $n.SFVec3f),new k(d.inputOnly,"addChildren",new $n.MFNode),new k(d.inputOnly,"removeChildren",new $n.MFNode),new k(d.inputOutput,"children",new $n.MFNode)]),enumerable:!0}});const $u=Wu;i.add("Group","x_ite/Components/Grouping/Group",$u);const Ju=$u;function Ku(e){hu.call(this,e,new Xu(e),new Ju(e)),this.addType(d.Layer)}Object.assign(Object.setPrototypeOf(Ku.prototype,hu.prototype),{initialize(){hu.prototype.initialize.call(this),this._addChildren.addFieldInterest(this.getGroup()._addChildren),this._removeChildren.addFieldInterest(this.getGroup()._removeChildren),this._children.addFieldInterest(this.getGroup()._children),this.getGroup()._children=this._children,this.getGroup().setPrivate(!0),this.getGroup().setup()}}),Object.defineProperties(Ku,{typeName:{value:"Layer",enumerable:!0},componentInfo:{value:Object.freeze({name:"Layering",level:1}),enumerable:!0},containerField:{value:"layers",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.2",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"pickable",new $n.SFBool(!0)),new k(d.inputOutput,"objectType",new $n.MFString("ALL")),new k(d.inputOutput,"visible",new $n.SFBool(!0)),new k(d.inputOutput,"viewport",new $n.SFNode),new k(d.inputOnly,"addChildren",new $n.MFNode),new k(d.inputOnly,"removeChildren",new $n.MFNode),new k(d.inputOutput,"children",new $n.MFNode)]),enumerable:!0}});const Zu=Ku;i.add("Layer","x_ite/Components/Layering/Layer",Zu);const Qu=Zu;function eh(e){Sr.call(this,e),this.addType(d.LayerSet),this.layerNodes=[new Qu(e)],this.layerNode0=this.layerNodes[0],this.activeLayerNode=null}Object.assign(Object.setPrototypeOf(eh.prototype,Sr.prototype),{initialize(){Sr.prototype.initialize.call(this),this.layerNode0.setPrivate(!0),this.layerNode0.setup(),this.layerNode0.setLayer0(!0),this._activeLayer.addInterest("set_activeLayer__",this),this._order.addInterest("set_layers__",this),this._layers.addInterest("set_layers__",this),this.set_layers__()},getActiveLayer(){return this.activeLayerNode},setLayer0(e){this.layerNode0=e,this.set_layers__()},getLayer0(){return this.layerNode0},getLayers(){return this.layerNodes},set_activeLayer__(){if(0===this._activeLayer.getValue())this.activeLayerNode!==this.layerNode0&&(this.activeLayerNode=this.layerNode0);else{const e=this._activeLayer-1;e>=0&&e<this._layers.length?this.activeLayerNode!==this._layers[e].getValue()&&(this.activeLayerNode=Yl(d.X3DLayerNode,this._layers[e])):null!==this.activeLayerNode&&(this.activeLayerNode=null)}},set_layers__(){const e=this._layers.getValue();this.layerNodes.length=0;for(let t of this._order)if(0===t)this.layerNodes.push(this.layerNode0);else if(--t,t>=0&&t<e.length){const i=Yl(d.X3DLayerNode,e[t]);i&&this.layerNodes.push(i)}this.set_activeLayer__()},bindBindables(e){const t=this._layers.getValue();this.layerNode0.bindBindables(e);for(let i=0,n=t.length;i<n;++i){const n=Yl(d.X3DLayerNode,t[i]);n&&n.bindBindables(e)}},traverse(e,t){for(const i of this.layerNodes)i.traverse(e,t)}}),Object.defineProperties(eh,{typeName:{value:"LayerSet",enumerable:!0},componentInfo:{value:Object.freeze({name:"Layering",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.2",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"activeLayer",new $n.SFInt32),new k(d.inputOutput,"order",new $n.MFInt32(0)),new k(d.inputOutput,"layers",new $n.MFNode)]),enumerable:!0}});const th=eh;i.add("LayerSet","x_ite/Components/Layering/LayerSet",th);const ih=th;function nh(e){pr.call(this,e),this.addType(d.X3DWorld),this.addChildObjects(d.outputOnly,"activeLayer",new Ci(this.layer0)),this.defaultLayerSet=new ih(e),this.layerSet=this.defaultLayerSet,this.layer0=new Qu(e)}Object.assign(Object.setPrototypeOf(nh.prototype,pr.prototype),{initialize(){pr.prototype.initialize.call(this),this.layerSet.setPrivate(!0),this.layerSet.setup(),this.layerSet.setLayer0(this.layer0),this.layerSet._activeLayer.addInterest("set_rootNodes__",this),this.getExecutionContext().getRootNodes().addInterest("set_rootNodes__",this),this.set_rootNodes__(),this.layer0.setPrivate(!0),this.layer0.setLayer0(!0),this.layer0.setup(),this.set_activeLayer__()},getCache(){return this.getBrowser().getBrowserOption("Cache")},getLayerSet(){return this.layerSet},getActiveLayer(){return this._activeLayer.getValue()},set_rootNodes__(){const e=this.layerSet,t=this.getExecutionContext().getRootNodes();this.layerSet=this.defaultLayerSet,this.layer0._children=t;for(const e of t){const t=Yl(d.LayerSet,e);t&&(this.layerSet=t)}this.layerSet!==e&&(this.layerSet.setLayer0(this.layer0),e._activeLayer.removeInterest("set_activeLayer__",this),this.layerSet._activeLayer.addInterest("set_activeLayer__",this),this.set_activeLayer__())},set_activeLayer__(){this._activeLayer=this.layerSet.getActiveLayer()},bindBindables(){const e=this.getExecutionContext().getWorldURL();this.layerSet.bindBindables(decodeURIComponent(new URL(e).hash.substring(1)))},traverse(e,t){this.layerSet.traverse(e,t)}});for(const e of Object.keys(nh.prototype))Object.defineProperty(nh.prototype,e,{enumerable:!1});Object.defineProperties(nh,{typeName:{value:"X3DWorld",enumerable:!0}}),d.addNode(nh);const rh=nh;i.add("X3DWorld","x_ite/Execution/X3DWorld",rh);const sh=rh;var oh=n(328);const ah=new Set(["text/html","application/xhtml+xml"]);function lh(e){I.call(this),this.node=e,this.browser=e.getBrowser(),this.external=this.browser.isExternal(),this.executionContext=this.external?e.getExecutionContext():this.browser.currentScene,this.target="",this.url=[],this.URL=new URL(this.getBaseURL()),this.controller=new AbortController}Object.assign(Object.setPrototypeOf(lh.prototype,I.prototype),{abort(){this.url.length=0,this.controller.abort()},getURL(){return this.URL},getBaseURL(){return this.node instanceof sh&&this.external?this.browser.getBaseURL():this.executionContext.getBaseURL()},getTarget(e){for(const t of e){const e=t.split("=");if(2===e.length&&"target"===e[0])return e[1]}return""},createX3DFromString(e,t="",i,n){try{const r=this.browser.createScene();return this.node instanceof sh?r.loader=this:r.setExecutionContext(this.executionContext),r.setWorldURL(new URL(e,this.getBaseURL()).href),i&&(i=this.setScene.bind(this,r,i,n)),new sa(r).parseIntoScene(t,i,n),r}catch(e){if(!n)throw e;n(e)}},setScene(e,t,i){e._initLoadCount.addInterest("set_initLoadCount__",this,e,t,i),e._initLoadCount.addEvent()},set_initLoadCount__(e,t,i,n){n.getValue()||(e._initLoadCount.removeInterest("set_initLoadCount__",this),delete e.loader,setTimeout((()=>{try{t(e)}catch(e){if(!i)throw e;i(e)}})))},createX3DFromURL(e,t,i,n,r){return this.bindViewpoint=n,this.foreign=r,this.target=this.getTarget(t||new $n.MFString),this.loadDocument(e,this.createX3DFromURLAsync.bind(this,i))},createX3DFromURLAsync(e,t){null===t?e(null):this.createX3DFromString(this.URL,t,e,this.loadDocumentError.bind(this))},loadDocument(e,t){if(this.url=e.copy(),this.callback=t,0===e.length)return this.loadDocumentError(new Error("No URL given."));this.loadDocumentAsync(this.url.shift()).catch(this.loadDocumentError.bind(this))},loadDocumentAsync:async function(e){if(0===e.length)return void this.loadDocumentError(new Error("URL is empty."));{const t=e.match(/^\s*(?:vrmlscript|javascript|ecmascript)\:(.*)$/s);if(t)return void this.callback(t[1])}this.URL=new URL(e,this.getBaseURL());{const t=e.match(/^data:(.*?)(?:;charset=(.*?))?(?:;(base64))?,/s);if(t&&"base64"!==t[3]){let i=e.substring(t[0].length);return i=unescape(i),i=i.replace(/^Ã¯Â»Â¿/,""),void this.callback(i)}}if("data:"!==this.URL.protocol&&this.bindViewpoint){const e=new URL(this.getBaseURL());if(this.URL.protocol===e.protocol&&this.URL.hostname===e.hostname&&this.URL.port===e.port&&this.URL.pathname===e.pathname&&this.URL.hash)return void this.bindViewpoint(decodeURIComponent(this.URL.hash.substr(1)))}if(this.foreign){if(this.target.length&&"_self"!==this.target)return this.foreign(this.URL.href,this.target);if("data:"!==this.URL.protocol&&this.URL.href.match(/\.(?:html|htm|xhtml)$/))return this.foreign(this.URL.href,this.target)}const t={cache:this.node.getCache()?"default":"reload",signal:this.controller.signal},i=this.checkResponse(await fetch(this.URL,t)),n=i.headers.get("content-type")?.replace(/;.*$/,"");if(this.foreign&&ah.has(n))return this.foreign(this.URL.href,this.target);await this.callback(oh.ungzip(await i.arrayBuffer()),this.URL)},checkResponse(e){if(e.ok)return e;throw Error(e.statusText||e.status)},loadDocumentError(e){this.printError(e),this.url.length?this.loadDocumentAsync(this.url.shift()).catch(this.loadDocumentError.bind(this)):this.callback(null)},printError(e){"data:"===this.URL.protocol?console.error("Couldn't load data URL.",e):console.error(`Couldn't load URL '${decodeURI(this.URL.href)}'.`,e)}});for(const e of Object.keys(lh.prototype))Object.defineProperty(lh.prototype,e,{enumerable:!1});const uh=lh;i.add("FileLoader","x_ite/InputOutput/FileLoader",uh);const hh=uh,dh=Symbol(),ch=Symbol();function ph(e,t){Es.call(this,e),Ts.call(this,e),this.addType(d.X3DExternProtoDeclaration),this.addChildObjects(d.inputOutput,"load",new $n.SFBool(!0),d.inputOutput,"url",t.copy(),d.inputOutput,"autoRefresh",new $n.SFTime,d.inputOutput,"autoRefreshTimeLimit",new $n.SFTime(3600))}Object.assign(Object.setPrototypeOf(ph.prototype,Es.prototype),Ts.prototype,{initialize(){Es.prototype.initialize.call(this),Ts.prototype.initialize.call(this)},set_live__(){Ts.prototype.set_live__.call(this),this.checkLoadState()===d.COMPLETE_STATE&&this[ch].setLive(this.getLive().getValue())},canUserDefinedFields:()=>!0,setProtoDeclaration(e){if(this[dh]=e,e){for(const e of[...this.getUserDefinedFields()])this.removeUserDefinedField(e.getName());for(const t of e.getUserDefinedFields())this.addUserDefinedField(t.getAccessType(),t.getName(),t)}this.updateInstances()},getProtoDeclaration(){return this[dh]},loadData(){this.getScene().addInitLoadCount(this),new hh(this).createX3DFromURL(this._url,null,this.setInternalSceneAsync.bind(this))},setInternalSceneAsync(e){e?this.setInternalScene(e):this.setError(new Error("File could not be loaded.")),this.getScene().removeInitLoadCount(this)},setInternalScene(e){this[ch]=e;const t=decodeURIComponent(new URL(this[ch].getWorldURL()).hash.substring(1)),i=t?this[ch].protos.get(t):this[ch].protos[0];if(!i)throw new Error("PROTO not found");this[ch].setLive(this.getLive().getValue()),this[ch].setExecutionContext(this.getExecutionContext()),this.setLoadState(d.COMPLETE_STATE),this.setProtoDeclaration(i)},getInternalScene(){return this[ch]},setError(e){console.error(`Error loading extern prototype '${this.getName()}':`,e),this[ch]=this.getBrowser().getPrivateScene(),this.setLoadState(d.FAILED_STATE),this.setProtoDeclaration(null)},toVRMLStream(e){e.string+=e.Indent(),e.string+="EXTERNPROTO",e.string+=e.Space(),e.string+=this.getName(),e.string+=e.TidySpace(),e.string+="[";const t=this.getUserDefinedFields();if(0===t.length)e.string+=e.TidySpace();else{let i=0,n=0;for(const r of t)i=Math.max(i,r.getTypeName().length),n=Math.max(n,e.AccessType(r.getAccessType()).length);e.string+=e.TidyBreak(),e.IncIndent();for(const r of t)this.toVRMLStreamUserDefinedField(e,r,i,n),e.string+=e.Break();e.DecIndent(),e.string+=e.Indent()}e.string+="]",e.string+=e.TidyBreak(),e.string+=e.Indent(),this._url.toVRMLStream(e)},toVRMLStreamUserDefinedField(e,t,i,n){e.string+=e.Indent(),e.string+=e.AccessType(t.getAccessType()).padEnd(n," "),e.string+=e.Space(),e.string+=t.getTypeName().padEnd(i," "),e.string+=e.Space(),e.string+=t.getName()},toXMLStream(e){e.string+=e.Indent(),e.string+="<ExternProtoDeclare",e.string+=e.Space(),e.string+="name='",e.string+=e.XMLEncode(this.getName()),e.string+="'",e.string+=e.Space(),e.string+="url='",this._url.toXMLStream(e),e.string+="'",e.string+=">",e.string+=e.TidyBreak(),e.IncIndent();const t=this.getUserDefinedFields();for(const i of t)e.string+=e.Indent(),e.string+="<field",e.string+=e.Space(),e.string+="accessType='",e.string+=e.AccessType(i.getAccessType()),e.string+="'",e.string+=e.Space(),e.string+="type='",e.string+=i.getTypeName(),e.string+="'",e.string+=e.Space(),e.string+="name='",e.string+=e.XMLEncode(i.getName()),e.string+="'",e.string+=e.closingTags?"></field>":"/>",e.string+=e.TidyBreak();e.DecIndent(),e.string+=e.Indent(),e.string+="</ExternProtoDeclare>"},toJSONStream(e){e.string+=e.Indent(),e.string+="{",e.string+=e.TidySpace(),e.string+='"',e.string+="ExternProtoDeclare",e.string+='"',e.string+=":",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@name",e.string+='"',e.string+=":",e.string+='"',e.string+=e.JSONEncode(this.getName()),e.string+='"',e.string+=",",e.string+=e.TidyBreak();const t=this.getUserDefinedFields();if(t.length){e.string+=e.Indent(),e.string+='"',e.string+="field",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent();for(const i of t)e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@accessType",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.AccessType(i.getAccessType()),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@type",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=i.getTypeName(),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@name",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(i.getName()),e.string+='"',e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",i!==t.at(-1)&&(e.string+=","),e.string+=e.TidyBreak();e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]",e.string+=",",e.string+=e.TidyBreak()}e.string+=e.Indent(),e.string+='"',e.string+="@url",e.string+='"',e.string+=":",e.string+=e.TidySpace(),this._url.toJSONStream(e),e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}"}});for(const e of Object.keys(ph.prototype))Object.defineProperty(ph.prototype,e,{enumerable:!1});Object.defineProperties(ph.prototype,{name:{get:ph.prototype.getName,enumerable:!0},fields:{get:ph.prototype.getFieldDefinitions,enumerable:!0},isExternProto:{value:!0,enumerable:!0},urls:{get(){return this._url},enumerable:!0},loadState:{get:ph.prototype.checkLoadState,enumerable:!0}}),Object.defineProperties(ph,{typeName:{value:"X3DExternProtoDeclaration",enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode)]),enumerable:!0}}),d.addNode(ph);const gh=ph;i.add("X3DExternProtoDeclaration","x_ite/Prototype/X3DExternProtoDeclaration",gh);const fh=gh;function mh(e=[]){return $.call(this,Array.from(e,(e=>[e.name,e])),fh)}Object.setPrototypeOf(mh.prototype,$.prototype);for(const e of Object.keys(mh.prototype))Object.defineProperty(mh.prototype,e,{enumerable:!1});Object.defineProperties(mh,{typeName:{value:"ExternProtoDeclarationArray",enumerable:!0}});const _h=mh;i.add("ExternProtoDeclarationArray","x_ite/Prototype/ExternProtoDeclarationArray",_h);const xh=_h;function yh(e=[]){return $.call(this,Array.from(e,(e=>[e.name,e])),Bs)}Object.setPrototypeOf(yh.prototype,$.prototype);for(const e of Object.keys(yh.prototype))Object.defineProperty(yh.prototype,e,{enumerable:!1});Object.defineProperties(yh,{typeName:{value:"ProtoDeclarationArray",enumerable:!0}});const wh=yh;i.add("ProtoDeclarationArray","x_ite/Prototype/ProtoDeclarationArray",wh);const bh=wh,Sh=Symbol(),Th=Symbol(),vh=Symbol(),Oh=Symbol(),Eh=Symbol();function Ch(e,t,i,n,r){I.call(this,e),this[Sh]=e,this[Th]=t,this[vh]=i,this[Oh]=n,this[Eh]=r,i.addFieldInterest(r),i.addOutputRoute(this),r.addInputRoute(this)}Object.assign(Object.setPrototypeOf(Ch.prototype,I.prototype),{getExecutionContext(){return this[Sh]},getRouteId(){return Ch.getRouteId(this[vh],this[Eh])},getSourceNode(){return this[Th]},getSourceField(){return this[vh]},getDestinationNode(){return this[Oh]},getDestinationField(){return this[Eh]},disconnect(){this[vh].removeFieldInterest(this[Eh]),this[vh].removeOutputRoute(this),this[Eh].removeInputRoute(this)},toVRMLStream(e){const t=e.LocalName(this[Th]),i=e.LocalName(this[Oh]);e.string+=e.Indent(),e.string+="ROUTE",e.string+=e.Space(),e.string+=t,e.string+=".",e.string+=this[vh].getName(),this[vh].getAccessType()===d.inputOutput&&(e.string+="_changed"),e.string+=e.Space(),e.string+="TO",e.string+=e.Space(),e.string+=i,e.string+=".",this[Eh].getAccessType()===d.inputOutput&&(e.string+="set_"),e.string+=this[Eh].getName()},toXMLStream(e){const t=e.LocalName(this[Th]),i=e.LocalName(this[Oh]);e.string+=e.Indent(),e.string+="<ROUTE",e.string+=e.Space(),e.string+="fromNode='",e.string+=e.XMLEncode(t),e.string+="'",e.string+=e.Space(),e.string+="fromField='",e.string+=e.XMLEncode(this[vh].getName()),this[vh].getAccessType()===d.inputOutput&&(e.string+="_changed"),e.string+="'",e.string+=e.Space(),e.string+="toNode='",e.string+=e.XMLEncode(i),e.string+="'",e.string+=e.Space(),e.string+="toField='",this[Eh].getAccessType()===d.inputOutput&&(e.string+="set_"),e.string+=e.XMLEncode(this[Eh].getName()),e.string+="'",e.string+=e.closingTags?"></ROUTE>":"/>"},toJSONStream(e){const t=e.LocalName(this[Th]),i=e.LocalName(this[Oh]);e.string+=e.Indent(),e.string+="{",e.string+=e.TidySpace(),e.string+='"',e.string+="ROUTE",e.string+='"',e.string+=":",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@fromNode",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(t),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@fromField",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(this[vh].getName()),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@toNode",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(i),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@toField",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(this[Eh].getName()),e.string+='"',e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}"},dispose(){this.disconnect(),this[Sh].deleteRoute(this),I.prototype.dispose.call(this)}});for(const e of Object.keys(Ch.prototype))Object.defineProperty(Ch.prototype,e,{enumerable:!1});Object.defineProperties(Ch.prototype,{sourceNode:{get(){return bi.get(this[Th])},enumerable:!0},sourceField:{get(){return this[vh].getName()},enumerable:!0},destinationNode:{get(){return bi.get(this[Oh])},enumerable:!0},destinationField:{get(){return this[Eh].getName()},enumerable:!0}}),Object.defineProperties(Ch,{typeName:{value:"X3DRoute",enumerable:!0}}),Object.assign(Ch,{getRouteId:(e,t)=>`${e.getId()}.${t.getId()}`});const Nh=Ch;i.add("X3DRoute","x_ite/Routing/X3DRoute",Nh);const Ih=Nh;function Fh(e=[]){return $.call(this,Array.from(e,(e=>[e.getId(),e])),Ih)}Object.setPrototypeOf(Fh.prototype,$.prototype);for(const e of Object.keys(Fh.prototype))Object.defineProperty(Fh.prototype,e,{enumerable:!1});Object.defineProperties(Fh,{typeName:{value:"RouteArray",enumerable:!0}});const Mh=Fh;i.add("RouteArray","x_ite/Routing/RouteArray",Mh);const Dh=Mh,Rh=Symbol(),Ph=Symbol(),Ah=Symbol(),Vh=Symbol(),Lh=Symbol(),Bh=Symbol();function Uh(e,t=null,i=e.getBrowser()){pr.call(this,e,i),this.addType(d.X3DExecutionContext),this.addChildObjects(d.initializeOnly,"rootNodes",new $n.MFNode,d.outputOnly,"worldInfos",new $n.MFNode,d.outputOnly,"sceneGraph_changed",new $n.SFTime),this._rootNodes.setPrivate(!1),this._rootNodes.collectCloneCount=()=>1,this[Bh]=t,this[Rh]=new os,this[Ph]=new ms,this[Ah]=new bh,this[Vh]=new xh,this[Lh]=new Dh,this[Rh].addParent(this),this[Ph].addParent(this),this[Ah].addParent(this),this[Vh].addParent(this),this[Lh].addParent(this)}Object.assign(Object.setPrototypeOf(Uh.prototype,pr.prototype),{initialize(){pr.prototype.initialize.call(this),this.isScene()||this._sceneGraph_changed.addInterest("set_sceneGraph",this)},set_sceneGraph(){this.getExecutionContext()._sceneGraph_changed=this.getBrowser().getCurrentTime()},isScene:()=>!1,getOuterNode(){return this[Bh]},getSpecificationVersion(){return this.getExecutionContext().getSpecificationVersion()},getEncoding(){return this.getExecutionContext().getEncoding()},getWorldURL(){return this.getExecutionContext().getWorldURL()},getBaseURL(){return this.getExecutionContext().getBaseURL()},getProfile(){return this.getExecutionContext().getProfile()},hasComponent(e,t){return this.getExecutionContext().hasComponent(e,t)},getComponents(){return this.getExecutionContext().getComponents()},fromUnit(e,t){return this.getExecutionContext().fromUnit(e,t)},toUnit(e,t){return this.getExecutionContext().toUnit(e,t)},getUnits(){return this.getExecutionContext().getUnits()},createNode(e,t=!0){if(e=String(e),!1===t){const t=this.getBrowser().getConcreteNodes().get(e);if(!t)return null;const i=t.specificationRange;return this.getSpecificationVersion()<i.from||this.getSpecificationVersion()>i.to?null:(this.hasComponent(t.componentInfo.name)||console.warn(`Node type '${e}' does not match component/profile statements in '${this.getWorldURL()}'.`),new t(this))}{const t=this.getBrowser().getConcreteNodes().get(e);if(!t)throw new Error(`Unknown node type '${e}'.`);const i=t.specificationRange;if(this.getSpecificationVersion()<i.from)throw new Error(`Node type '${e}' does not match specification version in '${this.getWorldURL()}.`);if(this.getSpecificationVersion()>i.to)throw new Error(`Node type '${e}' does not match specification version in '${this.getWorldURL()}.`);this.hasComponent(t.componentInfo.name)||console.warn(`Node type '${e}' does not match component/profile statements in '${this.getWorldURL()}'.`);const n=new t(this);return n.setup(),bi.get(n)}},createProto(e,t=!0){e=String(e);for(let i=this;;){const n=i.protos.get(e)??i.externprotos.get(e);if(n)return n.createInstance(this,t);if(i.isScene())break;i=i.getExecutionContext()}if(!1===t)return null;throw new Error(`Unknown proto or externproto type '${e}'.`)},addNamedNode(e,t){if(e=String(e),!(t=Yl(d.X3DNode,t,!1)))throw new Error("Couldn't add named node: node must be of type X3DNode.");if(t.getExecutionContext()!==this)throw new Error("Couldn't add named node: node does not belong to this execution context.");if(0===e.length)throw new Error("Couldn't add named node: node name is empty.");if(this[Rh].has(e))throw new Error(`Couldn't add named node: node named '${e}' is already in use.`);if(this[Rh].get(t.getName())?.getValue()===t)throw new Error(`Couldn't add named node: node named '${t.getName()}' is already added.`);t.setName(e),this[Rh].add(e,bi.get(t))},updateNamedNode(e,t){if(e=String(e),!(t=Yl(d.X3DNode,t,!1)))throw new Error("Couldn't update named node: node must be of type X3DNode.");if(t.getExecutionContext()!==this)throw new Error("Couldn't update named node: node does not belong to this execution context.");if(0===e.length)throw new Error("Couldn't update named node: node name is empty.");this.removeNamedNode(t.getName()),this.removeNamedNode(e),t.setName(e),this[Rh].add(e,bi.get(t)),this._namedNodes_changed=this.getBrowser().getCurrentTime()},removeNamedNode(e){e=String(e);const t=this[Rh].get(e);t&&t.getValue()&&(t.getValue().setName(""),this[Rh].remove(e),this._namedNodes_changed=this.getBrowser().getCurrentTime())},getNamedNode(e){e=String(e);const t=this[Rh].get(e);if(t)return t;throw new Error(`Named node '${e}' not found.`)},getNamedNodes(){return this[Rh]},getUniqueName(e){return f(this[Rh],e)},addImportedNode(e,t,i=t){if(t=String(t),i=String(i),this[Ph].has(i))throw new Error(`Couldn't add imported node: imported name '${i}' already in use.`);this.updateImportedNode(e,t,i)},updateImportedNode(e,t,i){if(e=Yl(d.Inline,e,!1),t=String(t),i=void 0===i?t:String(i),!e)throw new Error("Node must be of type Inline node.");if(e.getExecutionContext()!==this)throw new Error("Couldn't update imported node: Inline node does not belong to this execution context.");if(0===t.length)throw new Error("Couldn't update imported node: exported name is empty.");if(0===i.length)throw new Error("Couldn't update imported node: imported name is empty.");this.removeImportedNode(i);const n=new ps(this,e,t,i);this[Ph].add(i,n),this._importedNodes_changed=this.getBrowser().getCurrentTime()},removeImportedNode(e){e=String(e);const t=this[Ph].get(e);t&&(t.dispose(),this[Ph].remove(e),this._importedNodes_changed=this.getBrowser().getCurrentTime())},getImportedNode(e){e=String(e);const t=this[Ph].get(e);if(t)return bi.get(t.getExportedNode());throw new Error(`Imported node '${e}' not found.`)},getImportedNodes(){return this[Ph]},getLocalNode(e){e=String(e);try{return this.getNamedNode(e)}catch{const t=this[Ph].get(e);if(t)return bi.get(t);throw new Error(`Unknown named or imported node '${e}'.`)}},getLocalName(e){if(!(e=Yl(d.X3DNode,e,!1)))throw new Error("Couldn't get local name: node must be of type X3DNode.");if(e.getExecutionContext()===this)return e.getName();for(const t of this[Ph])try{if(t.getExportedNode()===e)return t.getImportedName()}catch{}throw new Error("Couldn't get local name: node is shared.")},setRootNodes(){},getRootNodes(){return this._rootNodes},getProtoDeclaration(e){e=String(e);const t=this[Ah].get(e);if(t)return t;throw new Error(`Proto declaration '${e}' not found.`)},addProtoDeclaration(e,t){if(e=String(e),!(t instanceof Bs))throw new Error("Couldn't add proto declaration: proto must be of type X3DProtoDeclaration.");if(t.getExecutionContext()!==this)throw new Error("Couldn't add proto declaration: proto does not belong to this execution context.");if(this[Ah].get(e))throw new Error(`Couldn't add proto declaration: proto '${e}' already in use.`);if(this[Ah].get(t.getName())===t)throw new Error(`Couldn't add proto declaration: proto '${t.getName()}' already added.`);if(0===(e=String(e)).length)throw new Error("Couldn't add proto declaration: proto name is empty.");this[Ah].add(e,t),t.setName(e),this._protos_changed=this.getBrowser().getCurrentTime()},updateProtoDeclaration(e,t){if(e=String(e),!(t instanceof Bs))throw new Error("Couldn't update proto declaration: proto must be of type X3DProtoDeclaration.");if(t.getExecutionContext()!==this)throw new Error("Couldn't update proto declaration: proto does not belong to this execution context.");if(0===(e=String(e)).length)throw new Error("Couldn't update proto declaration: proto name is empty.");this[Ah].update(t.getName(),e,t),t.setName(e),this._protos_changed=this.getBrowser().getCurrentTime()},removeProtoDeclaration(e){e=String(e),this[Ah].remove(e),this._protos_changed=this.getBrowser().getCurrentTime()},getProtoDeclarations(){return this[Ah]},getUniqueProtoName(e){return f(this[Ah],e)},getExternProtoDeclaration(e){e=String(e);const t=this[Vh].get(e);if(t)return t;throw new Error(`Extern proto declaration '${e}' not found.`)},addExternProtoDeclaration(e,t){if(e=String(e),!(t instanceof fh))throw new Error("Couldn't add extern proto declaration: extern proto must be of type X3DExternProtoDeclaration.");if(t.getExecutionContext()!==this)throw new Error("Couldn't add extern proto declaration: extern proto does not belong to this execution context.");if(this[Vh].get(e))throw new Error(`Couldn't add extern proto declaration: extern proto '${e}' already in use.`);if(this[Vh].get(t.getName())===t)throw new Error(`Couldn't add extern proto declaration: extern proto '${t.getName()}' already added.`);if(0===(e=String(e)).length)throw new Error("Couldn't add extern proto declaration: extern proto name is empty.");this[Vh].add(e,t),t.setName(e),this._externprotos_changed=this.getBrowser().getCurrentTime()},updateExternProtoDeclaration(e,t){if(e=String(e),!(t instanceof fh))throw new Error("Couldn't update extern proto declaration: extern proto must be of type X3DExternProtoDeclaration.");if(t.getExecutionContext()!==this)throw new Error("Couldn't update extern proto declaration: extern proto does not belong to this execution context.");if(0===(e=String(e)).length)throw new Error("Couldn't update extern proto declaration: extern proto name is empty.");this[Vh].update(t.getName(),e,t),t.setName(e),this._externprotos_changed=this.getBrowser().getCurrentTime()},removeExternProtoDeclaration(e){e=String(e),this[Vh].remove(e),this._externprotos_changed=this.getBrowser().getCurrentTime()},getExternProtoDeclarations(){return this[Vh]},getUniqueExternProtoName(e){return f(this[Vh],e)},addRoute(e,t,i,n){if(e=Yl(d.X3DNode,e,!1),t=String(t),i=Yl(d.X3DNode,i,!1),n=String(n),!e)throw new Error("Bad ROUTE specification: source node must be of type X3DNode.");if(!i)throw new Error("Bad ROUTE specification: destination node must be of type X3DNode.");let r=e instanceof ps?e:null,s=i instanceof ps?i:null;try{e.getExecutionContext()!==this&&(r=this.getLocalNode(this.getLocalName(e)).getValue())}catch{}try{i.getExecutionContext()!==this&&(s=this.getLocalNode(this.getLocalName(i)).getValue())}catch{}if(r instanceof ps&&s instanceof ps?(r.addRoute(r,t,s,n),s.addRoute(r,t,s,n)):r instanceof ps?r.addRoute(r,t,i,n):s instanceof ps&&s.addRoute(e,t,s,n),r!==e&&s!==i)return this.addSimpleRoute(e,t,i,n)},addSimpleRoute(e,t,i,n){try{if(t=e.getField(t),n=i.getField(n),!t.isOutput())throw new Error(`Field named '${t.getName()}' in node named '${e.getName()}' of type ${e.getTypeName()} is not an output field.`);if(!n.isInput())throw new Error(`Field named '${n.getName()}' in node named '${i.getName()}' of type ${i.getTypeName()} is not an input field.`);if(t.getType()!==n.getType())throw new Error(`ROUTE types ${t.getTypeName()} and ${n.getTypeName()} do not match.`);const r=Ih.getRouteId(t,n);let s=this[Lh].get(r);return s||(s=new Ih(this,e,t,i,n),this[Lh].add(r,s),this._routes_changed=this.getBrowser().getCurrentTime(),s)}catch(e){throw new Error(`Bad ROUTE specification: ${e.message}`)}},deleteRoute(e){4===arguments.length&&(e=this.getRoute(...arguments)),e instanceof Ih&&e.getExecutionContext()===this&&(this.deleteSimpleRoute(e),this.deleteImportedRoute(e.sourceNode,e.destinationNode,e))},deleteSimpleRoute(e){this[Lh].remove(e.getRouteId()),e.disconnect(),this._routes_changed=this.getBrowser().getCurrentTime()},deleteImportedRoute(e,t,i){let n=null,r=null;try{e.getValue().getExecutionContext()!==this&&(n=this.getLocalNode(this.getLocalName(e)).getValue())}catch{}try{t.getValue().getExecutionContext()!==this&&(r=this.getLocalNode(this.getLocalName(t)).getValue())}catch{}n instanceof ps&&r instanceof ps?(n.deleteRoute(i),r.deleteRoute(i)):n instanceof ps?n.deleteRoute(i):r instanceof ps&&r.deleteRoute(i)},getRoute(e,t,i,n){if(e=Yl(d.X3DNode,e,!1),t=String(t),i=Yl(d.X3DNode,i,!1),n=String(n),!e)throw new Error("Bad ROUTE specification: sourceNode must be of type X3DNode.");if(!i)throw new Error("Bad ROUTE specification: destinationNode must be of type X3DNode.");return t=e.getField(t),n=i.getField(n),this[Lh].get(Ih.getRouteId(t,n))},getRoutes(){return this[Lh]},getWorldInfos(){return this._worldInfos},addWorldInfo(e){this._worldInfos.push(e)},removeWorldInfo(e){for(let t=this._worldInfos.length-1;t>=0;--t)this._worldInfos[t].getValue()===e&&this._worldInfos.splice(t,1)},toVRMLStream(e){e.PushExecutionContext(this),e.EnterScope(),e.NamedNodes(this.getNamedNodes()),e.ImportedNodes(this.getImportedNodes()),this.getExternProtoDeclarations().toVRMLStream(e),this.getProtoDeclarations().toVRMLStream(e);const t=this.getRootNodes();for(let i=0,n=t.length;i<n;++i){const r=t[i];e.string+=e.Indent(),r?r.toVRMLStream(e):e.string+="NULL",e.string+=e.TidyBreak(),i!==n-1&&(e.string+=e.TidyBreak())}const i=this.getImportedNodes();i.length&&(e.string+=e.TidyBreak(),i.toVRMLStream(e));const n=this.getRoutes();n.length&&(e.string+=e.TidyBreak(),n.toVRMLStream(e)),e.LeaveScope(),e.PopExecutionContext()},toXMLStream(e){e.PushExecutionContext(this),e.EnterScope(),e.NamedNodes(this.getNamedNodes()),e.ImportedNodes(this.getImportedNodes()),this.getExternProtoDeclarations().toXMLStream(e),this.getProtoDeclarations().toXMLStream(e);const t=this.getRootNodes();t.length&&(t.toXMLStream(e),e.string+=e.TidyBreak()),this.getImportedNodes().toXMLStream(e),this.getRoutes().toXMLStream(e),e.LeaveScope(),e.PopExecutionContext()},toJSONStream(e){if(e.PushExecutionContext(this),e.EnterScope(),e.NamedNodes(this.getNamedNodes()),e.ImportedNodes(this.getImportedNodes()),this.getExternProtoDeclarations().toJSONStream(e,!0),this.getProtoDeclarations().toJSONStream(e,!0),this.getRootNodes().length)for(const t of this.getRootNodes())e.string+=e.Indent(),t?t.toJSONStream(e):(e.string+=e.Indent(),e.string+="null"),e.string+=",",e.string+=e.TidyBreak();this.getImportedNodes().toJSONStream(e,!0),this.getRoutes().toJSONStream(e,!0),e.LeaveScope(),e.PopExecutionContext()},dispose(){for(const e of[...this[Lh]])this.deleteRoute(e);pr.prototype.dispose.call(this)}});for(const e of Object.keys(Uh.prototype))Object.defineProperty(Uh.prototype,e,{enumerable:!1});Object.defineProperties(Uh.prototype,{specificationVersion:{get:Uh.prototype.getSpecificationVersion,enumerable:!0},encoding:{get:Uh.prototype.getEncoding,enumerable:!0},profile:{get:Uh.prototype.getProfile,enumerable:!0},components:{get:Uh.prototype.getComponents,enumerable:!0},worldURL:{get:Uh.prototype.getWorldURL,enumerable:!0},baseURL:{get:Uh.prototype.getBaseURL,enumerable:!0},units:{get:Uh.prototype.getUnits,enumerable:!0},namedNodes:{get:Uh.prototype.getNamedNodes,enumerable:!0},importedNodes:{get:Uh.prototype.getImportedNodes,enumerable:!0},rootNodes:{get:Uh.prototype.getRootNodes,set:Uh.prototype.setRootNodes,enumerable:!0},protos:{get:Uh.prototype.getProtoDeclarations,enumerable:!0},externprotos:{get:Uh.prototype.getExternProtoDeclarations,enumerable:!0},routes:{get:Uh.prototype.getRoutes,enumerable:!0}}),Object.defineProperties(Uh,{typeName:{value:"X3DExecutionContext",enumerable:!0}}),d.addNode(Uh);const Xh=Uh;i.add("X3DExecutionContext","x_ite/Execution/X3DExecutionContext",Xh);const jh=Xh,kh=Symbol.for("X_ITE.X3DBaseNode.fieldDefinitions"),zh=Symbol(),Gh=Symbol(),Hh=Symbol();function qh(e,t){this[zh]=t,this[kh]=new Z(t.getFieldDefinitions()),this[Hh]=null,Sr.call(this,e),this.addType(d.X3DPrototypeInstance)}Object.assign(Object.setPrototypeOf(qh.prototype,Sr.prototype),{create(e){return new qh(e,this[zh])},getTypeName(){return this[zh].getName()},initialize(){Sr.prototype.initialize.call(this),this.setProtoNode(this[zh])},construct(){const e=this[zh],t=e.getProtoDeclaration();if(this[Hh]?.dispose(),this[kh].assign(e.getFieldDefinitions()),e.isExternProto){if(e.checkLoadState()!==d.COMPLETE_STATE)return this[Hh]=null,this.isInitialized()&&V.prototype.addEvent.call(this),e._updateInstances.addInterest("construct",this),void e.requestImmediateLoad().catch(Function.prototype);for(const e of t.getUserDefinedFields())try{const t=this.getField(e.getName());if(t.getAccessType()!==e.getAccessType())continue;if(t.getType()!==e.getType())continue;if(!t.isInitializable())continue;if(t.getModificationTime())continue;if(t.hasReferences())continue;if(t.equals(e))continue;t.assign(e)}catch{this.addPredefinedField(t.getFieldDefinitions().get(e.getName()))}}this[Hh]=new jh(t.getExecutionContext(),this),this.importExternProtos(t.getBody().externprotos),this.importProtos(t.getBody().protos),this.copyRootNodes(t.getBody().rootNodes),this.copyImportedNodes(t.getBody(),t.getBody().getImportedNodes()),this.copyRoutes(t.getBody(),t.getBody().routes),this[Hh].setup(),this.isInitialized()&&V.prototype.addEvent.call(this),e._updateInstances.removeInterest("construct",this),e._updateInstances.addInterest("update",this)},update(){const e=this[Gh],t=new Map(Array.from(this.getPredefinedFields(),(e=>[e.getName(),e])));for(const e of t.values())this.removePredefinedField(e.getName());this[Gh]=new Map(Array.from(this[zh].getUserDefinedFields(),(e=>[e,e.getName()])));for(const e of this[zh].getFieldDefinitions())this.addPredefinedField(e);for(const i of this[Gh].keys()){const n=e.get(i);if(!n)continue;const r=this.getPredefinedFields().get(i.getName()),s=t.get(n);if(!s)continue;if(s.getType()!==r.getType())continue;s.addParent(this),s.setAccessType(r.getAccessType()),s.setName(r.getName());const o=new Set(s.getReferences());for(const e of s.getFieldInterests())s.removeFieldInterest(e);for(const e of o)s.removeReference(e),s.addReference(e);for(const e of s.getInputRoutes())e.getSourceField().addFieldInterest(e.getDestinationField());for(const e of s.getOutputRoutes())e.getSourceField().addFieldInterest(e.getDestinationField());this.getPredefinedFields().update(r.getName(),r.getName(),s),t.delete(n),r.dispose()}for(const e of t.values())e.dispose();this.construct()},getExtendedEventHandling:()=>!1,getProtoNode(){return this[zh]},setProtoNode(e){const t=this[zh];t._name_changed.removeFieldInterest(this._typeName_changed),t._updateInstances.removeInterest("construct",this),t._updateInstances.removeInterest("update",this),this[zh]=e,this[Gh]=new Map(Array.from(e.getUserDefinedFields(),(e=>[e,e.getName()]))),e._name_changed.addFieldInterest(this._typeName_changed),e===t?this.construct():this.update()},getBody(){return this[Hh]},getInnerNode(){if(this[Hh]){const e=this[Hh].getRootNodes();if(e.length){const t=e[0];if(t)return t.getValue().getInnerNode()}}throw new Error("Root node not available.")},importExternProtos(e){const t=this[Hh].externprotos;for(const i of e)t.add(i.getName(),i)},importProtos(e){const t=this[Hh].protos;for(const i of e)t.add(i.getName(),i)},copyRootNodes(e){const t=this[Hh].getRootNodes();for(const i of e)t.push(i.copy(this))},copyImportedNodes(e,t){for(const e of t)try{const t=this[Hh].getNamedNode(e.getInlineNode().getName()),i=e.getImportedName(),n=e.getExportedName();this[Hh].addImportedNode(t,n,i)}catch(e){console.error("Bad IMPORT specification in copy: ",e)}},copyRoutes(e,t){for(const i of t)try{const t=this[Hh].getLocalNode(e.getLocalName(i.sourceNode)),n=this[Hh].getLocalNode(e.getLocalName(i.destinationNode));this[Hh].addRoute(t,i.sourceField,n,i.destinationField)}catch(e){console.error(e)}},toXMLStream(e){const t=e.IsSharedNode(this);e.EnterScope();const i=e.Name(this);if(i.length&&e.ExistsNode(this)){e.string+=e.Indent(),e.string+="<ProtoInstance",e.string+=e.Space(),e.string+="name='",e.string+=e.XMLEncode(this.getTypeName()),e.string+="'",e.string+=e.Space(),e.string+="USE='",e.string+=e.XMLEncode(i),e.string+="'";const t=e.ContainerField();return t&&t.getName()!==this.getContainerField()&&(e.string+=e.Space(),e.string+="containerField='",e.string+=e.XMLEncode(t.getName()),e.string+="'"),e.string+=e.closingTags?"></ProtoInstance>":"/>",void e.LeaveScope()}e.string+=e.Indent(),e.string+="<ProtoInstance",e.string+=e.Space(),e.string+="name='",e.string+=e.XMLEncode(this.getTypeName()),e.string+="'",i.length&&(e.AddNode(this),e.string+=e.Space(),e.string+="DEF='",e.string+=e.XMLEncode(i),e.string+="'");const n=e.ContainerField();n&&n.getName()!==this.getContainerField()&&(e.string+=e.Space(),e.string+="containerField='",e.string+=e.XMLEncode(n.getName()),e.string+="'");const r=this.getChangedFields();if(0===r.length)e.string+=e.closingTags?"></ProtoInstance>":"/>";else{e.string+=">",e.string+=e.TidyBreak(),e.IncIndent();const i=[];for(const n of r){let r=!1;if(e.ExecutionContext()&&n.getAccessType()===d.inputOutput&&0!==n.getReferences().size&&([...n.getReferences()].some((e=>e.isInitializable()))||(r=!this.isDefaultValue(n))),0===n.getReferences().size||!e.ExecutionContext()||t||r)switch(r&&i.push(n),n.getType()){case d.MFNode:e.string+=e.Indent(),e.string+="<fieldValue",e.string+=e.Space(),e.string+="name='",e.string+=e.XMLEncode(n.getName()),e.string+="'",0===n.length?(e.string+=e.closingTags?"></fieldValue>":"/>",e.string+=e.TidyBreak()):(e.PushContainerField(n),e.string+=">",e.string+=e.TidyBreak(),e.IncIndent(),n.toXMLStream(e),e.string+=e.TidyBreak(),e.DecIndent(),e.string+=e.Indent(),e.string+="</fieldValue>",e.string+=e.TidyBreak(),e.PopContainerField());break;case d.SFNode:if(null!==n.getValue()){e.PushContainerField(null),e.string+=e.Indent(),e.string+="<fieldValue",e.string+=e.Space(),e.string+="name='",e.string+=e.XMLEncode(n.getName()),e.string+="'",e.string+=">",e.string+=e.TidyBreak(),e.IncIndent(),n.toXMLStream(e),e.string+=e.TidyBreak(),e.DecIndent(),e.string+=e.Indent(),e.string+="</fieldValue>",e.string+=e.TidyBreak(),e.PopContainerField();break}default:e.string+=e.Indent(),e.string+="<fieldValue",e.string+=e.Space(),e.string+="name='",e.string+=e.XMLEncode(n.getName()),e.string+="'",e.string+=e.Space(),e.string+="value='",n.toXMLStream(e),e.string+="'",e.string+=e.closingTags?"></fieldValue>":"/>",e.string+=e.TidyBreak()}else i.push(n)}if(i.length&&!t){e.string+=e.Indent(),e.string+="<IS>",e.string+=e.TidyBreak(),e.IncIndent();for(const t of i){const i=t.getReferences();for(const n of i)e.string+=e.Indent(),e.string+="<connect",e.string+=e.Space(),e.string+="nodeField='",e.string+=e.XMLEncode(t.getName()),e.string+="'",e.string+=e.Space(),e.string+="protoField='",e.string+=e.XMLEncode(n.getName()),e.string+="'",e.string+=e.closingTags?"></connect>":"/>",e.string+=e.TidyBreak()}e.DecIndent(),e.string+=e.Indent(),e.string+="</IS>",e.string+=e.TidyBreak()}e.DecIndent(),e.string+=e.Indent(),e.string+="</ProtoInstance>"}e.LeaveScope()},toJSONStream(e){const t=e.IsSharedNode(this);e.EnterScope();const i=e.Name(this);if(i.length&&e.ExistsNode(this))return e.string+="{",e.string+=e.TidySpace(),e.string+='"',e.string+="ProtoInstance",e.string+='"',e.string+=":",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@name",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(this.getTypeName()),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@USE",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(i),e.string+='"',e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",void e.LeaveScope();e.string+="{",e.string+=e.TidySpace(),e.string+='"',e.string+="ProtoInstance",e.string+='"',e.string+=":",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),i.length&&(e.AddNode(this),e.string+=e.Indent(),e.string+='"',e.string+="@DEF",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(i),e.string+='"',e.string+=",",e.string+=e.TidyBreak()),e.string+=e.Indent(),e.string+='"',e.string+="@name",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(this.getTypeName()),e.string+='"',e.string+=",",e.string+=e.TidyBreak();const n=this.getChangedFields(),r=[];if(n.length){e.string+=e.Indent(),e.string+='"',e.string+="fieldValue",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent();const i=[];for(const s of n){let n=!1;e.ExecutionContext()&&s.getAccessType()===d.inputOutput&&0!==s.getReferences().size&&([...s.getReferences()].some((e=>e.isInitializable()))||(n=!this.isDefaultValue(s))),0===s.getReferences().size||!e.ExecutionContext()||t||n?(n&&r.push(s),i.push(s)):r.push(s)}for(const t of i){switch(t.getType()){case d.SFNode:e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@name",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(t.getName()),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="-children",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),t.toJSONStream(e),e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}";break;case d.MFNode:e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@name",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(t.getName()),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="-children",e.string+='"',e.string+=":",e.string+=e.TidySpace(),t.toJSONStream(e),e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}";break;default:e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@name",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(t.getName()),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@value",e.string+='"',e.string+=":",e.string+=e.TidySpace(),t.toJSONStream(e),e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}"}t!==i.at(-1)&&(e.string+=","),e.string+=e.TidyBreak()}if(e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]",e.string+=",",e.string+=e.TidyBreak(),r.length&&!t){e.string+=e.Indent(),e.string+='"',e.string+="IS",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="connect",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent();for(const t of r){const i=[...t.getReferences()];for(const n of i)e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@nodeField",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(t.getName()),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@protoField",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(n.getName()),e.string+='"',e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",t===r.at(-1)&&n===i.at(-1)||(e.string+=","),e.string+=e.TidyBreak()}e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=",",e.string+=e.TidyBreak()}}e.JSONRemoveComma(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.LeaveScope()},dispose(){const e=this[zh];e._name_changed.removeFieldInterest(this._typeName_changed),e._updateInstances.removeInterest("construct",this),e._updateInstances.removeInterest("update",this),this[Hh]?.dispose(),Sr.prototype.dispose.call(this)}}),Object.defineProperties(qh,{typeName:{value:"X3DPrototypeInstance",enumerable:!0},componentInfo:{value:Object.freeze({name:"Core",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0}});const Yh=qh;i.add("X3DPrototypeInstance","x_ite/Components/Core/X3DPrototypeInstance",Yh);const Wh=Yh,$h={name:"Core",concreteNodes:[Ir,Dr,Ar,Br,jr,Gr,Qr],abstractNodes:[ns,Yr,Jr,Or,Sr,Wh,pu]};i.add("Core","x_ite/Components/Core",$h);const Jh=$h;function Kh(e){Sr.call(this,e),this.addType(d.X3DGeometricPropertyNode)}Object.setPrototypeOf(Kh.prototype,Sr.prototype),Object.defineProperties(Kh,{typeName:{value:"X3DGeometricPropertyNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Rendering",level:1}),enumerable:!0}});const Zh=Kh;i.add("X3DGeometricPropertyNode","x_ite/Components/Rendering/X3DGeometricPropertyNode",Zh);const Qh=Zh;function ed(e){Qh.call(this,e),this.addType(d.FogCoordinate),this._depth.setUnit("length")}Object.assign(Object.setPrototypeOf(ed.prototype,Qh.prototype),{initialize(){Qh.prototype.initialize.call(this),this._depth.addInterest("set_depth__",this),this.set_depth__()},set_depth__(){this.depth=this._depth.getValue(),this.length=this._depth.length},isEmpty(){return 0===this.length},getSize(){return this.length},addDepth(e,t){if(e>=0&&this.length)return t.push(this.depth[e%this.length]);t.push(0)},addDepths(e,t=this.length){const i=this.length;if(i){const n=this.depth;for(let r=0;r<t;++r)e.push(n[r%i])}else for(let i=0;i<t;++i)e.push(0);return e}}),Object.defineProperties(ed,{typeName:{value:"FogCoordinate",enumerable:!0},componentInfo:{value:Object.freeze({name:"EnvironmentalEffects",level:4}),enumerable:!0},containerField:{value:"fogCoord",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"depth",new $n.MFFloat)]),enumerable:!0}});const td=ed;i.add("FogCoordinate","x_ite/Components/EnvironmentalEffects/FogCoordinate",td);const id=td;function nd(e){Yr.call(this,e),ml.call(this,e),this.addType(d.LocalFog)}Object.assign(Object.setPrototypeOf(nd.prototype,Yr.prototype),ml.prototype,{initialize(){Yr.prototype.initialize.call(this),ml.prototype.initialize.call(this)},push(e){if(this._enabled.getValue()&&this.getFogType()){const t=this.getFogs().pop();t.set(this,e.getModelViewMatrix().get()),e.getLocalFogs().push(t)}},pop(e){this._enabled.getValue()&&this.getFogType()&&this.getBrowser().getLocalObjects().push(e.getLocalFogs().pop())},dispose(){ml.prototype.dispose.call(this),Yr.prototype.dispose.call(this)}}),Object.defineProperties(nd,{typeName:{value:"LocalFog",enumerable:!0},componentInfo:{value:Object.freeze({name:"EnvironmentalEffects",level:4}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"fogType",new $n.SFString("LINEAR")),new k(d.inputOutput,"color",new $n.SFColor(1,1,1)),new k(d.inputOutput,"visibilityRange",new $n.SFFloat)]),enumerable:!0}});const rd=nd;i.add("LocalFog","x_ite/Components/EnvironmentalEffects/LocalFog",rd);const sd=rd;function od(e){Ul.call(this,e),this.addType(d.TextureBackground)}Object.assign(Object.setPrototypeOf(od.prototype,Ul.prototype),{initialize(){Ul.prototype.initialize.call(this),this._frontTexture.addInterest("set_texture__",this,0),this._backTexture.addInterest("set_texture__",this,1),this._leftTexture.addInterest("set_texture__",this,2),this._rightTexture.addInterest("set_texture__",this,3),this._topTexture.addInterest("set_texture__",this,4),this._bottomTexture.addInterest("set_texture__",this,5),this.set_texture__(0,this._frontTexture),this.set_texture__(1,this._backTexture),this.set_texture__(2,this._leftTexture),this.set_texture__(3,this._rightTexture),this.set_texture__(4,this._topTexture),this.set_texture__(5,this._bottomTexture)},set_texture__(e,t){Ul.prototype.set_texture__.call(this,e,Yl(d.X3DTextureNode,t))}}),Object.defineProperties(od,{typeName:{value:"TextureBackground",enumerable:!0},componentInfo:{value:Object.freeze({name:"EnvironmentalEffects",level:3}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_bind",new $n.SFBool),new k(d.inputOutput,"skyAngle",new $n.MFFloat),new k(d.inputOutput,"skyColor",new $n.MFColor(new Fe(0,0,0))),new k(d.inputOutput,"groundAngle",new $n.MFFloat),new k(d.inputOutput,"groundColor",new $n.MFColor),new k(d.inputOutput,"transparency",new $n.SFFloat),new k(d.outputOnly,"isBound",new $n.SFBool),new k(d.outputOnly,"bindTime",new $n.SFTime),new k(d.inputOutput,"frontTexture",new $n.SFNode),new k(d.inputOutput,"backTexture",new $n.SFNode),new k(d.inputOutput,"leftTexture",new $n.SFNode),new k(d.inputOutput,"rightTexture",new $n.SFNode),new k(d.inputOutput,"topTexture",new $n.SFNode),new k(d.inputOutput,"bottomTexture",new $n.SFNode)]),enumerable:!0}});const ad=od;i.add("TextureBackground","x_ite/Components/EnvironmentalEffects/TextureBackground",ad);const ld={name:"EnvironmentalEffects",concreteNodes:[au,yl,id,sd,ad],abstractNodes:[Ul,ml]};i.add("EnvironmentalEffects","x_ite/Components/EnvironmentalEffects",ld);const ud=ld;function hd(e){pu.call(this,e),this.addType(d.X3DEnvironmentalSensorNode),this.addChildObjects(d.outputOnly,"traversed",new $n.SFBool(!0)),this._size.setUnit("length"),this._center.setUnit("length"),this.zeroTest=!1,this.currentTraversed=!0}Object.assign(Object.setPrototypeOf(hd.prototype,pu.prototype),{initialize(){pu.prototype.initialize.call(this),this.getLive().addInterest("set_live__",this),this._enabled.addInterest("set_live__",this),this._size.addInterest("set_live__",this),this._traversed.addInterest("set_live__",this),this.set_live__()},set_live__(){!(this._traversed.getValue()&&this.getLive().getValue()&&this._enabled.getValue())||this.zeroTest&&this._size.getValue().equals(Tt.Zero)?(this.getBrowser().sensorEvents().removeInterest("update",this),this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime())):this.getBrowser().sensorEvents().addInterest("update",this)},setZeroTest(e){this.zeroTest=e},getZeroTest(){return this.zeroTest},setTraversed(e){e?!1===this._traversed.getValue()&&(this._traversed=!0):this.currentTraversed!==this._traversed.getValue()&&(this._traversed=this.currentTraversed),this.currentTraversed=e},getTraversed(){return this.currentTraversed},update(){}}),Object.defineProperties(hd,{typeName:{value:"X3DEnvironmentalSensorNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"EnvironmentalSensor",level:1}),enumerable:!0}});const dd=hd;i.add("X3DEnvironmentalSensorNode","x_ite/Components/EnvironmentalSensor/X3DEnvironmentalSensorNode",dd);const cd=dd;function pd(e){cd.call(this,e),this.addType(d.ProximitySensor),this.setCameraObject(!0),this._centerOfRotation_changed.setUnit("length"),this._position_changed.setUnit("length"),this.setZeroTest(!0),this.min=new Tt(0,0,0),this.max=new Tt(0,0,0),this.layerNode=null,this.modelMatrix=new gi,this.inside=!1}Object.assign(Object.setPrototypeOf(pd.prototype,cd.prototype),{initialize(){cd.prototype.initialize.call(this),this._enabled.addInterest("set_enabled__",this),this._size.addInterest("set_extents__",this),this._center.addInterest("set_extents__",this),this._traversed.addFieldInterest(this._isCameraObject),this.set_enabled__(),this.set_extents__()},set_enabled__(){this.setCameraObject(this._enabled.getValue()),this._enabled.getValue()?delete this.traverse:this.traverse=Function.prototype},set_extents__(){const e=this._size.getValue(),t=this._center.getValue(),i=e.x/2,n=e.y/2,r=e.z/2,s=t.x,o=t.y,a=t.z;this.min.set(s-i,o-n,a-r),this.max.set(s+i,o+n,a+r)},update:(()=>{const e=new Tt(0,0,0),t=new ui,i=new Tt(0,0,0),n=new gi;return function(){if(this.inside&&this.getTraversed()){if(this.layerNode){const r=this.layerNode.getViewpoint(),s=this.modelMatrix.inverse();n.assign(r.getModelMatrix()).translate(r.getUserCenterOfRotation()).multRight(s).get(i),s.multLeft(r.getCameraSpaceMatrix()).get(e,t),this._isActive.getValue()?(this._position_changed.getValue().equals(e)||(this._position_changed=e),this._orientation_changed.getValue().equals(t)||(this._orientation_changed=t),this._centerOfRotation_changed.getValue().equals(i)||(this._centerOfRotation_changed=i)):(this._isActive=!0,this._enterTime=this.getBrowser().getCurrentTime(),this._position_changed=e,this._orientation_changed=t,this._centerOfRotation_changed=i)}}else this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime());this.inside=!1,this.layerNode=null,this.setTraversed(!1)}})(),traverse:(()=>{const e=new gi,t=new Tt(-1,-1,-1);return function(i,n){switch(i){case Ma.CAMERA:return this.layerNode=n.getLayer(),void this.modelMatrix.assign(n.getModelViewMatrix().get());case Ma.DISPLAY:if(this.setTraversed(!0),this.inside)return;return void(this._size.getValue().equals(t)?this.inside=!0:(e.assign(n.getModelViewMatrix().get()).inverse(),this.inside=this.containsPoint(e.origin)))}}})(),containsPoint(e){const t=this.min,i=this.max;return t.x<=e.x&&i.x>=e.x&&t.y<=e.y&&i.y>=e.y&&t.z<=e.z&&i.z>=e.z}}),Object.defineProperties(pd,{typeName:{value:"ProximitySensor",enumerable:!0},componentInfo:{value:Object.freeze({name:"EnvironmentalSensor",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"size",new $n.SFVec3f),new k(d.inputOutput,"center",new $n.SFVec3f),new k(d.outputOnly,"enterTime",new $n.SFTime),new k(d.outputOnly,"exitTime",new $n.SFTime),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"position_changed",new $n.SFVec3f),new k(d.outputOnly,"orientation_changed",new $n.SFRotation),new k(d.outputOnly,"centerOfRotation_changed",new $n.SFVec3f)]),enumerable:!0}});const gd=pd;i.add("ProximitySensor","x_ite/Components/EnvironmentalSensor/ProximitySensor",gd);const fd=gd,md=dl(gi),_d=dl(gi);function xd(e){cd.call(this,e),this.addType(d.TransformSensor),this._position_changed.setUnit("length"),this.setZeroTest(!0),this.min=new Tt,this.max=new Tt,this.targetObjectNode=null,this.modelMatrices=[],this.targetMatrices=[]}Object.assign(Object.setPrototypeOf(xd.prototype,cd.prototype),{initialize(){cd.prototype.initialize.call(this),this.getLive().addInterest("set_enabled__",this),this._enabled.addInterest("set_enabled__",this),this._size.addInterest("set_enabled__",this),this._size.addInterest("set_extents__",this),this._center.addInterest("set_extents__",this),this._targetObject.addInterest("set_targetObject__",this),this.set_extents__(),this.set_targetObject__()},set_live__(){},set_enabled__(){this.getLive().getValue()&&this.targetObjectNode&&this._enabled.getValue()&&!this._size.getValue().equals(Tt.Zero)?(this.setPickableObject(!0),this.getBrowser().addTransformSensor(this),this.targetObjectNode.addTransformSensor(this)):(this.setPickableObject(!1),this.getBrowser().removeTransformSensor(this),this.targetObjectNode&&this.targetObjectNode.removeTransformSensor(this),this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime()))},set_extents__(){const e=this._size.getValue(),t=this._center.getValue(),i=e.x/2,n=e.y/2,r=e.z/2,s=t.x,o=t.y,a=t.z;this.min.set(s-i,o-n,a-r),this.max.set(s+i,o+n,a+r)},set_targetObject__(){this.targetObjectNode=null;try{const e=this._targetObject.getValue().getInnerNode(),t=e.getType();for(let i=t.length-1;i>=0;--i){switch(t[i]){case d.X3DGroupingNode:case d.X3DShapeNode:this.targetObjectNode=e;break;default:continue}break}}catch{}this.set_enabled__()},traverse(e,t){e===Ma.PICKING&&this.isPickableObject()&&this.modelMatrices.push(md.pop().assign(t.getModelViewMatrix().get()))},collect(e){this.targetMatrices.push(_d.pop().assign(e))},process:(()=>{const e=new Tt(0,0,0),t=new ui;return function(){const i=this.modelMatrices,n=this.targetMatrices,r=this.intersects();r?(r.get(e,t),this._isActive.getValue()?(this._position_changed.getValue().equals(e)||(this._position_changed=e),this._orientation_changed.getValue().equals(t)||(this._orientation_changed=t)):(this._isActive=!0,this._enterTime=this.getBrowser().getCurrentTime(),this._position_changed=e,this._orientation_changed=t)):this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime());for(const e of i)md.push(e);for(const e of n)_d.push(e);i.length=0,n.length=0}})(),intersects:(()=>{const e=new Tt(-1,-1,-1);return function(){const t=this.modelMatrices,i=this.targetMatrices,n=this._size.getValue().equals(e);for(const e of t){const t=e.inverse();for(const e of i){const i=e.multRight(t);if(n||this.containsPoint(i.origin))return i}}return null}})(),containsPoint(e){const t=this.min,i=this.max;return t.x<=e.x&&i.x>=e.x&&t.y<=e.y&&i.y>=e.y&&t.z<=e.z&&i.z>=e.z}}),Object.defineProperties(xd,{typeName:{value:"TransformSensor",enumerable:!0},componentInfo:{value:Object.freeze({name:"EnvironmentalSensor",level:3}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.2",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"size",new $n.SFVec3f),new k(d.inputOutput,"center",new $n.SFVec3f),new k(d.outputOnly,"enterTime",new $n.SFTime),new k(d.outputOnly,"exitTime",new $n.SFTime),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"position_changed",new $n.SFVec3f),new k(d.outputOnly,"orientation_changed",new $n.SFRotation),new k(d.inputOutput,"targetObject",new $n.SFNode)]),enumerable:!0}});const yd=xd;i.add("TransformSensor","x_ite/Components/EnvironmentalSensor/TransformSensor",yd);const wd=yd;function bd(e){cd.call(this,e),this.addType(d.VisibilitySensor),this.setZeroTest(!1),this.visible=!1}Object.assign(Object.setPrototypeOf(bd.prototype,cd.prototype),{initialize(){cd.prototype.initialize.call(this),this._enabled.addInterest("set_enabled__",this),this.set_enabled__()},set_enabled__(){this._enabled.getValue()?delete this.traverse:this.traverse=Function.prototype},update(){this.visible&&this.getTraversed()?(this._isActive.getValue()||(this._isActive=!0,this._enterTime=this.getBrowser().getCurrentTime()),this.visible=!1):this._isActive.getValue()&&(this._isActive=!1,this._exitTime=this.getBrowser().getCurrentTime()),this.setTraversed(!1)},traverse:(()=>{const e=new Xa,t=new Tt(-1,-1,-1);return function(i,n){i===Ma.DISPLAY&&(this.setTraversed(!0),this.visible||(this._size.getValue().equals(t)?this.visible=!0:(e.set(this._size.getValue(),this._center.getValue()).multRight(n.getModelViewMatrix().get()),this.visible=n.getViewVolume().intersectsBox(e))))}})()}),Object.defineProperties(bd,{typeName:{value:"VisibilitySensor",enumerable:!0},componentInfo:{value:Object.freeze({name:"EnvironmentalSensor",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"size",new $n.SFVec3f),new k(d.inputOutput,"center",new $n.SFVec3f),new k(d.outputOnly,"enterTime",new $n.SFTime),new k(d.outputOnly,"exitTime",new $n.SFTime),new k(d.outputOnly,"isActive",new $n.SFBool)]),enumerable:!0}});const Sd=bd;i.add("VisibilitySensor","x_ite/Components/EnvironmentalSensor/VisibilitySensor",Sd);const Td={name:"EnvironmentalSensor",concreteNodes:[fd,wd,Sd],abstractNodes:[cd]};i.add("EnvironmentalSensor","x_ite/Components/EnvironmentalSensor",Td);const vd=Td;function Od(e){Yr.call(this,e),this.addType(d.X3DFollowerNode),this.buffer=[],this.a=this.getVector(),this.vector=this.getVector()}Object.assign(Object.setPrototypeOf(Od.prototype,Yr.prototype),{initialize(){Yr.prototype.initialize.call(this),this.getLive().addInterest("set_live__",this)},getBuffer(){return this.buffer},getValue(){return this._set_value.getValue()},getDestination(){return this._set_destination.getValue()},getInitialValue(){return this._initialValue.getValue()},getInitialDestination(){return this._initialDestination.getValue()},setValue(e){this._value_changed=e},setDestination(e){this.destination.assign(e)},duplicate:e=>e.copy(),assign(e,t,i){e[t].assign(i)},equals(e,t,i){return this.a.assign(e).subtract(t).magnitude()<i},interpolate(e,t,i){return this.vector.assign(e).lerp(t,i)},set_live__(){this.getLive().getValue()&&this._isActive.getValue()?(this.getBrowser().prepareEvents().addInterest("prepareEvents",this),this.getBrowser().addBrowserEvent()):this.getBrowser().prepareEvents().removeInterest("prepareEvents",this)},set_active(e){e!==this._isActive.getValue()&&(this._isActive=e,this.set_live__())}}),Object.defineProperties(Od,{typeName:{value:"X3DFollowerNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Followers",level:1}),enumerable:!0}});const Ed=Od;i.add("X3DFollowerNode","x_ite/Components/Followers/X3DFollowerNode",Ed);const Cd=Ed;function Nd(e){Cd.call(this,e),this.addType(d.X3DChaserNode),this.destination=null,this.previousValue=null,this.bufferEndTime=0,this.stepTime=0,this.deltaOut=this.getVector()}Object.assign(Object.setPrototypeOf(Nd.prototype,Cd.prototype),{initialize(){Cd.prototype.initialize.call(this),this._set_value.addInterest("set_value__",this),this._set_destination.addInterest("set_destination__",this),this._duration.addInterest("set_duration__",this),this.set_duration__();var e=this.getBuffer(),t=this.getInitialValue(),i=this.getInitialDestination(),n=this.getNumBuffers();this.bufferEndTime=this.getBrowser().getCurrentTime(),this.previousValue=this.duplicate(t),e[0]=this.duplicate(i);for(var r=1;r<n;++r)e[r]=this.duplicate(t);this.destination=this.duplicate(i),this.equals(i,t,this.getTolerance())?this.setValue(i):this.set_active(!0)},getNumBuffers:()=>60,getTolerance:()=>1e-8,getArray(){return this.getVector()},setPreviousValue(e){this.previousValue.assign(e)},step(e,t,i){this.output.add(this.deltaOut.assign(e).subtract(t).multiply(i))},stepResponse(e){if(e<=0)return 0;var t=this._duration.getValue();return e>=t?1:.5-.5*Math.cos(e/t*Math.PI)},set_value__(){this._isActive.getValue()||(this.bufferEndTime=this.getBrowser().getCurrentTime());for(var e=this.getBuffer(),t=this.getValue(),i=0,n=e.length;i<n;++i)this.assign(e,i,t);this.setPreviousValue(t),this.setValue(t),this.set_active(!0)},set_destination__(){this.setDestination(this.getDestination()),this._isActive.getValue()||(this.bufferEndTime=this.getBrowser().getCurrentTime()),this.set_active(!0)},set_duration__(){this.stepTime=this._duration.getValue()/this.getNumBuffers()},prepareEvents(){var e=this.getBuffer(),t=e.length,i=this.updateBuffer();this.output=this.interpolate(this.previousValue,e[t-1],this.stepResponse((t-1+i)*this.stepTime));for(var n=t-2;n>=0;--n)this.step(e[n],e[n+1],this.stepResponse((n+i)*this.stepTime));this.setValue(this.output),this.equals(this.output,this.destination,this.getTolerance())&&this.set_active(!1)},updateBuffer(){var e=this.getBuffer(),t=e.length,i=(this.getBrowser().getCurrentTime()-this.bufferEndTime)/this.stepTime;if(i>=1){var n=Math.floor(i);if(i-=n,n<t){this.setPreviousValue(e[t-n]);for(var r=t-1;r>=n;--r)this.assign(e,r,e[r-n]);for(r=0;r<n;++r){var s=r/n;this.assign(e,r,this.interpolate(this.destination,e[n],s))}}else{this.setPreviousValue(n==t?e[0]:this.destination);for(r=0;r<t;++r)this.assign(e,r,this.destination)}this.bufferEndTime+=n*this.stepTime}return i}}),Object.defineProperties(Nd,{typeName:{value:"X3DChaserNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Followers",level:1}),enumerable:!0}});const Id=Nd;i.add("X3DChaserNode","x_ite/Components/Followers/X3DChaserNode",Id);const Fd=Id;var Md=new Tt(0,0,0),Dd=new Tt(0,0,0),Rd=new Tt(0,0,0),Pd=new Tt(0,0,0);function Ad(e){Fd.call(this,e),this.addType(d.ColorChaser)}Object.assign(Object.setPrototypeOf(Ad.prototype,Fd.prototype),{getVector:()=>new Tt(0,0,0),getValue(){return this._set_value.getValue().getHSV(Pd)},getDestination(){return this._set_destination.getValue().getHSV(Pd)},getInitialValue(){return this._initialValue.getValue().getHSV(Md)},getInitialDestination(){return this._initialDestination.getValue().getHSV(Dd)},setValue(e){this._value_changed.setHSV(e.x,e.y,e.z)},interpolate:(e,t,i)=>Fe.lerp(e,t,i,Pd),step(e,t,i){Rd.assign(this.output).add(e).subtract(t),Fe.lerp(this.output,Rd,i,this.output)}}),Object.defineProperties(Ad,{typeName:{value:"ColorChaser",enumerable:!0},componentInfo:{value:Object.freeze({name:"Followers",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.3",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_value",new $n.SFColor),new k(d.inputOnly,"set_destination",new $n.SFColor),new k(d.initializeOnly,"initialValue",new $n.SFColor(.8,.8,.8)),new k(d.initializeOnly,"initialDestination",new $n.SFColor(.8,.8,.8)),new k(d.initializeOnly,"duration",new $n.SFTime(1)),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"value_changed",new $n.SFColor)]),enumerable:!0}});const Vd=Ad;i.add("ColorChaser","x_ite/Components/Followers/ColorChaser",Vd);const Ld=Vd;function Bd(e){Cd.call(this,e),this.addType(d.X3DDamperNode)}Object.assign(Object.setPrototypeOf(Bd.prototype,Cd.prototype),{initialize(){Cd.prototype.initialize.call(this),this._order.addInterest("set_order__",this),this._set_value.addInterest("set_value__",this),this._set_destination.addInterest("set_destination__",this);var e=this.getBuffer(),t=this.getInitialValue(),i=this.getInitialDestination();e[0]=this.duplicate(i);for(var n=1,r=this.getOrder()+1;n<r;++n)e[n]=this.duplicate(t);this.equals(i,t,this.getTolerance())?this.setValue(i):this.set_active(!0)},getOrder(){return g.clamp(this._order.getValue(),0,5)},getTolerance(){return this._tolerance.getValue()<0?1e-4:this._tolerance.getValue()},prepareEvents(){var e=this.getBuffer(),t=e.length-1;if(this._tau.getValue()){for(var i=1/this.getBrowser().currentFrameRate,n=Math.exp(-i/this._tau.getValue()),r=0;r<t;++r)this.assign(e,r+1,this.interpolate(e[r],e[r+1],n));if(this.setValue(e[t]),!this.equals(e[t],e[0],this.getTolerance()))return}else this.setValue(e[0]),t=0;r=1;for(var s=e.length;r<s;++r)this.assign(e,r,e[t]);this.set_active(!1)},set_value__(){for(var e=this.getBuffer(),t=this.getValue(),i=1,n=e.length;i<n;++i)this.assign(e,i,t);this.setValue(t),this.set_active(!0)},set_destination__(){this.assign(this.getBuffer(),0,this.getDestination()),this.set_active(!0)},set_order__(){for(var e=this.getBuffer(),t=e[e.length-1],i=e.length,n=this.getOrder()+1;i<n;++i)e[i]=this.duplicate(t);e.length=n}}),Object.defineProperties(Bd,{typeName:{value:"X3DDamperNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Followers",level:1}),enumerable:!0}});const Ud=Bd;i.add("X3DDamperNode","x_ite/Components/Followers/X3DDamperNode",Ud);const Xd=Ud;var jd=new Tt(0,0,0),kd=new Tt(0,0,0),zd=new Tt(0,0,0),Gd=new Tt(0,0,0);function Hd(e){Xd.call(this,e),this.addType(d.ColorDamper)}Object.assign(Object.setPrototypeOf(Hd.prototype,Xd.prototype),{getVector:()=>new Tt(0,0,0),getValue(){return this._set_value.getValue().getHSV(Gd)},getDestination(){return this._set_destination.getValue().getHSV(Gd)},getInitialValue(){return this._initialValue.getValue().getHSV(kd)},getInitialDestination(){return this._initialDestination.getValue().getHSV(zd)},setValue(e){this._value_changed.setHSV(e.x,e.y,e.z)},equals:(e,t,i)=>jd.assign(e).subtract(t).magnitude()<i,interpolate:(e,t,i)=>Fe.lerp(e,t,i,Gd)}),Object.defineProperties(Hd,{typeName:{value:"ColorDamper",enumerable:!0},componentInfo:{value:Object.freeze({name:"Followers",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.2",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_value",new $n.SFColor),new k(d.inputOnly,"set_destination",new $n.SFColor),new k(d.initializeOnly,"initialValue",new $n.SFColor(.8,.8,.8)),new k(d.initializeOnly,"initialDestination",new $n.SFColor(.8,.8,.8)),new k(d.initializeOnly,"order",new $n.SFInt32(3)),new k(d.inputOutput,"tau",new $n.SFTime(.3)),new k(d.inputOutput,"tolerance",new $n.SFFloat(-1)),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"value_changed",new $n.SFColor)]),enumerable:!0}});const qd=Hd;i.add("ColorDamper","x_ite/Components/Followers/ColorDamper",qd);const Yd=qd;const Wd=function(e){function t(){this.array=this.getArray(),this.zero=this.getVector()}return Object.assign(t.prototype,{getArray(){const e=[];return e.assign=function(e){if(Array.isArray(e)){for(var t=0,i=Math.min(this.length,e.length);t<i;++t)this[t].assign(e[t]);for(t=i,i=e.length;t<i;++t)this[t]=e[t].copy();this.length=i}else{for(t=0,i=Math.min(this.length,e.length);t<i;++t)this[t].assign(e[t].getValue());for(t=i,i=e.length;t<i;++t)this[t]=e[t].getValue().copy();this.length=i}},e},getValue(){return this._set_value},getDestination(){return this._set_destination},getInitialValue(){return this._initialValue},getInitialDestination(){return this._initialDestination},setValue(e){if(Array.isArray(e)){const n=this._value_changed;for(var t=0,i=e.length;t<i;++t)n[t]=e[t];n.length=i}else this._value_changed=e},duplicate(e){const t=this.getArray();return t.assign(e),t},equals(e,t,i){if(e.length!==t.length)return!1;const n=this.a;let r=0;for(let i=0,s=e.length;i<s;++i)r=Math.max(n.assign(e[i]).subtract(t[i]).magnitude());return r<i},interpolate(e,t,i){const n=this.array;n.assign(e);for(let e=0,r=n.length;e<r;++e)n[e].lerp(t[e]||this.zero,i);return n},set_destination__(){const t=this.getBuffer(),i=this._set_destination.length;for(let e=0,n=t.length;e<n;++e){const n=t[e];for(let e=n.length;e<i;++e)n[e]=this.getVector();n.length=i}e.prototype.set_destination__.call(this)}}),t};i.add("X3DArrayFollowerTemplate","x_ite/Browser/Followers/X3DArrayFollowerTemplate",Wd);const $d=Wd;const Jd=function(e){const t=$d(e);function i(){t.call(this),this.array=this.getArray()}return Object.assign(i.prototype,t.prototype,{step(e,t,i){const n=this.output,r=this.deltaOut;for(let s=0,o=n.length;s<o;++s)n[s].add(r.assign(e[s]||this.zero).subtract(t[s]||this.zero).multiply(i))}}),i};i.add("X3DArrayChaserTemplate","x_ite/Browser/Followers/X3DArrayChaserTemplate",Jd);const Kd=Jd;var Zd=Kd(Fd);function Qd(e){Fd.call(this,e),Zd.call(this,e),this.addType(d.CoordinateChaser)}Object.assign(Object.setPrototypeOf(Qd.prototype,Fd.prototype),Zd.prototype,{getVector:()=>new Tt(0,0,0)}),Object.defineProperties(Qd,{typeName:{value:"CoordinateChaser",enumerable:!0},componentInfo:{value:Object.freeze({name:"Followers",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.3",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_value",new $n.MFVec3f),new k(d.inputOnly,"set_destination",new $n.MFVec3f),new k(d.initializeOnly,"initialValue",new $n.MFVec3f(new Tt(0,0,0))),new k(d.initializeOnly,"initialDestination",new $n.MFVec3f(new Tt(0,0,0))),new k(d.initializeOnly,"duration",new $n.SFTime(1)),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"value_changed",new $n.MFVec3f)]),enumerable:!0}});const ec=Qd;i.add("CoordinateChaser","x_ite/Components/Followers/CoordinateChaser",ec);const tc=ec;var ic=$d(Xd);function nc(e){Xd.call(this,e),ic.call(this,e),this.addType(d.CoordinateDamper)}Object.assign(Object.setPrototypeOf(nc.prototype,Xd.prototype),ic.prototype,{getVector:()=>new Tt(0,0,0)}),Object.defineProperties(nc,{typeName:{value:"CoordinateDamper",enumerable:!0},componentInfo:{value:Object.freeze({name:"Followers",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.2",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_value",new $n.MFVec3f),new k(d.inputOnly,"set_destination",new $n.MFVec3f),new k(d.initializeOnly,"initialValue",new $n.MFVec3f(new Tt(0,0,0))),new k(d.initializeOnly,"initialDestination",new $n.MFVec3f(new Tt(0,0,0))),new k(d.initializeOnly,"order",new $n.SFInt32(3)),new k(d.inputOutput,"tau",new $n.SFTime(.3)),new k(d.inputOutput,"tolerance",new $n.SFFloat(-1)),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"value_changed",new $n.MFVec3f)]),enumerable:!0}});const rc=nc;i.add("CoordinateDamper","x_ite/Components/Followers/CoordinateDamper",rc);const sc=rc;var oc=new ui,ac=new ui;function lc(e){Fd.call(this,e),this.addType(d.OrientationChaser),this._set_value.setUnit("angle"),this._set_destination.setUnit("angle"),this._initialValue.setUnit("angle"),this._initialDestination.setUnit("angle"),this._value_changed.setUnit("angle")}Object.assign(Object.setPrototypeOf(lc.prototype,Fd.prototype),{getVector:()=>new ui,equals:(e,t,i)=>(oc.assign(e).inverse().multRight(t),Math.abs(oc.angle)<i),interpolate:(e,t,i)=>ac.assign(e).slerp(t,i),step(e,t,i){this.deltaOut.assign(t).inverse().multRight(e).multLeft(this.output),this.output.slerp(this.deltaOut,i)}}),Object.defineProperties(lc,{typeName:{value:"OrientationChaser",enumerable:!0},componentInfo:{value:Object.freeze({name:"Followers",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.2",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_value",new $n.SFRotation),new k(d.inputOnly,"set_destination",new $n.SFRotation),new k(d.initializeOnly,"initialValue",new $n.SFRotation(0,1,0,0)),new k(d.initializeOnly,"initialDestination",new $n.SFRotation(0,1,0,0)),new k(d.initializeOnly,"duration",new $n.SFTime(1)),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"value_changed",new $n.SFRotation)]),enumerable:!0}});const uc=lc;i.add("OrientationChaser","x_ite/Components/Followers/OrientationChaser",uc);const hc=uc;var dc=new ui,cc=new ui;function pc(e){Xd.call(this,e),this.addType(d.OrientationDamper),this._set_value.setUnit("angle"),this._set_destination.setUnit("angle"),this._initialValue.setUnit("angle"),this._initialDestination.setUnit("angle"),this._value_changed.setUnit("angle")}Object.assign(Object.setPrototypeOf(pc.prototype,Xd.prototype),{getVector:()=>new ui,equals:(e,t,i)=>(dc.assign(e).inverse().multRight(t),Math.abs(dc.angle)<i),interpolate:(e,t,i)=>cc.assign(e).slerp(t,i)}),Object.defineProperties(pc,{typeName:{value:"OrientationDamper",enumerable:!0},componentInfo:{value:Object.freeze({name:"Followers",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.2",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_value",new $n.SFRotation),new k(d.inputOnly,"set_destination",new $n.SFRotation),new k(d.initializeOnly,"initialValue",new $n.SFRotation(0,1,0,0)),new k(d.initializeOnly,"initialDestination",new $n.SFRotation(0,1,0,0)),new k(d.initializeOnly,"order",new $n.SFInt32(3)),new k(d.inputOutput,"tau",new $n.SFTime(.3)),new k(d.inputOutput,"tolerance",new $n.SFFloat(-1)),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"value_changed",new $n.SFRotation)]),enumerable:!0}});const gc=pc;i.add("OrientationDamper","x_ite/Components/Followers/OrientationDamper",gc);const fc=gc;function mc(e){Fd.call(this,e),this.addType(d.PositionChaser)}Object.assign(Object.setPrototypeOf(mc.prototype,Fd.prototype),{getVector:()=>new Tt(0,0,0)}),Object.defineProperties(mc,{typeName:{value:"PositionChaser",enumerable:!0},componentInfo:{value:Object.freeze({name:"Followers",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.2",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_value",new $n.SFVec3f),new k(d.inputOnly,"set_destination",new $n.SFVec3f),new k(d.initializeOnly,"initialValue",new $n.SFVec3f),new k(d.initializeOnly,"initialDestination",new $n.SFVec3f),new k(d.initializeOnly,"duration",new $n.SFTime(1)),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"value_changed",new $n.SFVec3f)]),enumerable:!0}});const _c=mc;i.add("PositionChaser","x_ite/Components/Followers/PositionChaser",_c);const xc=_c;function yc(e){Fd.call(this,e),this.addType(d.PositionChaser2D)}Object.assign(Object.setPrototypeOf(yc.prototype,Fd.prototype),{getVector:()=>new _t(0,0)}),Object.defineProperties(yc,{typeName:{value:"PositionChaser2D",enumerable:!0},componentInfo:{value:Object.freeze({name:"Followers",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.2",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_value",new $n.SFVec2f),new k(d.inputOnly,"set_destination",new $n.SFVec2f),new k(d.initializeOnly,"initialValue",new $n.SFVec2f),new k(d.initializeOnly,"initialDestination",new $n.SFVec2f),new k(d.initializeOnly,"duration",new $n.SFTime(1)),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"value_changed",new $n.SFVec2f)]),enumerable:!0}});const wc=yc;i.add("PositionChaser2D","x_ite/Components/Followers/PositionChaser2D",wc);const bc=wc;function Sc(e){Xd.call(this,e),this.addType(d.PositionDamper)}Object.assign(Object.setPrototypeOf(Sc.prototype,Xd.prototype),{getVector:()=>new Tt(0,0,0)}),Object.defineProperties(Sc,{typeName:{value:"PositionDamper",enumerable:!0},componentInfo:{value:Object.freeze({name:"Followers",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.2",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_value",new $n.SFVec3f),new k(d.inputOnly,"set_destination",new $n.SFVec3f),new k(d.initializeOnly,"initialValue",new $n.SFVec3f),new k(d.initializeOnly,"initialDestination",new $n.SFVec3f),new k(d.initializeOnly,"order",new $n.SFInt32(3)),new k(d.inputOutput,"tolerance",new $n.SFFloat(-1)),new k(d.inputOutput,"tau",new $n.SFTime(.3)),new k(d.outputOnly,"value_changed",new $n.SFVec3f),new k(d.outputOnly,"isActive",new $n.SFBool)]),enumerable:!0}});const Tc=Sc;i.add("PositionDamper","x_ite/Components/Followers/PositionDamper",Tc);const vc=Tc;function Oc(e){Xd.call(this,e),this.addType(d.PositionDamper2D)}Object.assign(Object.setPrototypeOf(Oc.prototype,Xd.prototype),{getVector:()=>new _t(0,0)}),Object.defineProperties(Oc,{typeName:{value:"PositionDamper2D",enumerable:!0},componentInfo:{value:Object.freeze({name:"Followers",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.2",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_value",new $n.SFVec2f),new k(d.inputOnly,"set_destination",new $n.SFVec2f),new k(d.initializeOnly,"initialValue",new $n.SFVec2f),new k(d.initializeOnly,"initialDestination",new $n.SFVec2f),new k(d.initializeOnly,"order",new $n.SFInt32(3)),new k(d.inputOutput,"tau",new $n.SFTime(.3)),new k(d.inputOutput,"tolerance",new $n.SFFloat(-1)),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"value_changed",new $n.SFVec2f)]),enumerable:!0}});const Ec=Oc;i.add("PositionDamper2D","x_ite/Components/Followers/PositionDamper2D",Ec);const Cc=Ec;function Nc(e){Fd.call(this,e),this.addType(d.ScalarChaser)}Object.assign(Object.setPrototypeOf(Nc.prototype,Fd.prototype),{getVector:()=>0,setPreviousValue(e){this.previousValue=e},setDestination(e){this.destination=e},duplicate:e=>e,assign(e,t,i){e[t]=i},equals:(e,t,i)=>Math.abs(e-t)<i,interpolate:(e,t,i)=>g.lerp(e,t,i),step(e,t,i){this.output+=(e-t)*i}}),Object.defineProperties(Nc,{typeName:{value:"ScalarChaser",enumerable:!0},componentInfo:{value:Object.freeze({name:"Followers",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.2",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_value",new $n.SFFloat),new k(d.inputOnly,"set_destination",new $n.SFFloat),new k(d.initializeOnly,"initialValue",new $n.SFFloat),new k(d.initializeOnly,"initialDestination",new $n.SFFloat),new k(d.initializeOnly,"duration",new $n.SFTime(1)),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"value_changed",new $n.SFFloat)]),enumerable:!0}});const Ic=Nc;i.add("ScalarChaser","x_ite/Components/Followers/ScalarChaser",Ic);const Fc=Ic;function Mc(e){Xd.call(this,e),this.addType(d.ScalarDamper)}Object.assign(Object.setPrototypeOf(Mc.prototype,Xd.prototype),{getVector:()=>0,duplicate:e=>e,assign(e,t,i){e[t]=i},equals:(e,t,i)=>Math.abs(e-t)<i,interpolate:(e,t,i)=>g.lerp(e,t,i)}),Object.defineProperties(Mc,{typeName:{value:"ScalarDamper",enumerable:!0},componentInfo:{value:Object.freeze({name:"Followers",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.3",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_value",new $n.SFFloat),new k(d.inputOnly,"set_destination",new $n.SFFloat),new k(d.initializeOnly,"initialValue",new $n.SFFloat),new k(d.initializeOnly,"initialDestination",new $n.SFFloat),new k(d.initializeOnly,"order",new $n.SFInt32(3)),new k(d.inputOutput,"tau",new $n.SFTime(.3)),new k(d.inputOutput,"tolerance",new $n.SFFloat(-1)),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"value_changed",new $n.SFFloat)]),enumerable:!0}});const Dc=Mc;i.add("ScalarDamper","x_ite/Components/Followers/ScalarDamper",Dc);const Rc=Dc;var Pc=Kd(Fd);function Ac(e){Fd.call(this,e),Pc.call(this,e),this.addType(d.TexCoordChaser2D)}Object.assign(Object.setPrototypeOf(Ac.prototype,Fd.prototype),Pc.prototype,{getVector:()=>new _t(0,0)}),Object.defineProperties(Ac,{typeName:{value:"TexCoordChaser2D",enumerable:!0},componentInfo:{value:Object.freeze({name:"Followers",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.3",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_value",new $n.MFVec2f),new k(d.inputOnly,"set_destination",new $n.MFVec2f),new k(d.initializeOnly,"initialValue",new $n.MFVec2f),new k(d.initializeOnly,"initialDestination",new $n.MFVec2f),new k(d.initializeOnly,"duration",new $n.SFTime(1)),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"value_changed",new $n.MFVec2f)]),enumerable:!0}});const Vc=Ac;i.add("TexCoordChaser2D","x_ite/Components/Followers/TexCoordChaser2D",Vc);const Lc=Vc;var Bc=$d(Xd);function Uc(e){Xd.call(this,e),Bc.call(this,e),this.addType(d.TexCoordDamper2D)}Object.assign(Object.setPrototypeOf(Uc.prototype,Xd.prototype),Bc.prototype,{getVector:()=>new _t(0,0,0)}),Object.defineProperties(Uc,{typeName:{value:"TexCoordDamper2D",enumerable:!0},componentInfo:{value:Object.freeze({name:"Followers",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.2",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_value",new $n.MFVec2f),new k(d.inputOnly,"set_destination",new $n.MFVec2f),new k(d.initializeOnly,"initialValue",new $n.MFVec2f),new k(d.initializeOnly,"initialDestination",new $n.MFVec2f),new k(d.initializeOnly,"order",new $n.SFInt32(3)),new k(d.inputOutput,"tau",new $n.SFTime(.3)),new k(d.inputOutput,"tolerance",new $n.SFFloat(-1)),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"value_changed",new $n.MFVec2f)]),enumerable:!0}});const Xc=Uc;i.add("TexCoordDamper2D","x_ite/Components/Followers/TexCoordDamper2D",Xc);const jc={name:"Followers",concreteNodes:[Ld,Yd,tc,sc,hc,fc,xc,bc,vc,Cc,Fc,Rc,Lc,Xc],abstractNodes:[Fd,Xd,Cd]};i.add("Followers","x_ite/Components/Followers",jc);const kc=jc;function zc(e){Il.call(this,e),this.addType(d.Box),this._size.setUnit("length")}Object.assign(Object.setPrototypeOf(zc.prototype,Il.prototype),{build:(()=>{const e=new Tt(2,2,2);return function(){const t=this.getBrowser().getBoxOptions().getGeometry(),i=this._size.getValue();if(this.setMultiTexCoords(t.getMultiTexCoords()),this.setNormals(t.getNormals()),i.equals(e))this.setVertices(t.getVertices()),this.getMin().assign(t.getMin()),this.getMax().assign(t.getMax());else{const e=Math.abs(i.x/2),n=Math.abs(i.y/2),r=Math.abs(i.z/2),s=t.getVertices().getValue(),o=this.getVertices();for(let t=0,i=s.length;t<i;t+=4)o.push(e*s[t],n*s[t+1],r*s[t+2],1);this.getMin().set(-e,-n,-r),this.getMax().set(e,n,r)}this.setSolid(this._solid.getValue())}})()}),Object.defineProperties(zc,{typeName:{value:"Box",enumerable:!0},componentInfo:{value:Object.freeze({name:"Geometry3D",level:1}),enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.initializeOnly,"size",new $n.SFVec3f(2,2,2)),new k(d.initializeOnly,"solid",new $n.SFBool(!0))]),enumerable:!0}});const Gc=zc;i.add("Box","x_ite/Components/Geometry3D/Box",Gc);const Hc=Gc;function qc(e){Il.call(this,e),this.addType(d.Cone),this._height.setUnit("length"),this._bottomRadius.setUnit("length")}Object.assign(Object.setPrototypeOf(qc.prototype,Il.prototype),{set_live__(){Il.prototype.set_live__.call(this),this.getLive().getValue()?this.getBrowser().getConeOptions().addInterest("requestRebuild",this):this.getBrowser().getConeOptions().removeInterest("requestRebuild",this)},build(){const e=this.getBrowser().getConeOptions()._xDimension.getValue(),t=this._height.getValue(),i=this._bottomRadius.getValue(),n=this.getTexCoords(),r=this.getNormals(),s=this.getVertices();this.getMultiTexCoords().push(n);const o=t/2,a=-o,l=Lo.Polar(1,-Math.PI/2+Math.atan(i/t));if(this._side.getValue())for(let t=0;t<e;++t){const u=(t+.5)/e,h=2*Math.PI*u,d=Lo.Polar(l.imag,h),c=t/e,p=2*Math.PI*c,g=Lo.Polar(-i,p),f=Lo.Polar(l.imag,p),m=(t+1)/e,_=2*Math.PI*m,x=Lo.Polar(-i,_),y=Lo.Polar(l.imag,_);n.push(u,1,0,1),r.push(d.imag,l.real,d.real),s.push(0,o,0,1),n.push(c,0,0,1),r.push(f.imag,l.real,f.real),s.push(g.imag,a,g.real,1),n.push(m,0,0,1),r.push(y.imag,l.real,y.real),s.push(x.imag,a,x.real,1)}if(this._bottom.getValue()){const t=[],o=[];for(let n=e-1;n>-1;--n){const r=n/e,s=2*Math.PI*r,l=Lo.Polar(-1,s),u=l.copy().multiply(i);t.push(new _t((l.imag+1)/2,(l.real+1)/2)),o.push(new Tt(u.imag,a,u.real))}const l=t[0],u=o[0];for(let e=1,i=o.length-1;e<i;++e){const i=t[e],a=t[e+1],h=o[e],d=o[e+1];n.push(l.x,l.y,0,1),r.push(0,-1,0),s.push(u.x,u.y,u.z,1),n.push(i.x,i.y,0,1),r.push(0,-1,0),s.push(h.x,h.y,h.z,1),n.push(a.x,a.y,0,1),r.push(0,-1,0),s.push(d.x,d.y,d.z,1)}}this.setSolid(this._solid.getValue()),this.setExtents()},setExtents(){const e=this._bottomRadius.getValue(),t=this._height.getValue()/2,i=-t;this._side.getValue()||this._bottom.getValue()?this._side.getValue()?(this.getMin().set(-e,i,-e),this.getMax().set(e,t,e)):(this.getMin().set(-e,i,-e),this.getMax().set(e,i,e)):(this.getMin().set(0,0,0),this.getMax().set(0,0,0))}}),Object.defineProperties(qc,{typeName:{value:"Cone",enumerable:!0},componentInfo:{value:Object.freeze({name:"Geometry3D",level:1}),enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"side",new $n.SFBool(!0)),new k(d.inputOutput,"bottom",new $n.SFBool(!0)),new k(d.initializeOnly,"height",new $n.SFFloat(2)),new k(d.initializeOnly,"bottomRadius",new $n.SFFloat(1)),new k(d.initializeOnly,"solid",new $n.SFBool(!0))]),enumerable:!0}});const Yc=qc;i.add("Cone","x_ite/Components/Geometry3D/Cone",Yc);const Wc=Yc;function $c(e){Il.call(this,e),this.addType(d.Cylinder),this._height.setUnit("length"),this._radius.setUnit("length")}Object.assign(Object.setPrototypeOf($c.prototype,Il.prototype),{set_live__(){Il.prototype.set_live__.call(this),this.getLive().getValue()?this.getBrowser().getCylinderOptions().addInterest("requestRebuild",this):this.getBrowser().getCylinderOptions().removeInterest("requestRebuild",this)},build(){const e=this.getBrowser().getCylinderOptions()._xDimension.getValue(),t=this.getTexCoords(),i=this.getNormals(),n=this.getVertices();this.getMultiTexCoords().push(t);const r=this._radius.getValue(),s=this._height.getValue()/2,o=-s;if(this._side.getValue())for(let a=0;a<e;++a){const l=a/e,u=2*Math.PI*l,h=Lo.Polar(-1,u),d=h.copy().multiply(r),c=(a+1)/e,p=2*Math.PI*c,g=Lo.Polar(-1,p),f=g.copy().multiply(r);t.push(l,1,0,1),i.push(h.imag,0,h.real),n.push(d.imag,s,d.real,1),t.push(l,0,0,1),i.push(h.imag,0,h.real),n.push(d.imag,o,d.real,1),t.push(c,0,0,1),i.push(g.imag,0,g.real),n.push(f.imag,o,f.real,1),t.push(l,1,0,1),i.push(h.imag,0,h.real),n.push(d.imag,s,d.real,1),t.push(c,0,0,1),i.push(g.imag,0,g.real),n.push(f.imag,o,f.real,1),t.push(c,1,0,1),i.push(g.imag,0,g.real),n.push(f.imag,s,f.real,1)}if(this._top.getValue()){const o=[],a=[];for(let t=0;t<e;++t){const i=t/e,n=2*Math.PI*i,l=Lo.Polar(-1,n);o.push(new _t((l.imag+1)/2,-(l.real-1)/2)),a.push(new Tt(l.imag*r,s,l.real*r))}const l=o[0],u=a[0];for(let e=1,r=a.length-1;e<r;++e){const r=o[e],s=o[e+1],h=a[e],d=a[e+1];t.push(l.x,l.y,0,1),i.push(0,1,0),n.push(u.x,u.y,u.z,1),t.push(r.x,r.y,0,1),i.push(0,1,0),n.push(h.x,h.y,h.z,1),t.push(s.x,s.y,0,1),i.push(0,1,0),n.push(d.x,d.y,d.z,1)}}if(this._bottom.getValue()){const s=[],a=[];for(let t=e-1;t>-1;--t){const i=t/e,n=2*Math.PI*i,l=Lo.Polar(-1,n);s.push(new _t((l.imag+1)/2,(l.real+1)/2)),a.push(new Tt(l.imag*r,o,l.real*r))}const l=s[0],u=a[0];for(let e=1,r=a.length-1;e<r;++e){const r=s[e],o=s[e+1],h=a[e],d=a[e+1];t.push(l.x,l.y,0,1),i.push(0,-1,0),n.push(u.x,u.y,u.z,1),t.push(r.x,r.y,0,1),i.push(0,-1,0),n.push(h.x,h.y,h.z,1),t.push(o.x,o.y,0,1),i.push(0,-1,0),n.push(d.x,d.y,d.z,1)}}this.setSolid(this._solid.getValue()),this.setExtents()},setExtents(){const e=this._radius.getValue(),t=this._height.getValue()/2,i=-t;this._top.getValue()||this._side.getValue()||this._bottom.getValue()?this._top.getValue()||this._side.getValue()?this._bottom.getValue()||this._side.getValue()?(this.getMin().set(-e,i,-e),this.getMax().set(e,t,e)):(this.getMin().set(-e,t,-e),this.getMax().set(e,t,e)):(this.getMin().set(-e,i,-e),this.getMax().set(e,i,e)):(this.getMin().set(0,0,0),this.getMax().set(0,0,0))}}),Object.defineProperties($c,{typeName:{value:"Cylinder",enumerable:!0},componentInfo:{value:Object.freeze({name:"Geometry3D",level:1}),enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"top",new $n.SFBool(!0)),new k(d.inputOutput,"side",new $n.SFBool(!0)),new k(d.inputOutput,"bottom",new $n.SFBool(!0)),new k(d.initializeOnly,"height",new $n.SFFloat(2)),new k(d.initializeOnly,"radius",new $n.SFFloat(1)),new k(d.initializeOnly,"solid",new $n.SFBool(!0))]),enumerable:!0}});const Jc=$c;i.add("Cylinder","x_ite/Components/Geometry3D/Cylinder",Jc);const Kc=Jc;function Zc(e){Il.call(this,e),this.addType(d.ElevationGrid),this._set_height.setUnit("length"),this._xSpacing.setUnit("length"),this._zSpacing.setUnit("length"),this._creaseAngle.setUnit("angle"),this._height.setUnit("length"),this.fogCoordNode=null,this.colorNode=null,this.texCoordNode=null,this.normalNode=null,this.coordNode=null}Object.assign(Object.setPrototypeOf(Zc.prototype,Il.prototype),{initialize(){Il.prototype.initialize.call(this),this._set_height.addFieldInterest(this._height),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._texCoord.addInterest("set_texCoord__",this),this._normal.addInterest("set_normal__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_texCoord__(),this.set_normal__()},set_attrib__(){const e=this.getAttrib();for(const t of e)t.removeInterest("requestRebuild",this),t._attribute_changed.removeInterest("updateVertexArrays",this);e.length=0;for(const t of this._attrib){const i=Yl(d.X3DVertexAttributeNode,t);i&&e.push(i)}for(const t of e)t.addInterest("requestRebuild",this),t._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__(){this.fogCoordNode?.removeInterest("requestRebuild",this),this.fogCoordNode=Yl(d.FogCoordinate,this._fogCoord),this.fogCoordNode?.addInterest("requestRebuild",this)},set_color__(){this.colorNode?.removeInterest("requestRebuild",this),this.colorNode=Yl(d.X3DColorNode,this._color),this.colorNode?.addInterest("requestRebuild",this),this.setTransparent(this.colorNode?.isTransparent()??!1)},set_texCoord__(){this.texCoordNode?.removeInterest("requestRebuild",this),this.texCoordNode=Yl(d.X3DTextureCoordinateNode,this._texCoord),this.texCoordNode?.addInterest("requestRebuild",this),this.setTextureCoordinate(this.texCoordNode)},set_normal__(){this.normalNode?.removeInterest("requestRebuild",this),this.normalNode=Yl(d.X3DNormalNode,this._normal),this.normalNode?.addInterest("requestRebuild",this)},getColor(){return this.colorNode},getTexCoord(){return this.texCoordNode},getNormal(){return this.normalNode},getHeight(e){return e<this._height.length?this._height[e]:0},createTexCoords(){const e=[],t=this._xDimension.getValue(),i=this._zDimension.getValue(),n=t-1,r=i-1;for(let s=0;s<i;++s)for(let i=0;i<t;++i)e.push(new _t(i/n,s/r));return e},createNormals(e,t,i){const n=!this._ccw.getValue(),r=new Map,s=[];for(let t=0,i=e.length;t<i;++t)r.set(t,[]);for(let i=0,o=t.length;i<o;i+=3){const o=t[i],a=t[i+1],l=t[i+2];r.get(o).push(s.length),r.get(a).push(s.length+1),r.get(l).push(s.length+2);const u=fa.normal(e[o],e[a],e[l],new Tt(0,0,0));n&&u.negate(),s.push(u),s.push(u),s.push(u)}return this._normalPerVertex.getValue()?this.refineNormals(r,s,this._creaseAngle.getValue()):s},createCoordIndex(){const e=[],t=this._xDimension.getValue(),i=t-1,n=this._zDimension.getValue()-1;for(let r=0;r<n;++r)for(let n=0;n<i;++n){const i=r*t+n,s=(r+1)*t+n,o=(r+1)*t+(n+1),a=r*t+(n+1);e.push(i),e.push(s),e.push(o),e.push(i),e.push(o),e.push(a)}return e},createPoints(){const e=[],t=this._xDimension.getValue(),i=this._zDimension.getValue(),n=this._xSpacing.getValue(),r=this._zSpacing.getValue();for(let s=0;s<i;++s)for(let i=0;i<t;++i)e.push(new Tt(n*i,this.getHeight(i+s*t),r*s));return e},build(){if(this._xDimension.getValue()<2||this._zDimension.getValue()<2)return;const e=this._colorPerVertex.getValue(),t=this._normalPerVertex.getValue(),i=this.createCoordIndex(),n=this.getCoordIndices(),r=this.getAttrib(),s=r.length,o=this.getAttribs(),a=this.fogCoordNode,l=this.getColor(),u=this.getTexCoord(),h=this.getNormal(),d=this.createPoints(),c=this.getFogDepths(),p=this.getColors(),g=this.getMultiTexCoords(),f=this.getNormals(),m=this.getVertices();let _=0;if(u)u.init(g);else{var x=this.createTexCoords(),y=this.getTexCoords();g.push(y)}for(let w=0,b=i.length;w<b;++_)for(let b=0;b<6;++b,++w){const b=i[w],S=d[b];n.push(b);for(let e=0;e<s;++e)r[e].addValue(b,o[e]);if(a?.addDepth(b,c),l&&(e?l.addColor(b,p):l.addColor(_,p)),u)u.addPoint(b,g);else{const e=x[b];y.push(e.x,e.y,0,1)}h&&(t?h.addVector(b,f):h.addVector(_,f)),m.push(S.x,S.y,S.z,1)}if(!h){const e=this.createNormals(d,i);for(const t of e)f.push(t.x,t.y,t.z)}this.setSolid(this._solid.getValue()),this.setCCW(this._ccw.getValue())}}),Object.defineProperties(Zc,{typeName:{value:"ElevationGrid",enumerable:!0},componentInfo:{value:Object.freeze({name:"Geometry3D",level:3}),enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_height",new $n.MFFloat),new k(d.initializeOnly,"xDimension",new $n.SFInt32),new k(d.initializeOnly,"zDimension",new $n.SFInt32),new k(d.initializeOnly,"xSpacing",new $n.SFFloat(1)),new k(d.initializeOnly,"zSpacing",new $n.SFFloat(1)),new k(d.initializeOnly,"solid",new $n.SFBool(!0)),new k(d.initializeOnly,"ccw",new $n.SFBool(!0)),new k(d.initializeOnly,"creaseAngle",new $n.SFFloat),new k(d.initializeOnly,"colorPerVertex",new $n.SFBool(!0)),new k(d.initializeOnly,"normalPerVertex",new $n.SFBool(!0)),new k(d.inputOutput,"attrib",new $n.MFNode),new k(d.inputOutput,"fogCoord",new $n.SFNode),new k(d.inputOutput,"color",new $n.SFNode),new k(d.inputOutput,"texCoord",new $n.SFNode),new k(d.inputOutput,"normal",new $n.SFNode),new k(d.initializeOnly,"height",new $n.MFFloat)]),enumerable:!0}});const Qc=Zc;i.add("ElevationGrid","x_ite/Components/Geometry3D/ElevationGrid",Qc);const ep=Qc;function tp(e){Il.call(this,e),this.addType(d.Extrusion),this._creaseAngle.setUnit("angle"),this._crossSection.setUnit("length"),this._spine.setUnit("length")}Object.assign(Object.setPrototypeOf(tp.prototype,Il.prototype),{initialize(){Il.prototype.initialize.call(this),this._set_crossSection.addFieldInterest(this._crossSection),this._set_orientation.addFieldInterest(this._orientation),this._set_scale.addFieldInterest(this._scale),this._set_spine.addFieldInterest(this._spine)},getClosedOrientation(){const e=this._orientation;if(e.length){const t=e[0].getValue(),i=e[e.length-1].getValue();return t.equals(i)}return!0},createPoints:(()=>{const e=new Tt(1,1,1);return function(){const t=this._crossSection,i=this._orientation,n=this._scale,r=this._spine,s=[],o=this.createRotations();for(let a=0,l=r.length;a<l;++a){const r=o[a];if(i.length&&r.rotate(i[Math.min(a,i.length-1)].getValue()),n.length){const t=n[Math.min(a,n.length-1)].getValue();r.scale(e.set(t.x,1,t.y))}for(let e=0,i=t.length;e<i;++e){const i=t[e].getValue();s.push(r.multVecMatrix(new Tt(i.x,0,i.y)))}}return s}})(),createRotations:(()=>{const e=[],t=new Tt(0,0,0),i=new Tt(0,0,0),n=new Tt(0,0,0),r=new Tt(0,0,0),s=new Tt(0,0,0),o=new Tt(0,0,0),a=new ui;return function(){const l=this._spine,u=l.length,h=l[0].getValue(),d=l[l.length-1].getValue(),c=h.equals(d)&&this.getClosedOrientation();for(let t=e.length;t<u;++t)e[t]=new gi;if(e.length=u,t.set(0,0,0),i.set(0,0,0),n.set(0,0,0),c){const e=h;for(let t=1,n=u-2;t<n&&(i.assign(l[t].getValue()).subtract(e).normalize().subtract(o.assign(l[n].getValue()).subtract(e).normalize()).normalize(),i.equals(Tt.Zero));++t);for(let e=0,t=u-2;e<t&&(n.assign(l[e+1].getValue()).subtract(l[e].getValue()).cross(o.assign(l[t].getValue()).subtract(l[e].getValue())).normalize(),n.equals(Tt.Zero));++e);}else{for(let e=0,t=u-1;e<t&&(i.assign(l[e+1].getValue()).subtract(l[e].getValue()).normalize(),i.equals(Tt.Zero));++e);for(let e=1,t=u-1;e<t&&(n.assign(l[e+1].getValue()).subtract(l[e].getValue()).cross(o.assign(l[e-1].getValue()).subtract(l[e].getValue())).normalize(),n.equals(Tt.Zero));++e);}i.equals(Tt.Zero)&&i.set(0,1,0),n.equals(Tt.Zero)&&a.setFromToVec(Tt.yAxis,i).multVecRot(n.assign(Tt.zAxis)),t.assign(i).cross(n);const p=h;e[0].set(t.x,t.y,t.z,0,i.x,i.y,i.z,0,n.x,n.y,n.z,0,p.x,p.y,p.z,1),r.assign(i),s.assign(n);for(let a=1,h=u-1;a<h;++a){const u=l[a].getValue();i.assign(l[a+1].getValue()).subtract(u).normalize().subtract(o.assign(l[a-1].getValue()).subtract(u).normalize()).normalize(),n.assign(l[a+1].getValue()).subtract(u).cross(o.assign(l[a-1].getValue()).subtract(u)).normalize(),s.dot(n)<0&&n.negate(),i.equals(Tt.Zero)?i.assign(r):r.assign(i),n.equals(Tt.Zero)?n.assign(s):s.assign(n),t.assign(i).cross(n),e[a].set(t.x,t.y,t.z,0,i.x,i.y,i.z,0,n.x,n.y,n.z,0,u.x,u.y,u.z,1)}if(c)e[u-1].assign(e[0]);else{const a=d;i.assign(a).subtract(l[u-2].getValue()).normalize(),u>2&&n.assign(a).subtract(l[u-2].getValue()).cross(o.assign(l[u-3].getValue()).subtract(l[u-2].getValue())).normalize(),s.dot(n)<0&&n.negate(),i.equals(Tt.Zero)&&i.assign(r),n.equals(Tt.Zero)&&n.assign(s),t.assign(i).cross(n),e[u-1].set(t.x,t.y,t.z,0,i.x,i.y,i.z,0,n.x,n.y,n.z,0,a.x,a.y,a.z,1)}return e}})(),build:(()=>{const e=new _t(0,0,0),t=new _t(0,0,0),i=new _t(0,0,0);return function(){const n=!this._ccw.getValue(),r=this._crossSection,s=this._spine,o=s.length,a=this.getCoordIndices(),l=this.getTexCoords();if(o<2||r.length<2)return;this.getMultiTexCoords().push(l);const u=r.length;function h(e,t){return e*u+t}const d=s[0].getValue(),c=s[o-1].getValue(),p=d.equals(c)&&this.getClosedOrientation(),g=r[0].getValue(),f=r[r.length-1].getValue(),m=g.equals(f);e.assign(r[0].getValue()),t.assign(r[0].getValue());for(let i=1,n=r.length;i<n;++i)e.min(r[i].getValue()),t.max(r[i].getValue());const _=i.assign(t).subtract(e),x=Math.max(_.x,_.y),y=m?r.length-1:r.length,w=new Map,b=[],S=this.createPoints();for(let e=0,t=S.length;e<t;++e)w.set(e,[]);const T=this.getNormals(),v=this.getVertices(),O=r.length-1,E=o-1;let C=h(0,0),N=h(0,m?0:O);for(let e=0;e<E;++e)for(let t=0;t<O;++t){const i=p&&e===o-2?0:e+1,s=m&&t===r.length-2?0:t+1;let u=h(e,t),d=h(e,s),c=h(i,s),g=h(i,t),f=S[u],_=S[d],x=S[c],y=S[g],T=_.distance(x)>=1e-7,M=y.distance(f)>=1e-7;if(n)var I=fa.normal(x,_,f,new Tt(0,0,0)),F=fa.normal(y,x,f,new Tt(0,0,0));else I=fa.normal(f,_,x,new Tt(0,0,0)),F=fa.normal(f,x,y,new Tt(0,0,0));if(0==t&&(M?C=u:(u=C,f=S[u])),t==r.length-2&&(T?N=d:(c=N,x=S[c])),T){if(a.push(u,d,c),M)l.push(t/O,e/E,0,1);else{const i=(e/E+(e+1)/E)/2;l.push(t/O,i,0,1)}w.get(u).push(b.length),b.push(I),v.push(f.x,f.y,f.z,1),l.push((t+1)/O,e/E,0,1),w.get(d).push(b.length),b.push(I),v.push(_.x,_.y,_.z,1),l.push((t+1)/O,(e+1)/E,0,1),w.get(c).push(b.length),b.push(I),v.push(x.x,x.y,x.z,1)}if(M){if(a.push(u,c,g),l.push(t/O,e/E,0,1),w.get(u).push(b.length),b.push(F),v.push(f.x,f.y,f.z,1),T)l.push((t+1)/O,(e+1)/E,0,1);else{const i=((e+1)/E+e/E)/2;l.push((t+1)/O,i,0,1)}w.get(c).push(b.length),b.push(F),v.push(x.x,x.y,x.z,1),l.push(t/O,(e+1)/E,0,1),w.get(g).push(b.length),b.push(F),v.push(y.x,y.y,y.z,1)}}const M=this.refineNormals(w,b,this._creaseAngle.getValue());for(const e of M)T.push(e.x,e.y,e.z);if(x&&y>2){if(this._beginCap.getValue()){const t=0,i=this._convex.getValue(),s={},o=[],a=[];for(let n=0;n<y;++n){const a=h(t,y-1-n),l=S[a].copy();l.index=a,s[a]=r[y-1-n].getValue().copy().subtract(e).divide(x),o.push(i?a:l)}if(i?fa.triangulateConvexPolygon(o,a):fa.triangulatePolygon(o,a),a.length>=3){const e=fa.normal(S[a[0]],S[a[1]],S[a[2]],new Tt(0,0,0));n&&e.negate(),this.addCap(l,s,e,S,a)}}if(this._endCap.getValue()){const t=o-1,i=this._convex.getValue(),s={},a=[],u=[];for(let n=0;n<y;++n){const o=h(t,n),l=S[o].copy();l.index=o,s[o]=r[n].getValue().copy().subtract(e).divide(x),a.push(i?o:l)}if(i?fa.triangulateConvexPolygon(a,u):fa.triangulatePolygon(a,u),u.length>=3){const e=fa.normal(S[u[0]],S[u[1]],S[u[2]],new Tt(0,0,0));n&&e.negate(),this.addCap(l,s,e,S,u)}}}this.setSolid(this._solid.getValue()),this.setCCW(this._ccw.getValue())}})(),addCap(e,t,i,n,r){const s=this.getCoordIndices(),o=this.getNormals(),a=this.getVertices();for(let l=0,u=r.length;l<u;l+=3){const u=r[l],h=r[l+1],d=r[l+2],c=n[u],p=n[h],g=n[d],f=t[u],m=t[h],_=t[d];s.push(u,h,d),e.push(f.x,f.y,0,1),e.push(m.x,m.y,0,1),e.push(_.x,_.y,0,1),o.push(i.x,i.y,i.z,i.x,i.y,i.z,i.x,i.y,i.z),a.push(c.x,c.y,c.z,1,p.x,p.y,p.z,1,g.x,g.y,g.z,1)}}}),Object.defineProperties(tp,{typeName:{value:"Extrusion",enumerable:!0},componentInfo:{value:Object.freeze({name:"Geometry3D",level:4}),enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_crossSection",new $n.MFVec2f),new k(d.inputOnly,"set_orientation",new $n.MFRotation),new k(d.inputOnly,"set_scale",new $n.MFVec2f),new k(d.inputOnly,"set_spine",new $n.MFVec3f),new k(d.initializeOnly,"beginCap",new $n.SFBool(!0)),new k(d.initializeOnly,"endCap",new $n.SFBool(!0)),new k(d.initializeOnly,"solid",new $n.SFBool(!0)),new k(d.initializeOnly,"ccw",new $n.SFBool(!0)),new k(d.initializeOnly,"convex",new $n.SFBool(!0)),new k(d.initializeOnly,"creaseAngle",new $n.SFFloat),new k(d.initializeOnly,"crossSection",new $n.MFVec2f(new _t(1,1),new _t(1,-1),new _t(-1,-1),new _t(-1,1),new _t(1,1))),new k(d.initializeOnly,"orientation",new $n.MFRotation(new ui)),new k(d.initializeOnly,"scale",new $n.MFVec2f(new _t(1,1))),new k(d.initializeOnly,"spine",new $n.MFVec3f(new Tt(0,0,0),new Tt(0,1,0)))]),enumerable:!0}});const ip=tp;i.add("Extrusion","x_ite/Components/Geometry3D/Extrusion",ip);const np=ip;function rp(e){Il.call(this,e),this.addType(d.X3DComposedGeometryNode),this.fogCoordNode=null,this.colorNode=null,this.texCoordNode=null,this.normalNode=null,this.coordNode=null}Object.assign(Object.setPrototypeOf(rp.prototype,Il.prototype),{initialize(){Il.prototype.initialize.call(this),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._texCoord.addInterest("set_texCoord__",this),this._normal.addInterest("set_normal__",this),this._coord.addInterest("set_coord__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_texCoord__(),this.set_normal__(),this.set_coord__()},getFogCoord(){return this.fogCoordNode},getColor(){return this.colorNode},getTexCoord(){return this.texCoordNode},getNormal(){return this.normalNode},getCoord(){return this.coordNode},set_attrib__(){const e=this.getAttrib();for(const t of e)t.removeInterest("requestRebuild",this),t._attribute_changed.removeInterest("updateVertexArrays",this);e.length=0;for(const t of this._attrib){const i=Yl(d.X3DVertexAttributeNode,t);i&&e.push(i)}for(const t of e)t.addInterest("requestRebuild",this),t._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__(){this.fogCoordNode?.removeInterest("requestRebuild",this),this.fogCoordNode=Yl(d.FogCoordinate,this._fogCoord),this.fogCoordNode?.addInterest("requestRebuild",this)},set_color__(){this.colorNode?.removeInterest("requestRebuild",this),this.colorNode=Yl(d.X3DColorNode,this._color),this.colorNode?.addInterest("requestRebuild",this),this.setTransparent(this.colorNode?.isTransparent()??!1)},set_texCoord__(){this.texCoordNode?.removeInterest("requestRebuild",this),this.texCoordNode=Yl(d.X3DTextureCoordinateNode,this._texCoord),this.texCoordNode?.addInterest("requestRebuild",this),this.setTextureCoordinate(this.texCoordNode)},set_normal__(){this.normalNode?.removeInterest("requestRebuild",this),this.normalNode=Yl(d.X3DNormalNode,this._normal),this.normalNode?.addInterest("requestRebuild",this)},set_coord__(){this.coordNode?.removeInterest("requestRebuild",this),this.coordNode=Yl(d.X3DCoordinateNode,this._coord),this.coordNode?.addInterest("requestRebuild",this)},getPolygonIndex:e=>e,getTriangleIndex:e=>e,build(e,t,i,n){if(!this.coordNode||this.coordNode.isEmpty())return;t-=t%e,n-=n%i;const r=this._colorPerVertex.getValue(),s=this._normalPerVertex.getValue(),o=this.getCoordIndices(),a=this.getAttrib(),l=a.length,u=this.getAttribs(),h=this.getFogCoord(),d=this.getColor(),c=this.getTexCoord(),p=this.getNormal(),g=this.getCoord(),f=this.getFogDepths(),m=this.getColors(),_=this.getMultiTexCoords(),x=this.getNormals(),y=this.getVertices();c?.init(_);for(let e=0;e<n;++e){const t=Math.floor(e/i),n=this.getPolygonIndex(this.getTriangleIndex(e));o.push(n);for(let e=0;e<l;++e)a[e].addValue(n,u[e]);h?.addDepth(n,f),d&&(r?d.addColor(n,m):d.addColor(t,m)),c?.addPoint(n,_),p&&(s?p.addVector(n,x):p.addVector(t,x)),g.addPoint(n,y)}this.getNormal()||this.buildNormals(e,t,n),this.setSolid(this._solid.getValue()),this.setCCW(this._ccw.getValue())},buildNormals(e,t,i){const n=this.createNormals(e,t),r=this.getNormals();for(let e=0;e<i;++e){const t=n[this.getTriangleIndex(e)];r.push(t.x,t.y,t.z)}},createNormals(e,t){const i=this.createFaceNormals(e,t);if(!this._normalPerVertex.getValue())return i;const n=new Map;for(let e=0;e<t;++e){const t=this.getPolygonIndex(e);let i=n.get(t);i||n.set(t,i=[]),i.push(e)}return this.refineNormals(n,i,Math.PI)},createFaceNormals(e,t){const i=!this._ccw.getValue(),n=this.coordNode,r=[];for(let s=0;s<t;s+=e){const t=this.getPolygonNormal(s,e,n);i&&t.negate();for(let i=0;i<e;++i)r.push(t)}return r},getPolygonNormal:(()=>{let e=new Tt(0,0,0),t=new Tt(0,0,0);return function(i,n,r){const s=new Tt(0,0,0);r.get1Point(this.getPolygonIndex(i),t);for(let o=0;o<n;++o){const a=e;e=t,t=a,r.get1Point(this.getPolygonIndex(i+(o+1)%n),t),s.x+=(e.y-t.y)*(e.z+t.z),s.y+=(e.z-t.z)*(e.x+t.x),s.z+=(e.x-t.x)*(e.y+t.y)}return s.normalize()}})()}),Object.defineProperties(rp,{typeName:{value:"X3DComposedGeometryNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Rendering",level:1}),enumerable:!0}});const sp=rp;i.add("X3DComposedGeometryNode","x_ite/Components/Rendering/X3DComposedGeometryNode",sp);const op=sp;function ap(e){op.call(this,e),this.addType(d.IndexedFaceSet),this._creaseAngle.setUnit("angle")}Object.assign(Object.setPrototypeOf(ap.prototype,op.prototype),{initialize(){op.prototype.initialize.call(this),this._set_colorIndex.addFieldInterest(this._colorIndex),this._set_texCoordIndex.addFieldInterest(this._texCoordIndex),this._set_normalIndex.addFieldInterest(this._normalIndex),this._set_coordIndex.addFieldInterest(this._coordIndex)},getTexCoordPerVertexIndex(e){return e<this._texCoordIndex.length?this._texCoordIndex[e]:this._coordIndex[e]},getColorPerVertexIndex(e){return e<this._colorIndex.length?this._colorIndex[e]:this._coordIndex[e]},getColorIndex(e){return e<this._colorIndex.length?this._colorIndex[e]:e},getNormalPerVertexIndex(e){return e<this._normalIndex.length?this._normalIndex[e]:this._coordIndex[e]},getNormalIndex(e){return e<this._normalIndex.length?this._normalIndex[e]:e},build(){const e=this.triangulate();if(0===e.length)return;const t=this._colorPerVertex.getValue(),i=this._normalPerVertex.getValue(),n=this._coordIndex.getValue(),r=this.getCoordIndices(),s=this.getAttrib(),o=s.length,a=this.getAttribs(),l=this.getFogCoord(),u=this.getColor(),h=this.getTexCoord(),d=this.getNormal(),c=this.getCoord(),p=this.getFogDepths(),g=this.getColors(),f=this.getMultiTexCoords(),m=this.getNormals(),_=this.getVertices();h?.init(f);for(const{triangles:x,face:y}of e)for(const e of x){const x=n[e];r.push(x);for(let e=0;e<o;++e)s[e].addValue(x,a[e]);l?.addDepth(x,p),u&&(t?u.addColor(this.getColorPerVertexIndex(e),g):u.addColor(this.getColorIndex(y),g)),h?.addPoint(this.getTexCoordPerVertexIndex(e),f),d&&(i?d.addVector(this.getNormalPerVertexIndex(e),m):d.addVector(this.getNormalIndex(y),m)),c.addPoint(x,_)}this.getNormal()||this.buildNormals(e),this.setSolid(this._solid.getValue()),this.setCCW(this._ccw.getValue())},triangulate(){const e=this._convex.getValue(),t=this._coordIndex.length,i=[];if(!this.getCoord())return i;if(t&&this._coordIndex.at(-1)>-1&&this._coordIndex.push(-1),t){const t=this._coordIndex.getValue(),n=this._coordIndex.length;for(let r=0,s=0,o=[];r<n;++r){if(t[r]>-1)o.push(r);else{switch(o.length){case 0:case 1:case 2:o.length=0;break;case 3:i.push({vertices:o,triangles:o,face:s}),o=[];break;default:{const t=[],n={vertices:o,triangles:t,face:s};e?fa.triangulateConvexPolygon(o,t):this.triangulatePolygon(o,t),t.length<3?o.length=0:(i.push(n),o=[]);break}}++s}}}return i},triangulatePolygon:(()=>{const e=[];return function(t,i){const n=this._coordIndex.getValue(),r=this.getCoord(),s=t.length;for(let t=e.length;t<s;++t)e.push(new Tt(0,0,0));for(let i=0;i<s;++i){const s=t[i],o=e[i];o.index=s,r.get1Point(n[s],o)}e.length=s,fa.triangulatePolygon(e,i)}})(),buildNormals(e){const t=this.createNormals(e),i=this.getNormals();for(const{triangles:n}of e)for(const e of n)i.push(...t[e])},createNormals(e){const t=!this._ccw.getValue(),i=this._coordIndex.getValue(),n=this.getCoord(),r=new Map,s=[];for(const{vertices:a}of e){switch(a.length){case 3:var o=n.getNormal(i[a[0]],i[a[1]],i[a[2]]);break;case 4:o=n.getQuadNormal(i[a[0]],i[a[1]],i[a[2]],i[a[3]]);break;default:o=this.getPolygonNormal(a,i,n)}for(const e of a){const t=i[e];let n=r.get(t);n||r.set(t,n=[]),n.push(e),s[e]=o}t&&o.negate()}return this._normalPerVertex.getValue()?this.refineNormals(r,s,this._creaseAngle.getValue()):s},getPolygonNormal:(()=>{let e=new Tt(0,0,0),t=new Tt(0,0,0);return function(i,n,r){const s=new Tt(0,0,0);r.get1Point(n[i[0]],t);for(let o=0,a=i.length;o<a;++o){const l=e;e=t,t=l,r.get1Point(n[i[(o+1)%a]],t),s.x+=(e.y-t.y)*(e.z+t.z),s.y+=(e.z-t.z)*(e.x+t.x),s.z+=(e.x-t.x)*(e.y+t.y)}return s.normalize()}})()}),Object.defineProperties(ap,{typeName:{value:"IndexedFaceSet",enumerable:!0},componentInfo:{value:Object.freeze({name:"Geometry3D",level:2}),enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_colorIndex",new $n.MFInt32),new k(d.inputOnly,"set_texCoordIndex",new $n.MFInt32),new k(d.inputOnly,"set_normalIndex",new $n.MFInt32),new k(d.inputOnly,"set_coordIndex",new $n.MFInt32),new k(d.initializeOnly,"solid",new $n.SFBool(!0)),new k(d.initializeOnly,"ccw",new $n.SFBool(!0)),new k(d.initializeOnly,"convex",new $n.SFBool(!0)),new k(d.initializeOnly,"creaseAngle",new $n.SFFloat),new k(d.initializeOnly,"colorPerVertex",new $n.SFBool(!0)),new k(d.initializeOnly,"normalPerVertex",new $n.SFBool(!0)),new k(d.initializeOnly,"colorIndex",new $n.MFInt32),new k(d.initializeOnly,"texCoordIndex",new $n.MFInt32),new k(d.initializeOnly,"normalIndex",new $n.MFInt32),new k(d.initializeOnly,"coordIndex",new $n.MFInt32),new k(d.inputOutput,"attrib",new $n.MFNode),new k(d.inputOutput,"fogCoord",new $n.SFNode),new k(d.inputOutput,"color",new $n.SFNode),new k(d.inputOutput,"texCoord",new $n.SFNode),new k(d.inputOutput,"normal",new $n.SFNode),new k(d.inputOutput,"coord",new $n.SFNode)]),enumerable:!0}});const lp=ap;i.add("IndexedFaceSet","x_ite/Components/Geometry3D/IndexedFaceSet",lp);const up=lp;function hp(e){Il.call(this,e),this.addType(d.Sphere),this._radius.setUnit("length")}Object.assign(Object.setPrototypeOf(hp.prototype,Il.prototype),{set_live__(){Il.prototype.set_live__.call(this),this.getLive().getValue()?this.getBrowser().getSphereOptions().addInterest("requestRebuild",this):this.getBrowser().getSphereOptions().removeInterest("requestRebuild",this)},build(){const e=this.getBrowser().getSphereOptions().getGeometry(),t=Math.abs(this._radius.getValue());if(this.setMultiTexCoords(e.getMultiTexCoords()),this.setNormals(e.getNormals()),1===t)this.setVertices(e.getVertices()),this.getMin().assign(e.getMin()),this.getMax().assign(e.getMax());else{const i=e.getVertices().getValue(),n=this.getVertices();for(let e=0,r=i.length;e<r;e+=4)n.push(t*i[e],t*i[e+1],t*i[e+2],1);this.getMin().set(-t,-t,-t),this.getMax().set(t,t,t)}this.setSolid(this._solid.getValue())}}),Object.defineProperties(hp,{typeName:{value:"Sphere",enumerable:!0},componentInfo:{value:Object.freeze({name:"Geometry3D",level:1}),enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.initializeOnly,"radius",new $n.SFFloat(1)),new k(d.initializeOnly,"solid",new $n.SFBool(!0))]),enumerable:!0}});const dp=hp;i.add("Sphere","x_ite/Components/Geometry3D/Sphere",dp);const cp={name:"Geometry3D",concreteNodes:[Hc,Wc,Kc,ep,np,up,dp],abstractNodes:[]};i.add("Geometry3D","x_ite/Components/Geometry3D",cp);const pp=cp,gp=Symbol(),fp=Symbol(),mp=Symbol(),_p=Symbol(),xp=Symbol();function yp(e){Yr.call(this,e),zu.call(this,e),this.addType(d.StaticGroup),this.groupNode=new Ju(this.getExecutionContext()),this.bbox=new Xa,this.shadowBBox=new Xa}Object.assign(Object.setPrototypeOf(yp.prototype,Yr.prototype),zu.prototype,{initialize(){Yr.prototype.initialize.call(this),zu.prototype.initialize.call(this),this._bboxSize.addFieldInterest(this.groupNode._bboxSize),this._bboxCenter.addFieldInterest(this.groupNode._bboxCenter),this._children.addFieldInterest(this.groupNode._children),this.groupNode._bboxSize=this._bboxSize,this.groupNode._bboxCenter=this._bboxCenter,this.groupNode._children=this._children,this.groupNode.setPrivate(!0),this.groupNode.setup(),this.groupNode._isCameraObject.addFieldInterest(this._isCameraObject),this.groupNode._isPickableObject.addFieldInterest(this._isPickableObject),this.groupNode._children.addInterest("set_children__",this),this.setCameraObject(this.groupNode.isCameraObject()),this.setPickableObject(this.groupNode.isPickableObject()),this.set_children__()},getBBox(e,t){return e.assign(t?this.shadowBBox:this.bbox)},set_children__(){this.groupNode.getBBox(this.bbox),this.groupNode.getBBox(this.shadowBBox,!0),this[gp]=null,this[fp]=null,this[mp]=null,this[_p]=null,this[xp]=null},traverse(e,t){switch(e){case Ma.CAMERA:return;case Ma.POINTER:return void this.traverseObjects(gp,"Pointing",e,t);case Ma.COLLISION:return void this.traverseObjects(fp,"Collision",e,t);case Ma.SHADOW:return void this.traverseObjects(mp,"Shadow",e,t);case Ma.DISPLAY:return this.traverseObjects(_p,"Opaque",e,t),void this.traverseObjects(xp,"Transparent",e,t)}},traverseObjects:(()=>{const e=new Oa;return e.intersectsSphere=function(){return!0},function(t,i,n,r){if(!this[t]){const s=r.getViewVolumes(),o=r.getViewport(),a=r.getProjectionMatrix(),l=r.getModelViewMatrix(),u=r[`getNum${i}Shapes`]();s.push(e.set(a,o,o)),l.push(),l.identity(),this.groupNode.traverse(n,r),l.pop(),s.pop();const h=r[`getNum${i}Shapes`]();this[t]=r[`get${i}Shapes`]().splice(u,h-u),r[`setNum${i}Shapes`](u)}const s=r.getModelViewMatrix();for(const{modelViewMatrix:e,shapeNode:i}of this[t])s.push(),s.multLeft(e),i.traverse(n,r),s.pop()}})(),dispose(){zu.prototype.dispose.call(this),Yr.prototype.dispose.call(this)}}),Object.defineProperties(yp,{typeName:{value:"StaticGroup",enumerable:!0},componentInfo:{value:Object.freeze({name:"Grouping",level:3}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"visible",new $n.SFBool(!0)),new k(d.inputOutput,"bboxDisplay",new $n.SFBool),new k(d.initializeOnly,"bboxSize",new $n.SFVec3f(-1,-1,-1)),new k(d.initializeOnly,"bboxCenter",new $n.SFVec3f),new k(d.initializeOnly,"children",new $n.MFNode)]),enumerable:!0}});const wp=yp;i.add("StaticGroup","x_ite/Components/Grouping/StaticGroup",wp);const bp=wp;function Sp(e){Yu.call(this,e),this.addType(d.Switch),2==e.getSpecificationVersion()&&this.addAlias("choice",this._children),this.childNode=null,this.visibleNode=null,this.boundedObject=null}Object.assign(Object.setPrototypeOf(Sp.prototype,Yu.prototype),{initialize(){Yu.prototype.initialize.call(this),this._whichChoice.addInterest("set_child__",this),this._children.addInterest("set_child__",this),this.set_child__()},getSubBBox(e,t){if(this._bboxSize.getValue().equals(this.getDefaultBBoxSize())){const i=Yl(d.X3DBoundedObject,this.visibleNode);return i?.getBBox(e,t)??e.set()}return e.set(this._bboxSize.getValue(),this._bboxCenter.getValue())},clear(){},add(){},remove(){},set_child__(){this.childNode&&(this.childNode._isCameraObject.removeInterest("set_cameraObject__",this),this.childNode._isPickableObject.removeInterest("set_transformSensors__",this)),Yl(d.X3DBoundedObject,this.childNode)&&(this.childNode._display.removeInterest("set_display__",this),this.childNode._bboxDisplay.removeInterest("set_bboxDisplay__",this));const e=this._whichChoice.getValue();e>=0&&e<this._children.length?(this.childNode=Yl(d.X3DChildNode,this._children[e]),this.childNode&&(this.childNode._isCameraObject.addInterest("set_cameraObject__",this),this.childNode._isPickableObject.addInterest("set_transformSensors__",this),Yl(d.X3DBoundedObject,this.childNode)&&(this.childNode._display.addInterest("set_display__",this),this.childNode._bboxDisplay.addInterest("set_bboxDisplay__",this)),delete this.traverse)):(this.childNode=null,this.traverse=Function.prototype),this.set_display__(),this.set_bboxDisplay__()},set_cameraObject__(){this.setCameraObject(!!this.visibleNode?.isCameraObject())},set_transformSensors__(){this.setPickableObject(!(!this.getTransformSensors().size&&!this.visibleNode?.isPickableObject()))},set_display__(){Yl(d.X3DBoundedObject,this.childNode)?this.visibleNode=this.childNode._display.getValue()?this.childNode:null:this.visibleNode=this.childNode,this.set_cameraObject__(),this.set_transformSensors__()},set_bboxDisplay__(){Yl(d.X3DBoundedObject,this.childNode)?this.boundedObject=this.childNode._bboxDisplay.getValue()?this.childNode:null:this.boundedObject=null},traverse(e,t){switch(e){case Ma.POINTER:case Ma.CAMERA:case Ma.SHADOW:return void this.visibleNode?.traverse(e,t);case Ma.PICKING:{if(this.getTransformSensors().size){const e=t.getModelViewMatrix().get();for(const t of this.getTransformSensors())t.collect(e)}const i=this.visibleNode;if(i){const n=this.getBrowser().getPickingHierarchy();n.push(this),i.traverse(e,t),n.pop()}return}case Ma.COLLISION:return void this.visibleNode?.traverse(e,t);case Ma.DISPLAY:return this.visibleNode?.traverse(e,t),void this.boundedObject?.displayBBox(e,t)}}}),Object.defineProperties(Sp,{typeName:{value:"Switch",enumerable:!0},componentInfo:{value:Object.freeze({name:"Grouping",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"whichChoice",new $n.SFInt32(-1)),new k(d.inputOutput,"visible",new $n.SFBool(!0)),new k(d.inputOutput,"bboxDisplay",new $n.SFBool),new k(d.initializeOnly,"bboxSize",new $n.SFVec3f(-1,-1,-1)),new k(d.initializeOnly,"bboxCenter",new $n.SFVec3f),new k(d.inputOnly,"addChildren",new $n.MFNode),new k(d.inputOnly,"removeChildren",new $n.MFNode),new k(d.inputOutput,"children",new $n.MFNode)]),enumerable:!0}});const Tp=Sp;i.add("Switch","x_ite/Components/Grouping/Switch",Tp);const vp=Tp;function Op(e){Yu.call(this,e),this.addType(d.X3DTransformMatrix3DNode),this.matrix=new gi}Object.assign(Object.setPrototypeOf(Op.prototype,Yu.prototype),{setMatrix(e){e.equals(gi.Identity)?(this.matrix.identity(),this.getBBox=this.getSubBBox,this.traverse=this.groupTraverse):(this.matrix.assign(e),delete this.getBBox,delete this.traverse)},getMatrix(){return this.matrix},setTransform(e,t,i,n,r){e.equals(Tt.Zero)&&t.equals(ui.Identity)&&i.equals(Tt.One)?(this.matrix.identity(),this.getBBox=this.getSubBBox,this.traverse=this.groupTraverse):(this.matrix.set(e,t,i,n,r),delete this.getBBox,delete this.traverse)},getBBox(e,t){return this.getSubBBox(e,t).multRight(this.matrix)},traverse(e,t){const i=t.getModelViewMatrix();i.push(),i.multLeft(this.matrix),Yu.prototype.traverse.call(this,e,t),i.pop()},groupTraverse:Yu.prototype.traverse}),Object.defineProperties(Op,{typeName:{value:"X3DTransformMatrix3DNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Grouping",level:1}),enumerable:!0}});const Ep=Op;i.add("X3DTransformMatrix3DNode","x_ite/Components/Grouping/X3DTransformMatrix3DNode",Ep);const Cp=Ep;function Np(e){Cp.call(this,e),this.addType(d.X3DTransformNode),this._translation.setUnit("length"),this._center.setUnit("length")}Object.assign(Object.setPrototypeOf(Np.prototype,Cp.prototype),{initialize(){Cp.prototype.initialize.call(this),this.addInterest("eventsProcessed",this),this.eventsProcessed()},eventsProcessed(){this.setTransform(this._translation.getValue(),this._rotation.getValue(),this._scale.getValue(),this._scaleOrientation.getValue(),this._center.getValue())}}),Object.defineProperties(Np,{typeName:{value:"X3DTransformNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Grouping",level:1}),enumerable:!0}});const Ip=Np;i.add("X3DTransformNode","x_ite/Components/Grouping/X3DTransformNode",Ip);const Fp=Ip;function Mp(e){Fp.call(this,e),this.addType(d.Transform)}Object.setPrototypeOf(Mp.prototype,Fp.prototype),Object.defineProperties(Mp,{typeName:{value:"Transform",enumerable:!0},componentInfo:{value:Object.freeze({name:"Grouping",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"translation",new $n.SFVec3f),new k(d.inputOutput,"rotation",new $n.SFRotation),new k(d.inputOutput,"scale",new $n.SFVec3f(1,1,1)),new k(d.inputOutput,"scaleOrientation",new $n.SFRotation),new k(d.inputOutput,"center",new $n.SFVec3f),new k(d.inputOutput,"visible",new $n.SFBool(!0)),new k(d.inputOutput,"bboxDisplay",new $n.SFBool),new k(d.initializeOnly,"bboxSize",new $n.SFVec3f(-1,-1,-1)),new k(d.initializeOnly,"bboxCenter",new $n.SFVec3f),new k(d.inputOnly,"addChildren",new $n.MFNode),new k(d.inputOnly,"removeChildren",new $n.MFNode),new k(d.inputOutput,"children",new $n.MFNode)]),enumerable:!0}});const Dp=Mp;i.add("Transform","x_ite/Components/Grouping/Transform",Dp);const Rp={name:"Grouping",concreteNodes:[Ju,bp,vp,Dp],abstractNodes:[zu,Yu,Cp,Fp]};i.add("Grouping","x_ite/Components/Grouping",Rp);const Pp=Rp;function Ap(e){Su.call(this,e),this.addType(d.ColorInterpolator),this.hsv=[]}Object.assign(Object.setPrototypeOf(Ap.prototype,Su.prototype),{initialize(){Su.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__(){const e=this._keyValue;e.length<this._key.length&&this._keyValue.resize(this._key.length,e.length?e[this._keyValue.length-1]:new $n.SFColor),this.hsv.length=0;for(const t of e)this.hsv.push(t.getHSV())},interpolate:(()=>{const e=[];return function(t,i,n){Fe.lerp(this.hsv[t],this.hsv[i],n,e),this._value_changed.setHSV(e[0],e[1],e[2])}})()}),Object.defineProperties(Ap,{typeName:{value:"ColorInterpolator",enumerable:!0},componentInfo:{value:Object.freeze({name:"Interpolation",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_fraction",new $n.SFFloat),new k(d.inputOutput,"key",new $n.MFFloat),new k(d.inputOutput,"keyValue",new $n.MFColor),new k(d.outputOnly,"value_changed",new $n.SFColor)]),enumerable:!0}});const Vp=Ap;i.add("ColorInterpolator","x_ite/Components/Interpolation/ColorInterpolator",Vp);const Lp=Vp;function Bp(e){Su.call(this,e),this.addType(d.CoordinateInterpolator)}Object.assign(Object.setPrototypeOf(Bp.prototype,Su.prototype),{set_keyValue__(){},interpolate(e,t,i){const n=this._keyValue.getValue();let r=this._key.length?Math.floor(this._keyValue.length/this._key.length):0;this._value_changed.length=r;const s=this._value_changed.getValue();t=(e*=r)+(this._key.length>1?r:0),e*=3,t*=3,r*=3;for(let o=0;o<r;o+=3){const r=o+1,a=o+2;s[o]=g.lerp(n[e+o],n[t+o],i),s[r]=g.lerp(n[e+r],n[t+r],i),s[a]=g.lerp(n[e+a],n[t+a],i)}this._value_changed.addEvent()}}),Object.defineProperties(Bp,{typeName:{value:"CoordinateInterpolator",enumerable:!0},componentInfo:{value:Object.freeze({name:"Interpolation",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_fraction",new $n.SFFloat),new k(d.inputOutput,"key",new $n.MFFloat),new k(d.inputOutput,"keyValue",new $n.MFVec3f),new k(d.outputOnly,"value_changed",new $n.MFVec3f)]),enumerable:!0}});const Up=Bp;i.add("CoordinateInterpolator","x_ite/Components/Interpolation/CoordinateInterpolator",Up);const Xp=Up;function jp(e){Su.call(this,e),this.addType(d.CoordinateInterpolator2D)}Object.assign(Object.setPrototypeOf(jp.prototype,Su.prototype),{set_keyValue__(){},interpolate(e,t,i){const n=this._keyValue.getValue();let r=this._key.length?Math.floor(this._keyValue.length/this._key.length):0;this._value_changed.length=r;const s=this._value_changed.getValue();t=(e*=r)+(this._key.length>1?r:0),e*=2,t*=2,r*=2;for(let o=0;o<r;o+=2){const r=o+1;s[o]=g.lerp(n[e+o],n[t+o],i),s[r]=g.lerp(n[e+r],n[t+r],i)}this._value_changed.addEvent()}}),Object.defineProperties(jp,{typeName:{value:"CoordinateInterpolator2D",enumerable:!0},componentInfo:{value:Object.freeze({name:"Interpolation",level:3}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_fraction",new $n.SFFloat),new k(d.inputOutput,"key",new $n.MFFloat),new k(d.inputOutput,"keyValue",new $n.MFVec2f),new k(d.outputOnly,"value_changed",new $n.MFVec2f)]),enumerable:!0}});const kp=jp;i.add("CoordinateInterpolator2D","x_ite/Components/Interpolation/CoordinateInterpolator2D",kp);const zp=kp;function Gp(e){Su.call(this,e),this.addType(d.NormalInterpolator)}Object.assign(Object.setPrototypeOf(Gp.prototype,Su.prototype),{initialize(){Su.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__(){},interpolate:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0);return function(i,n,r){const s=this._keyValue.getValue();let o=this._key.length>1?Math.floor(this._keyValue.length/this._key.length):0;this._value_changed.length=o;const a=this._value_changed.getValue();n=(i*=o)+o,i*=3,n*=3,o*=3;for(let l=0;l<o;l+=3)try{const o=l+1,u=l+2;e.set(s[i+l],s[i+o],s[i+u]),t.set(s[n+l],s[n+o],s[n+u]);const h=g.simpleSlerp(e,t,r);a[l]=h[0],a[o]=h[1],a[u]=h[2]}catch(e){}this._value_changed.addEvent()}})()}),Object.defineProperties(Gp,{typeName:{value:"NormalInterpolator",enumerable:!0},componentInfo:{value:Object.freeze({name:"Interpolation",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_fraction",new $n.SFFloat),new k(d.inputOutput,"key",new $n.MFFloat),new k(d.inputOutput,"keyValue",new $n.MFVec3f),new k(d.outputOnly,"value_changed",new $n.MFVec3f)]),enumerable:!0}});const Hp=Gp;i.add("NormalInterpolator","x_ite/Components/Interpolation/NormalInterpolator",Hp);const qp=Hp;function Yp(e){Su.call(this,e),this.addType(d.PositionInterpolator2D)}Object.assign(Object.setPrototypeOf(Yp.prototype,Su.prototype),{initialize(){Su.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__(){const e=this._key,t=this._keyValue;t.length<e.length&&t.resize(e.length,t.length?t[t.length-1]:new $n.SFVec2f)},interpolate:(()=>{const e=new _t(0,0);return function(t,i,n){this._value_changed=e.assign(this._keyValue[t].getValue()).lerp(this._keyValue[i].getValue(),n)}})()}),Object.defineProperties(Yp,{typeName:{value:"PositionInterpolator2D",enumerable:!0},componentInfo:{value:Object.freeze({name:"Interpolation",level:3}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_fraction",new $n.SFFloat),new k(d.inputOutput,"key",new $n.MFFloat),new k(d.inputOutput,"keyValue",new $n.MFVec2f),new k(d.outputOnly,"value_changed",new $n.SFVec2f)]),enumerable:!0}});const Wp=Yp;i.add("PositionInterpolator2D","x_ite/Components/Interpolation/PositionInterpolator2D",Wp);const $p=Wp;function Jp(){this.T0=[],this.T1=[]}Object.assign(Jp.prototype,{generate:(()=>{const e=[],t=[],i=[];return function(n,r,s,o,a){const l=this.T0,u=this.T1;if(l.length=0,u.length=0,e.length=0,t.length=0,i.length=0,r.length>1){if(0===o.length){n?e.push(this.divide(this.subtract(s[1],s[s.length-2]),2)):e.push(this.create());for(let t=1,i=s.length-1;t<i;++t)e.push(this.divide(this.subtract(s[t+1],s[t-1]),2));e.push(this.copy(e[0]))}else{for(let t=0,i=o.length;t<i;++t)e.push(this.copy(o[t]));if(a){let t=0;for(let e=0,i=s.length-1;e<i;++e)t+=this.magnitude(this.subtract(s[e],s[e+1]));for(let i=0,n=e.length-1;i<n;++i){const n=this.magnitude(e[i]);n&&(e[i]=this.multiply(e[i],t/n))}}}if(n){const e=r.length-1,n=r.length-2,s=r[1]-r[0]+r[e]-r[n];i.push(2*(r[1]-r[0])/s),t.push(2*(r[e]-r[n])/s)}else i.push(1),t.push(1);for(let e=1,n=r.length-1;e<n;++e){const n=r[e+1]-r[e-1];i.push(2*(r[e+1]-r[e])/n),t.push(2*(r[e]-r[e-1])/n)}i.push(i[0]),t.push(t[0]);for(let n=0,r=e.length;n<r;++n)l.push(this.multiply(e[n],t[n])),u.push(this.multiply(e[n],i[n]))}else l.push(this.create()),u.push(this.create())}})(),interpolate:(()=>{const e=new Gt(0,0,0,0),t=new gi(2,-2,1,1,-3,3,-2,-1,0,0,1,0,1,0,0,0);return function(i,n,r,s){return e.set(r**3,r**2,r,1),this.dot(t.multVecMatrix(e),s[i],s[n],this.T0[i],this.T1[n])}})()});const Kp=Jp;i.add("CatmullRomSplineInterpolator","x_ite/Browser/Interpolation/CatmullRomSplineInterpolator",Kp);const Zp=Kp;const Qp=function(e){function t(){this.T0=[],this.T1=[]}return Object.assign(Object.setPrototypeOf(t.prototype,Zp.prototype),{create:()=>e.Zero.copy(),copy:e=>e.copy(),subtract:(e,t)=>e.copy().subtract(t),multiply:(e,t)=>e.copy().multiply(t),divide:(e,t)=>e.copy().divide(t),magnitude:e=>e.magnitude(),dot:(()=>{const t=new e(0,0,0,0),i=new e(0,0,0,0),n=new e(0,0,0,0),r=new e(0,0,0,0);return function(e,s,o,a,l){return t.assign(s).multiply(e[0]),i.assign(o).multiply(e[1]),n.assign(a).multiply(e[2]),r.assign(l).multiply(e[3]),t.add(i).add(n).add(r)}})()}),t};i.add("CatmullRomSplineInterpolatorTemplate","x_ite/Browser/Interpolation/CatmullRomSplineInterpolatorTemplate",Qp);const eg=Qp,tg=eg(Tt);i.add("CatmullRomSplineInterpolator3","x_ite/Browser/Interpolation/CatmullRomSplineInterpolator3",tg);const ig=tg;function ng(e){Su.call(this,e),this.addType(d.SplinePositionInterpolator),this.spline=new ig}Object.assign(Object.setPrototypeOf(ng.prototype,Su.prototype),{initialize(){Su.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this),this._keyVelocity.addInterest("set_keyVelocity__",this),this._normalizeVelocity.addInterest("set_normalizeVelocity__",this)},set_keyValue__(){const e=this._key,t=this._keyValue;t.length<e.length&&t.resize(e.length,t.length?t[t.length-1]:new $n.SFVec3f),this.set_keyVelocity__()},set_keyVelocity__(){this._keyVelocity.length&&this._keyVelocity.length<this._key.length&&this._keyVelocity.resize(this._key.length,new $n.SFVec3f),this.set_normalizeVelocity__()},set_normalizeVelocity__(){this.spline.generate(this._closed.getValue(),this._key,this._keyValue,this._keyVelocity,this._normalizeVelocity.getValue())},interpolate(e,t,i){this._value_changed=this.spline.interpolate(e,t,i,this._keyValue)}}),Object.defineProperties(ng,{typeName:{value:"SplinePositionInterpolator",enumerable:!0},componentInfo:{value:Object.freeze({name:"Interpolation",level:4}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.2",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_fraction",new $n.SFFloat),new k(d.inputOutput,"closed",new $n.SFBool),new k(d.inputOutput,"key",new $n.MFFloat),new k(d.inputOutput,"keyValue",new $n.MFVec3f),new k(d.inputOutput,"keyVelocity",new $n.MFVec3f),new k(d.inputOutput,"normalizeVelocity",new $n.SFBool),new k(d.outputOnly,"value_changed",new $n.SFVec3f)]),enumerable:!0}});const rg=ng;i.add("SplinePositionInterpolator","x_ite/Components/Interpolation/SplinePositionInterpolator",rg);const sg=rg,og=eg(_t);i.add("CatmullRomSplineInterpolator2","x_ite/Browser/Interpolation/CatmullRomSplineInterpolator2",og);const ag=og;function lg(e){Su.call(this,e),this.addType(d.SplinePositionInterpolator2D),this.spline=new ag}Object.assign(Object.setPrototypeOf(lg.prototype,Su.prototype),{initialize(){Su.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this),this._keyVelocity.addInterest("set_keyVelocity__",this),this._normalizeVelocity.addInterest("set_normalizeVelocity__",this)},set_keyValue__(){const e=this._key,t=this._keyValue;t.length<e.length&&t.resize(e.length,t.length?t[t.length-1]:new $n.SFVec2f),this.set_keyVelocity__()},set_keyVelocity__(){this._keyVelocity.length&&this._keyVelocity.length<this._key.length&&this._keyVelocity.resize(this._key.length,new $n.SFVec2f),this.set_normalizeVelocity__()},set_normalizeVelocity__(){this.spline.generate(this._closed.getValue(),this._key,this._keyValue,this._keyVelocity,this._normalizeVelocity.getValue())},interpolate(e,t,i){this._value_changed=this.spline.interpolate(e,t,i,this._keyValue)}}),Object.defineProperties(lg,{typeName:{value:"SplinePositionInterpolator2D",enumerable:!0},componentInfo:{value:Object.freeze({name:"Interpolation",level:4}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.2",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_fraction",new $n.SFFloat),new k(d.inputOutput,"closed",new $n.SFBool),new k(d.inputOutput,"key",new $n.MFFloat),new k(d.inputOutput,"keyValue",new $n.MFVec2f),new k(d.inputOutput,"keyVelocity",new $n.MFVec2f),new k(d.inputOutput,"normalizeVelocity",new $n.SFBool),new k(d.outputOnly,"value_changed",new $n.SFVec2f)]),enumerable:!0}});const ug=lg;i.add("SplinePositionInterpolator2D","x_ite/Components/Interpolation/SplinePositionInterpolator2D",ug);const hg=ug;function dg(){Zp.call(this)}Object.assign(Object.setPrototypeOf(dg.prototype,Zp.prototype),{create:()=>0,copy:e=>e,subtract:(e,t)=>e-t,multiply:(e,t)=>e*t,divide:(e,t)=>e/t,magnitude:e=>Math.abs(e),dot:(e,t,i,n,r)=>t*e[0]+i*e[1]+n*e[2]+r*e[3]});const cg=dg;i.add("CatmullRomSplineInterpolator1","x_ite/Browser/Interpolation/CatmullRomSplineInterpolator1",cg);const pg=cg;function gg(e){Su.call(this,e),this.addType(d.SplineScalarInterpolator),this.spline=new pg}Object.assign(Object.setPrototypeOf(gg.prototype,Su.prototype),{initialize(){Su.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this),this._keyVelocity.addInterest("set_keyVelocity__",this),this._normalizeVelocity.addInterest("set_normalizeVelocity__",this)},set_keyValue__(){const e=this._key,t=this._keyValue;t.length<e.length&&t.resize(e.length,t.length?t[t.length-1]:new $n.SFFloat),this.set_keyVelocity__()},set_keyVelocity__(){this._keyVelocity.length&&this._keyVelocity.length<this._key.length&&this._keyVelocity.resize(this._key.length,new $n.SFFloat),this.set_normalizeVelocity__()},set_normalizeVelocity__(){this.spline.generate(this._closed.getValue(),this._key,this._keyValue,this._keyVelocity,this._normalizeVelocity.getValue())},interpolate(e,t,i){this._value_changed=this.spline.interpolate(e,t,i,this._keyValue)}}),Object.defineProperties(gg,{typeName:{value:"SplineScalarInterpolator",enumerable:!0},componentInfo:{value:Object.freeze({name:"Interpolation",level:4}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.2",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_fraction",new $n.SFFloat),new k(d.inputOutput,"closed",new $n.SFBool),new k(d.inputOutput,"key",new $n.MFFloat),new k(d.inputOutput,"keyValue",new $n.MFFloat),new k(d.inputOutput,"keyVelocity",new $n.MFFloat),new k(d.inputOutput,"normalizeVelocity",new $n.SFBool),new k(d.outputOnly,"value_changed",new $n.SFFloat)]),enumerable:!0}});const fg=gg;i.add("SplineScalarInterpolator","x_ite/Components/Interpolation/SplineScalarInterpolator",fg);const mg=fg;function _g(){this.s=[]}Object.assign(_g.prototype,{generate(e,t,i){const n=this.s;if(n.length=0,t.length>1){e?n.push(ui.spline(i[t.length-2].getValue(),i[0].getValue(),i[1].getValue())):n.push(i[0].getValue());for(let e=1,r=t.length-1;e<r;++e)n.push(ui.spline(i[e-1].getValue(),i[e].getValue(),i[e+1].getValue()));e?n.push(ui.spline(i[t.length-2].getValue(),i[t.length-1].getValue(),i[1].getValue())):n.push(i[t.length-1].getValue())}else t.length>0&&n.push(i[0].getValue().copy())},interpolate:(()=>{const e=new ui;return function(t,i,n,r){return e.assign(r[t].getValue()).squad(this.s[t],this.s[i],r[i].getValue(),n)}})()});const xg=_g;i.add("SquatInterpolator","x_ite/Browser/Interpolation/SquatInterpolator",xg);const yg=xg;function wg(e){Su.call(this,e),this.addType(d.SquadOrientationInterpolator),this._keyValue.setUnit("angle"),this._value_changed.setUnit("angle"),this.squad=new yg}Object.assign(Object.setPrototypeOf(wg.prototype,Su.prototype),{initialize(){Su.prototype.initialize.call(this),this._keyValue.addInterest("set_keyValue__",this)},set_keyValue__(){const e=this._key,t=this._keyValue;t.length<e.length&&t.resize(e.length,t.length?t[t.length-1]:new $n.SFRotation),this.squad.generate(this._closed.getValue(),this._key,this._keyValue)},interpolate(e,t,i){try{this._value_changed=this.squad.interpolate(e,t,i,this._keyValue)}catch(e){console.error(e)}}}),Object.defineProperties(wg,{typeName:{value:"SquadOrientationInterpolator",enumerable:!0},componentInfo:{value:Object.freeze({name:"Interpolation",level:5}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.2",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_fraction",new $n.SFFloat),new k(d.inputOutput,"closed",new $n.SFBool),new k(d.inputOutput,"key",new $n.MFFloat),new k(d.inputOutput,"keyValue",new $n.MFRotation),new k(d.outputOnly,"value_changed",new $n.SFRotation)]),enumerable:!0}});const bg=wg;i.add("SquadOrientationInterpolator","x_ite/Components/Interpolation/SquadOrientationInterpolator",bg);const Sg={name:"Interpolation",concreteNodes:[Lp,Xp,zp,Ou,qp,Mu,Nu,$p,Pu,sg,hg,mg,bg],abstractNodes:[Su]};i.add("Interpolation","x_ite/Components/Interpolation",Sg);const Tg=Sg;function vg(e){Yu.call(this,e),this.addType(d.X3DViewportNode)}Object.setPrototypeOf(vg.prototype,Yu.prototype),Object.defineProperties(vg,{typeName:{value:"X3DViewportNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Layering",level:1}),enumerable:!0}});const Og=vg;i.add("X3DViewportNode","x_ite/Components/Layering/X3DViewportNode",Og);const Eg=Og,Cg=dl(Oa);function Ng(e){Eg.call(this,e),this.addType(d.Viewport),this.rectangle=new Gt(0,0,0,0)}Object.assign(Object.setPrototypeOf(Ng.prototype,Eg.prototype),{getRectangle(){const e=this.getBrowser().getViewport(),t=Math.floor(e[2]*this.getLeft()),i=Math.floor(e[2]*this.getRight()),n=Math.floor(e[3]*this.getBottom()),r=Math.floor(e[3]*this.getTop());return this.rectangle.set(t,n,Math.max(0,i-t),Math.max(0,r-n)),this.rectangle},getLeft(){return this._clipBoundary.length>0?this._clipBoundary[0]:0},getRight(){return this._clipBoundary.length>1?this._clipBoundary[1]:1},getBottom(){return this._clipBoundary.length>2?this._clipBoundary[2]:0},getTop(){return this._clipBoundary.length>3?this._clipBoundary[3]:1},traverse(e,t){if(this.push(t),e===Ma.POINTER)this.getBrowser().isPointerInRectangle(this.rectangle)&&Eg.prototype.traverse.call(this,e,t);else Eg.prototype.traverse.call(this,e,t);this.pop(t)},push(e){const t=e.getViewVolumes(),i=this.getRectangle(),n=t.length?t.at(-1).getViewport():i,r=Cg.pop();r.set(e.getProjectionMatrix().get(),n,i),t.push(r)},pop(e){Cg.push(e.getViewVolumes().pop())}}),Object.defineProperties(Ng,{typeName:{value:"Viewport",enumerable:!0},componentInfo:{value:Object.freeze({name:"Layering",level:1}),enumerable:!0},containerField:{value:"viewport",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.2",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"clipBoundary",new $n.MFFloat(0,1,0,1)),new k(d.inputOutput,"visible",new $n.SFBool(!0)),new k(d.inputOutput,"bboxDisplay",new $n.SFBool),new k(d.initializeOnly,"bboxSize",new $n.SFVec3f(-1,-1,-1)),new k(d.initializeOnly,"bboxCenter",new $n.SFVec3f),new k(d.inputOnly,"addChildren",new $n.MFNode),new k(d.inputOnly,"removeChildren",new $n.MFNode),new k(d.inputOutput,"children",new $n.MFNode)]),enumerable:!0}});const Ig=Ng;i.add("Viewport","x_ite/Components/Layering/Viewport",Ig);const Fg=Ig,Mg={name:"Layering",concreteNodes:[Qu,ih,Fg],abstractNodes:[hu,Eg]};i.add("Layering","x_ite/Components/Layering",Mg);const Dg=Mg;function Rg(e){Yr.call(this,e),this.addType(d.X3DLightNode),this.enabled=!0}Object.assign(Object.setPrototypeOf(Rg.prototype,Yr.prototype),{initialize(){Yr.prototype.initialize.call(this),this._on.addInterest("set_on__",this),this._intensity.addInterest("set_on__",this),this.set_on__()},set_on__(){this._on.getValue()&&this.getIntensity()>0&&this.enabled?(delete this.push,delete this.pop):(this.push=Function.prototype,this.pop=Function.prototype)},getLightKey:()=>1,getEnabled(){return this.enabled},setEnabled(e){this.enabled=e},getGlobal(){return this._global.getValue()},getColor(){return this._color.getValue()},getIntensity(){return Math.max(this._intensity.getValue(),0)},getAmbientIntensity(){return g.clamp(this._ambientIntensity.getValue(),0,1)},getDirection(){return this._direction.getValue()},getShadows(){return this._shadows.getValue()},getShadowColor(){return this._shadowColor.getValue()},getShadowIntensity(){return this.getShadows()?g.clamp(this._shadowIntensity.getValue(),0,1):0},getShadowBias(){return g.clamp(this._shadowBias.getValue(),0,1)},getShadowMapSize(){return Math.min(this._shadowMapSize.getValue(),this.getBrowser().getMaxTextureSize())},getBiasMatrix:(()=>{const e=new gi(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1);return function(){return e}})(),push(e,t){if(e.isIndependent()){const i=this.getLights().pop();this._global.getValue()?(i.set(this,e.getLayer().getGroup(),e.getModelViewMatrix().get()),e.getGlobalLights().push(i),e.getLights().push(i),e.pushGlobalShadows(!!this.getShadowIntensity())):(i.set(this,t,e.getModelViewMatrix().get()),e.getLocalObjects().push(i),e.getLights().push(i),e.pushLocalShadows(!!this.getShadowIntensity()),e.getLocalObjectsKeys().push(this.getLightKey()))}else{const t=e.getLightContainer();t.modelViewMatrix.pushMatrix(e.getModelViewMatrix().get()),this._global.getValue()?(e.getGlobalLights().push(t),e.getLights().push(t),e.pushGlobalShadows(!!this.getShadowIntensity())):(e.getLocalObjects().push(t),e.getLights().push(t),e.pushLocalShadows(!!this.getShadowIntensity()),e.getLocalObjectsKeys().push(this.getLightKey()))}},pop(e){if(this._global.getValue())return;const t=e.getLocalObjects().pop();e.isIndependent()&&this.getBrowser().getLocalObjects().push(t),e.popLocalShadows(),e.getLocalObjectsKeys().pop()}}),Object.defineProperties(Rg,{typeName:{value:"X3DLightNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Lighting",level:1}),enumerable:!0}});const Pg=Rg;i.add("X3DLightNode","x_ite/Components/Lighting/X3DLightNode",Pg);const Ag=Pg,Vg=dl(Lg);function Lg(){this.direction=new Tt(0,0,0),this.shadowBuffer=null,this.bbox=new Xa,this.viewVolume=new Oa,this.viewport=new Gt(0,0,0,0),this.projectionMatrix=new gi,this.modelViewMatrix=new qo(gi),this.modelMatrix=new gi,this.invLightSpaceMatrix=new gi,this.invLightSpaceProjectionMatrix=new gi,this.shadowMatrix=new gi,this.shadowMatrixArray=new Float32Array(16),this.rotation=new ui,this.textureUnit=void 0}function Bg(e){Ag.call(this,e),this.addType(d.DirectionalLight),2==e.getSpecificationVersion()&&(this._global=!0)}Object.assign(Lg.prototype,{set(e,t,i){const n=e.getShadowMapSize();this.browser=e.getBrowser(),this.lightNode=e,this.groupNode=t,this.global=e.getGlobal(),this.modelViewMatrix.pushMatrix(i),e.getShadowIntensity()>0&&n>0&&(this.shadowBuffer=this.browser.popShadowBuffer(n),this.shadowBuffer||console.warn("Couldn't create shadow buffer."))},renderShadowMap(e){if(!this.shadowBuffer)return;const t=this.lightNode,i=e.getCameraSpaceMatrix().get(),n=this.modelMatrix.assign(this.modelViewMatrix.get()).multRight(i),r=this.invLightSpaceMatrix.assign(this.global?n:gi.Identity);r.rotate(this.rotation.setFromToVec(Tt.zAxis,this.direction.assign(t.getDirection()).negate())),r.inverse();const s=this.groupNode.getSubBBox(this.bbox,!0).multRight(r),o=t.getShadowMapSize(),a=this.viewport.set(0,0,o,o),l=La.orthoBox(s,this.projectionMatrix);this.shadowBuffer.bind(),e.getViewVolumes().push(this.viewVolume.set(l,a,a)),e.getProjectionMatrix().pushMatrix(l),e.getModelViewMatrix().pushMatrix(r),e.render(Ma.SHADOW,Yu.prototype.traverse,this.groupNode),e.getModelViewMatrix().pop(),e.getProjectionMatrix().pop(),e.getViewVolumes().pop(),this.global||r.multLeft(n.inverse()),this.invLightSpaceProjectionMatrix.assign(r).multRight(l).multRight(t.getBiasMatrix())},setGlobalVariables(e){this.modelViewMatrix.get().multDirMatrix(this.direction.assign(this.lightNode.getDirection())).normalize(),this.shadowBuffer&&(this.shadowMatrix.assign(e.getCameraSpaceMatrix().get()).multRight(this.invLightSpaceProjectionMatrix),this.shadowMatrixArray.set(this.shadowMatrix))},setShaderUniforms(e,t){const i=t.numLights++;if(this.shadowBuffer){const n=this.global?this.textureUnit=this.textureUnit??this.browser.popTexture2DUnit():this.browser.getTexture2DUnit();void 0!==n?(e.activeTexture(e.TEXTURE0+n),e.HAS_FEATURE_DEPTH_TEXTURE?e.bindTexture(e.TEXTURE_2D,this.shadowBuffer.getDepthTexture()):e.bindTexture(e.TEXTURE_2D,this.shadowBuffer.getColorTexture()),e.uniform1i(t.x3d_ShadowMap[i],n)):console.warn("Not enough combined texture units for shadow map available.")}if(t.hasLight(i,this))return;const{lightNode:n,direction:r}=this,s=n.getColor();if(e.uniform1i(t.x3d_LightType[i],1),e.uniform3f(t.x3d_LightColor[i],s.r,s.g,s.b),e.uniform1f(t.x3d_LightIntensity[i],n.getIntensity()),e.uniform1f(t.x3d_LightAmbientIntensity[i],n.getAmbientIntensity()),e.uniform3f(t.x3d_LightDirection[i],r.x,r.y,r.z),e.uniform1f(t.x3d_LightRadius[i],-1),this.shadowBuffer){const r=n.getShadowColor();e.uniform3f(t.x3d_ShadowColor[i],r.r,r.g,r.b),e.uniform1f(t.x3d_ShadowIntensity[i],n.getShadowIntensity()),e.uniform1f(t.x3d_ShadowBias[i],n.getShadowBias()),e.uniformMatrix4fv(t.x3d_ShadowMatrix[i],!1,this.shadowMatrixArray),e.uniform1i(t.x3d_ShadowMapSize[i],n.getShadowMapSize())}else e.uniform1f(t.x3d_ShadowIntensity[i],0)},dispose(){this.browser.pushShadowBuffer(this.shadowBuffer),this.browser.pushTexture2DUnit(this.textureUnit),this.modelViewMatrix.clear(),this.shadowBuffer=null,this.textureUnit=void 0,Vg.push(this)}}),Object.assign(Object.setPrototypeOf(Bg.prototype,Ag.prototype),{getLights:()=>Vg}),Object.defineProperties(Bg,{typeName:{value:"DirectionalLight",enumerable:!0},componentInfo:{value:Object.freeze({name:"Lighting",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"global",new $n.SFBool),new k(d.inputOutput,"on",new $n.SFBool(!0)),new k(d.inputOutput,"color",new $n.SFColor(1,1,1)),new k(d.inputOutput,"intensity",new $n.SFFloat(1)),new k(d.inputOutput,"ambientIntensity",new $n.SFFloat),new k(d.inputOutput,"direction",new $n.SFVec3f(0,0,-1)),new k(d.inputOutput,"shadows",new $n.SFBool),new k(d.inputOutput,"shadowColor",new $n.SFColor),new k(d.inputOutput,"shadowIntensity",new $n.SFFloat(1)),new k(d.inputOutput,"shadowBias",new $n.SFFloat(.005)),new k(d.initializeOnly,"shadowMapSize",new $n.SFInt32(1024))]),enumerable:!0}});const Ug=Bg;i.add("DirectionalLight","x_ite/Components/Lighting/DirectionalLight",Ug);const Xg=Ug,jg=dl(kg);function kg(){this.modelViewMatrix=new qo(gi)}function zg(e){Ag.call(this,e),this.addType(d.EnvironmentLight),this.rotationMatrix=new Float32Array(9)}Object.assign(kg.prototype,{set(e,t,i){this.browser=e.getBrowser(),this.lightNode=e,this.global=e.getGlobal()},renderShadowMap(e){},setGlobalVariables(e){},setShaderUniforms(e,t){const{browser:i,lightNode:n,global:r}=this,s=n.getColor(),o=n.getDiffuseTexture(),a=n.getSpecularTexture(),l=i.getGGXLUTTexture(),u=r?this.diffuseTextureUnit=this.diffuseTextureUnit??i.popTextureCubeUnit():i.getTextureCubeUnit(),h=r?this.specularTextureUnit=this.specularTextureUnit??i.popTextureCubeUnit():i.getTextureCubeUnit(),d=r?this.GGXLUTTextureUnit=this.GGXLUTTextureUnit??i.popTexture2DUnit():i.getTexture2DUnit(),c=1+Math.floor(Math.log2(a?.getSize()??1));e.uniform3f(t.x3d_EnvironmentLightColor,s.r,s.g,s.b),e.uniform1f(t.x3d_EnvironmentLightIntensity,n.getIntensity()),e.uniformMatrix3fv(t.x3d_EnvironmentLightRotation,!1,n.getRotation()),e.uniform1i(t.x3d_EnvironmentLightDiffuseTextureLinear,o?.isLinear()),e.uniform1i(t.x3d_EnvironmentLightSpecularTextureLinear,a?.isLinear()),e.uniform1i(t.x3d_EnvironmentLightSpecularTextureLevels,c),e.activeTexture(e.TEXTURE0+u),e.bindTexture(e.TEXTURE_CUBE_MAP,o?.getTexture()??i.getDefaultTextureCube()),e.uniform1i(t.x3d_EnvironmentLightDiffuseTexture,u),e.activeTexture(e.TEXTURE0+h),e.bindTexture(e.TEXTURE_CUBE_MAP,a?.getTexture()??i.getDefaultTextureCube()),e.uniform1i(t.x3d_EnvironmentLightSpecularTexture,h),e.activeTexture(e.TEXTURE0+d),e.bindTexture(e.TEXTURE_2D,l.getTexture()),e.uniform1i(t.x3d_EnvironmentLightGGXLUTTexture,d)},dispose(){const e=this.browser;e.pushTextureCubeUnit(this.diffuseTextureUnit),e.pushTextureCubeUnit(this.specularTextureUnit),e.pushTexture2DUnit(this.GGXLUTTextureUnit),this.modelViewMatrix.clear(),this.diffuseTextureUnit=void 0,this.specularTextureUnit=void 0,this.GGXLUTTextureUnit=void 0,jg.push(this)}}),Object.assign(Object.setPrototypeOf(zg.prototype,Ag.prototype),{initialize(){Ag.prototype.initialize.call(this),this._rotation.addInterest("set_rotation__",this),this._diffuseTexture.addInterest("set_diffuseTexture__",this),this._specularTexture.addInterest("set_specularTexture__",this),this.set_rotation__(),this.set_diffuseTexture__(),this.set_specularTexture__()},getLightKey:()=>2,getRotation(){return this.rotationMatrix},getDiffuseTexture(){return this.diffuseTexture},getSpecularTexture(){return this.specularTexture},getLights:()=>jg,set_rotation__(){this._rotation.getValue().getMatrix(this.rotationMatrix)},set_diffuseTexture__(){this.diffuseTexture=Yl(d.X3DEnvironmentTextureNode,this._diffuseTexture)},set_specularTexture__(){this.specularTexture=Yl(d.X3DEnvironmentTextureNode,this._specularTexture)}}),Object.defineProperties(zg,{typeName:{value:"EnvironmentLight",enumerable:!0},componentInfo:{value:Object.freeze({name:"Lighting",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"4.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"global",new $n.SFBool),new k(d.inputOutput,"on",new $n.SFBool(!0)),new k(d.inputOutput,"color",new $n.SFColor(1,1,1)),new k(d.inputOutput,"intensity",new $n.SFFloat(1)),new k(d.inputOutput,"ambientIntensity",new $n.SFFloat),new k(d.inputOutput,"rotation",new $n.SFRotation),new k(d.inputOutput,"diffuseTexture",new $n.SFNode),new k(d.inputOutput,"diffuseCoefficients",new $n.MFFloat),new k(d.inputOutput,"specularTexture",new $n.SFNode),new k(d.inputOutput,"shadows",new $n.SFBool),new k(d.inputOutput,"shadowColor",new $n.SFColor),new k(d.inputOutput,"shadowIntensity",new $n.SFFloat(1)),new k(d.inputOutput,"shadowBias",new $n.SFFloat(.005)),new k(d.initializeOnly,"shadowMapSize",new $n.SFInt32(1024))]),enumerable:!0}});const Gg=zg;i.add("EnvironmentLight","x_ite/Components/Lighting/EnvironmentLight",Gg);const Hg=Gg,qg=[(new gi).setRotation(new ui(new Tt(1,0,0),Tt.zAxis)),(new gi).setRotation(new ui(new Tt(-1,0,0),Tt.zAxis)),(new gi).setRotation(new ui(new Tt(0,0,-1),Tt.zAxis)),(new gi).setRotation(new ui(new Tt(0,0,1),Tt.zAxis)),(new gi).setRotation(new ui(new Tt(0,1,0),Tt.zAxis)),(new gi).setRotation(new ui(new Tt(0,-1,0),Tt.zAxis))],Yg=[new Gt(0,.5,.25,.5),new Gt(.5,.5,.25,.5),new Gt(.75,.5,.25,.5),new Gt(.25,.5,.25,.5),new Gt(0,0,.5,.5),new Gt(.5,0,.5,.5)],Wg=dl($g);function $g(){this.location=new Tt(0,0,0),this.matrixArray=new Float32Array(9),this.shadowBuffer=null,this.viewVolume=new Oa,this.viewport=new Gt(0,0,0,0),this.projectionMatrix=new gi,this.modelViewMatrix=new qo(gi),this.modelMatrix=new gi,this.invLightSpaceMatrix=new gi,this.invLightSpaceProjectionMatrix=new gi,this.shadowMatrix=new gi,this.shadowMatrixArray=new Float32Array(16),this.rotation=new ui,this.rotationMatrix=new gi,this.textureUnit=void 0}function Jg(e){Ag.call(this,e),this.addType(d.PointLight),this._location.setUnit("length"),this._radius.setUnit("length")}Object.assign($g.prototype,{set(e,t,i){const n=e.getShadowMapSize();this.browser=e.getBrowser(),this.lightNode=e,this.groupNode=t,this.global=e.getGlobal(),this.matrixArray.set(i.submatrix.inverse()),this.modelViewMatrix.pushMatrix(i),e.getShadowIntensity()>0&&n>0&&(this.shadowBuffer=this.browser.popShadowBuffer(n),this.shadowBuffer||console.warn("Couldn't create shadow buffer."))},renderShadowMap(e){if(!this.shadowBuffer)return;const t=this.lightNode,i=e.getCameraSpaceMatrix().get(),n=this.modelMatrix.assign(this.modelViewMatrix.get()).multRight(i),r=this.invLightSpaceMatrix.assign(this.global?n:gi.Identity);r.translate(t.getLocation()),r.inverse();const s=t.getShadowMapSize();this.shadowBuffer.bind();for(let t=0;t<6;++t){const i=Yg[t],n=this.viewport.set(i[0]*s,i[1]*s,i[2]*s,i[3]*s),o=La.perspective2(g.radians(90),.125,1e4,n[2],n[3],this.projectionMatrix);e.getViewVolumes().push(this.viewVolume.set(o,n,n)),e.getProjectionMatrix().pushMatrix(this.projectionMatrix),e.getModelViewMatrix().pushMatrix(qg[t]),e.getModelViewMatrix().multLeft(r),e.render(Ma.SHADOW,Yu.prototype.traverse,this.groupNode),e.getModelViewMatrix().pop(),e.getProjectionMatrix().pop(),e.getViewVolumes().pop()}this.global||r.multLeft(n.inverse()),this.invLightSpaceProjectionMatrix.assign(r)},setGlobalVariables(e){this.modelViewMatrix.get().multVecMatrix(this.location.assign(this.lightNode._location.getValue())),this.shadowBuffer&&(this.shadowMatrix.assign(e.getCameraSpaceMatrix().get()).multRight(this.invLightSpaceProjectionMatrix),this.shadowMatrixArray.set(this.shadowMatrix))},setShaderUniforms(e,t){const i=t.numLights++;if(this.shadowBuffer){const n=this.global?this.textureUnit=this.textureUnit??this.browser.popTexture2DUnit():this.browser.getTexture2DUnit();void 0!==n?(e.activeTexture(e.TEXTURE0+n),e.HAS_FEATURE_DEPTH_TEXTURE?e.bindTexture(e.TEXTURE_2D,this.shadowBuffer.getDepthTexture()):e.bindTexture(e.TEXTURE_2D,this.shadowBuffer.getColorTexture()),e.uniform1i(t.x3d_ShadowMap[i],n)):console.warn("Not enough combined texture units for shadow map available.")}if(t.hasLight(i,this))return;const{lightNode:n,location:r}=this,s=n.getColor(),o=n.getAttenuation();if(e.uniform1i(t.x3d_LightType[i],2),e.uniform3f(t.x3d_LightColor[i],s.r,s.g,s.b),e.uniform1f(t.x3d_LightIntensity[i],n.getIntensity()),e.uniform1f(t.x3d_LightAmbientIntensity[i],n.getAmbientIntensity()),e.uniform3f(t.x3d_LightAttenuation[i],Math.max(0,o.x),Math.max(0,o.y),Math.max(0,o.z)),e.uniform3f(t.x3d_LightLocation[i],r.x,r.y,r.z),e.uniform1f(t.x3d_LightRadius[i],n.getRadius()),e.uniformMatrix3fv(t.x3d_LightMatrix[i],!1,this.matrixArray),this.shadowBuffer){const r=n.getShadowColor();e.uniform3f(t.x3d_ShadowColor[i],r.r,r.g,r.b),e.uniform1f(t.x3d_ShadowIntensity[i],n.getShadowIntensity()),e.uniform1f(t.x3d_ShadowBias[i],n.getShadowBias()),e.uniformMatrix4fv(t.x3d_ShadowMatrix[i],!1,this.shadowMatrixArray),e.uniform1i(t.x3d_ShadowMapSize[i],n.getShadowMapSize())}else e.uniform1f(t.x3d_ShadowIntensity[i],0)},dispose(){this.browser.pushShadowBuffer(this.shadowBuffer),this.browser.pushTexture2DUnit(this.textureUnit),this.modelViewMatrix.clear(),this.shadowBuffer=null,this.textureUnit=void 0,Wg.push(this)}}),Object.assign(Object.setPrototypeOf(Jg.prototype,Ag.prototype),{getAttenuation(){return this._attenuation.getValue()},getLocation(){return this._location.getValue()},getRadius(){return this._radius.getValue()},getLights:()=>Wg}),Object.defineProperties(Jg,{typeName:{value:"PointLight",enumerable:!0},componentInfo:{value:Object.freeze({name:"Lighting",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"global",new $n.SFBool(!0)),new k(d.inputOutput,"on",new $n.SFBool(!0)),new k(d.inputOutput,"color",new $n.SFColor(1,1,1)),new k(d.inputOutput,"intensity",new $n.SFFloat(1)),new k(d.inputOutput,"ambientIntensity",new $n.SFFloat),new k(d.inputOutput,"attenuation",new $n.SFVec3f(1,0,0)),new k(d.inputOutput,"location",new $n.SFVec3f),new k(d.inputOutput,"radius",new $n.SFFloat(100)),new k(d.inputOutput,"shadows",new $n.SFBool),new k(d.inputOutput,"shadowColor",new $n.SFColor),new k(d.inputOutput,"shadowIntensity",new $n.SFFloat(1)),new k(d.inputOutput,"shadowBias",new $n.SFFloat(.005)),new k(d.initializeOnly,"shadowMapSize",new $n.SFInt32(1024))]),enumerable:!0}});const Kg=Jg;i.add("PointLight","x_ite/Components/Lighting/PointLight",Kg);const Zg=Kg,Qg=dl(ef);function ef(){this.location=new Tt(0,0,0),this.direction=new Tt(0,0,0),this.matrixArray=new Float32Array(9),this.renderShadow=!0,this.shadowBuffer=null,this.bbox=new Xa,this.viewVolume=new Oa,this.viewport=new Gt(0,0,0,0),this.projectionMatrix=new gi,this.modelViewMatrix=new qo(gi),this.modelMatrix=new gi,this.invLightSpaceMatrix=new gi,this.invLightSpaceProjectionMatrix=new gi,this.shadowMatrix=new gi,this.shadowMatrixArray=new Float32Array(16),this.rotation=new ui,this.lightBBoxMin=new Tt(0,0,0),this.lightBBoxMax=new Tt(0,0,0),this.textureUnit=void 0}function tf(e){Ag.call(this,e),this.addType(d.SpotLight),this._location.setUnit("length"),this._radius.setUnit("length"),this._beamWidth.setUnit("angle"),this._cutOffAngle.setUnit("angle"),3.3==e.getSpecificationVersion()?(this._beamWidth=.785398,this._cutOffAngle=1.5708):e.getSpecificationVersion()<=3.2&&(this._beamWidth=1.5708,this._cutOffAngle=.785398)}Object.assign(ef.prototype,{set(e,t,i){const n=e.getShadowMapSize();this.browser=e.getBrowser(),this.lightNode=e,this.groupNode=t,this.global=e.getGlobal(),this.matrixArray.set(i.submatrix.inverse()),this.modelViewMatrix.pushMatrix(i),e.getShadowIntensity()>0&&n>0&&(this.shadowBuffer=this.browser.popShadowBuffer(n),this.shadowBuffer||console.warn("Couldn't create shadow buffer."))},renderShadowMap(e){if(!this.shadowBuffer)return;const t=this.lightNode,i=e.getCameraSpaceMatrix().get(),n=this.modelMatrix.assign(this.modelViewMatrix.get()).multRight(i),r=this.invLightSpaceMatrix.assign(this.global?n:gi.Identity);r.translate(t.getLocation()),r.rotate(this.rotation.setFromToVec(Tt.zAxis,this.direction.assign(t.getDirection()).negate())),r.inverse();this.groupNode.getSubBBox(this.bbox,!0).multRight(r).getExtents(this.lightBBoxMin,this.lightBBoxMax);const s=t.getShadowMapSize(),o=Math.min(t.getRadius(),-this.lightBBoxMin.z),a=this.viewport.set(0,0,s,s),l=La.perspective(2*t.getCutOffAngle(),.125,Math.max(1e4,o),s,s,this.projectionMatrix);this.renderShadow=o>0,this.shadowBuffer.bind(),e.getViewVolumes().push(this.viewVolume.set(l,a,a)),e.getProjectionMatrix().pushMatrix(l),e.getModelViewMatrix().pushMatrix(r),e.render(Ma.SHADOW,Yu.prototype.traverse,this.groupNode),e.getModelViewMatrix().pop(),e.getProjectionMatrix().pop(),e.getViewVolumes().pop(),this.global||r.multLeft(n.inverse()),this.invLightSpaceProjectionMatrix.assign(r).multRight(l).multRight(t.getBiasMatrix())},setGlobalVariables(e){const t=this.lightNode,i=this.modelViewMatrix.get();i.multVecMatrix(this.location.assign(t._location.getValue())),i.multDirMatrix(this.direction.assign(t._direction.getValue())).normalize(),this.shadowBuffer&&(this.shadowMatrix.assign(e.getCameraSpaceMatrix().get()).multRight(this.invLightSpaceProjectionMatrix),this.shadowMatrixArray.set(this.shadowMatrix))},setShaderUniforms(e,t){const i=t.numLights++;if(this.shadowBuffer){const n=this.global?this.textureUnit=this.textureUnit??this.browser.popTexture2DUnit():this.browser.getTexture2DUnit();void 0!==n?(e.activeTexture(e.TEXTURE0+n),e.HAS_FEATURE_DEPTH_TEXTURE?e.bindTexture(e.TEXTURE_2D,this.shadowBuffer.getDepthTexture()):e.bindTexture(e.TEXTURE_2D,this.shadowBuffer.getColorTexture()),e.uniform1i(t.x3d_ShadowMap[i],n)):console.warn("Not enough combined texture units for shadow map available.")}if(t.hasLight(i,this))return;const{lightNode:n,location:r,direction:s}=this,o=n.getColor(),a=n.getAttenuation();if(e.uniform1i(t.x3d_LightType[i],3),e.uniform3f(t.x3d_LightColor[i],o.r,o.g,o.b),e.uniform1f(t.x3d_LightIntensity[i],n.getIntensity()),e.uniform1f(t.x3d_LightAmbientIntensity[i],n.getAmbientIntensity()),e.uniform3f(t.x3d_LightAttenuation[i],Math.max(0,a.x),Math.max(0,a.y),Math.max(0,a.z)),e.uniform3f(t.x3d_LightLocation[i],r.x,r.y,r.z),e.uniform3f(t.x3d_LightDirection[i],s.x,s.y,s.z),e.uniform1f(t.x3d_LightRadius[i],n.getRadius()),e.uniform1f(t.x3d_LightBeamWidth[i],n.getBeamWidth()),e.uniform1f(t.x3d_LightCutOffAngle[i],n.getCutOffAngle()),e.uniformMatrix3fv(t.x3d_LightMatrix[i],!1,this.matrixArray),this.renderShadow&&this.shadowBuffer){const r=n.getShadowColor();e.uniform3f(t.x3d_ShadowColor[i],r.r,r.g,r.b),e.uniform1f(t.x3d_ShadowIntensity[i],n.getShadowIntensity()),e.uniform1f(t.x3d_ShadowBias[i],n.getShadowBias()),e.uniformMatrix4fv(t.x3d_ShadowMatrix[i],!1,this.shadowMatrixArray),e.uniform1i(t.x3d_ShadowMapSize[i],n.getShadowMapSize())}else e.uniform1f(t.x3d_ShadowIntensity[i],0)},dispose(){this.browser.pushShadowBuffer(this.shadowBuffer),this.browser.pushTexture2DUnit(this.textureUnit),this.modelViewMatrix.clear(),this.shadowBuffer=null,this.textureUnit=void 0,Qg.push(this)}}),Object.assign(Object.setPrototypeOf(tf.prototype,Ag.prototype),{getAttenuation(){return this._attenuation.getValue()},getLocation(){return this._location.getValue()},getRadius(){return this._radius.getValue()},getBeamWidth(){const e=this._beamWidth.getValue(),t=this.getCutOffAngle();return e>t?t:g.clamp(e,0,Math.PI/2)},getCutOffAngle(){return g.clamp(this._cutOffAngle.getValue(),0,Math.PI/2)},getLights:()=>Qg}),Object.defineProperties(tf,{typeName:{value:"SpotLight",enumerable:!0},componentInfo:{value:Object.freeze({name:"Lighting",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"global",new $n.SFBool(!0)),new k(d.inputOutput,"on",new $n.SFBool(!0)),new k(d.inputOutput,"color",new $n.SFColor(1,1,1)),new k(d.inputOutput,"intensity",new $n.SFFloat(1)),new k(d.inputOutput,"ambientIntensity",new $n.SFFloat),new k(d.inputOutput,"attenuation",new $n.SFVec3f(1,0,0)),new k(d.inputOutput,"location",new $n.SFVec3f),new k(d.inputOutput,"direction",new $n.SFVec3f(0,0,-1)),new k(d.inputOutput,"radius",new $n.SFFloat(100)),new k(d.inputOutput,"beamWidth",new $n.SFFloat(.589049)),new k(d.inputOutput,"cutOffAngle",new $n.SFFloat(1.570796)),new k(d.inputOutput,"shadows",new $n.SFBool),new k(d.inputOutput,"shadowColor",new $n.SFColor),new k(d.inputOutput,"shadowIntensity",new $n.SFFloat(1)),new k(d.inputOutput,"shadowBias",new $n.SFFloat(.005)),new k(d.initializeOnly,"shadowMapSize",new $n.SFInt32(1024))]),enumerable:!0}});const nf=tf;i.add("SpotLight","x_ite/Components/Lighting/SpotLight",nf);const rf={name:"Lighting",concreteNodes:[Xg,Hg,Zg,nf],abstractNodes:[Ag]};i.add("Lighting","x_ite/Components/Lighting",rf);const sf=rf;function of(e){Yu.call(this,e),this.addType(d.Billboard),this.matrix=new gi}Object.assign(Object.setPrototypeOf(of.prototype,Yu.prototype),{getBBox(e,t){return Yu.prototype.getBBox.call(this,e,t).multRight(this.matrix)},getMatrix(){return this.matrix},rotate:(()=>{const e=new gi,t=new Tt(0,0,0),i=new Tt(0,0,0),n=new Tt(0,0,0),r=new Tt(0,0,0),s=new ui;return function(o){e.assign(o).inverse();const a=e.origin.normalize();if(this._axisOfRotation.getValue().equals(Tt.Zero)){e.multDirMatrix(t.assign(Tt.yAxis)).normalize();const n=t.cross(a);i.assign(a).cross(n);const r=a;n.normalize(),i.normalize(),this.matrix.set(n.x,n.y,n.z,0,i.x,i.y,i.z,0,r.x,r.y,r.z,0,0,0,0,1)}else n.assign(this._axisOfRotation.getValue()).cross(a),r.assign(this._axisOfRotation.getValue()).cross(Tt.zAxis),this.matrix.setRotation(s.setFromToVec(r,n));return this.matrix}})(),traverse(e,t){const i=t.getModelViewMatrix();switch(i.push(),e){case Ma.CAMERA:case Ma.PICKING:case Ma.SHADOW:i.multLeft(this.matrix);break;default:i.multLeft(this.rotate(i.get()))}Yu.prototype.traverse.call(this,e,t),i.pop()}}),Object.defineProperties(of,{typeName:{value:"Billboard",enumerable:!0},componentInfo:{value:Object.freeze({name:"Navigation",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"axisOfRotation",new $n.SFVec3f(0,1,0)),new k(d.inputOutput,"visible",new $n.SFBool(!0)),new k(d.inputOutput,"bboxDisplay",new $n.SFBool),new k(d.initializeOnly,"bboxSize",new $n.SFVec3f(-1,-1,-1)),new k(d.initializeOnly,"bboxCenter",new $n.SFVec3f),new k(d.inputOnly,"addChildren",new $n.MFNode),new k(d.inputOnly,"removeChildren",new $n.MFNode),new k(d.inputOutput,"children",new $n.MFNode)]),enumerable:!0}});const af=of;i.add("Billboard","x_ite/Components/Navigation/Billboard",af);const lf=af;function uf(e){Yu.call(this,e),pu.call(this,e),this.addType(d.Collision),2==e.getSpecificationVersion()&&this.addAlias("collide",this._enabled)}Object.assign(Object.setPrototypeOf(uf.prototype,Yu.prototype),pu.prototype,{initialize(){Yu.prototype.initialize.call(this),this.getLive().addInterest("set_live__",this),this._enabled.addInterest("set_live__",this),this._proxy.addInterest("set_proxy__",this),this.set_live__(),this.set_proxy__()},set_live__(){this.getLive().getValue()&&this._enabled.getValue()?this.getBrowser().addCollision(this):this.getBrowser().removeCollision(this)},set_active(e){this._isActive.getValue()!==e&&(this._isActive=e,e&&(this._collideTime=this.getBrowser().getCurrentTime()))},set_proxy__(){this.proxyNode=Yl(d.X3DChildNode,this._proxy)},traverse(e,t){if(e!==Ma.COLLISION)Yu.prototype.traverse.call(this,e,t);else if(this._enabled.getValue()){const i=t.getCollisions();i.push(this),this.proxyNode?this.proxyNode.traverse(e,t):Yu.prototype.traverse.call(this,e,t),i.pop()}},dispose(){Yu.prototype.dispose.call(this)}}),Object.defineProperties(uf,{typeName:{value:"Collision",enumerable:!0},componentInfo:{value:Object.freeze({name:"Navigation",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"collideTime",new $n.SFTime),new k(d.inputOutput,"visible",new $n.SFBool(!0)),new k(d.inputOutput,"bboxDisplay",new $n.SFBool),new k(d.initializeOnly,"bboxSize",new $n.SFVec3f(-1,-1,-1)),new k(d.initializeOnly,"bboxCenter",new $n.SFVec3f),new k(d.initializeOnly,"proxy",new $n.SFNode),new k(d.inputOnly,"addChildren",new $n.MFNode),new k(d.inputOnly,"removeChildren",new $n.MFNode),new k(d.inputOutput,"children",new $n.MFNode)]),enumerable:!0}});const hf=uf;i.add("Collision","x_ite/Components/Navigation/Collision",hf);const df=hf;function cf(e){Yu.call(this,e),this.addType(d.LOD),this._center.setUnit("length"),this._range.setUnit("length"),2==e.getSpecificationVersion()&&this.addAlias("level",this._children),this.frameRate=60,this.keepCurrentLevel=!1,this.childNode=null,this.visibleNode=null,this.boundedObject=null}Object.assign(Object.setPrototypeOf(cf.prototype,Yu.prototype),{initialize(){Yu.prototype.initialize.call(this),this._children.addInterest("set_child__",this)},getSubBBox(e,t){if(this._bboxSize.getValue().equals(this.getDefaultBBoxSize())){const i=Yl(d.X3DBoundedObject,this.visibleNode);return i?.getBBox(e,t)??e.set()}return e.set(this._bboxSize.getValue(),this._bboxCenter.getValue())},clear(){},add(){},remove(){},set_child__(){this.set_level__(Math.min(this._level_changed.getValue(),this._children.length-1))},set_level__(e){this.childNode&&(this.childNode._isCameraObject.removeInterest("set_cameraObject__",this),this.childNode._isPickableObject.removeInterest("set_transformSensors__",this)),Yl(d.X3DBoundedObject,this.childNode)&&(this.childNode._display.removeInterest("set_display__",this),this.childNode._bboxDisplay.removeInterest("set_bboxDisplay__",this)),e>=0&&e<this._children.length?(this.childNode=Yl(d.X3DChildNode,this._children[e]),this.childNode&&(this.childNode._isCameraObject.addInterest("set_cameraObject__",this),this.childNode._isPickableObject.addInterest("set_transformSensors__",this),Yl(d.X3DBoundedObject,this.childNode)&&(this.childNode._display.addInterest("set_display__",this),this.childNode._bboxDisplay.addInterest("set_bboxDisplay__",this)))):this.childNode=null,this.set_display__(),this.set_bboxDisplay__()},set_cameraObject__(){this.setCameraObject(!!this.visibleNode?.isCameraObject())},set_transformSensors__(){this.setPickableObject(!(!this.getTransformSensors().size&&!this.visibleNode?.isPickableObject()))},set_display__(){Yl(d.X3DBoundedObject,this.childNode)?this.visibleNode=this.childNode._display.getValue()?this.childNode:null:this.visibleNode=this.childNode,this.set_cameraObject__(),this.set_transformSensors__()},set_bboxDisplay__(){Yl(d.X3DBoundedObject,this.childNode)?this.boundedObject=this.childNode._bboxDisplay.getValue()?this.childNode:null:this.boundedObject=null},getLevel:function(e,t){if(0===this._range.length){this.frameRate=(179*this.frameRate+e.currentFrameRate)/180;const t=this._children.length;switch(t){case 0:return-1;case 1:return 0;case 2:return+(this.frameRate>55);default:{const e=1-g.clamp((this.frameRate-20)/35,0,1);return Math.min(Math.floor(e*t),t-1)}}}const i=t.translate(this._center.getValue()).origin.magnitude();return g.upperBound(this._range,0,this._range.length,i)},traverse:(()=>{const e=new gi;return function(t,i){switch(t){case Ma.POINTER:case Ma.CAMERA:case Ma.SHADOW:return void this.visibleNode?.traverse(t,i);case Ma.PICKING:{if(this.getTransformSensors().size){const e=i.getModelViewMatrix().get();for(const t of this.getTransformSensors())t.collect(e)}const e=this.visibleNode;if(e){const n=this.getBrowser().getPickingHierarchy();n.push(this),e.traverse(t,i),n.pop()}return}case Ma.COLLISION:return void this.visibleNode?.traverse(t,i);case Ma.DISPLAY:if(!this.keepCurrentLevel){let t=this.getLevel(this.getBrowser(),e.assign(i.getModelViewMatrix().get())),n=this._level_changed.getValue();this._forceTransitions.getValue()&&(t>n?t=n+1:t<n&&(t=n-1)),t!==n&&(this._level_changed=t,this.set_level__(Math.min(t,this._children.length-1)))}return this.visibleNode?.traverse(t,i),void this.boundedObject?.displayBBox(t,i)}}})()}),Object.defineProperties(cf,{typeName:{value:"LOD",enumerable:!0},componentInfo:{value:Object.freeze({name:"Navigation",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.initializeOnly,"forceTransitions",new $n.SFBool),new k(d.initializeOnly,"center",new $n.SFVec3f),new k(d.initializeOnly,"range",new $n.MFFloat),new k(d.outputOnly,"level_changed",new $n.SFInt32(-1)),new k(d.inputOutput,"visible",new $n.SFBool(!0)),new k(d.inputOutput,"bboxDisplay",new $n.SFBool),new k(d.initializeOnly,"bboxSize",new $n.SFVec3f(-1,-1,-1)),new k(d.initializeOnly,"bboxCenter",new $n.SFVec3f),new k(d.inputOnly,"addChildren",new $n.MFNode),new k(d.inputOnly,"removeChildren",new $n.MFNode),new k(d.inputOutput,"children",new $n.MFNode)]),enumerable:!0}});const pf=cf;i.add("LOD","x_ite/Components/Navigation/LOD",pf);const gf=pf;function ff(e){Lu.call(this,e),this.addType(d.OrthoViewpoint),this.addChildObjects(d.inputOutput,"fieldOfViewOffset",new $n.MFFloat(0,0,0,0)),this._position.setUnit("length"),this._centerOfRotation.setUnit("length"),this._fieldOfView.setUnit("length"),this.projectionMatrix=new gi,this.fieldOfViewOffsetInterpolator0=new Pu(this.getBrowser().getPrivateScene()),this.fieldOfViewOffsetInterpolator1=new Pu(this.getBrowser().getPrivateScene()),this.fieldOfViewOffsetInterpolator2=new Pu(this.getBrowser().getPrivateScene()),this.fieldOfViewOffsetInterpolator3=new Pu(this.getBrowser().getPrivateScene())}Object.assign(Object.setPrototypeOf(ff.prototype,Lu.prototype),{initialize(){Lu.prototype.initialize.call(this),this.fieldOfViewOffsetInterpolator0._key=new $n.MFFloat(0,1),this.fieldOfViewOffsetInterpolator1._key=new $n.MFFloat(0,1),this.fieldOfViewOffsetInterpolator2._key=new $n.MFFloat(0,1),this.fieldOfViewOffsetInterpolator3._key=new $n.MFFloat(0,1),this.fieldOfViewOffsetInterpolator0.setup(),this.fieldOfViewOffsetInterpolator1.setup(),this.fieldOfViewOffsetInterpolator2.setup(),this.fieldOfViewOffsetInterpolator3.setup(),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.fieldOfViewOffsetInterpolator0._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.fieldOfViewOffsetInterpolator1._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.fieldOfViewOffsetInterpolator2._set_fraction),this.easeInEaseOut._modifiedFraction_changed.addFieldInterest(this.fieldOfViewOffsetInterpolator3._set_fraction),this.fieldOfViewOffsetInterpolator0._value_changed.addInterest("set_fieldOfViewOffset__",this),this.fieldOfViewOffsetInterpolator1._value_changed.addInterest("set_fieldOfViewOffset__",this),this.fieldOfViewOffsetInterpolator2._value_changed.addInterest("set_fieldOfViewOffset__",this),this.fieldOfViewOffsetInterpolator3._value_changed.addInterest("set_fieldOfViewOffset__",this)},set_fieldOfViewOffset__(){this._fieldOfViewOffset[0]=this.fieldOfViewOffsetInterpolator0._value_changed.getValue(),this._fieldOfViewOffset[1]=this.fieldOfViewOffsetInterpolator1._value_changed.getValue(),this._fieldOfViewOffset[2]=this.fieldOfViewOffsetInterpolator2._value_changed.getValue(),this._fieldOfViewOffset[3]=this.fieldOfViewOffsetInterpolator3._value_changed.getValue()},resetUserOffsets(){Lu.prototype.resetUserOffsets.call(this),this._fieldOfViewOffset[0]=0,this._fieldOfViewOffset[1]=0,this._fieldOfViewOffset[2]=0,this._fieldOfViewOffset[3]=0},getRelativeTransformation(e){const t=Lu.prototype.getRelativeTransformation.call(this,e);return e.constructor===this.constructor&&(t.userMinimumX=e.getUserMinimumX(),t.userMinimumY=e.getUserMinimumY(),t.userMaximumX=e.getUserMaximumX(),t.userMaximumY=e.getUserMaximumY()),t},setInterpolators(e,t){if(e.constructor===this.constructor){const e=t.userMinimumX-this.getMinimumX(),i=t.userMinimumY-this.getMinimumY(),n=t.userMaximumX-this.getMaximumX(),r=t.userMaximumY-this.getMaximumY();this.fieldOfViewOffsetInterpolator0._keyValue=new $n.MFFloat(e,this._fieldOfViewOffset[0]),this.fieldOfViewOffsetInterpolator1._keyValue=new $n.MFFloat(i,this._fieldOfViewOffset[1]),this.fieldOfViewOffsetInterpolator2._keyValue=new $n.MFFloat(n,this._fieldOfViewOffset[2]),this.fieldOfViewOffsetInterpolator3._keyValue=new $n.MFFloat(r,this._fieldOfViewOffset[3]),this.fieldOfViewScaleInterpolator._keyValue=new $n.MFFloat(1,this._fieldOfViewScale.getValue()),this._fieldOfViewOffset[0]=t.offset0,this._fieldOfViewOffset[1]=t.offset1,this._fieldOfViewOffset[2]=t.offset2,this._fieldOfViewOffset[3]=t.offset3,this._fieldOfViewScale=1}else this.fieldOfViewOffsetInterpolator0._keyValue=new $n.MFFloat(this._fieldOfViewOffset[0],this._fieldOfViewOffset[0]),this.fieldOfViewOffsetInterpolator1._keyValue=new $n.MFFloat(this._fieldOfViewOffset[1],this._fieldOfViewOffset[1]),this.fieldOfViewOffsetInterpolator2._keyValue=new $n.MFFloat(this._fieldOfViewOffset[2],this._fieldOfViewOffset[2]),this.fieldOfViewOffsetInterpolator3._keyValue=new $n.MFFloat(this._fieldOfViewOffset[3],this._fieldOfViewOffset[3]),this.fieldOfViewScaleInterpolator._keyValue=new $n.MFFloat(1,this._fieldOfViewOffset.getValue()),this._fieldOfViewOffset=this._fieldOfViewOffset.getValue(),this._fieldOfViewScale=1},getLogarithmicDepthBuffer:()=>!1,getMinimumX(){return this._fieldOfView.length>0?this._fieldOfView[0]:-1},getUserMinimumX(){return(this.getMinimumX()+this._fieldOfViewOffset[0])*this._fieldOfViewScale.getValue()},getMinimumY(){return this._fieldOfView.length>1?this._fieldOfView[1]:-1},getUserMinimumY(){return(this.getMinimumY()+this._fieldOfViewOffset[1])*this._fieldOfViewScale.getValue()},getMaximumX(){return this._fieldOfView.length>2?this._fieldOfView[2]:1},getUserMaximumX(){return(this.getMaximumX()+this._fieldOfViewOffset[2])*this._fieldOfViewScale.getValue()},getMaximumY(){return this._fieldOfView.length>3?this._fieldOfView[3]:1},getUserMaximumY(){return(this.getMaximumY()+this._fieldOfViewOffset[3])*this._fieldOfViewScale.getValue()},getSizeX(){return this.getMaximumX()-this.getMinimumX()},getUserSizeX(){return this.getUserMaximumX()-this.getUserMinimumX()},getSizeY(){return this.getMaximumY()-this.getMinimumY()},getUserSizeY(){return this.getUserMaximumY()-this.getUserMinimumY()},getMaxFarValue:()=>1e4,getScreenScale(e,t,i){const n=t[2],r=t[3],s=this.getUserSizeX(),o=this.getUserSizeY();if(n/r>s/o){const e=o/r;return i.set(e,e,e)}{const e=s/n;return i.set(e,e,e)}},getViewportSize:(()=>{const e=new _t(0,0);return function(t,i){const n=t[2],r=t[3],s=this.getUserSizeX(),o=this.getUserSizeY(),a=n/r;return a>s/o?e.set(o*a,o):e.set(s,s/a)}})(),getLookAtDistance:e=>e.size.magnitude()/2+10,getProjectionMatrixWithLimits(e,t,i){const n=i[2]/i[3],r=this.getUserSizeX(),s=this.getUserSizeY();if(n>r/s){const i=(this.getUserMinimumX()+this.getUserMaximumX())/2,r=s*n/2;return La.ortho(i-r,i+r,this.getUserMinimumY(),this.getUserMaximumY(),e,t,this.projectionMatrix)}{const i=(this.getUserMinimumY()+this.getUserMaximumY())/2,s=r/n/2;return La.ortho(this.getUserMinimumX(),this.getUserMaximumX(),i-s,i+s,e,t,this.projectionMatrix)}},viewAll(e){Lu.prototype.viewAll.call(this,e);const t=e.size,i=t.x/this.getSizeX(),n=t.y/this.getSizeY(),r=1.1*Math.max(i,n);this._fieldOfViewOffset[0]=this.getMinimumX()*r-this.getMinimumX(),this._fieldOfViewOffset[1]=this.getMinimumY()*r-this.getMinimumY(),this._fieldOfViewOffset[2]=this.getMaximumX()*r-this.getMaximumX(),this._fieldOfViewOffset[3]=this.getMaximumY()*r-this.getMaximumY()}}),Object.defineProperties(ff,{typeName:{value:"OrthoViewpoint",enumerable:!0},componentInfo:{value:Object.freeze({name:"Navigation",level:3}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_bind",new $n.SFBool),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"position",new $n.SFVec3f(0,0,10)),new k(d.inputOutput,"orientation",new $n.SFRotation),new k(d.inputOutput,"centerOfRotation",new $n.SFVec3f),new k(d.inputOutput,"fieldOfView",new $n.MFFloat(-1,-1,1,1)),new k(d.inputOutput,"nearDistance",new $n.SFFloat(-1)),new k(d.inputOutput,"farDistance",new $n.SFFloat(-1)),new k(d.inputOutput,"viewAll",new $n.SFBool),new k(d.inputOutput,"jump",new $n.SFBool(!0)),new k(d.inputOutput,"retainUserOffsets",new $n.SFBool),new k(d.outputOnly,"isBound",new $n.SFBool),new k(d.outputOnly,"bindTime",new $n.SFTime),new k(d.inputOutput,"navigationInfo",new $n.SFNode)]),enumerable:!0}});const mf=ff;i.add("OrthoViewpoint","x_ite/Components/Navigation/OrthoViewpoint",mf);const _f=mf;function xf(e){Yr.call(this,e),this.addType(d.ViewpointGroup),this._size.setUnit("length"),this._center.setUnit("length"),this.setCameraObject(!0),this.proximitySensor=new fd(e),this.cameraObjects=[],this.viewpointGroups=[]}Object.assign(Object.setPrototypeOf(xf.prototype,Yr.prototype),{initialize(){Yr.prototype.initialize.call(this),this.proximitySensor.setup(),this._size.addFieldInterest(this.proximitySensor._size),this._center.addFieldInterest(this.proximitySensor._center),this.proximitySensor._size=this._size,this.proximitySensor._center=this._center,this._size.addInterest("set_size__",this),this._children.addInterest("set_children__",this),this.set_size__(),this.set_children__()},set_size__(){this.proximitySensor._enabled=!this._size.getValue().equals(Tt.Zero)},set_children__(){this.cameraObjects.length=0,this.viewpointGroups.length=0;for(const e of this._children){const t=Yl(d.X3DChildNode,e);if(!t)continue;const i=t.getType();for(let e=i.length-1;e>=0;--e)switch(i[e]){case d.X3DViewpointNode:this.cameraObjects.push(t);break;case d.ViewpointGroup:this.cameraObjects.push(t),this.viewpointGroups.push(t)}}},traverse(e,t){const i=this.proximitySensor;switch(e){case Ma.CAMERA:if(i.traverse(e,t),i._isActive.getValue()||!i._enabled.getValue()){t.getViewpointGroups().push(this);for(const i of this.cameraObjects)i.traverse(e,t);t.getViewpointGroups().pop()}return;case Ma.DISPLAY:if(i.traverse(e,t),i._isActive.getValue()||!i._enabled.getValue())for(const i of this.viewpointGroups)i.traverse(e,t);return}}}),Object.defineProperties(xf,{typeName:{value:"ViewpointGroup",enumerable:!0},componentInfo:{value:Object.freeze({name:"Navigation",level:3}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.2",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"displayed",new $n.SFBool(!0)),new k(d.inputOutput,"retainUserOffsets",new $n.SFBool),new k(d.inputOutput,"size",new $n.SFVec3f),new k(d.inputOutput,"center",new $n.SFVec3f),new k(d.inputOutput,"children",new $n.MFNode)]),enumerable:!0}});const yf=xf;i.add("ViewpointGroup","x_ite/Components/Navigation/ViewpointGroup",yf);const wf={name:"Navigation",concreteNodes:[lf,df,gf,ul,_f,Xu,yf],abstractNodes:[Lu]};i.add("Navigation","x_ite/Components/Navigation",wf);const bf=wf;function Sf(e,t,i,n){this.node=null,this.modelViewMatrix=new gi,this.projectionMatrix=new gi,this.viewport=new Gt(0,0,0,0),this.set(e,t,i,n)}Object.assign(Sf.prototype,{set(e,t,i,n){this.node=e,this.modelViewMatrix.assign(t),this.projectionMatrix.assign(i),this.viewport.assign(n)},set_over__(e,t){this.node.set_over__(e,t,this.modelViewMatrix,this.projectionMatrix,this.viewport)},set_active__(e,t){this.node.set_active__(e,t,this.modelViewMatrix,this.projectionMatrix,this.viewport)},set_motion__(e){this.node.set_motion__(e,this.modelViewMatrix,this.projectionMatrix,this.viewport)}});const Tf=Sf;i.add("PointingDeviceSensorContainer","x_ite/Browser/PointingDeviceSensor/PointingDeviceSensorContainer",Tf);const vf=Tf;function Of(e){pu.call(this,e),this.addType(d.X3DPointingDeviceSensorNode)}Object.assign(Object.setPrototypeOf(Of.prototype,pu.prototype),{initialize(){pu.prototype.initialize.call(this),this.getLive().addInterest("set_live__",this),this._enabled.addInterest("set_live__",this),this.set_live__()},set_live__(){this.getLive().getValue()&&this._enabled.getValue()?(this.getBrowser().addPointingDeviceSensor(this),delete this.push):(this.getBrowser().removePointingDeviceSensor(this),this._isActive.getValue()&&(this._isActive=!1),this._isOver.getValue()&&(this._isOver=!1),this.push=Function.prototype)},set_over__(e,t){e!==this._isOver.getValue()&&(this._isOver=e,e&&(this.getBrowser().getNotification()._string=this._description))},set_active__(e,t){e!==this._isActive.getValue()&&(this._isActive=e)},set_motion__(e){},push(e,t){t.push(new vf(this,e.getModelViewMatrix().get(),e.getProjectionMatrix().get(),e.getViewVolume().getViewport()))}}),Object.defineProperties(Of,{typeName:{value:"X3DPointingDeviceSensorNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"PointingDeviceSensor",level:1}),enumerable:!0}});const Ef=Of;i.add("X3DPointingDeviceSensorNode","x_ite/Components/PointingDeviceSensor/X3DPointingDeviceSensorNode",Ef);const Cf=Ef;function Nf(e){Cf.call(this,e),this.addType(d.X3DTouchSensorNode)}Object.assign(Object.setPrototypeOf(Nf.prototype,Cf.prototype),{set_active__(e,t){Cf.prototype.set_active__.call(this,e,t),this._enabled.getValue()&&this._isOver.getValue()&&!e&&(this._touchTime=this.getBrowser().getCurrentTime())},set_over__:(()=>{const e=new gi,t=new _t(0,0);return function(i,n,r,s,o){Cf.prototype.set_over__.call(this,i,n,r,s,o),this._isOver.getValue()&&(t.set(n.texCoord.x,n.texCoord.y).divide(n.texCoord.w),e.assign(r).inverse(),this._hitTexCoord_changed=t,this._hitNormal_changed=r.multMatrixDir(n.normal.copy()).normalize(),this._hitPoint_changed=e.multVecMatrix(n.point.copy()))}})()}),Object.defineProperties(Nf,{typeName:{value:"X3DTouchSensorNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"PointingDeviceSensor",level:1}),enumerable:!0}});const If=Nf;i.add("X3DTouchSensorNode","x_ite/Components/PointingDeviceSensor/X3DTouchSensorNode",If);const Ff=If;function Mf(e){Ff.call(this,e),this.addType(d.TouchSensor),this._hitPoint_changed.setUnit("length")}Object.setPrototypeOf(Mf.prototype,Ff.prototype),Object.defineProperties(Mf,{typeName:{value:"TouchSensor",enumerable:!0},componentInfo:{value:Object.freeze({name:"PointingDeviceSensor",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.outputOnly,"hitTexCoord_changed",new $n.SFVec2f),new k(d.outputOnly,"hitNormal_changed",new $n.SFVec3f),new k(d.outputOnly,"hitPoint_changed",new $n.SFVec3f),new k(d.outputOnly,"isOver",new $n.SFBool),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"touchTime",new $n.SFTime)]),enumerable:!0}});const Df=Mf;i.add("TouchSensor","x_ite/Components/PointingDeviceSensor/TouchSensor",Df);const Rf=Df;function Pf(e){Yu.call(this,e),Ts.call(this,e),this.addType(d.Anchor),this.touchSensorNode=new Rf(e),this.anchorSensors=[]}Object.assign(Object.setPrototypeOf(Pf.prototype,Yu.prototype),Ts.prototype,{initialize(){Yu.prototype.initialize.call(this),Ts.prototype.initialize.call(this),this._description.addFieldInterest(this.touchSensorNode._description),this._load.addFieldInterest(this.touchSensorNode._enabled),this.touchSensorNode._description=this._description,this.touchSensorNode._enabled=this._load,this.touchSensorNode.setup(),this.touchSensorNode.set_active__=(e,t)=>{Rf.prototype.set_active__.call(this.touchSensorNode,e,t),this.touchSensorNode._isOver.getValue()&&!e&&this.requestImmediateLoad().catch(Function.prototype)}},set_load__(){},set_url__(){},requestImmediateLoad(e=!0){return this.setCache(e),this.setLoadState(d.IN_PROGRESS_STATE,!1),new Promise(((e,t)=>{new hh(this).createX3DFromURL(this._url,this._parameter,(i=>{i?(this.getBrowser().replaceWorld(i),this.setLoadState(d.COMPLETE_STATE,!1),e()):(this.setLoadState(d.FAILED_STATE,!1),t())}),(t=>{this.getBrowser().changeViewpoint(t),this.setLoadState(d.COMPLETE_STATE,!1),e()}),((t,i)=>{i?window.open(t,i):location=t,this.setLoadState(d.COMPLETE_STATE,!1),e()}))}))},requestUnload(){},traverse(e,t){if(e===Ma.POINTER){const i=this.anchorSensors;i.length=0,this.touchSensorNode.push(t,i),i.length?(t.getSensors().push(i),Yu.prototype.traverse.call(this,e,t),t.getSensors().pop()):Yu.prototype.traverse.call(this,e,t)}else Yu.prototype.traverse.call(this,e,t)},dispose(){Ts.prototype.dispose.call(this),Yu.prototype.dispose.call(this)}}),Object.defineProperties(Pf,{typeName:{value:"Anchor",enumerable:!0},componentInfo:{value:Object.freeze({name:"Networking",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"load",new $n.SFBool(!0)),new k(d.inputOutput,"url",new $n.MFString),new k(d.inputOutput,"parameter",new $n.MFString),new k(d.inputOutput,"autoRefresh",new $n.SFTime),new k(d.inputOutput,"autoRefreshTimeLimit",new $n.SFTime(3600)),new k(d.inputOutput,"visible",new $n.SFBool(!0)),new k(d.inputOutput,"bboxDisplay",new $n.SFBool),new k(d.initializeOnly,"bboxSize",new $n.SFVec3f(-1,-1,-1)),new k(d.initializeOnly,"bboxCenter",new $n.SFVec3f),new k(d.inputOnly,"addChildren",new $n.MFNode),new k(d.inputOnly,"removeChildren",new $n.MFNode),new k(d.inputOutput,"children",new $n.MFNode)]),enumerable:!0}});const Af=Pf;i.add("Anchor","x_ite/Components/Networking/Anchor",Af);const Vf=Af;function Lf(e){Yr.call(this,e),Ts.call(this,e),zu.call(this,e),this.addType(d.Inline),e.getSpecificationVersion()<=3.3&&(this._global=!0),this.scene=this.getBrowser().getDefaultScene(),this.groupNode=new Ju(e),this.localLights=[],this.localShadows=!1}Object.assign(Object.setPrototypeOf(Lf.prototype,Yr.prototype),Ts.prototype,zu.prototype,{initialize(){Yr.prototype.initialize.call(this),Ts.prototype.initialize.call(this),zu.prototype.initialize.call(this),this.groupNode.setPrivate(!0),this.groupNode.setup(),this.groupNode._isCameraObject.addFieldInterest(this._isCameraObject),this.groupNode._isPickableObject.addFieldInterest(this._isPickableObject),this.requestImmediateLoad().catch(Function.prototype)},getBBox(e,t){return this._bboxSize.getValue().equals(this.getDefaultBBoxSize())?this.groupNode.getBBox(e,t):e.set(this._bboxSize.getValue(),this._bboxCenter.getValue())},set_live__(){Ts.prototype.set_live__.call(this),this.scene.setLive(this.getLive().getValue())},unloadData(){this.abortLoading(),this.setInternalScene(this.getBrowser().getDefaultScene())},loadData(){this.abortLoading(),this.fileLoader=new hh(this).createX3DFromURL(this._url,null,this.setInternalSceneAsync.bind(this))},abortLoading(){this.scene._loadCount.removeInterest("checkLoadCount",this),this.fileLoader&&this.fileLoader.abort()},setInternalSceneAsync(e){e?(e._loadCount.addInterest("checkLoadCount",this),this.setInternalScene(e),this.checkLoadCount(e._loadCount)):(this.setInternalScene(this.getBrowser().getDefaultScene()),this.setLoadState(d.FAILED_STATE))},checkLoadCount(e){e.getValue()||(e.removeInterest("checkLoadCount",this),this.setLoadState(d.COMPLETE_STATE))},setInternalScene(e){this.scene.setLive(!1),this.scene.rootNodes.removeFieldInterest(this.groupNode._children),this.scene=e,this.scene.setExecutionContext(this.getExecutionContext()),this.scene.rootNodes.addFieldInterest(this.groupNode._children),this.groupNode._children=this.scene.rootNodes,this.set_live__(),this.getBrowser().addBrowserEvent()},getInternalScene(){return this.scene},traverse(e,t){switch(e){case Ma.PICKING:{const i=this.getBrowser().getPickingHierarchy();return i.push(this),this.groupNode.traverse(e,t),void i.pop()}case Ma.DISPLAY:if(this._global.getValue())this.groupNode.traverse(e,t);else{const i=t.getGlobalLights(),n=t.getGlobalShadows(),r=i.length,s=n.length,o=this.localLights,a=o.length,l=o.map((e=>e.lightNode.getLightKey()));if(a&&(t.getLocalObjects().push(...o),t.pushLocalShadows(this.localShadows),t.getLocalObjectsKeys().push(...l)),this.groupNode.traverse(e,t),a){if(t.isIndependent()){const e=this.getBrowser();for(let i=0;i<a;++i)e.getLocalObjects().push(t.getLocalObjects().pop())}else for(let e=0;e<a;++e)t.getLocalObjects().pop();t.popLocalShadows(),t.getLocalObjectsKeys().length-=l.length}const u=i.length-r;for(let e=0;e<u;++e){const t=i[r+e];t.groupNode=this.groupNode,t.global=!1,o[e]=t}o.length=u,this.localShadows=n.at(-1),i.length=r,n.length=s}return;default:return void this.groupNode.traverse(e,t)}},dispose(){zu.prototype.dispose.call(this),Ts.prototype.dispose.call(this),Yr.prototype.dispose.call(this)}}),Object.defineProperties(Lf,{typeName:{value:"Inline",enumerable:!0},componentInfo:{value:Object.freeze({name:"Networking",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"global",new $n.SFBool),new k(d.inputOutput,"load",new $n.SFBool(!0)),new k(d.inputOutput,"url",new $n.MFString),new k(d.inputOutput,"autoRefresh",new $n.SFTime),new k(d.inputOutput,"autoRefreshTimeLimit",new $n.SFTime(3600)),new k(d.inputOutput,"visible",new $n.SFBool(!0)),new k(d.inputOutput,"bboxDisplay",new $n.SFBool),new k(d.initializeOnly,"bboxSize",new $n.SFVec3f(-1,-1,-1)),new k(d.initializeOnly,"bboxCenter",new $n.SFVec3f)]),enumerable:!0}});const Bf=Lf;i.add("Inline","x_ite/Components/Networking/Inline",Bf);const Uf=Bf;function Xf(e){pu.call(this,e),this.addType(d.X3DNetworkSensorNode)}Object.setPrototypeOf(Xf.prototype,pu.prototype),Object.defineProperties(Xf,{typeName:{value:"X3DNetworkSensorNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Networking",level:1}),enumerable:!0}});const jf=Xf;i.add("X3DNetworkSensorNode","x_ite/Components/Networking/X3DNetworkSensorNode",jf);const kf=jf;function zf(e){kf.call(this,e),this.addType(d.LoadSensor),e.getSpecificationVersion()<=3.3&&this.addAlias("watchList",this._children),this.urlObjects=[],this.aborted=!1,this.timeOutId=void 0}Object.assign(Object.setPrototypeOf(zf.prototype,kf.prototype),{initialize(){kf.prototype.initialize.call(this),this._enabled.addInterest("set_enabled__",this),this._timeOut.addInterest("set_timeOut__",this),this._children.addInterest("set_children__",this),this.set_children__()},set_enabled__(){this._enabled.getValue()?this.reset():(this.abort(),this.remove())},set_timeOut__(){this._isActive.getValue()&&(this.clearTimeout(),this.aborted=!1,this._timeOut.getValue()>0&&(this.timeOutId=setTimeout(this.abort.bind(this),1e3*this._timeOut.getValue())))},set_children__(){this.reset()},set_loadState__(e){switch(e.checkLoadState()){case d.NOT_STARTED_STATE:break;case d.IN_PROGRESS_STATE:case d.COMPLETE_STATE:case d.FAILED_STATE:this.count()}},count(){const e=this.urlObjects;if(e.length){let t=0,i=0;for(const n of e)t+=n.checkLoadState()==d.COMPLETE_STATE,i+=n.checkLoadState()==d.FAILED_STATE;const n=t===e.length,r=t/e.length;this.aborted||i||n?(this.clearTimeout(),this._isActive=!1,this._isLoaded=n,this._progress=r,n&&(this._loadTime=this.getBrowser().getCurrentTime())):this._isActive.getValue()?this._progress=r:(this._isActive=!0,this._progress=r,this.set_timeOut__())}else this._isActive=!1,this._isLoaded=!1,this._progress=0},abort(){this.clearTimeout(),this.aborted=!0,this._enabled.getValue()&&this.count()},reset(){if(this.remove(),!this._enabled.getValue())return;const e=this.urlObjects;for(const t of this._children){const i=Yl(d.X3DUrlObject,t);i&&(e.push(i),i._loadState.addInterest("set_loadState__",this,i))}this.count()},remove(){this.clearTimeout();const e=this.urlObjects;for(const t of e)t._loadState.removeInterest("set_loadState__",this);e.length=0},clearTimeout(){clearTimeout(this.timeOutId),this.timeOutId=void 0}}),Object.defineProperties(zf,{typeName:{value:"LoadSensor",enumerable:!0},componentInfo:{value:Object.freeze({name:"Networking",level:3}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"timeOut",new $n.SFTime),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"isLoaded",new $n.SFBool),new k(d.outputOnly,"progress",new $n.SFFloat),new k(d.outputOnly,"loadTime",new $n.SFTime),new k(d.inputOutput,"children",new $n.MFNode)]),enumerable:!0}});const Gf=zf;i.add("LoadSensor","x_ite/Components/Networking/LoadSensor",Gf);const Hf=Gf,qf={name:"Networking",concreteNodes:[Vf,Uf,Hf],abstractNodes:[kf,Ts]};i.add("Networking","x_ite/Components/Networking",qf);const Yf=qf;function Wf(e){Cf.call(this,e),this.addType(d.X3DDragSensorNode),this._trackPoint_changed.setUnit("length")}Object.setPrototypeOf(Wf.prototype,Cf.prototype),Object.defineProperties(Wf,{typeName:{value:"X3DDragSensorNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"PointingDeviceSensor",level:1}),enumerable:!0}});const $f=Wf;i.add("X3DDragSensorNode","x_ite/Components/PointingDeviceSensor/X3DDragSensorNode",$f);const Jf=$f;function Kf(e,t){this.axis=e.copy(),this.radius=t}Object.assign(Kf.prototype,{intersectsLine(e,t,i){const n=new ui(this.axis.direction,new Tt(0,1,0)),r=gi.Rotation(n),s=1/this.radius,o=new gi;o.scale(new Tt(s,s,s)),o.multLeft(r);const a=e.point.copy().subtract(this.axis.point),l=new za(a,e.direction).multLineMatrix(o),u=this.unitCylinderIntersectsLine(l,t,i);if(u){const e=o.inverse();e.multVecMatrix(t),t.add(this.axis.point),e.multVecMatrix(i),i.add(this.axis.point)}return u},unitCylinderIntersectsLine(e,t,i){let n,r;const s=e.point,o=e.direction,a=o[0]*o[0]+o[2]*o[2],l=2*(s[0]*o[0]+s[2]*o[2]),u=s[0]*s[0]+s[2]*s[2]-1,h=l*l-4*a*u;if(h<0)return!1;const d=Math.sqrt(h);return l>0?(n=-2*u/(d+l),r=-(d+l)/(2*a)):(n=2*u/(d-l),r=(d-l)/(2*a)),t.assign(o).multiply(n).add(s),i.assign(o).multiply(r).add(s),!0},toString(){return`${this.axis}, ${this.radius}`}});const Zf=Kf;i.add("Cylinder3","standard/Math/Geometry/Cylinder3",Zf);const Qf=Zf;function em(e){Jf.call(this,e),this.addType(d.CylinderSensor),this._diskAngle.setUnit("angle"),this._minAngle.setUnit("angle"),this._maxAngle.setUnit("angle"),this._offset.setUnit("angle")}Object.assign(Object.setPrototypeOf(em.prototype,Jf.prototype),{initialize(){Jf.prototype.initialize.call(this),this._axisRotation.addInterest("set_fields__",this),this._diskAngle.addInterest("set_fields__",this),this.modelViewMatrix=new gi,this.invModelViewMatrix=new gi,this.cylinder=new Qf(new za(new Tt(0,0,0),new Tt(0,0,0)),0),this.disk=!1,this.yPlane=null,this.zPlane=null,this.sxPlane=null,this.szNormal=null,this.behind=!1,this.fromVector=new Tt(0,0,0),this.startOffset=new ui},isBehind(e,t){const i=new Tt(0,0,0),n=new Tt(0,0,0);return this.cylinder.intersectsLine(e,i,n),t.distance(i)>t.distance(n)},getTrackPoint(e,t){const i=new Tt(0,0,0);this.zPlane.intersectsLine(e,i);const n=i.copy().add(this.cylinder.axis.getPerpendicularVectorToPoint(i,new Tt(0,0,0))),r=this.sxPlane.getDistanceToPoint(i)/this.cylinder.radius,s=Math.floor((r+1)/2),o=g.interval(r,-1,1),a=(0===s?Math.asin(o):o*Math.PI/2)+s*Math.PI;new ui(this.cylinder.axis.direction,a).multVecRot(t.assign(this.szNormal).multiply(this.cylinder.radius)),t.add(n)},getAngle(e){return e.getAxis(new Tt(0,0,0)).dot(this.cylinder.axis.direction)>0?e.angle:-e.angle},set_fields__(){this._isActive.getValue()&&(this.activate(this.activateHit),this.set_motion__(this.motionHit??this.activateHit))},set_active__(e,t,i,n,r){Jf.prototype.set_active__.call(this,e,t,i,n,r),this._isActive.getValue()?(this.activateHit=t.copy(),this.motionHit=null,this.modelViewMatrix.assign(i),this.invModelViewMatrix.assign(i).inverse(),this.activate(t)):this._autoOffset.getValue()&&(this._offset=this.getAngle(this._rotation_changed.getValue()))},activate(e){const t=e.hitRay.copy().multLineMatrix(this.invModelViewMatrix),i=this.invModelViewMatrix.multVecMatrix(e.point.copy()),n=this._axisRotation.getValue().multVecRot(new Tt(0,1,0)),r=this.invModelViewMatrix.multDirMatrix(new Tt(0,0,1)).normalize(),s=new za(new Tt(0,0,0),n),o=s.getPerpendicularVectorToPoint(i,new Tt(0,0,0)).magnitude();this.cylinder=new Qf(s,o),this.disk=Math.abs(r.dot(n))>Math.cos(this._diskAngle.getValue()),this.behind=this.isBehind(t,i),this.yPlane=new da(i,n),this.zPlane=new da(i,r);const a=this.invModelViewMatrix.origin,l=n.copy().cross(a).normalize();this.sxPlane=new da(new Tt(0,0,0),l),this.szNormal=l.copy().cross(n).normalize();const u=new Tt(0,0,0);this.disk?this.yPlane.intersectsLine(t,u):this.getTrackPoint(t,u),this.fromVector=this.cylinder.axis.getPerpendicularVectorToPoint(u,new Tt(0,0,0)).negate(),this.startOffset=new ui(n,this._offset.getValue()),this._trackPoint_changed=u,this._rotation_changed=this.startOffset,this.angle=this._offset.getValue(),this.startVector=this._rotation_changed.getValue().multVecRot(this._axisRotation.getValue().multVecRot(new Tt(0,0,1)))},set_motion__(e){this.motionHit=e.copy();const t=e.hitRay.copy().multLineMatrix(this.invModelViewMatrix),i=new Tt(0,0,0);this.disk?this.yPlane.intersectsLine(t,i):this.getTrackPoint(t,i),this._trackPoint_changed=i;const n=this.cylinder.axis.getPerpendicularVectorToPoint(i,new Tt(0,0,0)).negate(),r=new ui(this.fromVector,n);if(this.disk){this.modelViewMatrix.multVecMatrix(i.copy()).z>0&&r.multRight(new ui(this.yPlane.normal,Math.PI))}else this.behind&&r.inverse();if(r.multLeft(this.startOffset),this._minAngle.getValue()>this._maxAngle.getValue())this._rotation_changed=r;else{const e=r.multVecRot(this._axisRotation.getValue().multVecRot(new Tt(0,0,1))),t=new ui(this.startVector,e),i=this._axisRotation.getValue().multVecRot(new Tt(0,1,0)).dot(t.getAxis(new Tt(0,0,0)))>0?1:-1,n=this._minAngle.getValue(),s=this._maxAngle.getValue();this.angle+=i*t.angle,this.startVector.assign(e),this.angle<n?r.setAxisAngle(this.cylinder.axis.direction,n):this.angle>s?r.setAxisAngle(this.cylinder.axis.direction,s):r.setAxisAngle(this.cylinder.axis.direction,this.angle),this._rotation_changed.getValue().equals(r)||(this._rotation_changed=r)}}}),Object.defineProperties(em,{typeName:{value:"CylinderSensor",enumerable:!0},componentInfo:{value:Object.freeze({name:"PointingDeviceSensor",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"axisRotation",new $n.SFRotation(0,0,1,0)),new k(d.inputOutput,"diskAngle",new $n.SFFloat(.26179167)),new k(d.inputOutput,"minAngle",new $n.SFFloat),new k(d.inputOutput,"maxAngle",new $n.SFFloat(-1)),new k(d.inputOutput,"offset",new $n.SFFloat),new k(d.inputOutput,"autoOffset",new $n.SFBool(!0)),new k(d.outputOnly,"trackPoint_changed",new $n.SFVec3f),new k(d.outputOnly,"rotation_changed",new $n.SFRotation),new k(d.outputOnly,"isOver",new $n.SFBool),new k(d.outputOnly,"isActive",new $n.SFBool)]),enumerable:!0}});const tm=em;i.add("CylinderSensor","x_ite/Components/PointingDeviceSensor/CylinderSensor",tm);const im=tm;function nm(e,t){this.point=e.copy(),this.direction=t.copy()}Object.assign(nm.prototype,{copy(){const e=Object.create(nm.prototype);return e.point=this.point.copy(),e.direction=this.direction.copy(),e},assign(e){return this.point.assign(e.point),this.direction.assign(e.direction),this},set(e,t){return this.point.assign(e),this.direction.assign(t),this},setPoints(e,t){return this.point.assign(e),this.direction.assign(t).subtract(e).normalize(),this},multMatrixLine(e){return e.multMatrixVec(this.point),e.multMatrixDir(this.direction).normalize(),this},multLineMatrix(e){return e.multVecMatrix(this.point),e.multDirMatrix(this.direction).normalize(),this},getClosestPointToPoint(e,t){const i=t.assign(e).subtract(this.point).dot(this.direction);return t.assign(this.direction).multiply(i).add(this.point)},getPerpendicularVectorToPoint:(()=>{const e=new _t(0,0);return function(t,i){return i.assign(this.point).subtract(t),i.subtract(e.assign(this.direction).multiply(i.dot(this.direction)))}})(),intersectsLine:(()=>{const e=new _t(0,0);return function(t,i){const{point:n,direction:r}=this,{point:s,direction:o}=t,a=r.dot(o);if(Math.abs(a)>=1)return!1;e.assign(s).subtract(n);const l=(e.dot(r)-a*e.dot(o))/(1-a*a);return i.assign(r).multiply(l).add(n),!0}})(),toString(){return`${this.point}, ${this.direction}`}}),Object.assign(nm,{Points(e,t){const i=Object.create(nm.prototype);return i.point=e.copy(),i.direction=t.copy().subtract(e).normalize(),i}});const rm=nm;i.add("Line2","standard/Math/Geometry/Line2",rm);const sm=new rm(_t.Zero,_t.Zero),om=new _t(0,0,0),am=new za(Tt.Zero,Tt.Zero);function lm(e){Jf.call(this,e),this.addType(d.PlaneSensor),this._offset.setUnit("length"),this._minPosition.setUnit("length"),this._maxPosition.setUnit("length"),this._translation_changed.setUnit("length")}Object.assign(Object.setPrototypeOf(lm.prototype,Jf.prototype),{initialize(){Jf.prototype.initialize.call(this),this._axisRotation.addInterest("set_fields__",this),this._minPosition.addInterest("set_fields__",this),this._maxPosition.addInterest("set_fields__",this),this.modelViewMatrix=new gi,this.invModelViewMatrix=new gi,this.projectionMatrix=new gi,this.viewport=new Gt,this.planeSensor=!0,this.plane=null,this.line=null,this.startOffset=new Tt(0,0,0),this.startPoint=new Tt(0,0,0)},getLineTrackPoint(e,t,i){return Oa.projectLine(t,this.modelViewMatrix,this.projectionMatrix,this.viewport,sm),sm.getClosestPointToPoint(e,om),Oa.unProjectRay(om.x,om.y,this.modelViewMatrix,this.projectionMatrix,this.viewport,am),t.getClosestPointToLine(am,i)},set_fields__(){this._isActive.getValue()&&(this.activate(this.activateHit),this.set_motion__(this.motionHit??this.activateHit))},set_active__(e,t,i,n,r){Jf.prototype.set_active__.call(this,e,t,i,n,r),this._isActive.getValue()?(this.activateHit=t.copy(),this.motionHit=null,this.modelViewMatrix.assign(i),this.projectionMatrix.assign(n),this.viewport.assign(r),this.invModelViewMatrix.assign(i).inverse(),this.activate(t)):this._autoOffset.getValue()&&(this._offset=this._translation_changed)},activate(e){const t=e.hitRay.copy().multLineMatrix(this.invModelViewMatrix),i=this.invModelViewMatrix.multVecMatrix(e.point.copy()),n=this._axisRotation.getValue();if(this._minPosition.x===this._maxPosition.x){this.planeSensor=!1;const e=n.multVecRot(new Tt(0,Math.abs(this._maxPosition.y-this._minPosition.y),0));this.line=new za(i,e.normalize())}else if(this._minPosition.y===this._maxPosition.y){this.planeSensor=!1;const e=n.multVecRot(new Tt(Math.abs(this._maxPosition.x-this._minPosition.x),0,0));this.line=new za(i,e.normalize())}else this.planeSensor=!0,this.plane=new da(i,n.multVecRot(new Tt(0,0,1)));if(this.planeSensor)this.plane.intersectsLine(t,this.startPoint)&&this.trackStart(this.startPoint);else if(this.getLineTrackPoint(e.pointer,this.line,this.startPoint)){const t=new Tt(0,0,0);try{this.getLineTrackPoint(e.pointer,new za(this.line.direction,this.line.direction),t)}catch{t.assign(this.startPoint)}this.trackStart(t)}},trackStart(e){this.startOffset.assign(this._offset.getValue()),this._trackPoint_changed=e,this._translation_changed=this._offset.getValue()},set_motion__(e){try{if(this.motionHit=e.copy(),this.planeSensor){const t=e.hitRay.copy().multLineMatrix(this.invModelViewMatrix),i=new Tt(0,0,0);if(!this.plane.intersectsLine(t,i))throw new Error("Plane and line are parallel.");this.track(i,i.copy())}else{const t=new Tt(0,0,0),i=new Tt(0,0,0);if(!this.getLineTrackPoint(e.pointer,this.line,t))throw new Error("Lines are parallel.");try{this.getLineTrackPoint(e.pointer,new za(Tt.Zero,this.line.direction),i)}catch{i.assign(t)}this.track(t,i)}}catch{this._trackPoint_changed.addEvent(),this._translation_changed.addEvent()}},track(e,t){const i=this._axisRotation.getValue(),n=i.copy().inverse().multVecRot(e.add(this.startOffset).subtract(this.startPoint));this._minPosition.x>this._maxPosition.x||(n.x=g.clamp(n.x,this._minPosition.x,this._maxPosition.x)),this._minPosition.y>this._maxPosition.y||(n.y=g.clamp(n.y,this._minPosition.y,this._maxPosition.y)),i.multVecRot(n),this._trackPoint_changed.getValue().equals(t)||(this._trackPoint_changed=t),this._translation_changed.getValue().equals(n)||(this._translation_changed=n)}}),Object.defineProperties(lm,{typeName:{value:"PlaneSensor",enumerable:!0},componentInfo:{value:Object.freeze({name:"PointingDeviceSensor",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"axisRotation",new $n.SFRotation),new k(d.inputOutput,"autoOffset",new $n.SFBool(!0)),new k(d.inputOutput,"offset",new $n.SFVec3f),new k(d.inputOutput,"minPosition",new $n.SFVec2f),new k(d.inputOutput,"maxPosition",new $n.SFVec2f(-1,-1)),new k(d.outputOnly,"trackPoint_changed",new $n.SFVec3f),new k(d.outputOnly,"translation_changed",new $n.SFVec3f),new k(d.outputOnly,"isOver",new $n.SFBool),new k(d.outputOnly,"isActive",new $n.SFBool)]),enumerable:!0}});const um=lm;i.add("PlaneSensor","x_ite/Components/PointingDeviceSensor/PlaneSensor",um);const hm=um;function dm(e,t){this.radius=e,this.center=t.copy()}Object.assign(dm.prototype,{set(e,t){this.radius=e,this.center.assign(t)},intersectsLine(e,t,i){const{point:n,direction:r}=e,{center:s,radius:o}=this,a=2*(n.dot(r)-s.dot(r)),l=a*a-4*(n.x*n.x+n.y*n.y+n.z*n.z+(s.x*s.x+s.y*s.y+s.z*s.z)-2*n.dot(s)-o*o);if(l>=0){let e=(-a+Math.sqrt(l))/2,s=(-a-Math.sqrt(l))/2;if(e>s){const t=e;e=s,s=t}return t.assign(r).multiply(e).add(n),i.assign(r).multiply(s).add(n),!0}return!1},intersectsTriangle:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0),i=new Tt(0,0,0),n=new Tt(0,0,0),r=new Tt(0,0,0),s=new Tt(0,0,0),o=new Tt(0,0,0);return function(a,l,u){const h=this.center,d=this.radius;a.subtract(h),l.subtract(h),u.subtract(h),e.assign(l).subtract(a),t.assign(u).subtract(a);const c=d*d,p=e.cross(t),g=a.dot(p);if(g*g>c*p.dot(p))return!1;const f=a.dot(a),m=a.dot(l),_=a.dot(u),x=l.dot(l),y=l.dot(u),w=u.dot(u);if(f>c&&m>f&&_>f||x>c&&m>x&&y>x||w>c&&_>w&&y>w)return!1;e.assign(l).subtract(a),i.assign(u).subtract(l),n.assign(a).subtract(u);const b=m-f,S=y-x,T=_-w,v=e.dot(e),O=i.dot(i),E=n.dot(n);r.assign(a).multiply(v).subtract(e.multiply(b)),s.assign(l).multiply(O).subtract(i.multiply(S)),o.assign(u).multiply(E).subtract(n.multiply(T));const C=u.multiply(v).subtract(r),N=a.multiply(O).subtract(s),I=l.multiply(E).subtract(o),F=r.dot(r)>c*v*v&&r.dot(C)>0,M=s.dot(s)>c*O*O&&s.dot(N)>0,D=o.dot(o)>c*E*E&&o.dot(I)>0;return!(F||M||D)}})(),toString(){return`${this.radius} ${this.center}`}});const cm=dm;i.add("Sphere3","standard/Math/Geometry/Sphere3",cm);const pm=cm;function gm(e){Jf.call(this,e),this.addType(d.SphereSensor)}Object.assign(Object.setPrototypeOf(gm.prototype,Jf.prototype),{initialize(){Jf.prototype.initialize.call(this),this.modelViewMatrix=new gi,this.invModelViewMatrix=new gi,this.sphere=null,this.zPlane=null,this.behind=!1,this.fromVector=new Tt(0,0,0),this.startPoint=new Tt(0,0,0),this.startOffset=new ui},getTrackPoint(e,t,i){const n=new Tt(0,0,0);return!!this.sphere.intersectsLine(e,t,n)&&((e.point.distance(n)<e.point.distance(t))-i&&t.assign(n),!0)},set_active__(e,t,i,n,r){if(Jf.prototype.set_active__.call(this,e,t,i,n,r),this._isActive.getValue()){this.modelViewMatrix.assign(i),this.invModelViewMatrix.assign(i).inverse();const e=this.invModelViewMatrix.multVecMatrix(t.point.copy()),n=new Tt(0,0,0);this.zPlane=new da(n,this.invModelViewMatrix.multDirMatrix(new Tt(0,0,1)).normalize()),this.sphere=new pm(e.magnitude(),n),this.behind=this.zPlane.getDistanceToPoint(e)<0,this.fromVector.assign(e),this.startPoint.assign(e),this.startOffset.assign(this._offset.getValue()),this._trackPoint_changed=e,this._rotation_changed=this._offset.getValue()}else this._autoOffset.getValue()&&(this._offset=this._rotation_changed)},set_motion__(e){const t=e.hitRay.copy().multLineMatrix(this.invModelViewMatrix),i=new Tt(0,0,0);if(this.getTrackPoint(t,i,this.behind)){const e=this.invModelViewMatrix.multDirMatrix(new Tt(0,0,1)).normalize();this.zPlane=new da(i,e)}else{const e=new Tt(0,0,0);this.zPlane.intersectsLine(t,e),t.set(e,this.sphere.center.copy().subtract(e).normalize()),this.getTrackPoint(t,i,!1);const n=fa.normal(this.sphere.center,i,this.startPoint,new Tt(0,0,0)),r=i.copy().subtract(this.sphere.center).normalize(),s=n.copy().cross(r).normalize(),o=i.copy().subtract(s.multiply(e.copy().subtract(i).magnitude()));t.set(o,this.sphere.center.copy().subtract(o).normalize()),this.getTrackPoint(t,i,!1)}this._trackPoint_changed=i;const n=i.copy().subtract(this.sphere.center),r=new ui(this.fromVector,n);this.behind&&r.inverse(),this._rotation_changed=this.startOffset.copy().multRight(r)}}),Object.defineProperties(gm,{typeName:{value:"SphereSensor",enumerable:!0},componentInfo:{value:Object.freeze({name:"PointingDeviceSensor",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"autoOffset",new $n.SFBool(!0)),new k(d.inputOutput,"offset",new $n.SFRotation(0,1,0,0)),new k(d.outputOnly,"trackPoint_changed",new $n.SFVec3f),new k(d.outputOnly,"rotation_changed",new $n.SFRotation),new k(d.outputOnly,"isOver",new $n.SFBool),new k(d.outputOnly,"isActive",new $n.SFBool)]),enumerable:!0}});const fm=gm;i.add("SphereSensor","x_ite/Components/PointingDeviceSensor/SphereSensor",fm);const mm={name:"PointingDeviceSensor",concreteNodes:[im,hm,fm,Rf],abstractNodes:[Jf,Cf,Ff]};i.add("PointingDeviceSensor","x_ite/Components/PointingDeviceSensor",mm);const _m=mm,xm=dl(ym);function ym(){this.plane=new da(Tt.Zero,Tt.Zero)}function wm(e){Yr.call(this,e),this.addType(d.ClipPlane),this.enabled=!1,this.plane=new Gt(0,0,0,0)}Object.assign(ym.prototype,{isClipped(e){return this.plane.getDistanceToPoint(e)<0},set(e,t){const i=this.plane,n=e.plane;i.normal.assign(n),i.distanceFromOrigin=-n.w,i.multRight(t)},setShaderUniforms(e,t){const i=this.plane,n=i.normal;e.uniform4f(t.x3d_ClipPlane[t.numClipPlanes++],n.x,n.y,n.z,i.distanceFromOrigin)},dispose(){xm.push(this)}}),Object.assign(Object.setPrototypeOf(wm.prototype,Yr.prototype),{getClipPlaneKey:()=>0,initialize(){Yr.prototype.initialize.call(this),this._enabled.addInterest("set_enabled__",this),this._plane.addInterest("set_enabled__",this),this.set_enabled__()},set_enabled__(){this.plane.assign(this._plane.getValue()),this.enabled=this._enabled.getValue()&&!this.plane.equals(Gt.Zero)},push(e){if(this.enabled){const t=xm.pop();t.set(this,e.getModelViewMatrix().get()),e.getLocalObjects().push(t),e.getLocalObjectsKeys().push(this.getClipPlaneKey())}},pop(e){this.enabled&&(this.getBrowser().getLocalObjects().push(e.getLocalObjects().pop()),e.getLocalObjectsKeys().pop())}}),Object.defineProperties(wm,{typeName:{value:"ClipPlane",enumerable:!0},componentInfo:{value:Object.freeze({name:"Rendering",level:5}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.2",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"plane",new $n.SFVec4f(0,1,0,0))]),enumerable:!0}});const bm=wm;i.add("ClipPlane","x_ite/Components/Rendering/ClipPlane",bm);const Sm=bm;function Tm(e){Qh.call(this,e),this.addType(d.X3DColorNode),this.addChildObjects(d.outputOnly,"transparent",new $n.SFBool)}Object.assign(Object.setPrototypeOf(Tm.prototype,Qh.prototype),{setTransparent(e){e!==this._transparent.getValue()&&(this._transparent=e)},isTransparent(){return this._transparent.getValue()}}),Object.defineProperties(Tm,{typeName:{value:"X3DColorNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Rendering",level:1}),enumerable:!0}});const vm=Tm;i.add("X3DColorNode","x_ite/Components/Rendering/X3DColorNode",vm);const Om=vm;function Em(e){Om.call(this,e),this.addType(d.Color)}Object.assign(Object.setPrototypeOf(Em.prototype,Om.prototype),{initialize(){Om.prototype.initialize.call(this),this._color.addInterest("set_color__",this),this.set_color__()},set_color__(){this.color=this._color.getValue(),this.length=this._color.length},addColor(e,t){if(e>=0&&this.length){const i=this.color,n=e%this.length*3;return t.push(i[n],i[n+1],i[n+2],1)}t.push(1,1,1,1)},addColors(e,t=this.length){const i=this.length;if(i){const n=this.color;for(let r=0;r<t;++r){const t=r%i*3;e.push(n[t],n[t+1],n[t+2],1)}}else for(let i=0;i<t;++i)e.push(1,1,1,1);return e}}),Object.defineProperties(Em,{typeName:{value:"Color",enumerable:!0},componentInfo:{value:Object.freeze({name:"Rendering",level:1}),enumerable:!0},containerField:{value:"color",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"color",new $n.MFColor)]),enumerable:!0}});const Cm=Em;i.add("Color","x_ite/Components/Rendering/Color",Cm);const Nm=Cm;function Im(e){Om.call(this,e),this.addType(d.ColorRGBA),this.setTransparent(!0)}Object.assign(Object.setPrototypeOf(Im.prototype,Om.prototype),{initialize(){Om.prototype.initialize.call(this),this._color.addInterest("set_color__",this),this.set_color__()},set_color__(){this.color=this._color.getValue(),this.length=this._color.length},addColor(e,t){if(e>=0&&this.length){const i=this.color,n=e%this.length*4;return t.push(i[n],i[n+1],i[n+2],i[n+3])}t.push(1,1,1,1)},addColors(e,t=this.length){const i=this.length;if(i){const n=this.color;for(let r=0;r<t;++r){const t=r%i*4;e.push(n[t],n[t+1],n[t+2],n[t+3])}}else for(let i=0;i<t;++i)e.push(1,1,1,1);return e}}),Object.defineProperties(Im,{typeName:{value:"ColorRGBA",enumerable:!0},componentInfo:{value:Object.freeze({name:"Rendering",level:1}),enumerable:!0},containerField:{value:"color",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"color",new $n.MFColorRGBA)]),enumerable:!0}});const Fm=Im;i.add("ColorRGBA","x_ite/Components/Rendering/ColorRGBA",Fm);const Mm=Fm;function Dm(e){Qh.call(this,e),this.addType(d.X3DCoordinateNode)}Object.assign(Object.setPrototypeOf(Dm.prototype,Qh.prototype),{initialize(){Qh.prototype.initialize.call(this),this._point.addInterest("set_point__",this),this.set_point__()},set_point__(){this.point=this._point.getValue(),this.length=this._point.length},isEmpty(){return 0===this.length},getSize(){return this.length},set1Point(e,t){this._point[e]=t},get1Point(e,t){if(e<this.length){const i=this.point;return e*=3,t.set(i[e],i[e+1],i[e+2])}return t.set(0,0,0)},addPoint(e,t){if(e<this.length){const i=this.point;e*=3,t.push(i[e],i[e+1],i[e+2],1)}else t.push(0,0,0,1)},addPoints(e){const t=this.point,i=3*this.length;for(let n=0;n<i;n+=3)e.push(t[n],t[n+1],t[n+2],1);return e},getNormal:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0),i=new Tt(0,0,0);return function(n,r,s){const o=this.length;return n<o&&r<o&&s<o?fa.normal(this.get1Point(n,e),this.get1Point(r,t),this.get1Point(s,i),new Tt(0,0,0)):new Tt(0,0,0)}})(),getQuadNormal:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0),i=new Tt(0,0,0),n=new Tt(0,0,0);return function(r,s,o,a){const l=this.length;return r<l&&s<l&&o<l&&a<l?fa.quadNormal(this.get1Point(r,e),this.get1Point(s,t),this.get1Point(o,i),this.get1Point(a,n),new Tt(0,0,0)):new Tt(0,0,0)}})()}),Object.defineProperties(Dm,{typeName:{value:"X3DCoordinateNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Rendering",level:1}),enumerable:!0}});const Rm=Dm;i.add("X3DCoordinateNode","x_ite/Components/Rendering/X3DCoordinateNode",Rm);const Pm=Rm;function Am(e){Pm.call(this,e),this.addType(d.Coordinate),this._point.setUnit("length")}Object.setPrototypeOf(Am.prototype,Pm.prototype),Object.defineProperties(Am,{typeName:{value:"Coordinate",enumerable:!0},componentInfo:{value:Object.freeze({name:"Rendering",level:1}),enumerable:!0},containerField:{value:"coord",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"point",new $n.MFVec3f)]),enumerable:!0}});const Vm=Am;i.add("Coordinate","x_ite/Components/Rendering/Coordinate",Vm);const Lm=Vm;function Bm(e){Pm.call(this,e),this.addType(d.CoordinateDouble)}Object.setPrototypeOf(Bm.prototype,Pm.prototype),Object.defineProperties(Bm,{typeName:{value:"CoordinateDouble",enumerable:!0},componentInfo:{value:Object.freeze({name:"Rendering",level:1}),enumerable:!0},containerField:{value:"coord",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"point",new $n.MFVec3d)]),enumerable:!0}});const Um=Bm;i.add("CoordinateDouble","x_ite/Components/Rendering/CoordinateDouble",Um);const Xm=Um;function jm(e){this.getExecutionContext()||Il.call(this,e);const t=this.getBrowser().getContext();this.lineStipples=new Float32Array,this.lineStippleBuffer=t.createBuffer(),this.trianglesBuffer=t.createBuffer(),this.thickVertexArrayObject=new Sl(t),this.setGeometryType(1),this.setPrimitiveMode(t.LINES),this.setSolid(!1)}Object.assign(Object.setPrototypeOf(jm.prototype,Il.prototype),{intersectsLine:()=>!1,intersectsBox:()=>!1,updateVertexArrays(){Il.prototype.updateVertexArrays.call(this),this.thickVertexArrayObject.update()},buildTexCoords(){if(this.lineStipples.length/6==this.getVertices().length/8)return;const e=this.getBrowser().getContext(),t=this.getVertices().length/8;this.lineStipples=new Float32Array(6*t),e.bindBuffer(e.ARRAY_BUFFER,this.lineStippleBuffer),e.bufferData(e.ARRAY_BUFFER,this.lineStipples,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.trianglesBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(96*t),e.DYNAMIC_DRAW)},updateLengthSoFar:(()=>{const e=new gi,t=new Gt(0,0,0,0),i=new Gt(0,0,0,0),n=new _t(0,0),r=new _t(0,0);return function(s,o){const a=o.renderObject.getViewVolume().getViewport(),l=o.renderObject.getProjectionMatrix().get(),u=this.lineStipples,h=this.getVertices().getValue(),d=h.length;e.assign(o.modelViewMatrix).multRight(l);let c=0;for(let s=0,o=0;s<d;s+=8,o+=6)t.set(h[s],h[s+1],h[s+2],h[s+3]),i.set(h[s+4],h[s+5],h[s+6],h[s+7]),Oa.projectPointMatrix(t,e,a,n),Oa.projectPointMatrix(i,e,a,r),u[o]=r.x,u[o+1]=r.y,u[o+3]=n.x,u[o+4]=n.y,u[o+5]=c,c+=r.subtract(n).magnitude();s.bindBuffer(s.ARRAY_BUFFER,this.lineStippleBuffer),s.bufferData(s.ARRAY_BUFFER,u,s.DYNAMIC_DRAW)}})(),displaySimple(e,t,i){const n=t.shapeNode.getAppearance().getStyleProperties(1);if(n&&n.getTransformLines()){if(this.thickVertexArrayObject.enable(i.getProgram())){const t=16*Float32Array.BYTES_PER_ELEMENT,n=0,r=1*Float32Array.BYTES_PER_ELEMENT,s=9*Float32Array.BYTES_PER_ELEMENT,o=12*Float32Array.BYTES_PER_ELEMENT;i.enableCoordIndexAttribute(e,this.trianglesBuffer,t,n),i.enableLineStippleAttribute(e,this.trianglesBuffer,t,r),this.hasNormals&&i.enableNormalAttribute(e,this.trianglesBuffer,t,s),i.enableVertexAttribute(e,this.trianglesBuffer,t,o),e.bindBuffer(e.ARRAY_BUFFER,null)}return e.frontFace(e.CCW),e.enable(e.CULL_FACE),void e.drawArrays(e.TRIANGLES,0,3*this.vertexCount)}this.vertexArrayObject.enable(i.getProgram())&&(this.coordIndices.length&&i.enableCoordIndexAttribute(e,this.coordIndexBuffer,0,0),i.enableLineStippleAttribute(e,this.lineStippleBuffer,0,0),this.hasNormals&&i.enableNormalAttribute(e,this.normalBuffer,0,0),i.enableVertexAttribute(e,this.vertexBuffer,0,0)),e.drawArrays(this.primitiveMode,0,this.vertexCount),e.lineWidth(1)},display:(()=>{const e=new gi,t=new Float32Array(16),i=new Float32Array(16);return function(n,r){const s=this.getBrowser(),o=r.appearanceNode,a=o.getLineProperties(),l=o.getShader(this,r),u=o.getRenderModes(),h=this.getAttrib(),d=this.getAttribBuffers();if(a&&(a.getApplied()&&1!==a.getLinetype()&&this.updateLengthSoFar(n,r),a.getTransformLines())){const o=r.renderObject,h=o.getViewVolume().getViewport(),d=o.getProjectionMatrix().get(),c=s.getWireframe()?n.TRIANGLES:s.getPrimitiveMode(n.TRIANGLES),p=s.getLineTransformShader();if(t.set(e.assign(r.modelViewMatrix).multRight(d)),i.set(e.inverse()),p.enable(n),n.uniform4f(p.viewport,h.x,h.y,h.z,h.w),n.uniformMatrix4fv(p.modelViewProjectionMatrix,!1,t),n.uniformMatrix4fv(p.invModelViewProjectionMatrix,!1,i),n.uniform1f(p.scale,a.getLinewidthScaleFactor()/2),this.thickVertexArrayObject.enable(p.getProgram())){const e=2*Float32Array.BYTES_PER_ELEMENT,t=0,i=1*Float32Array.BYTES_PER_ELEMENT,r=6*Float32Array.BYTES_PER_ELEMENT,s=0,o=3*Float32Array.BYTES_PER_ELEMENT,a=2*Float32Array.BYTES_PER_ELEMENT,l=0,u=1*Float32Array.BYTES_PER_ELEMENT,h=8*Float32Array.BYTES_PER_ELEMENT,d=0,c=4*Float32Array.BYTES_PER_ELEMENT,g=6*Float32Array.BYTES_PER_ELEMENT,f=0,m=3*Float32Array.BYTES_PER_ELEMENT,_=8*Float32Array.BYTES_PER_ELEMENT,x=0,y=4*Float32Array.BYTES_PER_ELEMENT;this.coordIndices.length&&(p.enableFloatAttrib(n,"x3d_CoordIndex0",this.coordIndexBuffer,1,e,t),p.enableFloatAttrib(n,"x3d_CoordIndex1",this.coordIndexBuffer,1,e,i)),p.enableFloatAttrib(n,"x3d_LineStipple0",this.lineStippleBuffer,3,r,s),p.enableFloatAttrib(n,"x3d_LineStipple1",this.lineStippleBuffer,3,r,o),this.hasFogCoords&&(p.enableFloatAttrib(n,"x3d_FogDepth0",this.fogDepthBuffer,1,a,l),p.enableFloatAttrib(n,"x3d_FogDepth1",this.fogDepthBuffer,1,a,u)),this.colorMaterial&&(p.enableFloatAttrib(n,"x3d_Color0",this.colorBuffer,4,h,d),p.enableFloatAttrib(n,"x3d_Color1",this.colorBuffer,4,h,c)),this.hasNormals&&(p.enableFloatAttrib(n,"x3d_Normal0",this.normalBuffer,3,g,f),p.enableFloatAttrib(n,"x3d_Normal1",this.normalBuffer,3,g,m)),p.enableFloatAttrib(n,"x3d_Vertex0",this.vertexBuffer,4,_,x),p.enableFloatAttrib(n,"x3d_Vertex1",this.vertexBuffer,4,_,y)}n.bindTransformFeedback(n.TRANSFORM_FEEDBACK,s.getLineTransformFeedback()),n.bindBufferBase(n.TRANSFORM_FEEDBACK_BUFFER,0,this.trianglesBuffer),n.enable(n.RASTERIZER_DISCARD),n.beginTransformFeedback(n.POINTS),n.drawArraysInstanced(n.POINTS,0,this.vertexCount/2,2),n.endTransformFeedback(),n.disable(n.RASTERIZER_DISCARD),n.bindTransformFeedback(n.TRANSFORM_FEEDBACK,null);for(const e of u)e.enable(n);if(l.enable(n),l.setUniforms(n,this,r),this.thickVertexArrayObject.enable(l.getProgram())){const e=16*Float32Array.BYTES_PER_ELEMENT,t=0,i=1*Float32Array.BYTES_PER_ELEMENT,r=4*Float32Array.BYTES_PER_ELEMENT,s=5*Float32Array.BYTES_PER_ELEMENT,o=9*Float32Array.BYTES_PER_ELEMENT,a=12*Float32Array.BYTES_PER_ELEMENT;l.enableCoordIndexAttribute(n,this.trianglesBuffer,e,t),l.enableLineStippleAttribute(n,this.trianglesBuffer,e,i),this.hasFogCoords&&l.enableFogDepthAttribute(n,this.trianglesBuffer,e,r),this.colorMaterial&&l.enableColorAttribute(n,this.trianglesBuffer,e,s),this.hasNormals&&l.enableNormalAttribute(n,this.trianglesBuffer,e,o),l.enableVertexAttribute(n,this.trianglesBuffer,e,a),n.bindBuffer(n.ARRAY_BUFFER,null)}n.frontFace(n.CCW),n.enable(n.CULL_FACE),n.drawArrays(c,0,3*this.vertexCount);for(const e of u)e.disable(n);return}const c=s.getPrimitiveMode(this.getPrimitiveMode());for(const e of u)e.enable(n);if(l.enable(n),l.setUniforms(n,this,r),this.vertexArrayObject.enable(l.getProgram())){this.coordIndices.length&&l.enableCoordIndexAttribute(n,this.coordIndexBuffer,0,0);for(let e=0,t=h.length;e<t;++e)h[e].enable(n,l,d[e]);l.enableLineStippleAttribute(n,this.lineStippleBuffer,0,0),this.hasFogCoords&&l.enableFogDepthAttribute(n,this.fogDepthBuffer,0,0),this.colorMaterial&&l.enableColorAttribute(n,this.colorBuffer,0,0),this.hasNormals&&l.enableNormalAttribute(n,this.normalBuffer,0,0),l.enableVertexAttribute(n,this.vertexBuffer,0,0)}n.drawArrays(c,0,this.vertexCount);for(const e of u)e.disable(n);n.lineWidth(1)}})(),displayParticles(e,t,i){const n=this.getBrowser(),r=t.appearanceNode,s=r.getShader(this,t),o=r.getRenderModes(),a=this.getAttrib(),l=this.getAttribBuffers(),u=n.getPrimitiveMode(this.getPrimitiveMode());for(const t of o)t.enable(e);s.enable(e),s.setUniforms(e,this,t);const h=i.outputParticles;if(h.vertexArrayObject.update(this.updateParticles).enable(s.getProgram())){const t=i.particleStride;s.enableParticleAttribute(e,h,t,i.particleOffset,1),s.enableParticleMatrixAttribute(e,h,t,i.matrixOffset,1);for(let t=0,i=a.length;t<i;++t)a[t].enable(e,s,l[t]);this.hasFogCoords&&s.enableFogDepthAttribute(e,this.fogDepthBuffer,0,0),this.colorMaterial&&s.enableColorAttribute(e,this.colorBuffer,0,0),this.hasNormals&&s.enableNormalAttribute(e,this.normalBuffer,0,0),s.enableVertexAttribute(e,this.vertexBuffer,0,0),this.updateParticles=!1}e.drawArraysInstanced(u,0,this.vertexCount,i.numParticles);for(const t of o)t.disable(e);e.lineWidth(1)}}),Object.defineProperties(jm,{typeName:{value:"X3DLineGeometryNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Rendering",level:1}),enumerable:!0}});const km=jm;i.add("X3DLineGeometryNode","x_ite/Components/Rendering/X3DLineGeometryNode",km);const zm=km;function Gm(e){zm.call(this,e),this.addType(d.IndexedLineSet),this.fogCoordNode=null,this.colorNode=null,this.normalNode=null,this.coordNode=null}Object.assign(Object.setPrototypeOf(Gm.prototype,zm.prototype),{initialize(){zm.prototype.initialize.call(this),this._set_colorIndex.addFieldInterest(this._colorIndex),this._set_coordIndex.addFieldInterest(this._coordIndex),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._normal.addInterest("set_normal__",this),this._coord.addInterest("set_coord__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_normal__(),this.set_coord__()},set_attrib__(){const e=this.getAttrib();for(const t of e)t.removeInterest("requestRebuild",this),t._attribute_changed.removeInterest("updateVertexArrays",this);e.length=0;for(const t of this._attrib){const i=Yl(d.X3DVertexAttributeNode,t);i&&e.push(i)}for(const t of e)t.addInterest("requestRebuild",this),t._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__(){this.fogCoordNode?.removeInterest("requestRebuild",this),this.fogCoordNode=Yl(d.FogCoordinate,this._fogCoord),this.fogCoordNode?.addInterest("requestRebuild",this)},set_color__(){this.colorNode?.removeInterest("requestRebuild",this),this.colorNode=Yl(d.X3DColorNode,this._color),this.colorNode?.addInterest("requestRebuild",this),this.setTransparent(this.colorNode?.isTransparent()??!1)},set_normal__(){this.normalNode?.removeInterest("requestRebuild",this),this.normalNode=Yl(d.X3DNormalNode,this._normal),this.normalNode?.addInterest("requestRebuild",this)},set_coord__(){this.coordNode?.removeInterest("requestRebuild",this),this.coordNode=Yl(d.X3DCoordinateNode,this._coord),this.coordNode?.addInterest("requestRebuild",this)},getColorPerVertexIndex(e){return e<this._colorIndex.length?this._colorIndex[e]:this._coordIndex[e]},getColorIndex(e){return e<this._colorIndex.length?this._colorIndex[e]:e},getPolylineIndices(){const e=this._coordIndex,t=[];let i=[];if(e.length){for(let n=0,r=e.length;n<r;++n){e[n]>=0?i.push(n):(t.push(i),i=[])}e[e.length-1]>=0&&t.push(i)}return t},build(){if(!this.coordNode||this.coordNode.isEmpty())return;const e=this._coordIndex,t=this.getPolylineIndices(),i=this._colorPerVertex.getValue(),n=this.getCoordIndices(),r=this.getAttrib(),s=r.length,o=this.getAttribs(),a=this.fogCoordNode,l=this.colorNode,u=this.coordNode,h=this.normalNode,d=this.getFogDepths(),c=this.getColors(),p=this.getNormals(),g=this.getVertices();let f=0;for(const m of t){if(m.length>1)for(let t=0,_=m.length-1;t<_;++t)for(let _=t,x=t+2;_<x;++_){const t=m[_],x=e[t];n.push(x);for(let e=0;e<s;++e)r[e].addValue(x,o[e]);a?.addDepth(x,d),l&&(i?l.addColor(this.getColorPerVertexIndex(t),c):l.addColor(this.getColorIndex(f),c)),h?.addVector(x,p),u.addPoint(x,g)}++f}}}),Object.defineProperties(Gm,{typeName:{value:"IndexedLineSet",enumerable:!0},componentInfo:{value:Object.freeze({name:"Rendering",level:1}),enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_colorIndex",new $n.MFInt32),new k(d.inputOnly,"set_coordIndex",new $n.MFInt32),new k(d.initializeOnly,"colorPerVertex",new $n.SFBool(!0)),new k(d.initializeOnly,"colorIndex",new $n.MFInt32),new k(d.initializeOnly,"coordIndex",new $n.MFInt32),new k(d.inputOutput,"attrib",new $n.MFNode),new k(d.inputOutput,"fogCoord",new $n.SFNode),new k(d.inputOutput,"color",new $n.SFNode),new k(d.inputOutput,"normal",new $n.SFNode),new k(d.inputOutput,"coord",new $n.SFNode)]),enumerable:!0}});const Hm=Gm;i.add("IndexedLineSet","x_ite/Components/Rendering/IndexedLineSet",Hm);const qm=Hm;function Ym(e){op.call(this,e),this.addType(d.IndexedTriangleFanSet),this.triangleIndex=[]}Object.assign(Object.setPrototypeOf(Ym.prototype,op.prototype),{initialize(){op.prototype.initialize.call(this),this._set_index.addFieldInterest(this._index),this._index.addInterest("set_index__",this),this.set_index__()},set_index__(){const e=this._index,t=this.triangleIndex;t.length=0;for(let i=0,n=e.length;i<n;++i){const r=e[i];if(!(r<0)&&++i<n){let s=e[i];if(s<0)continue;for(++i;i<n;++i){const n=e[i];if(n<0)break;t.push(r,s,n),s=n}}}},getPolygonIndex(e){return this.triangleIndex[e]},build(){op.prototype.build.call(this,3,this.triangleIndex.length,3,this.triangleIndex.length)}}),Object.defineProperties(Ym,{typeName:{value:"IndexedTriangleFanSet",enumerable:!0},componentInfo:{value:Object.freeze({name:"Rendering",level:3}),enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_index",new $n.MFInt32),new k(d.initializeOnly,"solid",new $n.SFBool(!0)),new k(d.initializeOnly,"ccw",new $n.SFBool(!0)),new k(d.initializeOnly,"colorPerVertex",new $n.SFBool(!0)),new k(d.initializeOnly,"normalPerVertex",new $n.SFBool(!0)),new k(d.initializeOnly,"index",new $n.MFInt32),new k(d.inputOutput,"attrib",new $n.MFNode),new k(d.inputOutput,"fogCoord",new $n.SFNode),new k(d.inputOutput,"color",new $n.SFNode),new k(d.inputOutput,"texCoord",new $n.SFNode),new k(d.inputOutput,"normal",new $n.SFNode),new k(d.inputOutput,"coord",new $n.SFNode)]),enumerable:!0}});const Wm=Ym;i.add("IndexedTriangleFanSet","x_ite/Components/Rendering/IndexedTriangleFanSet",Wm);const $m=Wm;function Jm(e){op.call(this,e),this.addType(d.IndexedTriangleSet)}Object.assign(Object.setPrototypeOf(Jm.prototype,op.prototype),{getPolygonIndex(e){return this._index[e]},initialize(){op.prototype.initialize.call(this),this._set_index.addFieldInterest(this._index)},build(){op.prototype.build.call(this,3,this._index.length,3,this._index.length)}}),Object.defineProperties(Jm,{typeName:{value:"IndexedTriangleSet",enumerable:!0},componentInfo:{value:Object.freeze({name:"Rendering",level:3}),enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_index",new $n.MFInt32),new k(d.initializeOnly,"solid",new $n.SFBool(!0)),new k(d.initializeOnly,"ccw",new $n.SFBool(!0)),new k(d.initializeOnly,"colorPerVertex",new $n.SFBool(!0)),new k(d.initializeOnly,"normalPerVertex",new $n.SFBool(!0)),new k(d.initializeOnly,"index",new $n.MFInt32),new k(d.inputOutput,"attrib",new $n.MFNode),new k(d.inputOutput,"fogCoord",new $n.SFNode),new k(d.inputOutput,"color",new $n.SFNode),new k(d.inputOutput,"texCoord",new $n.SFNode),new k(d.inputOutput,"normal",new $n.SFNode),new k(d.inputOutput,"coord",new $n.SFNode)]),enumerable:!0}});const Km=Jm;i.add("IndexedTriangleSet","x_ite/Components/Rendering/IndexedTriangleSet",Km);const Zm=Km;function Qm(e){op.call(this,e),this.addType(d.IndexedTriangleStripSet),this.triangleIndex=[]}Object.assign(Object.setPrototypeOf(Qm.prototype,op.prototype),{initialize(){op.prototype.initialize.call(this),this._set_index.addFieldInterest(this._index),this._index.addInterest("set_index__",this),this.set_index__()},set_index__(){const e=this._index,t=this.triangleIndex;t.length=0;for(let i=0,n=e.length;i<n;++i){let r=e[i];if(!(r<0)&&++i<n){let s=e[i];if(s<0)continue;++i;for(let o=0;i<n;++i,++o){const n=e[i];if(n<0)break;t.push(r,s,n),1&o?s=n:r=n}}}},getPolygonIndex(e){return this.triangleIndex[e]},build(){op.prototype.build.call(this,3,this.triangleIndex.length,3,this.triangleIndex.length)}}),Object.defineProperties(Qm,{typeName:{value:"IndexedTriangleStripSet",enumerable:!0},componentInfo:{value:Object.freeze({name:"Rendering",level:3}),enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"set_index",new $n.MFInt32),new k(d.initializeOnly,"solid",new $n.SFBool(!0)),new k(d.initializeOnly,"ccw",new $n.SFBool(!0)),new k(d.initializeOnly,"colorPerVertex",new $n.SFBool(!0)),new k(d.initializeOnly,"normalPerVertex",new $n.SFBool(!0)),new k(d.initializeOnly,"index",new $n.MFInt32),new k(d.inputOutput,"attrib",new $n.MFNode),new k(d.inputOutput,"fogCoord",new $n.SFNode),new k(d.inputOutput,"color",new $n.SFNode),new k(d.inputOutput,"texCoord",new $n.SFNode),new k(d.inputOutput,"normal",new $n.SFNode),new k(d.inputOutput,"coord",new $n.SFNode)]),enumerable:!0}});const e_=Qm;i.add("IndexedTriangleStripSet","x_ite/Components/Rendering/IndexedTriangleStripSet",e_);const t_=e_;function i_(e){zm.call(this,e),this.addType(d.LineSet),this.fogCoordNode=null,this.colorNode=null,this.normalNode=null,this.coordNode=null}Object.assign(Object.setPrototypeOf(i_.prototype,zm.prototype),{initialize(){zm.prototype.initialize.call(this),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._normal.addInterest("set_normal__",this),this._coord.addInterest("set_coord__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_normal__(),this.set_coord__()},set_attrib__(){const e=this.getAttrib();for(const t of e)t.removeInterest("requestRebuild",this),t._attribute_changed.removeInterest("updateVertexArrays",this);e.length=0;for(const t of this._attrib){const i=Yl(d.X3DVertexAttributeNode,t);i&&e.push(i)}for(const t of e)t.addInterest("requestRebuild",this),t._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__(){this.fogCoordNode?.removeInterest("requestRebuild",this),this.fogCoordNode=Yl(d.FogCoordinate,this._fogCoord),this.fogCoordNode?.addInterest("requestRebuild",this)},set_color__(){this.colorNode?.removeInterest("requestRebuild",this),this.colorNode=Yl(d.X3DColorNode,this._color),this.colorNode?.addInterest("requestRebuild",this),this.setTransparent(this.colorNode?.isTransparent()??!1)},set_normal__(){this.normalNode?.removeInterest("requestRebuild",this),this.normalNode=Yl(d.X3DNormalNode,this._normal),this.normalNode?.addInterest("requestRebuild",this)},set_coord__(){this.coordNode?.removeInterest("requestRebuild",this),this.coordNode=Yl(d.X3DCoordinateNode,this._coord),this.coordNode?.addInterest("requestRebuild",this)},build(){if(!this.coordNode||this.coordNode.isEmpty())return;const e=this._vertexCount,t=this.getCoordIndices(),i=this.getAttrib(),n=i.length,r=this.getAttribs(),s=this.fogCoordNode,o=this.colorNode,a=this.normalNode,l=this.coordNode,u=this.getFogDepths(),h=this.getColors(),d=this.getNormals(),c=this.getVertices(),p=l.getSize();let g=0;for(let f of e){if(g+f>p)break;if(f>1){f=2*f-2;for(let e=0;e<f;++e,g+=1&e){t.push(g);for(let e=0;e<n;++e)i[e].addValue(g,r[e]);s?.addDepth(g,u),o?.addColor(g,h),a?.addVector(g,d),l.addPoint(g,c)}++g}else g+=f}}}),Object.defineProperties(i_,{typeName:{value:"LineSet",enumerable:!0},componentInfo:{value:Object.freeze({name:"Rendering",level:1}),enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"vertexCount",new $n.MFInt32),new k(d.inputOutput,"attrib",new $n.MFNode),new k(d.inputOutput,"fogCoord",new $n.SFNode),new k(d.inputOutput,"color",new $n.SFNode),new k(d.inputOutput,"normal",new $n.SFNode),new k(d.inputOutput,"coord",new $n.SFNode)]),enumerable:!0}});const n_=i_;i.add("LineSet","x_ite/Components/Rendering/LineSet",n_);const r_=n_;function s_(e){Qh.call(this,e),this.addType(d.X3DNormalNode)}Object.setPrototypeOf(s_.prototype,Qh.prototype),Object.defineProperties(s_,{typeName:{value:"X3DNormalNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Rendering",level:2}),enumerable:!0}});const o_=s_;i.add("X3DNormalNode","x_ite/Components/Rendering/X3DNormalNode",o_);const a_=o_;function l_(e){a_.call(this,e),this.addType(d.Normal)}Object.assign(Object.setPrototypeOf(l_.prototype,a_.prototype),{initialize(){a_.prototype.initialize.call(this),this._vector.addInterest("set_vector__",this),this.set_vector__()},set_vector__(){this.vector=this._vector.getValue(),this.length=this._vector.length},addVector(e,t){if(!(e>=0&&this.length))return t.push(0,0,0);{const i=this.vector,n=e%this.length*3;t.push(i[n],i[n+1],i[n+2])}},addNormals(e,t=this.length){const i=this.length;if(i){const n=this.vector;for(let r=0;r<t;++r){const t=r%i*3;e.push(n[t],n[t+1],n[t+2])}}else for(let i=0;i<t;++i)e.push(0,0,0);return e}}),Object.defineProperties(l_,{typeName:{value:"Normal",enumerable:!0},componentInfo:{value:Object.freeze({name:"Rendering",level:2}),enumerable:!0},containerField:{value:"normal",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"vector",new $n.MFVec3f)]),enumerable:!0}});const u_=l_;i.add("Normal","x_ite/Components/Rendering/Normal",u_);const h_=u_;function d_(e){Il.call(this,e);const t=this.getBrowser();this.setGeometryType(0),this.setPrimitiveMode(t.getContext().POINTS),this.setSolid(!1),this.setTransparent(!0)}Object.assign(Object.setPrototypeOf(d_.prototype,Il.prototype),{intersectsLine:()=>!1,intersectsBox:()=>!1,buildTexCoords(){},display(e,t){const i=t.appearanceNode,n=i.getShader(this,t),r=i.getRenderModes(),s=this.getAttrib(),o=this.getAttribBuffers();for(const t of r)t.enable(e);if(n.enable(e),n.setUniforms(e,this,t),this.vertexArrayObject.enable(n.getProgram())){this.coordIndices.length&&n.enableCoordIndexAttribute(e,this.coordIndexBuffer,0,0);for(let t=0,i=s.length;t<i;++t)s[t].enable(e,n,o[t]);this.hasFogCoords&&n.enableFogDepthAttribute(e,this.fogDepthBuffer,0,0),this.colorMaterial&&n.enableColorAttribute(e,this.colorBuffer,0,0),this.hasNormals&&n.enableNormalAttribute(e,this.normalBuffer,0,0),n.enableVertexAttribute(e,this.vertexBuffer,0,0)}e.drawArrays(this.primitiveMode,0,this.vertexCount);for(const t of r)t.disable(e)},displayParticles(e,t,i){const n=t.appearanceNode,r=n.getShader(this,t),s=n.getRenderModes(),o=this.getAttrib(),a=this.getAttribBuffers();for(const t of s)t.enable(e);r.enable(e),r.setUniforms(e,this,t);const l=i.outputParticles;if(l.vertexArrayObject.update(this.updateParticles).enable(r.getProgram())){const t=i.particleStride;r.enableParticleAttribute(e,l,t,i.particleOffset,1),r.enableParticleMatrixAttribute(e,l,t,i.matrixOffset,1);for(let t=0,i=o.length;t<i;++t)o[t].enable(e,r,a[t]);this.hasFogCoords&&r.enableFogDepthAttribute(e,this.fogDepthBuffer,0,0),this.colorMaterial&&r.enableColorAttribute(e,this.colorBuffer,0,0),this.hasNormals&&r.enableNormalAttribute(e,this.normalBuffer,0,0),r.enableVertexAttribute(e,this.vertexBuffer,0,0),this.updateParticles=!1}e.drawArraysInstanced(this.primitiveMode,0,this.vertexCount,i.numParticles);for(const t of s)t.disable(e)}}),Object.defineProperties(d_,{typeName:{value:"X3DPointGeometryNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Rendering",level:1}),enumerable:!0}});const c_=d_;i.add("X3DPointGeometryNode","x_ite/Components/Rendering/X3DPointGeometryNode",c_);const p_=c_;function g_(e){p_.call(this,e),this.addType(d.PointSet),this.fogCoordNode=null,this.colorNode=null,this.normalNode=null,this.coordNode=null}Object.assign(Object.setPrototypeOf(g_.prototype,p_.prototype),{initialize(){p_.prototype.initialize.call(this),this._attrib.addInterest("set_attrib__",this),this._fogCoord.addInterest("set_fogCoord__",this),this._color.addInterest("set_color__",this),this._normal.addInterest("set_normal__",this),this._coord.addInterest("set_coord__",this),this.set_attrib__(),this.set_fogCoord__(),this.set_color__(),this.set_normal__(),this.set_coord__()},getCoord(){return this.coordNode},set_attrib__(){const e=this.getAttrib();for(const t of e)t.removeInterest("requestRebuild",this),t._attribute_changed.removeInterest("updateVertexArrays",this);e.length=0;for(const t of this._attrib){const i=Yl(d.X3DVertexAttributeNode,t);i&&e.push(i)}for(const t of e)t.addInterest("requestRebuild",this),t._attribute_changed.addInterest("updateVertexArrays",this);this.updateVertexArrays()},set_fogCoord__(){this.fogCoordNode?.removeInterest("requestRebuild",this),this.fogCoordNode=Yl(d.FogCoordinate,this._fogCoord),this.fogCoordNode?.addInterest("requestRebuild",this)},set_color__(){this.colorNode?.removeInterest("requestRebuild",this),this.colorNode=Yl(d.X3DColorNode,this._color),this.colorNode?.addInterest("requestRebuild",this)},set_normal__(){this.normalNode?.removeInterest("requestRebuild",this),this.normalNode=Yl(d.X3DNormalNode,this._normal),this.normalNode?.addInterest("requestRebuild",this)},set_coord__(){this.coordNode?.removeInterest("requestRebuild",this),this.coordNode=Yl(d.X3DCoordinateNode,this._coord),this.coordNode?.addInterest("requestRebuild",this)},build(){if(!this.coordNode||this.coordNode.isEmpty())return;const e=this.getCoordIndices(),t=this.getAttrib(),i=t.length,n=this.getAttribs(),r=this.fogCoordNode,s=this.getFogDepths(),o=this.colorNode,a=this.getColors(),l=this.coordNode,u=this.getNormals(),h=this.normalNode,d=this.getVertices(),c=l._point.length;for(let t=0;t<c;++t)e.push(t);for(let e=0;e<i;++e)for(let i=0;i<c;++i)t[e].addValue(i,n[e]);r?.addDepths(s,c),o?.addColors(a,c),h?.addNormals(u,c),l.addPoints(d)}}),Object.defineProperties(g_,{typeName:{value:"PointSet",enumerable:!0},componentInfo:{value:Object.freeze({name:"Rendering",level:1}),enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"attrib",new $n.MFNode),new k(d.inputOutput,"fogCoord",new $n.SFNode),new k(d.inputOutput,"color",new $n.SFNode),new k(d.inputOutput,"normal",new $n.SFNode),new k(d.inputOutput,"coord",new $n.SFNode)]),enumerable:!0}});const f_=g_;i.add("PointSet","x_ite/Components/Rendering/PointSet",f_);const m_=f_;function __(e){op.call(this,e),this.addType(d.TriangleFanSet),this.triangleIndex=[]}Object.assign(Object.setPrototypeOf(__.prototype,op.prototype),{initialize(){op.prototype.initialize.call(this),this._fanCount.addInterest("set_fanCount__",this),this.set_fanCount__()},set_fanCount__(){const e=this._fanCount,t=this.triangleIndex;t.length=0;let i=0;for(const n of e){for(let e=1,r=n-1;e<r;++e)t.push(i,i+e,i+e+1);i+=n}},getPolygonIndex(e){return this.triangleIndex[e]},build(){op.prototype.build.call(this,3,this.triangleIndex.length,3,this.triangleIndex.length)}}),Object.defineProperties(__,{typeName:{value:"TriangleFanSet",enumerable:!0},componentInfo:{value:Object.freeze({name:"Rendering",level:3}),enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.initializeOnly,"solid",new $n.SFBool(!0)),new k(d.initializeOnly,"ccw",new $n.SFBool(!0)),new k(d.initializeOnly,"colorPerVertex",new $n.SFBool(!0)),new k(d.initializeOnly,"normalPerVertex",new $n.SFBool(!0)),new k(d.inputOutput,"fanCount",new $n.MFInt32),new k(d.inputOutput,"attrib",new $n.MFNode),new k(d.inputOutput,"fogCoord",new $n.SFNode),new k(d.inputOutput,"color",new $n.SFNode),new k(d.inputOutput,"texCoord",new $n.SFNode),new k(d.inputOutput,"normal",new $n.SFNode),new k(d.inputOutput,"coord",new $n.SFNode)]),enumerable:!0}});const x_=__;i.add("TriangleFanSet","x_ite/Components/Rendering/TriangleFanSet",x_);const y_=x_;function w_(e){op.call(this,e),this.addType(d.TriangleSet)}Object.assign(Object.setPrototypeOf(w_.prototype,op.prototype),{build(){this.getCoord()&&op.prototype.build.call(this,3,this.getCoord().getSize(),3,this.getCoord().getSize())},createNormals(e,t){return this.createFaceNormals(e,t)}}),Object.defineProperties(w_,{typeName:{value:"TriangleSet",enumerable:!0},componentInfo:{value:Object.freeze({name:"Rendering",level:3}),enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.initializeOnly,"solid",new $n.SFBool(!0)),new k(d.initializeOnly,"ccw",new $n.SFBool(!0)),new k(d.initializeOnly,"colorPerVertex",new $n.SFBool(!0)),new k(d.initializeOnly,"normalPerVertex",new $n.SFBool(!0)),new k(d.inputOutput,"attrib",new $n.MFNode),new k(d.inputOutput,"fogCoord",new $n.SFNode),new k(d.inputOutput,"color",new $n.SFNode),new k(d.inputOutput,"texCoord",new $n.SFNode),new k(d.inputOutput,"normal",new $n.SFNode),new k(d.inputOutput,"coord",new $n.SFNode)]),enumerable:!0}});const b_=w_;i.add("TriangleSet","x_ite/Components/Rendering/TriangleSet",b_);const S_=b_;function T_(e){op.call(this,e),this.addType(d.TriangleStripSet),this.triangleIndex=[]}Object.assign(Object.setPrototypeOf(T_.prototype,op.prototype),{initialize(){op.prototype.initialize.call(this),this._stripCount.addInterest("set_stripCount__",this),this.set_stripCount__()},set_stripCount__(){const e=this._stripCount,t=this.triangleIndex;t.length=0;let i=0;for(const n of e){for(let e=0,r=n-2;e<r;++e){const n=1&e;t.push(i+(n?e+1:e),i+(n?e:e+1),i+(e+2))}i+=n}},getPolygonIndex(e){return this.triangleIndex[e]},build(){op.prototype.build.call(this,3,this.triangleIndex.length,3,this.triangleIndex.length)}}),Object.defineProperties(T_,{typeName:{value:"TriangleStripSet",enumerable:!0},componentInfo:{value:Object.freeze({name:"Rendering",level:3}),enumerable:!0},containerField:{value:"geometry",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.initializeOnly,"solid",new $n.SFBool(!0)),new k(d.initializeOnly,"ccw",new $n.SFBool(!0)),new k(d.initializeOnly,"colorPerVertex",new $n.SFBool(!0)),new k(d.initializeOnly,"normalPerVertex",new $n.SFBool(!0)),new k(d.inputOutput,"stripCount",new $n.MFInt32),new k(d.inputOutput,"attrib",new $n.MFNode),new k(d.inputOutput,"fogCoord",new $n.SFNode),new k(d.inputOutput,"color",new $n.SFNode),new k(d.inputOutput,"texCoord",new $n.SFNode),new k(d.inputOutput,"normal",new $n.SFNode),new k(d.inputOutput,"coord",new $n.SFNode)]),enumerable:!0}});const v_=T_;i.add("TriangleStripSet","x_ite/Components/Rendering/TriangleStripSet",v_);const O_={name:"Rendering",concreteNodes:[Sm,Nm,Mm,Lm,Xm,qm,$m,Zm,t_,r_,h_,m_,y_,S_,v_],abstractNodes:[Om,op,Pm,Qh,Il,zm,a_]};i.add("Rendering","x_ite/Components/Rendering",O_);const E_=O_;function C_(e){kl.call(this,e),this.addType(d.X3DShaderNode),this.valid=!1,this.selected=0}Object.assign(Object.setPrototypeOf(C_.prototype,kl.prototype),{setValid(e){this._isValid=this.valid=e},isValid(){return this.valid},select(){++this.selected,this._isSelected.getValue()||(this._isSelected=!0)},deselect(){--this.selected,0===this.selected&&this._isSelected.getValue()&&(this._isSelected=!1)}}),Object.defineProperties(C_,{typeName:{value:"X3DShaderNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Shaders",level:1}),enumerable:!0}});const N_=C_;i.add("X3DShaderNode","x_ite/Components/Shaders/X3DShaderNode",N_);const I_=N_;var F_=n(328);const M_=Symbol.for("X_ITE.X3DField.uniformLocation");function D_(e){this.addType(d.X3DProgrammableShaderObject),this.uniformNames=[],this.x3d_ClipPlane=[],this.x3d_LightType=[],this.x3d_LightOn=[],this.x3d_LightColor=[],this.x3d_LightIntensity=[],this.x3d_LightAmbientIntensity=[],this.x3d_LightAttenuation=[],this.x3d_LightLocation=[],this.x3d_LightDirection=[],this.x3d_LightBeamWidth=[],this.x3d_LightCutOffAngle=[],this.x3d_LightRadius=[],this.x3d_LightMatrix=[],this.x3d_ShadowIntensity=[],this.x3d_ShadowColor=[],this.x3d_ShadowBias=[],this.x3d_ShadowMatrix=[],this.x3d_ShadowMapSize=[],this.x3d_ShadowMap=[],this.x3d_Texture=[],this.x3d_MultiTextureMode=[],this.x3d_MultiTextureAlphaMode=[],this.x3d_MultiTextureSource=[],this.x3d_MultiTextureFunction=[],this.x3d_TextureCoordinateGeneratorMode=[],this.x3d_TextureCoordinateGeneratorParameter=[],this.x3d_TextureProjectorColor=[],this.x3d_TextureProjectorIntensity=[],this.x3d_TextureProjectorLocation=[],this.x3d_TextureProjectorParams=[],this.x3d_TextureProjectorTexture=[],this.x3d_TextureProjectorMatrix=[],this.x3d_TexCoord=[],this.x3d_TextureMatrix=[],this.fogNode=null,this.numClipPlanes=0,this.numLights=0,this.numGlobalLights=0,this.lightNodes=[],this.numTextureProjectors=0,this.numGlobalTextureProjectors=0,this.textureProjectorNodes=[],this.textures=new Set}Object.assign(D_.prototype,{initialize(){},canUserDefinedFields:()=>!0,getUniformNames(){return this.uniformNames},setUniformNames(e){this.uniformNames=e},getDefaultUniformsAndAttributes(){const e=this.getProgram(),t=this.getBrowser(),i=t.getContext(),n=t.getMaxClipPlanes(),r=t.getMaxLights(),s=t.getMaxTextures(),o=t.getMaxTextureTransforms(),a=t.getMaxTexCoords();i.useProgram(e);for(const t of this.uniformNames)this[t]=i.getUniformLocation(e,t);this.x3d_Id=i.getUniformLocation(e,"x3d_Id"),this.x3d_LogarithmicFarFactor1_2=i.getUniformLocation(e,"x3d_LogarithmicFarFactor1_2");for(let t=0;t<n;++t)this.x3d_ClipPlane[t]=i.getUniformLocation(e,"x3d_ClipPlane["+t+"]");this.x3d_FogColor=this.getUniformLocation(i,e,"x3d_Fog.color","x3d_FogColor"),this.x3d_FogVisibilityRange=this.getUniformLocation(i,e,"x3d_Fog.visibilityRange","x3d_FogVisibilityRange"),this.x3d_FogMatrix=this.getUniformLocation(i,e,"x3d_Fog.matrix","x3d_FogMatrix"),this.x3d_AlphaCutoff=i.getUniformLocation(e,"x3d_AlphaCutoff"),this.x3d_PointPropertiesPointSizeScaleFactor=i.getUniformLocation(e,"x3d_PointProperties.pointSizeScaleFactor"),this.x3d_PointPropertiesPointSizeMinValue=i.getUniformLocation(e,"x3d_PointProperties.pointSizeMinValue"),this.x3d_PointPropertiesPointSizeMaxValue=i.getUniformLocation(e,"x3d_PointProperties.pointSizeMaxValue"),this.x3d_PointPropertiesAttenuation=i.getUniformLocation(e,"x3d_PointProperties.attenuation"),this.x3d_LinePropertiesLinetype=i.getUniformLocation(e,"x3d_LineProperties.linetype"),this.x3d_LineStippleScale=i.getUniformLocation(e,"x3d_LineProperties.lineStippleScale"),this.x3d_LinePropertiesTexture=i.getUniformLocation(e,"x3d_LineProperties.texture"),this.x3d_FillPropertiesFilled=i.getUniformLocation(e,"x3d_FillProperties.filled"),this.x3d_FillPropertiesHatched=i.getUniformLocation(e,"x3d_FillProperties.hatched"),this.x3d_FillPropertiesHatchColor=i.getUniformLocation(e,"x3d_FillProperties.hatchColor"),this.x3d_FillPropertiesTexture=i.getUniformLocation(e,"x3d_FillProperties.texture"),this.x3d_FillPropertiesScale=i.getUniformLocation(e,"x3d_FillProperties.scale");for(let t=0;t<r;++t)this.x3d_LightType[t]=this.getUniformLocation(i,e,"x3d_LightSource["+t+"].type","x3d_LightType["+t+"]"),this.x3d_LightColor[t]=this.getUniformLocation(i,e,"x3d_LightSource["+t+"].color","x3d_LightColor["+t+"]"),this.x3d_LightAmbientIntensity[t]=this.getUniformLocation(i,e,"x3d_LightSource["+t+"].ambientIntensity","x3d_LightAmbientIntensity["+t+"]"),this.x3d_LightIntensity[t]=this.getUniformLocation(i,e,"x3d_LightSource["+t+"].intensity","x3d_LightIntensity["+t+"]"),this.x3d_LightAttenuation[t]=this.getUniformLocation(i,e,"x3d_LightSource["+t+"].attenuation","x3d_LightAttenuation["+t+"]"),this.x3d_LightLocation[t]=this.getUniformLocation(i,e,"x3d_LightSource["+t+"].location","x3d_LightLocation["+t+"]"),this.x3d_LightDirection[t]=this.getUniformLocation(i,e,"x3d_LightSource["+t+"].direction","x3d_LightDirection["+t+"]"),this.x3d_LightBeamWidth[t]=this.getUniformLocation(i,e,"x3d_LightSource["+t+"].beamWidth","x3d_LightBeamWidth["+t+"]"),this.x3d_LightCutOffAngle[t]=this.getUniformLocation(i,e,"x3d_LightSource["+t+"].cutOffAngle","x3d_LightCutOffAngle["+t+"]"),this.x3d_LightRadius[t]=this.getUniformLocation(i,e,"x3d_LightSource["+t+"].radius","x3d_LightRadius["+t+"]"),this.x3d_LightMatrix[t]=this.getUniformLocation(i,e,"x3d_LightSource["+t+"].matrix","x3d_LightMatrix["+t+"]"),this.x3d_ShadowIntensity[t]=i.getUniformLocation(e,"x3d_LightSource["+t+"].shadowIntensity"),this.x3d_ShadowColor[t]=i.getUniformLocation(e,"x3d_LightSource["+t+"].shadowColor"),this.x3d_ShadowBias[t]=i.getUniformLocation(e,"x3d_LightSource["+t+"].shadowBias"),this.x3d_ShadowMatrix[t]=i.getUniformLocation(e,"x3d_LightSource["+t+"].shadowMatrix"),this.x3d_ShadowMapSize[t]=i.getUniformLocation(e,"x3d_LightSource["+t+"].shadowMapSize"),this.x3d_ShadowMap[t]=i.getUniformLocation(e,"x3d_ShadowMap["+t+"]");this.x3d_EnvironmentLightColor=i.getUniformLocation(e,"x3d_EnvironmentLightSource.color"),this.x3d_EnvironmentLightIntensity=i.getUniformLocation(e,"x3d_EnvironmentLightSource.intensity"),this.x3d_EnvironmentLightAmbientIntensity=i.getUniformLocation(e,"x3d_EnvironmentLightSource.ambientIntensity"),this.x3d_EnvironmentLightRotation=i.getUniformLocation(e,"x3d_EnvironmentLightSource.rotation"),this.x3d_EnvironmentLightDiffuseTexture=i.getUniformLocation(e,"x3d_EnvironmentLightSource.diffuseTexture"),this.x3d_EnvironmentLightDiffuseTextureLinear=i.getUniformLocation(e,"x3d_EnvironmentLightSource.diffuseTextureLinear"),this.x3d_EnvironmentLightSpecularTexture=i.getUniformLocation(e,"x3d_EnvironmentLightSource.specularTexture"),this.x3d_EnvironmentLightSpecularTextureLinear=i.getUniformLocation(e,"x3d_EnvironmentLightSource.specularTextureLinear"),this.x3d_EnvironmentLightSpecularTextureLevels=i.getUniformLocation(e,"x3d_EnvironmentLightSource.specularTextureLevels"),this.x3d_EnvironmentLightGGXLUTTexture=i.getUniformLocation(e,"x3d_EnvironmentLightSource.GGXLUTTexture"),this.x3d_AmbientIntensity=this.getUniformLocation(i,e,"x3d_Material.ambientIntensity","x3d_FrontMaterial.ambientIntensity"),this.x3d_DiffuseColor=this.getUniformLocation(i,e,"x3d_Material.diffuseColor","x3d_FrontMaterial.diffuseColor"),this.x3d_SpecularColor=this.getUniformLocation(i,e,"x3d_Material.specularColor","x3d_FrontMaterial.specularColor"),this.x3d_EmissiveColor=this.getUniformLocation(i,e,"x3d_Material.emissiveColor","x3d_FrontMaterial.emissiveColor"),this.x3d_Shininess=this.getUniformLocation(i,e,"x3d_Material.shininess","x3d_FrontMaterial.shininess"),this.x3d_BaseColor=i.getUniformLocation(e,"x3d_Material.baseColor"),this.x3d_Metallic=i.getUniformLocation(e,"x3d_Material.metallic"),this.x3d_Roughness=i.getUniformLocation(e,"x3d_Material.roughness"),this.x3d_OcclusionStrength=i.getUniformLocation(e,"x3d_Material.occlusionStrength"),this.x3d_NormalScale=i.getUniformLocation(e,"x3d_Material.normalScale"),this.x3d_Transparency=this.getUniformLocation(i,e,"x3d_Material.transparency","x3d_FrontMaterial.transparency");const l=["x3d_AmbientTexture","x3d_DiffuseTexture","x3d_SpecularTexture","x3d_EmissiveTexture","x3d_ShininessTexture","x3d_BaseTexture","x3d_MetallicRoughnessTexture","x3d_OcclusionTexture","x3d_NormalTexture"];for(const t of l)this[t]={textureTransformMapping:i.getUniformLocation(e,t+".textureTransformMapping"),textureCoordinateMapping:i.getUniformLocation(e,t+".textureCoordinateMapping"),texture2D:i.getUniformLocation(e,t+".texture2D"),texture3D:i.getUniformLocation(e,t+".texture3D"),textureCube:i.getUniformLocation(e,t+".textureCube")};this.x3d_MultiTextureColor=i.getUniformLocation(e,"x3d_MultiTextureColor"),this.x3d_TexCoord.length=0;for(let t=0;t<s;++t)this.x3d_Texture[t]={texture2D:i.getUniformLocation(e,"x3d_Texture2D["+t+"]"),texture3D:i.getUniformLocation(e,"x3d_Texture3D["+t+"]"),textureCube:this.getUniformLocation(i,e,"x3d_TextureCube["+t+"]","x3d_CubeMapTexture["+t+"]")},this.x3d_MultiTextureMode[t]=i.getUniformLocation(e,"x3d_MultiTexture["+t+"].mode"),this.x3d_MultiTextureAlphaMode[t]=i.getUniformLocation(e,"x3d_MultiTexture["+t+"].alphaMode"),this.x3d_MultiTextureSource[t]=i.getUniformLocation(e,"x3d_MultiTexture["+t+"].source"),this.x3d_MultiTextureFunction[t]=i.getUniformLocation(e,"x3d_MultiTexture["+t+"].function"),this.x3d_TextureProjectorColor[t]=i.getUniformLocation(e,"x3d_TextureProjectorColor["+t+"]"),this.x3d_TextureProjectorIntensity[t]=i.getUniformLocation(e,"x3d_TextureProjectorIntensity["+t+"]"),this.x3d_TextureProjectorLocation[t]=i.getUniformLocation(e,"x3d_TextureProjectorLocation["+t+"]"),this.x3d_TextureProjectorParams[t]=i.getUniformLocation(e,"x3d_TextureProjectorParams["+t+"]"),this.x3d_TextureProjectorMatrix[t]=i.getUniformLocation(e,"x3d_TextureProjectorMatrix["+t+"]"),this.x3d_TextureProjectorTexture[t]=i.getUniformLocation(e,"x3d_TextureProjectorTexture["+t+"]");for(let t=0;t<o;++t){const n=i.getUniformLocation(e,"x3d_TextureMatrix["+t+"]");null!==n&&(this.x3d_TextureMatrix[t]=n)}for(let t=0;t<a;++t){this.x3d_TextureCoordinateGeneratorMode[t]=i.getUniformLocation(e,"x3d_TextureCoordinateGenerator["+t+"].mode"),this.x3d_TextureCoordinateGeneratorParameter[t]=i.getUniformLocation(e,"x3d_TextureCoordinateGenerator["+t+"].parameter");const n=this.getAttribLocation(i,e,"x3d_TexCoord"+t,t?"":"x3d_TexCoord");-1!==n&&this.x3d_TexCoord.push([t,n])}this.x3d_TexCoordRamp=i.getUniformLocation(e,"x3d_TexCoordRamp"),this.x3d_JointsTexture=i.getUniformLocation(e,"x3d_JointsTexture"),this.x3d_DisplacementsTexture=i.getUniformLocation(e,"x3d_DisplacementsTexture"),this.x3d_JointMatricesTexture=i.getUniformLocation(e,"x3d_JointMatricesTexture"),this.x3d_Viewport=i.getUniformLocation(e,"x3d_Viewport"),this.x3d_ProjectionMatrix=i.getUniformLocation(e,"x3d_ProjectionMatrix"),this.x3d_ModelViewMatrix=i.getUniformLocation(e,"x3d_ModelViewMatrix"),this.x3d_NormalMatrix=i.getUniformLocation(e,"x3d_NormalMatrix"),this.x3d_CameraSpaceMatrix=i.getUniformLocation(e,"x3d_CameraSpaceMatrix");const u=["CoordIndex","LineStipple","FogDepth","Color","Normal","Vertex","Particle","ParticleMatrix"];for(const t of u){const n=i.getAttribLocation(e,`x3d_${t}`);this[`x3d_${t}`]=n,n<0?(this[`enable${t}Attribute`]=Function.prototype,this[`${F_.toLowerCaseFirst(t)}AttributeDivisor`]=Function.prototype):(delete this[`enable${t}Attribute`],delete this[`${F_.toLowerCaseFirst(t)}AttributeDivisor`])}0===this.x3d_TexCoord.length?(this.enableTexCoordAttribute=Function.prototype,this.texCoordAttributeDivisor=Function.prototype):(delete this.enableTexCoordAttribute,delete this.texCoordAttributeDivisor),i.uniform1i(this.x3d_LinePropertiesTexture,t.getDefaultTexture2DUnit()),i.uniform1i(this.x3d_FillPropertiesTexture,t.getDefaultTexture2DUnit());for(const e of l)i.uniform1i(this[e].texture2D,t.getDefaultTexture2DUnit()),i.uniform1i(this[e].texture3D,t.getDefaultTexture3DUnit()),i.uniform1i(this[e].textureCube,t.getDefaultTextureCubeUnit());for(const e of this.x3d_Texture)i.uniform1i(e.texture2D,t.getDefaultTexture2DUnit()),i.getVersion()>=2&&i.uniform1i(e.texture3D,t.getDefaultTexture3DUnit()),i.uniform1i(e.textureCube,t.getDefaultTextureCubeUnit());for(const e of this.x3d_ShadowMap)i.uniform1i(e,t.getDefaultTexture2DUnit());i.uniform1i(this.x3d_EnvironmentLightDiffuseTexture,t.getDefaultTextureCubeUnit()),i.uniform1i(this.x3d_EnvironmentLightSpecularTexture,t.getDefaultTextureCubeUnit()),i.uniform1i(this.x3d_EnvironmentLightGGXLUTTexture,t.getDefaultTexture2DUnit());for(const e of this.x3d_TextureProjectorTexture)i.uniform1i(e,t.getDefaultTexture2DUnit());i.uniform1i(this.x3d_TexCoordRamp,t.getDefaultTexture2DUnit()),i.uniform1i(this.x3d_JointsTexture,t.getDefaultTexture2DUnit()),i.uniform1i(this.x3d_DisplacementsTexture,t.getDefaultTexture2DUnit()),i.uniform1i(this.x3d_JointMatricesTexture,t.getDefaultTexture2DUnit())},getUniformLocation(e,t,i,n){let r=e.getUniformLocation(t,i);return r||(n?(r=e.getUniformLocation(t,n),r&&console.warn(this.getTypeName(),this.getName(),"Using uniform location name '"+n+"' is depreciated, use '"+i+"'. See https://create3000.github.io/x_ite/custom-shaders."),r):0)},getAttribLocation(e,t,i,n){let r=e.getAttribLocation(t,i);return r>=0?r:n?(r=e.getAttribLocation(t,n),r>=0&&console.warn(this.getTypeName(),this.getName(),"Using attribute location name '"+n+"' is depreciated, use '"+i+"'. See https://create3000.github.io/x_ite/custom-shaders."),r):-1},addShaderFields(){const e=this.getProgram(),t=this.getBrowser().getContext();t.useProgram(e),this.textures.clear();for(const i of this.getUserDefinedFields()){if(i.getAccessType()===d.outputOnly)continue;const n=t.getUniformLocation(e,i.getName());if(n){switch(i.getType()){case d.SFImage:n.array=new Int32Array(3+i.array.length);break;case d.SFMatrix3d:case d.SFMatrix3f:case d.SFRotation:n.array=new Float32Array(9);break;case d.SFMatrix4d:case d.SFMatrix4f:n.array=new Float32Array(16);break;case d.SFNode:break;case d.MFBool:case d.MFInt32:n.array=new Int32Array(this.getLocationLength(t,e,i));break;case d.MFFloat:case d.MFDouble:case d.MFTime:n.array=new Float32Array(this.getLocationLength(t,e,i));break;case d.MFImage:n.array=new Int32Array(this.getImagesLength(i));break;case d.MFMatrix3d:case d.MFMatrix3f:case d.MFRotation:n.array=new Float32Array(9*this.getLocationLength(t,e,i));break;case d.MFMatrix4d:case d.MFMatrix4f:n.array=new Float32Array(16*this.getLocationLength(t,e,i));break;case d.MFNode:{const r=n.locations=[];for(let n=0;;++n){const s=t.getUniformLocation(e,i.getName()+"["+n+"]");if(!s)break;r.push(s)}break}case d.MFVec2d:case d.MFVec2f:n.array=new Float32Array(2*this.getLocationLength(t,e,i));break;case d.MFVec3d:case d.MFVec3f:case d.MFColor:n.array=new Float32Array(3*this.getLocationLength(t,e,i));break;case d.MFVec4d:case d.MFVec4f:case d.MFColorRGBA:n.array=new Float32Array(4*this.getLocationLength(t,e,i))}n.array?i[M_]=n.array.length?n:null:i[M_]=n,i.addInterest("set_field__",this),this.set_field__(i)}}},removeShaderFields(){for(const e of this.getUserDefinedFields())e.removeInterest("set_field__",this)},set_field__:(()=>{const e=new Float32Array(9);return function(t){const i=this.getProgram(),n=this.getBrowser().getContext(),r=t[M_];if(n.useProgram(i),r)switch(t.getType()){case d.SFBool:case d.SFInt32:return void n.uniform1i(r,t.getValue());case d.SFColor:{const e=t.getValue();return void n.uniform3f(r,e.r,e.g,e.b)}case d.SFColorRGBA:{const e=t.getValue();return void n.uniform4f(r,e.r,e.g,e.b,e.a)}case d.SFDouble:case d.SFFloat:case d.SFTime:return void n.uniform1f(r,t.getValue());case d.SFImage:{let e=r.array;const i=t.array,s=3+i.length;s!==e.length&&(e=r.array=new Int32Array(s)),e[0]=t.width,e[1]=t.height,e[2]=t.comp;for(let t=3,n=0,r=i.length;n<r;++n,++t)e[t]=i[n];return void n.uniform1iv(r,e)}case d.SFMatrix3d:case d.SFMatrix3f:return r.array.set(t.getValue()),void n.uniformMatrix3fv(r,!1,r.array);case d.SFMatrix4d:case d.SFMatrix4f:return r.array.set(t.getValue()),void n.uniformMatrix4fv(r,!1,r.array);case d.SFNode:{const e=Yl(d.X3DTextureNode,t);return void(e?(r.name=t.getName(),r.texture=e,this.textures.add(r)):this.textures.delete(r))}case d.SFRotation:return t.getValue().getMatrix(r.array),void n.uniformMatrix3fv(r,!1,r.array);case d.SFString:return;case d.SFVec2d:case d.SFVec2f:{const e=t.getValue();return void n.uniform2f(r,e.x,e.y)}case d.SFVec3d:case d.SFVec3f:{const e=t.getValue();return void n.uniform3f(r,e.x,e.y,e.z)}case d.SFVec4d:case d.SFVec4f:{const e=t.getValue();return void n.uniform4f(r,e.x,e.y,e.z,e.w)}case d.MFBool:case d.MFInt32:{const e=r.array;for(var s=0,o=t.length;s<o;++s)e[s]=t[s];for(let t=e.length;s<t;++s)e[s]=0;return void n.uniform1iv(r,e)}case d.MFColor:{const e=r.array;s=0;var a=0;for(o=t.length;s<o;++s){const i=t[s];e[a++]=i.r,e[a++]=i.g,e[a++]=i.b}for(let t=e.length;a<t;++a)e[a]=0;return void n.uniform3fv(r,e)}case d.MFColorRGBA:{const e=r.array;for(s=0,a=0,o=t.length;s<o;++s){const i=t[s];e[a++]=i.r,e[a++]=i.g,e[a++]=i.b,e[a++]=i.a}for(let t=e.length;a<t;++a)e[a]=0;return void n.uniform4fv(r,e)}case d.MFDouble:case d.MFFloat:case d.MFTime:{const e=r.array;for(s=0,o=t.length;s<o;++s)e[s]=t[s];for(let t=e.length;s<t;++s)e[s]=0;return void n.uniform1fv(r,e)}case d.MFImage:{const e=r.array;for(let i=0,n=0,r=t.length;i<r;++i){const r=t[i],s=r.array;e[n++]=r.width,e[n++]=r.height,e[n++]=r.comp;for(let t=0,i=s.length;t<i;++t)e[n++]=s[t]}return void n.uniform1iv(r,e)}case d.MFMatrix3d:case d.MFMatrix3f:{const e=r.array;for(s=0,a=0,o=t.length;s<o;++s){const i=t[s];for(let t=0;t<9;++t)e[a++]=i[t]}for(let t=e.length;a<t;++a)e[a]=0;return void n.uniformMatrix3fv(r,!1,e)}case d.MFMatrix4d:case d.MFMatrix4f:{const e=r.array;for(s=0,a=0,o=t.length;s<o;++s){const i=t[s];for(let t=0;t<16;++t)e[a++]=i[t]}for(let t=e.length;a<t;++a)e[a]=0;return void n.uniformMatrix4fv(r,!1,e)}case d.MFNode:{const e=r.locations;for(let i=0,n=t.length;i<n;++i){const n=Yl(d.X3DTextureNode,t[i]);n?(e[i].name=t.getName(),e[i].texture=n,this.textures.add(e[i])):this.textures.delete(e[i])}return}case d.MFRotation:{const i=r.array;for(s=0,a=0,o=t.length;s<o;++s)t[s].getValue().getMatrix(e),i[a++]=e[0],i[a++]=e[1],i[a++]=e[2],i[a++]=e[3],i[a++]=e[4],i[a++]=e[5],i[a++]=e[6],i[a++]=e[7],i[a++]=e[8];for(let e=i.length;a<e;++a)i[a]=0;return void n.uniformMatrix3fv(r,!1,i)}case d.MFString:return;case d.MFVec2d:case d.MFVec2f:{const e=r.array;for(s=0,a=0,o=t.length;s<o;++s){const i=t[s];e[a++]=i.x,e[a++]=i.y}for(let t=e.length;a<t;++a)e[a]=0;return void n.uniform2fv(r,e)}case d.MFVec3d:case d.MFVec3f:{const e=r.array;for(s=0,a=0,o=t.length;s<o;++s){const i=t[s];e[a++]=i.x,e[a++]=i.y,e[a++]=i.z}for(let t=e.length;a<t;++a)e[a]=0;return void n.uniform3fv(r,e)}case d.MFVec4d:case d.MFVec4f:{const e=r.array;for(s=0,a=0,o=t.length;s<o;++s){const i=t[s];e[a++]=i.x,e[a++]=i.y,e[a++]=i.z,e[a++]=i.w}for(let t=e.length;a<t;++a)e[a]=0;return void n.uniform4fv(r,e)}}}})(),getImagesLength(e){const t=e.getValue();let i=3*t.length;for(const e of t)i+=e.array.length;return i},getLocationLength(e,t,i){const n=i.getName();for(let i=0;;++i){if(!e.getUniformLocation(t,n+"["+i+"]"))return i}},hasFog(e){return this.fogNode===e||(this.fogNode=e,!1)},hasLight(e,t){return this.lightNodes[e]===t||(this.lightNodes[e]=t,!1)},hasTextureProjector(e,t){return this.textureProjectorNodes[e]===t||(this.textureProjectorNodes[e]=t,!1)},setClipPlanes(e,t){this.numClipPlanes=0;for(const i of t)i.setShaderUniforms(e,this)},setUniforms:(()=>{const e=new Float32Array(9);return function(t,i,n,r=!0){const{renderObject:s,fogNode:o,appearanceNode:a,humanoidNode:l,modelViewMatrix:u}=n,h=a.getStyleProperties(i.geometryType),d=r?a.getMaterial():a.getBackMaterial(),c=n.textureNode||a.getTexture();if(this.renderCount!==s.getRenderCount()){this.renderCount=s.getRenderCount(),t.uniform4iv(this.x3d_Viewport,s.getViewportArray()),t.uniformMatrix4fv(this.x3d_ProjectionMatrix,!1,s.getProjectionMatrixArray()),t.uniformMatrix4fv(this.x3d_CameraSpaceMatrix,!1,s.getCameraSpaceMatrixArray()),this.fogNode=null,this.numLights=0,this.numTextureProjectors=0,this.lightNodes.length=0,this.textureProjectorNodes.length=0;for(const e of s.getGlobalLights())e.setShaderUniforms(t,this,s);if(this.numGlobalLights=this.numLights,this.numGlobalTextureProjectors=this.numTextureProjectors,s.getRenderBits().get(0)){const e=s.getViewpoint(),i=s.getNavigationInfo();t.uniform1f(this.x3d_LogarithmicFarFactor1_2,1/Math.log2(i.getFarValue(e)+1))}}t.uniformMatrix4fv(this.x3d_ModelViewMatrix,!1,u),i.hasNormals&&(e[0]=u[0],e[3]=u[1],e[6]=u[2],e[1]=u[4],e[4]=u[5],e[7]=u[6],e[2]=u[8],e[5]=u[9],e[8]=u[10],At.prototype.inverse.call(e),t.uniformMatrix3fv(this.x3d_NormalMatrix,!1,e)),o?.setShaderUniforms(t,this),this.numClipPlanes=0,this.numLights=this.numGlobalLights,this.numTextureProjectors=this.numGlobalTextureProjectors;for(const e of n.localObjects)e.setShaderUniforms(t,this,s);t.uniform1f(this.x3d_AlphaCutoff,a.getAlphaCutoff()),h?.setShaderUniforms(t,this),d.setShaderUniforms(t,this,s,a.getTextureTransformMapping(),i.getTextureCoordinateMapping(),r),c?.setShaderUniforms(t,this,s),a.getTextureTransform().setShaderUniforms(t,this),i.getTextureCoordinate().setShaderUniforms(t,this),l?.setShaderUniforms(t,this)}})(),enable(e){e.useProgram(this.getProgram());for(const t of this.textures){const i=t.texture,n=this.getBrowser().getTextureUnit(i.getTextureType());if(void 0===n)return void console.warn("Not enough combined texture units for uniform variable '"+t.name+"' available.");e.activeTexture(e.TEXTURE0+n),e.bindTexture(i.getTarget(),i.getTexture()),e.uniform1i(t,n)}},enableFloatAttrib(e,t,i,n,r,s){const o=e.getAttribLocation(this.getProgram(),t);-1!==o&&(e.bindBuffer(e.ARRAY_BUFFER,i),e.enableVertexAttribArray(o),e.vertexAttribPointer(o,n,e.FLOAT,!1,r,s))},enableMatrix3Attrib(e,t,i,n,r){const s=e.getAttribLocation(this.getProgram(),t);if(-1!==s){n=n||36,e.bindBuffer(e.ARRAY_BUFFER,i);for(let t=0;t<3;++t){const i=s+t;e.enableVertexAttribArray(i),e.vertexAttribPointer(i,3,e.FLOAT,!1,n,r+12*t)}}},enableMatrix4Attrib(e,t,i,n,r){const s=e.getAttribLocation(this.getProgram(),t);if(-1!==s){n=n||64,e.bindBuffer(e.ARRAY_BUFFER,i);for(let t=0;t<4;++t){const i=s+t;e.enableVertexAttribArray(i),e.vertexAttribPointer(i,4,e.FLOAT,!1,n,r+16*t)}}},enableCoordIndexAttribute(e,t,i,n){const r=this.x3d_CoordIndex;e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(r),e.vertexAttribPointer(r,1,e.FLOAT,!1,i,n)},enableLineStippleAttribute(e,t,i,n){const r=this.x3d_LineStipple;e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(r),e.vertexAttribPointer(r,3,e.FLOAT,!1,i,n)},enableFogDepthAttribute(e,t,i,n){const r=this.x3d_FogDepth;e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(r),e.vertexAttribPointer(r,1,e.FLOAT,!1,i,n)},enableColorAttribute(e,t,i,n){const r=this.x3d_Color;e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(r),e.vertexAttribPointer(r,4,e.FLOAT,!1,i,n)},colorAttributeDivisor(e,t){e.vertexAttribDivisor(this.x3d_Color,t)},enableTexCoordAttribute(e,t,i,n){for(const[r,s]of this.x3d_TexCoord)e.bindBuffer(e.ARRAY_BUFFER,t[r]),e.enableVertexAttribArray(s),e.vertexAttribPointer(s,4,e.FLOAT,!1,i,n)},texCoordAttributeDivisor(e,t){for(const[i,n]of this.x3d_TexCoord)e.vertexAttribDivisor(n,t)},enableNormalAttribute(e,t,i,n){const r=this.x3d_Normal;e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(r),e.vertexAttribPointer(r,3,e.FLOAT,!1,i,n)},normalAttributeDivisor(e,t){e.vertexAttribDivisor(this.x3d_Normal,t)},enableVertexAttribute(e,t,i,n){const r=this.x3d_Vertex;e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(r),e.vertexAttribPointer(r,4,e.FLOAT,!1,i,n)},vertexAttributeDivisor(e,t){e.vertexAttribDivisor(this.x3d_Vertex,t)},enableParticleAttribute(e,t,i,n,r){const s=this.x3d_Particle;e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(s),e.vertexAttribPointer(s,4,e.FLOAT,!1,i,n),e.vertexAttribDivisor(s,r)},enableParticleMatrixAttribute(e,t,i,n,r){const s=this.x3d_ParticleMatrix;i=i||64,e.bindBuffer(e.ARRAY_BUFFER,t);for(let t=0;t<4;++t){const o=s+t;e.enableVertexAttribArray(o),e.vertexAttribPointer(o,4,e.FLOAT,!1,i,n+16*t),e.vertexAttribDivisor(o,r)}},getProgramInfo(){function e(e,t){return e<t?-1:e>t?1:0}const t=this.getProgram(),i=this.getBrowser().getContext(),n={attributes:[],uniforms:[],attributeCount:0,uniformCount:0},r=i.getProgramParameter(t,i.ACTIVE_UNIFORMS),s=i.getProgramParameter(t,i.ACTIVE_ATTRIBUTES),o={35664:"vec2",35665:"vec3",35666:"vec4",35667:"ivec2",35668:"ivec3",35669:"ivec4",35670:"bool",35671:"bvec2",35672:"bvec3",35673:"bvec4",35674:"mat2",35675:"mat3",35676:"mat4",35678:"sampler2D",35680:"samplerCube",5120:"byte",5121:"ubyte",5122:"short",5123:"ushort",5124:"int",5125:"uint",5126:"float"};for(let e=0;e<r;++e){const r=i.getActiveUniform(t,e);r.typeName=o[r.type],n.uniforms.push(Object.assign({},r)),n.uniformCount+=r.size}for(let e=0;e<s;++e){const r=i.getActiveAttrib(t,e);r.typeName=o[r.type],n.attributes.push(Object.assign({},r)),n.attributeCount+=r.size}return n.uniforms.sort(((t,i)=>e(t.name,i.name))),n.attributes.sort(((t,i)=>e(t.name,i.name))),n},printProgramInfo(){const e=this.getProgramInfo();console.log(this.getName()),console.table(e.attributes),console.log(this.getName(),"attributeCount",e.attributeCount),console.log(this.getName()),console.table(e.uniforms),console.log(this.getName(),"uniformCount",e.uniformCount)},dispose(){}}),Object.defineProperties(D_,{typeName:{value:"X3DProgrammableShaderObject",enumerable:!0},componentInfo:{value:Object.freeze({name:"Shaders",level:1}),enumerable:!0}});const R_=D_;i.add("X3DProgrammableShaderObject","x_ite/Components/Shaders/X3DProgrammableShaderObject",R_);const P_=R_;function A_(e){I_.call(this,e),P_.call(this,e),this.addType(d.ComposedShader),this.loadSensor=new Hf(e),this.transformFeedbackVaryings=[]}Object.assign(Object.setPrototypeOf(A_.prototype,I_.prototype),P_.prototype,{wireframe:!1,initialize(){I_.prototype.initialize.call(this),P_.prototype.initialize.call(this),this._activate.addInterest("set_activate__",this),this._language.addInterest("set_loaded__",this),this._parts.addFieldInterest(this.loadSensor._children),this.loadSensor._isLoaded.addInterest("connectLoaded",this),this.loadSensor._children=this._parts,this.loadSensor.setPrivate(!0),this.loadSensor.setup(),this.loadSensor._isLoaded.getValue()?this.set_loaded__():this.connectLoaded()},connectLoaded(){this.loadSensor._isLoaded.removeInterest("connectLoaded",this),this.loadSensor._isLoaded.addInterest("set_loaded__",this)},addUserDefinedField(e,t,i){const n=this.isInitialized()&&this.isValid();n&&this.removeShaderFields(),I_.prototype.addUserDefinedField.call(this,e,t,i),n&&this.addShaderFields()},removeUserDefinedField(e){const t=this.isInitialized()&&this.isValid();t&&this.removeShaderFields(),I_.prototype.removeUserDefinedField.call(this,e),t&&this.addShaderFields()},setTransformFeedbackVaryings(e){this.transformFeedbackVaryings=e},getProgram(){return this.program},set_activate__(){this._activate.getValue()&&this.set_loaded__()},set_loaded__(){if(this.loadSensor._isLoaded.getValue()&&"GLSL"===this._language.getValue()){const e=this.getBrowser().getContext(),t=e.createProgram();this.isValid()&&this.removeShaderFields(),e.deleteProgram(this.program),this.program=t;for(const i of this._parts){const n=Yl(d.ShaderPart,i);n?.getShader()&&e.attachShader(t,n.getShader())}this.transformFeedbackVaryings.length&&e.transformFeedbackVaryings(t,this.transformFeedbackVaryings,e.INTERLEAVED_ATTRIBS),e.linkProgram(t),e.getProgramParameter(t,e.LINK_STATUS)?(this.setValid(!0),this.getDefaultUniformsAndAttributes(),this.addShaderFields()):(this.setValid(!1),this._parts.length&&console.warn("Couldn't initialize "+this.getTypeName()+" '"+this.getName()+"': "+e.getProgramInfoLog(t)))}else this.setValid(!1)},dispose(){P_.prototype.dispose.call(this),I_.prototype.dispose.call(this)}}),Object.defineProperties(A_,{typeName:{value:"ComposedShader",enumerable:!0},componentInfo:{value:Object.freeze({name:"Shaders",level:1}),enumerable:!0},containerField:{value:"shaders",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"activate",new $n.SFBool),new k(d.outputOnly,"isSelected",new $n.SFBool),new k(d.outputOnly,"isValid",new $n.SFBool),new k(d.initializeOnly,"language",new $n.SFString),new k(d.inputOutput,"parts",new $n.MFNode)]),enumerable:!0}});const V_=A_;i.add("ComposedShader","x_ite/Components/Shaders/ComposedShader",V_);const L_=V_;function B_(e){Qh.call(this,e),this.addType(d.X3DVertexAttributeNode),this.addChildObjects(d.outputOnly,"attribute_changed",new $n.SFTime)}Object.assign(Object.setPrototypeOf(B_.prototype,Qh.prototype),{initialize(){Qh.prototype.initialize.call(this),this._name.addInterest("set_attribute__",this)},set_attribute__(){this._attribute_changed=this.getBrowser().getCurrentTime()}}),Object.defineProperties(B_,{typeName:{value:"X3DVertexAttributeNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Shaders",level:1}),enumerable:!0}});const U_=B_;i.add("X3DVertexAttributeNode","x_ite/Components/Shaders/X3DVertexAttributeNode",U_);const X_=U_;function j_(e){X_.call(this,e),this.addType(d.FloatVertexAttribute)}Object.assign(Object.setPrototypeOf(j_.prototype,X_.prototype),{initialize(){X_.prototype.initialize.call(this),this._numComponents.addInterest("set_numComponents__",this),this._numComponents.addInterest("set_attribute__",this),this._value.addInterest("set_value__",this),this.set_numComponents__(),this.set_value__()},set_numComponents__(){this.numComponents=g.clamp(this._numComponents.getValue(),1,4)},set_value__(){this.value=this._value.getValue(),this.length=this._value.length},addValue(e,t){const i=this.value;let n=e*this.numComponents,r=n+this.numComponents;if(r<=this.length)for(;n<r;++n)t.push(i[n]);else if(this.numComponents<=this.length)for(r=i.length,n=r-this.numComponents;n<r;++n)t.push(i[n]);else for(;n<r;++n)t.push(0)},enable(e,t,i){t.enableFloatAttrib(e,this._name.getValue(),i,this.numComponents,0,0)}}),Object.defineProperties(j_,{typeName:{value:"FloatVertexAttribute",enumerable:!0},componentInfo:{value:Object.freeze({name:"Shaders",level:1}),enumerable:!0},containerField:{value:"attrib",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.initializeOnly,"name",new $n.SFString),new k(d.initializeOnly,"numComponents",new $n.SFInt32(4)),new k(d.inputOutput,"value",new $n.MFFloat)]),enumerable:!0}});const k_=j_;i.add("FloatVertexAttribute","x_ite/Components/Shaders/FloatVertexAttribute",k_);const z_=k_;function G_(e){X_.call(this,e),this.addType(d.Matrix3VertexAttribute)}Object.assign(Object.setPrototypeOf(G_.prototype,X_.prototype),{initialize(){X_.prototype.initialize.call(this),this._value.addInterest("set_value__",this),this.set_value__()},set_value__(){this.value=this._value.getValue(),this.length=this._value.length},addValue(e,t){if(e<this.length){const i=this.value;for(let n=9*e,r=n+9;n<r;++n)t.push(i[n])}else if(this.length){const i=this.value;for(let n=9*(e=this.length-1),r=n+9;n<r;++n)t.push(i[n])}else{const e=At.Identity;for(let i=0;i<9;++i)t.push(e[i])}},enable(e,t,i){t.enableMatrix3Attrib(e,this._name.getValue(),i,0,0)}}),Object.defineProperties(G_,{typeName:{value:"Matrix3VertexAttribute",enumerable:!0},componentInfo:{value:Object.freeze({name:"Shaders",level:1}),enumerable:!0},containerField:{value:"attrib",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.initializeOnly,"name",new $n.SFString),new k(d.inputOutput,"value",new $n.MFMatrix3f)]),enumerable:!0}});const H_=G_;i.add("Matrix3VertexAttribute","x_ite/Components/Shaders/Matrix3VertexAttribute",H_);const q_=H_;function Y_(e){X_.call(this,e),this.addType(d.Matrix4VertexAttribute)}Object.assign(Object.setPrototypeOf(Y_.prototype,X_.prototype),{initialize(){X_.prototype.initialize.call(this),this._value.addInterest("set_value__",this),this.set_value__()},set_value__(){this.value=this._value.getValue(),this.length=this._value.length},addValue(e,t){if(e<this.length){const i=this.value;for(let n=16*e,r=n+16;n<r;++n)t.push(i[n])}else if(this.length){const i=this.value;for(let n=16*(e=this.length-1),r=n+16;n<r;++n)t.push(i[n])}else{const e=Matrix4.Identity;for(let i=0;i<16;++i)t.push(e[i])}},enable(e,t,i){t.enableMatrix4Attrib(e,this._name.getValue(),i,0,0)}}),Object.defineProperties(Y_,{typeName:{value:"Matrix4VertexAttribute",enumerable:!0},componentInfo:{value:Object.freeze({name:"Shaders",level:1}),enumerable:!0},containerField:{value:"attrib",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.initializeOnly,"name",new $n.SFString),new k(d.inputOutput,"value",new $n.MFMatrix4f)]),enumerable:!0}});const W_=Y_;i.add("Matrix4VertexAttribute","x_ite/Components/Shaders/Matrix4VertexAttribute",W_);const $_=W_;function J_(e){I_.call(this,e),Ts.call(this,e),P_.call(this,e),this.addType(d.PackagedShader)}Object.assign(Object.setPrototypeOf(J_.prototype,I_.prototype),Ts.prototype,P_.prototype,{getSourceText(){return this._url},requestImmediateLoad(e=!0){},initialize(){I_.prototype.initialize.call(this),Ts.prototype.initialize.call(this),P_.prototype.initialize.call(this)},dispose(){P_.prototype.dispose.call(this),Ts.prototype.dispose.call(this),I_.prototype.dispose.call(this)}}),Object.defineProperties(J_,{typeName:{value:"PackagedShader",enumerable:!0},componentInfo:{value:Object.freeze({name:"Shaders",level:1}),enumerable:!0},containerField:{value:"shaders",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOnly,"activate",new $n.SFBool),new k(d.outputOnly,"isSelected",new $n.SFBool),new k(d.outputOnly,"isValid",new $n.SFBool),new k(d.initializeOnly,"language",new $n.SFString),new k(d.inputOutput,"load",new $n.SFBool(!0)),new k(d.inputOutput,"url",new $n.MFString),new k(d.inputOutput,"autoRefresh",new $n.SFTime),new k(d.inputOutput,"autoRefreshTimeLimit",new $n.SFTime(3600))]),enumerable:!0}});const K_=J_;i.add("PackagedShader","x_ite/Components/Shaders/PackagedShader",K_);const Z_=K_;function Q_(e){I_.call(this,e),this.addType(d.ProgramShader)}Object.setPrototypeOf(Q_.prototype,I_.prototype),Object.defineProperties(Q_,{typeName:{value:"ProgramShader",enumerable:!0},componentInfo:{value:Object.freeze({name:"Shaders",level:1}),enumerable:!0},containerField:{value:"shaders",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOnly,"activate",new $n.SFBool),new k(d.outputOnly,"isSelected",new $n.SFBool),new k(d.outputOnly,"isValid",new $n.SFBool),new k(d.initializeOnly,"language",new $n.SFString),new k(d.inputOutput,"programs",new $n.MFNode)]),enumerable:!0}});const ex=Q_;i.add("ProgramShader","x_ite/Components/Shaders/ProgramShader",ex);const tx=ex,ix="#if defined(X3D_FOG)\nstruct x3d_FogParameters{mediump int type;mediump vec3 color;mediump float visibilityRange;mediump mat3 matrix;};\n#endif\n#if defined(X3D_LIGHTING)\nstruct x3d_LightSourceParameters{mediump int type;mediump vec3 color;mediump float intensity;mediump float ambientIntensity;mediump vec3 attenuation;mediump vec3 location;mediump vec3 direction;mediump float radius;mediump float beamWidth;mediump float cutOffAngle;mediump mat3 matrix;\n#if defined(X3D_SHADOWS)\nmediump vec3 shadowColor;mediump float shadowIntensity;mediump float shadowBias;mediump mat4 shadowMatrix;mediump int shadowMapSize;\n#endif\n};\n#endif\n#if defined(X3D_USE_IBL)\nstruct x3d_EnvironmentLightSourceParameters{mediump vec3 color;mediump float intensity;mediump float ambientIntensity;mediump mat3 rotation;mediump samplerCube diffuseTexture;bool diffuseTextureLinear;mediump samplerCube specularTexture;bool specularTextureLinear;mediump int specularTextureLevels;mediump sampler2D GGXLUTTexture;};\n#endif\n#if defined(X3D_GEOMETRY_0D)&&defined(X3D_STYLE_PROPERTIES)\nstruct x3d_PointPropertiesParameters{mediump float pointSizeScaleFactor;mediump float pointSizeMinValue;mediump float pointSizeMaxValue;mediump vec3 attenuation;};\n#endif\n#if defined(X3D_GEOMETRY_1D)&&defined(X3D_STYLE_PROPERTIES)\nstruct x3d_LinePropertiesParameters{mediump int linetype;mediump float lineStippleScale;\n#if defined(X3D_STYLE_PROPERTIES_TEXTURE)\nsampler2D texture;\n#endif\n};\n#endif\n#if(defined(X3D_GEOMETRY_2D)||defined(X3D_GEOMETRY_3D))&&defined(X3D_STYLE_PROPERTIES)\nstruct x3d_FillPropertiesParameters{bool filled;bool hatched;mediump vec3 hatchColor;\n#if defined(X3D_STYLE_PROPERTIES_TEXTURE)\nsampler2D texture;\n#endif\nmediump float scale;};\n#endif\n#if defined(X3D_UNLIT_MATERIAL)\nstruct x3d_UnlitMaterialParameters{mediump vec3 emissiveColor;mediump float normalScale;mediump float transparency;};\n#endif\n#if defined(X3D_MATERIAL)\nstruct x3d_MaterialParameters{mediump float ambientIntensity;mediump vec3 diffuseColor;mediump vec3 specularColor;mediump vec3 emissiveColor;mediump float shininess;mediump float occlusionStrength;mediump float normalScale;mediump float transparency;};\n#endif\n#if defined(X3D_PHYSICAL_MATERIAL)\nstruct x3d_PhysicalMaterialParameters{mediump vec3 baseColor;mediump vec3 emissiveColor;mediump float metallic;mediump float roughness;mediump float occlusionStrength;mediump float normalScale;mediump float transparency;};\n#endif\n#if defined(X3D_AMBIENT_TEXTURE)\nstruct x3d_AmbientTextureParameters{mediump int textureTransformMapping;mediump int textureCoordinateMapping;\n#if defined(X3D_AMBIENT_TEXTURE_2D)\nmediump sampler2D texture2D;\n#endif\n#if defined(X3D_AMBIENT_TEXTURE_3D)&&__VERSION__!=100\nmediump sampler3D texture3D;\n#endif\n#if defined(X3D_AMBIENT_TEXTURE_CUBE)\nmediump samplerCube textureCube;\n#endif\n};\n#endif\n#if defined(X3D_DIFFUSE_TEXTURE)\nstruct x3d_DiffuseTextureParameters{mediump int textureTransformMapping;mediump int textureCoordinateMapping;\n#if defined(X3D_DIFFUSE_TEXTURE_2D)\nmediump sampler2D texture2D;\n#endif\n#if defined(X3D_DIFFUSE_TEXTURE_3D)&&__VERSION__!=100\nmediump sampler3D texture3D;\n#endif\n#if defined(X3D_DIFFUSE_TEXTURE_CUBE)\nmediump samplerCube textureCube;\n#endif\n};\n#endif\n#if defined(X3D_SPECULAR_TEXTURE)\nstruct x3d_SpecularTextureParameters{mediump int textureTransformMapping;mediump int textureCoordinateMapping;\n#if defined(X3D_SPECULAR_TEXTURE_2D)\nmediump sampler2D texture2D;\n#endif\n#if defined(X3D_SPECULAR_TEXTURE_3D)&&__VERSION__!=100\nmediump sampler3D texture3D;\n#endif\n#if defined(X3D_SPECULAR_TEXTURE_CUBE)\nmediump samplerCube textureCube;\n#endif\n};\n#endif\n#if defined(X3D_EMISSIVE_TEXTURE)\nstruct x3d_EmissiveTextureParameters{mediump int textureTransformMapping;mediump int textureCoordinateMapping;\n#if defined(X3D_EMISSIVE_TEXTURE_2D)\nmediump sampler2D texture2D;\n#endif\n#if defined(X3D_EMISSIVE_TEXTURE_3D)&&__VERSION__!=100\nmediump sampler3D texture3D;\n#endif\n#if defined(X3D_EMISSIVE_TEXTURE_CUBE)\nmediump samplerCube textureCube;\n#endif\n};\n#endif\n#if defined(X3D_SHININESS_TEXTURE)\nstruct x3d_ShininessTextureParameters{mediump int textureTransformMapping;mediump int textureCoordinateMapping;\n#if defined(X3D_SHININESS_TEXTURE_2D)\nmediump sampler2D texture2D;\n#endif\n#if defined(X3D_SHININESS_TEXTURE_3D)&&__VERSION__!=100\nmediump sampler3D texture3D;\n#endif\n#if defined(X3D_SHININESS_TEXTURE_CUBE)\nmediump samplerCube textureCube;\n#endif\n};\n#endif\n#if defined(X3D_BASE_TEXTURE)\nstruct x3d_BaseTextureParameters{mediump int textureTransformMapping;mediump int textureCoordinateMapping;\n#if defined(X3D_BASE_TEXTURE_2D)\nmediump sampler2D texture2D;\n#endif\n#if defined(X3D_BASE_TEXTURE_3D)&&__VERSION__!=100\nmediump sampler3D texture3D;\n#endif\n#if defined(X3D_BASE_TEXTURE_CUBE)\nmediump samplerCube textureCube;\n#endif\n};\n#endif\n#if defined(X3D_METALLIC_ROUGHNESS_TEXTURE)\nstruct x3d_MetallicRoughnessTextureParameters{mediump int textureTransformMapping;mediump int textureCoordinateMapping;\n#if defined(X3D_METALLIC_ROUGHNESS_TEXTURE_2D)\nmediump sampler2D texture2D;\n#endif\n#if defined(X3D_METALLIC_ROUGHNESS_TEXTURE_3D)&&__VERSION__!=100\nmediump sampler3D texture3D;\n#endif\n#if defined(X3D_METALLIC_ROUGHNESS_TEXTURE_CUBE)\nmediump samplerCube textureCube;\n#endif\n};\n#endif\n#if defined(X3D_OCCLUSION_TEXTURE)\nstruct x3d_OcclusionTextureParameters{mediump int textureTransformMapping;mediump int textureCoordinateMapping;\n#if defined(X3D_OCCLUSION_TEXTURE_2D)\nmediump sampler2D texture2D;\n#endif\n#if defined(X3D_OCCLUSION_TEXTURE_3D)&&__VERSION__!=100\nmediump sampler3D texture3D;\n#endif\n#if defined(X3D_OCCLUSION_TEXTURE_CUBE)\nmediump samplerCube textureCube;\n#endif\n};\n#endif\n#if defined(X3D_NORMAL_TEXTURE)\nstruct x3d_NormalTextureParameters{mediump int textureTransformMapping;mediump int textureCoordinateMapping;\n#if defined(X3D_NORMAL_TEXTURE_2D)\nmediump sampler2D texture2D;\n#endif\n#if defined(X3D_NORMAL_TEXTURE_3D)&&__VERSION__!=100\nmediump sampler3D texture3D;\n#endif\n#if defined(X3D_NORMAL_TEXTURE_CUBE)\nmediump samplerCube textureCube;\n#endif\n};\n#endif\n#if defined(X3D_MULTI_TEXTURING)\nstruct x3d_MultiTextureParameters{mediump int mode;mediump int alphaMode;mediump int source;mediump int function;};\n#endif\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\nstruct x3d_TextureCoordinateGeneratorParameters{mediump int mode;mediump float parameter[6];};\n#endif\n";i.add("Types.glsl","assets/shaders/Types.glsl",ix);const nx=ix;let rx=0;const sx={REPLACE:rx++,MODULATE:rx++,MODULATE2X:rx++,MODULATE4X:rx++,ADD:rx++,ADDSIGNED:rx++,ADDSIGNED2X:rx++,ADDSMOOTH:rx++,SUBTRACT:rx++,BLENDDIFFUSEALPHA:rx++,BLENDTEXTUREALPHA:rx++,BLENDFACTORALPHA:rx++,BLENDCURRENTALPHA:rx++,MODULATEALPHA_ADDCOLOR:rx++,MODULATEINVALPHA_ADDCOLOR:rx++,MODULATEINVCOLOR_ADDALPHA:rx++,DOTPRODUCT3:rx++,SELECTARG1:rx++,SELECTARG2:rx++,OFF:rx++};i.add("ModeType","x_ite/Browser/Texturing/ModeType",sx);const ox=sx;let ax=0;const lx={DEFAULT:ax++,DIFFUSE:ax++,SPECULAR:ax++,FACTOR:ax++};i.add("SourceType","x_ite/Browser/Texturing/SourceType",lx);const ux=lx;let hx=0;const dx={DEFAULT:hx++,COMPLEMENT:hx++,ALPHAREPLICATE:hx++};i.add("FunctionType","x_ite/Browser/Texturing/FunctionType",dx);const cx=dx;let px=0;const gx={NONE:px++,SPHERE:px++,CAMERASPACENORMAL:px++,CAMERASPACEPOSITION:px++,CAMERASPACEREFLECTIONVECTOR:px++,SPHERE_LOCAL:px++,COORD:px++,COORD_EYE:px++,NOISE:px++,NOISE_EYE:px++,SPHERE_REFLECT:px++,SPHERE_REFLECT_LOCAL:px++};i.add("TextureCoordinateGeneratorModeType","x_ite/Browser/Texturing/TextureCoordinateGeneratorModeType",gx);const fx=gx;const mx={getSource(e,t,i,n){const r="\\s+|/\\*[\\s\\S]*?\\*/|//.*?\\n",s="#line\\s+.*?\\n|#if\\s+.*?\\n|#elif\\s+.*?\\n|#ifdef\\s+.*?\\n|#ifndef\\s+.*?\\n|#else.*?\\n|#endif.*?\\n|#define\\s+(?:[^\\n\\\\]|\\\\[^\\r\\n]|\\\\\\r?\\n)*\\n|#undef\\s+.*?\\n|#pragma\\s+.*?\\n",o=new RegExp("^((?:"+r+"|"+s+")*(?:#version\\s+.*?\\n)?(?:"+r+"|"+s+"|#extension\\s+.*?\\n)*)(.*)$","s"),a=i.match(o);if(!a)return i;let l="";l+="#define X_ITE\n",e.HAS_FEATURE_DEPTH_TEXTURE&&(l+="#define X3D_DEPTH_TEXTURE\n");for(const e of n)l+="#define "+e+"\n";let u="";u+="#define x3d_None 0\n",u+="#define x3d_Points      0\n",u+="#define x3d_Lines       1\n",u+="#define x3d_Geometry2D  2\n",u+="#define x3d_Geometry3D  3\n",u+="#define x3d_MaxClipPlanes  "+t.getMaxClipPlanes()+"\n",u+="#define x3d_LinearFog        1\n",u+="#define x3d_ExponentialFog   2\n",u+="#define x3d_Exponential2Fog  3\n",u+="#define x3d_MaxLights         "+t.getMaxLights()+"\n",u+="#define x3d_DirectionalLight  1\n",u+="#define x3d_PointLight        2\n",u+="#define x3d_SpotLight         3\n",u+="#define x3d_MaxTextures      "+t.getMaxTextures()+"\n",u+="#define x3d_TextureType2D    2\n",u+="#define x3d_TextureType3D    3\n",u+="#define x3d_TextureTypeCube  4\n",u+="#define x3d_Replace                   "+ox.REPLACE+"\n",u+="#define x3d_Modulate                  "+ox.MODULATE+"\n",u+="#define x3d_Modulate2X                "+ox.MODULATE2X+"\n",u+="#define x3d_Modulate4X                "+ox.MODULATE4X+"\n",u+="#define x3d_Add                       "+ox.ADD+"\n",u+="#define x3d_AddSigned                 "+ox.ADDSIGNED+"\n",u+="#define x3d_AddSigned2X               "+ox.ADDSIGNED2X+"\n",u+="#define x3d_AddSmooth                 "+ox.ADDSMOOTH+"\n",u+="#define x3d_Subtract                  "+ox.SUBTRACT+"\n",u+="#define x3d_BlendDiffuseAlpha         "+ox.BLENDDIFFUSEALPHA+"\n",u+="#define x3d_BlendTextureAlpha         "+ox.BLENDTEXTUREALPHA+"\n",u+="#define x3d_BlendFactorAlpha          "+ox.BLENDFACTORALPHA+"\n",u+="#define x3d_BlendCurrentAlpha         "+ox.BLENDCURRENTALPHA+"\n",u+="#define x3d_ModulateAlphaAddColor     "+ox.MODULATEALPHA_ADDCOLOR+"\n",u+="#define x3d_ModulateInvAlphaAddColor  "+ox.MODULATEINVALPHA_ADDCOLOR+"\n",u+="#define x3d_ModulateInvColorAddAlpha  "+ox.MODULATEINVCOLOR_ADDALPHA+"\n",u+="#define x3d_DotProduct3               "+ox.DOTPRODUCT3+"\n",u+="#define x3d_SelectArg1                "+ox.SELECTARG1+"\n",u+="#define x3d_SelectArg2                "+ox.SELECTARG2+"\n",u+="#define x3d_Off                       "+ox.OFF+"\n",u+="#define x3d_Diffuse  "+ux.DIFFUSE+"\n",u+="#define x3d_Specular "+ux.SPECULAR+"\n",u+="#define x3d_Factor   "+ux.FACTOR+"\n",u+="#define x3d_Complement     "+cx.COMPLEMENT+"\n",u+="#define x3d_AlphaReplicate "+cx.ALPHAREPLICATE+"\n",u+="#define x3d_Sphere                      "+fx.SPHERE+"\n",u+="#define x3d_CameraSpaceNormal           "+fx.CAMERASPACENORMAL+"\n",u+="#define x3d_CameraSpacePosition         "+fx.CAMERASPACEPOSITION+"\n",u+="#define x3d_CameraSpaceReflectionVector "+fx.CAMERASPACEREFLECTIONVECTOR+"\n",u+="#define x3d_SphereLocal                 "+fx.SPHERE_LOCAL+"\n",u+="#define x3d_Coord                       "+fx.COORD+"\n",u+="#define x3d_CoordEye                    "+fx.COORD_EYE+"\n",u+="#define x3d_Noise                       "+fx.NOISE+"\n",u+="#define x3d_NoiseEye                    "+fx.NOISE_EYE+"\n",u+="#define x3d_SphereReflect               "+fx.SPHERE_REFLECT+"\n",u+="#define x3d_SphereReflectLocal          "+fx.SPHERE_REFLECT_LOCAL+"\n",u+="#define x3d_GeometryPoints  0\n",u+="#define x3d_GeometryLines   1\n",u+="#define x3d_NoneClipPlane   vec4 (88.0, 51.0, 68.0, 33.0)\n",u+="#define x3d_NoneFog         0\n",u+="#define x3d_NoneLight       0\n",u+="#define x3d_NoneTexture     0\n";const h=i.match(/\s*precision\s+(lowp|mediump|highp)\s+float\s*;/),d=i.match(/\s*precision\s+(lowp|mediump|highp)\s+int\s*;/),c=h?h[1]:"mediump",p=d?d[1]:"mediump",g=nx.replace(/mediump\s+(float|vec2|vec3|mat3|mat4)/g,c+" $1").replace(/mediump\s+(int)/g,p+" $1"),f=(a[1].match(/\n/g)||[]).length+1;return a[1]+l+u+g+"#line "+(f+1)+" -1\n"+a[2]}};i.add("ShaderSource","x_ite/Browser/Shaders/ShaderSource",mx);const _x=mx,xx="#if defined(X3D_CLIP_PLANES)\nuniform vec4 x3d_ClipPlane[X3D_NUM_CLIP_PLANES];void clip(){for(int i=0;i<X3D_NUM_CLIP_PLANES;++i){if(dot(vertex,x3d_ClipPlane[i].xyz)-x3d_ClipPlane[i].w<0.0)discard;}}\n#endif\n";i.add("ClipPlanes1.glsl","assets/shaders/webgl1/common/ClipPlanes1.glsl",xx);const yx=xx,wx="#if defined(X3D_FOG)\nuniform x3d_FogParameters x3d_Fog;float getFogInterpolant(){\n#if defined(X3D_FOG_COORDS)\nreturn clamp(1.0-fogDepth,0.0,1.0);\n#else\nfloat visibilityRange=x3d_Fog.visibilityRange;float dV=length(x3d_Fog.matrix*vertex);\n#if defined(X3D_FOG_LINEAR)\nreturn max(0.0,visibilityRange-dV)/visibilityRange;\n#elif defined(X3D_FOG_EXPONENTIAL)\nreturn exp(-dV/max(0.001,visibilityRange-dV));\n#endif\n#endif\n}vec3 getFogColor(const in vec3 color){return mix(x3d_Fog.color,color,getFogInterpolant());}\n#endif\n";i.add("Fog1.glsl","assets/shaders/webgl1/common/Fog1.glsl",wx);const bx=wx,Sx=`#if defined(X3D_NORMAL_TEXTURE)\n#extension GL_OES_standard_derivatives:enable\n#endif\n#if defined(X3D_LOGARITHMIC_DEPTH_BUFFER)\n#extension GL_EXT_frag_depth:enable\n#endif\n#if defined(X3D_ALPHA_MODE_MASK)\nuniform float x3d_AlphaCutoff;\n#endif\n#if defined(X3D_FOG)&&defined(X3D_FOG_COORDS)\nvarying float fogDepth;\n#endif\n#if defined(X3D_COLOR_MATERIAL)\nvarying vec4 color;\n#endif\n#if!defined(X3D_GEOMETRY_0D)&&!defined(X3D_GEOMETRY_1D)\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\n\n${Array.from({length:4},((e,t)=>`\n#if X3D_NUM_TEXTURE_COORDINATES > ${t}\nvarying vec4 texCoord${t};\n#endif\n`)).join("\n")}\n \n#endif\n#else\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\n\n${Array.from({length:4},((e,t)=>`\n#if X3D_NUM_TEXTURE_COORDINATES > ${t}\nvec4 texCoord${t} = vec4 (0.0, 0.0, 0.0, 1.0);\n#endif\n`)).join("\n")}\n \n#endif\n#endif\n#if defined(X3D_NORMALS)\nvarying vec3 normal;\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\nvarying vec3 localNormal;\n#endif\n#else\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\nconst vec3 localNormal=vec3(0.0,0.0,1.0);\n#endif\n#endif\nvarying vec3 vertex;\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\nvarying vec3 localVertex;\n#endif\n#if defined(X3D_LOGARITHMIC_DEPTH_BUFFER)\nuniform float x3d_LogarithmicFarFactor1_2;varying float depth;\n#endif\n#pragma X3D include "../pbr/ToneMapping.glsl"\n#pragma X3D include "Texture.glsl"\n#pragma X3D include "ClipPlanes.glsl"\n#pragma X3D include "Point.glsl"\n#pragma X3D include "Hatch.glsl"\n#pragma X3D include "Fog.glsl"\nvec4 getMaterialColor();void fragment_main(){\n#if defined(X3D_CLIP_PLANES)\nclip();\n#endif\n#if defined(X3D_GEOMETRY_0D)&&defined(X3D_STYLE_PROPERTIES)\nsetPointTexCoords();\n#endif\nvec4 finalColor=getMaterialColor();\n#if defined(X3D_GEOMETRY_0D)&&defined(X3D_STYLE_PROPERTIES)\nfinalColor=getPointColor(finalColor);\n#endif\n#if(defined(X3D_GEOMETRY_2D)||defined(X3D_GEOMETRY_3D))&&defined(X3D_STYLE_PROPERTIES)\nfinalColor=getHatchColor(finalColor);\n#endif\n#if defined(X3D_FOG)\nfinalColor.rgb=getFogColor(finalColor.rgb);\n#endif\n#if defined(X3D_ALPHA_MODE_OPAQUE)\nfinalColor.a=1.0;\n#endif\n#if defined(X3D_ALPHA_MODE_MASK)\nif(finalColor.a<x3d_AlphaCutoff)discard;finalColor.a=1.0;\n#endif\ngl_FragColor=finalColor;\n#if defined(X3D_LOGARITHMIC_DEPTH_BUFFER)\ngl_FragDepthEXT=log2(depth)*x3d_LogarithmicFarFactor1_2;\n#endif\n}`;i.add("Fragment1.glsl","assets/shaders/webgl1/common/Fragment1.glsl",Sx);const Tx=Sx,vx="#if(defined(X3D_GEOMETRY_2D)||defined(X3D_GEOMETRY_3D))&&defined(X3D_STYLE_PROPERTIES)\nuniform x3d_FillPropertiesParameters x3d_FillProperties;vec4 getHatchColor(vec4 color){vec4 finalColor=x3d_FillProperties.filled?color:vec4(0.0);\n#if defined(X3D_STYLE_PROPERTIES_TEXTURE)\nvec2 t=gl_FragCoord.xy/(32.0*x3d_FillProperties.scale);vec4 hatch=texture2D(x3d_FillProperties.texture,vec2(t.x,1.0-t.y));hatch.rgb*=x3d_FillProperties.hatchColor;finalColor=mix(finalColor,hatch,hatch.a);\n#endif\nreturn finalColor;}\n#endif\n";i.add("Hatch1.glsl","assets/shaders/webgl1/common/Hatch1.glsl",vx);const Ox=vx,Ex="#if defined(X3D_LIGHTING)\nfloat getAttenuation(const in vec3 attenuation,const in float distanceToLight){return 1.0/max(dot(attenuation,vec3(1.0,distanceToLight,distanceToLight*distanceToLight)),1.0);}float getSpotFactor(const in vec3 pointToLight,const in vec3 direction,const in float cutOffAngle,const in float beamWidth){float spotAngle=acos(clamp(dot(-pointToLight,direction),-1.0,1.0));if(spotAngle>=cutOffAngle)return 0.0;else if(spotAngle<=beamWidth)return 1.0;return(spotAngle-cutOffAngle)/(beamWidth-cutOffAngle);}\n#endif\n";i.add("Lighting1.glsl","assets/shaders/webgl1/common/Lighting1.glsl",Ex);const Cx=Ex,Nx='uniform x3d_MaterialParameters x3d_Material;\n#if defined(X3D_LIGHTING)\n#pragma X3D include "Lighting.glsl"\n#pragma X3D include "Shadow.glsl"\nuniform x3d_LightSourceParameters x3d_LightSource[X3D_NUM_LIGHTS];vec3 getMaterialColor(const in vec3 vertex,const in vec3 N,const in vec3 ambientColor,const in vec3 diffuseColor,const in vec3 specularColor,const in float shininess){vec3 V=normalize(-vertex);vec3 finalColor=vec3(0.0);for(int i=0;i<X3D_NUM_LIGHTS;++i){x3d_LightSourceParameters light=x3d_LightSource[i];vec3 vL=light.location-vertex;float dL=length(light.matrix*vL);bool di=light.type==x3d_DirectionalLight;if(di||dL<=light.radius||light.radius<0.0){vec3 d=light.direction;vec3 c=light.attenuation;vec3 L=di?-d:normalize(vL);vec3 H=normalize(L+V);float lightAngle=max(dot(N,L),0.0);vec3 diffuseTerm=diffuseColor*lightAngle;float specularFactor=shininess>0.0?pow(max(dot(N,H),0.0),shininess*128.0):1.0;vec3 specularTerm=specularColor*specularFactor;float attenuationFactor=di?1.0:getAttenuation(c,dL);float spotFactor=light.type==x3d_SpotLight?getSpotFactor(L,d,light.cutOffAngle,light.beamWidth):1.0;float attenuationSpotFactor=attenuationFactor*spotFactor;vec3 ambientTerm=light.ambientIntensity*ambientColor;vec3 diffuseSpecularTerm=light.intensity*(diffuseTerm+specularTerm);\n#if defined(X3D_FRAGMENT_SHADER)&&defined(X3D_SHADOWS)\nif(lightAngle>0.0&&light.shadowIntensity>0.0)diffuseSpecularTerm=mix(diffuseSpecularTerm,light.shadowColor,getShadowIntensity(i,light));\n#endif\nfinalColor+=attenuationSpotFactor*light.color*(ambientTerm+diffuseSpecularTerm);}}return finalColor;}\n#endif\n';i.add("Material1.glsl","assets/shaders/webgl1/common/Material1.glsl",Nx);const Ix=Nx,Fx="#if defined(X3D_NORMAL_TEXTURE)\nmat3 getTBNMatrix(const in vec2 texCoord){vec3 pos_dx=dFdx(vertex);vec3 pos_dy=dFdy(vertex);vec3 tex_dx=dFdx(vec3(texCoord,0.0));vec3 tex_dy=dFdy(vec3(texCoord,0.0));vec3 t=(tex_dy.t*pos_dx-tex_dx.t*pos_dy)/(tex_dx.s*tex_dy.t-tex_dy.s*tex_dx.t);vec3 N=normalize(normal);vec3 T=normalize(t-N*dot(N,t));vec3 B=normalize(cross(N,T));mat3 tbn=mat3(T,B,N);return tbn;}\n#endif\n#if defined(X3D_NORMAL_TEXTURE)\nuniform x3d_NormalTextureParameters x3d_NormalTexture;\n#endif\nvec3 getNormalVector(const in float normalScale){float facing=gl_FrontFacing?1.0:-1.0;\n#if defined(X3D_NORMAL_TEXTURE)&&!defined(X3D_NORMAL_TEXTURE_3D)\nvec3 texCoord=getTexCoord(x3d_NormalTexture.textureTransformMapping,x3d_NormalTexture.textureCoordinateMapping);\n#if defined(X3D_NORMAL_TEXTURE_FLIP_Y)\ntexCoord.t=1.0-texCoord.t;\n#endif\nvec3 scale=vec3(vec2(normalScale),1.0);mat3 tbn=getTBNMatrix(texCoord.st);\n#if defined(X3D_NORMAL_TEXTURE_2D)\nvec3 n=texture2D(x3d_NormalTexture.texture2D,texCoord.st).rgb;\n#elif defined(X3D_NORMAL_TEXTURE_CUBE)\nvec3 n=textureCube(x3d_NormalTexture.textureCube,texCoord).rgb;\n#endif\nreturn normalize(tbn*((n*2.0-1.0)*scale))*facing;\n#else\nreturn normalize(normal)*facing;\n#endif\n}";i.add("Normal1.glsl","assets/shaders/webgl1/common/Normal1.glsl",Fx);const Mx=Fx,Dx="float rand(const in vec2 co){return fract(sin(dot(co.xy,vec2(12.9898,78.233)))*43758.5453);}float rand(const in vec2 co,const in float l){return rand(vec2(rand(co),l));}float rand(const in vec2 co,const in float l,const in float t){return rand(vec2(rand(co,l),t));}float perlin(const in vec2 p,const in float dim,const in float time){const float M_PI=3.14159265358979323846;vec2 pos=floor(p*dim);vec2 posx=pos+vec2(1.0,0.0);vec2 posy=pos+vec2(0.0,1.0);vec2 posxy=pos+vec2(1.0);float c=rand(pos,dim,time);float cx=rand(posx,dim,time);float cy=rand(posy,dim,time);float cxy=rand(posxy,dim,time);vec2 d=fract(p*dim);d=-0.5*cos(d*M_PI)+0.5;float ccx=mix(c,cx,d.x);float cycxy=mix(cy,cxy,d.x);float center=mix(ccx,cycxy,d.y);return center*2.0-1.0;}vec3 perlin(const in vec3 p){return vec3(perlin(p.xy,1.0,0.0),perlin(p.yz,1.0,0.0),perlin(p.zx,1.0,0.0));}";i.add("Perlin1.glsl","assets/shaders/webgl1/common/Perlin1.glsl",Dx);const Rx=Dx,Px=`#if defined(X3D_GEOMETRY_0D)&&defined(X3D_STYLE_PROPERTIES)\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\nvoid setPointTexCoords(){vec4 texCoord=vec4(gl_PointCoord.x,1.0-gl_PointCoord.y,0.0,1.0);\n${Array.from({length:4},((e,t)=>`\n#if X3D_NUM_TEXTURE_COORDINATES > ${t}\ntexCoord${t} = texCoord;\n#endif\n`)).join("\n")}\n}\n#define getPointColor(color)(color)\n#else\n#define setPointTexCoords()\nvarying float pointSize;vec4 getPointColor(in vec4 color){if(pointSize>1.0)color.a*=clamp(pointSize*(0.5-distance(vec2(0.5),gl_PointCoord)),0.0,1.0);else color.a*=pointSize;return color;}\n#endif\n#endif\n`;i.add("Point1.glsl","assets/shaders/webgl1/common/Point1.glsl",Px);const Ax=Px,Vx="#if defined(X3D_GEOMETRY_0D)&&defined(X3D_STYLE_PROPERTIES)\nuniform x3d_PointPropertiesParameters x3d_PointProperties;varying float pointSize;float getPointSize(const in vec3 vertex){float pointSizeMinValue=x3d_PointProperties.pointSizeMinValue;float pointSizeMaxValue=x3d_PointProperties.pointSizeMaxValue;vec3 attenuation=x3d_PointProperties.attenuation;float dL=length(vertex);float pointSize=0.0;pointSize=x3d_PointProperties.pointSizeScaleFactor;pointSize/=dot(attenuation,vec3(1.0,dL,dL*dL));pointSize=clamp(pointSize,pointSizeMinValue,pointSizeMaxValue);\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURE)\nreturn pointSize;\n#else\nreturn pointSize+1.0-step(pointSize,1.0);\n#endif\n}\n#endif\n";i.add("PointSize1.glsl","assets/shaders/webgl1/common/PointSize1.glsl",Vx);const Lx=Vx,Bx="#if defined(X3D_FRAGMENT_SHADER)&&defined(X3D_SHADOWS)\nuniform sampler2D x3d_ShadowMap[X3D_NUM_LIGHTS];float getShadowDepth(const in int index,const in vec2 shadowCoord){\n#if X3D_NUM_LIGHTS>0\nif(index==0)return texture2D(x3d_ShadowMap[0],shadowCoord).r;\n#endif\n#if X3D_NUM_LIGHTS>1\nif(index==1)return texture2D(x3d_ShadowMap[1],shadowCoord).r;\n#endif\n#if X3D_NUM_LIGHTS>2\nif(index==2)return texture2D(x3d_ShadowMap[2],shadowCoord).r;\n#endif\n#if X3D_NUM_LIGHTS>3\nif(index==3)return texture2D(x3d_ShadowMap[3],shadowCoord).r;\n#endif\n#if X3D_NUM_LIGHTS>4\nif(index==4)return texture2D(x3d_ShadowMap[4],shadowCoord).r;\n#endif\n#if X3D_NUM_LIGHTS>5\nif(index==5)return texture2D(x3d_ShadowMap[5],shadowCoord).r;\n#endif\n#if X3D_NUM_LIGHTS>6\nif(index==6)return texture2D(x3d_ShadowMap[6],shadowCoord).r;\n#endif\n#if X3D_NUM_LIGHTS>7\nif(index==7)return texture2D(x3d_ShadowMap[7],shadowCoord).r;\n#endif\nreturn 0.0;}float texture2DCompare(const in int index,const in vec2 texCoord,const in float compare){float shadowDepth=getShadowDepth(index,texCoord);return(1.0-step(1.0,shadowDepth))*step(shadowDepth,compare);}float texture2DShadowLerp(const in int index,const in vec2 texelSize,const in float shadowMapSize,const in vec2 texCoord,const in float compare){const vec2 offset=vec2(0.0,1.0);vec2 centroidTexCoord=floor(texCoord*shadowMapSize+0.5)/shadowMapSize;float lb=texture2DCompare(index,centroidTexCoord+texelSize*offset.xx,compare);float lt=texture2DCompare(index,centroidTexCoord+texelSize*offset.xy,compare);float rb=texture2DCompare(index,centroidTexCoord+texelSize*offset.yx,compare);float rt=texture2DCompare(index,centroidTexCoord+texelSize*offset.yy,compare);vec2 f=fract(texCoord*shadowMapSize+0.5);float a=mix(lb,lt,f.y);float b=mix(rb,rt,f.y);float c=mix(a,b,f.x);return c;}vec2 cubeToUVCompact(in vec3 v,const float texelSizeY){vec3 absV=abs(v);float scaleToCube=1.0/max(absV.x,max(absV.y,absV.z));absV*=scaleToCube;v*=scaleToCube*(1.0-2.0*texelSizeY);vec2 planar=v.xy;float almostATexel=1.5*texelSizeY;float almostOne=1.0-almostATexel;if(absV.z>=almostOne){if(v.z>0.0)planar.x=4.0-v.x;}else if(absV.x>=almostOne){float signX=sign(v.x);planar.x=v.z*signX+2.0*signX;}else if(absV.y>=almostOne){float signY=sign(v.y);planar.x=(v.x+0.5+signY)*2.0;planar.y=v.z*signY-2.0;}return vec2(0.125,0.25)*planar+vec2(0.375,0.75);}mat4 getPointLightRotations(const in vec3 vector){mat4 rotations[6];rotations[0]=mat4(0,0,1,0,0,1,0,0,-1,0,0,0,0,0,0,1);rotations[1]=mat4(0,0,-1,0,0,1,0,0,1,0,0,0,0,0,0,1);rotations[2]=mat4(-1,0,0,0,0,1,0,0,0,0,-1,0,0,0,0,1);rotations[3]=mat4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);rotations[4]=mat4(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1);rotations[5]=mat4(1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1);vec3 a=abs(vector.xyz);if(a.x>a.y){if(a.x>a.z)return vector.x>0.0?rotations[1]:rotations[0];else return vector.z>0.0?rotations[2]:rotations[3];}else{if(a.y>a.z)return vector.y>0.0?rotations[5]:rotations[4];else return vector.z>0.0?rotations[2]:rotations[3];}return rotations[3];}float getShadowIntensity(const in int index,const in x3d_LightSourceParameters light){if(light.type==x3d_PointLight){const mat4 biasMatrix=mat4(0.5,0.0,0.0,0.0,0.0,0.5,0.0,0.0,0.0,0.0,0.5,0.0,0.5,0.5,0.5,1.0);const mat4 projectionMatrix=mat4(1.0,0.0,0.0,0.0,0.0,0.5,0.0,0.0,0.0,0.0,-1.000025000312504,-1.0,0,0.0,-0.25000312503906297,0.0);vec2 texelSize=vec2(1.0)/(float(light.shadowMapSize)*vec2(4.0,2.0));vec4 shadowCoord=light.shadowMatrix*vec4(vertex,1.0);vec3 lightToPosition=shadowCoord.xyz;shadowCoord=biasMatrix*(projectionMatrix*(getPointLightRotations(lightToPosition)*shadowCoord));shadowCoord.z-=light.shadowBias;shadowCoord.xyz/=shadowCoord.w;\n#if defined(X3D_PCF_FILTERING)||defined(X3D_PCF_SOFT_FILTERING)\nvec2 offset=vec2(-1,1)*(texelSize.y*42.0);float value=(texture2DCompare(index,cubeToUVCompact(lightToPosition+offset.xyy,texelSize.y),shadowCoord.z)+texture2DCompare(index,cubeToUVCompact(lightToPosition+offset.yyy,texelSize.y),shadowCoord.z)+texture2DCompare(index,cubeToUVCompact(lightToPosition+offset.xyx,texelSize.y),shadowCoord.z)+texture2DCompare(index,cubeToUVCompact(lightToPosition+offset.yyx,texelSize.y),shadowCoord.z)+texture2DCompare(index,cubeToUVCompact(lightToPosition,texelSize.y),shadowCoord.z)+texture2DCompare(index,cubeToUVCompact(lightToPosition+offset.xxy,texelSize.y),shadowCoord.z)+texture2DCompare(index,cubeToUVCompact(lightToPosition+offset.yxy,texelSize.y),shadowCoord.z)+texture2DCompare(index,cubeToUVCompact(lightToPosition+offset.xxx,texelSize.y),shadowCoord.z)+texture2DCompare(index,cubeToUVCompact(lightToPosition+offset.yxx,texelSize.y),shadowCoord.z))*(1.0/9.0);return light.shadowIntensity*value;\n#else \nfloat value=texture2DCompare(index,cubeToUVCompact(lightToPosition,texelSize.y),shadowCoord.z);return light.shadowIntensity*value;\n#endif\n}else{\n#if defined(X3D_PCF_FILTERING)\nvec2 texelSize=vec2(1.0)/vec2(light.shadowMapSize);vec4 shadowCoord=light.shadowMatrix*vec4(vertex,1.0);shadowCoord.z-=light.shadowBias;shadowCoord.xyz/=shadowCoord.w;if(any(greaterThan(abs(shadowCoord.xy-0.5),vec2(0.5))))return 0.0;vec2 d0=-texelSize;vec2 d1=texelSize;float value=(texture2DCompare(index,shadowCoord.xy+d0,shadowCoord.z)+texture2DCompare(index,shadowCoord.xy+vec2(0.0,d0.y),shadowCoord.z)+texture2DCompare(index,shadowCoord.xy+vec2(d1.x,d0.y),shadowCoord.z)+texture2DCompare(index,shadowCoord.xy+vec2(d0.x,0.0),shadowCoord.z)+texture2DCompare(index,shadowCoord.xy,shadowCoord.z)+texture2DCompare(index,shadowCoord.xy+vec2(d1.x,0.0),shadowCoord.z)+texture2DCompare(index,shadowCoord.xy+vec2(d0.x,d1.y),shadowCoord.z)+texture2DCompare(index,shadowCoord.xy+vec2(0.0,d1.y),shadowCoord.z)+texture2DCompare(index,shadowCoord.xy+d1,shadowCoord.z))*(1.0/9.0);return light.shadowIntensity*value;\n#elif defined(X3D_PCF_SOFT_FILTERING)\nvec2 texelSize=vec2(1.0)/vec2(light.shadowMapSize);vec4 shadowCoord=light.shadowMatrix*vec4(vertex,1.0);shadowCoord.z-=light.shadowBias;shadowCoord.xyz/=shadowCoord.w;if(any(greaterThan(abs(shadowCoord.xy-0.5),vec2(0.5))))return 0.0;vec2 d0=-texelSize;vec2 d1=texelSize;float value=(texture2DShadowLerp(index,texelSize,float(shadowMapSize),shadowCoord.xy+d0,shadowCoord.z)+texture2DShadowLerp(index,texelSize,float(shadowMapSize),shadowCoord.xy+vec2(0.0,d0.y),shadowCoord.z)+texture2DShadowLerp(index,texelSize,float(shadowMapSize),shadowCoord.xy+vec2(d1.x,d0.y),shadowCoord.z)+texture2DShadowLerp(index,texelSize,float(shadowMapSize),shadowCoord.xy+vec2(d0.x,0.0),shadowCoord.z)+texture2DShadowLerp(index,texelSize,float(shadowMapSize),shadowCoord.xy,shadowCoord.z)+texture2DShadowLerp(index,texelSize,float(shadowMapSize),shadowCoord.xy+vec2(d1.x,0.0),shadowCoord.z)+texture2DShadowLerp(index,texelSize,float(shadowMapSize),shadowCoord.xy+vec2(d0.x,d1.y),shadowCoord.z)+texture2DShadowLerp(index,texelSize,float(shadowMapSize),shadowCoord.xy+vec2(0.0,d1.y),shadowCoord.z)+texture2DShadowLerp(index,texelSize,float(shadowMapSize),shadowCoord.xy+d1,shadowCoord.z))*(1.0/9.0);return light.shadowIntensity*value;\n#else \nvec4 shadowCoord=light.shadowMatrix*vec4(vertex,1.0);shadowCoord.z-=light.shadowBias;shadowCoord.xyz/=shadowCoord.w;if(any(greaterThan(abs(shadowCoord.xy-0.5),vec2(0.5))))return 0.0;float value=texture2DCompare(index,shadowCoord.xy,shadowCoord.z);return light.shadowIntensity*value;\n#endif\n}return 0.0;}\n#endif\n";i.add("Shadow1.glsl","assets/shaders/webgl1/common/Shadow1.glsl",Bx);const Ux=Bx,Xx=`#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\n#pragma X3D include "Perlin.glsl"\nuniform mat4 x3d_TextureMatrix[X3D_NUM_TEXTURE_TRANSFORMS];mat4 getTextureMatrix(const in int i){\n#if X3D_NUM_TEXTURE_TRANSFORMS>1\nmat4 textureTransformMatrix=mat4(0.0);\n${Array.from({length:4},((e,t)=>`\n#if X3D_NUM_TEXTURE_TRANSFORMS > ${t}\n${0===t?"":"else"} if (i == ${t})\ntextureTransformMatrix = x3d_TextureMatrix [${t}];\n#endif\n`)).join("\n")}\n return textureTransformMatrix;\n#else\nreturn x3d_TextureMatrix[0];\n#endif\n}vec4 getTexCoord(const in int i){\n#if X3D_NUM_TEXTURE_COORDINATES>1\nvec4 texCoord=vec4(0.0);\n${Array.from({length:4},((e,t)=>`\n#if X3D_NUM_TEXTURE_COORDINATES > ${t}\n${0===t?"":"else"} if (i == ${t})\ntexCoord = texCoord${t};\n#endif\n`)).join("\n")}\n return texCoord;\n#else\nreturn texCoord0;\n#endif\n}vec4 getTexCoord(const in x3d_TextureCoordinateGeneratorParameters textureCoordinateGenerator,const in int textureTransformMapping,const in int textureCoordinateMapping){int mode=textureCoordinateGenerator.mode;if(mode==x3d_None){return getTextureMatrix(textureTransformMapping)*getTexCoord(textureCoordinateMapping);}else if(mode==x3d_Sphere){vec2 N=normalize(gl_FrontFacing?normal:-normal).xy;return vec4(N*0.5+0.5,0.0,1.0);}else if(mode==x3d_CameraSpaceNormal){vec3 N=normalize(gl_FrontFacing?normal:-normal);return vec4(N,1.0);}else if(mode==x3d_CameraSpacePosition){return vec4(vertex,1.0);}else if(mode==x3d_CameraSpaceReflectionVector){vec3 N=normalize(gl_FrontFacing?normal:-normal);return vec4(reflect(normalize(vertex),-N),1.0);}else if(mode==x3d_SphereLocal){vec2 N=normalize(gl_FrontFacing?localNormal:-localNormal).xy;return vec4(N*0.5+0.5,0.0,1.0);}else if(mode==x3d_Coord){return vec4(localVertex,1.0);}else if(mode==x3d_CoordEye){return vec4(vertex,1.0);}else if(mode==x3d_Noise){vec3 scale=vec3(textureCoordinateGenerator.parameter[0],textureCoordinateGenerator.parameter[1],textureCoordinateGenerator.parameter[2]);vec3 translation=vec3(textureCoordinateGenerator.parameter[3],textureCoordinateGenerator.parameter[4],textureCoordinateGenerator.parameter[5]);return vec4(perlin(localVertex*scale+translation),1.0);}else if(mode==x3d_NoiseEye){vec3 scale=vec3(textureCoordinateGenerator.parameter[0],textureCoordinateGenerator.parameter[1],textureCoordinateGenerator.parameter[2]);vec3 translation=vec3(textureCoordinateGenerator.parameter[3],textureCoordinateGenerator.parameter[4],textureCoordinateGenerator.parameter[5]);return vec4(perlin(vertex*scale+translation),1.0);}else if(mode==x3d_SphereReflect){vec3 N=normalize(gl_FrontFacing?normal:-normal);float eta=textureCoordinateGenerator.parameter[0];return vec4(refract(normalize(vertex),-N,eta),1.0);}else if(mode==x3d_SphereReflectLocal){vec3 N=normalize(gl_FrontFacing?localNormal:-localNormal);float eta=textureCoordinateGenerator.parameter[0];vec3 eye=vec3(textureCoordinateGenerator.parameter[1],textureCoordinateGenerator.parameter[2],textureCoordinateGenerator.parameter[3]);return vec4(refract(normalize(localVertex-eye),-N,eta),1.0);}return getTextureMatrix(textureTransformMapping)*getTexCoord(textureCoordinateMapping);}uniform x3d_TextureCoordinateGeneratorParameters x3d_TextureCoordinateGenerator[X3D_NUM_TEXTURE_COORDINATES];vec3 getTexCoord(const in int textureTransformMapping,const in int textureCoordinateMapping){vec4 texCoord;\n${Array.from({length:4},((e,t)=>`\n#if X3D_NUM_TEXTURE_COORDINATES > ${t}\n${0===t?"":"else"} if (textureCoordinateMapping == ${t})\ntexCoord = getTexCoord (x3d_TextureCoordinateGenerator [${t}], textureTransformMapping, textureCoordinateMapping);\n#endif\n`)).join("\n")}\n \n#if defined(X3D_GEOMETRY_2D)\nif(gl_FrontFacing==false)texCoord.s=1.0-texCoord.s;\n#endif\nreturn texCoord.stp;}\n#endif \n#if defined(X3D_TEXTURE)\nuniform sampler2D x3d_Texture2D[X3D_NUM_TEXTURES];uniform samplerCube x3d_TextureCube[X3D_NUM_TEXTURES];vec4 getTexture(const in int i,in vec3 texCoord){vec4 textureColor=vec4(1.0);\n${Array.from({length:4},((e,t)=>`\n#if X3D_NUM_TEXTURES > ${t}\n${0===t?"":"else"} if (i == ${t})\n{\n#if !defined (X3D_PHYSICAL_MATERIAL) && defined (X3D_TEXTURE${t}_FLIP_Y)\ntexCoord .t = 1.0 - texCoord .t;\n#endif\n#if defined (X3D_TEXTURE${t}_2D)\ntextureColor = texture2D (x3d_Texture2D [${t}], texCoord .st);\n#elif defined (X3D_TEXTURE${t}_CUBE)\ntextureColor = textureCube (x3d_TextureCube [${t}], texCoord .stp);\n#endif\n#if defined (X3D_PHYSICAL_MATERIAL) && !defined (X3D_TEXTURE${t}_LINEAR)\ntextureColor = sRGBToLinear (textureColor);\n#elif !defined (X3D_PHYSICAL_MATERIAL) && defined (X3D_TEXTURE${t}_LINEAR)\ntextureColor = linearTosRGB (textureColor);\n#endif\n}\n#endif\n`)).join("\n")}\n return textureColor;}\n#if defined(X3D_MULTI_TEXTURING)\nuniform vec4 x3d_MultiTextureColor;uniform x3d_MultiTextureParameters x3d_MultiTexture[X3D_NUM_TEXTURES];\n#endif\nint minI(const in int a,const in int b){return a<b?a:b;}vec4 getTextureColor(const in vec4 diffuseColor,const in vec4 specularColor){\n#if defined(X3D_MULTI_TEXTURING)\nvec4 currentColor=diffuseColor;for(int i=0;i<X3D_NUM_TEXTURES;++i){vec3 texCoord=getTexCoord(minI(i,X3D_NUM_TEXTURE_TRANSFORMS-1),minI(i,X3D_NUM_TEXTURE_COORDINATES-1));vec4 textureColor=getTexture(i,texCoord);x3d_MultiTextureParameters multiTexture=x3d_MultiTexture[i];vec4 arg1=textureColor;vec4 arg2=currentColor;int source=multiTexture.source;if(source==x3d_Diffuse){arg1=diffuseColor;}else if(source==x3d_Specular){arg1=specularColor;}else if(source==x3d_Factor){arg1=x3d_MultiTextureColor;}int function=multiTexture.function;if(function==x3d_Complement){arg1=1.0-arg1;}else if(function==x3d_AlphaReplicate){arg1.a=arg2.a;}int mode=multiTexture.mode;int alphaMode=multiTexture.alphaMode;if(mode==x3d_Replace){currentColor.rgb=arg1.rgb;}else if(mode==x3d_Modulate){currentColor.rgb=arg1.rgb*arg2.rgb;}else if(mode==x3d_Modulate2X){currentColor.rgb=(arg1.rgb*arg2.rgb)*2.0;}else if(mode==x3d_Modulate4X){currentColor.rgb=(arg1.rgb*arg2.rgb)*4.0;}else if(mode==x3d_Add){currentColor.rgb=arg1.rgb+arg2.rgb;}else if(mode==x3d_AddSigned){currentColor.rgb=arg1.rgb+arg2.rgb-0.5;}else if(mode==x3d_AddSigned2X){currentColor.rgb=(arg1.rgb+arg2.rgb-0.5)*2.0;}else if(mode==x3d_AddSmooth){currentColor.rgb=arg1.rgb+(1.0-arg1.rgb)*arg2.rgb;}else if(mode==x3d_Subtract){currentColor.rgb=arg1.rgb-arg2.rgb;}else if(mode==x3d_BlendDiffuseAlpha){currentColor.rgb=arg1.rgb*diffuseColor.a+arg2.rgb*(1.0-diffuseColor.a);}else if(mode==x3d_BlendTextureAlpha){currentColor.rgb=arg1.rgb*arg1.a+arg2.rgb*(1.0-arg1.a);}else if(mode==x3d_BlendFactorAlpha){currentColor.rgb=arg1.rgb*x3d_MultiTextureColor.a+arg2.rgb*(1.0-x3d_MultiTextureColor.a);}else if(mode==x3d_BlendCurrentAlpha){currentColor.rgb=arg1.rgb*arg2.a+arg2.rgb*(1.0-arg2.a);}else if(mode==x3d_ModulateAlphaAddColor){currentColor.rgb=arg1.rgb+arg1.a*arg2.rgb;}else if(mode==x3d_ModulateInvAlphaAddColor){currentColor.rgb=(1.0-arg1.a)*arg2.rgb+arg1.rgb;}else if(mode==x3d_ModulateInvColorAddAlpha){currentColor.rgb=(1.0-arg1.rgb)*arg2.rgb+arg1.a;}else if(mode==x3d_DotProduct3){currentColor.rgb=vec3(dot(arg1.rgb*2.0-1.0,arg2.rgb*2.0-1.0));}else if(mode==x3d_SelectArg1){currentColor.rgb=arg1.rgb;}else if(mode==x3d_SelectArg2){currentColor.rgb=arg2.rgb;}else if(mode==x3d_Off);if(alphaMode==x3d_Replace){currentColor.a=arg1.a;}else if(alphaMode==x3d_Modulate){currentColor.a=arg1.a*arg2.a;}else if(alphaMode==x3d_Modulate2X){currentColor.a=(arg1.a*arg2.a)*2.0;}else if(alphaMode==x3d_Modulate4X){currentColor.a=(arg1.a*arg2.a)*4.0;}else if(alphaMode==x3d_Add){currentColor.a=arg1.a+arg2.a;}else if(alphaMode==x3d_AddSigned){currentColor.a=arg1.a+arg2.a-0.5;}else if(alphaMode==x3d_AddSigned2X){currentColor.a=(arg1.a+arg2.a-0.5)*2.0;}else if(alphaMode==x3d_AddSmooth){currentColor.a=arg1.a+(1.0-arg1.a)*arg2.a;}else if(alphaMode==x3d_Subtract){currentColor.a=arg1.a-arg2.a;}else if(alphaMode==x3d_BlendDiffuseAlpha){currentColor.a=arg1.a*diffuseColor.a+arg2.a*(1.0-diffuseColor.a);}else if(alphaMode==x3d_BlendTextureAlpha){currentColor.a=arg1.a*arg1.a+arg2.a*(1.0-arg1.a);}else if(alphaMode==x3d_BlendFactorAlpha){currentColor.a=arg1.a*x3d_MultiTextureColor.a+arg2.a*(1.0-x3d_MultiTextureColor.a);}else if(alphaMode==x3d_BlendCurrentAlpha){currentColor.a=arg1.a*arg2.a+arg2.a*(1.0-arg2.a);}else if(alphaMode==x3d_ModulateAlphaAddColor){currentColor.a=arg1.a+arg1.a*arg2.a;}else if(alphaMode==x3d_ModulateInvAlphaAddColor){currentColor.a=(1.0-arg1.a)*arg2.a+arg1.a;}else if(alphaMode==x3d_ModulateInvColorAddAlpha){currentColor.a=(1.0-arg1.a)*arg2.a+arg1.a;}else if(alphaMode==x3d_DotProduct3){currentColor.a=dot(arg1.rgb*2.0-1.0,arg2.rgb*2.0-1.0);}else if(alphaMode==x3d_SelectArg1){currentColor.a=arg1.a;}else if(alphaMode==x3d_SelectArg2){currentColor.a=arg2.a;}else if(alphaMode==x3d_Off);}return currentColor;\n#else\nvec3 texCoord=getTexCoord(0,0);vec4 textureColor=getTexture(0,texCoord);return diffuseColor*textureColor;\n#endif\n}\n#endif\n#if defined(X3D_TEXTURE_PROJECTION)\nuniform vec3 x3d_TextureProjectorColor[X3D_NUM_TEXTURE_PROJECTORS];uniform float x3d_TextureProjectorIntensity[X3D_NUM_TEXTURE_PROJECTORS];uniform vec3 x3d_TextureProjectorLocation[X3D_NUM_TEXTURE_PROJECTORS];uniform vec3 x3d_TextureProjectorParams[X3D_NUM_TEXTURE_PROJECTORS];uniform mat4 x3d_TextureProjectorMatrix[X3D_NUM_TEXTURE_PROJECTORS];uniform sampler2D x3d_TextureProjectorTexture[X3D_NUM_TEXTURE_PROJECTORS];vec4 getTextureProjectorTexture(const in int i,const in vec2 texCoord){vec4 textureColor=vec4(1.0);\n${Array.from({length:4},((e,t)=>`\n#if X3D_NUM_TEXTURE_PROJECTORS > ${t}\n${0===t?"":"else"} if (i == ${t})\n{\ntextureColor = texture2D (x3d_TextureProjectorTexture [${t}], texCoord);\n}\n#endif\n`)).join("\n")}\n return textureColor;}vec3 getTextureProjectorColor(){vec3 currentColor=vec3(1.0);vec3 N=gl_FrontFacing?normal:-normal;for(int i=0;i<X3D_NUM_TEXTURE_PROJECTORS;++i){vec4 texCoord=x3d_TextureProjectorMatrix[i]*vec4(vertex,1.0);texCoord.stp/=texCoord.q;texCoord.p=clamp(texCoord.p,x3d_TextureProjectorParams[i].x,x3d_TextureProjectorParams[i].y);if(any(greaterThan(abs(texCoord.stp-0.5),vec3(0.5))))continue;vec3 p=x3d_TextureProjectorLocation[i]-vertex;if(dot(N,p)<0.0)continue;vec4 T=getTextureProjectorTexture(i,texCoord.st);\n#if defined(X3D_PHYSICAL_MATERIAL)\nif(!bool(x3d_TextureProjectorParams[i].z))T=sRGBToLinear(T);\n#else\nif(bool(x3d_TextureProjectorParams[i].z))T=linearTosRGB(T);\n#endif\ncurrentColor*=mix(vec3(1.0),T.rgb*x3d_TextureProjectorColor[i],T.a*x3d_TextureProjectorIntensity[i]);}return currentColor;}\n#endif \n`;i.add("Texture1.glsl","assets/shaders/webgl1/common/Texture1.glsl",Xx);const jx=Xx,kx=`uniform mat4 x3d_ProjectionMatrix;uniform mat4 x3d_ModelViewMatrix;\n#if defined(X3D_FOG)&&defined(X3D_FOG_COORDS)\nattribute float x3d_FogDepth;\n#endif\n#if defined(X3D_COLOR_MATERIAL)\nattribute vec4 x3d_Color;\n#endif\n#if!defined(X3D_GEOMETRY_0D)&&!defined(X3D_GEOMETRY_1D)\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\n\n${Array.from({length:4},((e,t)=>`\n#if X3D_NUM_TEXTURE_COORDINATES > ${t}\nattribute vec4 x3d_TexCoord${t};\n#endif\n`)).join("\n")}\n \n#endif\n#endif\nattribute vec4 x3d_Vertex;\n#if defined(X3D_FOG)&&defined(X3D_FOG_COORDS)\nvarying float fogDepth;\n#endif\n#if defined(X3D_COLOR_MATERIAL)\nvarying vec4 color;\n#endif\n#if!defined(X3D_GEOMETRY_0D)&&!defined(X3D_GEOMETRY_1D)\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\n\n${Array.from({length:4},((e,t)=>`\n#if X3D_NUM_TEXTURE_COORDINATES > ${t}\nvarying vec4 texCoord${t};\n#endif\n`)).join("\n")}\n \n#endif\n#endif\n#if defined(X3D_NORMALS)\nuniform mat3 x3d_NormalMatrix;attribute vec3 x3d_Normal;varying vec3 normal;\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\nvarying vec3 localNormal;\n#endif\n#endif\nvarying vec3 vertex;\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\nvarying vec3 localVertex;\n#endif\n#if defined(X3D_LOGARITHMIC_DEPTH_BUFFER)\nvarying float depth;\n#endif\n#pragma X3D include "PointSize.glsl"\nvoid vertex_main(){vec4 position=x3d_ModelViewMatrix*x3d_Vertex;vertex=position.xyz;\n#if defined(X3D_GEOMETRY_0D)\n#if defined(X3D_STYLE_PROPERTIES)\ngl_PointSize=pointSize=getPointSize(vertex);\n#else\ngl_PointSize=1.0;\n#endif\n#endif\n#if defined(X3D_FOG)&&defined(X3D_FOG_COORDS)\nfogDepth=x3d_FogDepth;\n#endif\n#if defined(X3D_COLOR_MATERIAL)\ncolor=x3d_Color;\n#endif\n#if!defined(X3D_GEOMETRY_0D)&&!defined(X3D_GEOMETRY_1D)\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\n\n${Array.from({length:4},((e,t)=>`\n#if X3D_NUM_TEXTURE_COORDINATES > ${t}\ntexCoord${t} = x3d_TexCoord${t};\n#endif\n`)).join("\n")}\n \n#endif\n#endif\n#if defined(X3D_NORMALS)\nnormal=x3d_NormalMatrix*x3d_Normal;\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\nlocalNormal=x3d_Normal;\n#endif\n#endif\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\nlocalVertex=x3d_Vertex.xyz;\n#endif\ngl_Position=x3d_ProjectionMatrix*position;\n#if defined(X3D_LOGARITHMIC_DEPTH_BUFFER)\ndepth=1.0+gl_Position.w;\n#endif\n}`;i.add("Vertex1.glsl","assets/shaders/webgl1/common/Vertex1.glsl",kx);const zx=kx,Gx="#if defined(X3D_CLIP_PLANES)\nuniform vec4 x3d_ClipPlane[X3D_NUM_CLIP_PLANES];void clip(){for(int i=0;i<X3D_NUM_CLIP_PLANES;++i){if(dot(vertex,x3d_ClipPlane[i].xyz)-x3d_ClipPlane[i].w<0.0)discard;}}\n#endif\n";i.add("ClipPlanes2.glsl","assets/shaders/webgl2/common/ClipPlanes2.glsl",Gx);const Hx=Gx,qx="#if defined(X3D_FOG)\nuniform x3d_FogParameters x3d_Fog;float getFogInterpolant(){\n#if defined(X3D_FOG_COORDS)\nreturn clamp(1.0-fogDepth,0.0,1.0);\n#else\nfloat visibilityRange=x3d_Fog.visibilityRange;float dV=length(x3d_Fog.matrix*vertex);\n#if defined(X3D_FOG_LINEAR)\nreturn max(0.0,visibilityRange-dV)/visibilityRange;\n#elif defined(X3D_FOG_EXPONENTIAL)\nreturn exp(-dV/max(0.001,visibilityRange-dV));\n#endif\n#endif\n}vec3 getFogColor(const in vec3 color){return mix(x3d_Fog.color,color,getFogInterpolant());}\n#endif\n";i.add("Fog2.glsl","assets/shaders/webgl2/common/Fog2.glsl",qx);const Yx=qx,Wx=`#if defined(X3D_ALPHA_MODE_MASK)\nuniform float x3d_AlphaCutoff;\n#endif\n#if defined(X3D_FOG)&&defined(X3D_FOG_COORDS)\nin float fogDepth;\n#endif\n#if defined(X3D_COLOR_MATERIAL)\nin vec4 color;\n#endif\n#if!defined(X3D_GEOMETRY_0D)&&!defined(X3D_GEOMETRY_1D)\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\n\n${Array.from({length:4},((e,t)=>`\n#if X3D_NUM_TEXTURE_COORDINATES > ${t}\nin vec4 texCoord${t};\n#endif\n`)).join("\n")}\n \n#endif\n#else\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\n\n${Array.from({length:4},((e,t)=>`\n#if X3D_NUM_TEXTURE_COORDINATES > ${t}\nvec4 texCoord${t} = vec4 (0.0, 0.0, 0.0, 1.0);\n#endif\n`)).join("\n")}\n \n#endif\n#endif\n#if defined(X3D_NORMALS)\nin vec3 normal;\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\nin vec3 localNormal;\n#endif\n#else\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\nconst vec3 localNormal=vec3(0.0,0.0,1.0);\n#endif\n#endif\nin vec3 vertex;\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\nin vec3 localVertex;\n#endif\n#if defined(X3D_LOGARITHMIC_DEPTH_BUFFER)\nuniform float x3d_LogarithmicFarFactor1_2;in float depth;\n#endif\n#if defined(X3D_ORDER_INDEPENDENT_TRANSPARENCY)\nlayout(location=0)out vec4 x3d_FragData0;layout(location=1)out vec4 x3d_FragData1;\n#else\nout vec4 x3d_FragColor;\n#endif\n#pragma X3D include "../pbr/ToneMapping.glsl"\n#pragma X3D include "Texture.glsl"\n#pragma X3D include "ClipPlanes.glsl"\n#pragma X3D include "Point.glsl"\n#pragma X3D include "Stipple.glsl"\n#pragma X3D include "Hatch.glsl"\n#pragma X3D include "Fog.glsl"\nvec4 getMaterialColor();\n#if defined(X3D_ORDER_INDEPENDENT_TRANSPARENCY)\nfloat weight(const in float z,const in float a){return clamp(pow(min(1.0,a*10.0)+0.01,3.0)*1e8*pow(1.0-z*0.9,3.0),1e-2,3e3);}\n#endif\nvoid fragment_main(){\n#if defined(X3D_CLIP_PLANES)\nclip();\n#endif\n#if defined(X3D_GEOMETRY_1D)&&defined(X3D_STYLE_PROPERTIES)\nstipple();\n#endif\n#if defined(X3D_GEOMETRY_0D)&&defined(X3D_STYLE_PROPERTIES)\nsetPointTexCoords();\n#elif defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\nsetTexCoords();\n#endif\nvec4 finalColor=getMaterialColor();\n#if defined(X3D_GEOMETRY_0D)&&defined(X3D_STYLE_PROPERTIES)\nfinalColor=getPointColor(finalColor);\n#endif\n#if(defined(X3D_GEOMETRY_2D)||defined(X3D_GEOMETRY_3D))&&defined(X3D_STYLE_PROPERTIES)\nfinalColor=getHatchColor(finalColor);\n#endif\n#if defined(X3D_FOG)\nfinalColor.rgb=getFogColor(finalColor.rgb);\n#endif\n#if defined(X3D_ALPHA_MODE_OPAQUE)\nfinalColor.a=1.0;\n#endif\n#if defined(X3D_ALPHA_MODE_MASK)\nif(finalColor.a<x3d_AlphaCutoff)discard;finalColor.a=1.0;\n#endif\n#if defined(X3D_ORDER_INDEPENDENT_TRANSPARENCY)\nfloat a=finalColor.a;float w=weight(gl_FragCoord.z,a);finalColor.rgb*=a;finalColor*=w;x3d_FragData0=vec4(finalColor.rgb,a);x3d_FragData1=vec4(finalColor.a);\n#else\nx3d_FragColor=finalColor;\n#endif\n#if defined(X3D_LOGARITHMIC_DEPTH_BUFFER)\ngl_FragDepth=log2(depth)*x3d_LogarithmicFarFactor1_2;\n#endif\n}`;i.add("Fragment2.glsl","assets/shaders/webgl2/common/Fragment2.glsl",Wx);const $x=Wx,Jx="#if(defined(X3D_GEOMETRY_2D)||defined(X3D_GEOMETRY_3D))&&defined(X3D_STYLE_PROPERTIES)\nuniform x3d_FillPropertiesParameters x3d_FillProperties;vec4 getHatchColor(vec4 color){vec4 finalColor=x3d_FillProperties.filled?color:vec4(0.0);\n#if defined(X3D_STYLE_PROPERTIES_TEXTURE)\nvec2 t=gl_FragCoord.xy/(32.0*x3d_FillProperties.scale);vec4 hatch=texture(x3d_FillProperties.texture,vec2(t.x,1.0-t.y));hatch.rgb*=x3d_FillProperties.hatchColor;finalColor=mix(finalColor,hatch,hatch.a);\n#endif\nreturn finalColor;}\n#endif\n";i.add("Hatch2.glsl","assets/shaders/webgl2/common/Hatch2.glsl",Jx);const Kx=Jx,Zx="#if defined(X3D_LIGHTING)\nfloat getAttenuation(const in vec3 attenuation,const in float distanceToLight){return 1.0/max(dot(attenuation,vec3(1.0,distanceToLight,distanceToLight*distanceToLight)),1.0);}float getSpotFactor(const in vec3 pointToLight,const in vec3 direction,const in float cutOffAngle,const in float beamWidth){float spotAngle=acos(clamp(dot(-pointToLight,direction),-1.0,1.0));if(spotAngle>=cutOffAngle)return 0.0;else if(spotAngle<=beamWidth)return 1.0;return(spotAngle-cutOffAngle)/(beamWidth-cutOffAngle);}\n#endif\n";i.add("Lighting2.glsl","assets/shaders/webgl2/common/Lighting2.glsl",Zx);const Qx=Zx,ey="struct Line2{vec2 point;vec2 direction;};Line2 line2(const in vec2 point1,const in vec2 point2){return Line2(point1,normalize(point2-point1));}vec2 closest_point(const in Line2 line,const in vec2 point){vec2 r=point-line.point;float d=dot(r,line.direction);return line.direction*d+line.point;}";i.add("Line22.glsl","assets/shaders/webgl2/common/Line22.glsl",ey);const ty=ey,iy='uniform x3d_MaterialParameters x3d_Material;\n#if defined(X3D_LIGHTING)\n#pragma X3D include "Lighting.glsl"\n#pragma X3D include "Shadow.glsl"\nuniform x3d_LightSourceParameters x3d_LightSource[X3D_NUM_LIGHTS];vec3 getMaterialColor(const in vec3 vertex,const in vec3 N,const in vec3 ambientColor,const in vec3 diffuseColor,const in vec3 specularColor,const in float shininess){vec3 V=normalize(-vertex);vec3 finalColor=vec3(0.0);for(int i=0;i<X3D_NUM_LIGHTS;++i){x3d_LightSourceParameters light=x3d_LightSource[i];vec3 vL=light.location-vertex;float dL=length(light.matrix*vL);if(dL<=light.radius||light.radius<0.0){bool di=light.type==x3d_DirectionalLight;vec3 d=light.direction;vec3 c=light.attenuation;vec3 L=di?-d:normalize(vL);vec3 H=normalize(L+V);float lightAngle=max(dot(N,L),0.0);vec3 diffuseTerm=diffuseColor*lightAngle;float specularFactor=shininess>0.0?pow(max(dot(N,H),0.0),shininess*128.0):1.0;vec3 specularTerm=specularColor*specularFactor;float attenuationFactor=di?1.0:getAttenuation(c,dL);float spotFactor=light.type==x3d_SpotLight?getSpotFactor(L,d,light.cutOffAngle,light.beamWidth):1.0;float attenuationSpotFactor=attenuationFactor*spotFactor;vec3 ambientTerm=light.ambientIntensity*ambientColor;vec3 diffuseSpecularTerm=light.intensity*(diffuseTerm+specularTerm);\n#if defined(X3D_FRAGMENT_SHADER)&&defined(X3D_SHADOWS)\nif(lightAngle>0.0&&light.shadowIntensity>0.0)diffuseSpecularTerm=mix(diffuseSpecularTerm,light.shadowColor,getShadowIntensity(i,light));\n#endif\nfinalColor+=attenuationSpotFactor*light.color*(ambientTerm+diffuseSpecularTerm);}}return finalColor;}\n#endif\n';i.add("Material2.glsl","assets/shaders/webgl2/common/Material2.glsl",iy);const ny=iy,ry="#if defined(X3D_NORMAL_TEXTURE)\nmat3 getTBNMatrix(const in vec2 texCoord){vec3 pos_dx=dFdx(vertex);vec3 pos_dy=dFdy(vertex);vec2 tex_dx=dFdx(texCoord);vec2 tex_dy=dFdy(texCoord);vec3 t=(tex_dy.t*pos_dx-tex_dx.t*pos_dy)/(tex_dx.s*tex_dy.t-tex_dy.s*tex_dx.t);vec3 N=normalize(normal);vec3 T=normalize(t-N*dot(N,t));vec3 B=normalize(cross(N,T));mat3 tbn=mat3(T,B,N);return tbn;}\n#endif\n#if defined(X3D_NORMAL_TEXTURE)\nuniform x3d_NormalTextureParameters x3d_NormalTexture;\n#endif\nvec3 getNormalVector(const in float normalScale){float facing=gl_FrontFacing?1.0:-1.0;\n#if defined(X3D_NORMAL_TEXTURE)\nvec3 texCoord=getTexCoord(x3d_NormalTexture.textureTransformMapping,x3d_NormalTexture.textureCoordinateMapping);\n#if defined(X3D_NORMAL_TEXTURE_FLIP_Y)\ntexCoord.t=1.0-texCoord.t;\n#endif\nvec3 scale=vec3(vec2(normalScale),1.0);mat3 tbn=getTBNMatrix(texCoord.st);\n#if defined(X3D_NORMAL_TEXTURE_2D)\nvec3 n=texture(x3d_NormalTexture.texture2D,texCoord.st).rgb;\n#elif defined(X3D_NORMAL_TEXTURE_3D)\nvec3 n=texture(x3d_NormalTexture.texture3D,texCoord).rgb;\n#elif defined(X3D_NORMAL_TEXTURE_CUBE)\nvec3 n=texture(x3d_NormalTexture.textureCube,texCoord).rgb;\n#endif\nreturn normalize(tbn*((n*2.0-1.0)*scale))*facing;\n#else\nreturn normalize(normal)*facing;\n#endif\n}";i.add("Normal2.glsl","assets/shaders/webgl2/common/Normal2.glsl",ry);const sy=ry,oy="#if defined(X3D_PARTICLE_SYSTEM)\n#if defined(X3D_TEX_COORD_RAMP)\nuniform sampler2D x3d_TexCoordRamp;in vec4 x3d_Particle;vec4 getParticleTexCoord(const in vec4 texCoord){const int map[6]=int[6](0,1,2,0,2,3);int index0=int(x3d_Particle[3]);return texelFetch(x3d_TexCoordRamp,index0+map[gl_VertexID % 6],0);}\n#else\n#define getParticleTexCoord(texCoord)(texCoord)\n#endif\nin mat4 x3d_ParticleMatrix;vec4 getParticleVertex(const in vec4 vertex){return x3d_ParticleMatrix*vertex;}\n#else\n#define getParticleVertex(vertex)(vertex)\n#define getParticleTexCoord(texCoord)(texCoord)\n#endif\n";i.add("Particle2.glsl","assets/shaders/webgl2/common/Particle2.glsl",oy);const ay=oy,ly="float rand(const in vec2 co){return fract(sin(dot(co.xy,vec2(12.9898,78.233)))*43758.5453);}float rand(const in vec2 co,const in float l){return rand(vec2(rand(co),l));}float rand(const in vec2 co,const in float l,const in float t){return rand(vec2(rand(co,l),t));}float perlin(const in vec2 p,const in float dim,const in float time){const float M_PI=3.14159265358979323846;vec2 pos=floor(p*dim);vec2 posx=pos+vec2(1.0,0.0);vec2 posy=pos+vec2(0.0,1.0);vec2 posxy=pos+vec2(1.0);float c=rand(pos,dim,time);float cx=rand(posx,dim,time);float cy=rand(posy,dim,time);float cxy=rand(posxy,dim,time);vec2 d=fract(p*dim);d=-0.5*cos(d*M_PI)+0.5;float ccx=mix(c,cx,d.x);float cycxy=mix(cy,cxy,d.x);float center=mix(ccx,cycxy,d.y);return center*2.0-1.0;}vec3 perlin(const in vec3 p){return vec3(perlin(p.xy,1.0,0.0),perlin(p.yz,1.0,0.0),perlin(p.zx,1.0,0.0));}";i.add("Perlin2.glsl","assets/shaders/webgl2/common/Perlin2.glsl",ly);const uy=ly,hy=`#if defined(X3D_GEOMETRY_0D)&&defined(X3D_STYLE_PROPERTIES)\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\nvoid setPointTexCoords(){vec4 texCoord=vec4(gl_PointCoord.x,1.0-gl_PointCoord.y,0.0,1.0);\n${Array.from({length:4},((e,t)=>`\n#if X3D_NUM_TEXTURE_COORDINATES > ${t}\ntexCoords [${t}] = texCoord;\n#endif\n`)).join("\n")}\n}\n#define getPointColor(color)(color)\n#else\n#define setPointTexCoords()\nin float pointSize;vec4 getPointColor(in vec4 color){if(pointSize>1.0)color.a*=clamp(pointSize*(0.5-distance(vec2(0.5),gl_PointCoord)),0.0,1.0);else color.a*=pointSize;return color;}\n#endif\n#endif\n`;i.add("Point2.glsl","assets/shaders/webgl2/common/Point2.glsl",hy);const dy=hy,cy="#if defined(X3D_GEOMETRY_0D)&&defined(X3D_STYLE_PROPERTIES)\nuniform x3d_PointPropertiesParameters x3d_PointProperties;out float pointSize;float getPointSize(const in vec3 vertex){float pointSizeMinValue=x3d_PointProperties.pointSizeMinValue;float pointSizeMaxValue=x3d_PointProperties.pointSizeMaxValue;vec3 attenuation=x3d_PointProperties.attenuation;float dL=length(vertex);float pointSize=0.0;pointSize=x3d_PointProperties.pointSizeScaleFactor;pointSize/=dot(attenuation,vec3(1.0,dL,dL*dL));pointSize=clamp(pointSize,pointSizeMinValue,pointSizeMaxValue);\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURE)\nreturn pointSize;\n#else\nreturn pointSize+1.0-step(pointSize,1.0);\n#endif\n}\n#endif\n";i.add("PointSize2.glsl","assets/shaders/webgl2/common/PointSize2.glsl",cy);const py=cy,gy="#if defined(X3D_FRAGMENT_SHADER)&&defined(X3D_SHADOWS)\nuniform sampler2D x3d_ShadowMap[X3D_NUM_LIGHTS];float getShadowDepth(const in int index,const in vec2 shadowCoord){switch(index){\n#if X3D_NUM_LIGHTS>0\ncase 0:{return texture(x3d_ShadowMap[0],shadowCoord).r;}\n#endif\n#if X3D_NUM_LIGHTS>1\ncase 1:{return texture(x3d_ShadowMap[1],shadowCoord).r;}\n#endif\n#if X3D_NUM_LIGHTS>2\ncase 2:{return texture(x3d_ShadowMap[2],shadowCoord).r;}\n#endif\n#if X3D_NUM_LIGHTS>3\ncase 3:{return texture(x3d_ShadowMap[3],shadowCoord).r;}\n#endif\n#if X3D_NUM_LIGHTS>4\ncase 4:{return texture(x3d_ShadowMap[4],shadowCoord).r;}\n#endif\n#if X3D_NUM_LIGHTS>5\ncase 5:{return texture(x3d_ShadowMap[5],shadowCoord).r;}\n#endif\n#if X3D_NUM_LIGHTS>6\ncase 6:{return texture(x3d_ShadowMap[6],shadowCoord).r;}\n#endif\n#if X3D_NUM_LIGHTS>7\ncase 7:{return texture(x3d_ShadowMap[7],shadowCoord).r;}\n#endif\ndefault:{return 0.0;}}}float texture2DCompare(const in int index,const in vec2 texCoord,const in float compare){float shadowDepth=getShadowDepth(index,texCoord);return(1.0-step(1.0,shadowDepth))*step(shadowDepth,compare);}float texture2DShadowLerp(const in int index,const in vec2 texelSize,const in float shadowMapSize,const in vec2 texCoord,const in float compare){const vec2 offset=vec2(0.0,1.0);vec2 centroidTexCoord=floor(texCoord*shadowMapSize+0.5)/shadowMapSize;float lb=texture2DCompare(index,centroidTexCoord+texelSize*offset.xx,compare);float lt=texture2DCompare(index,centroidTexCoord+texelSize*offset.xy,compare);float rb=texture2DCompare(index,centroidTexCoord+texelSize*offset.yx,compare);float rt=texture2DCompare(index,centroidTexCoord+texelSize*offset.yy,compare);vec2 f=fract(texCoord*shadowMapSize+0.5);float a=mix(lb,lt,f.y);float b=mix(rb,rt,f.y);float c=mix(a,b,f.x);return c;}vec2 cubeToUVCompact(in vec3 v,const float texelSizeY){vec3 absV=abs(v);float scaleToCube=1.0/max(absV.x,max(absV.y,absV.z));absV*=scaleToCube;v*=scaleToCube*(1.0-2.0*texelSizeY);vec2 planar=v.xy;float almostATexel=1.5*texelSizeY;float almostOne=1.0-almostATexel;if(absV.z>=almostOne){if(v.z>0.0)planar.x=4.0-v.x;}else if(absV.x>=almostOne){float signX=sign(v.x);planar.x=v.z*signX+2.0*signX;}else if(absV.y>=almostOne){float signY=sign(v.y);planar.x=(v.x+0.5+signY)*2.0;planar.y=v.z*signY-2.0;}return vec2(0.125,0.25)*planar+vec2(0.375,0.75);}mat4 getPointLightRotations(const in vec3 vector){mat4 rotations[6];rotations[0]=mat4(0,0,1,0,0,1,0,0,-1,0,0,0,0,0,0,1);rotations[1]=mat4(0,0,-1,0,0,1,0,0,1,0,0,0,0,0,0,1);rotations[2]=mat4(-1,0,0,0,0,1,0,0,0,0,-1,0,0,0,0,1);rotations[3]=mat4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);rotations[4]=mat4(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1);rotations[5]=mat4(1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1);vec3 a=abs(vector.xyz);if(a.x>a.y){if(a.x>a.z)return vector.x>0.0?rotations[1]:rotations[0];else return vector.z>0.0?rotations[2]:rotations[3];}else{if(a.y>a.z)return vector.y>0.0?rotations[5]:rotations[4];else return vector.z>0.0?rotations[2]:rotations[3];}return rotations[3];}float getShadowIntensity(const in int index,const in x3d_LightSourceParameters light){if(light.type==x3d_PointLight){const mat4 biasMatrix=mat4(0.5,0.0,0.0,0.0,0.0,0.5,0.0,0.0,0.0,0.0,0.5,0.0,0.5,0.5,0.5,1.0);const mat4 projectionMatrix=mat4(1.0,0.0,0.0,0.0,0.0,0.5,0.0,0.0,0.0,0.0,-1.000025000312504,-1.0,0,0.0,-0.25000312503906297,0.0);vec2 texelSize=vec2(1.0)/(float(light.shadowMapSize)*vec2(4.0,2.0));vec4 shadowCoord=light.shadowMatrix*vec4(vertex,1.0);vec3 lightToPosition=shadowCoord.xyz;shadowCoord=biasMatrix*(projectionMatrix*(getPointLightRotations(lightToPosition)*shadowCoord));shadowCoord.z-=light.shadowBias;shadowCoord.xyz/=shadowCoord.w;\n#if defined(X3D_PCF_FILTERING)||defined(X3D_PCF_SOFT_FILTERING)\nvec2 offset=vec2(-1,1)*(texelSize.y*42.0);float value=(texture2DCompare(index,cubeToUVCompact(lightToPosition+offset.xyy,texelSize.y),shadowCoord.z)+texture2DCompare(index,cubeToUVCompact(lightToPosition+offset.yyy,texelSize.y),shadowCoord.z)+texture2DCompare(index,cubeToUVCompact(lightToPosition+offset.xyx,texelSize.y),shadowCoord.z)+texture2DCompare(index,cubeToUVCompact(lightToPosition+offset.yyx,texelSize.y),shadowCoord.z)+texture2DCompare(index,cubeToUVCompact(lightToPosition,texelSize.y),shadowCoord.z)+texture2DCompare(index,cubeToUVCompact(lightToPosition+offset.xxy,texelSize.y),shadowCoord.z)+texture2DCompare(index,cubeToUVCompact(lightToPosition+offset.yxy,texelSize.y),shadowCoord.z)+texture2DCompare(index,cubeToUVCompact(lightToPosition+offset.xxx,texelSize.y),shadowCoord.z)+texture2DCompare(index,cubeToUVCompact(lightToPosition+offset.yxx,texelSize.y),shadowCoord.z))*(1.0/9.0);return light.shadowIntensity*value;\n#else \nfloat value=texture2DCompare(index,cubeToUVCompact(lightToPosition,texelSize.y),shadowCoord.z);return light.shadowIntensity*value;\n#endif\n}else{\n#if defined(X3D_PCF_FILTERING)\nvec2 texelSize=vec2(1.0)/vec2(light.shadowMapSize);vec4 shadowCoord=light.shadowMatrix*vec4(vertex,1.0);shadowCoord.z-=light.shadowBias;shadowCoord.xyz/=shadowCoord.w;if(any(greaterThan(abs(shadowCoord.xy-0.5),vec2(0.5))))return 0.0;vec2 d0=-texelSize;vec2 d1=texelSize;float value=(texture2DCompare(index,shadowCoord.xy+d0,shadowCoord.z)+texture2DCompare(index,shadowCoord.xy+vec2(0.0,d0.y),shadowCoord.z)+texture2DCompare(index,shadowCoord.xy+vec2(d1.x,d0.y),shadowCoord.z)+texture2DCompare(index,shadowCoord.xy+vec2(d0.x,0.0),shadowCoord.z)+texture2DCompare(index,shadowCoord.xy,shadowCoord.z)+texture2DCompare(index,shadowCoord.xy+vec2(d1.x,0.0),shadowCoord.z)+texture2DCompare(index,shadowCoord.xy+vec2(d0.x,d1.y),shadowCoord.z)+texture2DCompare(index,shadowCoord.xy+vec2(0.0,d1.y),shadowCoord.z)+texture2DCompare(index,shadowCoord.xy+d1,shadowCoord.z))*(1.0/9.0);return light.shadowIntensity*value;\n#elif defined(X3D_PCF_SOFT_FILTERING)\nvec2 texelSize=vec2(1.0)/vec2(light.shadowMapSize);vec4 shadowCoord=light.shadowMatrix*vec4(vertex,1.0);shadowCoord.z-=light.shadowBias;shadowCoord.xyz/=shadowCoord.w;if(any(greaterThan(abs(shadowCoord.xy-0.5),vec2(0.5))))return 0.0;vec2 d0=-texelSize;vec2 d1=texelSize;float value=(texture2DShadowLerp(index,texelSize,float(shadowMapSize),shadowCoord.xy+d0,shadowCoord.z)+texture2DShadowLerp(index,texelSize,float(shadowMapSize),shadowCoord.xy+vec2(0.0,d0.y),shadowCoord.z)+texture2DShadowLerp(index,texelSize,float(shadowMapSize),shadowCoord.xy+vec2(d1.x,d0.y),shadowCoord.z)+texture2DShadowLerp(index,texelSize,float(shadowMapSize),shadowCoord.xy+vec2(d0.x,0.0),shadowCoord.z)+texture2DShadowLerp(index,texelSize,float(shadowMapSize),shadowCoord.xy,shadowCoord.z)+texture2DShadowLerp(index,texelSize,float(shadowMapSize),shadowCoord.xy+vec2(d1.x,0.0),shadowCoord.z)+texture2DShadowLerp(index,texelSize,float(shadowMapSize),shadowCoord.xy+vec2(d0.x,d1.y),shadowCoord.z)+texture2DShadowLerp(index,texelSize,float(shadowMapSize),shadowCoord.xy+vec2(0.0,d1.y),shadowCoord.z)+texture2DShadowLerp(index,texelSize,float(shadowMapSize),shadowCoord.xy+d1,shadowCoord.z))*(1.0/9.0);return light.shadowIntensity*value;\n#else \nvec4 shadowCoord=light.shadowMatrix*vec4(vertex,1.0);shadowCoord.z-=light.shadowBias;shadowCoord.xyz/=shadowCoord.w;if(any(greaterThan(abs(shadowCoord.xy-0.5),vec2(0.5))))return 0.0;float value=texture2DCompare(index,shadowCoord.xy,shadowCoord.z);return light.shadowIntensity*value;\n#endif\n}return 0.0;}\n#endif\n";i.add("Shadow2.glsl","assets/shaders/webgl2/common/Shadow2.glsl",gy);const fy=gy,my="#if defined(X3D_SKINNING)\nin float x3d_CoordIndex;uniform sampler2D x3d_JointsTexture;uniform sampler2D x3d_DisplacementsTexture;uniform sampler2D x3d_JointMatricesTexture;mat4 getJointMatrix(const in int joint){vec4 a=texelFetch(x3d_JointMatricesTexture,joint*8,0);vec4 b=texelFetch(x3d_JointMatricesTexture,joint*8+1,0);vec4 c=texelFetch(x3d_JointMatricesTexture,joint*8+2,0);vec4 d=texelFetch(x3d_JointMatricesTexture,joint*8+3,0);return mat4(a,b,c,d);}mat3 getDisplacementJointMatrix(const in int joint){mat4 m=getJointMatrix(joint);return mat3(m[0].xyz,m[1].xyz,m[2].xyz);}\n#if defined(X3D_NORMALS)\nvec3 skinNormal=vec3(0.0);mat3 getJointNormalMatrix(const in int joint){vec4 a=texelFetch(x3d_JointMatricesTexture,joint*8+4,0);vec4 b=texelFetch(x3d_JointMatricesTexture,joint*8+5,0);vec4 c=texelFetch(x3d_JointMatricesTexture,joint*8+6,0);return mat3(a.xyz,vec3(a.w,b.xy),vec3(b.zw,c.x));}\n#define getSkinNormal(normal)(skinNormal)\n#endif\nvec4 getSkinVertex(const in vec4 vertex,const in vec3 normal){int coordIndex=int(x3d_CoordIndex);vec4 skin=vertex;\n#if defined(X3D_NORMALS)\nskinNormal=normal;\n#endif\n#if X3D_NUM_DISPLACEMENTS>0\n{int coordIndexD=coordIndex*X3D_NUM_DISPLACEMENTS;int width=textureSize(x3d_DisplacementsTexture,0).x;int offset=(width*width)/2;for(int i=0;i<X3D_NUM_DISPLACEMENTS;++i){int index=coordIndexD+i;vec4 displacement=texelFetch(x3d_DisplacementsTexture,index,0);float weight=texelFetch(x3d_DisplacementsTexture,index+offset,0).x;skin.xyz+=getDisplacementJointMatrix(int(displacement.w))*displacement.xyz*weight;}}\n#endif\nint coordIndexJ=coordIndex*(X3D_NUM_JOINT_SETS*2);for(int i=0;i<X3D_NUM_JOINT_SETS;++i){int index=coordIndexJ+i;ivec4 joints=ivec4(texelFetch(x3d_JointsTexture,index,0));vec4 weights=texelFetch(x3d_JointsTexture,index+X3D_NUM_JOINT_SETS,0);for(int i=0;i<4;++i){int joint=joints[i];float weight=weights[i];skin+=(getJointMatrix(joint)*vertex-vertex)*weight;\n#if defined(X3D_NORMALS)\nskinNormal+=(getJointNormalMatrix(joint)*normal-normal)*weight;\n#endif\n}}return skin;}\n#else\n#define getSkinVertex(vertex,normal)(vertex)\n#define getSkinNormal(normal)(normal)\n#endif\n";i.add("Skin2.glsl","assets/shaders/webgl2/common/Skin2.glsl",my);const _y=my,xy='#if defined(X3D_GEOMETRY_1D)&&defined(X3D_STYLE_PROPERTIES)\n#pragma X3D include "Line2.glsl"\nuniform x3d_LinePropertiesParameters x3d_LineProperties;flat in float lengthSoFar;flat in vec2 startPoint;in vec2 midPoint;void stipple(){vec2 point=closest_point(line2(startPoint,midPoint),gl_FragCoord.xy);float s=(lengthSoFar+length(point-startPoint))*x3d_LineProperties.lineStippleScale;\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\n#if X3D_NUM_TEXTURE_COORDINATES>0\ntexCoord0=vec4(s,0.0,0.0,1.0);\n#endif\n#if X3D_NUM_TEXTURE_COORDINATES>1\ntexCoord1=vec4(s,0.0,0.0,1.0);\n#endif\n#endif\n#if defined(X3D_STYLE_PROPERTIES_TEXTURE)\nif(x3d_LineProperties.linetype==16)return;int linetype=x3d_LineProperties.linetype;int height=textureSize(x3d_LineProperties.texture,0).y;float t=1.0-float(linetype*2+1)/float(height*2);float alpha=texture(x3d_LineProperties.texture,vec2(s,1.0-t)).a;if(alpha!=1.0)discard;\n#endif\n}\n#endif\n';i.add("Stipple2.glsl","assets/shaders/webgl2/common/Stipple2.glsl",xy);const yy=xy,wy=`#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\n#pragma X3D include "Perlin.glsl"\nvec4 texCoords[X3D_NUM_TEXTURE_COORDINATES];void setTexCoords(){\n${Array.from({length:4},((e,t)=>`\n#if X3D_NUM_TEXTURE_COORDINATES > ${t}\ntexCoords [${t}] = texCoord${t};\n#endif\n`)).join("\n")}\n}uniform mat4 x3d_TextureMatrix[X3D_NUM_TEXTURE_TRANSFORMS];vec4 getTexCoord(const in x3d_TextureCoordinateGeneratorParameters textureCoordinateGenerator,const in int textureTransformMapping,const in int textureCoordinateMapping){int mode=textureCoordinateGenerator.mode;switch(mode){case x3d_None:{return x3d_TextureMatrix[textureTransformMapping]*texCoords[textureCoordinateMapping];}case x3d_Sphere:{vec2 N=normalize(gl_FrontFacing?normal:-normal).xy;return vec4(N*0.5+0.5,0.0,1.0);}case x3d_CameraSpaceNormal:{vec3 N=normalize(gl_FrontFacing?normal:-normal);return vec4(N,1.0);}case x3d_CameraSpacePosition:{return vec4(vertex,1.0);}case x3d_CameraSpaceReflectionVector:{vec3 N=normalize(gl_FrontFacing?normal:-normal);return vec4(reflect(normalize(vertex),-N),1.0);}case x3d_SphereLocal:{vec2 N=normalize(gl_FrontFacing?localNormal:-localNormal).xy;return vec4(N*0.5+0.5,0.0,1.0);}case x3d_Coord:{return vec4(localVertex,1.0);}case x3d_CoordEye:{return vec4(vertex,1.0);}case x3d_Noise:{vec3 scale=vec3(textureCoordinateGenerator.parameter[0],textureCoordinateGenerator.parameter[1],textureCoordinateGenerator.parameter[2]);vec3 translation=vec3(textureCoordinateGenerator.parameter[3],textureCoordinateGenerator.parameter[4],textureCoordinateGenerator.parameter[5]);return vec4(perlin(localVertex*scale+translation),1.0);}case x3d_NoiseEye:{vec3 scale=vec3(textureCoordinateGenerator.parameter[0],textureCoordinateGenerator.parameter[1],textureCoordinateGenerator.parameter[2]);vec3 translation=vec3(textureCoordinateGenerator.parameter[3],textureCoordinateGenerator.parameter[4],textureCoordinateGenerator.parameter[5]);return vec4(perlin(vertex*scale+translation),1.0);}case x3d_SphereReflect:{vec3 N=normalize(gl_FrontFacing?normal:-normal);float eta=textureCoordinateGenerator.parameter[0];return vec4(refract(normalize(vertex),-N,eta),1.0);}case x3d_SphereReflectLocal:{vec3 N=normalize(gl_FrontFacing?localNormal:-localNormal);float eta=textureCoordinateGenerator.parameter[0];vec3 eye=vec3(textureCoordinateGenerator.parameter[1],textureCoordinateGenerator.parameter[2],textureCoordinateGenerator.parameter[3]);return vec4(refract(normalize(localVertex-eye),-N,eta),1.0);}default:{return x3d_TextureMatrix[textureTransformMapping]*texCoords[textureCoordinateMapping];}}}uniform x3d_TextureCoordinateGeneratorParameters x3d_TextureCoordinateGenerator[X3D_NUM_TEXTURE_COORDINATES];vec3 getTexCoord(const in int textureTransformMapping,const in int textureCoordinateMapping){vec4 texCoord=getTexCoord(x3d_TextureCoordinateGenerator[textureCoordinateMapping],textureTransformMapping,textureCoordinateMapping);texCoord.stp/=texCoord.q;\n#if defined(X3D_GEOMETRY_2D)\nif(gl_FrontFacing==false)texCoord.s=1.0-texCoord.s;\n#endif\nreturn texCoord.stp;}\n#endif \n#if defined(X3D_TEXTURE)\nuniform sampler2D x3d_Texture2D[X3D_NUM_TEXTURES];uniform sampler3D x3d_Texture3D[X3D_NUM_TEXTURES];uniform samplerCube x3d_TextureCube[X3D_NUM_TEXTURES];vec4 getTexture(const in int i,in vec3 texCoord){vec4 textureColor=vec4(1.0);switch(i){\n${Array.from({length:4},((e,t)=>`\n#if X3D_NUM_TEXTURES > ${t}\ncase ${t}:\n{\n#if !defined (X3D_PHYSICAL_MATERIAL) && defined (X3D_TEXTURE${t}_FLIP_Y)\ntexCoord .t = 1.0 - texCoord .t;\n#endif\n#if defined (X3D_TEXTURE${t}_2D)\ntextureColor = texture (x3d_Texture2D [${t}], texCoord .st);\n#elif defined (X3D_TEXTURE${t}_3D)\ntextureColor = texture (x3d_Texture3D [${t}], texCoord .stp);\n#elif defined (X3D_TEXTURE${t}_CUBE)\ntextureColor = texture (x3d_TextureCube [${t}], texCoord .stp);\n#endif\n#if defined (X3D_PHYSICAL_MATERIAL) && !defined (X3D_TEXTURE${t}_LINEAR)\ntextureColor = sRGBToLinear (textureColor);\n#elif !defined (X3D_PHYSICAL_MATERIAL) && defined (X3D_TEXTURE${t}_LINEAR)\ntextureColor = linearTosRGB (textureColor);\n#endif\nbreak;\n}\n#endif\n`)).join("\n")}\n}return textureColor;}\n#if defined(X3D_MULTI_TEXTURING)\nuniform vec4 x3d_MultiTextureColor;uniform x3d_MultiTextureParameters x3d_MultiTexture[X3D_NUM_TEXTURES];\n#endif\nvec4 getTextureColor(const in vec4 diffuseColor,const in vec4 specularColor){\n#if defined(X3D_MULTI_TEXTURING)\nvec4 currentColor=diffuseColor;for(int i=0;i<X3D_NUM_TEXTURES;++i){vec3 texCoord=getTexCoord(min(i,X3D_NUM_TEXTURE_TRANSFORMS-1),min(i,X3D_NUM_TEXTURE_COORDINATES-1));vec4 textureColor=getTexture(i,texCoord);x3d_MultiTextureParameters multiTexture=x3d_MultiTexture[i];vec4 arg1=textureColor;vec4 arg2=currentColor;int source=multiTexture.source;switch(source){case x3d_Diffuse:{arg1=diffuseColor;break;}case x3d_Specular:{arg1=specularColor;break;}case x3d_Factor:{arg1=x3d_MultiTextureColor;break;}}int function=multiTexture.function;switch(function){case x3d_Complement:{arg1=1.0-arg1;break;}case x3d_AlphaReplicate:{arg1.a=arg2.a;break;}}int mode=multiTexture.mode;int alphaMode=multiTexture.alphaMode;switch(mode){case x3d_Replace:{currentColor.rgb=arg1.rgb;break;}case x3d_Modulate:{currentColor.rgb=arg1.rgb*arg2.rgb;break;}case x3d_Modulate2X:{currentColor.rgb=(arg1.rgb*arg2.rgb)*2.0;break;}case x3d_Modulate4X:{currentColor.rgb=(arg1.rgb*arg2.rgb)*4.0;break;}case x3d_Add:{currentColor.rgb=arg1.rgb+arg2.rgb;break;}case x3d_AddSigned:{currentColor.rgb=arg1.rgb+arg2.rgb-0.5;break;}case x3d_AddSigned2X:{currentColor.rgb=(arg1.rgb+arg2.rgb-0.5)*2.0;break;}case x3d_AddSmooth:{currentColor.rgb=arg1.rgb+(1.0-arg1.rgb)*arg2.rgb;break;}case x3d_Subtract:{currentColor.rgb=arg1.rgb-arg2.rgb;break;}case x3d_BlendDiffuseAlpha:{currentColor.rgb=arg1.rgb*diffuseColor.a+arg2.rgb*(1.0-diffuseColor.a);break;}case x3d_BlendTextureAlpha:{currentColor.rgb=arg1.rgb*arg1.a+arg2.rgb*(1.0-arg1.a);break;}case x3d_BlendFactorAlpha:{currentColor.rgb=arg1.rgb*x3d_MultiTextureColor.a+arg2.rgb*(1.0-x3d_MultiTextureColor.a);break;}case x3d_BlendCurrentAlpha:{currentColor.rgb=arg1.rgb*arg2.a+arg2.rgb*(1.0-arg2.a);break;}case x3d_ModulateAlphaAddColor:{currentColor.rgb=arg1.rgb+arg1.a*arg2.rgb;break;}case x3d_ModulateInvAlphaAddColor:{currentColor.rgb=(1.0-arg1.a)*arg2.rgb+arg1.rgb;break;}case x3d_ModulateInvColorAddAlpha:{currentColor.rgb=(1.0-arg1.rgb)*arg2.rgb+arg1.a;break;}case x3d_DotProduct3:{currentColor.rgb=vec3(dot(arg1.rgb*2.0-1.0,arg2.rgb*2.0-1.0));break;}case x3d_SelectArg1:{currentColor.rgb=arg1.rgb;break;}case x3d_SelectArg2:{currentColor.rgb=arg2.rgb;break;}case x3d_Off:{break;}}switch(alphaMode){case x3d_Replace:{currentColor.a=arg1.a;break;}case x3d_Modulate:{currentColor.a=arg1.a*arg2.a;break;}case x3d_Modulate2X:{currentColor.a=(arg1.a*arg2.a)*2.0;break;}case x3d_Modulate4X:{currentColor.a=(arg1.a*arg2.a)*4.0;break;}case x3d_Add:{currentColor.a=arg1.a+arg2.a;break;}case x3d_AddSigned:{currentColor.a=arg1.a+arg2.a-0.5;break;}case x3d_AddSigned2X:{currentColor.a=(arg1.a+arg2.a-0.5)*2.0;break;}case x3d_AddSmooth:{currentColor.a=arg1.a+(1.0-arg1.a)*arg2.a;break;}case x3d_Subtract:{currentColor.a=arg1.a-arg2.a;break;}case x3d_BlendDiffuseAlpha:{currentColor.a=arg1.a*diffuseColor.a+arg2.a*(1.0-diffuseColor.a);break;}case x3d_BlendTextureAlpha:{currentColor.a=arg1.a*arg1.a+arg2.a*(1.0-arg1.a);break;}case x3d_BlendFactorAlpha:{currentColor.a=arg1.a*x3d_MultiTextureColor.a+arg2.a*(1.0-x3d_MultiTextureColor.a);break;}case x3d_BlendCurrentAlpha:{currentColor.a=arg1.a*arg2.a+arg2.a*(1.0-arg2.a);break;}case x3d_ModulateAlphaAddColor:{currentColor.a=arg1.a+arg1.a*arg2.a;break;}case x3d_ModulateInvAlphaAddColor:{currentColor.a=(1.0-arg1.a)*arg2.a+arg1.a;break;}case x3d_ModulateInvColorAddAlpha:{currentColor.a=(1.0-arg1.a)*arg2.a+arg1.a;break;}case x3d_DotProduct3:{currentColor.a=dot(arg1.rgb*2.0-1.0,arg2.rgb*2.0-1.0);break;}case x3d_SelectArg1:{currentColor.a=arg1.a;break;}case x3d_SelectArg2:{currentColor.a=arg2.a;break;}case x3d_Off:{break;}}}return currentColor;\n#else\nvec3 texCoord=getTexCoord(0,0);vec4 textureColor=getTexture(0,texCoord);return diffuseColor*textureColor;\n#endif\n}\n#endif \n#if defined(X3D_TEXTURE_PROJECTION)\nuniform vec3 x3d_TextureProjectorColor[X3D_NUM_TEXTURE_PROJECTORS];uniform float x3d_TextureProjectorIntensity[X3D_NUM_TEXTURE_PROJECTORS];uniform vec3 x3d_TextureProjectorLocation[X3D_NUM_TEXTURE_PROJECTORS];uniform vec3 x3d_TextureProjectorParams[X3D_NUM_TEXTURE_PROJECTORS];uniform mat4 x3d_TextureProjectorMatrix[X3D_NUM_TEXTURE_PROJECTORS];uniform sampler2D x3d_TextureProjectorTexture[X3D_NUM_TEXTURE_PROJECTORS];vec4 getTextureProjectorTexture(const in int i,const in vec2 texCoord){vec4 textureColor=vec4(1.0);switch(i){\n${Array.from({length:4},((e,t)=>`\n#if X3D_NUM_TEXTURE_PROJECTORS > ${t}\ncase ${t}:\ntextureColor = texture (x3d_TextureProjectorTexture [${t}], texCoord);\nbreak;\n#endif\n`)).join("\n")}\n}return textureColor;}vec3 getTextureProjectorColor(){vec3 currentColor=vec3(1.0);vec3 N=gl_FrontFacing?normal:-normal;for(int i=0;i<X3D_NUM_TEXTURE_PROJECTORS;++i){vec4 texCoord=x3d_TextureProjectorMatrix[i]*vec4(vertex,1.0);texCoord.stp/=texCoord.q;texCoord.p=clamp(texCoord.p,x3d_TextureProjectorParams[i].x,x3d_TextureProjectorParams[i].y);if(any(greaterThan(abs(texCoord.stp-0.5),vec3(0.5))))continue;vec3 p=x3d_TextureProjectorLocation[i]-vertex;if(dot(N,p)<0.0)continue;vec4 T=getTextureProjectorTexture(i,texCoord.st);\n#if defined(X3D_PHYSICAL_MATERIAL)\nif(!bool(x3d_TextureProjectorParams[i].z))T=sRGBToLinear(T);\n#else\nif(bool(x3d_TextureProjectorParams[i].z))T=linearTosRGB(T);\n#endif\ncurrentColor*=mix(vec3(1.0),T.rgb*x3d_TextureProjectorColor[i],T.a*x3d_TextureProjectorIntensity[i]);}return currentColor;}\n#endif \n`;i.add("Texture2.glsl","assets/shaders/webgl2/common/Texture2.glsl",wy);const by=wy,Sy="#if defined(X3D_SKINNING)||defined(X3D_PARTICLE_SYSTEM)\nvec4 texelFetch(const in sampler2D _sampler,const in int index,const in int lod){int x=textureSize(_sampler,lod).x;ivec2 p=ivec2(index % x,index/x);vec4 t=texelFetch(_sampler,p,lod);return t;}\n#endif\n";i.add("Utils2.glsl","assets/shaders/webgl2/common/Utils2.glsl",Sy);const Ty=Sy,vy=`uniform mat4 x3d_ProjectionMatrix;uniform mat4 x3d_ModelViewMatrix;\n#if defined(X3D_GEOMETRY_1D)&&defined(X3D_STYLE_PROPERTIES)\nin vec3 x3d_LineStipple;\n#endif\n#if defined(X3D_FOG)&&defined(X3D_FOG_COORDS)\nin float x3d_FogDepth;\n#endif\n#if defined(X3D_COLOR_MATERIAL)\nin vec4 x3d_Color;\n#endif\n#if!defined(X3D_GEOMETRY_0D)&&!defined(X3D_GEOMETRY_1D)\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\n\n${Array.from({length:4},((e,t)=>`\n#if X3D_NUM_TEXTURE_COORDINATES > ${t}\nin vec4 x3d_TexCoord${t};\n#endif\n`)).join("\n")}\n \n#endif\n#endif\nin vec4 x3d_Vertex;\n#if defined(X3D_FOG)&&defined(X3D_FOG_COORDS)\nout float fogDepth;\n#endif\n#if defined(X3D_COLOR_MATERIAL)\nout vec4 color;\n#endif\n#if!defined(X3D_GEOMETRY_0D)&&!defined(X3D_GEOMETRY_1D)\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\n\n${Array.from({length:4},((e,t)=>`\n#if X3D_NUM_TEXTURE_COORDINATES > ${t}\nout vec4 texCoord${t};\n#endif\n`)).join("\n")}\n \n#endif\n#endif\n#if defined(X3D_NORMALS)\nuniform mat3 x3d_NormalMatrix;in vec3 x3d_Normal;out vec3 normal;\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\nout vec3 localNormal;\n#endif\n#endif\n#if defined(X3D_GEOMETRY_1D)&&defined(X3D_STYLE_PROPERTIES)\nflat out float lengthSoFar;flat out vec2 startPoint;out vec2 midPoint;\n#endif\nout vec3 vertex;\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\nout vec3 localVertex;\n#endif\n#if defined(X3D_LOGARITHMIC_DEPTH_BUFFER)\nout float depth;\n#endif\n#pragma X3D include "Utils.glsl"\n#pragma X3D include "Skin.glsl"\n#pragma X3D include "Particle.glsl"\n#pragma X3D include "PointSize.glsl"\nvoid vertex_main(){\n#if defined(X3D_NORMALS)\nvec4 x3d_TransformedVertex=getParticleVertex(getSkinVertex(x3d_Vertex,x3d_Normal));vec3 x3d_TransformedNormal=getSkinNormal(x3d_Normal);\n#else\nvec4 x3d_TransformedVertex=getParticleVertex(getSkinVertex(x3d_Vertex,vec3(0.0)));\n#endif\nvec4 position=x3d_ModelViewMatrix*x3d_TransformedVertex;vertex=position.xyz;\n#if defined(X3D_GEOMETRY_0D)\n#if defined(X3D_STYLE_PROPERTIES)\ngl_PointSize=pointSize=getPointSize(vertex);\n#else\ngl_PointSize=1.0;\n#endif\n#endif\n#if defined(X3D_GEOMETRY_1D)&&defined(X3D_STYLE_PROPERTIES)\nlengthSoFar=x3d_LineStipple.z;startPoint=x3d_LineStipple.xy;midPoint=x3d_LineStipple.xy;\n#endif\n#if defined(X3D_FOG)&&defined(X3D_FOG_COORDS)\nfogDepth=x3d_FogDepth;\n#endif\n#if defined(X3D_COLOR_MATERIAL)\ncolor=x3d_Color;\n#endif\n#if!defined(X3D_GEOMETRY_0D)&&!defined(X3D_GEOMETRY_1D)\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\n\n${Array.from({length:4},((e,t)=>`\n#if X3D_NUM_TEXTURE_COORDINATES > ${t}\ntexCoord${t} = getParticleTexCoord (x3d_TexCoord${t});\n#endif\n`)).join("\n")}\n \n#endif\n#endif\n#if defined(X3D_NORMALS)\nnormal=x3d_NormalMatrix*x3d_TransformedNormal;\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\nlocalNormal=x3d_TransformedNormal;\n#endif\n#endif\n#if defined(X3D_TEXTURE)||defined(X3D_MATERIAL_TEXTURES)\nlocalVertex=x3d_TransformedVertex.xyz;\n#endif\ngl_Position=x3d_ProjectionMatrix*position;\n#if defined(X3D_LOGARITHMIC_DEPTH_BUFFER)\ndepth=1.0+gl_Position.w;\n#endif\n}`;i.add("Vertex2.glsl","assets/shaders/webgl2/common/Vertex2.glsl",vy);const Oy=vy,Ey="precision highp float;precision highp int;precision highp sampler2D;attribute vec2 x3d_Vertex;varying vec2 texCoord;void main(){texCoord=x3d_Vertex;gl_Position=vec4(x3d_Vertex,0.0,1.0);}";i.add("FullScreen1.vs","assets/shaders/webgl1/FullScreen1.vs",Ey);const Cy=Ey,Ny='precision highp float;precision highp int;precision highp sampler2D;precision highp samplerCube;\n#pragma X3D include "common/Vertex.glsl"\nvoid main(){vertex_main();}';i.add("Default1.vs","assets/shaders/webgl1/Default1.vs",Ny);const Iy=Ny,Fy='precision highp float;precision highp int;precision highp sampler2D;varying vec3 vertex;\n#pragma X3D include "common/ClipPlanes.glsl"\n#pragma X3D include "common/Point.glsl"\nvoid main(){\n#if defined(X3D_CLIP_PLANES)\nclip();\n#endif\n#if defined(X3D_GEOMETRY_0D)&&defined(X3D_STYLE_PROPERTIES)\nif(getPointColor(vec4(1.0)).a<0.5)discard;\n#endif\ngl_FragColor=vec4(gl_FragCoord.z);}';i.add("Depth1.fs","assets/shaders/webgl1/Depth1.fs",Fy);const My=Fy,Dy='precision highp float;precision highp int;uniform mat4 x3d_ProjectionMatrix;uniform mat4 x3d_ModelViewMatrix;attribute vec4 x3d_Vertex;varying vec3 vertex;\n#pragma X3D include "common/PointSize.glsl"\nvoid main(){vec4 position=x3d_ModelViewMatrix*x3d_Vertex;vertex=position.xyz;\n#if defined(X3D_GEOMETRY_0D)\n#if defined(X3D_STYLE_PROPERTIES)\ngl_PointSize=max(pointSize=getPointSize(vertex),2.0);\n#else\ngl_PointSize=2.0;\n#endif\n#endif\ngl_Position=x3d_ProjectionMatrix*position;}';i.add("Depth1.vs","assets/shaders/webgl1/Depth1.vs",Dy);const Ry=Dy,Py='precision highp float;precision highp int;precision highp sampler2D;precision highp samplerCube;\n#pragma X3D include "common/Fragment.glsl"\nvarying vec4 frontColor;\n#if!defined(X3D_GEOMETRY_0D)&&!defined(X3D_GEOMETRY_1D)\nvarying vec4 backColor;\n#endif\nvec4 getMaterialColor(){\n#if defined(X3D_GEOMETRY_0D)||defined(X3D_GEOMETRY_1D)\nvec4 finalColor=frontColor;\n#else\nvec4 finalColor=gl_FrontFacing?frontColor:backColor;\n#endif\n#if defined(X3D_TEXTURE)\nfinalColor=getTextureColor(finalColor,vec4(1.0));\n#endif\n#if defined(X3D_TEXTURE_PROJECTION)\nfinalColor.rgb*=getTextureProjectorColor();\n#endif\nreturn finalColor;}void main(){fragment_main();}';i.add("Gouraud1.fs","assets/shaders/webgl1/Gouraud1.fs",Py);const Ay=Py,Vy='precision highp float;precision highp int;precision highp sampler2D;precision highp samplerCube;\n#pragma X3D include "common/Vertex.glsl"\n#pragma X3D include "common/Material.glsl"\nvarying vec4 frontColor;\n#if!defined(X3D_GEOMETRY_0D)&&!defined(X3D_GEOMETRY_1D)\nvarying vec4 backColor;\n#endif\nvec4 getMaterialColor(const in vec3 N,const in vec3 vertex,const in x3d_MaterialParameters material){float alpha=1.0-x3d_Material.transparency;\n#if defined(X3D_COLOR_MATERIAL)\nvec4 diffuseColor=vec4(color.rgb,color.a*alpha);\n#else\nvec4 diffuseColor=vec4(x3d_Material.diffuseColor,alpha);\n#endif\n#if defined(X3D_LIGHTING)\nvec3 ambientColor=diffuseColor.rgb*material.ambientIntensity;vec3 finalColor=getMaterialColor(vertex,N,ambientColor,diffuseColor.rgb,material.specularColor,material.shininess);\n#else\nvec3 finalColor=vec3(0.0);\n#endif\nfinalColor+=material.emissiveColor;return vec4(finalColor,diffuseColor.a);}void main(){vertex_main();\n#if defined(X3D_LIGHTING)\nnormal=normalize(normal);\n#else\nvec3 normal=vec3(0.0);\n#endif\nfrontColor=getMaterialColor(normal,vertex,x3d_Material);\n#if!defined(X3D_GEOMETRY_0D)&&!defined(X3D_GEOMETRY_1D)\nbackColor=getMaterialColor(-normal,vertex,x3d_Material);\n#endif\n}';i.add("Gouraud1.vs","assets/shaders/webgl1/Gouraud1.vs",Vy);const Ly=Vy,By='#extension GL_OES_standard_derivatives:enable\n#extension GL_EXT_frag_depth:enable\n#extension GL_EXT_shader_texture_lod:enable\nprecision highp float;precision highp int;precision highp sampler2D;precision highp samplerCube;\n#pragma X3D include "common/Fragment.glsl"\n#pragma X3D include "common/Normal.glsl"\n#pragma X3D include "common/Shadow.glsl"\n#if defined(X3D_LIGHTING)\nuniform x3d_LightSourceParameters x3d_LightSource[X3D_NUM_LIGHTS];\n#endif\nuniform x3d_PhysicalMaterialParameters x3d_Material;\n#pragma X3D include "pbr/BDRF.glsl"\n#pragma X3D include "pbr/MaterialInfo.glsl"\n#pragma X3D include "pbr/Punctual.glsl"\n#pragma X3D include "pbr/IBL.glsl"\nvec4 getMaterialColor(){vec4 baseColor=getBaseColor();\n#if defined(X3D_TEXTURE_PROJECTION)\nbaseColor.rgb*=getTextureProjectorColor();\n#endif\n#if defined(X3D_LIGHTING)||defined(X3D_USE_IBL)\nvec3 n=getNormalVector(x3d_Material.normalScale);\n#endif\nvec3 v=normalize(-vertex);MaterialInfo materialInfo;materialInfo.baseColor=baseColor.rgb;materialInfo.ior=1.5;materialInfo.f0=vec3(0.04);materialInfo.specularWeight=1.0;\n#if defined(X3D_MATERIAL_METALLIC_ROUGHNESS)\nmaterialInfo=getMetallicRoughnessInfo(materialInfo);\n#endif\nmaterialInfo.perceptualRoughness=clamp(materialInfo.perceptualRoughness,0.0,1.0);materialInfo.metallic=clamp(materialInfo.metallic,0.0,1.0);materialInfo.alphaRoughness=materialInfo.perceptualRoughness*materialInfo.perceptualRoughness;float reflectance=max(max(materialInfo.f0.r,materialInfo.f0.g),materialInfo.f0.b);materialInfo.f90=vec3(1.0);vec3 f_specular=vec3(0.0);vec3 f_diffuse=vec3(0.0);vec3 f_emissive=vec3(0.0);vec3 f_clearcoat=vec3(0.0);vec3 f_sheen=vec3(0.0);vec3 f_transmission=vec3(0.0);float albedoSheenScaling=1.0;\n#if defined(X3D_USE_IBL)\nf_specular+=getIBLRadianceGGX(n,v,materialInfo.perceptualRoughness,materialInfo.f0,materialInfo.specularWeight);f_diffuse+=getIBLRadianceLambertian(n,v,materialInfo.perceptualRoughness,materialInfo.c_diff,materialInfo.f0,materialInfo.specularWeight);\n#endif\nvec3 f_diffuse_ibl=f_diffuse;vec3 f_specular_ibl=f_specular;vec3 f_sheen_ibl=f_sheen;vec3 f_clearcoat_ibl=f_clearcoat;f_diffuse=vec3(0.0);f_specular=vec3(0.0);f_sheen=vec3(0.0);f_clearcoat=vec3(0.0);\n#if defined(X3D_LIGHTING)\nfor(int i=0;i<X3D_NUM_LIGHTS;++i){x3d_LightSourceParameters light=x3d_LightSource[i];vec3 pointToLight;float distanceToLight;if(light.type!=x3d_DirectionalLight){pointToLight=light.location-vertex;distanceToLight=length(light.matrix*pointToLight);}else{pointToLight=-light.direction;distanceToLight=-1.0;}if(distanceToLight<=light.radius||light.radius<0.0){vec3 l=normalize(pointToLight);vec3 h=normalize(l+v);float NdotL=clamp(dot(n,l),0.0,1.0);float NdotV=clamp(dot(n,v),0.0,1.0);float NdotH=clamp(dot(n,h),0.0,1.0);float VdotH=clamp(dot(v,h),0.0,1.0);if(NdotL>0.0||NdotV>0.0){vec3 intensity=getLightIntensity(light,l,distanceToLight);\n#if defined(X3D_SHADOWS)\nif(light.shadowIntensity>0.0)intensity=mix(intensity,light.shadowColor,getShadowIntensity(i,light));\n#endif\nf_diffuse+=intensity*NdotL*BRDF_lambertian(materialInfo.f0,materialInfo.f90,materialInfo.c_diff,materialInfo.specularWeight,VdotH);f_specular+=intensity*NdotL*BRDF_specularGGX(materialInfo.f0,materialInfo.f90,materialInfo.alphaRoughness,materialInfo.specularWeight,VdotH,NdotL,NdotV,NdotH);}}}\n#endif\nf_emissive=getEmissiveColor();float clearcoatFactor=0.0;vec3 clearcoatFresnel=vec3(0.0);vec3 diffuse;vec3 specular;vec3 sheen;vec3 clearcoat;\n#if defined(X3D_OCCLUSION_TEXTURE)\nfloat ao=getOcclusionFactor();diffuse=f_diffuse+mix(f_diffuse_ibl,f_diffuse_ibl*ao,x3d_Material.occlusionStrength);specular=f_specular+mix(f_specular_ibl,f_specular_ibl*ao,x3d_Material.occlusionStrength);sheen=f_sheen+mix(f_sheen_ibl,f_sheen_ibl*ao,x3d_Material.occlusionStrength);clearcoat=f_clearcoat+mix(f_clearcoat_ibl,f_clearcoat_ibl*ao,x3d_Material.occlusionStrength);\n#else\ndiffuse=f_diffuse_ibl+f_diffuse;specular=f_specular_ibl+f_specular;sheen=f_sheen_ibl+f_sheen;clearcoat=f_clearcoat_ibl+f_clearcoat;\n#endif\nvec3 color=vec3(0.0);\n#if defined(X3D_MATERIAL_UNLIT)\ncolor=baseColor.rgb;\n#else\ncolor=f_emissive+diffuse+specular;color=sheen+color*albedoSheenScaling;color=color*(1.0-clearcoatFactor*clearcoatFresnel)+clearcoat;\n#endif\n#if defined(X3D_LINEAR_OUTPUT)\nreturn vec4(color,baseColor.a);\n#else\nreturn vec4(toneMap(color),baseColor.a);\n#endif\n}void main(){fragment_main();}';i.add("PBR1.fs","assets/shaders/webgl1/PBR1.fs",By);const Uy=By,Xy='#extension GL_OES_standard_derivatives:enable\n#extension GL_EXT_frag_depth:enable\nprecision highp float;precision highp int;precision highp sampler2D;precision highp samplerCube;\n#pragma X3D include "common/Fragment.glsl"\n#pragma X3D include "common/Material.glsl"\n#pragma X3D include "common/Normal.glsl"\n#if defined(X3D_AMBIENT_TEXTURE)\nuniform x3d_AmbientTextureParameters x3d_AmbientTexture;\n#endif\nvec3 getAmbientColor(const in vec3 diffuseColor){vec3 ambientColor=x3d_Material.ambientIntensity*diffuseColor;\n#if defined(X3D_AMBIENT_TEXTURE)\nvec3 texCoord=getTexCoord(x3d_AmbientTexture.textureTransformMapping,x3d_AmbientTexture.textureCoordinateMapping);\n#if defined(X3D_AMBIENT_TEXTURE_FLIP_Y)\ntexCoord.t=1.0-texCoord.t;\n#endif\n#if defined(X3D_AMBIENT_TEXTURE_2D)\nvec3 textureColor=texture2D(x3d_AmbientTexture.texture2D,texCoord.st).rgb;\n#elif defined(X3D_AMBIENT_TEXTURE_CUBE)\nvec3 textureColor=textureCube(x3d_AmbientTexture.textureCube,texCoord).rgb;\n#endif\n#if defined(X3D_AMBIENT_TEXTURE_LINEAR)\nambientColor*=linearTosRGB(textureColor);\n#else\nambientColor*=textureColor;\n#endif\n#else\nreturn ambientColor;\n#endif\n}\n#if defined(X3D_DIFFUSE_TEXTURE)\nuniform x3d_DiffuseTextureParameters x3d_DiffuseTexture;\n#endif\nvec4 getDiffuseColor(){float alpha=1.0-x3d_Material.transparency;\n#if defined(X3D_COLOR_MATERIAL)\nvec4 diffuseColor=vec4(color.rgb,color.a*alpha);\n#else\nvec4 diffuseColor=vec4(x3d_Material.diffuseColor,alpha);\n#endif\n#if defined(X3D_DIFFUSE_TEXTURE)\nvec3 texCoord=getTexCoord(x3d_DiffuseTexture.textureTransformMapping,x3d_DiffuseTexture.textureCoordinateMapping);\n#if defined(X3D_DIFFUSE_TEXTURE_FLIP_Y)\ntexCoord.t=1.0-texCoord.t;\n#endif\n#if defined(X3D_DIFFUSE_TEXTURE_2D)\nvec4 textureColor=texture2D(x3d_DiffuseTexture.texture2D,texCoord.st);\n#elif defined(X3D_DIFFUSE_TEXTURE_CUBE)\nvec4 textureColor=textureCube(x3d_DiffuseTexture.textureCube,texCoord);\n#endif\n#if defined(X3D_DIFFUSE_TEXTURE_LINEAR)\ndiffuseColor*=linearTosRGB(textureColor);\n#else\ndiffuseColor*=textureColor;\n#endif\n#elif defined(X3D_TEXTURE)\ndiffuseColor=getTextureColor(diffuseColor,vec4(x3d_Material.specularColor,alpha));\n#endif\nreturn diffuseColor;}\n#if defined(X3D_SPECULAR_TEXTURE)\nuniform x3d_SpecularTextureParameters x3d_SpecularTexture;\n#endif\nvec3 getSpecularColor(){vec3 specularColor=x3d_Material.specularColor;\n#if defined(X3D_SPECULAR_TEXTURE)\nvec3 texCoord=getTexCoord(x3d_SpecularTexture.textureTransformMapping,x3d_SpecularTexture.textureCoordinateMapping);\n#if defined(X3D_SPECULAR_TEXTURE_FLIP_Y)\ntexCoord.t=1.0-texCoord.t;\n#endif\n#if defined(X3D_SPECULAR_TEXTURE_2D)\nvec3 textureColor=texture2D(x3d_SpecularTexture.texture2D,texCoord.st).rgb;\n#elif defined(X3D_SPECULAR_TEXTURE_CUBE)\nvec3 textureColor=textureCube(x3d_SpecularTexture.textureCube,texCoord).rgb;\n#endif\n#if defined(X3D_SPECULAR_TEXTURE_LINEAR)\nspecularColor*=linearTosRGB(textureColor);\n#else\nspecularColor*=textureColor;\n#endif\n#endif\nreturn specularColor;}\n#if defined(X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\nvec3 getEmissiveColor(){vec3 emissiveColor=x3d_Material.emissiveColor;\n#if defined(X3D_EMISSIVE_TEXTURE)\nvec3 texCoord=getTexCoord(x3d_EmissiveTexture.textureTransformMapping,x3d_EmissiveTexture.textureCoordinateMapping);\n#if defined(X3D_EMISSIVE_TEXTURE_FLIP_Y)\ntexCoord.t=1.0-texCoord.t;\n#endif\n#if defined(X3D_EMISSIVE_TEXTURE_2D)\nvec3 textureColor=texture2D(x3d_EmissiveTexture.texture2D,texCoord.st).rgb;\n#elif defined(X3D_EMISSIVE_TEXTURE_CUBE)\nvec3 textureColor=textureCube(x3d_EmissiveTexture.textureCube,texCoord).rgb;\n#endif\n#if defined(X3D_EMISSIVE_TEXTURE_LINEAR)\nemissiveColor*=linearTosRGB(textureColor);\n#else\nemissiveColor*=textureColor;\n#endif\n#endif\nreturn emissiveColor;}\n#if defined(X3D_SHININESS_TEXTURE)\nuniform x3d_ShininessTextureParameters x3d_ShininessTexture;\n#endif\nfloat getShininessFactor(){float shininess=x3d_Material.shininess;\n#if defined(X3D_SHININESS_TEXTURE)\nvec3 texCoord=getTexCoord(x3d_ShininessTexture.textureTransformMapping,x3d_ShininessTexture.textureCoordinateMapping);\n#if defined(X3D_SHININESS_TEXTURE_FLIP_Y)\ntexCoord.t=1.0-texCoord.t;\n#endif\n#if defined(X3D_SHININESS_TEXTURE_2D)\nshininess*=texture2D(x3d_ShininessTexture.texture2D,texCoord.st).a;\n#elif defined(X3D_SHININESS_TEXTURE_CUBE)\nshininess*=textureCube(x3d_ShininessTexture.textureCube,texCoord).a;\n#endif\n#endif\nreturn shininess;}\n#if defined(X3D_OCCLUSION_TEXTURE)\nuniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n#endif\nfloat getOcclusionFactor(){\n#if defined(X3D_OCCLUSION_TEXTURE)\nvec3 texCoord=getTexCoord(x3d_OcclusionTexture.textureTransformMapping,x3d_OcclusionTexture.textureCoordinateMapping);\n#if defined(X3D_OCCLUSION_TEXTURE_FLIP_Y)\ntexCoord.t=1.0-texCoord.t;\n#endif\n#if defined(X3D_OCCLUSION_TEXTURE_2D)\nreturn texture2D(x3d_OcclusionTexture.texture2D,texCoord.st).r;\n#elif defined(X3D_OCCLUSION_TEXTURE_CUBE)\nreturn textureCube(x3d_OcclusionTexture.textureCube,texCoord).r;\n#endif\n#else\nreturn 1.0;\n#endif\n}vec4 getMaterialColor(){vec4 diffuseColorAlpha=getDiffuseColor();float alpha=diffuseColorAlpha.a;vec3 diffuseColor=diffuseColorAlpha.rgb;vec3 ambientColor=getAmbientColor(diffuseColor);vec3 specularColor=getSpecularColor();float shininess=getShininessFactor();float normalScale=x3d_Material.normalScale;\n#if defined(X3D_TEXTURE_PROJECTION)\ndiffuseColor*=getTextureProjectorColor();\n#endif\n#if defined(X3D_LIGHTING)\nvec3 finalColor=getMaterialColor(vertex,getNormalVector(normalScale),ambientColor,diffuseColor,specularColor,shininess);\n#else\nvec3 finalColor=vec3(0.0);\n#endif\n#if defined(X3D_OCCLUSION_TEXTURE)\nfinalColor=mix(finalColor,finalColor*getOcclusionFactor(),x3d_Material.occlusionStrength);\n#endif\nfinalColor+=getEmissiveColor();return vec4(finalColor,alpha);}void main(){fragment_main();}';i.add("Phong1.fs","assets/shaders/webgl1/Phong1.fs",Xy);const jy=Xy,ky='#extension GL_EXT_draw_buffers:enable\nprecision highp float;precision highp int;precision highp sampler2D;varying vec3 vertex;varying vec3 normal;\n#if!defined(X3D_GEOMETRY_0D)&&!defined(X3D_GEOMETRY_1D)\nvarying vec4 texCoord0;\n#else\nvec4 texCoord0=vec4(0.0,0.0,0.0,1.0);\n#endif\n#pragma X3D include "common/ClipPlanes.glsl"\n#pragma X3D include "common/Point.glsl"\nuniform float x3d_Id;void main(){\n#if defined(X3D_CLIP_PLANES)\nclip();\n#endif\n#if defined(X3D_GEOMETRY_0D)&&defined(X3D_STYLE_PROPERTIES)\nif(getPointColor(vec4(1.0)).a<0.5)discard;texCoord0=vec4(gl_PointCoord.x,1.0-gl_PointCoord.y,0.0,1.0);\n#endif\ngl_FragData[0]=vec4(vertex,x3d_Id);gl_FragData[1]=vec4(normal,0.0);gl_FragData[2]=texCoord0;}';i.add("Pointing1.fs","assets/shaders/webgl1/Pointing1.fs",ky);const zy=ky,Gy='precision highp float;precision highp int;uniform mat4 x3d_ProjectionMatrix;uniform mat4 x3d_ModelViewMatrix;attribute vec4 x3d_Vertex;attribute vec3 x3d_Normal;\n#if!defined(X3D_GEOMETRY_0D)&&!defined(X3D_GEOMETRY_1D)\nattribute vec4 x3d_TexCoord0;\n#endif\nvarying vec3 vertex;varying vec3 normal;\n#if!defined(X3D_GEOMETRY_0D)&&!defined(X3D_GEOMETRY_1D)\nvarying vec4 texCoord0;\n#endif\n#pragma X3D include "common/PointSize.glsl"\nvoid main(){\n#if defined(X3D_GEOMETRY_0D)\n#if defined(X3D_STYLE_PROPERTIES)\ngl_PointSize=max(pointSize=getPointSize(vertex),2.0);\n#else\ngl_PointSize=2.0;\n#endif\n#endif\nvec4 position=x3d_ModelViewMatrix*x3d_Vertex;vertex=position.xyz;normal=x3d_Normal;\n#if!defined(X3D_GEOMETRY_0D)&&!defined(X3D_GEOMETRY_1D)\ntexCoord0=x3d_TexCoord0;\n#endif\ngl_Position=x3d_ProjectionMatrix*position;}';i.add("Pointing1.vs","assets/shaders/webgl1/Pointing1.vs",Gy);const Hy=Gy,qy='#extension GL_OES_standard_derivatives:enable\n#extension GL_EXT_frag_depth:enable\nprecision highp float;precision highp int;precision highp sampler2D;precision highp samplerCube;\n#pragma X3D include "common/Fragment.glsl"\nuniform x3d_UnlitMaterialParameters x3d_Material;\n#if defined(X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\nvec4 getEmissiveColor(){float alpha=1.0-x3d_Material.transparency;\n#if defined(X3D_COLOR_MATERIAL)\nvec4 emissiveColor=vec4(color.rgb,color.a*alpha);\n#else\nvec4 emissiveColor=vec4(x3d_Material.emissiveColor,alpha);\n#endif\n#if defined(X3D_EMISSIVE_TEXTURE)\nvec3 texCoord=getTexCoord(x3d_EmissiveTexture.textureTransformMapping,x3d_EmissiveTexture.textureCoordinateMapping);\n#if defined(X3D_EMISSIVE_TEXTURE_FLIP_Y)\ntexCoord.t=1.0-texCoord.t;\n#endif\n#if defined(X3D_EMISSIVE_TEXTURE_2D)\nvec4 textureColor=texture2D(x3d_EmissiveTexture.texture2D,texCoord.st);\n#elif defined(X3D_EMISSIVE_TEXTURE_CUBE)\nvec4 textureColor=textureCube(x3d_EmissiveTexture.textureCube,texCoord);\n#endif\n#if defined(X3D_EMISSIVE_TEXTURE_LINEAR)\nemissiveColor*=linearTosRGB(textureColor);\n#else\nemissiveColor*=textureColor;\n#endif\n#elif defined(X3D_TEXTURE)\nemissiveColor=getTextureColor(emissiveColor,vec4(vec3(1.0),alpha));\n#endif\nreturn emissiveColor;}vec4 getMaterialColor(){vec4 finalColor=getEmissiveColor();\n#if defined(X3D_TEXTURE_PROJECTION)\nfinalColor.rgb*=getTextureProjectorColor();\n#endif\nreturn finalColor;}void main(){fragment_main();}';i.add("Unlit1.fs","assets/shaders/webgl1/Unlit1.fs",qy);const Yy=qy,Wy="#version 300 es\nprecision highp float;precision highp int;precision highp sampler2D;in vec2 x3d_Vertex;out vec2 texCoord;void main(){texCoord=x3d_Vertex;gl_Position=vec4(x3d_Vertex,0.0,1.0);}";i.add("FullScreen2.vs","assets/shaders/webgl2/FullScreen2.vs",Wy);const $y=Wy,Jy='#version 300 es\nprecision highp float;precision highp int;precision highp sampler2D;precision highp sampler3D;precision highp samplerCube;\n#pragma X3D include "common/Vertex.glsl"\nvoid main(){vertex_main();}';i.add("Default2.vs","assets/shaders/webgl2/Default2.vs",Jy);const Ky=Jy,Zy='#version 300 es\nprecision highp float;precision highp int;precision highp sampler2D;in vec3 vertex;out vec4 x3d_FragColor;\n#pragma X3D include "common/ClipPlanes.glsl"\n#pragma X3D include "common/Point.glsl"\nvoid main(){\n#if defined(X3D_CLIP_PLANES)\nclip();\n#endif\n#if defined(X3D_GEOMETRY_0D)&&defined(X3D_STYLE_PROPERTIES)\nif(getPointColor(vec4(1.0)).a<0.5)discard;\n#endif\nx3d_FragColor=vec4(gl_FragCoord.z);}';i.add("Depth2.fs","assets/shaders/webgl2/Depth2.fs",Zy);const Qy=Zy,ew='#version 300 es\nprecision highp float;precision highp int;precision highp sampler2D;uniform mat4 x3d_ProjectionMatrix;uniform mat4 x3d_ModelViewMatrix;in vec4 x3d_Vertex;out vec3 vertex;\n#pragma X3D include "common/Utils.glsl"\n#pragma X3D include "common/Skin.glsl"\n#pragma X3D include "common/Particle.glsl"\n#pragma X3D include "common/PointSize.glsl"\nvoid main(){vec4 x3d_TransformedVertex=getParticleVertex(getSkinVertex(x3d_Vertex,vec3(0.0)));vec4 position=x3d_ModelViewMatrix*x3d_TransformedVertex;vertex=position.xyz;\n#if defined(X3D_GEOMETRY_0D)\n#if defined(X3D_STYLE_PROPERTIES)\ngl_PointSize=max(pointSize=getPointSize(vertex),2.0);\n#else\ngl_PointSize=2.0;\n#endif\n#endif\ngl_Position=x3d_ProjectionMatrix*position;}';i.add("Depth2.vs","assets/shaders/webgl2/Depth2.vs",ew);const tw=ew,iw='#version 300 es\nprecision highp float;precision highp int;precision highp sampler2D;precision highp sampler3D;precision highp samplerCube;\n#pragma X3D include "common/Fragment.glsl"\nin vec4 frontColor;\n#if!defined(X3D_GEOMETRY_0D)&&!defined(X3D_GEOMETRY_1D)\nin vec4 backColor;\n#endif\nvec4 getMaterialColor(){\n#if defined(X3D_GEOMETRY_0D)||defined(X3D_GEOMETRY_1D)\nvec4 finalColor=frontColor;\n#else\nvec4 finalColor=gl_FrontFacing?frontColor:backColor;\n#endif\n#if defined(X3D_TEXTURE)\nfinalColor=getTextureColor(finalColor,vec4(1.0));\n#endif\n#if defined(X3D_TEXTURE_PROJECTION)\nfinalColor.rgb*=getTextureProjectorColor();\n#endif\nreturn finalColor;}void main(){fragment_main();}';i.add("Gouraud2.fs","assets/shaders/webgl2/Gouraud2.fs",iw);const nw=iw,rw='#version 300 es\nprecision highp float;precision highp int;precision highp sampler2D;precision highp sampler3D;precision highp samplerCube;\n#pragma X3D include "common/Vertex.glsl"\n#pragma X3D include "common/Material.glsl"\nout vec4 frontColor;\n#if!defined(X3D_GEOMETRY_0D)&&!defined(X3D_GEOMETRY_1D)\nout vec4 backColor;\n#endif\nvec4 getMaterialColor(const in vec3 N,const in vec3 vertex,const in x3d_MaterialParameters material){float alpha=1.0-x3d_Material.transparency;\n#if defined(X3D_COLOR_MATERIAL)\nvec4 diffuseColor=vec4(color.rgb,color.a*alpha);\n#else\nvec4 diffuseColor=vec4(x3d_Material.diffuseColor,alpha);\n#endif\n#if defined(X3D_LIGHTING)\nvec3 ambientColor=diffuseColor.rgb*material.ambientIntensity;vec3 finalColor=getMaterialColor(vertex,N,ambientColor,diffuseColor.rgb,material.specularColor,material.shininess);\n#else\nvec3 finalColor=vec3(0.0);\n#endif\nfinalColor+=material.emissiveColor;return vec4(finalColor,diffuseColor.a);}void main(){vertex_main();\n#if defined(X3D_LIGHTING)\nnormal=normalize(normal);\n#else\nvec3 normal=vec3(0.0);\n#endif\nfrontColor=getMaterialColor(normal,vertex,x3d_Material);\n#if!defined(X3D_GEOMETRY_0D)&&!defined(X3D_GEOMETRY_1D)\nbackColor=getMaterialColor(-normal,vertex,x3d_Material);\n#endif\n}';i.add("Gouraud2.vs","assets/shaders/webgl2/Gouraud2.vs",rw);const sw=rw,ow="#version 300 es\nprecision highp float;void main(){}";i.add("LineTransform2.fs","assets/shaders/webgl2/LineTransform2.fs",ow);const aw=ow,lw="#version 300 es\nprecision highp float;uniform vec4 viewport;uniform mat4 modelViewProjectionMatrix;uniform mat4 invModelViewProjectionMatrix;uniform float scale;in float x3d_CoordIndex0;in vec3 x3d_LineStipple0;in float x3d_FogDepth0;in vec4 x3d_Color0;in vec3 x3d_Normal0;in vec4 x3d_Vertex0;in float x3d_CoordIndex1;in vec3 x3d_LineStipple1;in float x3d_FogDepth1;in vec4 x3d_Color1;in vec3 x3d_Normal1;in vec4 x3d_Vertex1;out float coordIndex0;out vec3 lineStipple0;out float fogDepth0;out vec4 color0;out vec3 normal0;out vec4 vertex0;out float coordIndex1;out vec3 lineStipple1;out float fogDepth1;out vec4 color1;out vec3 normal1;out vec4 vertex1;out float coordIndex2;out vec3 lineStipple2;out float fogDepth2;out vec4 color2;out vec3 normal2;out vec4 vertex2;vec3 projectPoint(const in vec4 point,const in mat4 modelViewProjectionMatrix,const in vec4 viewport){vec4 vin=modelViewProjectionMatrix*point;vin.xyz=vin.xyz/(2.0*vin.w)+0.5;return vec3(vin.xy*viewport.zw+viewport.xy,vin.z);}vec4 unProjectPoint(const in vec3 win,const in mat4 invModelViewProjection,const in vec4 viewport){vec4 vin=vec4((win.xy-viewport.xy)/viewport.zw*2.0-1.0,2.0*win.z-1.0,1.0);vin=invModelViewProjection*vin;return vec4(vin.xyz/vin.w,1.0);}void main(){vec3 projected0=projectPoint(x3d_Vertex0,modelViewProjectionMatrix,viewport);vec3 projected1=projectPoint(x3d_Vertex1,modelViewProjectionMatrix,viewport);vec2 direction=normalize(projected1.xy-projected0.xy);vec2 offset=vec2(-direction.y,direction.x)*scale;if(gl_InstanceID==0){vec2 pq0=projected0.xy+offset;vec2 pq1=projected0.xy-offset;vec2 pq2=projected1.xy-offset;vec4 p0=unProjectPoint(vec3(pq0.xy,projected0.z),invModelViewProjectionMatrix,viewport);vec4 p1=unProjectPoint(vec3(pq1.xy,projected0.z),invModelViewProjectionMatrix,viewport);vec4 p2=unProjectPoint(vec3(pq2.xy,projected1.z),invModelViewProjectionMatrix,viewport);coordIndex0=x3d_CoordIndex0;lineStipple0=x3d_LineStipple0;fogDepth0=x3d_FogDepth0;color0=x3d_Color0;normal0=x3d_Normal0;vertex0=p0;coordIndex1=x3d_CoordIndex0;lineStipple1=x3d_LineStipple0;fogDepth1=x3d_FogDepth0;color1=x3d_Color0;normal1=x3d_Normal0;vertex1=p1;coordIndex2=x3d_CoordIndex1;lineStipple2=x3d_LineStipple1;fogDepth2=x3d_FogDepth1;color2=x3d_Color1;normal2=x3d_Normal1;vertex2=p2;}else{vec2 pq0=projected0.xy+offset;vec2 pq2=projected1.xy-offset;vec2 pq3=projected1.xy+offset;vec4 p0=unProjectPoint(vec3(pq0.xy,projected0.z),invModelViewProjectionMatrix,viewport);vec4 p2=unProjectPoint(vec3(pq2.xy,projected1.z),invModelViewProjectionMatrix,viewport);vec4 p3=unProjectPoint(vec3(pq3.xy,projected1.z),invModelViewProjectionMatrix,viewport);coordIndex0=x3d_CoordIndex0;lineStipple0=x3d_LineStipple0;fogDepth0=x3d_FogDepth0;color0=x3d_Color0;normal0=x3d_Normal0;vertex0=p0;coordIndex1=x3d_CoordIndex1;lineStipple1=x3d_LineStipple1;fogDepth1=x3d_FogDepth1;color1=x3d_Color1;normal1=x3d_Normal1;vertex1=p2;coordIndex2=x3d_CoordIndex1;lineStipple2=x3d_LineStipple1;fogDepth2=x3d_FogDepth1;color2=x3d_Color1;normal2=x3d_Normal1;vertex2=p3;}}";i.add("LineTransform2.vs","assets/shaders/webgl2/LineTransform2.vs",lw);const uw=lw,hw="#version 300 es\nprecision highp float;precision highp int;precision highp sampler2D;uniform sampler2D x3d_AccumRevealageTexture;uniform sampler2D x3d_AlphaTexture;out vec4 x3d_FragColor;void main(){ivec2 fragCoord=ivec2(gl_FragCoord.xy);vec4 accum=texelFetch(x3d_AccumRevealageTexture,fragCoord,0);if(accum.a>=1.0)discard;float alpha=texelFetch(x3d_AlphaTexture,fragCoord,0).r;float revealage=1.0-accum.a;x3d_FragColor=vec4(revealage*accum.rgb/clamp(alpha,0.001,50000.0),revealage);}";i.add("OITCompose2.fs","assets/shaders/webgl2/OITCompose2.fs",hw);const dw=hw,cw='#version 300 es\nprecision highp float;precision highp int;precision highp sampler2D;precision highp sampler3D;precision highp samplerCube;\n#pragma X3D include "common/Fragment.glsl"\n#pragma X3D include "common/Normal.glsl"\n#pragma X3D include "common/Shadow.glsl"\n#if defined(X3D_LIGHTING)\nuniform x3d_LightSourceParameters x3d_LightSource[X3D_NUM_LIGHTS];\n#endif\nuniform x3d_PhysicalMaterialParameters x3d_Material;\n#pragma X3D include "pbr/BDRF.glsl"\n#pragma X3D include "pbr/MaterialInfo.glsl"\n#pragma X3D include "pbr/Punctual.glsl"\n#pragma X3D include "pbr/IBL.glsl"\nvec4 getMaterialColor(){vec4 baseColor=getBaseColor();\n#if defined(X3D_TEXTURE_PROJECTION)\nbaseColor.rgb*=getTextureProjectorColor();\n#endif\n#if defined(X3D_LIGHTING)||defined(X3D_USE_IBL)\nvec3 n=getNormalVector(x3d_Material.normalScale);\n#endif\nvec3 v=normalize(-vertex);MaterialInfo materialInfo;materialInfo.baseColor=baseColor.rgb;materialInfo.ior=1.5;materialInfo.f0=vec3(0.04);materialInfo.specularWeight=1.0;\n#if defined(X3D_MATERIAL_METALLIC_ROUGHNESS)\nmaterialInfo=getMetallicRoughnessInfo(materialInfo);\n#endif\nmaterialInfo.perceptualRoughness=clamp(materialInfo.perceptualRoughness,0.0,1.0);materialInfo.metallic=clamp(materialInfo.metallic,0.0,1.0);materialInfo.alphaRoughness=materialInfo.perceptualRoughness*materialInfo.perceptualRoughness;float reflectance=max(max(materialInfo.f0.r,materialInfo.f0.g),materialInfo.f0.b);materialInfo.f90=vec3(1.0);vec3 f_specular=vec3(0.0);vec3 f_diffuse=vec3(0.0);vec3 f_emissive=vec3(0.0);vec3 f_clearcoat=vec3(0.0);vec3 f_sheen=vec3(0.0);vec3 f_transmission=vec3(0.0);float albedoSheenScaling=1.0;\n#if defined(X3D_USE_IBL)\nf_specular+=getIBLRadianceGGX(n,v,materialInfo.perceptualRoughness,materialInfo.f0,materialInfo.specularWeight);f_diffuse+=getIBLRadianceLambertian(n,v,materialInfo.perceptualRoughness,materialInfo.c_diff,materialInfo.f0,materialInfo.specularWeight);\n#endif\nvec3 f_diffuse_ibl=f_diffuse;vec3 f_specular_ibl=f_specular;vec3 f_sheen_ibl=f_sheen;vec3 f_clearcoat_ibl=f_clearcoat;f_diffuse=vec3(0.0);f_specular=vec3(0.0);f_sheen=vec3(0.0);f_clearcoat=vec3(0.0);\n#if defined(X3D_LIGHTING)\nfor(int i=0;i<X3D_NUM_LIGHTS;++i){x3d_LightSourceParameters light=x3d_LightSource[i];vec3 pointToLight;float distanceToLight;if(light.type!=x3d_DirectionalLight){pointToLight=light.location-vertex;distanceToLight=length(light.matrix*pointToLight);}else{pointToLight=-light.direction;distanceToLight=-1.0;}if(distanceToLight<=light.radius||light.radius<0.0){vec3 l=normalize(pointToLight);vec3 h=normalize(l+v);float NdotL=clamp(dot(n,l),0.0,1.0);float NdotV=clamp(dot(n,v),0.0,1.0);float NdotH=clamp(dot(n,h),0.0,1.0);float VdotH=clamp(dot(v,h),0.0,1.0);if(NdotL>0.0||NdotV>0.0){vec3 intensity=getLightIntensity(light,l,distanceToLight);\n#if defined(X3D_SHADOWS)\nif(light.shadowIntensity>0.0)intensity=mix(intensity,light.shadowColor,getShadowIntensity(i,light));\n#endif\nf_diffuse+=intensity*NdotL*BRDF_lambertian(materialInfo.f0,materialInfo.f90,materialInfo.c_diff,materialInfo.specularWeight,VdotH);f_specular+=intensity*NdotL*BRDF_specularGGX(materialInfo.f0,materialInfo.f90,materialInfo.alphaRoughness,materialInfo.specularWeight,VdotH,NdotL,NdotV,NdotH);}}}\n#endif\nf_emissive=getEmissiveColor();float clearcoatFactor=0.0;vec3 clearcoatFresnel=vec3(0.0);vec3 diffuse;vec3 specular;vec3 sheen;vec3 clearcoat;\n#if defined(X3D_OCCLUSION_TEXTURE)\nfloat ao=getOcclusionFactor();diffuse=f_diffuse+mix(f_diffuse_ibl,f_diffuse_ibl*ao,x3d_Material.occlusionStrength);specular=f_specular+mix(f_specular_ibl,f_specular_ibl*ao,x3d_Material.occlusionStrength);sheen=f_sheen+mix(f_sheen_ibl,f_sheen_ibl*ao,x3d_Material.occlusionStrength);clearcoat=f_clearcoat+mix(f_clearcoat_ibl,f_clearcoat_ibl*ao,x3d_Material.occlusionStrength);\n#else\ndiffuse=f_diffuse_ibl+f_diffuse;specular=f_specular_ibl+f_specular;sheen=f_sheen_ibl+f_sheen;clearcoat=f_clearcoat_ibl+f_clearcoat;\n#endif\nvec3 color=vec3(0.0);\n#if defined(X3D_MATERIAL_UNLIT)\ncolor=baseColor.rgb;\n#else\ncolor=f_emissive+diffuse+specular;color=sheen+color*albedoSheenScaling;color=color*(1.0-clearcoatFactor*clearcoatFresnel)+clearcoat;\n#endif\n#if defined(X3D_LINEAR_OUTPUT)\nreturn vec4(color,baseColor.a);\n#else\nreturn vec4(toneMap(color),baseColor.a);\n#endif\n}void main(){fragment_main();}';i.add("PBR2.fs","assets/shaders/webgl2/PBR2.fs",cw);const pw=cw,gw='#version 300 es\nprecision highp float;precision highp int;precision highp sampler2D;precision highp sampler3D;precision highp samplerCube;\n#pragma X3D include "common/Fragment.glsl"\n#pragma X3D include "common/Material.glsl"\n#pragma X3D include "common/Normal.glsl"\n#if defined(X3D_AMBIENT_TEXTURE)\nuniform x3d_AmbientTextureParameters x3d_AmbientTexture;\n#endif\nvec3 getAmbientColor(const in vec3 diffuseColor){vec3 ambientColor=x3d_Material.ambientIntensity*diffuseColor;\n#if defined(X3D_AMBIENT_TEXTURE)\nvec3 texCoord=getTexCoord(x3d_AmbientTexture.textureTransformMapping,x3d_AmbientTexture.textureCoordinateMapping);\n#if defined(X3D_AMBIENT_TEXTURE_FLIP_Y)\ntexCoord.t=1.0-texCoord.t;\n#endif\n#if defined(X3D_AMBIENT_TEXTURE_2D)\nvec3 textureColor=texture(x3d_AmbientTexture.texture2D,texCoord.st).rgb;\n#elif defined(X3D_AMBIENT_TEXTURE_3D)\nvec3 textureColor=texture(x3d_AmbientTexture.texture3D,texCoord).rgb;\n#elif defined(X3D_AMBIENT_TEXTURE_CUBE)\nvec3 textureColor=texture(x3d_AmbientTexture.textureCube,texCoord).rgb;\n#endif\n#if defined(X3D_AMBIENT_TEXTURE_LINEAR)\nambientColor*=linearTosRGB(textureColor);\n#else\nambientColor*=textureColor;\n#endif\n#endif\nreturn ambientColor;}\n#if defined(X3D_DIFFUSE_TEXTURE)\nuniform x3d_DiffuseTextureParameters x3d_DiffuseTexture;\n#endif\nvec4 getDiffuseColor(){float alpha=1.0-x3d_Material.transparency;\n#if defined(X3D_COLOR_MATERIAL)\nvec4 diffuseColor=vec4(color.rgb,color.a*alpha);\n#else\nvec4 diffuseColor=vec4(x3d_Material.diffuseColor,alpha);\n#endif\n#if defined(X3D_DIFFUSE_TEXTURE)\nvec3 texCoord=getTexCoord(x3d_DiffuseTexture.textureTransformMapping,x3d_DiffuseTexture.textureCoordinateMapping);\n#if defined(X3D_DIFFUSE_TEXTURE_FLIP_Y)\ntexCoord.t=1.0-texCoord.t;\n#endif\n#if defined(X3D_DIFFUSE_TEXTURE_2D)\nvec4 textureColor=texture(x3d_DiffuseTexture.texture2D,texCoord.st);\n#elif defined(X3D_DIFFUSE_TEXTURE_3D)\nvec4 textureColor=texture(x3d_DiffuseTexture.texture3D,texCoord);\n#elif defined(X3D_DIFFUSE_TEXTURE_CUBE)\nvec4 textureColor=texture(x3d_DiffuseTexture.textureCube,texCoord);\n#endif\n#if defined(X3D_DIFFUSE_TEXTURE_LINEAR)\ndiffuseColor*=linearTosRGB(textureColor);\n#else\ndiffuseColor*=textureColor;\n#endif\n#elif defined(X3D_TEXTURE)\ndiffuseColor=getTextureColor(diffuseColor,vec4(x3d_Material.specularColor,alpha));\n#endif\nreturn diffuseColor;}\n#if defined(X3D_SPECULAR_TEXTURE)\nuniform x3d_SpecularTextureParameters x3d_SpecularTexture;\n#endif\nvec3 getSpecularColor(){vec3 specularColor=x3d_Material.specularColor;\n#if defined(X3D_SPECULAR_TEXTURE)\nvec3 texCoord=getTexCoord(x3d_SpecularTexture.textureTransformMapping,x3d_SpecularTexture.textureCoordinateMapping);\n#if defined(X3D_SPECULAR_TEXTURE_FLIP_Y)\ntexCoord.t=1.0-texCoord.t;\n#endif\n#if defined(X3D_SPECULAR_TEXTURE_2D)\nvec3 textureColor=texture(x3d_SpecularTexture.texture2D,texCoord.st).rgb;\n#elif defined(X3D_SPECULAR_TEXTURE_3D)\nvec3 textureColor=texture(x3d_SpecularTexture.texture3D,texCoord).rgb;\n#elif defined(X3D_SPECULAR_TEXTURE_CUBE)\nvec3 textureColor=texture(x3d_SpecularTexture.textureCube,texCoord).rgb;\n#endif\n#if defined(X3D_SPECULAR_TEXTURE_LINEAR)\nspecularColor*=linearTosRGB(textureColor);\n#else\nspecularColor*=textureColor;\n#endif\n#endif\nreturn specularColor;}\n#if defined(X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\nvec3 getEmissiveColor(){vec3 emissiveColor=x3d_Material.emissiveColor;\n#if defined(X3D_EMISSIVE_TEXTURE)\nvec3 texCoord=getTexCoord(x3d_EmissiveTexture.textureTransformMapping,x3d_EmissiveTexture.textureCoordinateMapping);\n#if defined(X3D_EMISSIVE_TEXTURE_FLIP_Y)\ntexCoord.t=1.0-texCoord.t;\n#endif\n#if defined(X3D_EMISSIVE_TEXTURE_2D)\nvec3 textureColor=texture(x3d_EmissiveTexture.texture2D,texCoord.st).rgb;\n#elif defined(X3D_EMISSIVE_TEXTURE_3D)\nvec3 textureColor=texture(x3d_EmissiveTexture.texture3D,texCoord).rgb;\n#elif defined(X3D_EMISSIVE_TEXTURE_CUBE)\nvec3 textureColor=texture(x3d_EmissiveTexture.textureCube,texCoord).rgb;\n#endif\n#if defined(X3D_EMISSIVE_TEXTURE_LINEAR)\nemissiveColor*=linearTosRGB(textureColor);\n#else\nemissiveColor*=textureColor;\n#endif\n#endif\nreturn emissiveColor;}\n#if defined(X3D_SHININESS_TEXTURE)\nuniform x3d_ShininessTextureParameters x3d_ShininessTexture;\n#endif\nfloat getShininessFactor(){float shininess=x3d_Material.shininess;\n#if defined(X3D_SHININESS_TEXTURE)\nvec3 texCoord=getTexCoord(x3d_ShininessTexture.textureTransformMapping,x3d_ShininessTexture.textureCoordinateMapping);\n#if defined(X3D_SHININESS_TEXTURE_FLIP_Y)\ntexCoord.t=1.0-texCoord.t;\n#endif\n#if defined(X3D_SHININESS_TEXTURE_2D)\nshininess*=texture(x3d_ShininessTexture.texture2D,texCoord.st).a;\n#elif defined(X3D_SHININESS_TEXTURE_3D)\nshininess*=texture(x3d_ShininessTexture.texture3D,texCoord).a;\n#elif defined(X3D_SHININESS_TEXTURE_CUBE)\nshininess*=texture(x3d_ShininessTexture.textureCube,texCoord).a;\n#endif\n#endif\nreturn shininess;}\n#if defined(X3D_OCCLUSION_TEXTURE)\nuniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n#endif\nfloat getOcclusionFactor(){\n#if defined(X3D_OCCLUSION_TEXTURE)\nvec3 texCoord=getTexCoord(x3d_OcclusionTexture.textureTransformMapping,x3d_OcclusionTexture.textureCoordinateMapping);\n#if defined(X3D_OCCLUSION_TEXTURE_FLIP_Y)\ntexCoord.t=1.0-texCoord.t;\n#endif\n#if defined(X3D_OCCLUSION_TEXTURE_2D)\nreturn texture(x3d_OcclusionTexture.texture2D,texCoord.st).r;\n#elif defined(X3D_OCCLUSION_TEXTURE_3D)\nreturn texture(x3d_OcclusionTexture.texture3D,texCoord).r;\n#elif defined(X3D_OCCLUSION_TEXTURE_CUBE)\nreturn texture(x3d_OcclusionTexture.textureCube,texCoord).r;\n#endif\n#else\nreturn 1.0;\n#endif\n}vec4 getMaterialColor(){vec4 diffuseColorAlpha=getDiffuseColor();float alpha=diffuseColorAlpha.a;vec3 diffuseColor=diffuseColorAlpha.rgb;vec3 ambientColor=getAmbientColor(diffuseColor);vec3 specularColor=getSpecularColor();float shininess=getShininessFactor();float normalScale=x3d_Material.normalScale;\n#if defined(X3D_TEXTURE_PROJECTION)\ndiffuseColor*=getTextureProjectorColor();\n#endif\n#if defined(X3D_LIGHTING)\nvec3 finalColor=getMaterialColor(vertex,getNormalVector(normalScale),ambientColor,diffuseColor,specularColor,shininess);\n#else\nvec3 finalColor=vec3(0.0);\n#endif\n#if defined(X3D_OCCLUSION_TEXTURE)\nfinalColor=mix(finalColor,finalColor*getOcclusionFactor(),x3d_Material.occlusionStrength);\n#endif\nfinalColor+=getEmissiveColor();return vec4(finalColor,alpha);}void main(){fragment_main();}';i.add("Phong2.fs","assets/shaders/webgl2/Phong2.fs",gw);const fw=gw,mw='#version 300 es\nprecision highp float;precision highp int;precision highp sampler2D;in vec3 vertex;in vec3 normal;in vec4 texCoord;\n#if!defined(X3D_GEOMETRY_0D)&&!defined(X3D_GEOMETRY_1D)\nin vec4 texCoord0;\n#else\nvec4 texCoord0=vec4(0.0,0.0,0.0,1.0);\n#endif\nlayout(location=0)out vec4 x3d_FragData0;layout(location=1)out vec4 x3d_FragData1;layout(location=2)out vec4 x3d_FragData2;\n#pragma X3D include "common/ClipPlanes.glsl"\n#pragma X3D include "common/Point.glsl"\n#pragma X3D include "Stipple.glsl"\nuniform float x3d_Id;void main(){\n#if defined(X3D_CLIP_PLANES)\nclip();\n#endif\n#if defined(X3D_GEOMETRY_0D)&&defined(X3D_STYLE_PROPERTIES)\nif(getPointColor(vec4(1.0)).a<0.5)discard;texCoord0=vec4(gl_PointCoord.x,1.0-gl_PointCoord.y,0.0,1.0);\n#endif\n#if defined(X3D_GEOMETRY_1D)&&defined(X3D_STYLE_PROPERTIES)\nstipple();\n#endif\nx3d_FragData0=vec4(vertex,x3d_Id);x3d_FragData1=vec4(normal,0.0);x3d_FragData2=texCoord0;}';i.add("Pointing2.fs","assets/shaders/webgl2/Pointing2.fs",mw);const _w=mw,xw='#version 300 es\nprecision highp float;precision highp int;precision highp sampler2D;uniform mat4 x3d_ProjectionMatrix;uniform mat4 x3d_ModelViewMatrix;in vec4 x3d_Vertex;in vec3 x3d_Normal;\n#if!defined(X3D_GEOMETRY_0D)&&!defined(X3D_GEOMETRY_1D)\nin vec4 x3d_TexCoord0;\n#endif\n#if defined(X3D_GEOMETRY_1D)&&defined(X3D_STYLE_PROPERTIES)\nin vec3 x3d_LineStipple;\n#endif\nout vec3 vertex;out vec3 normal;\n#if!defined(X3D_GEOMETRY_0D)&&!defined(X3D_GEOMETRY_1D)\nout vec4 texCoord0;\n#endif\n#if defined(X3D_GEOMETRY_1D)&&defined(X3D_STYLE_PROPERTIES)\nflat out float lengthSoFar;flat out vec2 startPoint;out vec2 midPoint;\n#endif\n#pragma X3D include "common/Utils.glsl"\n#pragma X3D include "common/Skin.glsl"\n#pragma X3D include "common/Particle.glsl"\n#pragma X3D include "common/PointSize.glsl"\nvoid main(){\n#if defined(X3D_GEOMETRY_1D)&&defined(X3D_STYLE_PROPERTIES)\nlengthSoFar=x3d_LineStipple.z;startPoint=x3d_LineStipple.xy;midPoint=x3d_LineStipple.xy;\n#endif\nvec4 x3d_TransformedVertex=getParticleVertex(getSkinVertex(x3d_Vertex,vec3(0.0)));vec4 position=x3d_ModelViewMatrix*x3d_TransformedVertex;vertex=position.xyz;normal=x3d_Normal;\n#if defined(X3D_GEOMETRY_0D)\n#if defined(X3D_STYLE_PROPERTIES)\ngl_PointSize=max(pointSize=getPointSize(vertex),2.0);\n#else\ngl_PointSize=2.0;\n#endif\n#endif\n#if!defined(X3D_GEOMETRY_0D)&&!defined(X3D_GEOMETRY_1D)\ntexCoord0=x3d_TexCoord0;\n#endif\ngl_Position=x3d_ProjectionMatrix*position;}';i.add("Pointing2.vs","assets/shaders/webgl2/Pointing2.vs",xw);const yw=xw,ww='#version 300 es\nprecision highp float;precision highp int;precision highp sampler2D;precision highp sampler3D;precision highp samplerCube;\n#pragma X3D include "common/Fragment.glsl"\nuniform x3d_UnlitMaterialParameters x3d_Material;\n#if defined(X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\nvec4 getEmissiveColor(){float alpha=1.0-x3d_Material.transparency;\n#if defined(X3D_COLOR_MATERIAL)\nvec4 emissiveColor=vec4(color.rgb,color.a*alpha);\n#else\nvec4 emissiveColor=vec4(x3d_Material.emissiveColor,alpha);\n#endif\n#if defined(X3D_EMISSIVE_TEXTURE)\nvec3 texCoord=getTexCoord(x3d_EmissiveTexture.textureTransformMapping,x3d_EmissiveTexture.textureCoordinateMapping);\n#if defined(X3D_EMISSIVE_TEXTURE_FLIP_Y)\ntexCoord.t=1.0-texCoord.t;\n#endif\n#if defined(X3D_EMISSIVE_TEXTURE_2D)\nvec4 textureColor=texture(x3d_EmissiveTexture.texture2D,texCoord.st);\n#elif defined(X3D_EMISSIVE_TEXTURE_3D)\nvec4 textureColor=texture(x3d_EmissiveTexture.texture3D,texCoord);\n#elif defined(X3D_EMISSIVE_TEXTURE_CUBE)\nvec4 textureColor=texture(x3d_EmissiveTexture.textureCube,texCoord);\n#endif\n#if defined(X3D_EMISSIVE_TEXTURE_LINEAR)\nemissiveColor*=linearTosRGB(textureColor);\n#else\nemissiveColor*=textureColor;\n#endif\n#elif defined(X3D_TEXTURE)\nemissiveColor=getTextureColor(emissiveColor,vec4(vec3(1.0),alpha));\n#endif\nreturn emissiveColor;}vec4 getMaterialColor(){vec4 finalColor=getEmissiveColor();\n#if defined(X3D_TEXTURE_PROJECTION)\nfinalColor.rgb*=getTextureProjectorColor();\n#endif\nreturn finalColor;}void main(){fragment_main();}';i.add("Unlit2.fs","assets/shaders/webgl2/Unlit2.fs",ww);const bw=ww,Sw="#if defined(X3D_LIGHTING)\nconst float M_PI=3.14159265359;vec3 F_Schlick(vec3 f0,vec3 f90,float VdotH){return f0+(f90-f0)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}float V_GGX(float NdotL,float NdotV,float alphaRoughness){float alphaRoughnessSq=alphaRoughness*alphaRoughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-alphaRoughnessSq)+alphaRoughnessSq);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-alphaRoughnessSq)+alphaRoughnessSq);float GGX=GGXV+GGXL;if(GGX>0.0){return 0.5/GGX;}return 0.0;}float D_GGX(float NdotH,float alphaRoughness){float alphaRoughnessSq=alphaRoughness*alphaRoughness;float f=(NdotH*NdotH)*(alphaRoughnessSq-1.0)+1.0;return alphaRoughnessSq/(M_PI*f*f);}vec3 BRDF_lambertian(vec3 f0,vec3 f90,vec3 diffuseColor,float specularWeight,float VdotH){return(1.0-specularWeight*F_Schlick(f0,f90,VdotH))*(diffuseColor/M_PI);}vec3 BRDF_specularGGX(vec3 f0,vec3 f90,float alphaRoughness,float specularWeight,float VdotH,float NdotL,float NdotV,float NdotH){vec3 F=F_Schlick(f0,f90,VdotH);float Vis=V_GGX(NdotL,NdotV,alphaRoughness);float D=D_GGX(NdotH,alphaRoughness);return specularWeight*F*Vis*D;}\n#endif\n";i.add("BDRF1.glsl","assets/shaders/webgl1/pbr/BDRF1.glsl",Sw);const Tw=Sw,vw="#if defined(X3D_USE_IBL)\nuniform x3d_EnvironmentLightSourceParameters x3d_EnvironmentLightSource;vec3 getDiffuseLight(const in vec3 n){vec3 textureColor=textureCube(x3d_EnvironmentLightSource.diffuseTexture,x3d_EnvironmentLightSource.rotation*n).rgb;if(!x3d_EnvironmentLightSource.diffuseTextureLinear)textureColor=sRGBToLinear(textureColor);return textureColor*x3d_EnvironmentLightSource.color*x3d_EnvironmentLightSource.intensity;}vec3 getSpecularLight(const in vec3 reflection,const in float lod){vec3 textureColor=textureCubeLodEXT(x3d_EnvironmentLightSource.specularTexture,x3d_EnvironmentLightSource.rotation*reflection,lod).rgb;if(!x3d_EnvironmentLightSource.specularTextureLinear)textureColor=sRGBToLinear(textureColor);return textureColor*x3d_EnvironmentLightSource.color*x3d_EnvironmentLightSource.intensity;}vec3 getIBLRadianceGGX(const in vec3 n,const in vec3 v,const in float roughness,const in vec3 F0,const in float specularWeight){float NdotV=clamp(dot(n,v),0.0,1.0);float lod=roughness*float(x3d_EnvironmentLightSource.specularTextureLevels-1);vec3 reflection=normalize(reflect(-v,n));vec2 brdfSamplePoint=clamp(vec2(NdotV,roughness),vec2(0.0),vec2(1.0));vec2 f_ab=texture2D(x3d_EnvironmentLightSource.GGXLUTTexture,brdfSamplePoint).rg;vec3 specularLight=getSpecularLight(reflection,lod);vec3 Fr=max(vec3(1.0-roughness),F0)-F0;vec3 k_S=F0+Fr*pow(1.0-NdotV,5.0);vec3 FssEss=k_S*f_ab.x+f_ab.y;return specularWeight*specularLight*FssEss;}vec3 getIBLRadianceLambertian(const in vec3 n,const in vec3 v,const in float roughness,const in vec3 diffuseColor,const in vec3 F0,const in float specularWeight){float NdotV=clamp(dot(n,v),0.0,1.0);vec2 brdfSamplePoint=clamp(vec2(NdotV,roughness),vec2(0.0),vec2(1.0));vec2 f_ab=texture2D(x3d_EnvironmentLightSource.GGXLUTTexture,brdfSamplePoint).rg;vec3 irradiance=getDiffuseLight(n);vec3 Fr=max(vec3(1.0-roughness),F0)-F0;vec3 k_S=F0+Fr*pow(1.0-NdotV,5.0);vec3 FssEss=specularWeight*k_S*f_ab.x+f_ab.y;float Ems=(1.0-(f_ab.x+f_ab.y));vec3 F_avg=specularWeight*(F0+(1.0-F0)/21.0);vec3 FmsEms=Ems*FssEss*F_avg/(1.0-F_avg*Ems);vec3 k_D=diffuseColor*(1.0-FssEss+FmsEms);return(FmsEms+k_D)*irradiance;}\n#endif\n";i.add("IBL1.glsl","assets/shaders/webgl1/pbr/IBL1.glsl",vw);const Ow=vw,Ew='#if defined(X3D_LIGHTING)\n#pragma X3D include "../common/Lighting.glsl"\nvec3 getLightIntensity(const in x3d_LightSourceParameters light,const in vec3 pointToLight,const in float distanceToLight){float attenuationFactor=1.0;float spotFactor=1.0;if(light.type!=x3d_DirectionalLight){attenuationFactor=getAttenuation(light.attenuation,distanceToLight);}if(light.type==x3d_SpotLight){spotFactor=getSpotFactor(pointToLight,light.direction,light.cutOffAngle,light.beamWidth);}return attenuationFactor*spotFactor*light.intensity*light.color;}\n#endif\n';i.add("Punctual1.glsl","assets/shaders/webgl1/pbr/Punctual1.glsl",Ew);const Cw=Ew,Nw="struct MaterialInfo{float ior;float perceptualRoughness;vec3 f0;float alphaRoughness;vec3 c_diff;vec3 f90;float metallic;vec3 baseColor;float sheenRoughnessFactor;vec3 sheenColorFactor;vec3 clearcoatF0;vec3 clearcoatF90;float clearcoatFactor;vec3 clearcoatNormal;float clearcoatRoughness;float specularWeight;float transmissionFactor;float thickness;vec3 attenuationColor;float attenuationDistance;float iridescenceFactor;float iridescenceIor;float iridescenceThickness;vec3 anisotropicT;vec3 anisotropicB;float anisotropyStrength;};\n#if defined(X3D_MATERIAL_SPECULAR_GLOSSINESS)\n#if defined(X3D_DIFFUSE_TEXTURE)\nuniform x3d_DiffuseTextureParameters x3d_DiffuseTexture;\n#endif\n#elif defined(X3D_MATERIAL_METALLIC_ROUGHNESS)\n#if defined(X3D_BASE_TEXTURE)\nuniform x3d_BaseTextureParameters x3d_BaseTexture;\n#endif\n#endif\nvec4 getBaseColor(){float alpha=1.0-x3d_Material.transparency;\n#if defined(X3D_MATERIAL_SPECULAR_GLOSSINESS)\nvec4 baseColor=vec4(x3d_Material.diffuseColor,alpha);\n#elif defined(X3D_MATERIAL_METALLIC_ROUGHNESS)\nvec4 baseColor=vec4(x3d_Material.baseColor,alpha);\n#endif\n#if defined(X3D_COLOR_MATERIAL)\nbaseColor*=color;\n#endif\n#if defined(X3D_MATERIAL_SPECULAR_GLOSSINESS)\n#if defined(X3D_DIFFUSE_TEXTURE)\nvec3 texCoord=getTexCoord(x3d_DiffuseTexture.textureTransformMapping,x3d_DiffuseTexture.textureCoordinateMapping);\n#if defined(X3D_DIFFUSE_TEXTURE_FLIP_Y)\ntexCoord.t=1.0-texCoord.t;\n#endif\n#if defined(X3D_DIFFUSE_TEXTURE_2D)\nvec4 textureColor=texture2D(x3d_DiffuseTexture.texture2D,texCoord.st);\n#elif defined(X3D_DIFFUSE_TEXTURE_CUBE)\nvec4 textureColor=textureCube(x3d_DiffuseTexture.textureCube,texCoord);\n#endif\n#if defined(X3D_BASE_TEXTURE_LINEAR)\nbaseColor*=textureColor;\n#else\nbaseColor*=sRGBToLinear(textureColor);\n#endif\n#elif defined(X3D_TEXTURE)\nbaseColor=getTextureColor(baseColor,vec4(vec3(1.0),alpha));\n#endif\n#elif defined(X3D_MATERIAL_METALLIC_ROUGHNESS)\n#if defined(X3D_BASE_TEXTURE)\nvec3 texCoord=getTexCoord(x3d_BaseTexture.textureTransformMapping,x3d_BaseTexture.textureCoordinateMapping);\n#if defined(X3D_BASE_TEXTURE_FLIP_Y)\ntexCoord.t=1.0-texCoord.t;\n#endif\n#if defined(X3D_BASE_TEXTURE_2D)\nvec4 textureColor=texture2D(x3d_BaseTexture.texture2D,texCoord.st);\n#elif defined(X3D_BASE_TEXTURE_CUBE)\nvec4 textureColor=textureCube(x3d_BaseTexture.textureCube,texCoord);\n#endif\n#if defined(X3D_BASE_TEXTURE_LINEAR)\nbaseColor*=textureColor;\n#else\nbaseColor*=sRGBToLinear(textureColor);\n#endif\n#elif defined(X3D_TEXTURE)\nbaseColor=getTextureColor(baseColor,vec4(vec3(1.0),alpha));\n#endif\n#endif\nreturn baseColor;}\n#if defined(X3D_MATERIAL_METALLIC_ROUGHNESS)\n#if defined(X3D_METALLIC_ROUGHNESS_TEXTURE)\nuniform x3d_MetallicRoughnessTextureParameters x3d_MetallicRoughnessTexture;\n#endif\nMaterialInfo getMetallicRoughnessInfo(in MaterialInfo info){info.metallic=x3d_Material.metallic;info.perceptualRoughness=x3d_Material.roughness;\n#if defined(X3D_METALLIC_ROUGHNESS_TEXTURE)\nvec3 texCoord=getTexCoord(x3d_MetallicRoughnessTexture.textureTransformMapping,x3d_MetallicRoughnessTexture.textureCoordinateMapping);\n#if defined(X3D_METALLIC_ROUGHNESS_TEXTURE_FLIP_Y)\ntexCoord.t=1.0-texCoord.t;\n#endif\n#if defined(X3D_METALLIC_ROUGHNESS_TEXTURE_2D)\nvec4 mrSample=texture2D(x3d_MetallicRoughnessTexture.texture2D,texCoord.st);\n#elif defined(X3D_METALLIC_ROUGHNESS_TEXTURE_CUBE)\nvec4 mrSample=textureCube(x3d_MetallicRoughnessTexture.textureCube,texCoord);\n#endif\ninfo.metallic*=mrSample.b;info.perceptualRoughness*=mrSample.g;\n#endif\ninfo.c_diff=mix(info.baseColor.rgb,vec3(0.0),info.metallic);info.f0=mix(info.f0,info.baseColor.rgb,info.metallic);return info;}\n#endif\n#if defined(X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\nvec3 getEmissiveColor(){vec3 emissiveColor=x3d_Material.emissiveColor;\n#if defined(X3D_EMISSIVE_TEXTURE)\nvec3 texCoord=getTexCoord(x3d_EmissiveTexture.textureTransformMapping,x3d_EmissiveTexture.textureCoordinateMapping);\n#if defined(X3D_EMISSIVE_TEXTURE_FLIP_Y)\ntexCoord.t=1.0-texCoord.t;\n#endif\n#if defined(X3D_EMISSIVE_TEXTURE_2D)\nvec3 textureColor=texture2D(x3d_EmissiveTexture.texture2D,texCoord.st).rgb;\n#elif defined(X3D_EMISSIVE_TEXTURE_CUBE)\nvec3 textureColor=textureCube(x3d_EmissiveTexture.textureCube,texCoord).rgb;\n#endif\n#if defined(X3D_EMISSIVE_TEXTURE_LINEAR)\nemissiveColor*=textureColor;\n#else\nemissiveColor*=sRGBToLinear(textureColor);\n#endif\n#endif\nreturn emissiveColor;}\n#if defined(X3D_OCCLUSION_TEXTURE)\nuniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n#endif\nfloat getOcclusionFactor(){\n#if defined(X3D_OCCLUSION_TEXTURE)\nvec3 texCoord=getTexCoord(x3d_OcclusionTexture.textureTransformMapping,x3d_OcclusionTexture.textureCoordinateMapping);\n#if defined(X3D_OCCLUSION_TEXTURE_FLIP_Y)\ntexCoord.t=1.0-texCoord.t;\n#endif\n#if defined(X3D_OCCLUSION_TEXTURE_2D)\nreturn texture2D(x3d_OcclusionTexture.texture2D,texCoord.st).r;\n#elif defined(X3D_OCCLUSION_TEXTURE_CUBE)\nreturn textureCube(x3d_OcclusionTexture.textureCube,texCoord).r;\n#endif\n#else\nreturn 1.0;\n#endif\n}";i.add("MaterialInfo1.glsl","assets/shaders/webgl1/pbr/MaterialInfo1.glsl",Nw);const Iw=Nw,Fw="const float exposure=1.0;const float GAMMA=2.2;const float INV_GAMMA=1.0/GAMMA;vec3 linearTosRGB(const in vec3 color){return pow(color,vec3(INV_GAMMA));}vec4 linearTosRGB(const in vec4 color){return vec4(linearTosRGB(color.rgb),color.a);}vec3 sRGBToLinear(const in vec3 color){return pow(color,vec3(GAMMA));}vec4 sRGBToLinear(const in vec4 color){return vec4(sRGBToLinear(color.rgb),color.a);}\n#if defined(X3D_TONEMAP_ACES_NARKOWICZ)\nvec3 toneMapACES_Narkowicz(const in vec3 color){const float A=2.51;const float B=0.03;const float C=2.43;const float D=0.59;const float E=0.14;return clamp((color*(A*color+B))/(color*(C*color+D)+E),0.0,1.0);}\n#endif\n#if defined(X3D_TONEMAP_ACES_HILL)||defined(X3D_TONEMAP_ACES_HILL_EXPOSURE_BOOST)\nconst mat3 ACESInputMat=mat3(0.59719,0.07600,0.02840,0.35458,0.90834,0.13383,0.04823,0.01566,0.83777);const mat3 ACESOutputMat=mat3(1.60475,-0.10208,-0.00327,-0.53108,1.10813,-0.07276,-0.07367,-0.00605,1.07602);vec3 RRTAndODTFit(const in vec3 color){vec3 a=color*(color+0.0245786)-0.000090537;vec3 b=color*(0.983729*color+0.4329510)+0.238081;return a/b;}vec3 toneMapACES_Hill(in vec3 color){color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=clamp(color,0.0,1.0);return color;}\n#endif\nvec3 toneMap(in vec3 color){color*=exposure;\n#if defined(X3D_TONEMAP_ACES_NARKOWICZ)\ncolor=toneMapACES_Narkowicz(color);\n#endif\n#if defined(X3D_TONEMAP_ACES_HILL)\ncolor=toneMapACES_Hill(color);\n#endif\n#if defined(X3D_TONEMAP_ACES_HILL_EXPOSURE_BOOST)\ncolor/=0.6;color=toneMapACES_Hill(color);\n#endif\nreturn linearTosRGB(color);}";i.add("ToneMapping1.glsl","assets/shaders/webgl1/pbr/ToneMapping1.glsl",Fw);const Mw=Fw,Dw="#if defined(X3D_LIGHTING)\nconst float M_PI=3.1415926535897932384626433832795;vec3 F_Schlick(vec3 f0,vec3 f90,float VdotH){return f0+(f90-f0)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}float V_GGX(float NdotL,float NdotV,float alphaRoughness){float alphaRoughnessSq=alphaRoughness*alphaRoughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-alphaRoughnessSq)+alphaRoughnessSq);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-alphaRoughnessSq)+alphaRoughnessSq);float GGX=GGXV+GGXL;if(GGX>0.0){return 0.5/GGX;}return 0.0;}float D_GGX(float NdotH,float alphaRoughness){float alphaRoughnessSq=alphaRoughness*alphaRoughness;float f=(NdotH*NdotH)*(alphaRoughnessSq-1.0)+1.0;return alphaRoughnessSq/(M_PI*f*f);}vec3 BRDF_lambertian(vec3 f0,vec3 f90,vec3 diffuseColor,float specularWeight,float VdotH){return(1.0-specularWeight*F_Schlick(f0,f90,VdotH))*(diffuseColor/M_PI);}vec3 BRDF_specularGGX(vec3 f0,vec3 f90,float alphaRoughness,float specularWeight,float VdotH,float NdotL,float NdotV,float NdotH){vec3 F=F_Schlick(f0,f90,VdotH);float Vis=V_GGX(NdotL,NdotV,alphaRoughness);float D=D_GGX(NdotH,alphaRoughness);return specularWeight*F*Vis*D;}\n#endif\n";i.add("BDRF2.glsl","assets/shaders/webgl2/pbr/BDRF2.glsl",Dw);const Rw=Dw,Pw="#if defined(X3D_USE_IBL)\nuniform x3d_EnvironmentLightSourceParameters x3d_EnvironmentLightSource;vec3 getDiffuseLight(const in vec3 n){vec3 textureColor=texture(x3d_EnvironmentLightSource.diffuseTexture,x3d_EnvironmentLightSource.rotation*n).rgb;if(!x3d_EnvironmentLightSource.diffuseTextureLinear)textureColor=sRGBToLinear(textureColor);return textureColor*x3d_EnvironmentLightSource.color*x3d_EnvironmentLightSource.intensity;}vec3 getSpecularLight(const in vec3 reflection,const in float lod){vec3 textureColor=textureLod(x3d_EnvironmentLightSource.specularTexture,x3d_EnvironmentLightSource.rotation*reflection,lod).rgb;if(!x3d_EnvironmentLightSource.specularTextureLinear)textureColor=sRGBToLinear(textureColor);return textureColor*x3d_EnvironmentLightSource.color*x3d_EnvironmentLightSource.intensity;}vec3 getIBLRadianceGGX(const in vec3 n,const in vec3 v,const in float roughness,const in vec3 F0,const in float specularWeight){float NdotV=clamp(dot(n,v),0.0,1.0);float lod=roughness*float(x3d_EnvironmentLightSource.specularTextureLevels-1);vec3 reflection=normalize(reflect(-v,n));vec2 brdfSamplePoint=clamp(vec2(NdotV,roughness),vec2(0.0),vec2(1.0));vec2 f_ab=texture(x3d_EnvironmentLightSource.GGXLUTTexture,brdfSamplePoint).rg;vec3 specularLight=getSpecularLight(reflection,lod);vec3 Fr=max(vec3(1.0-roughness),F0)-F0;vec3 k_S=F0+Fr*pow(1.0-NdotV,5.0);vec3 FssEss=k_S*f_ab.x+f_ab.y;return specularWeight*specularLight*FssEss;}vec3 getIBLRadianceLambertian(const in vec3 n,const in vec3 v,const in float roughness,const in vec3 diffuseColor,const in vec3 F0,const in float specularWeight){float NdotV=clamp(dot(n,v),0.0,1.0);vec2 brdfSamplePoint=clamp(vec2(NdotV,roughness),vec2(0.0),vec2(1.0));vec2 f_ab=texture(x3d_EnvironmentLightSource.GGXLUTTexture,brdfSamplePoint).rg;vec3 irradiance=getDiffuseLight(n);vec3 Fr=max(vec3(1.0-roughness),F0)-F0;vec3 k_S=F0+Fr*pow(1.0-NdotV,5.0);vec3 FssEss=specularWeight*k_S*f_ab.x+f_ab.y;float Ems=(1.0-(f_ab.x+f_ab.y));vec3 F_avg=specularWeight*(F0+(1.0-F0)/21.0);vec3 FmsEms=Ems*FssEss*F_avg/(1.0-F_avg*Ems);vec3 k_D=diffuseColor*(1.0-FssEss+FmsEms);return(FmsEms+k_D)*irradiance;}\n#endif\n";i.add("IBL2.glsl","assets/shaders/webgl2/pbr/IBL2.glsl",Pw);const Aw=Pw,Vw='#if defined(X3D_LIGHTING)\n#pragma X3D include "../common/Lighting.glsl"\nvec3 getLightIntensity(const in x3d_LightSourceParameters light,const in vec3 pointToLight,const in float distanceToLight){float attenuationFactor=1.0;float spotFactor=1.0;if(light.type!=x3d_DirectionalLight){attenuationFactor=getAttenuation(light.attenuation,distanceToLight);}if(light.type==x3d_SpotLight){spotFactor=getSpotFactor(pointToLight,light.direction,light.cutOffAngle,light.beamWidth);}return attenuationFactor*spotFactor*light.intensity*light.color;}\n#endif\n';i.add("Punctual2.glsl","assets/shaders/webgl2/pbr/Punctual2.glsl",Vw);const Lw=Vw,Bw="struct MaterialInfo{float ior;float perceptualRoughness;vec3 f0;float alphaRoughness;vec3 c_diff;vec3 f90;float metallic;vec3 baseColor;float sheenRoughnessFactor;vec3 sheenColorFactor;vec3 clearcoatF0;vec3 clearcoatF90;float clearcoatFactor;vec3 clearcoatNormal;float clearcoatRoughness;float specularWeight;float transmissionFactor;float thickness;vec3 attenuationColor;float attenuationDistance;float iridescenceFactor;float iridescenceIor;float iridescenceThickness;vec3 anisotropicT;vec3 anisotropicB;float anisotropyStrength;};\n#if defined(X3D_MATERIAL_SPECULAR_GLOSSINESS)\n#if defined(X3D_DIFFUSE_TEXTURE)\nuniform x3d_DiffuseTextureParameters x3d_DiffuseTexture;\n#endif\n#elif defined(X3D_MATERIAL_METALLIC_ROUGHNESS)\n#if defined(X3D_BASE_TEXTURE)\nuniform x3d_BaseTextureParameters x3d_BaseTexture;\n#endif\n#endif\nvec4 getBaseColor(){float alpha=1.0-x3d_Material.transparency;\n#if defined(X3D_MATERIAL_SPECULAR_GLOSSINESS)\nvec4 baseColor=vec4(x3d_Material.diffuseColor,alpha);\n#elif defined(X3D_MATERIAL_METALLIC_ROUGHNESS)\nvec4 baseColor=vec4(x3d_Material.baseColor,alpha);\n#endif\n#if defined(X3D_COLOR_MATERIAL)\nbaseColor*=color;\n#endif\n#if defined(X3D_MATERIAL_SPECULAR_GLOSSINESS)\n#if defined(X3D_DIFFUSE_TEXTURE)\nvec3 texCoord=getTexCoord(x3d_DiffuseTexture.textureTransformMapping,x3d_DiffuseTexture.textureCoordinateMapping);\n#if defined(X3D_DIFFUSE_TEXTURE_FLIP_Y)\ntexCoord.t=1.0-texCoord.t;\n#endif\n#if defined(X3D_DIFFUSE_TEXTURE_2D)\nvec4 textureColor=texture(x3d_DiffuseTexture.texture2D,texCoord.st);\n#elif defined(X3D_DIFFUSE_TEXTURE_3D)\nvec4 textureColor=texture(x3d_DiffuseTexture.texture3D,texCoord);\n#elif defined(X3D_DIFFUSE_TEXTURE_CUBE)\nvec4 textureColor=texture(x3d_DiffuseTexture.textureCube,texCoord);\n#endif\n#if defined(X3D_BASE_TEXTURE_LINEAR)\nbaseColor*=textureColor;\n#else\nbaseColor*=sRGBToLinear(textureColor);\n#endif\n#elif defined(X3D_TEXTURE)\nbaseColor=getTextureColor(baseColor,vec4(vec3(1.0),alpha));\n#endif\n#elif defined(X3D_MATERIAL_METALLIC_ROUGHNESS)\n#if defined(X3D_BASE_TEXTURE)\nvec3 texCoord=getTexCoord(x3d_BaseTexture.textureTransformMapping,x3d_BaseTexture.textureCoordinateMapping);\n#if defined(X3D_BASE_TEXTURE_FLIP_Y)\ntexCoord.t=1.0-texCoord.t;\n#endif\n#if defined(X3D_BASE_TEXTURE_2D)\nvec4 textureColor=texture(x3d_BaseTexture.texture2D,texCoord.st);\n#elif defined(X3D_BASE_TEXTURE_3D)\nvec4 textureColor=texture(x3d_BaseTexture.texture3D,texCoord);\n#elif defined(X3D_BASE_TEXTURE_CUBE)\nvec4 textureColor=texture(x3d_BaseTexture.textureCube,texCoord);\n#endif\n#if defined(X3D_BASE_TEXTURE_LINEAR)\nbaseColor*=textureColor;\n#else\nbaseColor*=sRGBToLinear(textureColor);\n#endif\n#elif defined(X3D_TEXTURE)\nbaseColor=getTextureColor(baseColor,vec4(vec3(1.0),alpha));\n#endif\n#endif\nreturn baseColor;}\n#if defined(X3D_MATERIAL_METALLIC_ROUGHNESS)\n#if defined(X3D_METALLIC_ROUGHNESS_TEXTURE)\nuniform x3d_MetallicRoughnessTextureParameters x3d_MetallicRoughnessTexture;\n#endif\nMaterialInfo getMetallicRoughnessInfo(in MaterialInfo info){info.metallic=x3d_Material.metallic;info.perceptualRoughness=x3d_Material.roughness;\n#if defined(X3D_METALLIC_ROUGHNESS_TEXTURE)\nvec3 texCoord=getTexCoord(x3d_MetallicRoughnessTexture.textureTransformMapping,x3d_MetallicRoughnessTexture.textureCoordinateMapping);\n#if defined(X3D_METALLIC_ROUGHNESS_TEXTURE_FLIP_Y)\ntexCoord.t=1.0-texCoord.t;\n#endif\n#if defined(X3D_METALLIC_ROUGHNESS_TEXTURE_2D)\nvec4 mrSample=texture(x3d_MetallicRoughnessTexture.texture2D,texCoord.st);\n#elif defined(X3D_METALLIC_ROUGHNESS_TEXTURE_3D)\nvec4 mrSample=texture(x3d_MetallicRoughnessTexture.texture3D,texCoord);\n#elif defined(X3D_METALLIC_ROUGHNESS_TEXTURE_CUBE)\nvec4 mrSample=texture(x3d_MetallicRoughnessTexture.textureCube,texCoord);\n#endif\ninfo.metallic*=mrSample.b;info.perceptualRoughness*=mrSample.g;\n#endif\ninfo.c_diff=mix(info.baseColor.rgb,vec3(0.0),info.metallic);info.f0=mix(info.f0,info.baseColor.rgb,info.metallic);return info;}\n#endif\n#if defined(X3D_EMISSIVE_TEXTURE)\nuniform x3d_EmissiveTextureParameters x3d_EmissiveTexture;\n#endif\nvec3 getEmissiveColor(){vec3 emissiveColor=x3d_Material.emissiveColor;\n#if defined(X3D_EMISSIVE_TEXTURE)\nvec3 texCoord=getTexCoord(x3d_EmissiveTexture.textureTransformMapping,x3d_EmissiveTexture.textureCoordinateMapping);\n#if defined(X3D_EMISSIVE_TEXTURE_FLIP_Y)\ntexCoord.t=1.0-texCoord.t;\n#endif\n#if defined(X3D_EMISSIVE_TEXTURE_2D)\nvec3 textureColor=texture(x3d_EmissiveTexture.texture2D,texCoord.st).rgb;\n#elif defined(X3D_EMISSIVE_TEXTURE_3D)\nvec3 textureColor=texture(x3d_EmissiveTexture.texture3D,texCoord).rgb;\n#elif defined(X3D_EMISSIVE_TEXTURE_CUBE)\nvec3 textureColor=texture(x3d_EmissiveTexture.textureCube,texCoord).rgb;\n#endif\n#if defined(X3D_EMISSIVE_TEXTURE_LINEAR)\nemissiveColor*=textureColor;\n#else\nemissiveColor*=sRGBToLinear(textureColor);\n#endif\n#endif\nreturn emissiveColor;}\n#if defined(X3D_OCCLUSION_TEXTURE)\nuniform x3d_OcclusionTextureParameters x3d_OcclusionTexture;\n#endif\nfloat getOcclusionFactor(){\n#if defined(X3D_OCCLUSION_TEXTURE)\nvec3 texCoord=getTexCoord(x3d_OcclusionTexture.textureTransformMapping,x3d_OcclusionTexture.textureCoordinateMapping);\n#if defined(X3D_OCCLUSION_TEXTURE_FLIP_Y)\ntexCoord.t=1.0-texCoord.t;\n#endif\n#if defined(X3D_OCCLUSION_TEXTURE_2D)\nreturn texture(x3d_OcclusionTexture.texture2D,texCoord.st).r;\n#elif defined(X3D_OCCLUSION_TEXTURE_3D)\nreturn texture(x3d_OcclusionTexture.texture3D,texCoord).r;\n#elif defined(X3D_OCCLUSION_TEXTURE_CUBE)\nreturn texture(x3d_OcclusionTexture.textureCube,texCoord).r;\n#endif\n#else\nreturn 1.0;\n#endif\n}";i.add("MaterialInfo2.glsl","assets/shaders/webgl2/pbr/MaterialInfo2.glsl",Bw);const Uw=Bw,Xw="const float exposure=1.0;const float GAMMA=2.2;const float INV_GAMMA=1.0/GAMMA;vec3 linearTosRGB(const in vec3 color){return pow(color,vec3(INV_GAMMA));}vec4 linearTosRGB(const in vec4 color){return vec4(linearTosRGB(color.rgb),color.a);}vec3 sRGBToLinear(const in vec3 color){return pow(color,vec3(GAMMA));}vec4 sRGBToLinear(const in vec4 color){return vec4(sRGBToLinear(color.rgb),color.a);}\n#if defined(X3D_TONEMAP_ACES_NARKOWICZ)\nvec3 toneMapACES_Narkowicz(const in vec3 color){const float A=2.51;const float B=0.03;const float C=2.43;const float D=0.59;const float E=0.14;return clamp((color*(A*color+B))/(color*(C*color+D)+E),0.0,1.0);}\n#endif\n#if defined(X3D_TONEMAP_ACES_HILL)||defined(X3D_TONEMAP_ACES_HILL_EXPOSURE_BOOST)\nconst mat3 ACESInputMat=mat3(0.59719,0.07600,0.02840,0.35458,0.90834,0.13383,0.04823,0.01566,0.83777);const mat3 ACESOutputMat=mat3(1.60475,-0.10208,-0.00327,-0.53108,1.10813,-0.07276,-0.07367,-0.00605,1.07602);vec3 RRTAndODTFit(const in vec3 color){vec3 a=color*(color+0.0245786)-0.000090537;vec3 b=color*(0.983729*color+0.4329510)+0.238081;return a/b;}vec3 toneMapACES_Hill(in vec3 color){color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=clamp(color,0.0,1.0);return color;}\n#endif\nvec3 toneMap(in vec3 color){color*=exposure;\n#if defined(X3D_TONEMAP_ACES_NARKOWICZ)\ncolor=toneMapACES_Narkowicz(color);\n#endif\n#if defined(X3D_TONEMAP_ACES_HILL)\ncolor=toneMapACES_Hill(color);\n#endif\n#if defined(X3D_TONEMAP_ACES_HILL_EXPOSURE_BOOST)\ncolor/=0.6;color=toneMapACES_Hill(color);\n#endif\nreturn linearTosRGB(color);}";i.add("ToneMapping2.glsl","assets/shaders/webgl2/pbr/ToneMapping2.glsl",Xw);const jw={includes:{1:{ClipPlanes:yx,Fog:bx,Fragment:Tx,Hatch:Ox,Lighting:Cx,Material:Ix,Normal:Mx,Perlin:Rx,Point:Ax,PointSize:Lx,Shadow:Ux,Texture:jx,Vertex:zx,BDRF:Tw,IBL:Ow,MaterialInfo:Iw,Punctual:Cw,ToneMapping:Mw},2:{ClipPlanes:Hx,Fog:Yx,Fragment:$x,Hatch:Kx,Lighting:Qx,Line2:ty,Material:ny,Normal:sy,Particle:ay,Perlin:uy,Point:dy,PointSize:py,Shadow:fy,Skin:_y,Stipple:yy,Texture:by,Utils:Ty,Vertex:Oy,BDRF:Rw,IBL:Aw,MaterialInfo:Uw,Punctual:Lw,ToneMapping:Xw}},vertex:{1:{Default:Iy,Depth:Ry,FullScreen:Cy,Gouraud:Ly,Pointing:Hy},2:{Default:Ky,Depth:tw,FullScreen:$y,Gouraud:sw,LineTransform:uw,Pointing:yw}},fragment:{1:{Depth:My,Gouraud:Ay,PBR:Uy,Phong:jy,Pointing:zy,Unlit:Yy},2:{Depth:Qy,Gouraud:nw,LineTransform:aw,OITCompose:dw,PBR:pw,Phong:fw,Pointing:_w,Unlit:bw}}};i.add("ShaderRegistry","x_ite/Browser/Shaders/ShaderRegistry",jw);const kw=jw,zw=/^\s*#pragma\s+X3D\s+include\s+".*?([^\/]+)\.glsl"\s*$/;function Gw(e){this.includes=kw.includes[e.getVersion()],this.sourceFileNumbers={};for(const[e,t]of Object.getOwnPropertyNames(this.includes).entries())this.sourceFileNumbers[t]=e+1}Object.assign(Gw.prototype,{getSourceFileName(e){return Object.getOwnPropertyNames(this.includes)[e-1]},process(e,t=0){const i=e.split("\n");e="";for(let n=0,r=i.length;n<r;++n){const r=i[n],s=r.match(zw);s?(e+="#line 1 "+this.sourceFileNumbers[s[1]]+"\n",e+=this.process(this.includes[s[1]],this.sourceFileNumbers[s[1]]),e+="\n",e+="#line "+(n+2)+" "+t+"\n"):(e+=r,e+="\n")}return e}});const Hw=Gw;i.add("ShaderCompiler","x_ite/Browser/Shaders/ShaderCompiler",Hw);const qw=Hw;var Yw=n(328);const Ww=["X3D_GEOMETRY_0D","X3D_GEOMETRY_1D","X3D_GEOMETRY_2D","X3D_GEOMETRY_3D","X3D_FOG","X3D_STYLE_PROPERTIES","X3D_UNLIT_MATERIAL","X3D_MATERIAL","X3D_LIGHTING","X3D_TEXTURE","X3D_MULTI_TEXTURING"];function $w(e){Sr.call(this,e),Ts.call(this,e),this.addType(d.ShaderPart),this.options=[]}Object.assign(Object.setPrototypeOf($w.prototype,Sr.prototype),Ts.prototype,{initialize(){Sr.prototype.initialize.call(this),Ts.prototype.initialize.call(this),this.isPrivate()||(this.options=Ww.slice()),this._type.addInterest("set_type__",this),this.requestImmediateLoad().catch(Function.prototype)},set_type__(){this.setLoadState(d.NOT_STARTED_STATE),this.requestImmediateLoad().catch(Function.prototype)},getSourceText(){return this._url},getOptions(){return this.options},setOptions(e){this.options=e},getShader(){return this.shader},getShaderType:(()=>{const e=new Map([["VERTEX","VERTEX_SHADER"],["TESS_CONTROL","TESS_CONTROL_SHADER"],["TESS_EVALUATION","TESS_EVALUATION_SHADER"],["GEOMETRY","GEOMETRY_SHADER"],["FRAGMENT","FRAGMENT_SHADER"],["COMPUTE","COMPUTE_SHADER"]]);return function(){return e.get(this._type.getValue())||"VERTEX_SHADER"}})(),unloadData(){this.valid=!1},loadData(){new hh(this).loadDocument(this._url,function(e,t){if(null===e)this.setLoadState(d.FAILED_STATE);else{const i=this.getBrowser(),n=i.getContext(),r=this.getShaderType(),s=["X3D_"+r].concat(this.options),o=new qw(n),a=_x.getSource(n,i,o.process(Yw.decodeText(e)),s),l=n.createShader(n[r]);if(n.deleteShader(this.shader),this.shader=l,n.shaderSource(l,a),n.compileShader(l),!n.getShaderParameter(l,n.COMPILE_STATUS)){const e=this.getTypeName(),i=this.getName(),r=n.getShaderInfoLog(l),s=r.match(/(\d+):(\d+)/);if(s){const n=o.getSourceFileName(s[1])||t||this.getExecutionContext().getWorldURL();throw new Error("Error in "+e+" '"+i+"' in URL '"+n+"', line "+s[2]+", "+r)}{const n=t||this.getExecutionContext().getWorldURL();throw new Error("Error in "+e+" '"+i+"' in URL '"+n+"', "+r)}}this.setLoadState(d.COMPLETE_STATE)}}.bind(this))},dispose(){Ts.prototype.dispose.call(this),Sr.prototype.dispose.call(this)}}),Object.defineProperties($w,{typeName:{value:"ShaderPart",enumerable:!0},componentInfo:{value:Object.freeze({name:"Shaders",level:1}),enumerable:!0},containerField:{value:"parts",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.initializeOnly,"type",new $n.SFString("VERTEX")),new k(d.inputOutput,"load",new $n.SFBool(!0)),new k(d.inputOutput,"url",new $n.MFString),new k(d.inputOutput,"autoRefresh",new $n.SFTime),new k(d.inputOutput,"autoRefreshTimeLimit",new $n.SFTime(3600))]),enumerable:!0}});const Jw=$w;i.add("ShaderPart","x_ite/Components/Shaders/ShaderPart",Jw);const Kw=Jw;function Zw(e){Sr.call(this,e),Ts.call(this,e),P_.call(this,e),this.addType(d.ShaderProgram)}Object.assign(Object.setPrototypeOf(Zw.prototype,Sr.prototype),Ts.prototype,P_.prototype,{getSourceText(){return this._url},requestImmediateLoad(e=!0){},initialize(){Sr.prototype.initialize.call(this),Ts.prototype.initialize.call(this),P_.prototype.initialize.call(this)},dispose(){P_.prototype.dispose.call(this),Ts.prototype.dispose.call(this),Sr.prototype.dispose.call(this)}}),Object.defineProperties(Zw,{typeName:{value:"ShaderProgram",enumerable:!0},componentInfo:{value:Object.freeze({name:"Shaders",level:1}),enumerable:!0},containerField:{value:"programs",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.initializeOnly,"type",new $n.SFString("VERTEX")),new k(d.inputOutput,"load",new $n.SFBool(!0)),new k(d.inputOutput,"url",new $n.MFString),new k(d.inputOutput,"autoRefresh",new $n.SFTime),new k(d.inputOutput,"autoRefreshTimeLimit",new $n.SFTime(3600))]),enumerable:!0}});const Qw=Zw;i.add("ShaderProgram","x_ite/Components/Shaders/ShaderProgram",Qw);const eb={name:"Shaders",concreteNodes:[L_,z_,q_,$_,Z_,tx,Kw,Qw],abstractNodes:[P_,I_,X_]};i.add("Shaders","x_ite/Components/Shaders",eb);const tb=eb;function ib(e){kl.call(this,e),this.addType(d.AcousticProperties)}Object.setPrototypeOf(ib.prototype,kl.prototype),Object.defineProperties(ib,{typeName:{value:"AcousticProperties",enumerable:!0},componentInfo:{value:Object.freeze({name:"Shape",level:5}),enumerable:!0},containerField:{value:"acousticProperties",enumerable:!0},specificationRange:{value:Object.freeze({from:"4.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"diffuse",new $n.SFFloat),new k(d.inputOutput,"specular",new $n.SFFloat),new k(d.inputOutput,"refraction",new $n.SFFloat),new k(d.inputOutput,"absorption",new $n.SFFloat)]),enumerable:!0}});const nb=ib;i.add("AcousticProperties","x_ite/Components/Shape/AcousticProperties",nb);const rb=nb;function sb(e){Sr.call(this,e),this.addType(d.X3DAppearanceNode),this.addChildObjects(d.outputOnly,"transparent",new $n.SFBool)}Object.assign(Object.setPrototypeOf(sb.prototype,Sr.prototype),{setTransparent(e){e!==this._transparent.getValue()&&(this._transparent=e)},isTransparent(){return this._transparent.getValue()}}),Object.defineProperties(sb,{typeName:{value:"X3DAppearanceNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Shape",level:1}),enumerable:!0}});const ob=sb;i.add("X3DAppearanceNode","x_ite/Components/Shape/X3DAppearanceNode",ob);const ab=ob;var lb=n(328);function ub(e){ab.call(this,e),this.addType(d.Appearance),this.stylePropertiesNode=[],this.textureTransformMapping=new Map,this.textureBits=new Ya,this.shaderNodes=[],this.renderModeNodes=[]}Object.assign(Object.setPrototypeOf(ub.prototype,ab.prototype),{initialize(){ab.prototype.initialize.call(this);this.getBrowser().getRenderingProperties()._ContentScale.addInterest("set_contentScale__",this),this._alphaMode.addInterest("set_alphaMode__",this),this._alphaCutoff.addInterest("set_alphaCutoff__",this),this._pointProperties.addInterest("set_pointProperties__",this),this._lineProperties.addInterest("set_lineProperties__",this),this._fillProperties.addInterest("set_fillProperties__",this),this._material.addInterest("set_material__",this),this._backMaterial.addInterest("set_backMaterial__",this),this._texture.addInterest("set_texture__",this),this._textureTransform.addInterest("set_textureTransform__",this),this._shaders.addInterest("set_shaders__",this),this._blendMode.addInterest("set_renderModes__",this),this._depthMode.addInterest("set_renderModes__",this),this._alphaMode.addInterest("set_transparent__",this),this._fillProperties.addInterest("set_transparent__",this),this._material.addInterest("set_transparent__",this),this._texture.addInterest("set_transparent__",this),this._blendMode.addInterest("set_transparent__",this),this.set_alphaMode__(),this.set_pointProperties__(),this.set_lineProperties__(),this.set_fillProperties__(),this.set_material__(),this.set_backMaterial__(),this.set_texture__(),this.set_textureTransform__(),this.set_shaders__(),this.set_renderModes__(),this.set_transparent__()},getAlphaMode(){return this.alphaMode},getAlphaCutoff(){return this.alphaCutoff},getStyleProperties(e){return this.stylePropertiesNode[e]},getPointProperties(){return this.stylePropertiesNode[0]},getLineProperties(){return this.stylePropertiesNode[1]},getFillProperties(){return this.stylePropertiesNode[2]},getMaterial(){return this.materialNode},getBackMaterial(){return this.backMaterialNode},getTexture(){return this.textureNode},getTextureBits(){return this.textureBits},updateTextureBits(){this.textureBits.clear(),this.textureNode.updateTextureBits(this.textureBits)},getTextureTransform(){return this.textureTransformNode},getTextureTransformMapping(){return this.textureTransformMapping},getShader(e,t){return this.materialNode.getShader(e,t)},getBackShader(e,t){return this.backMaterialNode.getShader(e,t)},getRenderModes(){return this.renderModeNodes},getDepthMode(){return this.depthModeNode},set_contentScale__(){this.set_pointProperties__(),this.set_applied__()},set_alphaMode__(){this.alphaMode=lb.enum(Dl,this._alphaMode.getValue(),Dl.AUTO),this.set_alphaCutoff__()},set_alphaCutoff__(){this.alphaCutoff=this.alphaMode===Dl.MASK?this._alphaCutoff.getValue():0},set_pointProperties__(){if(this.stylePropertiesNode[0]=Yl(d.PointProperties,this._pointProperties),!this.stylePropertiesNode[0]){const e=this.getBrowser();1!==e.getRenderingProperty("ContentScale")&&(this.stylePropertiesNode[0]=e.getDefaultPointProperties())}},set_lineProperties__(){this.linePropertiesNode&&this.linePropertiesNode._applied.removeInterest("set_applied__",this),this.linePropertiesNode=Yl(d.LineProperties,this._lineProperties),this.linePropertiesNode&&this.linePropertiesNode._applied.addInterest("set_applied__",this),this.set_applied__()},set_applied__(){if(this.linePropertiesNode&&this.linePropertiesNode._applied.getValue())this.stylePropertiesNode[1]=this.linePropertiesNode;else{const e=this.getBrowser();1!==e.getRenderingProperty("ContentScale")?this.stylePropertiesNode[1]=e.getDefaultLineProperties():this.stylePropertiesNode[1]=null}},set_fillProperties__(){this.stylePropertiesNode[2]&&this.stylePropertiesNode[2]._transparent.removeInterest("set_transparent__",this),this.stylePropertiesNode[2]=Yl(d.FillProperties,this._fillProperties),this.stylePropertiesNode[2]&&this.stylePropertiesNode[2]._transparent.addInterest("set_transparent__",this),this.stylePropertiesNode[3]=this.stylePropertiesNode[2]},set_material__(){this.materialNode&&this.materialNode._transparent.removeInterest("set_transparent__",this),this.materialNode=Yl(d.X3DMaterialNode,this._material),this.materialNode||(this.materialNode=this.getBrowser().getDefaultMaterial()),this.materialNode&&this.materialNode._transparent.addInterest("set_transparent__",this),Yl(d.TwoSidedMaterial,this.materialNode)&&this.set_backMaterial__()},set_backMaterial__(){this.backMaterialNode&&this.backMaterialNode._transparent.removeInterest("set_transparent__",this),this.backMaterialNode=Yl(d.X3DOneSidedMaterialNode,this._backMaterial),this.backMaterialNode&&this.backMaterialNode._transparent.addInterest("set_transparent__",this),!this.backMaterialNode&&Yl(d.TwoSidedMaterial,this.materialNode)&&(this.backMaterialNode=this.materialNode)},set_texture__(){this.textureNode&&(this.textureNode.removeInterest("updateTextureBits",this),this.textureNode._transparent.removeInterest("set_transparent__",this)),this.textureNode=Yl(d.X3DTextureNode,this._texture),this.textureNode?(this.textureNode.addInterest("updateTextureBits",this),this.textureNode._transparent.addInterest("set_transparent__",this),this.updateTextureBits()):this.textureBits.clear()},set_textureTransform__(){this.textureTransformNode&&this.textureTransformNode.removeInterest("updateTextureTransformMapping",this),this.textureTransformNode=Yl(d.X3DTextureTransformNode,this._textureTransform),this.textureTransformNode||(this.textureTransformNode=this.getBrowser().getDefaultTextureTransform()),this.textureTransformNode.addInterest("updateTextureTransformMapping",this),this.updateTextureTransformMapping()},updateTextureTransformMapping(){this.textureTransformMapping.clear(),this.textureTransformNode.getTextureTransformMapping(this.textureTransformMapping)},set_shaders__(){const e=this.shaderNodes;for(const t of e)t._isValid.removeInterest("set_shader__",this);e.length=0;for(const t of this._shaders){const i=Yl(d.X3DShaderNode,t);i&&e.push(i)}for(const t of e)t._isValid.addInterest("set_shader__",this);this.set_shader__()},set_shader__:(()=>{function e(){return this.shaderNode}return function(){const t=this.shaderNodes;this.shaderNode&&this.shaderNode.deselect(),this.shaderNode=null;for(const e of t)if(e._isValid.getValue()){this.shaderNode=e;break}this.shaderNode?(this.shaderNode.select(),this.getShader=e,this.getBackShader=e):(delete this.getShader,delete this.getBackShader)}})(),set_renderModes__(){this.renderModeNodes.length=0,this.blendModeNode=Yl(d.BlendMode,this._blendMode),this.depthModeNode=Yl(d.DepthMode,this._depthMode),this.blendModeNode&&this.renderModeNodes.push(this.blendModeNode),this.depthModeNode&&this.renderModeNodes.push(this.depthModeNode)},set_transparent__(){this.setTransparent(!!(this.stylePropertiesNode[3]?.isTransparent()||this.materialNode?.isTransparent()||this.backMaterialNode?.isTransparent()||this.textureNode?.isTransparent()||this.blendModeNode))},traverse(e,t){this.textureNode?.traverse(e,t)}}),Object.defineProperties(ub,{typeName:{value:"Appearance",enumerable:!0},componentInfo:{value:Object.freeze({name:"Shape",level:1}),enumerable:!0},containerField:{value:"appearance",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"acousticProperties",new $n.SFNode),new k(d.inputOutput,"alphaMode",new $n.SFString("AUTO")),new k(d.inputOutput,"alphaCutoff",new $n.SFFloat(.5)),new k(d.inputOutput,"pointProperties",new $n.SFNode),new k(d.inputOutput,"lineProperties",new $n.SFNode),new k(d.inputOutput,"fillProperties",new $n.SFNode),new k(d.inputOutput,"material",new $n.SFNode),new k(d.inputOutput,"backMaterial",new $n.SFNode),new k(d.inputOutput,"texture",new $n.SFNode),new k(d.inputOutput,"textureTransform",new $n.SFNode),new k(d.inputOutput,"shaders",new $n.MFNode),new k(d.inputOutput,"blendMode",new $n.SFNode),new k(d.inputOutput,"depthMode",new $n.SFNode)]),enumerable:!0}});const hb=ub;i.add("Appearance","x_ite/Components/Shape/Appearance",hb);const db=hb;function cb(e){kl.call(this,e),this.addType(d.FillProperties),this.addChildObjects(d.outputOnly,"transparent",new $n.SFBool),this.hatchColor=new Float32Array(3)}Object.assign(Object.setPrototypeOf(cb.prototype,kl.prototype),{initialize(){kl.prototype.initialize.call(this),this._filled.addInterest("set_filled__",this),this._hatched.addInterest("set_hatched__",this),this._hatchColor.addInterest("set_hatchColor__",this),this._hatchStyle.addInterest("set_hatchStyle__",this),this.set_filled__(),this.set_hatched__(),this.set_hatchColor__(),this.set_hatchStyle__(),this.getBrowser().getHatchStyleTexture(this.hatchStyle)},getStyleKey(){return this.hatched?2:1},set_filled__(){this.filled=this._filled.getValue(),this.setTransparent(!this.filled)},set_hatched__(){this.hatched=this._hatched.getValue()},set_hatchColor__(){this.hatchColor[0]=this._hatchColor[0],this.hatchColor[1]=this._hatchColor[1],this.hatchColor[2]=this._hatchColor[2]},set_hatchStyle__(){let e=this._hatchStyle.getValue();(e<1||e>19)&&(e=1),this.hatchStyle=e},setTransparent(e){e!==this._transparent.getValue()&&(this._transparent=e)},isTransparent(){return this._transparent.getValue()},setShaderUniforms(e,t){const i=this.hatched;if(e.uniform1i(t.x3d_FillPropertiesFilled,this.filled),e.uniform1i(t.x3d_FillPropertiesHatched,i),i){const i=this.getBrowser(),n=i.getHatchStyleTexture(this.hatchStyle),r=i.getTexture2DUnit();e.uniform3fv(t.x3d_FillPropertiesHatchColor,this.hatchColor),e.uniform1f(t.x3d_FillPropertiesScale,i.getRenderingProperty("ContentScale")),e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_2D,n.getTexture()),e.uniform1i(t.x3d_FillPropertiesTexture,r)}}}),Object.defineProperties(cb,{typeName:{value:"FillProperties",enumerable:!0},componentInfo:{value:Object.freeze({name:"Shape",level:3}),enumerable:!0},containerField:{value:"fillProperties",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"filled",new $n.SFBool(!0)),new k(d.inputOutput,"hatched",new $n.SFBool(!0)),new k(d.inputOutput,"hatchStyle",new $n.SFInt32(1)),new k(d.inputOutput,"hatchColor",new $n.SFColor(1,1,1))]),enumerable:!0}});const pb=cb;i.add("FillProperties","x_ite/Components/Shape/FillProperties",pb);const gb=pb;function fb(e){kl.call(this,e),this.addType(d.LineProperties)}Object.assign(Object.setPrototypeOf(fb.prototype,kl.prototype),{initialize(){kl.prototype.initialize.call(this);this.getBrowser().getRenderingProperties()._ContentScale.addInterest("set_linewidthScaleFactor__",this),this._applied.addInterest("set_applied__",this),this._linetype.addInterest("set_linetype__",this),this._linewidthScaleFactor.addInterest("set_linewidthScaleFactor__",this),this.set_applied__(),this.set_linetype__(),this.set_linewidthScaleFactor__(),this.getBrowser().getLinetypeTexture()},getStyleKey(){return this.applied?2:1},getApplied(){return this.applied},getLinetype(){return this.linetype},getLinewidthScaleFactor(){return this.linewidthScaleFactor},getTransformLines(){return this.transformLines},set_applied__(){this.applied=this._applied.getValue()},set_linetype__(){let e=this._linetype.getValue();(e<1||e>16)&&(e=1),this.linetype=e},set_linewidthScaleFactor__(){const e=this.getBrowser(),t=e.getContext(),i=e.getRenderingProperty("ContentScale");this.linewidthScaleFactor=Math.max(1,this._linewidthScaleFactor.getValue())*i,this.transformLines=t.HAS_FEATURE_TRANSFORMED_LINES&&this.linewidthScaleFactor>1},setShaderUniforms(e,t){const i=this.getBrowser();if(this.applied){const n=i.getTexture2DUnit();e.lineWidth(this.linewidthScaleFactor),e.uniform1i(t.x3d_LinePropertiesLinetype,this.linetype),e.uniform1f(t.x3d_LineStippleScale,i.getLineStippleScale()),e.activeTexture(e.TEXTURE0+n),e.bindTexture(e.TEXTURE_2D,i.getLinetypeTexture().getTexture()),e.uniform1i(t.x3d_LinePropertiesTexture,n)}else e.lineWidth(i.getRenderingProperty("ContentScale")),e.uniform1i(t.x3d_LinePropertiesLinetype,16),e.uniform1f(t.x3d_LineStippleScale,1)}}),Object.defineProperties(fb,{typeName:{value:"LineProperties",enumerable:!0},componentInfo:{value:Object.freeze({name:"Shape",level:2}),enumerable:!0},containerField:{value:"lineProperties",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"applied",new $n.SFBool(!0)),new k(d.inputOutput,"linetype",new $n.SFInt32(1)),new k(d.inputOutput,"linewidthScaleFactor",new $n.SFFloat)]),enumerable:!0}});const mb=fb;i.add("LineProperties","x_ite/Components/Shape/LineProperties",mb);const _b=mb;function xb(e){kl.call(this,e),this.addType(d.X3DMaterialNode),this.addChildObjects(d.outputOnly,"transparent",new $n.SFBool),this.textureBits=new Ya,this.shaderNodes=this.getBrowser().getShaders()}Object.assign(Object.setPrototypeOf(xb.prototype,kl.prototype),{setTransparent(e){e!==this._transparent.getValue()&&(this._transparent=e)},isTransparent(){return this._transparent.getValue()},setTexture(e,t){e*=4,this.textureBits.remove(e,15),this.textureBits.add(e,t?.getTextureBits()??0)},getTextureBits(){return this.textureBits},getShader(e,t){let i="";if(i+=this.textureBits.toString(16),i+=".",i+=e.geometryKey,t){const{renderObject:n,shadows:r,fogNode:s,shapeNode:o,appearanceNode:a,textureNode:l,humanoidNode:u,objectsKeys:h}=t;i+=o.getAlphaMode(),i+=this.getMaterialKey(),i+=n.getRenderBits().toString(32),i+=r?1:0,i+=s?.getFogType()??0,i+=o.getShapeKey(),i+=a.getStyleProperties(e.geometryType)?.getStyleKey()??0,i+=a.getTextureTransformMapping().size||1,i+=e.textureCoordinateMapping.size||1,i+=".",i+=u?.getHumanoidKey()??"",i+=".",i+=h.sort().join(""),i+=".",i+=l?2:a.getTextureBits().toString(16)}else{const{alphaMode:t,textureNode:n,objectsKeys:r}=e;i+=t,i+=this.getMaterialKey(),i+="0000011.0.",i+=r.sort().join(""),i+=".",i+=n?.getTextureBits().toString(16)??0}return this.shaderNodes.get(i)??this.createShader(i,e,t)},getShaderOptions(e,t){const i=this.getBrowser(),n=[];if(n.push(`X3D_GEOMETRY_${e.geometryType}D`),e.hasFogCoords&&n.push("X3D_FOG_COORDS"),e.colorMaterial&&n.push("X3D_COLOR_MATERIAL"),e.hasNormals&&n.push("X3D_NORMALS"),t){const{renderObject:r,fogNode:s,shapeNode:o,appearanceNode:a,humanoidNode:l,objectsKeys:u,textureNode:h}=t;switch(r.getRenderBits().get(0)&&n.push("X3D_LOGARITHMIC_DEPTH_BUFFER"),o.getAlphaMode()){case Dl.OPAQUE:n.push("X3D_ALPHA_MODE_OPAQUE");break;case Dl.MASK:n.push("X3D_ALPHA_MODE_MASK");break;case Dl.BLEND:n.push("X3D_ALPHA_MODE_BLEND"),r.getRenderBits().get(1)&&n.push("X3D_ORDER_INDEPENDENT_TRANSPARENCY")}switch(t.shadows&&n.push("X3D_SHADOWS","X3D_PCF_FILTERING"),s?.getFogType()){case 1:n.push("X3D_FOG","X3D_FOG_LINEAR");break;case 2:n.push("X3D_FOG","X3D_FOG_EXPONENTIAL")}l&&(n.push("X3D_SKINNING"),n.push("X3D_NUM_JOINT_SETS "+l.getNumJoints()/4),n.push(`X3D_NUM_DISPLACEMENTS ${l.getNumDisplacements()}`));const c=u.reduce(((e,t)=>e+(0===t)),0),p=u.reduce(((e,t)=>e+(1===t)),0),g=u.reduce(((e,t)=>e+(2===t)),0),f=u.reduce(((e,t)=>e+(3===t)),0);if(c&&(n.push("X3D_CLIP_PLANES"),n.push(`X3D_NUM_CLIP_PLANES ${Math.min(c,i.getMaxClipPlanes())}`)),p&&e.hasNormals&&(n.push("X3D_LIGHTING"),n.push(`X3D_NUM_LIGHTS ${Math.min(p,i.getMaxLights())}`)),g&&e.hasNormals&&(n.push("X3D_USE_IBL"),n.push(`X3D_NUM_ENVIRONMENT_LIGHTS ${Math.min(g,i.getMaxLights())}`)),f&&(n.push("X3D_TEXTURE_PROJECTION"),n.push(`X3D_NUM_TEXTURE_PROJECTORS ${Math.min(f,i.getMaxTextures())}`)),a.getStyleProperties(e.geometryType)&&(n.push("X3D_STYLE_PROPERTIES"),a.getStyleProperties(e.geometryType).getStyleKey()>1&&n.push("X3D_STYLE_PROPERTIES_TEXTURE")),+this.textureBits&&n.push("X3D_MATERIAL_TEXTURES"),h)n.push("X3D_TEXTURE","X3D_NUM_TEXTURES 1","X3D_NUM_TEXTURE_TRANSFORMS 1","X3D_NUM_TEXTURE_COORDINATES 1"),h.getShaderOptions(n,0);else{if(+a.getTextureBits()&&!this.getBaseTexture()){const e=a.getTexture();n.push("X3D_TEXTURE"),n.push(`X3D_NUM_TEXTURES ${e.getCount()}`),e.getType().includes(d.MultiTexture)&&n.push("X3D_MULTI_TEXTURING"),e.getShaderOptions(n)}n.push(`X3D_NUM_TEXTURE_TRANSFORMS ${a.getTextureTransformMapping().size||1}`),n.push(`X3D_NUM_TEXTURE_COORDINATES ${e.textureCoordinateMapping.size||1}`)}switch(o.getShapeKey()){case 1:n.push("X3D_PARTICLE_SYSTEM");break;case 2:n.push("X3D_PARTICLE_SYSTEM","X3D_TEX_COORD_RAMP")}}else{const{alphaMode:t,objectsKeys:r,textureNode:s}=e;switch(t){case Dl.OPAQUE:n.push("X3D_ALPHA_MODE_OPAQUE");break;case Dl.MASK:n.push("X3D_ALPHA_MODE_MASK");break;case Dl.BLEND:n.push("X3D_ALPHA_MODE_BLEND"),i.getBrowserOption("OrderIndependentTransparency")&&n.push("X3D_ORDER_INDEPENDENT_TRANSPARENCY")}const o=r.reduce(((e,t)=>e+(0===t)),0),a=r.reduce(((e,t)=>e+(1===t)),0),l=r.reduce(((e,t)=>e+(2===t)),0),u=r.reduce(((e,t)=>e+(3===t)),0);o&&(n.push("X3D_CLIP_PLANES"),n.push(`X3D_NUM_CLIP_PLANES ${Math.min(o,i.getMaxClipPlanes())}`)),a&&(n.push("X3D_LIGHTING"),n.push(`X3D_NUM_LIGHTS ${Math.min(a,i.getMaxLights())}`)),l&&(n.push("X3D_USE_IBL"),n.push(`X3D_NUM_ENVIRONMENT_LIGHTS ${Math.min(l,i.getMaxLights())}`)),u&&(n.push("X3D_TEXTURE_PROJECTION"),n.push(`X3D_NUM_TEXTURE_PROJECTORS ${Math.min(u,i.getMaxTextures())}`)),s&&(n.push("X3D_TEXTURE","X3D_NUM_TEXTURES 1","X3D_NUM_TEXTURE_TRANSFORMS 1","X3D_NUM_TEXTURE_COORDINATES 1"),s.getShaderOptions(n,0))}return n}}),Object.defineProperties(xb,{typeName:{value:"X3DMaterialNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Shape",level:1}),enumerable:!0}});const yb=xb;i.add("X3DMaterialNode","x_ite/Components/Shape/X3DMaterialNode",yb);const wb=yb;function bb(e){wb.call(this,e),this.addType(d.X3DOneSidedMaterialNode),this.emissiveColor=new Float32Array(3)}Object.assign(Object.setPrototypeOf(bb.prototype,wb.prototype),{initialize(){wb.prototype.initialize.call(this),this._emissiveColor.addInterest("set_emissiveColor__",this),this._emissiveTexture.addInterest("set_emissiveTexture__",this),this._normalTexture.addInterest("set_normalTexture__",this),this._transparency.addInterest("set_transparency__",this),this._transparency.addInterest("set_transparent__",this),this.set_emissiveColor__(),this.set_emissiveTexture__(),this.set_normalTexture__(),this.set_transparency__()},set_emissiveColor__(){const e=this.emissiveColor,t=this._emissiveColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_emissiveTexture__(){const e=this.getTextureIndices().EMISSIVE_TEXTURE;this.emissiveTextureNode?._linear.removeInterest(`setTexture${e}`,this),this.emissiveTextureNode=Yl(d.X3DSingleTextureNode,this._emissiveTexture),this.emissiveTextureNode?._linear.addInterest(`setTexture${e}`,this,e,this.emissiveTextureNode),this.setTexture(e,this.emissiveTextureNode)},set_normalTexture__(){this.normalTextureNode=Yl(d.X3DSingleTextureNode,this._normalTexture),this.setTexture(this.getTextureIndices().NORMAL_TEXTURE,this.normalTextureNode)},set_transparency__(){this.transparency=g.clamp(this._transparency.getValue(),0,1)},set_transparent__(){this.setTransparent(!!this.transparency)},getBaseTexture(){return this.getEmissiveTexture()},getEmissiveTexture(){return this.emissiveTextureNode},getNormalTexture(){return this.normalTextureNode},getTransparency(){return this.transparency},getShaderOptions(e,t){const i=wb.prototype.getShaderOptions.call(this,e,t);return+this.getTextureBits()&&(this.getEmissiveTexture()&&i.push("X3D_EMISSIVE_TEXTURE",`X3D_EMISSIVE_TEXTURE_${this.getEmissiveTexture().getTextureTypeString()}`),1===this.getEmissiveTexture()?.getTextureType()&&i.push("X3D_EMISSIVE_TEXTURE_FLIP_Y"),this.getEmissiveTexture()?.isLinear()&&i.push("X3D_EMISSIVE_TEXTURE_LINEAR"),this.getNormalTexture()&&i.push("X3D_NORMAL_TEXTURE",`X3D_NORMAL_TEXTURE_${this.getNormalTexture().getTextureTypeString()}`),1===this.getNormalTexture()?.getTextureType()&&i.push("X3D_NORMAL_TEXTURE_FLIP_Y")),i},setShaderUniforms(e,t,i,n,r){if(e.uniform3fv(t.x3d_EmissiveColor,this.emissiveColor),e.uniform1f(t.x3d_Transparency,this.transparency),+this.getTextureBits()){if(this.emissiveTextureNode){const s=this._emissiveTextureMapping.getValue(),o=t.x3d_EmissiveTexture;this.emissiveTextureNode.setShaderUniforms(e,t,i,o),e.uniform1i(o.textureTransformMapping,n.get(s)??0),e.uniform1i(o.textureCoordinateMapping,r.get(s)??0)}if(this.normalTextureNode){const s=this._normalTextureMapping.getValue(),o=t.x3d_NormalTexture;e.uniform1f(t.x3d_NormalScale,Math.max(this._normalScale.getValue(),0)),this.normalTextureNode.setShaderUniforms(e,t,i,o),e.uniform1i(o.textureTransformMapping,n.get(s)??0),e.uniform1i(o.textureCoordinateMapping,r.get(s)??0)}}}}),Object.defineProperties(bb,{typeName:{value:"X3DOneSidedMaterialNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Shape",level:4}),enumerable:!0}});const Sb=bb;i.add("X3DOneSidedMaterialNode","x_ite/Components/Shape/X3DOneSidedMaterialNode",Sb);const Tb=Sb;function vb(e){Tb.call(this,e),this.addType(d.Material),e.getSpecificationVersion()<=3.3&&(this.getMaterialKey=Ob),this.diffuseColor=new Float32Array(3),this.specularColor=new Float32Array(3)}function Ob(){return this.getBrowser().getBrowserOptions().getShading()===Ol.PHONG?"2":"1"}Object.assign(Object.setPrototypeOf(vb.prototype,Tb.prototype),{initialize(){Tb.prototype.initialize.call(this),this._ambientIntensity.addInterest("set_ambientIntensity__",this),this._ambientTexture.addInterest("set_ambientTexture__",this),this._diffuseColor.addInterest("set_diffuseColor__",this),this._diffuseTexture.addInterest("set_diffuseTexture__",this),this._diffuseTexture.addInterest("set_transparent__",this),this._specularColor.addInterest("set_specularColor__",this),this._specularTexture.addInterest("set_specularTexture__",this),this._shininess.addInterest("set_shininess__",this),this._shininessTexture.addInterest("set_shininessTexture__",this),this._occlusionStrength.addInterest("set_occlusionStrength__",this),this._occlusionTexture.addInterest("set_occlusionTexture__",this),this.set_ambientIntensity__(),this.set_ambientTexture__(),this.set_diffuseColor__(),this.set_diffuseTexture__(),this.set_specularColor__(),this.set_specularTexture__(),this.set_shininess__(),this.set_shininessTexture__(),this.set_occlusionStrength__(),this.set_occlusionTexture__(),this.set_transparent__()},getMaterialKey:()=>"2",getTextureIndices:(()=>{let e=0;const t={AMBIENT_TEXTURE:e++,DIFFUSE_TEXTURE:e++,SPECULAR_TEXTURE:e++,EMISSIVE_TEXTURE:e++,SHININESS_TEXTURE:e++,OCCLUSION_TEXTURE:e++,NORMAL_TEXTURE:e++};return function(){return t}})(),getBaseTexture(){return this.diffuseTexture},set_ambientIntensity__(){this.ambientIntensity=g.clamp(this._ambientIntensity.getValue(),0,1)},set_ambientTexture__(){const e=this.getTextureIndices().AMBIENT_TEXTURE;this.ambientTextureNode?._linear.removeInterest(`setTexture${e}`,this),this.ambientTextureNode=Yl(d.X3DSingleTextureNode,this._ambientTexture),this.ambientTextureNode?._linear.addInterest(`setTexture${e}`,this,e,this.ambientTextureNode),this.setTexture(e,this.ambientTextureNode)},set_diffuseColor__(){const e=this.diffuseColor,t=this._diffuseColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_diffuseTexture__(){const e=this.getTextureIndices().DIFFUSE_TEXTURE;this.diffuseTextureNode&&(this.diffuseTextureNode._transparent.removeInterest("set_transparent__",this),this.diffuseTextureNode._linear.removeInterest(`setTexture${e}`,this)),this.diffuseTextureNode=Yl(d.X3DSingleTextureNode,this._diffuseTexture),this.diffuseTextureNode&&(this.diffuseTextureNode._transparent.addInterest("set_transparent__",this),this.diffuseTextureNode._linear.addInterest(`setTexture${e}`,this,e,this.diffuseTextureNode)),this.setTexture(e,this.diffuseTextureNode)},set_specularColor__(){const e=this.specularColor,t=this._specularColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_specularTexture__(){const e=this.getTextureIndices().SPECULAR_TEXTURE;this.specularTextureNode?._linear.removeInterest(`setTexture${e}`,this),this.specularTextureNode=Yl(d.X3DSingleTextureNode,this._specularTexture),this.specularTextureNode?._linear.addInterest(`setTexture${e}`,this,e,this.specularTextureNode),this.setTexture(e,this.specularTextureNode)},set_shininess__(){this.shininess=g.clamp(this._shininess.getValue(),0,1)},set_shininessTexture__(){this.shininessTextureNode=Yl(d.X3DSingleTextureNode,this._shininessTexture),this.setTexture(this.getTextureIndices().SHININESS_TEXTURE,this.shininessTextureNode)},set_occlusionStrength__(){this.occlusionStrength=g.clamp(this._occlusionStrength.getValue(),0,1)},set_occlusionTexture__(){this.occlusionTextureNode=Yl(d.X3DSingleTextureNode,this._occlusionTexture),this.setTexture(this.getTextureIndices().OCCLUSION_TEXTURE,this.occlusionTextureNode)},set_transparent__(){this.setTransparent(!(!this.getTransparency()&&!this.diffuseTextureNode?.isTransparent()))},createShader(e,t,i){const n=this.getBrowser(),r=this.getShaderOptions(t,i);if(t.hasNormals)switch(r.push("X3D_MATERIAL"),+this.getTextureBits()&&(this.ambientTextureNode&&r.push("X3D_AMBIENT_TEXTURE",`X3D_AMBIENT_TEXTURE_${this.ambientTextureNode.getTextureTypeString()}`),1===this.ambientTextureNode?.getTextureType()&&r.push("X3D_AMBIENT_TEXTURE_FLIP_Y"),this.ambientTextureNode?.isLinear()&&r.push("X3D_AMBIENT_TEXTURE_LINEAR"),this.diffuseTextureNode&&r.push("X3D_DIFFUSE_TEXTURE",`X3D_DIFFUSE_TEXTURE_${this.diffuseTextureNode.getTextureTypeString()}`),1===this.diffuseTextureNode?.getTextureType()&&r.push("X3D_DIFFUSE_TEXTURE_FLIP_Y"),this.diffuseTextureNode?.isLinear()&&r.push("X3D_DIFFUSE_TEXTURE_LINEAR"),this.specularTextureNode&&r.push("X3D_SPECULAR_TEXTURE",`X3D_SPECULAR_TEXTURE_${this.specularTextureNode.getTextureTypeString()}`),1===this.specularTextureNode?.getTextureType()&&r.push("X3D_SPECULAR_TEXTURE_FLIP_Y"),this.specularTextureNode?.isLinear()&&r.push("X3D_SPECULAR_TEXTURE_LINEAR"),this.shininessTextureNode&&r.push("X3D_SHININESS_TEXTURE",`X3D_SHININESS_TEXTURE_${this.shininessTextureNode.getTextureTypeString()}`),1===this.shininessTextureNode?.getTextureType()&&r.push("X3D_SHININESS_TEXTURE_FLIP_Y"),this.occlusionTextureNode&&r.push("X3D_OCCLUSION_TEXTURE",`X3D_OCCLUSION_TEXTURE_${this.occlusionTextureNode.getTextureTypeString()}`),1===this.occlusionTextureNode?.getTextureType()&&r.push("X3D_OCCLUSION_TEXTURE_FLIP_Y")),this.getMaterialKey()){case"1":if(!i?.shadows){var s=n.createShader("Gouraud","Gouraud","Gouraud",r);break}case"2":s=n.createShader("Phong","Default","Phong",r)}else{r.push("X3D_UNLIT_MATERIAL");s=n.createShader("Unlit","Default","Unlit",r);n.getShaders().set(e,s)}return n.getShaders().set(e,s),s},setShaderUniforms(e,t,i,n,r){if(Tb.prototype.setShaderUniforms.call(this,e,t,i,n,r),e.uniform1f(t.x3d_AmbientIntensity,this.ambientIntensity),e.uniform3fv(t.x3d_DiffuseColor,this.diffuseColor),e.uniform3fv(t.x3d_SpecularColor,this.specularColor),e.uniform1f(t.x3d_Shininess,this.shininess),+this.getTextureBits()){if(this.ambientTextureNode){const s=this._ambientTextureMapping.getValue(),o=t.x3d_AmbientTexture;this.ambientTextureNode.setShaderUniforms(e,t,i,o),e.uniform1i(o.textureTransformMapping,n.get(s)??0),e.uniform1i(o.textureCoordinateMapping,r.get(s)??0)}if(this.diffuseTextureNode){const s=this._diffuseTextureMapping.getValue(),o=t.x3d_DiffuseTexture;this.diffuseTextureNode.setShaderUniforms(e,t,i,o),e.uniform1i(o.textureTransformMapping,n.get(s)??0),e.uniform1i(o.textureCoordinateMapping,r.get(s)??0)}if(this.specularTextureNode){const s=this._specularTextureMapping.getValue(),o=t.x3d_SpecularTexture;this.specularTextureNode.setShaderUniforms(e,t,i,o),e.uniform1i(o.textureTransformMapping,n.get(s)??0),e.uniform1i(o.textureCoordinateMapping,r.get(s)??0)}if(this.shininessTextureNode){const s=this._shininessTextureMapping.getValue(),o=t.x3d_ShininessTexture;this.shininessTextureNode.setShaderUniforms(e,t,i,o),e.uniform1i(o.textureTransformMapping,n.get(s)??0),e.uniform1i(o.textureCoordinateMapping,r.get(s)??0)}if(this.occlusionTextureNode){const s=this._occlusionTextureMapping.getValue(),o=t.x3d_OcclusionTexture;e.uniform1f(t.x3d_OcclusionStrength,this.occlusionStrength),this.occlusionTextureNode.setShaderUniforms(e,t,i,o),e.uniform1i(o.textureTransformMapping,n.get(s)??0),e.uniform1i(o.textureCoordinateMapping,r.get(s)??0)}}}}),Object.defineProperties(vb,{typeName:{value:"Material",enumerable:!0},componentInfo:{value:Object.freeze({name:"Shape",level:1}),enumerable:!0},containerField:{value:"material",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"ambientIntensity",new $n.SFFloat(.2)),new k(d.inputOutput,"ambientTextureMapping",new $n.SFString),new k(d.inputOutput,"ambientTexture",new $n.SFNode),new k(d.inputOutput,"diffuseColor",new $n.SFColor(.8,.8,.8)),new k(d.inputOutput,"diffuseTextureMapping",new $n.SFString),new k(d.inputOutput,"diffuseTexture",new $n.SFNode),new k(d.inputOutput,"specularColor",new $n.SFColor),new k(d.inputOutput,"specularTextureMapping",new $n.SFString),new k(d.inputOutput,"specularTexture",new $n.SFNode),new k(d.inputOutput,"emissiveColor",new $n.SFColor),new k(d.inputOutput,"emissiveTextureMapping",new $n.SFString),new k(d.inputOutput,"emissiveTexture",new $n.SFNode),new k(d.inputOutput,"shininess",new $n.SFFloat(.2)),new k(d.inputOutput,"shininessTextureMapping",new $n.SFString),new k(d.inputOutput,"shininessTexture",new $n.SFNode),new k(d.inputOutput,"occlusionStrength",new $n.SFFloat(1)),new k(d.inputOutput,"occlusionTextureMapping",new $n.SFString),new k(d.inputOutput,"occlusionTexture",new $n.SFNode),new k(d.inputOutput,"normalScale",new $n.SFFloat(1)),new k(d.inputOutput,"normalTextureMapping",new $n.SFString),new k(d.inputOutput,"normalTexture",new $n.SFNode),new k(d.inputOutput,"transparency",new $n.SFFloat)]),enumerable:!0}});for(const e of Object.values(vb.prototype.getTextureIndices()))vb.prototype[`setTexture${e}`]=function(e,t){this.setTexture(e,t)};const Eb=vb;i.add("Material","x_ite/Components/Shape/Material",Eb);const Cb=Eb;function Nb(e){Tb.call(this,e),this.addType(d.PhysicalMaterial),this.baseColor=new Float32Array(3)}Object.assign(Object.setPrototypeOf(Nb.prototype,Tb.prototype),{initialize(){Tb.prototype.initialize.call(this),this._baseColor.addInterest("set_baseColor__",this),this._baseTexture.addInterest("set_baseTexture__",this),this._baseTexture.addInterest("set_transparent__",this),this._metallic.addInterest("set_metallic__",this),this._roughness.addInterest("set_roughness__",this),this._metallicRoughnessTexture.addInterest("set_metallicRoughnessTexture__",this),this._occlusionStrength.addInterest("set_occlusionStrength__",this),this._occlusionTexture.addInterest("set_occlusionTexture__",this),this.set_baseColor__(),this.set_baseTexture__(),this.set_metallic__(),this.set_roughness__(),this.set_metallicRoughnessTexture__(),this.set_occlusionStrength__(),this.set_occlusionTexture__(),this.set_transparent__()},getMaterialKey:()=>"3",getTextureIndices:(()=>{let e=0;const t={BASE_TEXTURE:e++,EMISSIVE_TEXTURE:e++,METALLIC_ROUGHNESS_TEXTURE:e++,OCCLUSION_TEXTURE:e++,NORMAL_TEXTURE:e++};return function(){return t}})(),getBaseTexture(){return this.baseTextureNode},set_baseColor__(){const e=this.baseColor,t=this._baseColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_baseTexture__(){const e=this.getTextureIndices().BASE_TEXTURE;this.baseTextureNode&&(this.baseTextureNode._transparent.removeInterest("set_transparent__",this),this.baseTextureNode._linear.removeInterest(`setTexture${e}`,this)),this.baseTextureNode=Yl(d.X3DSingleTextureNode,this._baseTexture),this.baseTextureNode&&(this.baseTextureNode._transparent.addInterest("set_transparent__",this),this.baseTextureNode._linear.addInterest(`setTexture${e}`,this,e,this.baseTextureNode)),this.setTexture(e,this.baseTextureNode)},set_metallic__(){this.metallic=g.clamp(this._metallic.getValue(),0,1)},set_roughness__(){this.roughness=g.clamp(this._roughness.getValue(),0,1)},set_metallicRoughnessTexture__(){this.metallicRoughnessTextureNode=Yl(d.X3DSingleTextureNode,this._metallicRoughnessTexture),this.setTexture(this.getTextureIndices().METALLIC_ROUGHNESS_TEXTURE,this.metallicRoughnessTextureNode)},set_occlusionStrength__(){this.occlusionStrength=g.clamp(this._occlusionStrength.getValue(),0,1)},set_occlusionTexture__(){this.occlusionTextureNode=Yl(d.X3DSingleTextureNode,this._occlusionTexture),this.setTexture(this.getTextureIndices().OCCLUSION_TEXTURE,this.occlusionTextureNode)},set_transparent__(){this.setTransparent(!(!this.getTransparency()&&!this.baseTextureNode?.isTransparent()))},createShader(e,t,i){const n=this.getBrowser(),r=this.getShaderOptions(t,i);if(t.hasNormals){r.push("X3D_PHYSICAL_MATERIAL","X3D_MATERIAL_METALLIC_ROUGHNESS"),+this.getTextureBits()&&(this.baseTextureNode&&r.push("X3D_BASE_TEXTURE",`X3D_BASE_TEXTURE_${this.baseTextureNode.getTextureTypeString()}`),1===this.baseTextureNode?.getTextureType()&&r.push("X3D_BASE_TEXTURE_FLIP_Y"),this.baseTextureNode?.isLinear()&&r.push("X3D_BASE_TEXTURE_LINEAR"),this.metallicRoughnessTextureNode&&r.push("X3D_METALLIC_ROUGHNESS_TEXTURE",`X3D_METALLIC_ROUGHNESS_TEXTURE_${this.metallicRoughnessTextureNode.getTextureTypeString()}`),1===this.metallicRoughnessTextureNode?.getTextureType()&&r.push("X3D_METALLIC_ROUGHNESS_TEXTURE_FLIP_Y"),this.occlusionTextureNode&&r.push("X3D_OCCLUSION_TEXTURE",`X3D_OCCLUSION_TEXTURE_${this.occlusionTextureNode.getTextureTypeString()}`),1===this.occlusionTextureNode?.getTextureType()&&r.push("X3D_OCCLUSION_TEXTURE_FLIP_Y"));var s=n.createShader("PBR","Default","PBR",r)}else{r.push("X3D_UNLIT_MATERIAL");s=n.createShader("Unlit","Default","Unlit",r);n.getShaders().set(e,s)}return n.getShaders().set(e,s),s},setShaderUniforms(e,t,i,n,r){if(Tb.prototype.setShaderUniforms.call(this,e,t,i,n,r),e.uniform3fv(t.x3d_BaseColor,this.baseColor),e.uniform1f(t.x3d_Metallic,this.metallic),e.uniform1f(t.x3d_Roughness,this.roughness),+this.getTextureBits()){if(this.baseTextureNode){const s=this._baseTextureMapping.getValue(),o=t.x3d_BaseTexture;this.baseTextureNode.setShaderUniforms(e,t,i,o),e.uniform1i(o.textureTransformMapping,n.get(s)??0),e.uniform1i(o.textureCoordinateMapping,r.get(s)??0)}if(this.metallicRoughnessTextureNode){const s=this._metallicRoughnessTextureMapping.getValue(),o=t.x3d_MetallicRoughnessTexture;this.metallicRoughnessTextureNode.setShaderUniforms(e,t,i,o),e.uniform1i(o.textureTransformMapping,n.get(s)??0),e.uniform1i(o.textureCoordinateMapping,r.get(s)??0)}if(this.occlusionTextureNode){const s=this._occlusionTextureMapping.getValue(),o=t.x3d_OcclusionTexture;e.uniform1f(t.x3d_OcclusionStrength,this.occlusionStrength),this.occlusionTextureNode.setShaderUniforms(e,t,i,o),e.uniform1i(o.textureTransformMapping,n.get(s)??0),e.uniform1i(o.textureCoordinateMapping,r.get(s)??0)}}}}),Object.defineProperties(Nb,{typeName:{value:"PhysicalMaterial",enumerable:!0},componentInfo:{value:Object.freeze({name:"Shape",level:2}),enumerable:!0},containerField:{value:"material",enumerable:!0},specificationRange:{value:Object.freeze({from:"4.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"baseColor",new $n.SFColor(1,1,1)),new k(d.inputOutput,"baseTextureMapping",new $n.SFString),new k(d.inputOutput,"baseTexture",new $n.SFNode),new k(d.inputOutput,"emissiveColor",new $n.SFColor),new k(d.inputOutput,"emissiveTextureMapping",new $n.SFString),new k(d.inputOutput,"emissiveTexture",new $n.SFNode),new k(d.inputOutput,"metallic",new $n.SFFloat(1)),new k(d.inputOutput,"roughness",new $n.SFFloat(1)),new k(d.inputOutput,"metallicRoughnessTextureMapping",new $n.SFString),new k(d.inputOutput,"metallicRoughnessTexture",new $n.SFNode),new k(d.inputOutput,"occlusionStrength",new $n.SFFloat(1)),new k(d.inputOutput,"occlusionTextureMapping",new $n.SFString),new k(d.inputOutput,"occlusionTexture",new $n.SFNode),new k(d.inputOutput,"normalScale",new $n.SFFloat(1)),new k(d.inputOutput,"normalTextureMapping",new $n.SFString),new k(d.inputOutput,"normalTexture",new $n.SFNode),new k(d.inputOutput,"transparency",new $n.SFFloat)]),enumerable:!0}});for(const e of Object.values(Nb.prototype.getTextureIndices()))Nb.prototype[`setTexture${e}`]=function(e,t){this.setTexture(e,t)};const Ib=Nb;i.add("PhysicalMaterial","x_ite/Components/Shape/PhysicalMaterial",Ib);const Fb=Ib;function Mb(e){kl.call(this,e),this.addType(d.PointProperties),this.attenuation=new Float32Array(3)}Object.assign(Object.setPrototypeOf(Mb.prototype,kl.prototype),{initialize(){kl.prototype.initialize.call(this);const e=this.getBrowser(),t=e.getContext();this.pointSizeRange=t.getParameter(t.ALIASED_POINT_SIZE_RANGE),e.getRenderingProperties()._ContentScale.addInterest("set_contentScale__",this),this._pointSizeScaleFactor.addInterest("set_pointSizeScaleFactor__",this),this._pointSizeMinValue.addInterest("set_pointSizeMinValue__",this),this._pointSizeMaxValue.addInterest("set_pointSizeMaxValue__",this),this._attenuation.addInterest("set_attenuation__",this),this.set_pointSizeScaleFactor__(),this.set_pointSizeMinValue__(),this.set_pointSizeMaxValue__(),this.set_attenuation__()},getStyleKey:()=>1,set_contentScale__(){this.set_pointSizeScaleFactor__(),this.set_pointSizeMinValue__(),this.set_pointSizeMaxValue__()},set_pointSizeScaleFactor__(){const e=this.getBrowser().getRenderingProperty("ContentScale");this.pointSizeScaleFactor=Math.max(this._pointSizeScaleFactor.getValue(),0)*e},set_pointSizeMinValue__(){const e=this.getBrowser().getRenderingProperty("ContentScale");this.pointSizeMinValue=g.clamp(this._pointSizeMinValue.getValue(),0,this.pointSizeRange[1])*e},set_pointSizeMaxValue__(){const e=this.getBrowser().getRenderingProperty("ContentScale");this.pointSizeMaxValue=g.clamp(this._pointSizeMaxValue.getValue(),0,this.pointSizeRange[1])*e},set_attenuation__(){this.attenuation[0]=Math.max(0,this._attenuation[0]),this.attenuation[1]=Math.max(0,this._attenuation[1]),this.attenuation[2]=Math.max(0,this._attenuation[2])},setShaderUniforms(e,t){e.uniform1f(t.x3d_PointPropertiesPointSizeScaleFactor,this.pointSizeScaleFactor),e.uniform1f(t.x3d_PointPropertiesPointSizeMinValue,this.pointSizeMinValue),e.uniform1f(t.x3d_PointPropertiesPointSizeMaxValue,this.pointSizeMaxValue),e.uniform3fv(t.x3d_PointPropertiesAttenuation,this.attenuation)}}),Object.defineProperties(Mb,{typeName:{value:"PointProperties",enumerable:!0},componentInfo:{value:Object.freeze({name:"Shape",level:5}),enumerable:!0},containerField:{value:"pointProperties",enumerable:!0},specificationRange:{value:Object.freeze({from:"4.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"pointSizeScaleFactor",new $n.SFFloat(1)),new k(d.inputOutput,"pointSizeMinValue",new $n.SFFloat(1)),new k(d.inputOutput,"pointSizeMaxValue",new $n.SFFloat(1)),new k(d.inputOutput,"attenuation",new $n.SFVec3f(1,0,0))]),enumerable:!0}});const Db=Mb;i.add("PointProperties","x_ite/Components/Shape/PointProperties",Db);const Rb=Db;function Pb(e){Yr.call(this,e),zu.call(this,e),this.addType(d.X3DShapeNode),this.bbox=new Xa,this.bboxSize=new Tt(0,0,0),this.bboxCenter=new Tt(0,0,0)}Object.assign(Object.setPrototypeOf(Pb.prototype,Yr.prototype),zu.prototype,{initialize(){Yr.prototype.initialize.call(this),zu.prototype.initialize.call(this),this._bboxSize.addInterest("set_bbox__",this),this._bboxCenter.addInterest("set_bbox__",this),this._appearance.addInterest("set_appearance__",this),this._geometry.addInterest("set_geometry__",this),this._appearance.addInterest("set_transparent__",this),this._geometry.addInterest("set_transparent__",this),this.set_appearance__(),this.set_geometry__()},getBBox(e,t){return t?this._castShadow.getValue()?e.assign(this.bbox):e.set():e.assign(this.bbox)},getBBoxSize(){return this.bboxSize},getBBoxCenter(){return this.bboxCenter},isTransparent(){return this.transparent},setTransparent(e){this.transparent=e},getAlphaMode(){return this.alphaMode},setAlphaMode(e){this.alphaMode=e},getAppearance(){return this.appearanceNode},getGeometry(){return this.geometryNode},set_appearance__(){this.appearanceNode&&(this.appearanceNode._alphaMode.removeInterest("set_transparent__",this),this.appearanceNode._transparent.removeInterest("set_transparent__",this)),this.appearanceNode=Yl(d.X3DAppearanceNode,this._appearance),this.appearanceNode?(this.appearanceNode._alphaMode.addInterest("set_transparent__",this),this.appearanceNode._transparent.addInterest("set_transparent__",this)):this.appearanceNode=this.getBrowser().getDefaultAppearance(),this.set_transparent__()},set_geometry__(){this.geometryNode&&(this.geometryNode._transparent.addInterest("set_transparent__",this),this.geometryNode._bbox_changed.addInterest("set_bbox__",this)),this.geometryNode=Yl(d.X3DGeometryNode,this._geometry),this.geometryNode&&(this.geometryNode._transparent.addInterest("set_transparent__",this),this.geometryNode._bbox_changed.addInterest("set_bbox__",this)),this.set_transparent__(),this.set_bbox__()},set_transparent__(){const e=this.appearanceNode.getAlphaMode();e===Dl.AUTO?(this.transparent=!(!this.appearanceNode.isTransparent()&&!this.geometryNode?.isTransparent()),this.alphaMode=this.transparent?Dl.BLEND:Dl.OPAQUE):(this.transparent=e===Dl.BLEND,this.alphaMode=e)},set_bbox__(){this._bboxSize.getValue().equals(this.getDefaultBBoxSize())?this.getGeometry()?this.bbox.assign(this.getGeometry().getBBox()):this.bbox.set():this.bbox.set(this._bboxSize.getValue(),this._bboxCenter.getValue()),this.bboxSize.assign(this.bbox.size),this.bboxCenter.assign(this.bbox.center)},dispose(){zu.prototype.dispose.call(this),Yr.prototype.dispose.call(this)}}),Object.defineProperties(Pb,{typeName:{value:"X3DShapeNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Shape",level:1}),enumerable:!0}});const Ab=Pb;i.add("X3DShapeNode","x_ite/Components/Shape/X3DShapeNode",Ab);const Vb=Ab;function Lb(e){Vb.call(this,e),this.addType(d.Shape)}Object.assign(Object.setPrototypeOf(Lb.prototype,Vb.prototype),{initialize(){Vb.prototype.initialize.call(this),this._transformSensors_changed.addInterest("set_transformSensors__",this),this.set_transformSensors__()},getShapeKey:()=>0,getGeometryContext:Vb.prototype.getGeometry,set_geometry__(){Vb.prototype.set_geometry__.call(this),this.getGeometry()?delete this.traverse:this.traverse=Function.prototype},set_transformSensors__(){this.setPickableObject(this.getTransformSensors().size)},intersectsBox(e,t,i){return this.getGeometry().intersectsBox(e,t,i)},traverse(e,t){switch(e){case Ma.POINTER:t.addPointingShape(this);break;case Ma.PICKING:this.picking(t);break;case Ma.COLLISION:t.addCollisionShape(this);break;case Ma.SHADOW:this._castShadow.getValue()&&t.addShadowShape(this);break;case Ma.DISPLAY:t.addDisplayShape(this)&&this.getAppearance().traverse(e,t)}this.getGeometry().traverse(e,t)},picking(e){const t=e.getModelViewMatrix().get();if(this.getTransformSensors().size)for(const e of this.getTransformSensors())e.collect(t);const i=this.getBrowser(),n=i.getPickSensors(),r=i.getPickingHierarchy();r.push(this);for(const e of n.at(-1))e.collect(this.getGeometry(),t,r);r.pop()},displaySimple(e,t,i){this.getGeometry().displaySimple(e,t,i)},display(e,t){this.getGeometry().display(e,t)}}),Object.defineProperties(Lb,{typeName:{value:"Shape",enumerable:!0},componentInfo:{value:Object.freeze({name:"Shape",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"visible",new $n.SFBool(!0)),new k(d.inputOutput,"castShadow",new $n.SFBool(!0)),new k(d.inputOutput,"bboxDisplay",new $n.SFBool),new k(d.initializeOnly,"bboxSize",new $n.SFVec3f(-1,-1,-1)),new k(d.initializeOnly,"bboxCenter",new $n.SFVec3f),new k(d.inputOutput,"appearance",new $n.SFNode),new k(d.inputOutput,"geometry",new $n.SFNode)]),enumerable:!0}});const Bb=Lb;i.add("Shape","x_ite/Components/Shape/Shape",Bb);const Ub=Bb;function Xb(e){console.warn("TwoSidedMaterial is depreciated, please use Appearance backMaterial field."),wb.call(this,e),this.addType(d.TwoSidedMaterial),this.diffuseColor=new Float32Array(3),this.specularColor=new Float32Array(3),this.emissiveColor=new Float32Array(3),this.backDiffuseColor=new Float32Array(3),this.backSpecularColor=new Float32Array(3),this.backEmissiveColor=new Float32Array(3)}Object.assign(Object.setPrototypeOf(Xb.prototype,wb.prototype),{initialize(){wb.prototype.initialize.call(this),this._ambientIntensity.addInterest("set_ambientIntensity__",this),this._diffuseColor.addInterest("set_diffuseColor__",this),this._specularColor.addInterest("set_specularColor__",this),this._emissiveColor.addInterest("set_emissiveColor__",this),this._shininess.addInterest("set_shininess__",this),this._transparency.addInterest("set_transparency__",this),this._backAmbientIntensity.addInterest("set_backAmbientIntensity__",this),this._backDiffuseColor.addInterest("set_backDiffuseColor__",this),this._backSpecularColor.addInterest("set_backSpecularColor__",this),this._backEmissiveColor.addInterest("set_backEmissiveColor__",this),this._backShininess.addInterest("set_backShininess__",this),this._backTransparency.addInterest("set_backTransparency__",this),this._separateBackColor.addInterest("set_transparent__",this),this._transparency.addInterest("set_transparent__",this),this._backTransparency.addInterest("set_transparent__",this),this.set_ambientIntensity__(),this.set_diffuseColor__(),this.set_specularColor__(),this.set_emissiveColor__(),this.set_shininess__(),this.set_transparency__(),this.set_backAmbientIntensity__(),this.set_backDiffuseColor__(),this.set_backSpecularColor__(),this.set_backEmissiveColor__(),this.set_backShininess__(),this.set_backTransparency__(),this.set_transparent__()},set_ambientIntensity__(){this.ambientIntensity=Math.max(this._ambientIntensity.getValue(),0)},set_diffuseColor__(){const e=this.diffuseColor,t=this._diffuseColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_specularColor__(){const e=this.specularColor,t=this._specularColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_emissiveColor__(){const e=this.emissiveColor,t=this._emissiveColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_shininess__(){this.shininess=g.clamp(this._shininess.getValue(),0,1)},set_transparency__(){this.transparency=g.clamp(this._transparency.getValue(),0,1)},set_backAmbientIntensity__(){this.backAmbientIntensity=Math.max(this._backAmbientIntensity.getValue(),0)},set_backDiffuseColor__(){const e=this.backDiffuseColor,t=this._backDiffuseColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_backSpecularColor__(){const e=this.backSpecularColor,t=this._backSpecularColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_backEmissiveColor__(){const e=this.backEmissiveColor,t=this._backEmissiveColor.getValue();e[0]=t.r,e[1]=t.g,e[2]=t.b},set_backShininess__(){this.backShininess=g.clamp(this._backShininess.getValue(),0,1)},set_backTransparency__(){this.backTransparency=g.clamp(this._backTransparency.getValue(),0,1)},set_transparent__(){this.setTransparent(!!(this._transparency.getValue()||this._separateBackColor.getValue()&&this._backTransparency.getValue()))},getMaterialKey:Cb.prototype.getMaterialKey,getBaseTexture:Cb.prototype.getBaseTexture,createShader:Cb.prototype.createShader,setShaderUniforms(e,t,i,n,r,s){!s&&this._separateBackColor.getValue()?(e.uniform1f(t.x3d_AmbientIntensity,this.backAmbientIntensity),e.uniform3fv(t.x3d_DiffuseColor,this.backDiffuseColor),e.uniform3fv(t.x3d_SpecularColor,this.backSpecularColor),e.uniform3fv(t.x3d_EmissiveColor,this.backEmissiveColor),e.uniform1f(t.x3d_Shininess,this.backShininess),e.uniform1f(t.x3d_Transparency,this.backTransparency)):(e.uniform1f(t.x3d_AmbientIntensity,this.ambientIntensity),e.uniform3fv(t.x3d_DiffuseColor,this.diffuseColor),e.uniform3fv(t.x3d_SpecularColor,this.specularColor),e.uniform3fv(t.x3d_EmissiveColor,this.emissiveColor),e.uniform1f(t.x3d_Shininess,this.shininess),e.uniform1f(t.x3d_Transparency,this.transparency))}}),Object.defineProperties(Xb,{typeName:{value:"TwoSidedMaterial",enumerable:!0},componentInfo:{value:Object.freeze({name:"Shape",level:4}),enumerable:!0},containerField:{value:"material",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.2",to:"4.0"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"separateBackColor",new $n.SFBool),new k(d.inputOutput,"ambientIntensity",new $n.SFFloat(.2)),new k(d.inputOutput,"diffuseColor",new $n.SFColor(.8,.8,.8)),new k(d.inputOutput,"specularColor",new $n.SFColor),new k(d.inputOutput,"emissiveColor",new $n.SFColor),new k(d.inputOutput,"shininess",new $n.SFFloat(.2)),new k(d.inputOutput,"transparency",new $n.SFFloat),new k(d.inputOutput,"backAmbientIntensity",new $n.SFFloat(.2)),new k(d.inputOutput,"backDiffuseColor",new $n.SFColor(.8,.8,.8)),new k(d.inputOutput,"backSpecularColor",new $n.SFColor),new k(d.inputOutput,"backEmissiveColor",new $n.SFColor),new k(d.inputOutput,"backShininess",new $n.SFFloat(.2)),new k(d.inputOutput,"backTransparency",new $n.SFFloat)]),enumerable:!0}});const jb=Xb;i.add("TwoSidedMaterial","x_ite/Components/Shape/TwoSidedMaterial",jb);const kb=jb;function zb(e){Tb.call(this,e),this.addType(d.UnlitMaterial)}Object.assign(Object.setPrototypeOf(zb.prototype,Tb.prototype),{initialize(){Tb.prototype.initialize.call(this),this._emissiveTexture.addInterest("set_transparent__",this),this.set_transparent__()},getMaterialKey:()=>"0",getTextureIndices:(()=>{let e=0;const t={EMISSIVE_TEXTURE:e++,NORMAL_TEXTURE:e++};return function(){return t}})(),set_emissiveTexture__(){this.getEmissiveTexture()?._transparent.removeInterest("set_transparent__",this),Tb.prototype.set_emissiveTexture__.call(this),this.getEmissiveTexture()?._transparent.addInterest("set_transparent__",this)},set_transparent__(){this.setTransparent(!(!this.getTransparency()&&!this.getEmissiveTexture()?.isTransparent()))},createShader(e,t,i){const n=this.getBrowser(),r=this.getShaderOptions(t,i);r.push("X3D_UNLIT_MATERIAL");const s=n.createShader("Unlit","Default","Unlit",r);return n.getShaders().set(e,s),s}}),Object.defineProperties(zb,{typeName:{value:"UnlitMaterial",enumerable:!0},componentInfo:{value:Object.freeze({name:"Shape",level:1}),enumerable:!0},containerField:{value:"material",enumerable:!0},specificationRange:{value:Object.freeze({from:"4.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"emissiveColor",new $n.SFColor(1,1,1)),new k(d.inputOutput,"emissiveTextureMapping",new $n.SFString),new k(d.inputOutput,"emissiveTexture",new $n.SFNode),new k(d.inputOutput,"normalScale",new $n.SFFloat(1)),new k(d.inputOutput,"normalTextureMapping",new $n.SFString),new k(d.inputOutput,"normalTexture",new $n.SFNode),new k(d.inputOutput,"transparency",new $n.SFFloat)]),enumerable:!0}});for(const e of Object.values(zb.prototype.getTextureIndices()))zb.prototype[`setTexture${e}`]=function(e,t){this.setTexture(e,t)};const Gb=zb;i.add("UnlitMaterial","x_ite/Components/Shape/UnlitMaterial",Gb);const Hb=Gb,qb={name:"Shape",concreteNodes:[rb,db,gb,_b,Cb,Fb,Rb,Ub,kb,Hb],abstractNodes:[kl,ab,wb,Tb,Vb]};i.add("Shape","x_ite/Components/Shape",qb);const Yb=qb;var Wb=n(328);function $b(e){Yr.call(this,e),mu.call(this,e),this.addType(d.X3DSoundProcessingNode),this.addChildObjects(d.inputOutput,"loop",new $n.SFBool(!0),d.inputOutput,"active",new $n.SFBool);const t=this.getBrowser().getAudioContext();this.childNodes=[],this.gainNode=new GainNode(t)}Object.assign(Object.setPrototypeOf($b.prototype,Yr.prototype),mu.prototype,{initialize(){Yr.prototype.initialize.call(this),mu.prototype.initialize.call(this),this._active.addInterest("set_gain__",this),this._gain.addInterest("set_gain__",this),this._channelCount.addInterest("set_channelCount__",this),this._channelCountMode.addInterest("set_channelCountMode__",this),this._channelInterpretation.addInterest("set_channelInterpretation__",this),this._children.addInterest("set_children__",this),this._active.addInterest("set_active__",this),this.set_gain__(),this.set_channelCount__(),this.set_channelCountMode__(),this.set_channelInterpretation__(),this.set_children__()},getAudioSource(){return this.gainNode},getSoundProcessor(){return this.gainNode},set_gain__(){this.gainNode.gain.value=this._active.getValue()?this._gain.getValue():1},set_channelCount__(){this.getSoundProcessor().channelCount=Math.max(this._channelCount.getValue(),1)},set_channelCountMode__:function(){const e=new Set(["max","clamped-max","explicit"]);return function(){const t=this._channelCountMode.getValue().toLowerCase().replaceAll("_","-");this.getSoundProcessor().channelCountMode=e.has(t)?t:"max"}}(),set_channelInterpretation__:function(){const e=new Set(["speakers","discrete"]);return function(){const t=this._channelInterpretation.getValue().toLowerCase();this.getSoundProcessor().channelInterpretation=e.has(t)?t:"speakers"}}(),set_children__(){this.set_disconnect__(),this.childNodes.length=0;for(const e of this._children){const t=Yl(d.X3DChildNode,e);if(!t)continue;const i=t.getType();for(let e=i.length-1;e>=0;--e){switch(i[e]){case d.X3DSoundChannelNode:case d.X3DSoundProcessingNode:case d.X3DSoundSourceNode:this.childNodes.push(t);break;default:continue}break}}this.set_active__()},set_disconnect__(){for(const e of this.childNodes)Wb.try((()=>e.getAudioSource().disconnect(this.gainNode)));for(const e of this.childNodes)Wb.try((()=>e.getAudioSource().disconnect(this.getSoundProcessor())))},set_active__(){if(this.set_disconnect__(),this._active.getValue())for(const e of this.childNodes)Wb.try((()=>e.getAudioSource().connect(this.getSoundProcessor())),!0);else for(const e of this.childNodes)Wb.try((()=>e.getAudioSource().connect(this.gainNode)),!0)},set_start(){this._active.getValue()||(this._active=!0)},set_pause(){this._active.getValue()&&(this._active=!1)},set_resume(){this._active.getValue()||(this._active=!0)},set_stop(){this._active.getValue()&&(this._active=!1)},set_time(){this._elapsedTime=this.getElapsedTime()},dispose(){mu.prototype.dispose.call(this),Yr.prototype.dispose.call(this)}}),Object.defineProperties($b,{typeName:{value:"X3DSoundProcessingNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Sound",level:2}),enumerable:!0}});const Jb=$b;i.add("X3DSoundProcessingNode","x_ite/Components/Sound/X3DSoundProcessingNode",Jb);const Kb=Jb;function Zb(e){Kb.call(this,e),this.addType(d.Analyser);const t=this.getBrowser().getAudioContext();this.analyzerNode=new AnalyserNode(t),this.byteFrequencyData=new Uint8Array(this.analyzerNode.frequencyBinCount),this.byteTimeDomainData=new Uint8Array(this.analyzerNode.frequencyBinCount),this.analyzerNode.connect(this.getAudioSource())}Object.assign(Object.setPrototypeOf(Zb.prototype,Kb.prototype),{initialize(){Kb.prototype.initialize.call(this),this._fftSize.addInterest("set_fftSize__",this),this._minDecibels.addInterest("set_decibels__",this),this._maxDecibels.addInterest("set_decibels__",this),this._smoothingTimeConstant.addInterest("set_smoothingTimeConstant__",this),this.set_fftSize__(),this.set_decibels__(),this.set_smoothingTimeConstant__()},getSoundProcessor(){return this.analyzerNode},set_fftSize__(){this.analyzerNode.fftSize=g.clamp(g.nextPowerOfTwo(this._fftSize.getValue()),32,32768),this._frequencyBinCount=this.analyzerNode.frequencyBinCount},set_decibels__(){const e=Math.min(this._minDecibels.getValue(),0),t=Math.min(this._maxDecibels.getValue(),0);this.analyzerNode.minDecibels=Math.min(e,t),this.analyzerNode.maxDecibels=Math.max(e,t)},set_smoothingTimeConstant__(){this.analyzerNode.smoothingTimeConstant=g.clamp(this._smoothingTimeConstant.getValue(),0,1)},set_time(){Kb.prototype.set_time.call(this);const e=this.analyzerNode,t=e.frequencyBinCount;this.byteFrequencyData.length!==t&&(this.byteFrequencyData=new Uint8Array(t),this.byteTimeDomainData=new Uint8Array(t)),this._byteFrequencyData.length=t,this._byteTimeDomainData.length=t,this._floatFrequencyData.length=t,this._floatTimeDomainData.length=t,e.getByteFrequencyData(this.byteFrequencyData),e.getByteTimeDomainData(this.byteTimeDomainData),this._byteFrequencyData.getValue().set(this.byteFrequencyData),this._byteTimeDomainData.getValue().set(this.byteTimeDomainData),e.getFloatFrequencyData(this._floatFrequencyData.shrinkToFit()),e.getFloatTimeDomainData(this._floatTimeDomainData.shrinkToFit()),this._byteFrequencyData.addEvent(),this._byteTimeDomainData.addEvent(),this._floatFrequencyData.addEvent(),this._floatTimeDomainData.addEvent()}}),Object.defineProperties(Zb,{typeName:{value:"Analyser",enumerable:!0},componentInfo:{value:Object.freeze({name:"Sound",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"4.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"gain",new $n.SFFloat(1)),new k(d.inputOutput,"fftSize",new $n.SFInt32(2048)),new k(d.inputOutput,"minDecibels",new $n.SFFloat(-100)),new k(d.inputOutput,"maxDecibels",new $n.SFFloat(-30)),new k(d.inputOutput,"smoothingTimeConstant",new $n.SFFloat(.8)),new k(d.inputOutput,"tailTime",new $n.SFTime),new k(d.outputOnly,"frequencyBinCount",new $n.SFInt32),new k(d.outputOnly,"byteFrequencyData",new $n.MFInt32),new k(d.outputOnly,"byteTimeDomainData",new $n.MFInt32),new k(d.outputOnly,"floatFrequencyData",new $n.MFFloat),new k(d.outputOnly,"floatTimeDomainData",new $n.MFFloat),new k(d.inputOutput,"channelCount",new $n.SFInt32),new k(d.inputOutput,"channelCountMode",new $n.SFString("MAX")),new k(d.inputOutput,"channelInterpretation",new $n.SFString("SPEAKERS")),new k(d.inputOutput,"startTime",new $n.SFTime),new k(d.inputOutput,"resumeTime",new $n.SFTime),new k(d.inputOutput,"pauseTime",new $n.SFTime),new k(d.inputOutput,"stopTime",new $n.SFTime),new k(d.outputOnly,"isPaused",new $n.SFBool),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"elapsedTime",new $n.SFTime),new k(d.inputOutput,"children",new $n.MFNode)]),enumerable:!0}});const Qb=Zb;i.add("Analyser","x_ite/Components/Sound/Analyser",Qb);const eS=Qb;function tS(e){Yr.call(this,e),mu.call(this,e),this.addType(d.X3DSoundSourceNode);const t=this.getBrowser().getAudioContext();this.gainNode=new GainNode(t),this.mediaElement=null}Object.assign(Object.setPrototypeOf(tS.prototype,Yr.prototype),mu.prototype,{initialize(){Yr.prototype.initialize.call(this),mu.prototype.initialize.call(this),this._gain.addInterest("set_gain__",this),this.set_gain__()},getAudioSource(){return this.gainNode},setMediaElement(e){this.mediaElement?.pause(),this.mediaElement=e,e&&(this.set_loop(),this._duration_changed=this.mediaElement.duration,this.resetElapsedTime(),this._isActive.getValue()?this._isPaused.getValue()?this.set_pause():this.getLiveState()?this.set_start():this.set_pause():this.set_stop())},set_gain__(){this.gainNode.gain.value=this._gain.getValue()},set_pitch(){},set_loop(){this.mediaElement&&(this.mediaElement.loop=this._loop.getValue())},set_start(){this.mediaElement&&(this.mediaElement.currentTime=0,this.getBrowser().startAudioElement(this.mediaElement))},set_pause(){this.mediaElement?.pause()},set_resume(){this.mediaElement?.play().catch(Function.prototype)},set_stop(){this.mediaElement?.pause()},set_end(){this._loop.getValue()||this.stop()},set_time(){this._elapsedTime=this.getElapsedTime(),this.mediaElement&&(this.mediaElement.currentTime<this.mediaElement.duration||this.set_end())},dispose(){mu.prototype.dispose.call(this),Yr.prototype.dispose.call(this)}}),Object.defineProperties(tS,{typeName:{value:"X3DSoundSourceNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Sound",level:1}),enumerable:!0}});const iS=tS;i.add("X3DSoundSourceNode","x_ite/Components/Sound/X3DSoundSourceNode",iS);const nS=iS;var rS=n(328);function sS(e){nS.call(this,e),Ts.call(this,e),this.addType(d.AudioClip);const t=this.getBrowser().getAudioContext();this.urlStack=new $n.MFString,this.audio=rS("<audio></audio>"),this.sourceNode=t.createMediaElementSource(this.audio[0]),this.sourceNode.connect(this.getAudioSource())}Object.assign(Object.setPrototypeOf(sS.prototype,nS.prototype),Ts.prototype,{initialize(){nS.prototype.initialize.call(this),Ts.prototype.initialize.call(this),this.audio.on("abort error",this.setError.bind(this)).on("suspend stalled",this.setTimeout.bind(this)).prop("crossOrigin","Anonymous").prop("preload","auto"),this.requestImmediateLoad().catch(Function.prototype)},set_live__(){nS.prototype.set_live__.call(this),Ts.prototype.set_live__.call(this)},unloadData(){this.setMediaElement(null)},loadData(){this.setMediaElement(null),this.urlStack.setValue(this._url),this.audio.on("loadeddata",this.setAudio.bind(this)),this.loadNext()},loadNext(){if(0===this.urlStack.length)return this.audio.off("loadeddata"),this._duration_changed=-1,void this.setLoadState(d.FAILED_STATE);this.URL=new URL(this.urlStack.shift(),this.getExecutionContext().getBaseURL()),"data:"!==this.URL.protocol&&(this.getCache()||this.URL.searchParams.set("_",Date.now())),this.audio.attr("src",this.URL.href),this.audio.get(0).load()},setTimeout(e){setTimeout((()=>{this.checkLoadState()===d.IN_PROGRESS_STATE&&this.setError(e)}),3e4)},setError(e){"data:"!==this.URL.protocol&&console.warn(`Error loading audio '${decodeURI(this.URL.href)}'`,e.type),this.loadNext()},setAudio(){try{S,this.audio.off("loadeddata"),this.setMediaElement(this.audio[0]),this.setLoadState(d.COMPLETE_STATE)}catch(e){this.setError({type:e.message})}},dispose(){Ts.prototype.dispose.call(this),nS.prototype.dispose.call(this)}}),Object.defineProperties(sS,{typeName:{value:"AudioClip",enumerable:!0},componentInfo:{value:Object.freeze({name:"Sound",level:1}),enumerable:!0},containerField:{value:"source",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"load",new $n.SFBool(!0)),new k(d.inputOutput,"url",new $n.MFString),new k(d.inputOutput,"autoRefresh",new $n.SFTime),new k(d.inputOutput,"autoRefreshTimeLimit",new $n.SFTime(3600)),new k(d.inputOutput,"gain",new $n.SFFloat(1)),new k(d.inputOutput,"pitch",new $n.SFFloat(1)),new k(d.inputOutput,"loop",new $n.SFBool),new k(d.inputOutput,"startTime",new $n.SFTime),new k(d.inputOutput,"resumeTime",new $n.SFTime),new k(d.inputOutput,"pauseTime",new $n.SFTime),new k(d.inputOutput,"stopTime",new $n.SFTime),new k(d.outputOnly,"isPaused",new $n.SFBool),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"elapsedTime",new $n.SFTime),new k(d.outputOnly,"duration_changed",new $n.SFTime(-1))]),enumerable:!0}});const oS=sS;i.add("AudioClip","x_ite/Components/Sound/AudioClip",oS);const aS=oS;function lS(e){Yr.call(this,e),this.addType(d.X3DSoundNode)}Object.setPrototypeOf(lS.prototype,Yr.prototype),Object.defineProperties(lS,{typeName:{value:"X3DSoundNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Sound",level:1}),enumerable:!0}});const uS=lS;i.add("X3DSoundNode","x_ite/Components/Sound/X3DSoundNode",uS);const hS=uS;var dS=n(328);function cS(e){hS.call(this,e),this.addType(d.X3DSoundDestinationNode);const t=this.getBrowser().getAudioContext();this.childNodes=[],this.gainNode=new GainNode(t)}Object.assign(Object.setPrototypeOf(cS.prototype,hS.prototype),{initialize(){hS.prototype.initialize.call(this),this.getLive().addInterest("set_enabled__",this),this._enabled.addInterest("set_enabled__",this),this._gain.addInterest("set_gain__",this),this._children.addInterest("set_children__",this),this.set_enabled__(),this.set_gain__(),this.set_children__()},getAudioSource(){return this.gainNode},set_enabled__(){this._enabled.getValue()&&this.getLive().getValue()?(this._channelCount.addInterest("set_channelCount__",this),this._channelCountMode.addInterest("set_channelCountMode__",this),this._channelInterpretation.addInterest("set_channelInterpretation__",this),this.gainNode.connect(this.getSoundDestination()),this.set_channelCount__(),this.set_channelCountMode__(),this.set_channelInterpretation__()):(this._channelCount.removeInterest("set_channelCount__",this),this._channelCountMode.removeInterest("set_channelCountMode__",this),this._channelInterpretation.removeInterest("set_channelInterpretation__",this),this.gainNode.disconnect()),this._isActive=this._enabled},set_gain__(){this.gainNode.gain.value=this._gain.getValue()},set_channelCount__(){this.getSoundDestination().channelCount=Math.max(this._channelCount.getValue(),1)},set_channelCountMode__:function(){const e=new Set(["max","clamped-max","explicit"]);return function(){const t=this._channelCountMode.getValue().toLowerCase().replaceAll("_","-");this.getSoundDestination().channelCountMode=e.has(t)?t:"max"}}(),set_channelInterpretation__:function(){const e=new Set(["speakers","discrete"]);return function(){const t=this._channelInterpretation.getValue().toLowerCase();this.getSoundDestination().channelInterpretation=e.has(t)?t:"speakers"}}(),set_children__(){for(const e of this.childNodes)dS.try((()=>e.getAudioSource().disconnect(this.gainNode)));this.childNodes.length=0;for(const e of this._children){const t=Yl(d.X3DChildNode,e);if(!t)continue;const i=t.getType();for(let e=i.length-1;e>=0;--e){switch(i[e]){case d.X3DSoundChannelNode:case d.X3DSoundProcessingNode:case d.X3DSoundSourceNode:this.childNodes.push(t);break;default:continue}break}}for(const e of this.childNodes)dS.try((()=>e.getAudioSource().connect(this.gainNode)),!0)}}),Object.defineProperties(cS,{typeName:{value:"X3DSoundDestinationNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Sound",level:2}),enumerable:!0}});const pS=cS;i.add("X3DSoundDestinationNode","x_ite/Components/Sound/X3DSoundDestinationNode",pS);const gS=pS;function fS(e){gS.call(this,e),this.addType(d.AudioDestination),this.audioElement=new Audio}Object.assign(Object.setPrototypeOf(fS.prototype,gS.prototype),{initialize(){gS.prototype.initialize.call(this);const e=this.getBrowser().getAudioContext();this._mediaDeviceID.addInterest("set_mediaDeviceID__",this),this._maxChannelCount=e.destination.maxChannelCount,this.set_mediaDeviceID__()},getSoundDestination(){return this.mediaStreamDestination},set_enabled__(){const e=this._enabled.getValue()&&this.getLive().getValue();if(!!this.mediaStreamDestination!==e){if(e){const e=this.getBrowser().getAudioContext();this.mediaStreamDestination=e.createMediaStreamDestination(),this.audioElement.srcObject=this.mediaStreamDestination.stream,this.getBrowser().startAudioElement(this.audioElement)}else{this.audioElement.pause();for(const e of this.mediaStreamDestination.stream.getAudioTracks())e.stop();for(const e of this.mediaStreamDestination.stream.getVideoTracks())e.stop();this.mediaStreamDestination=null}gS.prototype.set_enabled__.call(this)}},set_mediaDeviceID__(){this.audioElement.setSinkId&&this.audioElement.setSinkId(this._mediaDeviceID.getValue()).catch((e=>{console.error(e.message),this.audioElement.setSinkId("default").catch(Function.prototype)}))}}),Object.defineProperties(fS,{typeName:{value:"AudioDestination",enumerable:!0},componentInfo:{value:Object.freeze({name:"Sound",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"4.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"gain",new $n.SFFloat(1)),new k(d.inputOutput,"mediaDeviceID",new $n.SFString),new k(d.inputOutput,"channelCount",new $n.SFInt32),new k(d.inputOutput,"channelCountMode",new $n.SFString("MAX")),new k(d.inputOutput,"channelInterpretation",new $n.SFString("SPEAKERS")),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"maxChannelCount",new $n.SFInt32),new k(d.inputOutput,"children",new $n.MFNode)]),enumerable:!0}});const mS=fS;i.add("AudioDestination","x_ite/Components/Sound/AudioDestination",mS);const _S=mS;function xS(e){Kb.call(this,e),this.addType(d.BiquadFilter)}Object.setPrototypeOf(xS.prototype,Kb.prototype),Object.defineProperties(xS,{typeName:{value:"BiquadFilter",enumerable:!0},componentInfo:{value:Object.freeze({name:"Sound",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"4.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"gain",new $n.SFFloat(1)),new k(d.inputOutput,"frequency",new $n.SFFloat(350)),new k(d.inputOutput,"detune",new $n.SFFloat(0)),new k(d.inputOutput,"type",new $n.SFString("LOWPASS")),new k(d.inputOutput,"qualityFactor",new $n.SFFloat(1)),new k(d.inputOutput,"tailTime",new $n.SFTime),new k(d.inputOutput,"channelCount",new $n.SFInt32),new k(d.inputOutput,"channelCountMode",new $n.SFString("MAX")),new k(d.inputOutput,"channelInterpretation",new $n.SFString("SPEAKERS")),new k(d.inputOutput,"startTime",new $n.SFTime),new k(d.inputOutput,"resumeTime",new $n.SFTime),new k(d.inputOutput,"pauseTime",new $n.SFTime),new k(d.inputOutput,"stopTime",new $n.SFTime),new k(d.outputOnly,"isPaused",new $n.SFBool),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"elapsedTime",new $n.SFTime),new k(d.inputOutput,"children",new $n.MFNode)]),enumerable:!0}});const yS=xS;i.add("BiquadFilter","x_ite/Components/Sound/BiquadFilter",yS);const wS=yS;function bS(e){nS.call(this,e),Ts.call(this,e),this.addType(d.BufferAudioSource)}Object.assign(Object.setPrototypeOf(bS.prototype,nS.prototype),Ts.prototype,{initialize(){nS.prototype.initialize.call(this),Ts.prototype.initialize.call(this)},dispose(){Ts.prototype.dispose.call(this),nS.prototype.dispose.call(this)}}),Object.defineProperties(bS,{typeName:{value:"BufferAudioSource",enumerable:!0},componentInfo:{value:Object.freeze({name:"Sound",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"4.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"load",new $n.SFBool(!0)),new k(d.inputOutput,"url",new $n.MFString),new k(d.inputOutput,"autoRefresh",new $n.SFTime),new k(d.inputOutput,"autoRefreshTimeLimit",new $n.SFTime(3600)),new k(d.inputOutput,"gain",new $n.SFFloat(1)),new k(d.inputOutput,"detune",new $n.SFFloat(0)),new k(d.inputOutput,"buffer",new $n.MFFloat),new k(d.inputOutput,"bufferDuration",new $n.SFTime),new k(d.outputOnly,"bufferLength",new $n.SFInt32),new k(d.inputOutput,"numberOfChannels",new $n.SFInt32),new k(d.inputOutput,"sampleRate",new $n.SFFloat(0)),new k(d.inputOutput,"playbackRate",new $n.SFFloat(1)),new k(d.inputOutput,"loopStart",new $n.SFTime),new k(d.inputOutput,"loopEnd",new $n.SFTime),new k(d.inputOutput,"channelCount",new $n.SFInt32),new k(d.inputOutput,"channelCountMode",new $n.SFString("MAX")),new k(d.inputOutput,"channelInterpretation",new $n.SFString("SPEAKERS")),new k(d.inputOutput,"loop",new $n.SFBool),new k(d.inputOutput,"startTime",new $n.SFTime),new k(d.inputOutput,"resumeTime",new $n.SFTime),new k(d.inputOutput,"pauseTime",new $n.SFTime),new k(d.inputOutput,"stopTime",new $n.SFTime),new k(d.outputOnly,"isPaused",new $n.SFBool),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"elapsedTime",new $n.SFTime)]),enumerable:!0}});const SS=bS;i.add("BufferAudioSource","x_ite/Components/Sound/BufferAudioSource",SS);const TS=SS;function vS(e){hS.call(this,e),this.addType(d.X3DSoundChannelNode)}Object.setPrototypeOf(vS.prototype,hS.prototype),Object.defineProperties(vS,{typeName:{value:"X3DSoundChannelNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Sound",level:2}),enumerable:!0}});const OS=vS;i.add("X3DSoundChannelNode","x_ite/Components/Sound/X3DSoundChannelNode",OS);const ES=OS;function CS(e){ES.call(this,e),this.addType(d.ChannelMerger)}Object.setPrototypeOf(CS.prototype,ES.prototype),Object.defineProperties(CS,{typeName:{value:"ChannelMerger",enumerable:!0},componentInfo:{value:Object.freeze({name:"Sound",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"4.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"gain",new $n.SFFloat(1)),new k(d.inputOutput,"channelCount",new $n.SFInt32),new k(d.inputOutput,"channelCountMode",new $n.SFString("MAX")),new k(d.inputOutput,"channelInterpretation",new $n.SFString("SPEAKERS")),new k(d.inputOutput,"children",new $n.MFNode)]),enumerable:!0}});const NS=CS;i.add("ChannelMerger","x_ite/Components/Sound/ChannelMerger",NS);const IS=NS;function FS(e){ES.call(this,e),this.addType(d.ChannelSelector)}Object.setPrototypeOf(FS.prototype,ES.prototype),Object.defineProperties(FS,{typeName:{value:"ChannelSelector",enumerable:!0},componentInfo:{value:Object.freeze({name:"Sound",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"4.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"gain",new $n.SFFloat(1)),new k(d.inputOutput,"channelSelection",new $n.SFInt32(0)),new k(d.inputOutput,"channelCount",new $n.SFInt32),new k(d.inputOutput,"channelCountMode",new $n.SFString("MAX")),new k(d.inputOutput,"channelInterpretation",new $n.SFString("SPEAKERS")),new k(d.inputOutput,"children",new $n.MFNode)]),enumerable:!0}});const MS=FS;i.add("ChannelSelector","x_ite/Components/Sound/ChannelSelector",MS);const DS=MS;function RS(e){ES.call(this,e),this.addType(d.ChannelSplitter)}Object.setPrototypeOf(RS.prototype,ES.prototype),Object.defineProperties(RS,{typeName:{value:"ChannelSplitter",enumerable:!0},componentInfo:{value:Object.freeze({name:"Sound",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"4.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"gain",new $n.SFFloat(1)),new k(d.inputOutput,"channelCount",new $n.SFInt32),new k(d.inputOutput,"channelCountMode",new $n.SFString("MAX")),new k(d.inputOutput,"channelInterpretation",new $n.SFString("SPEAKERS")),new k(d.inputOutput,"children",new $n.MFNode),new k(d.inputOutput,"outputs",new $n.MFNode)]),enumerable:!0}});const PS=RS;i.add("ChannelSplitter","x_ite/Components/Sound/ChannelSplitter",PS);const AS=PS;function VS(e){Kb.call(this,e),this.addType(d.Convolver)}Object.setPrototypeOf(VS.prototype,Kb.prototype),Object.defineProperties(VS,{typeName:{value:"Convolver",enumerable:!0},componentInfo:{value:Object.freeze({name:"Sound",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"4.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"gain",new $n.SFFloat(1)),new k(d.inputOutput,"buffer",new $n.MFFloat),new k(d.inputOutput,"normalize",new $n.SFBool),new k(d.inputOutput,"tailTime",new $n.SFTime),new k(d.inputOutput,"channelCount",new $n.SFInt32),new k(d.inputOutput,"channelCountMode",new $n.SFString("MAX")),new k(d.inputOutput,"channelInterpretation",new $n.SFString("SPEAKERS")),new k(d.inputOutput,"startTime",new $n.SFTime),new k(d.inputOutput,"resumeTime",new $n.SFTime),new k(d.inputOutput,"pauseTime",new $n.SFTime),new k(d.inputOutput,"stopTime",new $n.SFTime),new k(d.outputOnly,"isPaused",new $n.SFBool),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"elapsedTime",new $n.SFTime),new k(d.inputOutput,"children",new $n.MFNode)]),enumerable:!0}});const LS=VS;i.add("Convolver","x_ite/Components/Sound/Convolver",LS);const BS=LS;function US(e){Kb.call(this,e),this.addType(d.Delay)}Object.setPrototypeOf(US.prototype,Kb.prototype),Object.defineProperties(US,{typeName:{value:"Delay",enumerable:!0},componentInfo:{value:Object.freeze({name:"Sound",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"4.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"gain",new $n.SFFloat(1)),new k(d.inputOutput,"delayTime",new $n.SFTime),new k(d.inputOutput,"maxDelayTime",new $n.SFTime(1)),new k(d.inputOutput,"tailTime",new $n.SFTime),new k(d.inputOutput,"channelCount",new $n.SFInt32),new k(d.inputOutput,"channelCountMode",new $n.SFString("MAX")),new k(d.inputOutput,"channelInterpretation",new $n.SFString("SPEAKERS")),new k(d.inputOutput,"startTime",new $n.SFTime),new k(d.inputOutput,"resumeTime",new $n.SFTime),new k(d.inputOutput,"pauseTime",new $n.SFTime),new k(d.inputOutput,"stopTime",new $n.SFTime),new k(d.outputOnly,"isPaused",new $n.SFBool),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"elapsedTime",new $n.SFTime),new k(d.inputOutput,"children",new $n.MFNode)]),enumerable:!0}});const XS=US;i.add("Delay","x_ite/Components/Sound/Delay",XS);const jS=XS;function kS(e){Kb.call(this,e),this.addType(d.DynamicsCompressor)}Object.setPrototypeOf(kS.prototype,Kb.prototype),Object.defineProperties(kS,{typeName:{value:"DynamicsCompressor",enumerable:!0},componentInfo:{value:Object.freeze({name:"Sound",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"4.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"gain",new $n.SFFloat(1)),new k(d.inputOutput,"attack",new $n.SFFloat(.003)),new k(d.inputOutput,"knee",new $n.SFFloat(30)),new k(d.inputOutput,"ratio",new $n.SFFloat(12)),new k(d.inputOutput,"reduction",new $n.SFFloat),new k(d.inputOutput,"release",new $n.SFTime(.25)),new k(d.inputOutput,"threshold",new $n.SFFloat(-24)),new k(d.inputOutput,"tailTime",new $n.SFTime),new k(d.inputOutput,"channelCount",new $n.SFInt32),new k(d.inputOutput,"channelCountMode",new $n.SFString("MAX")),new k(d.inputOutput,"channelInterpretation",new $n.SFString("SPEAKERS")),new k(d.inputOutput,"startTime",new $n.SFTime),new k(d.inputOutput,"resumeTime",new $n.SFTime),new k(d.inputOutput,"pauseTime",new $n.SFTime),new k(d.inputOutput,"stopTime",new $n.SFTime),new k(d.outputOnly,"isPaused",new $n.SFBool),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"elapsedTime",new $n.SFTime),new k(d.inputOutput,"children",new $n.MFNode)]),enumerable:!0}});const zS=kS;i.add("DynamicsCompressor","x_ite/Components/Sound/DynamicsCompressor",zS);const GS=zS;function HS(e){Kb.call(this,e),this.addType(d.Gain)}Object.setPrototypeOf(HS.prototype,Kb.prototype),Object.defineProperties(HS,{typeName:{value:"Gain",enumerable:!0},componentInfo:{value:Object.freeze({name:"Sound",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"4.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"gain",new $n.SFFloat(1)),new k(d.inputOutput,"tailTime",new $n.SFTime),new k(d.inputOutput,"channelCount",new $n.SFInt32),new k(d.inputOutput,"channelCountMode",new $n.SFString("MAX")),new k(d.inputOutput,"channelInterpretation",new $n.SFString("SPEAKERS")),new k(d.inputOutput,"startTime",new $n.SFTime),new k(d.inputOutput,"resumeTime",new $n.SFTime),new k(d.inputOutput,"pauseTime",new $n.SFTime),new k(d.inputOutput,"stopTime",new $n.SFTime),new k(d.outputOnly,"isPaused",new $n.SFBool),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"elapsedTime",new $n.SFTime),new k(d.inputOutput,"children",new $n.MFNode)]),enumerable:!0}});const qS=HS;i.add("Gain","x_ite/Components/Sound/Gain",qS);const YS=qS;function WS(e){nS.call(this,e),this.addType(d.ListenerPointSource),this.addChildObjects(d.inputOutput,"loop",new $n.SFBool),this._position.setUnit("length")}Object.setPrototypeOf(WS.prototype,nS.prototype),Object.defineProperties(WS,{typeName:{value:"ListenerPointSource",enumerable:!0},componentInfo:{value:Object.freeze({name:"Sound",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"4.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"position",new $n.SFVec3f),new k(d.inputOutput,"orientation",new $n.SFRotation),new k(d.inputOutput,"gain",new $n.SFFloat(1)),new k(d.inputOutput,"dopplerEnabled",new $n.SFBool),new k(d.inputOutput,"interauralDistance",new $n.SFFloat),new k(d.inputOutput,"trackCurrentView",new $n.SFBool),new k(d.inputOutput,"startTime",new $n.SFTime),new k(d.inputOutput,"resumeTime",new $n.SFTime),new k(d.inputOutput,"pauseTime",new $n.SFTime),new k(d.inputOutput,"stopTime",new $n.SFTime),new k(d.outputOnly,"isPaused",new $n.SFBool),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"elapsedTime",new $n.SFTime)]),enumerable:!0}});const $S=WS;i.add("ListenerPointSource","x_ite/Components/Sound/ListenerPointSource",$S);const JS=$S;var KS=n(328);function ZS(e){nS.call(this,e),this.addType(d.MicrophoneSource),this.addChildObjects(d.inputOutput,"loop",new $n.SFBool(!0))}Object.assign(Object.setPrototypeOf(ZS.prototype,nS.prototype),{initialize(){nS.prototype.initialize.call(this),this._mediaDeviceID.addInterest("set_mediaDeviceID__",this)},set_mediaDeviceID__(){this.set_stop(),this._isActive.getValue()&&this.set_start()},set_start(){navigator.mediaDevices&&(this.restore=!1,navigator.mediaDevices.getUserMedia({audio:{deviceId:this._mediaDeviceID.getValue()}}).then((e=>{const t=this.getBrowser().getAudioContext();this.mediaStreamSource=t.createMediaStreamSource(e),this._isActive.getValue()?this._isPaused.getValue()||!this.getLive().getValue()?this.set_pause():this.set_resume():this.set_stop()})).catch((e=>{console.error(e.message)})))},set_pause(){if(this.mediaStreamSource)if(this.getLive().getValue()){KS.try((()=>this.mediaStreamSource.disconnect(this.getAudioSource())));for(const e of this.mediaStreamSource.mediaStream.getAudioTracks())e.enabled=!1;for(const e of this.mediaStreamSource.mediaStream.getVideoTracks())e.enabled=!1}else this.set_stop(!0)},set_resume(){if(this.restore)return this.set_start();if(this.mediaStreamSource){this.mediaStreamSource.connect(this.getAudioSource());for(const e of this.mediaStreamSource.mediaStream.getAudioTracks())e.enabled=!0;for(const e of this.mediaStreamSource.mediaStream.getVideoTracks())e.enabled=!0}},set_stop(e=!1){if(this.mediaStreamSource){KS.try((()=>this.mediaStreamSource.disconnect(this.getAudioSource())));for(const e of this.mediaStreamSource.mediaStream.getAudioTracks())e.stop();for(const e of this.mediaStreamSource.mediaStream.getVideoTracks())e.stop();this.mediaStreamSource=null,this.restore=e}}}),Object.defineProperties(ZS,{typeName:{value:"MicrophoneSource",enumerable:!0},componentInfo:{value:Object.freeze({name:"Sound",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"4.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"gain",new $n.SFFloat(1)),new k(d.inputOutput,"mediaDeviceID",new $n.SFString),new k(d.inputOutput,"startTime",new $n.SFTime),new k(d.inputOutput,"resumeTime",new $n.SFTime),new k(d.inputOutput,"pauseTime",new $n.SFTime),new k(d.inputOutput,"stopTime",new $n.SFTime),new k(d.outputOnly,"isPaused",new $n.SFBool),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"elapsedTime",new $n.SFTime)]),enumerable:!0}});const QS=ZS;i.add("MicrophoneSource","x_ite/Components/Sound/MicrophoneSource",QS);const eT=QS;function tT(e){nS.call(this,e),this.addType(d.OscillatorSource),this.addChildObjects(d.inputOutput,"loop",new $n.SFBool);const t=this.getBrowser().getAudioContext();this.oscillatorNode=new OscillatorNode(t),this.mergerNode=new ChannelMergerNode(t,{numberOfInputs:2})}Object.assign(Object.setPrototypeOf(tT.prototype,nS.prototype),{initialize(){nS.prototype.initialize.call(this),this._detune.addInterest("set_detune__",this),this._frequency.addInterest("set_frequency__",this),this._periodicWave.addInterest("set_periodicWave__",this),this.set_periodicWave__()},set_type__:function(){const e=new Set(["sine","square","sawtooth","triangle"]);return function(){this.periodicWaveNode._optionsReal.removeInterest("set_periodicWaveOptions__",this),this.periodicWaveNode._optionsImag.removeInterest("set_periodicWaveOptions__",this);const t=this.periodicWaveNode._type.getValue().toLowerCase();"custom"===t?(this.periodicWaveNode._optionsReal.addInterest("set_periodicWaveOptions__",this),this.periodicWaveNode._optionsImag.addInterest("set_periodicWaveOptions__",this),this.set_periodicWaveOptions__()):this.oscillatorNode.type=e.has(t)?t:"square"}}(),set_frequency__(){this.oscillatorNode.frequency.value=this._frequency.getValue()},set_detune__(){this.oscillatorNode.detune.value=this._detune.getValue()},set_periodicWave__(){this.periodicWaveNode?._type.removeInterest("set_type__",this),this.periodicWaveNode=Yl(d.PeriodicWave,this._periodicWave)??this.getBrowser().getDefaultPeriodicWave(),this.periodicWaveNode._type.addInterest("set_type__",this),this.set_type__()},set_periodicWaveOptions__(){this.oscillatorNode.setPeriodicWave(this.periodicWaveNode.createPeriodicWave())},set_start(){const e=this.getBrowser().getAudioContext();this.oscillatorNode=new OscillatorNode(e),this.set_type__(),this.set_frequency__(),this.set_detune__(),this.oscillatorNode.connect(this.mergerNode,0,0),this.oscillatorNode.connect(this.mergerNode,0,1),this.mergerNode.connect(this.getAudioSource()),this.oscillatorNode.start()},set_pause(){this.mergerNode.disconnect()},set_resume(){this.mergerNode.connect(this.getAudioSource())},set_stop(){this.oscillatorNode.stop(),this.oscillatorNode.disconnect()}}),Object.defineProperties(tT,{typeName:{value:"OscillatorSource",enumerable:!0},componentInfo:{value:Object.freeze({name:"Sound",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"4.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"gain",new $n.SFFloat(1)),new k(d.inputOutput,"frequency",new $n.SFFloat),new k(d.inputOutput,"detune",new $n.SFFloat),new k(d.inputOutput,"periodicWave",new $n.SFNode),new k(d.inputOutput,"startTime",new $n.SFTime),new k(d.inputOutput,"resumeTime",new $n.SFTime),new k(d.inputOutput,"pauseTime",new $n.SFTime),new k(d.inputOutput,"stopTime",new $n.SFTime),new k(d.outputOnly,"isPaused",new $n.SFBool),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"elapsedTime",new $n.SFTime)]),enumerable:!0}});const iT=tT;i.add("OscillatorSource","x_ite/Components/Sound/OscillatorSource",iT);const nT=iT;function rT(e){hS.call(this,e),this.addType(d.PeriodicWave),this.real=new Float32Array(2),this.imag=new Float32Array(2)}Object.assign(Object.setPrototypeOf(rT.prototype,hS.prototype),{createPeriodicWave(){const e=this.getBrowser().getAudioContext(),t=this._optionsReal.shrinkToFit(),i=this._optionsImag.shrinkToFit(),n=Math.max(t.length,i.length,2);return this.real.length!==n&&(this.real=new Float32Array(n),this.imag=new Float32Array(n)),this.real.set(t),this.imag.set(i),e.createPeriodicWave(this.real,this.imag)}}),Object.defineProperties(rT,{typeName:{value:"PeriodicWave",enumerable:!0},componentInfo:{value:Object.freeze({name:"Sound",level:2}),enumerable:!0},containerField:{value:"periodicWave",enumerable:!0},specificationRange:{value:Object.freeze({from:"4.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"type",new $n.SFString("SQUARE")),new k(d.inputOutput,"optionsReal",new $n.MFFloat),new k(d.inputOutput,"optionsImag",new $n.MFFloat)]),enumerable:!0}});const sT=rT;i.add("PeriodicWave","x_ite/Components/Sound/PeriodicWave",sT);const oT=sT;function aT(e){hS.call(this,e),this.addType(d.Sound),this.addChildObjects(d.outputOnly,"traversed",new $n.SFBool(!0)),this._location.setUnit("length"),this._minBack.setUnit("length"),this._minFront.setUnit("length"),this._maxBack.setUnit("length"),this._maxFront.setUnit("length"),this.childNodes=[],this.currentTraversed=!0}Object.assign(Object.setPrototypeOf(aT.prototype,hS.prototype),{initialize(){hS.prototype.initialize.call(this);const e=this.getBrowser().getAudioContext(),t=new ChannelSplitterNode(e,{numberOfOutputs:2}),i=new ChannelMergerNode(e,{numberOfInputs:2}),n=new GainNode(e,{gain:0}),r=new GainNode(e,{gain:0});t.connect(n,0),t.connect(r,1),n.connect(i,0,0),r.connect(i,0,1),i.connect(e.destination),this.splitterNode=t,this.gainLeftNode=n,this.gainRightNode=r,this.getLive().addInterest("set_live__",this),this._traversed.addInterest("set_live__",this),this._source.addInterest("set_children__",this),this._children.addInterest("set_children__",this),this.set_live__(),this.set_children__()},setTraversed(e){e?!1===this._traversed.getValue()&&(this._traversed=!0):this.currentTraversed!==this._traversed.getValue()&&(this._traversed=this.currentTraversed),this.currentTraversed=e},getTraversed(){return this.currentTraversed},setVolume(e,t=.5){this.gainLeftNode.gain.value=e*(1-t**2),this.gainRightNode.gain.value=e*(1-(1-t)**2)},set_live__(){this.getLive().getValue()&&this._traversed.getValue()?this.getBrowser().sensorEvents().addInterest("update",this):(this.getBrowser().sensorEvents().removeInterest("update",this),this.setVolume(0))},set_children__(){for(const e of this.childNodes)e.getAudioSource().disconnect(this.splitterNode);this.childNodes.length=0;const e=Yl(d.X3DSoundSourceNode,this._source);e&&this.childNodes.push(e);for(const e of this._children){const t=Yl(d.X3DChildNode,e);if(!t)continue;const i=t.getType();for(let e=i.length-1;e>=0;--e){switch(i[e]){case d.X3DSoundChannelNode:case d.X3DSoundProcessingNode:case d.X3DSoundSourceNode:this.childNodes.push(t);break;default:continue}break}}for(const e of this.childNodes)e.getAudioSource().connect(this.splitterNode)},update(){this.getTraversed()||this.setVolume(0),this.setTraversed(!1)},traverse:(()=>{const e={distance:0,intersection:new Tt(0,0,0)},t={distance:0,intersection:new Tt(0,0,0)};return function(i,n){if(i!==Ma.DISPLAY)return;if(!this.childNodes.length)return;this.setTraversed(!0);const r=n.getModelViewMatrix().get();if(this.getEllipsoidParameter(r,Math.max(this._maxBack.getValue(),0),Math.max(this._maxFront.getValue(),0),t),t.distance<1){this.getEllipsoidParameter(r,Math.max(this._minBack.getValue(),0),Math.max(this._minFront.getValue(),0),e);const i=this.getPan(r);if(e.distance<1)this.setVolume(g.clamp(this._intensity.getValue(),0,1),i);else{const n=t.intersection.magnitude(),r=t.intersection.distance(e.intersection),s=Math.min(n/r,1),o=g.clamp(this._intensity.getValue(),0,1)*s;this.setVolume(o,i)}}else this.setVolume(0)}})(),getEllipsoidParameter:(()=>{const e=new Tt(0,0,0),t=new gi,i=new gi,n=new ui,r=new Tt(1,1,1),s=new pm(1,Tt.Zero),o=new Tt(0,0,0),a=new za(Tt.Zero,Tt.zAxis),l=new Tt(0,0,0),u=new Tt(0,0,0);return function(h,d,c,p){if(0==d||0==c)return t.multVecMatrix(p.intersection.assign(this._location.getValue())),void(p.distance=1);const g=(d+c)/2,f=g-d,m=Math.sqrt(g*g-f*f);e.set(0,0,f),r.set(m,m,g),n.setFromToVec(Tt.zAxis,this._direction.getValue()),t.assign(h).translate(this._location.getValue()).rotate(n).translate(e).scale(r),i.assign(t).inverse();const _=i.origin;e.negate().divVec(r),o.assign(e).subtract(_).normalize(),a.set(_,o),s.intersectsLine(a,l,u),p.intersection.assign(t.multVecMatrix(l)),p.distance=_.magnitude()}})(),getPan:function(){const e=new Tt(0,0,0);return function(t){if(!this._spatialize.getValue())return.5;const i=t.multVecMatrix(e.assign(this._location.getValue())).normalize();return Math.acos(g.clamp(-i.dot(Tt.xAxis),-1,1))/Math.PI}}()}),Object.defineProperties(aT,{typeName:{value:"Sound",enumerable:!0},componentInfo:{value:Object.freeze({name:"Sound",level:1}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.initializeOnly,"spatialize",new $n.SFBool(!0)),new k(d.inputOutput,"intensity",new $n.SFFloat(1)),new k(d.inputOutput,"location",new $n.SFVec3f),new k(d.inputOutput,"direction",new $n.SFVec3f(0,0,1)),new k(d.inputOutput,"minBack",new $n.SFFloat(1)),new k(d.inputOutput,"minFront",new $n.SFFloat(1)),new k(d.inputOutput,"maxBack",new $n.SFFloat(10)),new k(d.inputOutput,"maxFront",new $n.SFFloat(10)),new k(d.inputOutput,"priority",new $n.SFFloat),new k(d.inputOutput,"source",new $n.SFNode),new k(d.inputOutput,"children",new $n.MFNode)]),enumerable:!0}});const lT=aT;i.add("Sound","x_ite/Components/Sound/Sound",lT);const uT=lT;function hT(e){hS.call(this,e),this.addType(d.SpatialSound),this._location.setUnit("length")}Object.setPrototypeOf(hT.prototype,hS.prototype),Object.defineProperties(hT,{typeName:{value:"SpatialSound",enumerable:!0},componentInfo:{value:Object.freeze({name:"Sound",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"4.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.initializeOnly,"spatialize",new $n.SFBool(!0)),new k(d.inputOutput,"coneInnerAngle",new $n.SFFloat(6.2832)),new k(d.inputOutput,"coneOuterAngle",new $n.SFFloat(6.2832)),new k(d.inputOutput,"coneOuterGain",new $n.SFFloat(0)),new k(d.inputOutput,"direction",new $n.SFVec3f(0,0,1)),new k(d.inputOutput,"distanceModel",new $n.SFString("INVERSE")),new k(d.inputOutput,"dopplerEnabled",new $n.SFBool),new k(d.inputOutput,"enableHRTF",new $n.SFBool),new k(d.inputOutput,"gain",new $n.SFFloat(1)),new k(d.inputOutput,"intensity",new $n.SFFloat(1)),new k(d.inputOutput,"location",new $n.SFVec3f),new k(d.inputOutput,"maxDistance",new $n.SFFloat(1e4)),new k(d.inputOutput,"priority",new $n.SFFloat),new k(d.inputOutput,"referenceDistance",new $n.SFFloat(1)),new k(d.inputOutput,"rolloffFactor",new $n.SFFloat(1)),new k(d.inputOutput,"children",new $n.MFNode)]),enumerable:!0}});const dT=hT;i.add("SpatialSound","x_ite/Components/Sound/SpatialSound",dT);const cT=dT;function pT(e){gS.call(this,e),this.addType(d.StreamAudioDestination);const t=this.getBrowser().getAudioContext();this.mediaStreamDestination=t.createMediaStreamDestination()}Object.assign(Object.setPrototypeOf(pT.prototype,gS.prototype),{initialize(){gS.prototype.initialize.call(this),this._streamIdentifier[0]=this.mediaStreamDestination.stream.id},getSoundDestination(){return this.mediaStreamDestination}}),Object.defineProperties(pT,{typeName:{value:"StreamAudioDestination",enumerable:!0},componentInfo:{value:Object.freeze({name:"Sound",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"4.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"gain",new $n.SFFloat(1)),new k(d.inputOutput,"channelCount",new $n.SFInt32),new k(d.inputOutput,"channelCountMode",new $n.SFString("MAX")),new k(d.inputOutput,"channelInterpretation",new $n.SFString("SPEAKERS")),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"streamIdentifier",new $n.MFString),new k(d.inputOutput,"children",new $n.MFNode)]),enumerable:!0}});const gT=pT;i.add("StreamAudioDestination","x_ite/Components/Sound/StreamAudioDestination",gT);const fT=gT;function mT(e){nS.call(this,e),this.addType(d.StreamAudioSource),this.addChildObjects(d.inputOutput,"loop",new $n.SFBool)}Object.setPrototypeOf(mT.prototype,nS.prototype),Object.defineProperties(mT,{typeName:{value:"StreamAudioSource",enumerable:!0},componentInfo:{value:Object.freeze({name:"Sound",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"4.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"gain",new $n.SFFloat(1)),new k(d.inputOutput,"streamIdentifier",new $n.MFString),new k(d.inputOutput,"startTime",new $n.SFTime),new k(d.inputOutput,"resumeTime",new $n.SFTime),new k(d.inputOutput,"pauseTime",new $n.SFTime),new k(d.inputOutput,"stopTime",new $n.SFTime),new k(d.outputOnly,"isPaused",new $n.SFBool),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"elapsedTime",new $n.SFTime)]),enumerable:!0}});const _T=mT;i.add("StreamAudioSource","x_ite/Components/Sound/StreamAudioSource",_T);const xT=_T;function yT(e){Kb.call(this,e),this.addType(d.WaveShaper)}Object.setPrototypeOf(yT.prototype,Kb.prototype),Object.defineProperties(yT,{typeName:{value:"WaveShaper",enumerable:!0},componentInfo:{value:Object.freeze({name:"Sound",level:2}),enumerable:!0},containerField:{value:"children",enumerable:!0},specificationRange:{value:Object.freeze({from:"4.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"gain",new $n.SFFloat(1)),new k(d.inputOutput,"curve",new $n.MFFloat),new k(d.inputOutput,"oversample",new $n.SFString("NONE")),new k(d.inputOutput,"tailTime",new $n.SFTime),new k(d.inputOutput,"channelCount",new $n.SFInt32),new k(d.inputOutput,"channelCountMode",new $n.SFString("MAX")),new k(d.inputOutput,"channelInterpretation",new $n.SFString("SPEAKERS")),new k(d.inputOutput,"startTime",new $n.SFTime),new k(d.inputOutput,"resumeTime",new $n.SFTime),new k(d.inputOutput,"pauseTime",new $n.SFTime),new k(d.inputOutput,"stopTime",new $n.SFTime),new k(d.outputOnly,"isPaused",new $n.SFBool),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"elapsedTime",new $n.SFTime),new k(d.inputOutput,"children",new $n.MFNode)]),enumerable:!0}});const wT=yT;i.add("WaveShaper","x_ite/Components/Sound/WaveShaper",wT);const bT={name:"Sound",concreteNodes:[eS,aS,_S,wS,TS,IS,DS,AS,BS,jS,GS,YS,JS,eT,nT,oT,uT,cT,fT,xT,wT],abstractNodes:[ES,gS,hS,Kb,nS]};i.add("Sound","x_ite/Components/Sound",bT);const ST=bT;const TT=function(e,t){let i=1,n=0,r=!1;Object.defineProperties(e,{currentTime:{get(){return!r&&n<this.cycle?this.duration:t._elapsedTime*i%this.duration},set:Function.prototype},duration:{get(){return this.get_duration_ms()/1e3}},loop:{get:()=>r,set(e){n=this.cycle,r=e}},cycle:{get(){return Math.floor(t._elapsedTime/this.duration)}},currentFrame:{get(){const e=this.get_length();return this.get_frames()[Math.max(Math.ceil(this.currentTime/this.duration*e)-1,0)]}},play:{value(){return n=this.cycle,Promise.resolve()}},playbackRate:{get:()=>i,set(e){i=e}}})};i.add("GifMedia","x_ite/Browser/Texturing/GifMedia",TT);const vT=TT;var OT=n(328),ET=n(296);function CT(e){eu.call(this,e),nS.call(this,e),Ts.call(this,e),this.addType(d.MovieTexture);const t=this.getBrowser().getAudioContext();this.urlStack=new $n.MFString,this.video=OT("<video></video>"),this.sourceNode=t.createMediaElementSource(this.video[0]),this.mediaStreamDestination=t.createMediaStreamDestination(),this.sourceNode.connect(this.getAudioSource()).connect(this.mediaStreamDestination),this.getMatrix().set([1,0,0,0,0,-1,0,0,0,0,1,0,0,1,0,1])}Object.assign(Object.setPrototypeOf(CT.prototype,eu.prototype),nS.prototype,Ts.prototype,{initialize(){eu.prototype.initialize.call(this),nS.prototype.initialize.call(this),Ts.prototype.initialize.call(this),this._speed.addInterest("set_speed__",this),this.video.on("abort error",this.setError.bind(this)).on("suspend stalled",this.setTimeout.bind(this)).prop("crossOrigin","Anonymous").prop("preload","auto"),this.requestImmediateLoad().catch(Function.prototype)},set_live__(){nS.prototype.set_live__.call(this),Ts.prototype.set_live__.call(this)},getTextureType:()=>1,unloadData(){this.clearTexture()},loadData(){delete this.gif,this.setMediaElement(null),this.urlStack.setValue(this._url),this.video.on("loadeddata",this.setVideo.bind(this)),this.loadNext()},loadNext(){if(0===this.urlStack.length)return this.video.off("loadeddata"),this._duration_changed=-1,this.clearTexture(),void this.setLoadState(d.FAILED_STATE);if(this.URL=new URL(this.urlStack.shift(),this.getExecutionContext().getBaseURL()),"data:"!==this.URL.protocol&&(this.getCache()||this.URL.searchParams.set("_",Date.now())),this.URL.pathname.endsWith(".gif")){const e=OT("<img></img>").appendTo(OT("<div></div>")),t=new ET({gif:e[0],on_error:e=>this.setError({type:e})});t.load_url(this.URL,this.setGif.bind(this,t))}else this.video.attr("src",this.URL.href),this.video.get(0).load()},setTimeout(e){setTimeout((()=>{this.checkLoadState()===d.IN_PROGRESS_STATE&&this.setError(e)}),3e4)},setError(e){"data:"!==this.URL.protocol&&console.warn(`Error loading movie '${decodeURI(this.URL.href)}'`,e.type),this.loadNext()},setVideo(){try{S,this.video.off("loadeddata");const e=this.getBrowser().getContext(),t=this.video[0],i=t.videoWidth,n=t.videoHeight;if(!(1!==e.getVersion()||g.isPowerOfTwo(i)&&g.isPowerOfTwo(n)))throw new Error("The movie texture is a non power-of-two texture.");this.setMediaElement(this.video[0]),this.setTextureFromData(i,n,!0,!1,t),this.setLoadState(d.COMPLETE_STATE),this.set_speed__()}catch(e){this.setError({type:e.message})}},setGif(e){try{this.gif=e,vT(e,this),e.pause(),this.setMediaElement(e),this.setTextureFromData(e.get_canvas().width,e.get_canvas().height,!0,!1,e.get_frames()[0].data),this.setLoadState(d.COMPLETE_STATE),this.set_speed__()}catch(e){this.setError({type:e.message})}},set_speed__(){this.gif&&(this.gif.playbackRate=this._speed.getValue()),this.video[0].playbackRate=this._speed.getValue()},set_time(){nS.prototype.set_time.call(this),this.checkLoadState()===d.COMPLETE_STATE&&this.updateTextureFromData(this.gif?.currentFrame.data??this.video[0])},traverse:eu.prototype.traverse,dispose(){Ts.prototype.dispose.call(this),nS.prototype.dispose.call(this),eu.prototype.dispose.call(this)}}),Object.defineProperties(CT,{typeName:{value:"MovieTexture",enumerable:!0},componentInfo:{value:Object.freeze({name:"Texturing",level:3}),enumerable:!0},containerField:{value:"texture",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"enabled",new $n.SFBool(!0)),new k(d.inputOutput,"load",new $n.SFBool(!0)),new k(d.inputOutput,"url",new $n.MFString),new k(d.inputOutput,"autoRefresh",new $n.SFTime),new k(d.inputOutput,"autoRefreshTimeLimit",new $n.SFTime(3600)),new k(d.inputOutput,"gain",new $n.SFFloat(1)),new k(d.inputOutput,"speed",new $n.SFFloat(1)),new k(d.inputOutput,"pitch",new $n.SFFloat(1)),new k(d.inputOutput,"loop",new $n.SFBool),new k(d.inputOutput,"startTime",new $n.SFTime),new k(d.inputOutput,"resumeTime",new $n.SFTime),new k(d.inputOutput,"pauseTime",new $n.SFTime),new k(d.inputOutput,"stopTime",new $n.SFTime),new k(d.outputOnly,"isPaused",new $n.SFBool),new k(d.outputOnly,"isActive",new $n.SFBool),new k(d.outputOnly,"elapsedTime",new $n.SFTime),new k(d.outputOnly,"duration_changed",new $n.SFTime(-1)),new k(d.initializeOnly,"repeatS",new $n.SFBool(!0)),new k(d.initializeOnly,"repeatT",new $n.SFBool(!0)),new k(d.initializeOnly,"textureProperties",new $n.SFNode)]),enumerable:!0}});const NT=CT;i.add("MovieTexture","x_ite/Components/Texturing/MovieTexture",NT);const IT=NT;function FT(e){Hl.call(this,e),this.addType(d.MultiTexture);const t=this.getBrowser();this.maxTextures=t.getMaxTextures(),this.color=new Float32Array(4),this.modes=[],this.alphaModes=[],this.sources=[],this.functions=[],this.textureNodes=[]}Object.assign(Object.setPrototypeOf(FT.prototype,Hl.prototype),{initialize(){Hl.prototype.initialize.call(this),this._color.addInterest("set_color__",this),this._alpha.addInterest("set_alpha__",this),this._mode.addInterest("set_mode__",this),this._source.addInterest("set_source__",this),this._function.addInterest("set_function__",this),this._texture.addInterest("set_texture__",this),this.set_color__(),this.set_alpha__(),this.set_mode__(),this.set_source__(),this.set_function__(),this.set_texture__()},getCount(){return Math.min(this.maxTextures,this.textureNodes.length)},getMode(e){return e<this.modes.length?this.modes[e]:ox.MODULATE},getAlphaMode(e){return e<this.alphaModes.length?this.alphaModes[e]:ox.MODULATE},getSource(e){return e<this.sources.length?this.sources[e]:ux.DEFAULT},getFunction(e){return e<this.functions.length?this.functions[e]:cx.DEFAULT},set_color__(){this.color[0]=this._color.r,this.color[1]=this._color.g,this.color[2]=this._color.b},set_alpha__(){this.color[3]=this._alpha},set_mode__:(()=>{const e=new Map([["REPLACE",ox.REPLACE],["MODULATE",ox.MODULATE],["MODULATE2X",ox.MODULATE2X],["MODULATE4X",ox.MODULATE4X],["ADD",ox.ADD],["ADDSIGNED",ox.ADDSIGNED],["ADDSIGNED2X",ox.ADDSIGNED2X],["ADDSMOOTH",ox.ADDSMOOTH],["SUBTRACT",ox.SUBTRACT],["BLENDDIFFUSEALPHA",ox.BLENDDIFFUSEALPHA],["BLENDTEXTUREALPHA",ox.BLENDTEXTUREALPHA],["BLENDFACTORALPHA",ox.BLENDFACTORALPHA],["BLENDCURRENTALPHA",ox.BLENDCURRENTALPHA],["MODULATEALPHA_ADDCOLOR",ox.MODULATEALPHA_ADDCOLOR],["MODULATEINVALPHA_ADDCOLOR",ox.MODULATEINVALPHA_ADDCOLOR],["MODULATEINVCOLOR_ADDALPHA",ox.MODULATEINVCOLOR_ADDALPHA],["DOTPRODUCT3",ox.DOTPRODUCT3],["SELECTARG1",ox.SELECTARG1],["SELECTARG2",ox.SELECTARG2],["OFF",ox.OFF]]);return function(){this.modes.length=0,this.alphaModes.length=0;for(const t of this._mode){const i=t.split(",");for(let e=0,t=i.length;e<t;++e)i[e]=i[e].trim();0===i.length&&i.push("MODULATE"),i.length<2&&i.push(i[0]);const n=e.get(i[0]);void 0!==n?this.modes.push(n):this.modes.push(ox.MODULATE);const r=e.get(i[1]);void 0!==r?this.alphaModes.push(r):this.alphaModes.push(ox.MODULATE)}}})(),set_source__:(()=>{const e=new Map([["DIFFUSE",ux.DIFFUSE],["SPECULAR",ux.SPECULAR],["FACTOR",ux.FACTOR]]);return function(){this.sources.length=0;for(const t of this._source){const i=e.get(t);void 0!==i?this.sources.push(i):this.sources.push(ux.DEFAULT)}}})(),set_function__:(()=>{const e=new Map([["COMPLEMENT",cx.COMPLEMENT],["ALPHAREPLICATE",cx.ALPHAREPLICATE]]);return function(){this.functions.length=0;for(const t of this._function){const i=e.get(t);void 0!==i?this.functions.push(i):this.functions.push(cx.DEFAULT)}}})(),set_texture__(){for(const e of this.textureNodes)e._linear.removeInterest("addNodeEvent",this);this.textureNodes.length=0;for(const e of this._texture){const t=Yl(d.X3DSingleTextureNode,e);t&&this.textureNodes.push(t)}for(const e of this.textureNodes)e._linear.addInterest("addNodeEvent",this)},updateTextureBits(e){const t=this.maxTextures,i=this.textureNodes,n=Math.min(t,i.length);for(let t=0;t<n;++t)i[t].updateTextureBits(e,t);e.set(2*t,1)},getShaderOptions(e){const t=this.textureNodes,i=Math.min(this.maxTextures,t.length);for(let n=0;n<i;++n)t[n].getShaderOptions(e,n)},traverse(e,t){for(const i of this.textureNodes)i.traverse(e,t)},setShaderUniforms(e,t,i){const n=this.textureNodes,r=Math.min(this.maxTextures,n.length);e.uniform4fv(t.x3d_MultiTextureColor,this.color);for(let s=0;s<r;++s)n[s].setShaderUniforms(e,t,i,t.x3d_Texture[s]),e.uniform1i(t.x3d_MultiTextureMode[s],this.getMode(s)),e.uniform1i(t.x3d_MultiTextureAlphaMode[s],this.getAlphaMode(s)),e.uniform1i(t.x3d_MultiTextureSource[s],this.getSource(s)),e.uniform1i(t.x3d_MultiTextureFunction[s],this.getFunction(s))}}),Object.defineProperties(FT,{typeName:{value:"MultiTexture",enumerable:!0},componentInfo:{value:Object.freeze({name:"Texturing",level:2}),enumerable:!0},containerField:{value:"texture",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"color",new $n.SFColor(1,1,1)),new k(d.inputOutput,"alpha",new $n.SFFloat(1)),new k(d.inputOutput,"mode",new $n.MFString),new k(d.inputOutput,"source",new $n.MFString),new k(d.inputOutput,"function",new $n.MFString),new k(d.inputOutput,"texture",new $n.MFNode)]),enumerable:!0}});const MT=FT;i.add("MultiTexture","x_ite/Components/Texturing/MultiTexture",MT);const DT=MT;function RT(e){Qh.call(this,e),this.addType(d.X3DTextureCoordinateNode)}Object.setPrototypeOf(RT.prototype,Qh.prototype),Object.defineProperties(RT,{typeName:{value:"X3DTextureCoordinateNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Texturing",level:1}),enumerable:!0}});const PT=RT;i.add("X3DTextureCoordinateNode","x_ite/Components/Texturing/X3DTextureCoordinateNode",PT);const AT=PT;function VT(e){AT.call(this,e),this.addType(d.MultiTextureCoordinate);const t=this.getBrowser();this.maxTexCoords=t.getMaxTexCoords(),this.textureCoordinateNodes=[]}Object.assign(Object.setPrototypeOf(VT.prototype,AT.prototype),{initialize(){AT.prototype.initialize.call(this),this._texCoord.addInterest("set_texCoord__",this),this.set_texCoord__()},set_texCoord__(){const e=this.textureCoordinateNodes;for(const t of e)t.removeInterest("addNodeEvent",this);e.length=0;for(const t of this._texCoord){const i=Yl(d.X3DSingleTextureCoordinateNode,t);i&&e.push(i)}for(const t of e)t.addInterest("addNodeEvent",this)},getCount(){return Math.min(this.maxTexCoords,this.textureCoordinateNodes.length)},isEmpty:()=>!0,getSize:()=>0,init(e){const t=this.textureCoordinateNodes,i=Math.min(this.maxTexCoords,t.length);for(let n=0;n<i;++n)t[n].init(e)},addPoint(e,t){const i=this.textureCoordinateNodes,n=Math.min(this.maxTexCoords,i.length);for(let r=0;r<n;++r)i[r].addPointToChannel(e,t[r])},addPoints(e){for(const t of this.textureCoordinateNodes)return t.addPoints(e);return e},getTextureCoordinateMapping(e){const t=this.textureCoordinateNodes,i=Math.min(this.maxTexCoords,t.length);for(let n=0;n<i;++n)t[n].getTextureCoordinateMapping(e,n)},setShaderUniforms(e,t){const i=this.textureCoordinateNodes,n=Math.min(this.maxTexCoords,i.length);if(n)for(let r=0;r<n;++r)i[r].setShaderUniforms(e,t,r);else this.getBrowser().getDefaultTextureCoordinate().setShaderUniforms(e,t,0)}}),Object.defineProperties(VT,{typeName:{value:"MultiTextureCoordinate",enumerable:!0},componentInfo:{value:Object.freeze({name:"Texturing",level:2}),enumerable:!0},containerField:{value:"texCoord",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"texCoord",new $n.MFNode)]),enumerable:!0}});const LT=VT;i.add("MultiTextureCoordinate","x_ite/Components/Texturing/MultiTextureCoordinate",LT);const BT=LT;function UT(e){kl.call(this,e),this.addType(d.X3DTextureTransformNode)}Object.setPrototypeOf(UT.prototype,kl.prototype),Object.defineProperties(UT,{typeName:{value:"X3DTextureTransformNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Texturing",level:1}),enumerable:!0}});const XT=UT;i.add("X3DTextureTransformNode","x_ite/Components/Texturing/X3DTextureTransformNode",XT);const jT=XT;function kT(e){jT.call(this,e),this.addType(d.MultiTextureTransform);const t=this.getBrowser();this.maxTextureTransforms=t.getMaxTextureTransforms(),this.textureTransformNodes=[]}Object.assign(Object.setPrototypeOf(kT.prototype,jT.prototype),{initialize(){jT.prototype.initialize.call(this),this._textureTransform.addInterest("set_textureTransform__",this),this.set_textureTransform__()},set_textureTransform__(){const e=this.textureTransformNodes;e.length=0;for(const t of this._textureTransform){const i=Yl(d.X3DSingleTextureTransformNode,t);i&&e.push(i)}e.length||e.push(this.getBrowser().getDefaultTextureTransform())},getCount(){return Math.min(this.maxTextureTransforms,this.textureTransformNodes.length)},getTextureTransformMapping(e){const t=this.textureTransformNodes,i=Math.min(this.maxTextureTransforms,t.length);for(let n=0;n<i;++n)t[n].getTextureTransformMapping(e,n)},setShaderUniforms(e,t){const i=this.textureTransformNodes,n=Math.min(this.maxTextureTransforms,i.length);for(let r=0;r<n;++r)i[r].setShaderUniforms(e,t,r)},transformPoint(e){return this.textureTransformNodes[0].transformPoint(e)}}),Object.defineProperties(kT,{typeName:{value:"MultiTextureTransform",enumerable:!0},componentInfo:{value:Object.freeze({name:"Texturing",level:2}),enumerable:!0},containerField:{value:"textureTransform",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"textureTransform",new $n.MFNode)]),enumerable:!0}});const zT=kT;i.add("MultiTextureTransform","x_ite/Components/Texturing/MultiTextureTransform",zT);const GT=zT;function HT(e){eu.call(this,e),this.addType(d.PixelTexture),this.addChildObjects(d.outputOnly,"loadState",new $n.SFInt32(d.NOT_STARTED_STATE))}Object.assign(Object.setPrototypeOf(HT.prototype,eu.prototype),{initialize(){eu.prototype.initialize.call(this),this._image.addInterest("set_image__",this),this.set_image__()},getTextureType:()=>2,checkLoadState(){return this._loadState.getValue()},convert(e,t,i,n){switch(t){case 1:for(let t=0,r=0;t<n;++t,r+=4){const n=i[t];e[r]=e[r+1]=e[r+2]=255&n,e[r+3]=255}break;case 2:for(let t=0,r=0;t<n;++t,r+=4){const n=i[t];e[r]=e[r+1]=e[r+2]=n>>>8&255,e[r+3]=255&n}break;case 3:for(let t=0,r=0;t<n;++t,r+=4){const n=i[t];e[r]=n>>>16&255,e[r+1]=n>>>8&255,e[r+2]=255&n,e[r+3]=255}break;case 4:for(let t=0,r=0;t<n;++t,r+=4){const n=i[t];e[r]=n>>>24,e[r+1]=n>>>16&255,e[r+2]=n>>>8&255,e[r+3]=255&n}}},resize(e,t,i,n,r){const s=new Uint8Array(n*r*4),o=n/t,a=r/i;for(let i=0;i<r;++i){const r=Math.floor(i/a)*t,l=i*n;for(let t=0;t<n;++t){const i=4*(r+Math.floor(t/o)),n=4*(l+t);s[n]=e[i],s[n+1]=e[i+1],s[n+2]=e[i+2],s[n+3]=e[i+3]}}return s},set_image__(){const e=this.getBrowser().getContext(),t=this._image.comp,i=this._image.array,n=!(t%2);let r=this._image.width,s=this._image.height,o=null;if(r>0&&s>0&&t>0&&t<5){if(e.getVersion()>=2||g.isPowerOfTwo(r)&&g.isPowerOfTwo(s))o=new Uint8Array(r*s*4),this.convert(o,t,i.getValue(),i.length);else if(Math.max(r,s)<this.getBrowser().getMinTextureSize()&&!this._textureProperties.getValue()){o=new Uint8Array(r*s*4),this.convert(o,t,i.getValue(),i.length);const e=r,n=s;r=8*g.nextPowerOfTwo(e),s=8*g.nextPowerOfTwo(n),o=this.resize(o,e,n,r,s)}else{this.canvas||(this.canvas=[document.createElement("canvas"),document.createElement("canvas")]);const e=this.canvas[0],n=this.canvas[1],a=e.getContext("2d",{willReadFrequently:!0}),l=n.getContext("2d",{willReadFrequently:!0}),u=a.createImageData(r,s);e.width=r,e.height=s,this.convert(u.data,t,i.getValue(),i.length),a.putImageData(u,0,0),r=g.nextPowerOfTwo(r),s=g.nextPowerOfTwo(s),n.width=r,n.height=s,l.clearRect(0,0,r,s),l.drawImage(e,0,0,e.width,e.height,0,0,r,s),o=new Uint8Array(l.getImageData(0,0,r,s).data.buffer)}this.setTextureFromData(r,s,!0,n,o),this._loadState=d.COMPLETE_STATE}else this.clearTexture(),this._loadState=d.FAILED_STATE}}),Object.defineProperties(HT,{typeName:{value:"PixelTexture",enumerable:!0},componentInfo:{value:Object.freeze({name:"Texturing",level:1}),enumerable:!0},containerField:{value:"texture",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"description",new $n.SFString),new k(d.inputOutput,"image",new $n.SFImage),new k(d.initializeOnly,"repeatS",new $n.SFBool(!0)),new k(d.initializeOnly,"repeatT",new $n.SFBool(!0)),new k(d.initializeOnly,"textureProperties",new $n.SFNode)]),enumerable:!0}});const qT=HT;i.add("PixelTexture","x_ite/Components/Texturing/PixelTexture",qT);const YT=qT;function WT(e){AT.call(this,e),this.addType(d.X3DSingleTextureCoordinateNode),this.texCoordArray=Il.createArray()}Object.assign(Object.setPrototypeOf(WT.prototype,AT.prototype),{getCount:()=>1,init(e){this.texCoordArray.length=0,e.push(this.texCoordArray)},addPoint(e,t){this.addPointToChannel(e,t[0])},getTextureCoordinateMapping(e,t=0){e.set(this._mapping.getValue()||t,t)},setShaderUniforms(e,t,i=0){e.uniform1i(t.x3d_TextureCoordinateGeneratorMode[i],0)}}),Object.defineProperties(WT,{typeName:{value:"X3DSingleTextureCoordinateNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Texturing",level:1}),enumerable:!0}});const $T=WT;i.add("X3DSingleTextureCoordinateNode","x_ite/Components/Texturing/X3DSingleTextureCoordinateNode",$T);const JT=$T;function KT(e){JT.call(this,e),this.addType(d.TextureCoordinate)}Object.assign(Object.setPrototypeOf(KT.prototype,JT.prototype),{initialize(){JT.prototype.initialize.call(this),this._point.addInterest("set_point__",this),this.set_point__()},set_point__(){this.point=this._point.getValue(),this.length=this._point.length},isEmpty(){return 0===this.length},getSize(){return this.length},addPointToChannel(e,t){if(e>=0&&this.length){const i=this.point,n=e%this.length*2;t.push(i[n],i[n+1],0,1)}else t.push(0,0,0,1)},addPoints(e){const t=this.point,i=this.length;for(let n=0,r=0;n<i;++n,r+=2)e.push(t[r],t[r+1],0,1);return e}}),Object.defineProperties(KT,{typeName:{value:"TextureCoordinate",enumerable:!0},componentInfo:{value:Object.freeze({name:"Texturing",level:1}),enumerable:!0},containerField:{value:"texCoord",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"mapping",new $n.SFString),new k(d.inputOutput,"point",new $n.MFVec2f)]),enumerable:!0}});const ZT=KT;i.add("TextureCoordinate","x_ite/Components/Texturing/TextureCoordinate",ZT);const QT=ZT;function ev(e){JT.call(this,e),this.addType(d.TextureCoordinateGenerator),this.mode=fx.SPHERE,this.parameter=new Float32Array(6)}Object.assign(Object.setPrototypeOf(ev.prototype,JT.prototype),{initialize(){JT.prototype.initialize.call(this),this._mode.addInterest("set_mode__",this),this._parameter.addInterest("set_parameter__",this),this.set_mode__(),this.set_parameter__()},set_mode__:(()=>{const e=new Map([["SPHERE",fx.SPHERE],["CAMERASPACENORMAL",fx.CAMERASPACENORMAL],["CAMERASPACEPOSITION",fx.CAMERASPACEPOSITION],["CAMERASPACEREFLECTIONVECTOR",fx.CAMERASPACEREFLECTIONVECTOR],["SPHERE-LOCAL",fx.SPHERE_LOCAL],["COORD",fx.COORD],["COORD-EYE",fx.COORD_EYE],["NOISE",fx.NOISE],["NOISE-EYE",fx.NOISE_EYE],["SPHERE-REFLECT",fx.SPHERE_REFLECT],["SPHERE-REFLECT-LOCAL",fx.SPHERE_REFLECT_LOCAL]]);return function(){this.mode=e.get(this._mode.getValue()),void 0===this.mode&&(this.mode=fx.SPHERE)}})(),set_parameter__(){const e=Math.min(this.parameter.length,this._parameter.length);for(let t=0;t<e;++t)this.parameter[t]=this._parameter[t];this.parameter.fill(0,e)},addPointToChannel(e,t){t.push(0,0,0,1)},addPoints:e=>e,setShaderUniforms(e,t,i=0){e.uniform1i(t.x3d_TextureCoordinateGeneratorMode[i],this.mode),e.uniform1fv(t.x3d_TextureCoordinateGeneratorParameter[i],this.parameter)}}),Object.defineProperties(ev,{typeName:{value:"TextureCoordinateGenerator",enumerable:!0},componentInfo:{value:Object.freeze({name:"Texturing",level:2}),enumerable:!0},containerField:{value:"texCoord",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"mapping",new $n.SFString),new k(d.inputOutput,"mode",new $n.SFString("SPHERE")),new k(d.inputOutput,"parameter",new $n.MFFloat)]),enumerable:!0}});const tv=ev;i.add("TextureCoordinateGenerator","x_ite/Components/Texturing/TextureCoordinateGenerator",tv);const iv=tv;function nv(e){Sr.call(this,e),this.addType(d.TextureProperties),e.getSpecificationVersion()<=3.3&&(this._minificationFilter="DEFAULT",this._magnificationFilter="DEFAULT",this._textureCompression="DEFAULT")}Object.assign(Object.setPrototypeOf(nv.prototype,Sr.prototype),{getBorderWidth(){return g.clamp(this._borderWidth.getValue(),0,1)},getBoundaryMode:(()=>{const e=new Map([["CLAMP","CLAMP_TO_EDGE"],["CLAMP_TO_EDGE","CLAMP_TO_EDGE"],["CLAMP_TO_BOUNDARY","CLAMP_TO_EDGE"],["MIRRORED_REPEAT","MIRRORED_REPEAT"],["REPEAT","REPEAT"]]);return function(t){const i=e.get(t);return void 0!==i?i:"REPEAT"}})(),getBoundaryModeS(){return this.getBoundaryMode(this._boundaryModeS.getValue())},getBoundaryModeT(){return this.getBoundaryMode(this._boundaryModeT.getValue())},getBoundaryModeR(){return this.getBoundaryMode(this._boundaryModeR.getValue())},getMinificationFilter:(()=>{const e=new Map([["AVG_PIXEL_AVG_MIPMAP","LINEAR_MIPMAP_LINEAR"],["AVG_PIXEL","LINEAR"],["AVG_PIXEL_NEAREST_MIPMAP","LINEAR_MIPMAP_NEAREST"],["NEAREST_PIXEL_AVG_MIPMAP","NEAREST_MIPMAP_LINEAR"],["NEAREST_PIXEL_NEAREST_MIPMAP","NEAREST_MIPMAP_NEAREST"],["NEAREST_PIXEL","NEAREST"],["NICEST","LINEAR_MIPMAP_LINEAR"],["FASTEST","NEAREST"]]);return function(){if(this._generateMipMaps.getValue()){const t=e.get(this._minificationFilter.getValue());return void 0!==t?t:this.getBrowser().getDefaultTextureProperties().getMinificationFilter()}return"LINEAR"}})(),getMagnificationFilter:(()=>{const e=new Map([["AVG_PIXEL","LINEAR"],["NEAREST_PIXEL","NEAREST"],["NICEST","LINEAR"],["FASTEST","NEAREST"]]);return function(){const t=e.get(this._magnificationFilter.getValue());return void 0!==t?t:this.getBrowser().getDefaultTextureProperties().getMagnificationFilter()}})(),getTextureCompression:(()=>{const e=new Map([["DEFAULT","RGBA"],["NICEST","RGBA"],["FASTEST","RGBA"],["LOW","RGBA"],["MEDIUM","RGBA"],["HIGH","RGBA"]]);return function(){const t=this.getBrowser().getContext(),i=t.getExtension("WEBGL_compressed_texture_etc"),n=i?i[e.get(this._textureCompression.getValue())]:void 0;return void 0!==n?n:t.RGBA}})()}),Object.defineProperties(nv,{typeName:{value:"TextureProperties",enumerable:!0},componentInfo:{value:Object.freeze({name:"Texturing",level:2}),enumerable:!0},containerField:{value:"textureProperties",enumerable:!0},specificationRange:{value:Object.freeze({from:"3.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"borderColor",new $n.SFColorRGBA),new k(d.inputOutput,"borderWidth",new $n.SFInt32),new k(d.inputOutput,"anisotropicDegree",new $n.SFFloat(1)),new k(d.initializeOnly,"generateMipMaps",new $n.SFBool),new k(d.inputOutput,"minificationFilter",new $n.SFString("FASTEST")),new k(d.inputOutput,"magnificationFilter",new $n.SFString("FASTEST")),new k(d.inputOutput,"boundaryModeS",new $n.SFString("REPEAT")),new k(d.inputOutput,"boundaryModeT",new $n.SFString("REPEAT")),new k(d.inputOutput,"boundaryModeR",new $n.SFString("REPEAT")),new k(d.inputOutput,"textureCompression",new $n.SFString("FASTEST")),new k(d.inputOutput,"texturePriority",new $n.SFFloat)]),enumerable:!0}});const rv=nv;i.add("TextureProperties","x_ite/Components/Texturing/TextureProperties",rv);const sv=rv;function ov(e){jT.call(this,e),this.addType(d.X3DSingleTextureTransformNode),this.matrixArray=new Float32Array(gi.Identity)}Object.assign(Object.setPrototypeOf(ov.prototype,jT.prototype),{getCount:()=>1,getMatrix(){return this.matrixArray},setMatrix(e){this.matrixArray.set(e)},getTextureTransformMapping(e,t=0){e.set(this._mapping.getValue()||t,t)},setShaderUniforms(e,t,i=0){e.uniformMatrix4fv(t.x3d_TextureMatrix[i],!1,this.matrixArray)},transformPoint(e){return gi.prototype.multVecMatrix.call(this.matrixArray,e)}}),Object.defineProperties(ov,{typeName:{value:"X3DSingleTextureTransformNode",enumerable:!0},componentInfo:{value:Object.freeze({name:"Texturing",level:1}),enumerable:!0}});const av=ov;i.add("X3DSingleTextureTransformNode","x_ite/Components/Texturing/X3DSingleTextureTransformNode",av);const lv=av;function uv(e){lv.call(this,e),this.addType(d.TextureTransform),this._rotation.setUnit("angle"),this.matrix=new gi}Object.assign(Object.setPrototypeOf(uv.prototype,lv.prototype),{initialize(){lv.prototype.initialize.call(this),this.addInterest("eventsProcessed",this),this.eventsProcessed()},eventsProcessed:(()=>{const e=new _t(0,0),t=new At;return function(){const i=this._translation.getValue(),n=this._rotation.getValue(),r=this._scale.getValue(),s=this._center.getValue(),o=this.matrix;t.identity(),s.equals(_t.Zero)||t.translate(e.assign(s).negate()),r.equals(_t.One)||t.scale(r),0!==n&&t.rotate(n),s.equals(_t.Zero)||t.translate(s),i.equals(_t.Zero)||t.translate(i),o[0]=t[0],o[1]=t[1],o[4]=t[3],o[5]=t[4],o[12]=t[6],o[13]=t[7],this.setMatrix(o)}})()}),Object.defineProperties(uv,{typeName:{value:"TextureTransform",enumerable:!0},componentInfo:{value:Object.freeze({name:"Texturing",level:1}),enumerable:!0},containerField:{value:"textureTransform",enumerable:!0},specificationRange:{value:Object.freeze({from:"2.0",to:"Infinity"}),enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"metadata",new $n.SFNode),new k(d.inputOutput,"mapping",new $n.SFString),new k(d.inputOutput,"translation",new $n.SFVec2f),new k(d.inputOutput,"rotation",new $n.SFFloat),new k(d.inputOutput,"scale",new $n.SFVec2f(1,1)),new k(d.inputOutput,"center",new $n.SFVec2f)]),enumerable:!0}});const hv=uv;i.add("TextureTransform","x_ite/Components/Texturing/TextureTransform",hv);const dv=hv,cv={name:"Texturing",concreteNodes:[ru,IT,DT,BT,GT,YT,QT,iv,sv,dv],abstractNodes:[JT,Jl,lv,eu,AT,Hl,jT]};i.add("Texturing","x_ite/Components/Texturing",cv);const pv=cv,gv={name:"Time",concreteNodes:[yu],abstractNodes:[mu]};i.add("Time","x_ite/Components/Time",gv);const fv=gv,mv={create(e,t,i,n){const r={preserveDrawingBuffer:i};let s=null;if(t>=2&&!s&&(s=e.getContext("webgl2",{...r,antialias:!1}),s&&(s.getVersion=()=>2)),t>=1&&!s&&(s=e.getContext("webgl",r)||e.getContext("experimental-webgl",r),s)){s.getVersion=()=>1;{const e=s.getExtension("OES_vertex_array_object");s.bindVertexArray=e.bindVertexArrayOES.bind(e),s.createVertexArray=e.createVertexArrayOES.bind(e),s.deleteVertexArray=e.deleteVertexArrayOES.bind(e),s.isVertexArray=e.isVertexArrayOES.bind(e)}}if(!s)throw new Error("Couldn't create WebGL context.");for(const e of s.getSupportedExtensions())s.getExtension(e);const o=s.getParameter(s.ALIASED_LINE_WIDTH_RANGE);if(1===o[0]&&1===o[1]?(s.lineWidth=Function.prototype,s.HAS_FEATURE_TRANSFORMED_LINES=s.getVersion()>=2):s.HAS_FEATURE_TRANSFORMED_LINES=!1,s.HAS_FEATURE_DEPTH_TEXTURE=s.getVersion()>=2||!!s.getExtension("WEBGL_depth_texture"),s.HAS_FEATURE_FRAG_DEPTH=s.getVersion()>=2||!!s.getExtension("EXT_frag_depth"),1===s.getVersion()){const e=s.getExtension("WEBGL_color_buffer_float"),t=s.getExtension("WEBGL_draw_buffers");s.RGBA32F=e.RGBA32F_EXT,s.MAX_COLOR_ATTACHMENTS=t.MAX_COLOR_ATTACHMENTS_WEBGL,s.drawBuffers=t.drawBuffersWEBGL.bind(t);for(let e=0,i=s.getParameter(s.MAX_COLOR_ATTACHMENTS);e<i;++e){const i=t.COLOR_ATTACHMENT0_WEBGL+e;void 0===s[`COLOR_ATTACHMENT${e}`]&&(s[`COLOR_ATTACHMENT${e}`]=i)}}if(n){const e=s.getExtension("EXT_color_buffer_half_float");Object.defineProperty(s,"RGBA32F",{value:1===s.getVersion()?e.RGBA16F_EXT:s.RGBA16F})}return Object.assign(s,1===s.getVersion()?{readPixelsAsync:s.readPixels}:{clientWaitAsync(e,t,i){return new Promise(((n,r)=>{const s=()=>{switch(this.clientWaitSync(e,t,0)){case this.WAIT_FAILED:return void r(new Error("clientWaitSync: WAIT_FAILED"));case this.TIMEOUT_EXPIRED:return void setTimeout(s,i);default:return void n()}};setTimeout(s)}))},getBufferSubDataAsync:async function(e,t,i,n,r,s){const o=this.fenceSync(this.SYNC_GPU_COMMANDS_COMPLETE,0);this.flush(),await this.clientWaitAsync(o,0,10),this.deleteSync(o),this.bindBuffer(e,t),this.getBufferSubData(e,i,n,r,s),this.bindBuffer(e,null)},readPixelsAsync:async function(e,t,i,n,r,s,o,a){const l=this.createBuffer();this.bindBuffer(this.PIXEL_PACK_BUFFER,l),this.bufferData(this.PIXEL_PACK_BUFFER,o.byteLength,this.STREAM_READ),this.readPixels(e,t,i,n,r,s,0),this.bindBuffer(this.PIXEL_PACK_BUFFER,null),await this.getBufferSubDataAsync(this.PIXEL_PACK_BUFFER,l,0,o,a),this.deleteBuffer(l)}}),s}},_v=mv;i.add("Context","x_ite/Browser/Core/Context",_v);const xv=_v,yv='msgid ""\nmsgstr ""\n"Project-Id-Version: X_ITE\n"\n"POT-Creation-Date: 2015-12-23 04:56+0100\n"\n"PO-Revision-Date: 2015-12-23 04:57+0100\n"\n"Last-Translator: Holger Seelig <holger.seelig@yahoo.de>\n"\n"Language-Team: \n"\n"Language: de\n"\n"MIME-Version: 1.0\n"\n"Content-Type: text/plain; charset=UTF-8\n"\n"Content-Transfer-Encoding: 8bit\n"\n"X-Generator: Poedit 1.8.4\n"\n"X-Poedit-Basepath: ../x_ite\n"\n"Plural-Forms: nplurals=2; plural=(n != 1);\n"\n"X-Poedit-SourceCharset: UTF-8\n"\n"X-Poedit-SearchPath-0: .\n"\n\nmsgid "Less Properties"\nmsgstr "Weniger Eigenschaften"\n\nmsgid "More Properties"\nmsgstr "Mehr Eigenschaften"\n\nmsgid "Frame rate"\nmsgstr "Bildrate"\n\nmsgid "fps"\nmsgstr "BpS"\n\nmsgid "Speed"\nmsgstr "Geschwindigkeit"\n\nmsgid "m/s"\nmsgstr ""\n\nmsgid "km/h"\nmsgstr ""\n\nmsgid "Browser"\nmsgstr ""\n\nmsgid "ms"\nmsgstr ""\n\nmsgid "X3D total"\nmsgstr "X3D gesamt"\n\nmsgid "Event Processing"\nmsgstr "Ereignisverarbeitung"\n\nmsgid "Pointer"\nmsgstr "ZeigegerÃ¤t"\n\nmsgid "Camera"\nmsgstr "Kamera"\n\nmsgid "Collision Detection"\nmsgstr "Kollisionserkennung"\n\nmsgid "Rendering"\nmsgstr "Rendering"\n\nmsgid "Number of Shapes"\nmsgstr "Anzahl der Formen"\n\nmsgid "Number of Sensors"\nmsgstr "Anzahl der Sensoren"\n\nmsgid "Browser Timings"\nmsgstr "Zeitberechnung"\n\nmsgid "X_ITE Browser"\nmsgstr ""\n\nmsgid "Viewpoints"\nmsgstr "Ansichtspunkte"\n\nmsgid "Available Viewers"\nmsgstr "VerfÃ¼gbare Betrachter"\n\nmsgid "Straighten Horizon"\nmsgstr "Horizont gerade richten"\n\nmsgid "Primitive Quality"\nmsgstr "QualitÃ¤t der Grundobjekte"\n\nmsgid "High"\nmsgstr "Hoch"\n\nmsgid "high"\nmsgstr "hoch"\n\nmsgid "Medium"\nmsgstr "Mittel"\n\nmsgid "medium"\nmsgstr "mittel"\n\nmsgid "Low"\nmsgstr "Niedrig"\n\nmsgid "low"\nmsgstr "niedrig"\n\nmsgid "Texture Quality"\nmsgstr "Textur QualitÃ¤t"\n\nmsgid "Display Rubberband"\nmsgstr "Gummiband anzeigen"\n\nmsgid "Rubberband"\nmsgstr "Gummiband"\n\nmsgid "on"\nmsgstr "an"\n\nmsgid "off"\nmsgstr "aus"\n\nmsgid "Mute Browser"\nmsgstr "Browser stumm schalten"\n\nmsgid "Browser muted"\nmsgstr "Browser stumm geschalten"\n\nmsgid "Browser unmuted"\nmsgstr "Browser Ton an"\n\nmsgid "Leave Fullscreen"\nmsgstr "Vollbild verlassen"\n\nmsgid "Fullscreen"\nmsgstr "Vollbild"\n\nmsgid "About X_ITE"\nmsgstr "Ãber X_ITE"\n\nmsgid "Examine Viewer"\nmsgstr "Untersuchen"\n\nmsgid "Walk Viewer"\nmsgstr "Laufen"\n\nmsgid "Fly Viewer"\nmsgstr "Fliegen"\n\nmsgid "Plane Viewer"\nmsgstr "Ebenen Betrachter"\n\nmsgid "Look At Viewer"\nmsgstr "Auf Objekte zielen"\n\nmsgid "None Viewer"\nmsgstr "Kein Betrachter"\n\nmsgid "Points"\nmsgstr "Punkte"\n\nmsgid "Flat"\nmsgstr "Flach"\n\nmsgid "Wireframe"\nmsgstr "Drahtgittermodel"\n\nmsgid "Loading %1 file"\nmsgstr "Lade %1 Datei"\n\nmsgid "Loading %1 files"\nmsgstr "Lade %1 Dateien"\n\nmsgid "Loading done"\nmsgstr "Fertig mit Laden"\n\nmsgid "Failed loading world."\nmsgstr "Laden der Dateien fehlgeschlagen."\n\nmsgid "Show World Info"\nmsgstr "World Info anzeigen"\n\nmsgid "Viewpoint is copied to clipboard."\nmsgstr "Ansichtspunkt wurde in die Zwischenablage kopiert."\n';i.add("de.po","locale/de.po",yv);const wv=yv,bv='msgid ""\nmsgstr ""\n"Project-Id-Version: X_ITE\n"\n"POT-Creation-Date: 2015-12-23 04:58+0100\n"\n"PO-Revision-Date: 2015-12-23 05:07+0100\n"\n"Last-Translator: Holger Seelig <holger.seelig@yahoo.de>\n"\n"Language-Team: \n"\n"Language: fr\n"\n"MIME-Version: 1.0\n"\n"Content-Type: text/plain; charset=UTF-8\n"\n"Content-Transfer-Encoding: 8bit\n"\n"X-Generator: Poedit 1.8.4\n"\n"X-Poedit-Basepath: ../x_ite\n"\n"Plural-Forms: nplurals=2; plural=(n != 1);\n"\n"X-Poedit-SourceCharset: UTF-8\n"\n"X-Poedit-SearchPath-0: .\n"\n\nmsgid "Less Properties"\nmsgstr "Moins de PropriÃ©tÃ©s"\n\nmsgid "More Properties"\nmsgstr "Plus de PropriÃ©tÃ©s"\n\nmsgid "Frame rate"\nmsgstr "FrÃ©quence d\'Images"\n\nmsgid "fps"\nmsgstr "fps"\n\nmsgid "Speed"\nmsgstr "VÃ©locitÃ©"\n\nmsgid "m/s"\nmsgstr ""\n\nmsgid "km/h"\nmsgstr ""\n\nmsgid "Browser"\nmsgstr "X_ITE Navigateur"\n\nmsgid "ms"\nmsgstr ""\n\nmsgid "X3D total"\nmsgstr "X3D total"\n\nmsgid "Event Processing"\nmsgstr "Traitement des ÃvÃ©nements"\n\nmsgid "Pointer"\nmsgstr "Pointeur"\n\nmsgid "Camera"\nmsgstr "CamÃ©ra"\n\nmsgid "Collision Detection"\nmsgstr "DÃ©tection des Collisions"\n\nmsgid "Rendering"\nmsgstr "Rendement"\n\nmsgid "Number of Shapes"\nmsgstr "Nombre de Formes"\n\nmsgid "Number of Sensors"\nmsgstr "Nombre de Senseurs"\n\nmsgid "Browser Timings"\nmsgstr "Calcul du Temps"\n\nmsgid "X_ITE Browser"\nmsgstr "X_ITE Navigateur"\n\nmsgid "Viewpoints"\nmsgstr "Points de Vue"\n\nmsgid "Available Viewers"\nmsgstr "Visionneurs disponibles"\n\nmsgid "Straighten Horizon"\nmsgstr "Redresser l\'Horizon"\n\nmsgid "Primitive Quality"\nmsgstr "QualitÃ© des Objets simples"\n\nmsgid "High"\nmsgstr "Haut"\n\nmsgid "high"\nmsgstr "haut"\n\nmsgid "Medium"\nmsgstr "Moyenne"\n\nmsgid "medium"\nmsgstr "moyenne"\n\nmsgid "Low"\nmsgstr "Faible"\n\nmsgid "low"\nmsgstr "faible"\n\nmsgid "Texture Quality"\nmsgstr "QualitÃ© des Textures"\n\nmsgid "Display Rubberband"\nmsgstr "PrÃ©senter le Bande Ã©lastique"\n\nmsgid "Rubberband"\nmsgstr "Bande Ã©lastique"\n\nmsgid "on"\nmsgstr "marche"\n\nmsgid "off"\nmsgstr "arrÃªt"\n\nmsgid "Mute Browser"\nmsgstr "Rendre Navigateur muet"\n\nmsgid "Browser muted"\nmsgstr "Navigateur muet"\n\nmsgid "Browser unmuted"\nmsgstr "Son de Navigateur rÃ©activÃ©"\n\nmsgid "Leave Fullscreen"\nmsgstr "Laisser le plein Ãcran"\n\nmsgid "Fullscreen"\nmsgstr "Plein Ãcran"\n\nmsgid "About X_ITE"\nmsgstr "Ã propos de X_ITE"\n\nmsgid "Examine Viewer"\nmsgstr "Examiner"\n\nmsgid "Walk Viewer"\nmsgstr "Aller"\n\nmsgid "Fly Viewer"\nmsgstr "Voler"\n\nmsgid "Plane Viewer"\nmsgstr "Visionneur de la Plaine"\n\nmsgid "Look At Viewer"\nmsgstr "Regarder un Objet de prÃ¨s"\n\nmsgid "None Viewer"\nmsgstr "Pas de Visionneur"\n\nmsgid "Flat"\nmsgstr "Plat"\n\nmsgid "Wireframe"\nmsgstr "Image filaire"\n\nmsgid "Loading %1 file"\nmsgstr "TÃ©lÃ©charger %1 Fichier"\n\nmsgid "Loading %1 files"\nmsgstr "TÃ©lÃ©charger %1 Fichiers"\n\nmsgid "Loading done"\nmsgstr "TÃ©lÃ©chargement fini"\n\nmsgid "Failed loading world."\nmsgstr "Le chargement des Fichiers a Ã©chouÃ©."\n\nmsgid "Show World Info"\nmsgstr "Afficher World Info"\n\nmsgid "Viewpoint is copied to clipboard."\nmsgstr "Le point de Vue est copiÃ© dans le Presse-Papiers."\n';i.add("fr.po","locale/fr.po",bv);const Sv={en:"C",de:wv,fr:bv},Tv=/msgid\s+"(.*?)"\nmsgstr\s+"(.*?)"\n/g,vv=function(){for(const e of navigator.languages){const t=e.split("-")[0];if(Sv[t])return t}return(navigator.language||navigator.userLanguage).split("-")[0]}();!function(e){if(Sv[e]){const n=function(e,t){const i=[];let n=null;for(;n=e.exec(t);)i.push(n);return i}(Tv,Sv[e]),r=Sv[e]={};for(var t=0,i=n.length;t<i;++t)n[t][2].length&&(r[n[t][1]]=n[t][2])}}(vv);const Ov=function(e){const t=Sv[vv];if(void 0===t)return e;const i=t[e];return void 0===i?e:i};i.add("gettext","locale/gettext",Ov);const Ev=Ov;var Cv=n(328);function Nv(e){pr.call(this,e),this.localStorage=this.getBrowser().getLocalStorage().addNameSpace("BrowserTimings."),this.fps=new $a}Object.assign(Object.setPrototypeOf(Nv.prototype,pr.prototype),{initialize(){pr.prototype.initialize.call(this),this.getBrowser().getBrowserOptions()._Timings.addInterest("set_enabled__",this),this.localStorage.setDefaultValues({type:"LESS"}),this.element=Cv("<div></div>").hide().addClass("x_ite-private-browser-timings").appendTo(this.getBrowser().getSurface()),this.table=Cv("<table></table>").appendTo(this.element),this.header=Cv("<thead></thead>").append(Cv("<tr></tr>").append(Cv("<th colspan='2'></th>").text(Ev("Browser Timings")))).appendTo(this.table),this.body=Cv("<tbody></tbody>").appendTo(this.table),this.footer=Cv("<tfoot></tfoot>").append(Cv("<tr></tr>").append(Cv("<td colspan='2'></td>"))).appendTo(this.table),this.button=Cv("<button></button>").attr("type","button").appendTo(this.footer.find("td")),this.frameRate=Cv("<td></td>"),this.speed=Cv("<td></td>"),this.frameRate=Cv("<td></td>"),this.speed=Cv("<td></td>"),this.browserTime=Cv("<td></td>"),this.x3dTotal=Cv("<td></td>"),this.eventProcessing=Cv("<td></td>"),this.pointerTime=Cv("<td></td>"),this.cameraTime=Cv("<td></td>"),this.pickingTime=Cv("<td></td>"),this.collisionTime=Cv("<td></td>"),this.renderTime=Cv("<td></td>"),this.numShapes=Cv("<td></td>"),this.sensors=Cv("<td></td>"),this.body.append(Cv("<tr></tr>").append(Cv("<td></td>").text(Ev("Frame rate")+":")).append(this.frameRate)),this.body.append(Cv("<tr></tr>").append(Cv("<td></td>").text(Ev("Speed")+":")).append(this.speed).addClass("x_ite-private-more")),this.body.append(Cv("<tr></tr>").append(Cv("<td></td>").text(Ev("Browser")+":")).append(this.browserTime)),this.body.append(Cv("<tr></tr>").append(Cv("<td></td>").text(Ev("X3D total")+":")).append(this.x3dTotal)),this.body.append(Cv("<tr></tr>").append(Cv("<td></td>").text(Ev("Event Processing")+":")).append(this.eventProcessing)),this.body.append(Cv("<tr></tr>").append(Cv("<td></td>").text(Ev("Pointer")+":")).append(this.pointerTime)),this.body.append(Cv("<tr></tr>").append(Cv("<td></td>").text(Ev("Camera")+":")).append(this.cameraTime)),this.body.append(Cv("<tr></tr>").append(Cv("<td></td>").text(Ev("Picking")+":")).append(this.pickingTime)),this.body.append(Cv("<tr></tr>").append(Cv("<td></td>").text(Ev("Collision Detection")+":")).append(this.collisionTime)),this.body.append(Cv("<tr></tr>").append(Cv("<td></td>").text(Ev("Rendering")+":")).append(this.renderTime)),this.body.append(Cv("<tr></tr>").append(Cv("<td></td>").text(Ev("Number of Shapes")+":")).append(this.numShapes)),this.body.append(Cv("<tr></tr>").append(Cv("<td></td>").text(Ev("Number of Sensors")+":")).append(this.sensors)),this.button.on("click touchend",this.set_type__.bind(this)),this.localStorage.type="MORE"===this.localStorage.type?"LESS":"MORE",this.set_type__()},set_enabled__(){this.getBrowser().getBrowserOption("Timings")?(this.element.stop(!0,!0).fadeIn(),this.fps.reset(),this.getBrowser().prepareEvents().addInterest("update",this),this.update(),this.build()):(this.element.stop(!0,!0).fadeOut(),this.getBrowser().prepareEvents().removeInterest("update",this))},set_type__(){"MORE"===this.localStorage.type?(this.localStorage.type="LESS",this.table.addClass("less"),this.table.removeClass("more")):(this.localStorage.type="MORE",this.table.addClass("more"),this.table.removeClass("less")),this.set_button__(),this.build()},set_button__(){"MORE"===this.localStorage.type?this.button.text(Ev("Less Properties")):this.button.text(Ev("More Properties"))},update(){this.fps.stop(),this.fps.elapsedTime>1e3&&(this.build(),this.fps.reset()),this.fps.start()},build(){const e=this.getBrowser();if(this.frameRate.text(`${Iv(1e3/this.fps.averageTime)} ${Ev("fps")}`),this.speed.text(`${Iv(this.getSpeed(e.currentSpeed))} ${this.getSpeedUnit(e.currentSpeed)}`),"MORE"!==this.localStorage.type||!e.getWorld())return;const t=e.getWorld().getLayerSet().getLayers(),i=e.getActiveLayer(),n=i&&e.getCollisionCount()?i.getCollisionTime().averageTime:0,r=e.getCollisionTime().averageTime+n,s=Math.max(0,e.getBrowserTime().averageTime-(e.getCameraTime().averageTime+e.getCollisionTime().averageTime+e.getDisplayTime().averageTime)),o=e.prepareEvents().getInterests().size-1,a=e.sensorEvents().getInterests().size,l=t.reduce(((e,t)=>e+t.getNumOpaqueShapes()),0),u=t.reduce(((e,t)=>e+t.getNumTransparentShapes()),0);this.browserTime.text(`${Iv(e.getSystemTime().averageTime)} ${Ev("ms")}`),this.x3dTotal.text(`${Iv(e.getBrowserTime().averageTime)} ${Ev("ms")}`),this.eventProcessing.text(`${Iv(s)} ${Ev("ms")}`),this.pointerTime.text(`${Iv(e.getPointingTime().averageTime)} ${Ev("ms")}`),this.cameraTime.text(`${Iv(e.getCameraTime().averageTime)} ${Ev("ms")}`),this.pickingTime.text(`${Iv(e.getPickingTime().averageTime)} ${Ev("ms")}`),this.collisionTime.text(`${Iv(r)} ${Ev("ms")}`),this.renderTime.text(`${Iv(e.getDisplayTime().averageTime)} ${Ev("ms")}`),this.numShapes.text(`${l} + ${u}`),this.sensors.text(o+a),e.getSystemTime().reset(),e.getBrowserTime().reset(),e.getPointingTime().reset(),e.getCameraTime().reset(),e.getPickingTime().reset(),e.getCollisionTime().reset(),e.getDisplayTime().reset(),i?.getCollisionTime().reset()},getSpeed:e=>e<15?e:3.6*e,getSpeedUnit:e=>Ev(e<15?"m/s":"km/h")}),Object.defineProperties(Nv,{typeName:{value:"BrowserTimings",enumerable:!0}});const Iv=(()=>{const e=new Intl.NumberFormat(navigator.language||navigator.userLanguage,{notation:"standard",minimumFractionDigits:2,maximumFractionDigits:2}).format;return function(t){return e(Number.isFinite(t)?t:0)}})(),Fv=Nv;i.add("BrowserTimings","x_ite/Browser/Core/BrowserTimings",Fv);const Mv=Fv;let Dv=0;const Rv={LOW:Dv++,MEDIUM:Dv++,HIGH:Dv++};i.add("PrimitiveQuality","x_ite/Browser/Core/PrimitiveQuality",Rv);const Pv=Rv;let Av=0;const Vv={LOW:Av++,MEDIUM:Av++,HIGH:Av++};i.add("TextureQuality","x_ite/Browser/Core/TextureQuality",Vv);const Lv=Vv;var Bv=n(328);function Uv(e){pr.call(this,e),this.addAlias("AntiAliased",this._Antialiased);const t=this.getBrowser();this.localStorage=t.getLocalStorage().addNameSpace("BrowserOptions."),this.textureQuality=Lv.MEDIUM,this.primitiveQuality=Pv.MEDIUM,this.shading=Ol.GOURAUD}Object.assign(Object.setPrototypeOf(Uv.prototype,pr.prototype),{initialize(){pr.prototype.initialize.call(this),this.localStorage.setDefaultValues({Rubberband:this._Rubberband.getValue(),PrimitiveQuality:this._PrimitiveQuality.getValue(),TextureQuality:this._TextureQuality.getValue(),StraightenHorizon:this._StraightenHorizon.getValue(),Timings:this._Timings.getValue()}),this._Rubberband.addInterest("set_rubberband__",this),this._Antialiased.addInterest("set_antialiased__",this),this._PrimitiveQuality.addInterest("set_primitiveQuality__",this),this._TextureQuality.addInterest("set_textureQuality__",this),this._Shading.addInterest("set_shading__",this),this._StraightenHorizon.addInterest("set_straightenHorizon__",this),this._AutoUpdate.addInterest("set_autoUpdate__",this),this._ContentScale.addInterest("set_contentScale__",this),this._LogarithmicDepthBuffer.addInterest("set_logarithmicDepthBuffer__",this),this._Multisampling.addInterest("set_multisampling__",this),this._OrderIndependentTransparency.addInterest("set_orderIndependentTransparency__",this),this._Timings.addInterest("set_timings__",this),this.set_antialiased__(this._Antialiased),this.set_shading__(this._Shading),this.set_contentScale__(this._ContentScale),this.set_logarithmicDepthBuffer__(this._LogarithmicDepthBuffer),this.set_multisampling__(this._Multisampling),this.set_orderIndependentTransparency__(this._OrderIndependentTransparency),this.reset()},reset:(()=>{const e=new Set(["Antialiased","AutoUpdate","Cache","ContentScale","ContextMenu","Debug","Multisampling","Notifications","OrderIndependentTransparency","SplashScreen"]),t=new Map([["AutoUpdate","Update"]]),i=new Set(["PrimitiveQuality","Rubberband","StraightenHorizon","TextureQuality","Timings"]);return function(){const n=this.getBrowser(),r=this.localStorage;for(const{name:s,value:o}of this.getFieldDefinitions()){if(e.has(s)){const e=Bv.toLowerCaseFirst(t.get(s)??s),i=n.getElement().attr(e);if(void 0!==i){n.attributeChangedCallback(e,null,i);continue}}if(i.has(s)){const e=r[s],t=this.getField(s);e!==t.getValue()&&t.setValue(e);continue}const a=this.getField(s);a.equals(o)||a.assign(o)}}})(),getPrimitiveQuality(){return this.primitiveQuality},getShading(){return this.shading},getTextureQuality(){return this.textureQuality},set_rubberband__(e){this.localStorage.Rubberband=e.getValue()},set_antialiased__(){this.set_multisampling__(this._Multisampling)},set_primitiveQuality__(e){const t=this.getBrowser(),i=e.getValue().toUpperCase();this.localStorage.PrimitiveQuality=i,this.primitiveQuality=Bv.enum(Pv,i,Pv.MEDIUM),"function"==typeof t.setPrimitiveQuality2D&&t.setPrimitiveQuality2D(this.primitiveQuality),"function"==typeof t.setPrimitiveQuality3D&&t.setPrimitiveQuality3D(this.primitiveQuality)},set_textureQuality__(e){const t=this.getBrowser(),i=e.getValue().toUpperCase();this.localStorage.TextureQuality=i,this.textureQuality=Bv.enum(Lv,i,Lv.MEDIUM),"function"==typeof t.setTextureQuality&&t.setTextureQuality(this.textureQuality)},set_shading__:(()=>{const e={[Ol.POINT]:"POINT",[Ol.WIREFRAME]:"WIREFRAME",[Ol.FLAT]:"FLAT",[Ol.GOURAUD]:"GOURAUD",[Ol.PHONG]:"PHONG"};return function(t){const i=this.getBrowser(),n=t.getValue().toUpperCase().replace("POINTSET","POINT");this.shading=Bv.enum(Ol,n,Ol.GOURAUD),i.getRenderingProperties()._Shading=e[this.shading],i.setShading(this.shading)}})(),set_straightenHorizon__(e){this.localStorage.StraightenHorizon=e.getValue(),e.getValue()&&this.getBrowser().getActiveLayer()?.straightenView()},set_autoUpdate__(e){const t=["resize","scroll","load"].map((e=>`${e}.${this.getTypeName()}${this.getId()}`)).join(" ");if(e.getValue()){const e=this.getBrowser(),i=e.getElement(),n=()=>{i.isInViewport()?e.isLive()||e.beginUpdate():e.isLive()&&e.endUpdate()};Bv(window).on(t,n),n()}else Bv(window).off(t)},set_contentScale__(e){const t=this.getBrowser();this.removeUpdateContentScale&&this.removeUpdateContentScale(),-1===e.getValue()?this.updateContentScale():t.getRenderingProperties()._ContentScale=Math.max(e.getValue(),0)||1,t.reshape()},updateContentScale(){const e=this.getBrowser(),t=window.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`),i=this.updateContentScale.bind(this);this.removeUpdateContentScale&&this.removeUpdateContentScale(),this.removeUpdateContentScale=function(){t.removeEventListener("change",i)},t.addEventListener("change",i),e.getRenderingProperties()._ContentScale=window.devicePixelRatio,e.reshape()},set_logarithmicDepthBuffer__(e){const t=this.getBrowser(),i=t.getContext();t.getRenderingProperties()._LogarithmicDepthBuffer=e.getValue()&&i.HAS_FEATURE_FRAG_DEPTH},set_multisampling__(e){const t=this.getBrowser(),i=g.clamp(e.getValue(),0,t.getMaxSamples());t.getRenderingProperties()._Multisampling=this._Antialiased.getValue()?i:0,t.getRenderingProperties()._Antialiased=i>0,t.reshape()},set_orderIndependentTransparency__(){this.getBrowser().reshape()},set_timings__(e){this.localStorage.Timings=e.getValue()}}),Object.defineProperties(Uv,{typeName:{value:"BrowserOptions",enumerable:!0},fieldDefinitions:{value:new Z([new k(d.inputOutput,"SplashScreen",new $n.SFBool(!0)),new k(d.inputOutput,"Dashboard",new $n.SFBool(!0)),new k(d.inputOutput,"Rubberband",new $n.SFBool(!0)),new k(d.inputOutput,"EnableInlineViewpoints",new $n.SFBool(!0)),new k(d.inputOutput,"Antialiased",new $n.SFBool(!0)),new k(d.inputOutput,"TextureQuality",new $n.SFString("MEDIUM")),new k(d.inputOutput,"PrimitiveQuality",new $n.SFString("MEDIUM")),new k(d.inputOutput,"QualityWhenMoving",new $n.SFString("SAME")),new k(d.inputOutput,"Shading",new $n.SFString("GOURAUD")),new k(d.inputOutput,"MotionBlur",new $n.SFBool),new k(d.inputOutput,"AutoUpdate",new $n.SFBool),new k(d.inputOutput,"Cache",new $n.SFBool(!0)),new k(d.inputOutput,"ContentScale",new $n.SFDouble(1)),new k(d.inputOutput,"ContextMenu",new $n.SFBool(!0)),new k(d.inputOutput,"Debug",new $n.SFBool),new k(d.inputOutput,"Gravity",new $n.SFDouble(9.80665)),new k(d.inputOutput,"LoadUrlObjects",new $n.SFBool(!0)),new k(d.inputOutput,"LogarithmicDepthBuffer",new $n.SFBool),new k(d.inputOutput,"Notifications",new $n.SFBool(!0)),new k(d.inputOutput,"Multisampling",new $n.SFInt32(4)),new k(d.inputOutput,"OrderIndependentTransparency",new $n.SFBool),new k(d.inputOutput,"StraightenHorizon",new $n.SFBool(!0)),new k(d.inputOutput,"Timings",new $n.SFBool)]),enumerable:!0}});const Xv=Uv;i.add("BrowserOptions","x_ite/Browser/Core/BrowserOptions",Xv);const jv=Xv;function kv(e){pr.call(this,e)}Object.setPrototypeOf(kv.prototype,pr.prototype),Object.defineProperties(kv,{typeName:{value:"BrowserProperties",enumerable:!0},fieldDefinitions:{value:new Z([new k(d.initializeOnly,"ABSTRACT_NODES",new $n.SFBool(!0)),new k(d.initializeOnly,"CONCRETE_NODES",new $n.SFBool(!0)),new k(d.initializeOnly,"EXTERNAL_INTERACTIONS",new $n.SFBool(!0)),new k(d.initializeOnly,"PROTOTYPE_CREATE",new $n.SFBool(!0)),new k(d.initializeOnly,"DOM_IMPORT",new $n.SFBool(!0)),new k(d.initializeOnly,"XML_ENCODING",new $n.SFBool(!0)),new k(d.initializeOnly,"CLASSIC_VRML_ENCODING",new $n.SFBool(!0)),new k(d.initializeOnly,"BINARY_ENCODING",new $n.SFBool)]),enumerable:!0}});const zv=kv;i.add("BrowserProperties","x_ite/Browser/Core/BrowserProperties",zv);const Gv=zv;function Hv(e){pr.call(this,e),this.addAlias("AntiAliased",this._Antialiased)}Object.assign(Object.setPrototypeOf(Hv.prototype,pr.prototype),{initialize(){pr.prototype.initialize.call(this);const e=this.getBrowser();this._MaxTextureSize=e.getMaxTextureSize(),this._TextureUnits=e.getMaxCombinedTextureUnits(),this._MaxLights=e.getMaxLights(),this._ColorDepth=e.getColorDepth(),this._TextureMemory=e.getTextureMemory(),this._MaxSamples=e.getMaxSamples()}}),Object.defineProperties(Hv,{typeName:{value:"RenderingProperties",enumerable:!0},fieldDefinitions:{value:new Z([new k(d.outputOnly,"Shading",new $n.SFString),new k(d.outputOnly,"MaxTextureSize",new $n.SFInt32),new k(d.outputOnly,"TextureUnits",new $n.SFInt32),new k(d.outputOnly,"MaxLights",new $n.SFInt32),new k(d.outputOnly,"Antialiased",new $n.SFBool(!0)),new k(d.outputOnly,"ColorDepth",new $n.SFInt32),new k(d.outputOnly,"TextureMemory",new $n.SFDouble),new k(d.outputOnly,"ContentScale",new $n.SFDouble(1)),new k(d.outputOnly,"LogarithmicDepthBuffer",new $n.SFBool),new k(d.outputOnly,"MaxSamples",new $n.SFInt32),new k(d.outputOnly,"Multisampling",new $n.SFInt32(4))]),enumerable:!0}});const qv=Hv;i.add("RenderingProperties","x_ite/Browser/Core/RenderingProperties",qv);const Yv=qv;var Wv=n(328);function $v(e){pr.call(this,e),this.addChildObjects(d.inputOutput,"string",new ji)}Wv.fn.textWidth=function(e){const t=Wv(this).children(),i="<span>"+Wv(this).html()+"</span>";Wv(this).html(i);const n=Wv(this).find("span:first").width();return Wv(this).empty(),Wv(this).append(t),n},Object.assign(Object.setPrototypeOf($v.prototype,pr.prototype),{initialize(){pr.prototype.initialize.call(this),this.element=Wv("<div></div>").hide().addClass("x_ite-private-notification").appendTo(this.getBrowser().getSurface()).animate({width:0}),Wv("<span></span>").appendTo(this.element),this._string.addInterest("set_string__",this)},set_string__(){this.getBrowser().getBrowserOption("Notifications")&&0!==this._string.length&&(this.element.children().text(this._string.getValue()),this.element.stop(!0,!0).fadeIn(0).animate({width:this.element.textWidth()}).animate({delay:1},5e3).animate({width:0}).fadeOut(0))}}),Object.defineProperties($v,{typeName:{value:"Notification",enumerable:!0}});const Jv=$v;i.add("Notification","x_ite/Browser/Core/Notification",Jv);const Kv=Jv;n(965);var Zv=n(328);const Qv=Symbol();function eO(e){pr.call(this,e),this[Qv]=null}Object.assign(Object.setPrototypeOf(eO.prototype,pr.prototype),{initialize(){pr.prototype.initialize.call(this);const e=this.getBrowser();this.init({element:e.getElement(),appendTo:e.getShadow(),build:this.build.bind(this),animation:{duration:500,show:"fadeIn",hide:"fadeOut"}})},getUserMenu(){return this[Qv]},setUserMenu(e){this[Qv]=e},createUserMenu(){const e={};if("function"==typeof this[Qv]){const t=this[Qv]();if(Zv.isPlainObject(t))for(const i in t)e["user-"+i]=t[i]}return e},build(e){const t=this.getBrowser(),i=t.getElement().fullScreen();if(!t.getBrowserOption("ContextMenu"))return;const n={className:"x_ite-private-menu",items:{title:{name:t.getName()+" Browser v"+t.getVersion(),className:"context-menu-title context-menu-not-selectable"},separator0:"--------",viewpoints:{name:Ev("Viewpoints"),className:"context-menu-icon x_ite-private-icon-viewpoint",items:this.getViewpoints()},"available-viewers":{name:Ev("Available Viewers"),items:this.getAvailableViewers()},"straighten-horizon":{name:Ev("Straighten Horizon"),type:"checkbox",selected:t.getBrowserOption("StraightenHorizon"),events:{click:e=>{const i=Zv(e.target).is(":checked");t.setBrowserOption("StraightenHorizon",i),t.getNotification()._string=i?Ev("Straighten Horizon")+": "+Ev("on"):Ev("Straighten Horizon")+": "+Ev("off")}}},"display-rubberband":{name:Ev("Display Rubberband"),type:"checkbox",selected:t.getBrowserOption("Rubberband"),events:{click:e=>{const i=Zv(e.target).is(":checked");t.setBrowserOption("Rubberband",i),t.getNotification()._string=i?Ev("Rubberband")+": "+Ev("on"):Ev("Rubberband")+": "+Ev("off")}}},separator1:"--------","primitive-quality":{name:Ev("Primitive Quality"),className:"context-menu-icon x_ite-private-icon-primitive-quality",items:{high:{name:Ev("High"),type:"radio",radio:"primitive-quality",selected:"HIGH"===t.getBrowserOption("PrimitiveQuality"),events:{click:()=>{t.setBrowserOption("PrimitiveQuality","HIGH"),t.getNotification()._string=Ev("Primitive Quality")+": "+Ev("high")}}},medium:{name:Ev("Medium"),type:"radio",radio:"primitive-quality",selected:"MEDIUM"===t.getBrowserOption("PrimitiveQuality"),events:{click:()=>{t.setBrowserOption("PrimitiveQuality","MEDIUM"),t.getNotification()._string=Ev("Primitive Quality")+": "+Ev("medium")}}},low:{name:Ev("Low"),type:"radio",radio:"primitive-quality",selected:"LOW"===t.getBrowserOption("PrimitiveQuality"),events:{click:()=>{t.setBrowserOption("PrimitiveQuality","LOW"),t.getNotification()._string=Ev("Primitive Quality")+": "+Ev("low")}}}}},"texture-quality":{name:Ev("Texture Quality"),className:"context-menu-icon x_ite-private-icon-texture-quality",items:{high:{name:Ev("High"),type:"radio",radio:"texture-quality",selected:"HIGH"===t.getBrowserOption("TextureQuality"),events:{click:()=>{t.setBrowserOption("TextureQuality","HIGH"),t.getNotification()._string=Ev("Texture Quality")+": "+Ev("high")}}},medium:{name:Ev("Medium"),type:"radio",radio:"texture-quality",selected:"MEDIUM"===t.getBrowserOption("TextureQuality"),events:{click:()=>{t.setBrowserOption("TextureQuality","MEDIUM"),t.getNotification()._string=Ev("Texture Quality")+": "+Ev("medium")}}},low:{name:Ev("Low"),type:"radio",radio:"texture-quality",selected:"LOW"===t.getBrowserOption("TextureQuality"),events:{click:()=>{t.setBrowserOption("TextureQuality","LOW"),t.getNotification()._string=Ev("Texture Quality")+": "+Ev("low")}}}}},shading:{name:Ev("Shading"),className:"context-menu-icon x_ite-private-icon-shading",items:{point:{name:Ev("Points"),type:"radio",radio:"shading",selected:"POINT"===t.getBrowserOption("Shading"),events:{click:()=>{t.setBrowserOption("Shading","POINT"),t.getNotification()._string=Ev("Shading")+": "+Ev("Points")}}},wireframe:{name:Ev("Wireframe"),type:"radio",radio:"shading",selected:"WIREFRAME"===t.getBrowserOption("Shading"),events:{click:()=>{t.setBrowserOption("Shading","WIREFRAME"),t.getNotification()._string=Ev("Shading")+": "+Ev("Wireframe")}}},flat:{name:Ev("Flat"),type:"radio",radio:"shading",selected:"FLAT"===t.getBrowserOption("Shading"),events:{click:()=>{t.setBrowserOption("Shading","FLAT"),t.getNotification()._string=Ev("Shading")+": "+Ev("Flat")}}},gouraud:{name:Ev("Gouraud"),type:"radio",radio:"shading",selected:"GOURAUD"===t.getBrowserOption("Shading"),events:{click:()=>{t.setBrowserOption("Shading","GOURAUD"),t.getNotification()._string=Ev("Shading")+": "+Ev("Gouraud")}}},phong:{name:Ev("Phong"),type:"radio",radio:"shading",selected:"PHONG"===t.getBrowserOption("Shading"),events:{click:()=>{t.setBrowserOption("Shading","PHONG"),t.getNotification()._string=Ev("Shading")+": "+Ev("Phong")}}}}},separator2:"--------","browser-timings":{name:Ev("Browser Timings"),type:"checkbox",selected:t.getBrowserOption("Timings"),events:{click:e=>{t.setBrowserOption("Timings",Zv(e.target).is(":checked")),t.getSurface().focus()}}},fullscreen:{name:Ev(i?"Leave Fullscreen":"Fullscreen"),className:"context-menu-icon "+(i?"x_ite-private-icon-leave-fullscreen":"x_ite-private-icon-enter-fullscreen"),callback:()=>{t.getElement().toggleFullScreen()}},separator3:"--------"}};Object.assign(n.items,this.createUserMenu()),Object.assign(n.items,{separator4:"--------","world-info":{name:Ev("Show World Info"),className:"context-menu-icon x_ite-private-icon-world-info",callback(){t.getShadow().find(".x_ite-private-world-info").remove();const e=t.getShadow().find(".x_ite-private-browser"),i=Zv("<div></div>").addClass("x_ite-private-world-info-overlay").appendTo(e),n=Zv("<div></div>").addClass("x_ite-private-world-info").appendTo(i),r=t.getExecutionContext().getWorldInfos()[0],s=r.title,o=r.info;Zv("<div></div>").addClass("x_ite-private-world-info-top").text("World Info").appendTo(n),s.length&&Zv("<div></div>").addClass("x_ite-private-world-info-title").text(s).appendTo(n);for(const e of o)Zv("<div></div>").addClass("x_ite-private-world-info-info").text(e).appendTo(n);i.on("click",(function(){i.remove()}))}},about:{name:Ev("About X_ITE"),className:"context-menu-icon x_ite-private-icon-help-about",callback(){window.open(t.getProviderURL())}}}),Zv.isEmptyObject(n.items.viewpoints.items)&&delete n.items.viewpoints,Object.keys(n.items["available-viewers"].items).length<2&&delete n.items["available-viewers"],t.getCurrentViewer().match(/^(?:EXAMINE|FLY)$/)||delete n.items["straighten-horizon"],t.getBrowserOption("Debug")||delete n.items.shading;const r=t.getExecutionContext().getWorldInfos()[0];return(!r||0===r.title.length&&0===r.info.length)&&delete n.items["world-info"],n},getViewpoints(){const e=this.getBrowser(),t=e.getActiveLayer();if(!t)return{};const i=e.getBrowserOption("EnableInlineViewpoints"),n=e.currentScene,r=t.getViewpoints().get(),s=t.getViewpoint(),o={};for(const t of r){const r=t.getDescriptions().join(" Â» ");if(""===r)continue;if(!i&&t.getScene()!==n)continue;const a={name:r,callback:()=>{e.bindViewpoint(e.getActiveLayer(),t),e.getSurface().focus()}};t===s&&(a.className="context-menu-selected"),o["Viewpoint"+t.getId()]=a}return o},getAvailableViewers(){const e=this.getBrowser(),t=e._viewer.getValue(),i=e._availableViewers,n={};for(const r of i)n[r]={name:Ev(this.getViewerName(r)),className:"context-menu-icon x_ite-private-icon-"+r.toLowerCase()+"-viewer",callback:()=>{e._viewer=r,e.getNotification()._string=Ev(this.getViewerName(r)),e.getSurface().focus()}},r===t&&(n[r].className+=" context-menu-selected");return n},getViewerName(e){switch(e){case"EXAMINE":return Ev("Examine Viewer");case"WALK":return Ev("Walk Viewer");case"FLY":return Ev("Fly Viewer");case"PLANE":return Ev("Plane Viewer");case"LOOKAT":return Ev("Look At Viewer");case"NONE":return Ev("None Viewer")}},init(e){this.show=this.createRoot.bind(this,e),e.element.on("contextmenu",this.show)},show(e){},hide(e){},createRoot(e,t){const i=e.build(t);if(!i)return;const n=Zv("<div></div>").addClass("context-menu-layer").addClass(i.className).appendTo(e.appendTo),r=this.hide=()=>(delete this.hide,n.remove(),s[e.animation.hide](e.animation.duration,(function(){s.remove(),e.events&&"function"==typeof e.events.hide&&e.events.hide()})),!1),s=Zv("<ul></ul>").hide().addClass("context-menu-root").addClass("context-menu-list").addClass(i.className).appendTo(e.appendTo).offset({left:t.pageX,top:t.pageY});for(const e in i.items)s.append(this.createItem(i.items[e],"context-menu-root",e,2,r));return s[e.animation.show](e.animation.duration),s.offset({left:t.pageX,top:t.pageY}),s.offset().left-Zv(document).scrollLeft()+s.outerWidth()>Zv(window).width()&&s.offset({left:Zv(document).scrollLeft()+Math.max(0,Zv(window).width()-s.outerWidth())}),s.offset().top-Zv(document).scrollTop()+s.outerHeight()>Zv(window).height()&&s.offset({top:Zv(document).scrollTop()+Math.max(0,Zv(window).height()-s.outerHeight())}),s.find("ul").each(((e,t)=>{const i=(t=Zv(t)).outerWidth()+s.outerWidth(),n=s.offset().left-Zv(document).scrollLeft()+i>Zv(window).width()?"right":"left";t.css("width",t.outerWidth()),t.css(n,t.parent().closest("ul").width()),t.outerHeight()>=Zv(window).height()&&t.css({"max-height":"100vh","overflow-y":"scroll"})})),s.find("li").on("mouseenter touchstart",(function(e){e.stopImmediatePropagation();const t=Zv(e.target).closest("li").children("ul");if(!t.length)return;t.css("top","");const i=t.offset().top+t.outerHeight()-Zv(window).scrollTop()-Zv(window).height();i>0&&t.offset({top:t.offset().top-i})})),n.on("click contextmenu",r),s.on("contextmenu",r),e.events&&"function"==typeof e.events.show&&e.events.show(s),!1},createItem(e,t,i,n,r){const s=Zv("<li></li>").addClass("context-menu-item");switch(typeof e){case"string":e.match(/^-+$/)&&s.addClass(["context-menu-separator","context-menu-not-selectable"]);break;case"object":switch(e.className&&s.addClass(e.className),e.type){case"radio":case"checkbox":{const i=Zv("<label></label>").appendTo(s),n=Zv("<input></input>").appendTo(i);n.attr("type",e.type).attr("name","context-menu-input-"+(e.radio||t)),Zv("<span></span>").text(e.name).appendTo(i),e.selected&&n.attr("checked","checked");for(const t in e.events)"function"==typeof e.events[t]&&n.on(t,e.events[t]);s.addClass("context-menu-input");break}default:e.name&&Zv("<span></span>").text(e.name).appendTo(s),"function"==typeof e.callback&&s.on("click",e.callback).on("click",r)}}if("object"==typeof e.items&&n<3){const t=Zv("<ul></ul>").addClass("context-menu-list").css({"z-index":n}).appendTo(s);for(const s in e.items)t.append(this.createItem(e.items[s],i,s,n+1,r));s.addClass("context-menu-submenu")}return s}}),Object.defineProperties(eO,{typeName:{value:"ContextMenu",enumerable:!0}});const tO=eO;i.add("ContextMenu","x_ite/Browser/Core/ContextMenu",tO);const iO=tO;function nO(e,t,i,n,r=!1,s=[]){Object.defineProperties(this,{name:{value:e,enumerable:!0},level:{value:t,enumerable:!0},title:{value:i,enumerable:!0},providerURL:{value:n||so.getProviderURL(r&&e),enumerable:!0},external:{value:r},dependencies:{value:s}})}Object.assign(Object.setPrototypeOf(nO.prototype,I.prototype),{toVRMLStream(e){e.string+=e.Indent(),e.string+="COMPONENT",e.string+=e.Space(),e.string+=this.name,e.string+=e.TidySpace(),e.string+=":",e.string+=e.TidySpace(),e.string+=this.level},toXMLStream(e){e.string+=e.Indent(),e.string+="<component",e.string+=e.Space(),e.string+="name='",e.string+=this.name,e.string+="'",e.string+=e.Space(),e.string+="level='",e.string+=this.level,e.string+="'",e.string+=e.closingTags?"></component>":"/>"},toJSONStream(e){e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@name",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=this.name,e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@level",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+=this.level,e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}"}});for(const e of Object.keys(nO.prototype))Object.defineProperty(nO.prototype,e,{enumerable:!1});Object.defineProperties(nO,{typeName:{value:"ComponentInfo",enumerable:!0}}),Object.defineProperties(nO.prototype,{providerUrl:{get:function(){return this.providerURL}}});const rO=nO;i.add("ComponentInfo","x_ite/Configuration/ComponentInfo",rO);const sO=rO;function oO(e=[]){return $.call(this,Array.from(e,(e=>[e.name,e])),sO)}Object.assign(Object.setPrototypeOf(oO.prototype,$.prototype),{add(e,{level:t,title:i,providerURL:n,external:r=!1,dependencies:s=[]}){$.prototype.add.call(this,e,new sO(e,t,i,n,r,s))}});for(const e of Object.keys(oO.prototype))Object.defineProperty(oO.prototype,e,{enumerable:!1});Object.defineProperties(oO,{typeName:{value:"ComponentInfoArray",enumerable:!0}});const aO=oO;i.add("ComponentInfoArray","x_ite/Configuration/ComponentInfoArray",aO);const lO=aO;function uO(e,t,i){Object.defineProperties(this,{category:{value:e,enumerable:!0},name:{value:t,enumerable:!0},conversionFactor:{value:i,enumerable:!0}})}Object.assign(Object.setPrototypeOf(uO.prototype,I.prototype),{toVRMLStream(e){e.string+=e.Indent(),e.string+="UNIT",e.string+=e.Space(),e.string+=this.category,e.string+=e.Space(),e.string+=this.name,e.string+=e.Space(),e.string+=this.conversionFactor},toXMLStream(e){e.string+=e.Indent(),e.string+="<unit",e.string+=e.Space(),e.string+="category='",e.string+=this.category,e.string+="'",e.string+=e.Space(),e.string+="name='",e.string+=e.XMLEncode(this.name),e.string+="'",e.string+=e.Space(),e.string+="conversionFactor='",e.string+=this.conversionFactor,e.string+="'",e.string+=e.closingTags?"></unit>":"/>"},toJSONStream(e,t){if(1===this.conversionFactor)throw new Error("conversionFactor is 1");e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@category",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=this.category,e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@name",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(this.name),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@conversionFactor",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+=this.conversionFactor,e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}"}});for(const e of Object.keys(uO.prototype))Object.defineProperty(uO.prototype,e,{enumerable:!1});Object.defineProperty(uO.prototype,"conversion_factor",{get(){return this.conversionFactor}}),Object.defineProperties(uO,{typeName:{value:"UnitInfo",enumerable:!0}});const hO=uO;i.add("UnitInfo","x_ite/Configuration/UnitInfo",hO);const dO=hO;function cO(e=[]){return $.call(this,Array.from(e,(e=>[e.category,e])),dO)}Object.setPrototypeOf(cO.prototype,$.prototype);for(const e of Object.keys(cO.prototype))Object.defineProperty(cO.prototype,e,{enumerable:!1});Object.defineProperties(cO,{typeName:{value:"UnitInfoArray",enumerable:!0}});const pO=cO;i.add("UnitInfoArray","x_ite/Configuration/UnitInfoArray",pO);const gO=pO,fO=Symbol(),mO=Symbol();function _O(e,t){I.call(this),this[fO]=e,this[mO]=t}Object.assign(Object.setPrototypeOf(_O.prototype,I.prototype),{getExportedName(){return this[fO]},getLocalNode(){return this[mO]},toVRMLStream(e){const t=e.LocalName(this[mO]);e.string+=e.Indent(),e.string+="EXPORT",e.string+=e.Space(),e.string+=t,this[fO]!==t&&(e.string+=e.Space(),e.string+="AS",e.string+=e.Space(),e.string+=this[fO])},toXMLStream(e){const t=e.LocalName(this[mO]);e.string+=e.Indent(),e.string+="<EXPORT",e.string+=e.Space(),e.string+="localDEF='",e.string+=e.XMLEncode(t),e.string+="'",this[fO]!==t&&(e.string+=e.Space(),e.string+="AS='",e.string+=e.XMLEncode(this[fO]),e.string+="'"),e.string+=e.closingTags?"></EXPORT>":"/>"},toJSONStream(e){const t=e.LocalName(this[mO]);e.string+=e.Indent(),e.string+="{",e.string+=e.TidySpace(),e.string+='"',e.string+="EXPORT",e.string+='"',e.string+=":",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@localDEF",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(t),e.string+='"',this[fO]!==t?(e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@AS",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(this[fO]),e.string+='"',e.string+=e.TidyBreak()):e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}"}});for(const e of Object.keys(_O.prototype))Object.defineProperty(_O.prototype,e,{enumerable:!1});Object.defineProperties(_O.prototype,{exportedName:{get(){return this[fO]},enumerable:!0},localNode:{get(){return bi.get(this[mO])},enumerable:!0}}),Object.defineProperties(_O,{typeName:{value:"X3DExportedNode",enumerable:!0}});const xO=_O;i.add("X3DExportedNode","x_ite/Execution/X3DExportedNode",xO);const yO=xO;function wO(e=[]){return $.call(this,Array.from(e,(e=>[e.getExportedName(),e])),yO)}Object.setPrototypeOf(wO.prototype,$.prototype);for(const e of Object.keys(wO.prototype))Object.defineProperty(wO.prototype,e,{enumerable:!1});Object.defineProperties(wO,{typeName:{value:"ExportedNodesArray",enumerable:!0}});const bO=wO;i.add("ExportedNodesArray","x_ite/Execution/ExportedNodesArray",bO);const SO=bO,TO=Symbol(),vO=Symbol(),OO=Symbol(),EO=Symbol(),CO=Symbol(),NO=Symbol(),IO=Symbol(),FO=Symbol(),MO=Symbol();function DO(e){jh.call(this,this,null,e),this.addType(d.X3DScene),this.addChildObjects(d.outputOnly,"profile_changed",new $n.SFTime,d.outputOnly,"metadata_changed",new $n.SFTime,d.outputOnly,"initLoadCount",new $n.SFInt32,d.outputOnly,"loadCount",new $n.SFInt32),this[TO]=Er,this[vO]="SCRIPTED",this[OO]=null,this[EO]=new lO([]),this[CO]=location.toString(),this[NO]=new gO,this[NO].add("angle",new dO("angle","radian",1)),this[NO].add("force",new dO("force","newton",1)),this[NO].add("length",new dO("length","metre",1)),this[NO].add("mass",new dO("mass","kilogram",1)),this[IO]=new Map,this[FO]=new SO,this[MO]=new Set,this[EO].addParent(this),this[NO].addParent(this),this[FO].addParent(this),this.getRootNodes().setAccessType(d.inputOutput),this.setLive(!1)}Object.assign(Object.setPrototypeOf(DO.prototype,jh.prototype),{isMainScene(){return this===this.getExecutionContext()},isScene:()=>!0,setSpecificationVersion(e){this[TO]=String(e)},getSpecificationVersion(){return this[TO]},setEncoding(e){this[vO]=String(e)},getEncoding(){return this[vO]},setWorldURL(e){this[CO]=String(e)},getWorldURL(){return this[CO]},getBaseURL(){return this[CO].match(/^(?:data|blob):/)?this.isMainScene()?this.getBrowser().getBaseURL():this.getExecutionContext().getBaseURL():this[CO]},setProfile(e){this[OO]=e,this._profile_changed=this.getBrowser().getCurrentTime()},getProfile(){return this[OO]},hasComponent(e,t=0){if(!this[OO])return!0;if(e instanceof sO)var{name:e,level:t}=e;const i=this[OO].components.get(e)??this[EO].get(e);return!!i&&t<=i.level},addComponent(e){this[EO].add(e.name,e),this._components_changed=this.getBrowser().getCurrentTime()},updateComponent(e){this[EO].update(e.name,e.name,e),this._components_changed=this.getBrowser().getCurrentTime()},removeComponent(e){this[EO].remove(e),this._components_changed=this.getBrowser().getCurrentTime()},getComponents(){return this[EO]},updateUnit(e,t,i){this[NO].has(e)&&(this[NO].update(e,e,new dO(e,String(t),Number(i))),this._units_changed=this.getBrowser().getCurrentTime())},getUnit(e){return this[NO].get(e)},getUnits(){return this[NO]},fromUnit(e,t){switch(e){case"angle":case"force":case"length":case"mass":return t*this.getUnits().get(e).conversionFactor;case"acceleration:":case"speed":return t*this.getUnits().get("length").conversionFactor;case"angularRate":return t*this.getUnits().get("angle").conversionFactor;case"area":return t*this.getUnits().get("length").conversionFactor**2;case"volume":return t*this.getUnits().get("length").conversionFactor**3}return t},toUnit(e,t){switch(e){case"angle":case"force":case"length":case"mass":return t/this.getUnits().get(e).conversionFactor;case"acceleration:":case"speed":return t/this.getUnits().get("length").conversionFactor;case"angularRate":return t/this.getUnits().get("angle").conversionFactor;case"area":return t/this.getUnits().get("length").conversionFactor**2;case"volume":return t/this.getUnits().get("length").conversionFactor**3}return t},setMetaData(e,t){if(!(e=String(e)).length)throw new Error("Couldn't add metadata: name is empty.");if(Array.isArray(t)||(t=[t]),!t.length)throw new Error("Couldn't add metadata: values length is 0.");this[IO].set(e,t.map(String)),this._metadata_changed=this.getBrowser().getCurrentTime()},addMetaData(e,t){if(e=String(e),t=String(t),!e.length)throw new Error("Couldn't add metadata: name is empty.");let i=this[IO].get(e);i||this[IO].set(e,i=[]),i.push(t)},removeMetaData(e){e=String(e),this[IO].delete(e),this._metadata_changed=this.getBrowser().getCurrentTime()},getMetaData(e){e=String(e);const t=this[IO].get(e);if(t)return Array.from(t)},getMetaDatas(){return new Map(this[IO])},addExportedNode(e,t){if(e=String(e),this[FO].has(e))throw new Error(`Couldn't add exported node: exported name '${e}' already in use.`);this.updateExportedNode(e,t),this._exportedNodes_changed=this.getBrowser().getCurrentTime()},updateExportedNode(e,t){if(e=String(e),t=Yl(d.X3DNode,t,!1),0===e.length)throw new Error("Couldn't update exported node: node exported name is empty.");if(!t)throw new Error("Couldn't update exported node: node must be of type X3DNode.");this.removeExportedNode(e);const i=new yO(e,t);this[FO].add(e,i),this._exportedNodes_changed=this.getBrowser().getCurrentTime()},removeExportedNode(e){e=String(e),this[FO].remove(e),this._exportedNodes_changed=this.getBrowser().getCurrentTime()},getExportedNode(e){e=String(e);const t=this[FO].get(e);if(t)return bi.get(t.getLocalNode());throw new Error(`Exported node '${e}' not found.`)},getExportedNodes(){return this[FO]},getUniqueExportName(e){return f(this[FO],e)},addRootNode(e){e=bi.get(Yl(d.X3DNode,e,!1));const t=this.getRootNodes();for(const i of t)if(i.equals(e))return;t.push(e)},removeRootNode(e){e=bi.get(Yl(d.X3DNode,e,!1));const t=this.getRootNodes();t.assign(t.filter((t=>t!==e)))},setRootNodes(e){if(!(e instanceof $n.MFNode))throw new Error("Value must be of type MFNode.");this.getRootNodes().assign(e)},toVRMLStream(e){e.string+=e.Indent(),e.string+="#X3D V",e.string+=Er,e.string+=e.Space(),e.string+="utf8",e.string+=e.Space(),e.string+=this.getBrowser().name,e.string+=e.Space(),e.string+="V",e.string+=this.getBrowser().version,e.string+=e.ForceBreak(),e.string+=e.ForceBreak();const t=this.getProfile();t&&(t.toVRMLStream(e),e.string+=e.Break(),e.string+=e.TidyBreak());const i=this.getComponents();i.length&&(i.toVRMLStream(e),e.string+=e.TidyBreak());const n=this.getUnits().filter((e=>1!==e.conversionFactor));if(n.length){for(const t of n)t.toVRMLStream(e),e.string+=e.Break();e.string+=e.TidyBreak()}const r=this.getMetaDatas();if(r.size){for(const[t,i]of r)for(const n of i)e.string+=e.Indent(),e.string+="META",e.string+=e.Space(),e.string+=new $n.SFString(t).toString(),e.string+=e.Space(),e.string+=new $n.SFString(n).toString(),e.string+=e.Break();e.string+=e.TidyBreak()}const s=this.getExportedNodes();e.PushExecutionContext(this),e.EnterScope(),e.ExportedNodes(s),jh.prototype.toVRMLStream.call(this,e),s.length&&(e.string+=e.TidyBreak(),s.toVRMLStream(e)),e.LeaveScope(),e.PopExecutionContext()},toXMLStream(e){if(e.html||(e.string+=e.Indent(),e.string+='<?xml version="1.0" encoding="UTF-8"?>',e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='<!DOCTYPE X3D PUBLIC "ISO//Web3D//DTD X3D ',e.string+=Er,e.string+='//EN" "http://www.web3d.org/specifications/x3d-',e.string+=Er,e.string+='.dtd">',e.string+=e.TidyBreak()),e.string+=e.Indent(),e.string+="<X3D",e.string+=e.Space(),e.string+="profile='",e.string+=this.getProfile()?this.getProfile().name:"Full",e.string+="'",e.string+=e.Space(),e.string+="version='",e.string+=Er,e.string+="'",e.string+=e.Space(),e.string+="xmlns:xsd='http://www.w3.org/2001/XMLSchema-instance'",e.string+=e.Space(),e.string+="xsd:noNamespaceSchemaLocation='http://www.web3d.org/specifications/x3d-",e.string+=Er,e.string+=".xsd'>",e.string+=e.TidyBreak(),e.IncIndent(),this.getComponents().length||this.getUnits().some((e=>1!==e.conversionFactor))||this.getMetaDatas().size){e.string+=e.Indent(),e.string+="<head>",e.string+=e.TidyBreak(),e.IncIndent(),this.getComponents().toXMLStream(e);for(const t of this.getUnits())1!==t.conversionFactor&&(t.toXMLStream(e),e.string+=e.TidyBreak());for(const[t,i]of this.getMetaDatas())for(const n of i)e.string+=e.Indent(),e.string+="<meta",e.string+=e.Space(),e.string+="name='",e.string+=e.XMLEncode(t),e.string+="'",e.string+=e.Space(),e.string+="content='",e.string+=e.XMLEncode(n),e.string+="'",e.string+=e.closingTags?"></meta>":"/>",e.string+=e.TidyBreak();e.DecIndent(),e.string+=e.Indent(),e.string+="</head>",e.string+=e.TidyBreak()}if(this.getExternProtoDeclarations().length||this.getProtoDeclarations().length||this.getRootNodes().length){e.string+=e.Indent(),e.string+="<Scene>",e.string+=e.TidyBreak(),e.IncIndent();const t=this.getExportedNodes();e.PushExecutionContext(this),e.EnterScope(),e.ExportedNodes(t),jh.prototype.toXMLStream.call(this,e),t.toXMLStream(e),e.LeaveScope(),e.PopExecutionContext(),e.DecIndent(),e.string+=e.Indent(),e.string+="</Scene>",e.string+=e.TidyBreak()}else e.string+=e.Indent(),e.string+="<Scene/>",e.string+=e.TidyBreak();e.DecIndent(),e.string+=e.Indent(),e.string+="</X3D>",e.string+=e.TidyBreak()},toJSONStream(e){e.string+=e.Indent(),e.string+="{",e.string+=e.TidySpace(),e.string+='"',e.string+="X3D",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="encoding",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+="UTF-8",e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@profile",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=this.getProfile()?this.getProfile().name:"Full",e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@version",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=Er,e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@xsd:noNamespaceSchemaLocation",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+="http://www.web3d.org/specifications/x3d-",e.string+=Er,e.string+=".xsd",e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="JSON schema",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+="http://www.web3d.org/specifications/x3d-",e.string+=Er,e.string+="-JSONSchema.json",e.string+='"',e.string+=",",e.string+=e.TidyBreak();const t=this.getUnits().some((e=>1!==e.conversionFactor));if(this.getComponents().length||t||this.getMetaDatas().size){let i=!1;if(e.string+=e.Indent(),e.string+='"',e.string+="head",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),this.getMetaDatas().size){i&&(e.string+=",",e.string+=e.TidyBreak()),e.string+=e.Indent(),e.string+='"',e.string+="meta",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent();for(const[t,[i,n]]of[...this.getMetaDatas()].entries())for(const[r,s]of n.entries())e.string+=e.Indent(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="@name",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(i),e.string+='"',e.string+=",",e.string+=e.TidyBreak(),e.string+=e.Indent(),e.string+='"',e.string+="@content",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+='"',e.string+=e.JSONEncode(s),e.string+='"',e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",t===this.getMetaDatas().size-1&&r===n.length-1||(e.string+=","),e.string+=e.TidyBreak();e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]",i=!0}this.getComponents().length&&(i&&(e.string+=",",e.string+=e.TidyBreak()),e.string+=e.Indent(),e.string+='"',e.string+="component",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),this.getComponents().toJSONStream(e),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]",i=!0),t&&(i&&(e.string+=",",e.string+=e.TidyBreak()),e.string+=e.Indent(),e.string+='"',e.string+="unit",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),this.getUnits().toJSONStream(e),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]",i=!0),e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=",",e.string+=e.TidyBreak()}e.string+=e.Indent(),e.string+='"',e.string+="Scene",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="{",e.string+=e.TidyBreak(),e.string+=e.IncIndent(),e.string+=e.Indent(),e.string+='"',e.string+="-children",e.string+='"',e.string+=":",e.string+=e.TidySpace(),e.string+="[",e.string+=e.TidyBreak(),e.string+=e.IncIndent();const i=this.getExportedNodes();e.PushExecutionContext(this),e.EnterScope(),e.ExportedNodes(i),jh.prototype.toJSONStream.call(this,e),this.getExportedNodes().toJSONStream(e,!0),e.JSONRemoveComma(),e.LeaveScope(),e.PopExecutionContext(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="]",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak(),e.string+=e.DecIndent(),e.string+=e.Indent(),e.string+="}",e.string+=e.TidyBreak()}},{setExecutionContext(e){if(!this.isMainScene()){const e=this.getScene();for(const t of this[MO])e.removeLoadingObject(t)}if(jh.prototype.setExecutionContext.call(this,e),!this.isMainScene()){const e=this.getScene();for(const t of this[MO])e.addLoadingObject(t)}},addInitLoadCount(e){this._initLoadCount=this._initLoadCount.getValue()+1},removeInitLoadCount(e){this._initLoadCount=this._initLoadCount.getValue()-1},getLoadingObjects(){return this[MO]},addLoadingObject(e){if(this[MO].has(e))return;this[MO].add(e),this._loadCount=this[MO].size;const t=this.getBrowser(),i=this.getScene();this!==t.getExecutionContext()&&this.loader!==t.loader||t.addLoadingObject(e),this.isMainScene()||i.addLoadingObject(e)},removeLoadingObject(e){if(!this[MO].has(e))return;this[MO].delete(e),this._loadCount=this[MO].size;const t=this.getBrowser(),i=this.getScene();this!==t.getExecutionContext()&&this.loader!==t.loader||t.removeLoadingObject(e),this.isMainScene()||i.removeLoadingObject(e)}});for(const e of Object.keys(DO.prototype))Object.defineProperty(DO.prototype,e,{enumerable:!1});Object.defineProperties(DO.prototype,{specificationVersion:{get:DO.prototype.getSpecificationVersion,enumerable:!0},encoding:{get:DO.prototype.getEncoding,enumerable:!0},profile:{get:DO.prototype.getProfile,enumerable:!0},profile_changed:{get(){return this._profile_changed},enumerable:!1},components:{get:DO.prototype.getComponents,enumerable:!0},worldURL:{get:DO.prototype.getWorldURL,enumerable:!0},units:{get:DO.prototype.getUnits,enumerable:!0},metadata_changed:{get(){return this._metadata_changed},enumerable:!1},rootNodes:{get:DO.prototype.getRootNodes,set:DO.prototype.setRootNodes,enumerable:!0},exportedNodes:{get:DO.prototype.getExportedNodes,enumerable:!0},sceneGraph_changed:{get(){return this._sceneGraph_changed},enumerable:!1}}),Object.defineProperties(DO,{typeName:{value:"X3DScene",enumerable:!0}}),d.addNode(DO);const RO=DO;i.add("X3DScene","x_ite/Execution/X3DScene",RO);const PO=RO,AO=new WeakMap,VO=new WeakMap,LO=new WeakMap,BO={get(e,t){const i=e[t];if(void 0!==i)return i;const n=e.getStorage()[e.getNameSpace()+t];if(void 0===n||"undefined"===n||null===n)return e.getDefaultValue(t);return JSON.parse(n)},set:(e,t,i)=>(void 0===i?e.getStorage().removeItem(e.getNameSpace()+t):e.getStorage()[e.getNameSpace()+t]=JSON.stringify(i),!0)};function UO(e,t){return this.target=this,AO.set(this,e),VO.set(this,t),LO.set(this,{}),new Proxy(this,BO)}Object.assign(UO.prototype,{getStorage(){return AO.get(this.target)},getNameSpace(){return VO.get(this.target)},addNameSpace(e){return new UO(this.getStorage(),this.getNameSpace()+e)},setDefaultValues(e){Object.assign(LO.get(this.target),e)},getDefaultValue(e){const t=LO.get(this.target)[e];return void 0===t?void 0:JSON.parse(JSON.stringify(t))},clear(){const e=this.getStorage(),t=this.getNameSpace();for(const i of Object.keys(e))i.startsWith(t)&&e.removeItem(i)}});const XO=UO;i.add("DataStorage","standard/Utility/DataStorage",XO);const jO=XO;var kO=n(328);const zO=Symbol(),GO=Symbol(),HO=Symbol(),qO=Symbol(),YO=Symbol(),WO=Symbol(),$O=Symbol(),JO=Symbol(),KO=Symbol(),ZO=Symbol(),QO=Symbol(),eE=Symbol(),tE=Symbol(),iE=Symbol(),nE=Symbol(),rE=Symbol(),sE=Symbol(),oE=Symbol(),aE=Symbol();let lE=0;function uE(e){const t=kO("<div></div>").addClass("x_ite-private-browser").attr("tabindex",0),i=kO("<div></div>").addClass("x_ite-private-surface").appendTo(t),n=kO("<div></div>").hide().addClass("x_ite-private-splash-screen").appendTo(t),r=(kO("<div></div>").addClass("x_ite-private-spinner").appendTo(n),kO("<div></div>").addClass("x_ite-private-progress").appendTo(n));if("x3d-canvas"===e.prop("nodeName").toLowerCase()){const i=kO(e[0].attachShadow({mode:"open",delegatesFocus:!0})),n=kO("<link/>");n.on("load",(()=>t.show())).attr("rel","stylesheet").attr("type","text/css").attr("href",new URL("x_ite.css",so.getScriptURL()).href),this[HO]=i.append(n).append(t.hide())}else this[HO]=e.prepend(t);kO("<div></div>").addClass("x_ite-private-x_ite").html(this.getName()+"<span class='x_ite-private-x3d'>X3D</span>").appendTo(r),kO("<div></div>").addClass("x_ite-private-progressbar").appendTo(r).append(kO("<div></div>")),kO("<div></div>").addClass("x_ite-private-spinner-text").appendTo(r),this[zO]=++lE,this[JO]=new jO(localStorage,"X_ITE.X3DBrowser("+this[zO]+")."),this[KO]=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),this[GO]=e,this[qO]=i,this[YO]=kO("<canvas></canvas>").addClass("x_ite-private-canvas").prependTo(i),this[WO]=xv.create(this[YO][0],2,"true"===e.attr("preserveDrawingBuffer"),this[KO]),this[$O]=n,this[tE]=new Yv(this.getPrivateScene()),this[QO]=new jv(this.getPrivateScene()),this[eE]=new Gv(this.getPrivateScene()),this[ZO]=new Mv(this.getPrivateScene()),this[iE]=new Kv(this.getPrivateScene()),this[nE]=new iO(this.getPrivateScene());const s=kO("<div></div>").hide().css("height","10in").appendTo(kO("body"));this[aE]=s.height()/720||1,s.remove(),this.addChildObjects(d.outputOnly,"controlKey",new $n.SFBool,d.outputOnly,"shiftKey",new $n.SFBool,d.outputOnly,"altKey",new $n.SFBool,d.outputOnly,"commandKey",new $n.SFBool,d.outputOnly,"altGrKey",new $n.SFBool)}Object.assign(uE.prototype,{initialize(){this[tE].setup(),this[QO].setup(),this[eE].setup(),this[ZO].setup(),this[iE].setup(),this[nE].setup(),Object.defineProperties(this.getElement().get(0),{browser:{value:this,enumerable:!0},src:{get:()=>this.getExecutionContext().getWorldURL(),set:e=>{this.loadURL(new $n.MFString(e)).catch((e=>console.error(e)))},enumerable:!0},url:{get:()=>new $n.MFString(this.getExecutionContext().getWorldURL()),set:e=>{this.loadURL(e).catch((e=>console.error(e)))},enumerable:!0}}),this.getElement().on("keydown.X3DCoreContext",this[sE].bind(this)).on("keyup.X3DCoreContext",this[oE].bind(this))},getInstanceId(){return this[zO]},isStrict:()=>!1,getElement(){return this[GO]},getShadow(){return this[HO]},getSurface(){return this[qO]},getSplashScreen(){return this[$O]},getCanvas(){return this[YO]},getContext(){return this[WO]},getMobile(){return this[KO]},getLocalStorage(){return this[JO]},getBrowserTimings(){return this[ZO]},getBrowserOptions(){return this[QO]},getBrowserProperties(){return this[eE]},getRenderingProperties(){return this[tE]},getNotification(){return this[iE]},getContextMenu(){return this[nE]},getPrivateScene(){return this[rE]||(this[rE]=new PO(this),this[rE].setLive(!0),this[rE].setup()),this[rE]},getPixelsPerPoint(){return this[aE]*this.getRenderingProperty("ContentScale")},connectedCallback(){},attributeChangedCallback(e,t,i){switch(e){case"antialiased":this.setBrowserOption("Antialiased",this.parseBooleanAttribute(i,!0));break;case"baseURL":case"baseurl":this.setBaseURL(i);break;case"cache":this.setBrowserOption("Cache",this.parseBooleanAttribute(i,!0));break;case"contentScale":case"contentscale":this.setBrowserOption("ContentScale","auto"===i?-1:parseFloat(i));break;case"contextMenu":case"contextmenu":this.setBrowserOption("ContextMenu",this.parseBooleanAttribute(i,!0));break;case"debug":this.setBrowserOption("Debug",this.parseBooleanAttribute(i,!1));break;case"multisampling":{const e=parseInt(i);this.setBrowserOption("Multisampling",isNaN(e)?4:e);break}case"notifications":this.setBrowserOption("Notifications",this.parseBooleanAttribute(i,!0));break;case"oninitialized":case"onshutdown":try{this.getElement()[0][e]=new Function("event",i)}catch(e){console.error(e)}break;case"orderIndependentTransparency":case"orderindependenttransparency":this.setBrowserOption("OrderIndependentTransparency",this.parseBooleanAttribute(i,!1));break;case"splashScreen":case"splashscreen":this.setBrowserOption("SplashScreen",this.parseBooleanAttribute(i,!0)),this.getBrowserOption("SplashScreen")||(this.getCanvas().show(),this.getSplashScreen().stop(!0,!0).hide());break;case"src":i&&this.loadURL(new $n.MFString(i)).catch((e=>console.error(e)));break;case"timings":this.setBrowserOption("Timings",this.parseBooleanAttribute(i,!1));break;case"update":"auto"===i?this.setBrowserOption("AutoUpdate",!0):(this.setBrowserOption("AutoUpdate",!1),this.parseBooleanAttribute(i,!0)?this.beginUpdate():this.endUpdate());break;case"url":i&&this.loadURL(this.parseUrlAttribute(i)).catch((e=>console.error(e)))}},parseBooleanAttribute:(e,t)=>"true"===e||"false"!==e&&t,parseUrlAttribute(e){try{const t=new $n.MFString;return t.fromString("["+e+"]",this.getExecutionContext()),t}catch{throw new Error("Couldn't parse url attribute.")}},callBrowserEventHandler:(()=>{const e=new Set(["error","load"]);return function(t){const i=this.getElement()[0];for(const n of t.split(" ")){const t=new CustomEvent(n);try{e.has(n)||i[`on${n}`]?.(t)}catch(e){console.error(e)}i.dispatchEvent(t)}}})(),getShiftKey(){return this._shiftKey.getValue()},getControlKey(){return this._controlKey.getValue()},getAltKey(){return this._altKey.getValue()},getCommandKey(){return this._commandKey.getValue()},getAltGrKey(){return this._altGrKey.getValue()},[sE](e){switch(e.keyCode){case 16:this._shiftKey=!0;break;case 17:this._controlKey=!0;break;case 18:this._altKey=!0;break;case 49:this.getBrowserOption("Debug")&&this.getControlKey()&&(e.preventDefault(),this.setBrowserOption("Shading","POINT"),this.getNotification()._string="Shading: Pointset");break;case 50:this.getBrowserOption("Debug")&&this.getControlKey()&&(e.preventDefault(),this.setBrowserOption("Shading","WIREFRAME"),this.getNotification()._string="Shading: Wireframe");break;case 51:this.getBrowserOption("Debug")&&this.getControlKey()&&(e.preventDefault(),this.setBrowserOption("Shading","FLAT"),this.getNotification()._string="Shading: Flat");break;case 52:this.getBrowserOption("Debug")&&this.getControlKey()&&(e.preventDefault(),this.setBrowserOption("Shading","GOURAUD"),this.getNotification()._string="Shading: Gouraud");break;case 53:this.getBrowserOption("Debug")&&this.getControlKey()&&(e.preventDefault(),this.setBrowserOption("Shading","PHONG"),this.getNotification()._string="Shading: Phong");break;case 83:this.getBrowserOption("Debug")&&this.getControlKey()&&(e.preventDefault(),this.isLive()?this.endUpdate():this.beginUpdate(),this.getNotification()._string=this.getLive().getValue()?"Begin Update":"End Update");break;case 91:this._commandKey=!0;break;case 225:this._altGrKey=!0;break;case 171:case 187:this.getControlKey()&&(e.preventDefault(),this.setBrowserOption("Timings",!this.getBrowserOption("Timings")));break;case 36:e.preventDefault(),this.firstViewpoint();break;case 35:e.preventDefault(),this.lastViewpoint();break;case 33:e.preventDefault(),this.previousViewpoint();break;case 34:e.preventDefault(),this.nextViewpoint();break;case 119:if(this.getShiftKey()){e.preventDefault();const t=this.getActiveViewpoint();if(!t)break;const i=this.getExecutionContext().createNode(t.getTypeName());switch(t.getTypeName()){case"Viewpoint":i.position=t.getUserPosition(),i.orientation=t.getUserOrientation(),i.centerOfRotation=t.getUserCenterOfRotation(),i.fieldOfView=t.getFieldOfView();break;case"OrthoViewpoint":i.position=t.getUserPosition(),i.orientation=t.getUserOrientation(),i.centerOfRotation=t.getUserCenterOfRotation(),i.fieldOfView=new $n.MFFloat(t.getMinimumX(),t.getMinimumY(),t.getMaximumX(),t.getMaximumY());break;case"GeoViewpoint":{const e=t._geoOrigin,n=new Tt(0,0,0);if(e.getValue()&&"GeoOrigin"===e.getNodeTypeName()){const t=this.getPrivateScene().createNode("GeoOrigin");i.geoOrigin=t,t.geoSystem=e.geoSystem,t.geoCoords=e.geoCoords,t.rotateYUp=e.rotateYUp}i.geoSystem=t._geoSystem,i.position=t.getGeoCoord(t.getUserPosition(),n),i.orientation=t.getUserOrientation(),i.centerOfRotation=t.getGeoCoord(t.getUserCenterOfRotation(),n),i.fieldOfView=t.getFieldOfView();break}}const n={scene:this.getExecutionContext()};let r;switch(this.getExecutionContext().getEncoding()){case"ASCII":case"VRML":r=i.toVRMLString(n);break;case"JSON":r=i.toJSONString(n);break;default:r=i.toXMLString(n)}r+="\n",this.copyToClipboard(r),this.getNotification()._string=Ev("Viewpoint copied to clipboard."),console.log("Viewpoint copied to clipboard."),console.debug(r)}}},[oE](e){switch(e.which){case 16:this._shiftKey=!1;break;case 17:this._controlKey=!1;break;case 18:this._altKey=!1;break;case 91:this._commandKey=!1;break;case 225:this._altGrKey=!1}},copyToClipboard(e){const t=kO("<textarea></textarea>");this.getShadow().find(".x_ite-private-browser").prepend(t),t.text(e).trigger("select"),document.execCommand("copy"),t.remove()},dispose(){this[WO].getExtension("WEBGL_lose_context")?.loseContext()}});const hE=uE;i.add("X3DCoreContext","x_ite/Browser/Core/X3DCoreContext",hE);const dE=hE,cE=Symbol();function pE(){}Object.assign(pE.prototype,{getBackgroundTextureProperties(){return this[cE]=new sv(this.getPrivateScene()),this[cE]._boundaryModeS="CLAMP_TO_EDGE",this[cE]._boundaryModeT="CLAMP_TO_EDGE",this[cE]._boundaryModeR="CLAMP_TO_EDGE",this[cE]._minificationFilter="NICEST",this[cE]._magnificationFilter="NICEST",this[cE]._textureCompression="DEFAULT",this[cE].setup(),this.getBackgroundTextureProperties=function(){return this[cE]},Object.defineProperty(this,"getBackgroundTextureProperties",{enumerable:!1}),this[cE]}});const gE=pE;i.add("X3DEnvironmentalEffectsContext","x_ite/Browser/EnvironmentalEffects/X3DEnvironmentalEffectsContext",gE);const fE=gE;function mE(e){pr.call(this,e)}Object.assign(Object.setPrototypeOf(mE.prototype,pr.prototype),{initialize(){pr.prototype.initialize.call(this)},getGeometry(){if(this.geometry)return this.geometry;this.geometry=new up(this.getExecutionContext()),this.geometry._texCoord=new QT(this.getExecutionContext()),this.geometry._coord=new Lm(this.getExecutionContext());const e=this.geometry,t=this.geometry._texCoord.getValue(),i=this.geometry._coord.getValue();return e._texCoordIndex=new $n.MFInt32(0,1,2,3,-1,0,1,2,3,-1,0,1,2,3,-1,0,1,2,3,-1,0,1,2,3,-1,0,1,2,3,-1),e._coordIndex=new $n.MFInt32(0,1,2,3,-1,5,4,7,6,-1,1,5,6,2,-1,4,0,3,7,-1,4,5,1,0,-1,3,2,6,7,-1),t._point=new $n.MFVec2f(new $n.SFVec2f(1,1),new $n.SFVec2f(0,1),new $n.SFVec2f(0,0),new $n.SFVec2f(1,0)),i._point=new $n.MFVec3f(new $n.SFVec3f(1,1,1),new $n.SFVec3f(-1,1,1),new $n.SFVec3f(-1,-1,1),new $n.SFVec3f(1,-1,1),new $n.SFVec3f(1,1,-1),new $n.SFVec3f(-1,1,-1),new $n.SFVec3f(-1,-1,-1),new $n.SFVec3f(1,-1,-1)),t.setup(),i.setup(),e.setup(),this.geometry}}),Object.defineProperties(mE,{typeName:{value:"BoxOptions",enumerable:!0}});const _E=mE;i.add("BoxOptions","x_ite/Browser/Geometry3D/BoxOptions",_E);const xE=_E;function yE(e){pr.call(this,e),this.addChildObjects(d.inputOutput,"xDimension",new $n.SFInt32(20),d.inputOutput,"yDimension",new $n.SFInt32(1))}Object.setPrototypeOf(yE.prototype,pr.prototype),Object.defineProperties(yE,{typeName:{value:"ConeOptions",enumerable:!0}});const wE=yE;i.add("ConeOptions","x_ite/Browser/Geometry3D/ConeOptions",wE);const bE=wE;function SE(e){pr.call(this,e),this.addChildObjects(d.inputOutput,"xDimension",new $n.SFInt32(20),d.inputOutput,"yDimension",new $n.SFInt32(1))}Object.setPrototypeOf(SE.prototype,pr.prototype),Object.defineProperties(SE,{typeName:{value:"CylinderOptions",enumerable:!0}});const TE=SE;i.add("CylinderOptions","x_ite/Browser/Geometry3D/CylinderOptions",TE);const vE=TE;function OE(e){pr.call(this,e),this.addChildObjects(d.inputOutput,"xDimension",new $n.SFInt32(32),d.inputOutput,"yDimension",new $n.SFInt32(15))}Object.assign(Object.setPrototypeOf(OE.prototype,pr.prototype),{initialize(){pr.prototype.initialize.call(this),this.addInterest("eventsProcessed",this)},getGeometry(){return this.geometry||this.eventsProcessed(),this.geometry},createTexCoordIndex(){const e=this._xDimension.getValue()+1,t=this._yDimension.getValue(),i=this.geometry._texCoordIndex;for(let t=0,n=e-1;t<n;++t)i.push(t),i.push(t+e-1),i.push(t+e),i.push(-1);for(let n=e-1,r=0,s=t-3;r<s;++r,++n)for(let t=0,r=e-1;t<r;++t,++n)i.push(n),i.push(n+e),i.push(n+e+1),i.push(n+1),i.push(-1);let n=(t-2)*e-1;for(let t=0,r=e-1;t<r;++t,++n)i.push(n+e),i.push(n+1),i.push(n),i.push(-1)},createTexCoord(){const e=this._xDimension.getValue()+1,t=this._yDimension.getValue(),i=this.geometry._texCoord.getValue()._point,n=-.5/(e-1);for(let t=1;t<e;++t){const r=t/(e-1)+n;i.push(new _t(r,1))}for(let n=1,r=t-1;n<r;++n){const r=1-n/(t-1);for(let t=0;t<e;++t){const n=t/(e-1);i.push(new _t(n,r))}}for(let t=1;t<e;++t){const r=t/(e-1)+n;i.push(new _t(r,0))}},createCoordIndex(){const e=this._xDimension.getValue()+1,t=this._yDimension.getValue(),i=this.geometry._coordIndex;let n=1;for(const t=e-1;n<t;++n)i.push(0),i.push(n),i.push(n+1),i.push(-1);i.push(0),i.push(n),i.push(1),i.push(-1);let r=1;for(let n=0,s=t-3;n<s;++n,++r){for(let t=0,n=e-2;t<n;++t,++r)i.push(r),i.push(r+e-1),i.push(r+e),i.push(r+1),i.push(-1);i.push(r),i.push(r+e-1),i.push(r+1),i.push(r-e+2),i.push(-1)}const s=r+e-1;for(let t=0,n=e-2;t<n;++t,++r)i.push(s),i.push(r+1),i.push(r),i.push(-1);i.push(s),i.push(s-e+1),i.push(r),i.push(-1)},createPoints(){const e=this._xDimension.getValue()+1,t=this._yDimension.getValue(),i=this.geometry._coord.getValue()._point;i.push(new Tt(0,1,0));for(let n=1,r=t-1;n<r;++n){const t=Lo.Polar(1,-Math.PI*n/r);for(let n=0,r=e-1;n<r;++n){const e=Lo.Polar(t.imag,2*Math.PI*n/r);i.push(new Tt(e.imag,t.real,e.real))}}i.push(new Tt(0,-1,0))},eventsProcessed(){this.geometry=new up(this.getExecutionContext()),this.geometry._texCoord=new QT(this.getExecutionContext()),this.geometry._coord=new Lm(this.getExecutionContext()),this.createTexCoordIndex(),this.createTexCoord(),this.createCoordIndex(),this.createPoints();const e=this.geometry,t=this.geometry._texCoord.getValue(),i=this.geometry._coord.getValue();e._creaseAngle=Math.PI,t.setup(),i.setup(),e.setup()}}),Object.defineProperties(OE,{typeName:{value:"QuadSphereOptions",enumerable:!0}});const EE=OE;i.add("QuadSphereOptions","x_ite/Browser/Geometry3D/QuadSphereOptions",EE);const CE=EE;function NE(){}function IE(e,t){const i=new t(this.getPrivateScene());return i.setup(),this[e]=function(){return i},Object.defineProperty(this,e,{enumerable:!1}),i}Object.assign(NE.prototype,{initialize(){this.setPrimitiveQuality3D(this.getBrowserOptions().getPrimitiveQuality())},getBoxOptions(){return IE.call(this,"getBoxOptions",xE)},getConeOptions(){return IE.call(this,"getConeOptions",bE)},getCylinderOptions(){return IE.call(this,"getCylinderOptions",vE)},getSphereOptions(){return IE.call(this,"getSphereOptions",CE)},setPrimitiveQuality3D(e){const t=this.getConeOptions(),i=this.getCylinderOptions(),n=this.getSphereOptions();switch(e){case Pv.LOW:t._xDimension=16,i._xDimension=16,n._xDimension=20,n._yDimension=9;break;case Pv.MEDIUM:t._xDimension=20,i._xDimension=20,n._xDimension=32,n._yDimension=15;break;case Pv.HIGH:t._xDimension=32,i._xDimension=32,n._xDimension=64,n._yDimension=31}}});const FE=NE;i.add("X3DGeometry3DContext","x_ite/Browser/Geometry3D/X3DGeometry3DContext",FE);const ME=FE,DE=Symbol();function RE(){}Object.assign(RE.prototype,{getBBoxNode(){const e=new Ub(this.getPrivateScene()),t=new qm(this.getPrivateScene()),i=new Lm(this.getPrivateScene());return e._geometry=t,t._coordIndex=[0,1,2,3,0,-1,4,5,6,7,4,-1,0,4,-1,1,5,-1,2,6,-1,3,7,-1],t._coord=i,i._point=[.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5],i.setup(),t.setup(),e.setup(),this[DE]=e,this.getBBoxNode=function(){return this[DE]},Object.defineProperty(this,"getBBoxNode",{enumerable:!1}),e}});const PE=RE;i.add("X3DGroupingContext","x_ite/Browser/Grouping/X3DGroupingContext",PE);const AE=PE,VE=Symbol();function LE(){this[VE]=new Fg(this.getPrivateScene())}Object.assign(LE.prototype,{initialize(){this[VE].setPrivate(!0),this[VE].setup()},getDefaultViewport(){return this[VE]}});const BE=LE;i.add("X3DLayeringContext","x_ite/Browser/Layering/X3DLayeringContext",BE);const UE=BE,XE=Symbol(),jE=Symbol(),kE=Symbol();function zE(){const e=this.getContext(),t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this[XE]=t>8?8:2,this[kE]=[]}Object.assign(zE.prototype,{getMaxLights(){return this[XE]},getGGXLUTTexture(){return this[jE]=new ru(this.getPrivateScene()),this[jE]._url=[so.getLibraryURL("lut_ggx.png")],this[jE]._repeatS=!1,this[jE]._repeatT=!1,this[jE].setup(),this.getGGXLUTTexture=function(){return this[jE]},Object.defineProperty(this,"getGGXLUTTexture",{enumerable:!1}),this[jE]},popShadowBuffer(e){try{const t=this[kE][e];if(t){if(t.length)return t.pop()}else this[kE][e]=[];return new Na(this,e,e,!0)}catch(e){return console.error(e),null}},pushShadowBuffer(e){e&&this[kE][e.getWidth()].push(e)}});const GE=zE;i.add("X3DLightingContext","x_ite/Browser/Lighting/X3DLightingContext",GE);const HE=GE;function qE(e,t){pr.call(this,e),this.navigationInfo=t}Object.assign(Object.setPrototypeOf(qE.prototype,pr.prototype),{getActiveLayer(){return this.getBrowser().getActiveLayer()},getViewport(){return this.getBrowser().getActiveLayer().getViewport().getRectangle()},getNavigationInfo(){return this.navigationInfo},getActiveViewpoint(){return this.getBrowser().getActiveLayer().getViewpoint()},getStraightenHorizon(){return this.getBrowser().getBrowserOption("StraightenHorizon")},getButton(e){return 0===e&&this.getBrowser().getAltKey()?1:e},isPointerInRectangle:(()=>{const e=new _t(0,0);return function(t,i){const n=this.getBrowser(),r=this.getViewport();return n.isPointerInRectangle(r,e.set(t,i))}})(),getPointOnCenterPlane:(()=>{const e=new Tt(0,0,-1),t=new Tt(0,0,0),i=new Tt(0,0,0);return function(n,r,s){const o=this.getNavigationInfo(),a=this.getActiveViewpoint(),l=this.getViewport(),u=a.getProjectionMatrixWithLimits(o.getNearValue(),o.getFarValue(a),l);if(Oa.unProjectPoint(n,r,.9,gi.Identity,u,l,i),a instanceof _f)return s.set(i.x,i.y,-this.getDistanceToCenter(t).magnitude());const h=i.normalize();return s.assign(h).multiply(this.getDistanceToCenter(t).magnitude()/h.dot(e))}})(),getDistanceToCenter(e,t){const i=this.getActiveViewpoint();return e.assign(i.getPosition()).add(t||i._positionOffset.getValue()).subtract(i.getUserCenterOfRotation())},trackballProjectToSphere(e,t,i){const n=this.getViewport();return e=(e-n[0])/n[2]-.5,t=(t-n[1])/n[3]-.5,i.set(e,t,function(e,t,i){const n=Math.hypot(t,i);if(n<e*Math.sqrt(.5))return Math.sqrt(e*e-n*n);const r=e/Math.sqrt(2);return r*r/n}(.5,e,t))},lookAtPoint(e,t,i){if(!this.touch(e,t))return;const n=this.getActiveViewpoint(),r=this.getBrowser().getHit();n.lookAtPoint(this.getActiveLayer(),r.point,1,.381966,i)},lookAtBBox(e,t,i){if(!this.touch(e,t))return;const n=this.getActiveViewpoint(),r=this.getBrowser().getHit(),s=r.shapeNode.getBBox(new Xa).multRight(r.modelViewMatrix).multRight(n.getCameraSpaceMatrix());n.lookAtBBox(this.getActiveLayer(),s,1,.381966,i)},touch(e,t){return this.getBrowser().touch(e,t)}});const YE=qE;i.add("X3DViewer","x_ite/Browser/Navigation/X3DViewer",YE);const WE=YE;n(62);var $E=n(328);const JE=/Mac OS X/i.test(navigator.userAgent),KE=JE?1/120:.05;function ZE(e,t){WE.call(this,e,t),this.button=-1,this.orientationOffset=new ui,this.fromVector=new Tt(0,0,0),this.toVector=new Tt(0,0,0),this.fromPoint=new Tt(0,0,0),this.toPoint=new Tt(0,0,0),this.rotation=new ui,this.direction=new Tt(0,0,0),this.axis=new Tt(0,0,0),this.pressTime=0,this.motionTime=0,this.touchMode=0,this.touch1=new _t(0,0),this.touch2=new _t(0,0),this.tapStart=0,this.dblTapInterval=.4,this.initialPositionOffset=new Tt(0,0,0),this.initialOrientationOffset=new ui,this.positionChaser=new xc(e),this.centerOfRotationChaser=new xc(e),this.rotationChaser=new hc(e),this.timeSensor=new yu(e)}Object.assign(Object.setPrototypeOf(ZE.prototype,WE.prototype),{initialize(){WE.prototype.initialize.call(this);const e=this.getBrowser(),t=e.getSurface();this.getNavigationInfo()._transitionStart.addInterest("disconnect",this),e.getBrowserOptions()._StraightenHorizon.addInterest("disconnect",this),e._activeViewpoint.addInterest("set_activeViewpoint__",this),t.on("mousedown.ExamineViewer",this.mousedown.bind(this)),t.on("mouseup.ExamineViewer",this.mouseup.bind(this)),t.on("dblclick.ExamineViewer",this.dblclick.bind(this)),t.on("mousewheel.ExamineViewer",this.mousewheel.bind(this)),t.on("touchstart.ExamineViewer",this.touchstart.bind(this)),t.on("touchend.ExamineViewer",this.touchend.bind(this)),this.positionChaser._duration=.2,this.positionChaser.setup(),this.centerOfRotationChaser._duration=.2,this.centerOfRotationChaser.setup(),this.rotationChaser._duration=.2,this.rotationChaser.setup(),this.timeSensor._loop=!0,this.timeSensor._stopTime=e.getCurrentTime(),this.timeSensor.setup(),this.timeSensor._fraction_changed.addInterest("spin",this),this.set_activeViewpoint__()},set_activeViewpoint__(){if(this.getStraightenHorizon()){const e=this.getActiveViewpoint();e&&(e._orientationOffset=this.getOrientationOffset(ui.Identity,e._orientationOffset.getValue(),!1))}this.disconnect()},mousedown(e){if(this.button>=0)return;this.pressTime=Date.now();const{x:t,y:i}=this.getBrowser().getPointerFromEvent(e);if(this.isPointerInRectangle(t,i))switch(this.getButton(e.button)){case 0:e.preventDefault(),e.stopImmediatePropagation(),this.button=e.button,$E(document).on("mouseup.ExamineViewer"+this.getId(),this.mouseup.bind(this)),$E(document).on("mousemove.ExamineViewer"+this.getId(),this.mousemove.bind(this)),$E(document).on("touchend.ExamineViewer"+this.getId(),this.touchend.bind(this)),$E(document).on("touchmove.ExamineViewer"+this.getId(),this.touchmove.bind(this)),this.disconnect(),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.trackballProjectToSphere(t,i,this.fromVector),this.rotation.assign(ui.Identity),this.motionTime=0,this._isActive=!0;break;case 1:e.preventDefault(),e.stopImmediatePropagation(),this.button=e.button,$E(document).on("mouseup.ExamineViewer"+this.getId(),this.mouseup.bind(this)),$E(document).on("mousemove.ExamineViewer"+this.getId(),this.mousemove.bind(this)),$E(document).on("touchend.ExamineViewer"+this.getId(),this.touchend.bind(this)),$E(document).on("touchmove.ExamineViewer"+this.getId(),this.touchmove.bind(this)),this.disconnect(),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.getPointOnCenterPlane(t,i,this.fromPoint),this._isActive=!0}},mouseup(e){if(e.button===this.button)switch(this.button=-1,$E(document).off(".ExamineViewer"+this.getId()),this.getButton(e.button)){case 0:e.preventDefault(),e.stopImmediatePropagation(),this.getBrowser().setCursor("DEFAULT"),Math.abs(this.rotation.angle)>.003&&Date.now()-this.motionTime<40&&this.addSpinning(this.rotation),this._isActive=!1;break;case 1:e.preventDefault(),e.stopImmediatePropagation(),this.getBrowser().setCursor("DEFAULT"),this._isActive=!1}},dblclick(e){e.preventDefault(),e.stopImmediatePropagation();const{x:t,y:i}=this.getBrowser().getPointerFromEvent(e);this.disconnect(),this.lookAtBBox(t,i,this.getStraightenHorizon())},mousemove:(()=>{const e=new Tt(0,0,0);return function(t){const{x:i,y:n}=this.getBrowser().getPointerFromEvent(t);switch(this.getButton(this.button)){case 0:{t.preventDefault(),t.stopImmediatePropagation();const e=this.trackballProjectToSphere(i,n,this.toVector);if(this.rotation.setFromToVec(e,this.fromVector),Math.abs(this.rotation.angle)<.003&&Date.now()-this.pressTime<50)return;this.addRotate(this.rotation),this.fromVector.assign(e),this.motionTime=Date.now();break}case 1:{t.preventDefault(),t.stopImmediatePropagation();const r=this.getActiveViewpoint(),s=this.getPointOnCenterPlane(i,n,this.toPoint),o=r.getUserOrientation().multVecRot(e.assign(this.fromPoint).subtract(s));this.addMove(o,o),this.fromPoint.assign(s);break}}}})(),mousewheel:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0);return function(i){const{x:n,y:r}=this.getBrowser().getPointerFromEvent(i);if(!this.isPointerInRectangle(n,r))return;i.preventDefault(),i.stopImmediatePropagation();const s=this.getBrowser(),o=this.getActiveViewpoint();s.prepareEvents().removeInterest("spin",this),o.transitionStop(),this.getDistanceToCenter(e).multiply(i.zoomFactor||KE),o.getUserOrientation().multVecRot(t.set(0,0,e.magnitude())),i.deltaY>0?this.addMove(t.negate(),Tt.Zero):i.deltaY<0&&this.addMove(t,Tt.Zero)}})(),touchstart(e){const t=e.originalEvent.touches;switch(t.length){case 1:e.button=0,e.pageX=t[0].pageX,e.pageY=t[0].pageY,this.mousedown(e),this.touch1.set(t[0].pageX,t[0].pageY);break;case 2:this.touchend(e),e.button=1,e.pageX=(t[0].pageX+t[1].pageX)/2,e.pageY=(t[0].pageY+t[1].pageY)/2,this.mousedown(e),this.touch1.set(t[0].pageX,t[0].pageY),this.touch2.set(t[1].pageX,t[1].pageY);break;case 3:this.touchend(e)}},touchend(e){switch(this.button){case 0:e.button=0,e.pageX=this.touch1.x,e.pageY=this.touch1.y,this.mouseup(e),this.tapedTwice?this.dblclick(e):(this.tapedTwice=!0,setTimeout((()=>this.tapedTwice=!1),300));break;case 1:this.touchMode=0,e.button=1,this.mouseup(e)}},touchmove:(()=>{const e=new _t(0,0),t=new _t(0,0);return function(i){const n=i.originalEvent.touches;switch(n.length){case 1:i.pageX=n[0].pageX,i.pageY=n[0].pageY,this.mousemove(i);break;case 2:{e.set(n[0].pageX,n[0].pageY).subtract(this.touch1).normalize(),t.set(n[1].pageX,n[1].pageY).subtract(this.touch2).normalize();const r=e.dot(t)>.7,s=e.dot(t)<-.7;switch(this.touchMode||(r?1:s?2:0)){case 1:this.touchMode=1,i.pageX=(n[0].pageX+n[1].pageX)/2,i.pageY=(n[0].pageY+n[1].pageY)/2,this.mousemove(i);break;case 2:{this.touchMode=2;const e=this.touch1.distance(this.touch2);this.touch1.set(n[0].pageX,n[0].pageY),this.touch2.set(n[1].pageX,n[1].pageY);const t=this.touch1.distance(this.touch2)-e;i.deltaY=t,i.zoomFactor=Math.abs(t)/$E(window).width(),i.pageX=(n[0].pageX+n[1].pageX)/2,i.pageY=(n[0].pageY+n[1].pageY)/2,this.mousewheel(i);break}}this.touch1.set(n[0].pageX,n[0].pageY),this.touch2.set(n[1].pageX,n[1].pageY);break}}}})(),set_positionOffset__(e){this.getActiveViewpoint()._positionOffset=e},set_centerOfRotationOffset__(e){this.getActiveViewpoint()._centerOfRotationOffset=e},set_rotation__(e){const t=this.getActiveViewpoint();t._orientationOffset=this.getOrientationOffset(e.getValue(),this.initialOrientationOffset,!1),t._positionOffset=this.getPositionOffset(this.initialPositionOffset,this.initialOrientationOffset,t._orientationOffset.getValue())},addRotate:(()=>{const e=new ui;return function(t){const i=this.getActiveViewpoint();if(this.rotationChaser._isActive.getValue()&&this.rotationChaser._value_changed.hasInterest("set_rotation__",this))try{e.assign(this.rotationChaser._set_destination.getValue()).multLeft(t),this.getOrientationOffset(e,this.initialOrientationOffset,!0),this.rotationChaser._set_destination=e}catch{t=this.getHorizonRotation(t),e.assign(this.rotationChaser._set_destination.getValue()).multLeft(t),this.rotationChaser._set_destination=e}else try{this.initialOrientationOffset.assign(i._orientationOffset.getValue()),this.initialPositionOffset.assign(i._positionOffset.getValue()),this.getOrientationOffset(t,this.initialOrientationOffset,!0),this.rotationChaser._set_value=ui.Identity,this.rotationChaser._set_destination=t}catch{this.rotationChaser._set_value=ui.Identity,this.rotationChaser._set_destination=this.getHorizonRotation(t)}this.disconnect(),this.rotationChaser._value_changed.addInterest("set_rotation__",this)}})(),addSpinning(e){if(this.disconnect(),this.getStraightenHorizon()){const t=this.getActiveViewpoint(),i=t.getUserPosition(),n=t.getUserCenterOfRotation(),r=i.copy().subtract(n),s=this.getHorizonRotation(e),o=t.getUpVector(!0);this.axis.assign(o),s.getAxis(new Tt(0,0,0)).dot(Tt.yAxis)<0!=s.angle<0&&this.axis.negate(),this.timeSensor._cycleInterval=Math.PI/(.4*e.angle*30),this.timeSensor._startTime=this.getBrowser().getCurrentTime();const a=t.getLookAtRotation(i,n);this.direction.assign(r),this.orientationOffset.assign(t.getUserOrientation()).multRight(a.inverse())}else this.getBrowser().prepareEvents().addInterest("spin",this),this.rotation.assign(e)},spin:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0),i=new ui,n=new ui;return function(){const r=this.getActiveViewpoint();if(this.getStraightenHorizon()){const n=r.getUserCenterOfRotation(),s=this.timeSensor._fraction_changed.getValue(),o=new ui(this.axis,2*Math.PI*s).multVecRot(e.assign(this.direction)).add(n),a=r.getLookAtRotation(o,r.getUserCenterOfRotation());t.assign(o).subtract(r.getPosition()),i.assign(r.getOrientation()).inverse().multRight(this.orientationOffset).multRight(a),r._positionOffset=t,r._orientationOffset=i}else n.assign(ui.Identity).slerp(this.rotation,24/this.getBrowser().getCurrentFrameRate()),this.orientationOffset.assign(r._orientationOffset.getValue()),r._orientationOffset=this.getOrientationOffset(n,this.orientationOffset),r._positionOffset=this.getPositionOffset(r._positionOffset.getValue(),this.orientationOffset,r._orientationOffset.getValue())}})(),addMove:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0);return function(i,n){const r=this.getActiveViewpoint();this.positionChaser._isActive.getValue()&&this.positionChaser._value_changed.hasInterest("set_positionOffset__",this)?(e.assign(this.positionChaser._set_destination.getValue()).add(i),this.positionChaser._set_destination=e):(e.assign(r._positionOffset.getValue()).add(i),this.positionChaser._set_value=r._positionOffset,this.positionChaser._set_destination=e),this.centerOfRotationChaser._isActive.getValue()&&this.centerOfRotationChaser._value_changed.hasInterest("set_centerOfRotationOffset__",this)?(t.assign(this.centerOfRotationChaser._set_destination.getValue()).add(n),this.centerOfRotationChaser._set_destination=t):(t.assign(r._centerOfRotationOffset.getValue()).add(n),this.centerOfRotationChaser._set_value=r._centerOfRotationOffset,this.centerOfRotationChaser._set_destination=t),this.disconnect(),this.positionChaser._value_changed.addInterest("set_positionOffset__",this),this.centerOfRotationChaser._value_changed.addInterest("set_centerOfRotationOffset__",this)}})(),getPositionOffset:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0),i=new ui;return function(n,r,s){return this.getDistanceToCenter(e,n),i.assign(r).inverse().multRight(s).multVecRot(t.assign(e)).subtract(e).add(n)}})(),getOrientationOffset:(()=>{const e=new ui,t=new ui,i=new Tt(0,0,0);return function(n,r,s){const o=this.getActiveViewpoint(),a=this.getStraightenHorizon();e.assign(n).multRight(o.getOrientation()).multRight(r),a&&o.straightenHorizon(e);const l=t.assign(o.getOrientation()).inverse().multRight(e);if(a){if(!s)return l;const t=e.multVecRot(i.assign(Tt.zAxis));if(Math.abs(o.getUpVector(!0).dot(t))<.97)return l;throw new Error("Critical angle")}return l}})(),getHorizonRotation:(()=>{const e=new Tt(0,0,0);return function(t){const i=t.multVecRot(e.assign(Tt.zAxis)),n=Tt.yAxis.copy().cross(i).copy().cross(Tt.yAxis);return new ui(Tt.zAxis,n)}})(),disconnect(){const e=this.getBrowser();this.positionChaser._value_changed.removeInterest("set_positionOffset__",this),this.centerOfRotationChaser._value_changed.removeInterest("set_centerOfRotationOffset__",this),this.rotationChaser._value_changed.removeInterest("set_rotation__",this),this.timeSensor._stopTime=e.getCurrentTime(),e.prepareEvents().removeInterest("spin",this)},dispose(){const e=this.getBrowser();this.disconnect(),this.getNavigationInfo()._transitionStart.removeInterest("disconnect",this),e.getBrowserOptions()._StraightenHorizon.removeInterest("disconnect",this),e._activeViewpoint.removeInterest("set_activeViewpoint__",this),e.getSurface().off(".ExamineViewer"),$E(document).off(".ExamineViewer"+this.getId())}}),Object.defineProperties(ZE,{typeName:{value:"ExamineViewer",enumerable:!0},fieldDefinitions:{value:new Z([new k(d.outputOnly,"isActive",new $n.SFBool)]),enumerable:!0}});const QE=ZE;i.add("ExamineViewer","x_ite/Browser/Navigation/ExamineViewer",QE);const eC=QE;n(62);var tC=n(328);const iC=/Mac OS X/i.test(navigator.userAgent),nC=.007,rC=iC?Math.PI/512:Math.PI/32;function sC(e,t){WE.call(this,e,t);const i=this.getBrowser().getContext();this.button=-1,this.fromVector=new Tt(0,0,0),this.toVector=new Tt(0,0,0),this.direction=new Tt(0,0,0),this.startTime=0,this.event=null,this.lookAround=!1,this.orientationChaser=new hc(e),this.lineIndexBuffer=i.createBuffer(),this.lineColorBuffer=i.createBuffer(),this.lineVertexBuffer=i.createBuffer(),this.lineVertexArrayObject=new Sl(i),this.lineVertexArray=new Float32Array(32).fill(1),this.geometryContext=new Al({geometryType:2,colorMaterial:!0}),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.lineIndexBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,new Uint8Array([0,1,2,0,2,3,4,5,6,4,6,7]),i.STATIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,this.lineColorBuffer),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]),i.STATIC_DRAW)}Object.assign(Object.setPrototypeOf(sC.prototype,WE.prototype),{initialize(){WE.prototype.initialize.call(this);const e=this.getBrowser(),t=e.getSurface();t.on("mousedown.X3DFlyViewer",this.mousedown.bind(this)),t.on("mouseup.X3DFlyViewer",this.mouseup.bind(this)),t.on("mousewheel.X3DFlyViewer",this.mousewheel.bind(this)),t.on("touchstart.X3DFlyViewer",this.touchstart.bind(this)),t.on("touchend.X3DFlyViewer",this.touchend.bind(this)),e._controlKey.addInterest("set_controlKey__",this),this.orientationChaser._duration=.3,this.orientationChaser.setup()},addCollision(){},removeCollision(){},set_controlKey__(){this.event&&0===this.event.button&&(this.button=-1,this.mousedown(this.event))},mousedown(e){if(this.button>=0)return;this.event=e;const{x:t,y:i}=this.getBrowser().getPointerFromEvent(e);if(this.isPointerInRectangle(t,i))switch(this.getButton(e.button)){case 0:e.preventDefault(),e.stopImmediatePropagation(),this.button=e.button,tC(document).on("mouseup.X3DFlyViewer"+this.getId(),this.mouseup.bind(this)),tC(document).on("mousemove.X3DFlyViewer"+this.getId(),this.mousemove.bind(this)),tC(document).on("touchend.X3DFlyViewer"+this.getId(),this.touchend.bind(this)),tC(document).on("touchmove.X3DFlyViewer"+this.getId(),this.touchmove.bind(this)),this.disconnect(),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.addCollision(),this.getBrowser().getControlKey()||this.getBrowser().getCommandKey()||this.lookAround?this.trackballProjectToSphere(t,i,this.fromVector):(this.fromVector.set(t,0,-i),this.toVector.assign(this.fromVector),this.getFlyDirection(this.fromVector,this.toVector,this.direction),this.addFly(),this.getBrowser().getBrowserOption("Rubberband")&&this.getBrowser().finishedEvents().addInterest("display",this,0)),this._isActive=!0;break;case 1:e.preventDefault(),e.stopImmediatePropagation(),this.button=e.button,tC(document).on("mouseup.X3DFlyViewer"+this.getId(),this.mouseup.bind(this)),tC(document).on("mousemove.X3DFlyViewer"+this.getId(),this.mousemove.bind(this)),this.disconnect(),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.addCollision(),this.fromVector.set(t,i,0),this.toVector.assign(this.fromVector),this.direction.set(0,0,0),this.addPan(),this.getBrowser().getBrowserOption("Rubberband")&&this.getBrowser().finishedEvents().addInterest("display",this,1),this._isActive=!0}},mouseup(e){e.preventDefault(),e.button===this.button&&(this.event=null,this.button=-1,tC(document).off(".X3DFlyViewer"+this.getId()),this.disconnect(),this.getBrowser().setCursor("DEFAULT"),this.removeCollision(),this._isActive=!1)},mousemove(e){const t=this.getBrowser();t.addBrowserEvent(),this.event=e;const{x:i,y:n}=this.getBrowser().getPointerFromEvent(e);switch(this.getButton(this.button)){case 0:if(t.getControlKey()||t.getCommandKey()||this.lookAround){e.preventDefault(),e.stopImmediatePropagation();const t=this.trackballProjectToSphere(i,n,this.toVector);this.addRotation(this.fromVector,t),this.fromVector.assign(t);break}this.toVector.set(i,0,-n),this.getFlyDirection(this.fromVector,this.toVector,this.direction),this.direction.divide(t.getRenderingProperty("ContentScale"));break;case 1:e.preventDefault(),e.stopImmediatePropagation(),this.toVector.set(i,n,0),this.direction.assign(this.toVector).subtract(this.fromVector),this.direction.divide(t.getRenderingProperty("ContentScale"))}},mousewheel(e){const{x:t,y:i}=this.getBrowser().getPointerFromEvent(e);if(!this.isPointerInRectangle(t,i))return;e.preventDefault(),e.stopImmediatePropagation();this.getActiveViewpoint().transitionStop(),e.deltaY>0?this.addRoll(-rC):e.deltaY<0&&this.addRoll(rC)},touchstart(e){const t=e.originalEvent.touches;switch(t.length){case 1:e.button=0,e.pageX=t[0].pageX,e.pageY=t[0].pageY,this.mousedown(e);break;case 2:this.touchend(e),this.lookAround=!0,e.button=0,e.pageX=(t[0].pageX+t[1].pageX)/2,e.pageY=(t[0].pageY+t[1].pageY)/2,this.mousedown(e);break;case 3:this.touchend(e)}},touchend(e){if(0===this.button)this.lookAround=!1,e.button=0,this.mouseup(e)},touchmove(e){const t=e.originalEvent.touches;switch(t.length){case 1:e.button=0,e.pageX=t[0].pageX,e.pageY=t[0].pageY,this.mousemove(e);break;case 2:e.button=0,e.pageX=(t[0].pageX+t[1].pageX)/2,e.pageY=(t[0].pageY+t[1].pageY)/2,this.mousemove(e)}},fly:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0),i=new Tt(0,0,0),n=new ui,r=new ui,s=new ui;return function(){const o=this.getNavigationInfo(),a=this.getActiveViewpoint(),l=Date.now(),u=(l-this.startTime)/1e3;e.assign(a.getUpVector()),this.direction.z>0?s.setFromToVec(this.direction,i.set(0,0,1)):s.setFromToVec(i.set(0,0,-1),this.direction);const h=this.direction.magnitude();let d=1-s.angle/(Math.PI/2);d*=o._speed.getValue(),d*=a.getSpeedFactor(),d*=this.getBrowser().getShiftKey()?.028:nC,d*=u;const c=this.getTranslationOffset(t.assign(this.direction).multiply(d));this.getActiveLayer().constrainTranslation(c,!0),a._positionOffset=c.add(a._positionOffset.getValue());const p=1.4*u*(h/(h+40))**2;n.assign(ui.Identity).slerp(s,p).multRight(a.getUserOrientation()),this.getStraightenHorizon()&&a.straightenHorizon(n),r.assign(a.getOrientation()).inverse().multRight(n),a._orientationOffset=r,this.startTime=l}})(),pan:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0);return function(){const i=this.getNavigationInfo(),n=this.getActiveViewpoint(),r=Date.now(),s=(r-this.startTime)/1e3,o=n.getUpVector();this.constrainPanDirection(e.assign(this.direction));let a=1;a*=i._speed.getValue(),a*=n.getSpeedFactor(),a*=this.getBrowser().getShiftKey()?.0098:.007,a*=s;const l=n.getUserOrientation().multRight(new ui(n.getUserOrientation().multVecRot(t.assign(Tt.yAxis)),o)).multVecRot(e.multiply(a));this.getActiveLayer().constrainTranslation(l,!0),n._positionOffset=l.add(n._positionOffset.getValue()),this.startTime=r}})(),set_orientationOffset__(e){this.getActiveViewpoint()._orientationOffset=e},addFly(){this.startTime||(this.getBrowser().prepareEvents().addInterest("fly",this),this.getBrowser().addBrowserEvent(),this.startTime=Date.now())},addPan(){this.startTime||(this.disconnect(),this.getBrowser().prepareEvents().addInterest("pan",this),this.getBrowser().addBrowserEvent(),this.startTime=Date.now())},addRoll:(()=>{const e=new ui,t=new ui;return function(i){const n=this.getActiveViewpoint();this.orientationChaser._isActive.getValue()&&this.orientationChaser._value_changed.hasInterest("set_orientationOffset__",this)?(e.assign(n.getOrientation()).inverse().multRight(t.set(1,0,0,i)).multRight(n.getOrientation()).multRight(this.orientationChaser._set_destination.getValue()),this.orientationChaser._set_destination=e):(e.assign(n.getOrientation()).inverse().multRight(t.set(1,0,0,i)).multRight(n.getUserOrientation()),this.orientationChaser._set_value=n._orientationOffset,this.orientationChaser._set_destination=e),this.disconnect(),this.orientationChaser._value_changed.addInterest("set_orientationOffset__",this)}})(),addRotation:(()=>{const e=new ui,t=new ui;return function(i,n){const r=this.getActiveViewpoint();this.orientationChaser._isActive.getValue()&&this.orientationChaser._value_changed.hasInterest("set_orientationOffset__",this)?(e.setFromToVec(n,i).multRight(r.getOrientation()).multRight(this.orientationChaser._set_destination.getValue()),this.getStraightenHorizon()&&r.straightenHorizon(e),t.assign(r.getOrientation()).inverse().multRight(e),this.orientationChaser._set_destination=t):(e.setFromToVec(n,i).multRight(r.getUserOrientation()),this.getStraightenHorizon()&&r.straightenHorizon(e),t.assign(r.getOrientation()).inverse().multRight(e),this.orientationChaser._set_value=r._orientationOffset,this.orientationChaser._set_destination=t),this.disconnect(),this.orientationChaser._value_changed.addInterest("set_orientationOffset__",this)}})(),display:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0),i=new Tt(0,0,0),n=new Tt(0,0,0),r=new gi,s=new Float32Array(gi.Identity),o=new Float32Array(gi.Identity),a=[];return function(l){const u=this.getBrowser(),h=u.getContext(),d=u.getViewport(),c=d[2],p=d[3],g=u.getRenderingProperty("ContentScale");switch(u.getFrameBuffer().bind(),h.viewport(...d),h.scissor(...d),s.set(La.ortho(0,c,0,p,-1,1,r)),l){case 0:e.set(this.fromVector.x,-this.fromVector.z,0),t.set(this.toVector.x,-this.toVector.z,0);break;case 1:e.set(this.fromVector.x,this.fromVector.y,0),t.set(this.toVector.x,this.toVector.y,0)}i.assign(t).subtract(e).normalize().multiply(g).set(-i.y,i.x,0),this.lineVertexArray.set(n.assign(e).add(i),0),this.lineVertexArray.set(n.assign(e).subtract(i),4),this.lineVertexArray.set(n.assign(t).subtract(i),8),this.lineVertexArray.set(n.assign(t).add(i),12),i.assign(t).subtract(e).normalize().multiply(g/2).set(-i.y,i.x,0),this.lineVertexArray.set(n.assign(e).add(i),16),this.lineVertexArray.set(n.assign(e).subtract(i),20),this.lineVertexArray.set(n.assign(t).subtract(i),24),this.lineVertexArray.set(n.assign(t).add(i),28),h.bindBuffer(h.ARRAY_BUFFER,this.lineVertexBuffer),h.bufferData(h.ARRAY_BUFFER,this.lineVertexArray,h.DYNAMIC_DRAW);const f=u.getDefaultMaterial().getShader(this.geometryContext);f.enable(h),f.setClipPlanes(h,a),h.uniformMatrix4fv(f.x3d_ProjectionMatrix,!1,s),h.uniformMatrix4fv(f.x3d_ModelViewMatrix,!1,o),h.uniform3f(f.x3d_EmissiveColor,1,1,1),h.uniform1f(f.x3d_Transparency,0),this.lineVertexArrayObject.enable(f.getProgram())&&(h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this.lineIndexBuffer),f.enableColorAttribute(h,this.lineColorBuffer,0,0),f.enableVertexAttribute(h,this.lineVertexBuffer,0,0)),h.disable(h.DEPTH_TEST),h.enable(h.CULL_FACE),h.frontFace(h.CCW),h.drawElements(h.TRIANGLES,12,h.UNSIGNED_BYTE,0),h.enable(h.DEPTH_TEST)}})(),disconnect(){const e=this.getBrowser();e.addBrowserEvent(),e.prepareEvents().removeInterest("fly",this),e.prepareEvents().removeInterest("pan",this),e.finishedEvents().removeInterest("display",this),this.orientationChaser._value_changed.removeInterest("set_orientationOffset__",this),this.startTime=0},dispose(){const e=this.getBrowser().getContext();e.deleteBuffer(this.lineVertexBuffer),this.lineVertexArrayObject.delete(e),this.disconnect(),this.getBrowser()._controlKey.removeInterest("set_controlKey__",this),this.getBrowser().getSurface().off(".X3DFlyViewer"),tC(document).off(".X3DFlyViewer"+this.getId())}});const oC=sC;i.add("X3DFlyViewer","x_ite/Browser/Navigation/X3DFlyViewer",oC);const aC=oC;function lC(e,t){aC.call(this,e,t)}Object.assign(Object.setPrototypeOf(lC.prototype,aC.prototype),{initialize(){aC.prototype.initialize.call(this),this.getBrowser().addCollision(this)},getStraightenHorizon:()=>!0,getFlyDirection:(e,t,i)=>i.assign(t).subtract(e),getTranslationOffset:(()=>{const e=new Tt(0,0,0),t=new ui,i=new ui;return function(n){const r=this.getActiveViewpoint(),s=r.getUpVector();t.assign(r.getUserOrientation()),t.multVecRot(e.assign(Tt.yAxis)),i.setFromToVec(e,s);return t.multRight(i).multVecRot(n)}})(),constrainPanDirection:e=>(e.y<0&&(e.y=0),e),dispose(){this.getBrowser().removeCollision(this),aC.prototype.dispose.call(this)}}),Object.defineProperties(lC,{typeName:{value:"WalkViewer",enumerable:!0},fieldDefinitions:{value:new Z([new k(d.outputOnly,"isActive",new $n.SFBool)]),enumerable:!0}});const uC=lC;i.add("WalkViewer","x_ite/Browser/Navigation/WalkViewer",uC);const hC=uC;function dC(e,t){aC.call(this,e,t)}Object.assign(Object.setPrototypeOf(dC.prototype,aC.prototype),{addCollision(){this.getBrowser().addCollision(this)},removeCollision(){this.getBrowser().removeCollision(this)},getFlyDirection:(e,t,i)=>i.assign(t).subtract(e),getTranslationOffset(e){return this.getActiveViewpoint().getUserOrientation().multVecRot(e)},constrainPanDirection:e=>e}),Object.defineProperties(dC,{typeName:{value:"FlyViewer",enumerable:!0},fieldDefinitions:{value:new Z([new k(d.outputOnly,"isActive",new $n.SFBool)]),enumerable:!0}});const cC=dC;i.add("FlyViewer","x_ite/Browser/Navigation/FlyViewer",cC);const pC=cC;n(62);var gC=n(328);const fC=/Mac OS X/i.test(navigator.userAgent)?1/160:.05,mC=new Tt(0,0,0),_C=new Tt(0,0,0),xC=new Tt(0,0,0);function yC(e,t){WE.call(this,e,t),this.button=-1,this.fromPoint=new Tt(0,0,0),this.toPoint=new Tt(0,0,0)}Object.assign(Object.setPrototypeOf(yC.prototype,WE.prototype),{initialize(){WE.prototype.initialize.call(this);const e=this.getBrowser().getSurface();e.on("mousedown.PlaneViewer",this.mousedown.bind(this)),e.on("mouseup.PlaneViewer",this.mouseup.bind(this)),e.on("mousemove.PlaneViewer",this.mousemove.bind(this)),e.on("mousewheel.PlaneViewer",this.mousewheel.bind(this))},mousedown(e){if(this.button>=0)return;const{x:t,y:i}=this.getBrowser().getPointerFromEvent(e);if(this.isPointerInRectangle(t,i)&&1===this.getButton(e.button))e.preventDefault(),e.stopImmediatePropagation(),this.button=e.button,this.getBrowser().getSurface().off("mousemove.PlaneViewer"),gC(document).on("mouseup.PlaneViewer"+this.getId(),this.mouseup.bind(this)),gC(document).on("mousemove.PlaneViewer"+this.getId(),this.mousemove.bind(this)),this.getActiveViewpoint().transitionStop(),this.getBrowser().setCursor("MOVE"),this.getPointOnCenterPlane(t,i,this.fromPoint),this._isActive=!0},mouseup(e){e.preventDefault(),e.stopImmediatePropagation(),e.button===this.button&&(this.button=-1,gC(document).off(".PlaneViewer"+this.getId()),this.getBrowser().getSurface().on("mousemove.PlaneViewer",this.mousemove.bind(this)),this.getBrowser().setCursor("DEFAULT"),this._isActive=!1)},mousemove(e){const{x:t,y:i}=this.getBrowser().getPointerFromEvent(e);switch(this.getButton(this.button)){case 1:{e.preventDefault(),e.stopImmediatePropagation();const n=this.getActiveViewpoint(),r=this.getPointOnCenterPlane(t,i,this.toPoint),s=n.getUserOrientation().multVecRot(this.fromPoint.subtract(r));n._positionOffset=_C.assign(n._positionOffset.getValue()).add(s),n._centerOfRotationOffset=xC.assign(n._centerOfRotationOffset.getValue()).add(s),this.fromPoint.assign(r);break}}},mousewheel(e){const{x:t,y:i}=this.getBrowser().getPointerFromEvent(e);if(!this.isPointerInRectangle(t,i))return;e.preventDefault(),e.stopImmediatePropagation();const n=this.getActiveViewpoint(),r=this.getPointOnCenterPlane(t,i,this.fromPoint);n.transitionStop(),e.deltaY>0?n._fieldOfViewScale=Math.max(1e-5,n._fieldOfViewScale.getValue()*(1-fC)):e.deltaY<0&&(n._fieldOfViewScale=n._fieldOfViewScale.getValue()*(1+fC),this.constrainFieldOfViewScale());const s=this.getPointOnCenterPlane(t,i,this.toPoint),o=n.getUserOrientation().multVecRot(mC.assign(r).subtract(s));n._positionOffset=_C.assign(n._positionOffset.getValue()).add(o),n._centerOfRotationOffset=xC.assign(n._centerOfRotationOffset.getValue()).add(o)},constrainFieldOfViewScale(){const e=this.getActiveViewpoint();e.getTypeName().match(/^(?:Viewpoint|GeoViewpoint)$/)&&e._fieldOfView.getValue()*e._fieldOfViewScale.getValue()>=Math.PI&&(e._fieldOfViewScale=(Math.PI-.001)/e._fieldOfView.getValue())},dispose(){this.getBrowser().getSurface().off(".PlaneViewer"),gC(document).off(".PlaneViewer"+this.getId())}}),Object.defineProperties(yC,{typeName:{value:"PlaneViewer",enumerable:!0},fieldDefinitions:{value:new Z([new k(d.outputOnly,"isActive",new $n.SFBool)]),enumerable:!0}});const wC=yC;i.add("PlaneViewer","x_ite/Browser/Navigation/PlaneViewer",wC);const bC=wC;function SC(e,t){WE.call(this,e,t)}Object.setPrototypeOf(SC.prototype,WE.prototype),Object.defineProperties(SC,{typeName:{value:"NoneViewer",enumerable:!0},fieldDefinitions:{value:new Z([new k(d.outputOnly,"isActive",new $n.SFBool)]),enumerable:!0}});const TC=SC;i.add("NoneViewer","x_ite/Browser/Navigation/NoneViewer",TC);const vC=TC;n(62);var OC=n(328);const EC=/Mac OS X/i.test(navigator.userAgent)?1/120:.05;function CC(e,t){WE.call(this,e,t),this.button=-1,this.fromVector=new Tt(0,0,0),this.toVector=new Tt(0,0,0),this.touch1=new _t(0,0),this.touch2=new _t(0,0),this.tapStart=0,this.dblTapInterval=.4,this.positionChaser=new xc(e),this.centerOfRotationChaser=new xc(e),this.orientationChaser=new hc(e)}Object.assign(Object.setPrototypeOf(CC.prototype,WE.prototype),{initialize(){WE.prototype.initialize.call(this);const e=this.getBrowser().getSurface();e.on("mousedown.LookAtViewer",this.mousedown.bind(this)),e.on("mouseup.LookAtViewer",this.mouseup.bind(this)),e.on("dblclick.LookAtViewer",this.dblclick.bind(this)),e.on("mousewheel.LookAtViewer",this.mousewheel.bind(this)),e.on("touchstart.LookAtViewer",this.touchstart.bind(this)),e.on("touchend.LookAtViewer",this.touchend.bind(this)),this.positionChaser._duration=.3,this.positionChaser.setup(),this.centerOfRotationChaser._duration=.3,this.centerOfRotationChaser.setup(),this.orientationChaser._duration=.3,this.orientationChaser.setup()},mousedown(e){if(this.button>=0)return;const{x:t,y:i}=this.getBrowser().getPointerFromEvent(e);if(this.isPointerInRectangle(t,i)&&0===e.button)e.preventDefault(),e.stopImmediatePropagation(),this.button=e.button,OC(document).on("mouseup.LookAtViewer"+this.getId(),this.mouseup.bind(this)),OC(document).on("mousemove.LookAtViewer"+this.getId(),this.mousemove.bind(this)),OC(document).on("touchend.LookAtViewer"+this.getId(),this.mouseup.bind(this)),OC(document).on("touchmove.LookAtViewer"+this.getId(),this.touchmove.bind(this)),this.getActiveViewpoint().transitionStop(),this.trackballProjectToSphere(t,i,this.fromVector),this._isActive=!0},mouseup(e){if(e.button===this.button&&(this.button=-1,OC(document).off(".LookAtViewer"+this.getId()),0===e.button))e.preventDefault(),e.stopImmediatePropagation(),this._isActive=!1},dblclick(e){e.preventDefault(),e.stopImmediatePropagation();const{x:t,y:i}=this.getBrowser().getPointerFromEvent(e);this.disconnect(),this.lookAtPoint(t,i,this.getStraightenHorizon())},mousemove(e){this.getBrowser().addBrowserEvent(),this.event=e;const{x:t,y:i}=this.getBrowser().getPointerFromEvent(e);switch(this.button){case 0:{e.preventDefault(),e.stopImmediatePropagation();const n=this.trackballProjectToSphere(t,i,this.toVector);this.addRotation(this.fromVector,n),this.fromVector.assign(n);break}}},mousewheel:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0);return function(i){const{x:n,y:r}=this.getBrowser().getPointerFromEvent(i);if(!this.isPointerInRectangle(n,r))return;i.preventDefault(),i.stopImmediatePropagation();const s=this.getActiveViewpoint();s.transitionStop(),this.getDistanceToCenter(e).multiply(i.zoomFactor||EC),s.getUserOrientation().multVecRot(t.set(0,0,e.magnitude())),i.deltaY>0?this.addMove(t.negate(),Tt.Zero):i.deltaY<0&&this.addMove(t,Tt.Zero)}})(),touchstart(e){const t=e.originalEvent.touches;switch(t.length){case 1:this.touch1.set(t[0].pageX,t[0].pageY);break;case 2:this.touchend(e),e.button=0,e.pageX=(t[0].pageX+t[1].pageX)/2,e.pageY=(t[0].pageY+t[1].pageY)/2,this.mousedown(e),this.touch1.set(t[0].pageX,t[0].pageY),this.touch2.set(t[1].pageX,t[1].pageY);break;case 3:this.touchend(e)}},touchend(e){if(0===this.button)this.mouseup(e);this.getBrowser().getCurrentTime()-this.tapStart<this.dblTapInterval&&(e.button=1,e.pageX=this.touch1.x,e.pageY=this.touch1.y,this.dblclick(e)),this.tapStart=this.getBrowser().getCurrentTime()},touchmove:(()=>{const e=new _t(0,0),t=new _t(0,0);return function(i){const n=i.originalEvent.touches;switch(n.length){case 1:break;case 2:{e.set(n[0].pageX,n[0].pageY).subtract(this.touch1).normalize(),t.set(n[1].pageX,n[1].pageY).subtract(this.touch2).normalize();const r=e.dot(t)>.7,s=e.dot(t)<-.7;if(r)i.button=0,i.pageX=(n[0].pageX+n[1].pageX)/2,i.pageY=(n[0].pageY+n[1].pageY)/2,this.mousemove(i);else if(s){const e=this.touch1.distance(this.touch2);this.touch1.set(n[0].pageX,n[0].pageY),this.touch2.set(n[1].pageX,n[1].pageY);const t=this.touch1.distance(this.touch2)-e;i.deltaY=t,i.zoomFactor=Math.abs(t)/OC(window).width(),i.pageX=(n[0].pageX+n[1].pageX)/2,i.pageY=(n[0].pageY+n[1].pageY)/2,this.mousewheel(i)}this.touch1.set(n[0].pageX,n[0].pageY),this.touch2.set(n[1].pageX,n[1].pageY);break}}}})(),set_positionOffset__(e){this.getActiveViewpoint()._positionOffset=e},set_centerOfRotationOffset__(e){this.getActiveViewpoint()._centerOfRotationOffset=e},set_orientationOffset__(e){this.getActiveViewpoint()._orientationOffset=e},addMove:(()=>{const e=new Tt(0,0,0),t=new Tt(0,0,0);return function(i,n){const r=this.getActiveViewpoint();this.positionChaser._isActive.getValue()&&this.positionChaser._value_changed.hasInterest("set_positionOffset__",this)?(e.assign(this.positionChaser._set_destination.getValue()).add(i),this.positionChaser._set_destination=e):(e.assign(r._positionOffset.getValue()).add(i),this.positionChaser._set_value=r._positionOffset,this.positionChaser._set_destination=e),this.centerOfRotationChaser._isActive.getValue()&&this.centerOfRotationChaser._value_changed.hasInterest("set_centerOfRotationOffset__",this)?(t.assign(this.centerOfRotationChaser._set_destination.getValue()).add(n),this.centerOfRotationChaser._set_destination=t):(t.assign(r._centerOfRotationOffset.getValue()).add(n),this.centerOfRotationChaser._set_value=r._centerOfRotationOffset,this.centerOfRotationChaser._set_destination=t),this.disconnect(),this.positionChaser._value_changed.addInterest("set_positionOffset__",this),this.centerOfRotationChaser._value_changed.addInterest("set_centerOfRotationOffset__",this)}})(),addRotation:(()=>{const e=new ui,t=new ui;return function(i,n){const r=this.getActiveViewpoint();this.orientationChaser._isActive.getValue()&&this.orientationChaser._value_changed.hasInterest("set_orientationOffset__",this)?(e.setFromToVec(n,i).multRight(r.getOrientation()).multRight(this.orientationChaser._set_destination.getValue()),r.straightenHorizon(e),t.assign(r.getOrientation()).inverse().multRight(e),this.orientationChaser._set_destination=t):(e.setFromToVec(n,i).multRight(r.getUserOrientation()),r.straightenHorizon(e),t.assign(r.getOrientation()).inverse().multRight(e),this.orientationChaser._set_value=r._orientationOffset,this.orientationChaser._set_destination=t),this.disconnect(),this.orientationChaser._value_changed.addInterest("set_orientationOffset__",this)}})(),disconnect(){this.orientationChaser._value_changed.removeInterest("set_orientationOffset__",this),this.positionChaser._value_changed.removeInterest("set_positionOffset__",this),this.centerOfRotationChaser._value_changed.removeInterest("set_centerOfRotationOffset__",this)},dispose(){this.getBrowser().getSurface().off(".LookAtViewer"),OC(document).off(".LookAtViewer"+this.getId())}}),Object.defineProperties(CC,{typeName:{value:"LookAtViewer",enumerable:!0},fieldDefinitions:{value:new Z([new k(d.outputOnly,"isActive",new $n.SFBool)]),enumerable:!0}});const NC=CC;i.add("LookAtViewer","x_ite/Browser/Navigation/LookAtViewer",NC);const IC=NC,FC=Symbol(),MC=Symbol(),DC=Symbol();function RC(){this.addChildObjects(d.outputOnly,"activeLayer",new $n.SFNode,d.outputOnly,"activeNavigationInfo",new $n.SFNode,d.outputOnly,"activeViewpoint",new $n.SFNode,d.outputOnly,"availableViewers",new $n.MFString,d.outputOnly,"viewer",new $n.SFString("EXAMINE")),this[FC]=new Set,this[MC]=new vC(this.getPrivateScene())}Object.assign(RC.prototype,{initialize(){this._viewer.addInterest("set_viewer__",this),this.initialized().addInterest("set_world__",this),this.shutdown().addInterest("remove_world__",this),this[DC]=function(e){const t=new Xg(e.getPrivateScene());t.setup();const i=t.getLights().pop();return i.set(t,null,gi.Identity),i.dispose=Function.prototype,i}(this),this[MC].setup()},getHeadlight(){return this[DC]},getActiveLayer(){return this._activeLayer.getValue()},getActiveNavigationInfo(){return this._activeNavigationInfo.getValue()},getActiveViewpoint(){return this._activeViewpoint.getValue()},getCurrentViewer(){return this._viewer.getValue()},getViewer(){return this[MC]},addCollision(e){this[FC].add(e)},removeCollision(e){this[FC].delete(e)},getCollisionCount(){return this[FC].size},remove_world__(){this.getWorld()._activeLayer.removeInterest("set_activeLayer__",this)},set_world__(){this.getWorld()._activeLayer.addInterest("set_activeLayer__",this),this.set_activeLayer__()},set_activeLayer__(){this._activeLayer.getValue()&&(this._activeLayer.getValue().getNavigationInfoStack().removeInterest("set_activeNavigationInfo__",this),this._activeLayer.getValue().getViewpointStack().removeInterest("set_activeViewpoint__",this)),this._activeLayer=this.getWorld().getActiveLayer(),this._activeLayer.getValue()&&(this._activeLayer.getValue().getNavigationInfoStack().addInterest("set_activeNavigationInfo__",this),this._activeLayer.getValue().getViewpointStack().addInterest("set_activeViewpoint__",this)),this.set_activeNavigationInfo__(),this.set_activeViewpoint__()},set_activeNavigationInfo__(){this._activeNavigationInfo.getValue()?._viewer.removeFieldInterest(this._viewer),this._activeLayer.getValue()?(this._activeNavigationInfo=this._activeLayer.getValue().getNavigationInfo(),this._activeNavigationInfo.getValue()._viewer.addFieldInterest(this._viewer),this._viewer=this._activeNavigationInfo.getValue()._viewer):(this._activeNavigationInfo=null,this._viewer="NONE")},set_activeViewpoint__(){this._activeLayer.getValue()?this._activeViewpoint=this._activeLayer.getValue().getViewpoint():this._activeViewpoint=null},set_viewer__(e){const t=this._activeNavigationInfo.getValue();switch(t?this._availableViewers=t._availableViewers:this._availableViewers.length=0,this[MC]?.dispose(),e.getValue()){case"EXAMINE":default:this[MC]=new eC(this.getPrivateScene(),t);break;case"WALK":this[MC]=new hC(this.getPrivateScene(),t);break;case"FLY":this[MC]=new pC(this.getPrivateScene(),t);break;case"PLANE":case"PLANE_create3000.github.io":case"PLANE_create3000.de":this[MC]=new bC(this.getPrivateScene(),t);break;case"NONE":this[MC]=new vC(this.getPrivateScene(),t);break;case"LOOKAT":this[MC]=new IC(this.getPrivateScene(),t)}this[MC].setup()},dispose(){this[MC]?.dispose()}});const PC=RC;i.add("X3DNavigationContext","x_ite/Browser/Navigation/X3DNavigationContext",PC);const AC=PC,VC=Symbol(),LC=Symbol(),BC=Symbol(),UC=Symbol(),XC=Symbol(),jC=Symbol(),kC=Symbol();function zC(e){let t=e.prop("baseURI");return t.startsWith("about:")&&(t=document.baseURI),t}function GC(){this.addChildObjects(d.outputOnly,"loadCount",new $n.SFInt32),this[VC]=zC(this.getElement()),this[LC]=0,this[BC]=0,this[UC]=new Set,this[XC]=!1}Object.assign(GC.prototype,{initialize(){this._loadCount.addInterest(jC,this)},getProviderURL:()=>so.getProviderURL(),getBaseURL(){return this[VC]},setBaseURL(e){const t=zC(this.getElement()),i=new URL(e,t);this[VC]=i.protocol.match(/^(?:data|blob):$/)?t:i.href},getBrowserLoading(){return this[XC]},setBrowserLoading(e){this[XC]=e,e?(this[UC].has(this)||this.resetLoadCount(),this.getShadow().find(".x_ite-private-world-info").remove(),this.getBrowserOption("SplashScreen")&&(this.getContextMenu().hide(),this.getCanvas().hide(),this.getSplashScreen().stop(!0,!0).show())):this.getBrowserOption("SplashScreen")&&(this.getCanvas().show(),this.getSplashScreen().stop(!0,!0).show().fadeOut(2e3))},getLoadingObjects(){return this[UC]},addLoadingObject(e){this[UC].has(e)||(++this[BC],this[UC].add(e),this.setLoadCount(this[UC].size),this.setCursor("DEFAULT"))},removeLoadingObject(e){this[UC].has(e)&&(this[UC].delete(e),this.setLoadCount(this[UC].size),this.setCursor(this.getCursor()))},getDisplayLoadCount(){return[...this[UC]].reduce(((e,t)=>e+!(t.isPrivate?.()??1)),0)},setLoadCount(e){this._loadCount=e},resetLoadCount(){this._loadCount=0,this[LC]=0,this[BC]=0,this[UC].clear();for(const e of this.getPrivateScene().getLoadingObjects())this.addLoadingObject(e)},[jC](){const e=this.getDisplayLoadCount();if(this._loadCount.getValue()||this[XC])var t=Ev(1===(e||1)?"Loading %1 file":"Loading %1 files").replace("%1",e||1);else{t=Ev("Loading done");this.setCursor("DEFAULT")}this[XC]?(this.getSplashScreen().find(".x_ite-private-spinner-text").text(t),this.getSplashScreen().find(".x_ite-private-progressbar div").css("width",100-100*this._loadCount.getValue()/this[BC]+"%")):e!==this[LC]&&(this.getNotification()._string=t),this[LC]=e},getDefaultScene(){return this[kC]=this.createScene(),this[kC].setLive(!0),this.getDefaultScene=function(){return this[kC]},Object.defineProperty(this,"getDefaultScene",{enumerable:!1}),this[kC]}});const HC=GC;i.add("X3DNetworkingContext","x_ite/Browser/Networking/X3DNetworkingContext",HC);const qC=HC,YC=Symbol(),WC=Symbol(),$C=Symbol(),JC=Symbol(),KC=Symbol();function ZC(){this[YC]=new Set,this[WC]=[new Set],this[$C]=[],this[JC]=[!1],this[KC]=new $a}Object.assign(ZC.prototype,{addTransformSensor(e){this[YC].add(e),this.enablePicking()},removeTransformSensor(e){this[YC].delete(e),this.enablePicking()},addPickSensor(e){this[WC][0].add(e),this.enablePicking()},removePickSensor(e){this[WC][0].delete(e),this.enablePicking()},getPickSensors(){return this[WC]},getPickingHierarchy(){return this[$C]},getPickable(){return this[JC]},enablePicking(){this[YC].size||this[WC][0].size?this._sensorEvents.addInterest("picking",this):this._sensorEvents.removeInterest("picking",this)},picking(){this[KC].start(),this.getWorld().traverse(Ma.PICKING);for(const e of this[YC])e.process();for(const e of this[WC][0])e.process();this[KC].stop()},getPickingTime(){return this[KC]}});const QC=ZC;i.add("X3DPickingContext","x_ite/Browser/Picking/X3DPickingContext",QC);const eN=QC;n(62);var tN=n(328);function iN(e){pr.call(this,e),this.cursor="DEFAULT",this.isOver=!1}Object.assign(Object.setPrototypeOf(iN.prototype,pr.prototype),{initialize(){const e=this.getBrowser().getSurface();e.on("mousedown.PointingDevice"+this.getId(),this.mousedown.bind(this)),e.on("mouseup.PointingDevice"+this.getId(),this.mouseup.bind(this)),e.on("dblclick.PointingDevice"+this.getId(),this.dblclick.bind(this)),e.on("mousemove.PointingDevice"+this.getId(),this.mousemove.bind(this)),e.on("mouseout.PointingDevice"+this.getId(),this.onmouseout.bind(this)),e.on("touchstart.PointingDevice"+this.getId(),this.touchstart.bind(this)),e.on("touchend.PointingDevice"+this.getId(),this.touchend.bind(this))},mousewheel(e){},mousedown(e){const t=this.getBrowser(),i=t.getSurface();if(t.getElement().focus(),!(t.getShiftKey()&&t.getControlKey()||0!==e.button)){const{x:n,y:r}=t.getPointerFromEvent(e);i.off("mousemove.PointingDevice"+this.getId()),tN(document).on("mouseup.PointingDevice"+this.getId(),this.mouseup.bind(this)).on("mousemove.PointingDevice"+this.getId(),this.mousemove.bind(this)).on("touchend.PointingDevice"+this.getId(),this.touchend.bind(this)).on("touchmove.PointingDevice"+this.getId(),this.touchmove.bind(this)),t.buttonPressEvent(n,r)&&(e.preventDefault(),e.stopImmediatePropagation(),t.setCursor("HAND"),t.finishedEvents().addInterest("onverifymotion",this,n,r))}},mouseup(e){if(e.preventDefault(),0===e.button){const t=this.getBrowser(),i=t.getSurface(),{x:n,y:r}=t.getPointerFromEvent(e);tN(document).off(".PointingDevice"+this.getId()),i.on("mousemove.PointingDevice"+this.getId(),this.mousemove.bind(this)),t.buttonReleaseEvent(),t.setCursor(this.isOver?"HAND":"DEFAULT"),t.finishedEvents().addInterest("onverifymotion",this,n,r),t.addBrowserEvent(),this.cursor="DEFAULT"}},dblclick(e){this.isOver&&e.stopImmediatePropagation()},mousemove(e){e.preventDefault();const t=this.getBrowser(),{x:i,y:n}=t.getPointerFromEvent(e);this.onmotion(i,n)},touchstart(e){const t=e.originalEvent.touches;switch(t.length){case 1:{e.button=0,e.pageX=t[0].pageX,e.pageY=t[0].pageY,this.mousedown(e);const i=this.getBrowser().getHit();0!==i.id&&0!==i.sensors.length||(this.touchX=e.pageX,this.touchY=e.pageY,this.touchTimeout=setTimeout(this.showContextMenu.bind(this,e),1200));break}case 2:this.touchend(e)}},touchend(e){e.button=0,this.mouseup(e),clearTimeout(this.touchTimeout)},touchmove(e){const t=e.originalEvent.touches;if(1===t.length)e.button=0,e.pageX=t[0].pageX,e.pageY=t[0].pageY,this.mousemove(e),Math.hypot(this.touchX-e.pageX,this.touchY-e.pageY)>7&&clearTimeout(this.touchTimeout)},onmotion(e,t){const i=this.getBrowser();i.motionNotifyEvent(e,t)?this.isOver||(this.isOver=!0,this.cursor=i.getCursor(),i.setCursor("HAND")):this.isOver&&(this.isOver=!1,i.setCursor(this.cursor))},onmouseout(e){this.getBrowser().leaveNotifyEvent()},onverifymotion(e,t){this.getBrowser().finishedEvents().removeInterest("onverifymotion",this),this.onmotion(e,t)},showContextMenu(e){this.getBrowser().getContextMenu().show(e)}}),Object.defineProperties(iN,{typeName:{value:"PointingDevice",enumerable:!0}});const nN=iN;i.add("PointingDevice","x_ite/Browser/PointingDeviceSensor/PointingDevice",nN);const rN=nN;function sN(e){const t=e.getContext();this.context=t,this.array=new Float32Array(4),this.frameBuffer=t.createFramebuffer(),this.colorBuffers=[],this.frameBuffers=[];for(let e=0;e<3;++e)this.colorBuffers[e]=t.createRenderbuffer(),this.frameBuffers[e]=t.createFramebuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.colorBuffers[e]),t.renderbufferStorage(t.RENDERBUFFER,t.RGBA32F,1,1),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,this.colorBuffers[e]),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffers[e]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,this.colorBuffers[e]);if(t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1,t.COLOR_ATTACHMENT2]),t.HAS_FEATURE_DEPTH_TEXTURE){this.depthTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.depthTexture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST);const e=t.getVersion()>=2?t.DEPTH_COMPONENT24:t.DEPTH_COMPONENT;t.texImage2D(t.TEXTURE_2D,0,e,1,1,0,t.DEPTH_COMPONENT,t.UNSIGNED_INT,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,this.depthTexture,0)}else this.depthBuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.depthBuffer),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,1,1),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthBuffer);if(!(t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE))throw new Error("Couldn't create frame buffer.")}Object.assign(sN.prototype,{bind(){const e=this.context;e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)},getHit(e){const{context:t,array:i}=this;t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffers[0]),t.readPixels(0,0,1,1,t.RGBA,t.FLOAT,i),e.id=i[3],e.point.set(i[0],i[1],i[2]),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffers[1]),t.readPixels(0,0,1,1,t.RGBA,t.FLOAT,i),e.normal.set(i[0],i[1],i[2]),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffers[2]),t.readPixels(0,0,1,1,t.RGBA,t.FLOAT,i),e.texCoord.set(i[0],i[1],i[2],i[3]),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer)},dispose(){const e=this.context;e.deleteFramebuffer(this.frameBuffer);for(const t of this.frameBuffers)e.deleteFramebuffer(t);for(const t of this.colorBuffers)e.deleteRenderbuffer(t);e.deleteRenderbuffer(this.depthBuffer),e.deleteTexture(this.depthTexture)}});const oN=sN;i.add("PointingBuffer","x_ite/Rendering/PointingBuffer",oN);const aN=oN,lN=Symbol(),uN=Symbol(),hN=Symbol(),dN=Symbol(),cN=Symbol(),pN=Symbol(),gN=Symbol(),fN=Symbol(),mN=Symbol(),_N=Symbol(),xN=Symbol(),yN=Symbol(),wN=Symbol();function bN(){this[lN]=new rN(this.getPrivateScene()),this[uN]=new Set,this[dN]=new _t(0,0),this[pN]=[],this[gN]=[],this[fN]=null,this[mN]=new $a,this[_N]=new aN(this),this[xN]=new Map,this[wN]=[],this[cN]={id:0,pointer:this[dN],hitRay:null,sensors:[],modelViewMatrix:new gi,point:new Tt(0,0,0),normal:new Tt(0,0,0),texCoord:new Gt(0,0,0,0),layerNode:null,shapeNode:null,copy(){return{id:this.id,pointer:this.pointer.copy(),hitRay:this.hitRay.copy(),sensors:this.sensors.slice(),modelViewMatrix:this.modelViewMatrix.copy(),point:this.point.copy(),normal:this.normal.copy(),texCoord:this.texCoord.copy(),layerNode:this.layerNode,shapeNode:this.shapeNode,copy:this.copy}}}}Object.assign(bN.prototype,{initialize(){this.setCursor("DEFAULT"),this[lN].setup()},getPointingTime(){return this[mN]},addPointingDeviceSensor(e){this[uN].add(e)},removePointingDeviceSensor(e){this[uN].delete(e)},setCursor(e){const t=this.getSurface();switch(this[hN]=e,e){case"HAND":t.css("cursor","pointer");break;case"MOVE":t.css("cursor","move");break;case"CROSSHAIR":t.css("cursor","crosshair");break;default:this.getDisplayLoadCount()?t.css("cursor","wait"):this[lN]?.isOver?t.css("cursor","pointer"):t.css("cursor","default")}},getCursor(){return this[hN]},getPointer(){return this[dN]},getPointerFromEvent({pageX:e,pageY:t}){const i=this.getSurface().offset(),n=this.getSurface()[0].getBoundingClientRect(),r=this.getViewport(),s=(e-i.left)/n.width*r[2],o=(1-(t-i.top)/n.height)*r[3];return new _t(s,o)},isPointerInRectangle(e,t=this[dN]){return t.x>=e.x&&t.x<=e.x+e.z&&t.y>=e.y&&t.y<=e.y+e.w},getPointingLayer(){return this[fN]},getHit(){return this[cN]},addPointingShape(e){const t=++this[yN];return this[wN][t]=e,t},buttonPressEvent(e,t){if(!this[uN].size)return!1;if(!this.touch(e,t))return!1;const i=this[cN];this[gN]=i.sensors,this[fN]=i.layerNode;for(const e of this[gN])e.set_active__(!0,i);return!!i.sensors.length},buttonReleaseEvent(){if(this[uN].size){for(const e of this[gN])e.set_active__(!1,null);this[gN]=Array.prototype,this[fN]=null}},motionNotifyEvent(e,t){return!!this[uN].size&&(this.touch(e,t),this.motion(),!!this[cN].sensors.length)},leaveNotifyEvent(){},touch(e,t){if(this[mN].start(),this.getViewer()._isActive.getValue())return this[mN].reset(),!1;const i=this[cN];if(this[yN]=0,this[dN].set(e,t),this[_N].bind(),this.getWorld().traverse(Ma.POINTER),this[_N].getHit(i),Number.isInteger(i.id)&&i.id>0&&i.id<=this[yN]){const e=this[wN][i.id],t=e.shapeNode,n=t.getAppearance(),r=t.getGeometryContext();i.hitRay=e.renderObject.getHitRay(),i.sensors=e.sensors.slice(),i.layerNode=e.renderObject,i.shapeNode=t,i.modelViewMatrix.assign(e.modelViewMatrix),r.hasNormals?i.modelViewMatrix.submatrix.inverse().transpose().multVecMatrix(i.normal).normalize():i.normal.assign(Tt.zAxis),n.getTextureTransform().transformPoint(i.texCoord)}else i.id=0,i.hitRay=this[fN]?this[fN].getHitRay():null,i.sensors=Array.prototype,i.layerNode=this[fN],i.shapeNode=null,i.modelViewMatrix.assign(gi.Identity);return this.addBrowserEvent(),this[mN].stop(),!!i.id},motion(){const e=this[cN];if(e.id)var t=this[pN].filter((t=>!e.sensors.find((e=>t.node===e.node))));else t=this[pN];for(const i of t)i.set_over__(!1,e);if(e.id){this[pN]=e.sensors;for(const t of this[pN])t.set_over__(!0,e)}else this[pN]=Array.prototype;for(const t of this[gN])t.set_motion__(e)},getPointingShader(e,t,i){const n=t.getGeometryContext();let r="";if(r+=e,r+=".",r+=t.getShapeKey(),r+=n.geometryType,r+=".",r+=i?.getHumanoidKey()??"",r+=".",n.geometryType>=2)r+="0.0.0";else{const e=t.getAppearance();r+=e.getStyleProperties(n.geometryType)?1:0,r+=".",r+=e.getTextureBits().toString(16),r+=".",r+=e.getMaterial().getTextureBits().toString(16)}return this[xN].get(r)||this.createPointingShader(r,e,t,i)},createPointingShader(e,t,i,n){const r=i.getAppearance(),s=i.getGeometryContext(),o=[];t&&(o.push("X3D_CLIP_PLANES"),o.push("X3D_NUM_CLIP_PLANES "+t)),i.getShapeKey()>0&&o.push("X3D_PARTICLE_SYSTEM"),o.push(`X3D_GEOMETRY_${s.geometryType}D`),r.getStyleProperties(s.geometryType)&&o.push("X3D_STYLE_PROPERTIES"),n&&(o.push("X3D_SKINNING"),o.push("X3D_NUM_JOINT_SETS "+n.getNumJoints()/4),o.push(`X3D_NUM_DISPLACEMENTS ${n.getNumDisplacements()}`));const a=this.createShader("Pointing","Pointing","Pointing",o);return this[xN].set(e,a),a}});const SN=bN;i.add("X3DPointingDeviceSensorContext","x_ite/Browser/PointingDeviceSensor/X3DPointingDeviceSensorContext",SN);const TN=SN;function vN(e,t,i,n,r){const s=e.getContext();if(1===s.getVersion()||0===t||0===i)return new ON(e,t,i,n);this.browser=e,this.context=s,this.width=t,this.height=i,this.samples=n,this.oit=r,this.frameBuffer=s.createFramebuffer(),s.bindFramebuffer(s.FRAMEBUFFER,this.frameBuffer),this.colorBuffer=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,this.colorBuffer),n?s.renderbufferStorageMultisample(s.RENDERBUFFER,n,s.RGBA8,t,i):s.renderbufferStorage(s.RENDERBUFFER,s.RGBA8,t,i),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.RENDERBUFFER,this.colorBuffer),this.depthBuffer=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,this.depthBuffer),n?s.renderbufferStorageMultisample(s.RENDERBUFFER,n,s.DEPTH_COMPONENT24,t,i):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_COMPONENT24,t,i),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,this.depthBuffer);if(!(s.checkFramebufferStatus(s.FRAMEBUFFER)===s.FRAMEBUFFER_COMPLETE))throw new Error("Couldn't create frame buffer.");if(!r)return;this.oitFrameBuffer=s.createFramebuffer(),s.bindFramebuffer(s.FRAMEBUFFER,this.oitFrameBuffer),s.drawBuffers([s.COLOR_ATTACHMENT0,s.COLOR_ATTACHMENT1]),n?(this.accumRevealageBuffer=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,this.accumRevealageBuffer),s.renderbufferStorageMultisample(s.RENDERBUFFER,n,s.RGBA32F,t,i),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.RENDERBUFFER,this.accumRevealageBuffer),this.alphaBuffer=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,this.alphaBuffer),s.renderbufferStorageMultisample(s.RENDERBUFFER,n,s.RGBA32F,t,i),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT1,s.RENDERBUFFER,this.alphaBuffer),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,this.depthBuffer),this.accumRevealageTextureBuffer=s.createFramebuffer(),s.bindFramebuffer(s.FRAMEBUFFER,this.accumRevealageTextureBuffer),this.accumRevealageTexture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.accumRevealageTexture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texImage2D(s.TEXTURE_2D,0,s.RGBA32F,t,i,0,s.RGBA,s.FLOAT,null),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,this.accumRevealageTexture,0),this.alphaTextureBuffer=s.createFramebuffer(),s.bindFramebuffer(s.FRAMEBUFFER,this.alphaTextureBuffer),this.alphaTexture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.alphaTexture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texImage2D(s.TEXTURE_2D,0,s.RGBA32F,t,i,0,s.RGBA,s.FLOAT,null),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,this.alphaTexture,0)):(this.accumRevealageTexture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.accumRevealageTexture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texImage2D(s.TEXTURE_2D,0,s.RGBA32F,t,i,0,s.RGBA,s.FLOAT,null),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,this.accumRevealageTexture,0),this.alphaTexture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.alphaTexture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texImage2D(s.TEXTURE_2D,0,s.RGBA32F,t,i,0,s.RGBA,s.FLOAT,null),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT1,s.TEXTURE_2D,this.alphaTexture,0),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,this.depthBuffer));if(!(s.checkFramebufferStatus(s.FRAMEBUFFER)===s.FRAMEBUFFER_COMPLETE))throw new Error("Couldn't create frame buffer.");this.shaderNode=e.getOITComposeShader(),this.program=this.shaderNode.getProgram(),s.useProgram(this.program);const o=s.getUniformLocation(this.program,"x3d_AccumRevealageTexture"),a=s.getUniformLocation(this.program,"x3d_AlphaTexture");s.uniform1i(o,0),s.uniform1i(a,1)}function ON(e,t,i,n){const r=e.getContext();this.browser=e,this.context=r,this.width=t,this.height=i,this.samples=n}Object.assign(vN.prototype,{getWidth(){return this.width},getHeight(){return this.height},getSamples(){return this.samples},getOIT(){return this.oit},bind(){const{context:e,frameBuffer:t}=this;e.bindFramebuffer(e.FRAMEBUFFER,t)},clear(){const{context:e,frameBuffer:t}=this;e.bindFramebuffer(e.FRAMEBUFFER,t),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)},bindTransparency(){const{context:e,oitFrameBuffer:t}=this;e.bindFramebuffer(e.FRAMEBUFFER,t),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.blendFuncSeparate(e.ONE,e.ONE,e.ZERO,e.ONE_MINUS_SRC_ALPHA)},compose(){const{context:e,browser:t,width:i,height:n,samples:r,program:s}=this;e.viewport(0,0,i,n),e.scissor(0,0,i,n),r&&(e.bindFramebuffer(e.READ_FRAMEBUFFER,this.oitFrameBuffer),e.readBuffer(e.COLOR_ATTACHMENT0),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,this.accumRevealageTextureBuffer),e.blitFramebuffer(0,0,i,n,0,0,i,n,e.COLOR_BUFFER_BIT,e.LINEAR),e.readBuffer(e.COLOR_ATTACHMENT1),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,this.alphaTextureBuffer),e.blitFramebuffer(0,0,i,n,0,0,i,n,e.COLOR_BUFFER_BIT,e.LINEAR)),e.useProgram(s),e.activeTexture(e.TEXTURE0+0),e.bindTexture(e.TEXTURE_2D,this.accumRevealageTexture),e.activeTexture(e.TEXTURE0+1),e.bindTexture(e.TEXTURE_2D,this.alphaTexture),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),e.enable(e.CULL_FACE),e.frontFace(e.CCW),e.bindVertexArray(t.getFullscreenVertexArrayObject()),e.drawArrays(e.TRIANGLES,0,6),e.disable(e.BLEND),e.enable(e.DEPTH_TEST)},blit(){const{context:e,width:t,height:i,samples:n}=this;e.viewport(0,0,t,i),e.scissor(0,0,t,i),e.bindFramebuffer(e.READ_FRAMEBUFFER,this.frameBuffer),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.blitFramebuffer(0,0,t,i,0,0,t,i,e.COLOR_BUFFER_BIT,n?e.LINEAR:e.NEAREST)},dispose(){const e=this.context;e.deleteFramebuffer(this.frameBuffer),e.deleteRenderbuffer(this.colorBuffer),e.deleteRenderbuffer(this.depthBuffer),e.deleteFramebuffer(this.oitFrameBuffer),e.deleteFramebuffer(this.accumRevealageTextureBuffer),e.deleteFramebuffer(this.alphaTextureBuffer),e.deleteRenderbuffer(this.accumRevealageBuffer),e.deleteRenderbuffer(this.alphaBuffer),e.deleteTexture(this.accumRevealageTexture),e.deleteTexture(this.alphaTexture)}}),Object.assign(ON.prototype,{getWidth(){return this.width},getHeight(){return this.height},getSamples(){return this.samples},getOIT:()=>!1,bind(){const{context:e}=this;e.bindFramebuffer(e.FRAMEBUFFER,null)},clear(){const{context:e}=this;e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.blendFuncSeparate(e.ONE,e.ONE,e.ZERO,e.ONE_MINUS_SRC_ALPHA)},blit:Function.prototype,compose:Function.prototype,dispose:Function.prototype});const EN=vN;i.add("MultiSampleFrameBuffer","x_ite/Rendering/MultiSampleFrameBuffer",EN);const CN=EN;var NN=n(328);const IN=Symbol(),FN=Symbol(),MN=Symbol(),DN=Symbol(),RN=Symbol(),PN=Symbol(),AN=Symbol(),VN=Symbol();function LN(){this[IN]=new Gt(0,0,300,150),this[FN]=new CN(this,300,150,4),this[DN]=[],this[VN]=new Map}Object.assign(LN.prototype,{initialize(){const e=this.getContext();e.enable(e.SCISSOR_TEST),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.clearDepth(1),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),NN(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",this.onfullscreen.bind(this)),this[MN]=new ResizeObserver(this.reshape.bind(this)),this[MN].observe(this.getSurface()[0]),this.reshape()},getRenderer(){const e=this.getContext();if(!navigator.userAgent.match(/Firefox/)){const t=e.getExtension("WEBGL_debug_renderer_info");if(t)return e.getParameter(t.UNMASKED_RENDERER_WEBGL)}return e.getParameter(e.RENDERER)},getVendor(){const e=this.getContext();if(!navigator.userAgent.match(/Firefox/)){const t=e.getExtension("WEBGL_debug_renderer_info");if(t)return e.getParameter(t.UNMASKED_VENDOR_WEBGL)}return e.getParameter(e.VENDOR)},getWebGLVersion(){const e=this.getContext();return e.getParameter(e.VERSION)},getMaxSamples(){const e=this.getContext();return e.getVersion()>1?e.getParameter(e.MAX_SAMPLES):0},getMaxClipPlanes:()=>6,getDepthSize(){const e=this.getContext();return e.getParameter(e.DEPTH_BITS)},getColorDepth(){const e=this.getContext();return e.getParameter(e.RED_BITS)+e.getParameter(e.BLUE_BITS)+e.getParameter(e.GREEN_BITS)+e.getParameter(e.ALPHA_BITS)},getViewport(){return this[IN]},getLocalObjects(){return this[DN]},getFrameBuffer(){return this[FN]},getFullscreenVertexArrayObject(){const e=this.getContext();return this[RN]=e.createVertexArray(),this[PN]=e.createBuffer(),e.bindVertexArray(this[RN]),e.bindBuffer(e.ARRAY_BUFFER,this[PN]),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,1,-1,-1,1,-1,-1,1,1,-1,1,1]),e.STATIC_DRAW),e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(null),this.getFullscreenVertexArrayObject=function(){return this[RN]},Object.defineProperty(this,"getFullscreenVertexArrayObject",{enumerable:!1}),this[RN]},getOITComposeShader(){return this[AN]?this[AN]:this[AN]=this.createShader("OITCompose","FullScreen","OITCompose")},getDepthShader(e,t,i){const n=t.getGeometryContext();let r="";if(r+=e,r+=".",r+=t.getShapeKey(),r+=n.geometryType,r+=".",r+=i?.getHumanoidKey()??"",r+=".",n.geometryType>=2)r+="0.0.0";else{const e=t.getAppearance();r+=e.getStyleProperties(n.geometryType)?1:0,r+=".",r+=e.getTextureBits().toString(16),r+=".",r+=e.getMaterial().getTextureBits().toString(16)}return this[VN].get(r)||this.createDepthShader(r,e,t,i)},createDepthShader(e,t,i,n){const r=i.getAppearance(),s=i.getGeometryContext(),o=[];t&&(o.push("X3D_CLIP_PLANES"),o.push("X3D_NUM_CLIP_PLANES "+t)),i.getShapeKey()>0&&o.push("X3D_PARTICLE_SYSTEM"),o.push(`X3D_GEOMETRY_${s.geometryType}D`),r.getStyleProperties(s.geometryType)&&o.push("X3D_STYLE_PROPERTIES"),n&&(o.push("X3D_SKINNING"),o.push("X3D_NUM_JOINT_SETS "+n.getNumJoints()/4),o.push(`X3D_NUM_DISPLACEMENTS ${n.getNumDisplacements()}`));const a=this.createShader("Depth","Depth","Depth",o);return this[VN].set(e,a),a},reshape(){const e=this.getCanvas(),t=this.getRenderingProperty("ContentScale"),i=this.getRenderingProperty("Multisampling"),n=this.getBrowserOption("OrderIndependentTransparency"),r=e.width()*t,s=e.height()*t,o=e[0];o.width=r,o.height=s,this[IN][2]=r,this[IN][3]=s,r===this[FN].getWidth()&&s===this[FN].getHeight()&&i===this[FN].getSamples()&&n===this[FN].getOIT()||(this[FN].dispose(),this[FN]=new CN(this,r,s,i,n)),this.addBrowserEvent()},onfullscreen(){const e=this.getElement();e.fullScreen()?e.addClass("x_ite-fullscreen"):e.removeClass("x_ite-fullscreen")}});const BN=LN;i.add("X3DRenderingContext","x_ite/Browser/Rendering/X3DRenderingContext",BN);const UN=BN,XN=Symbol();function jN(){this[XN]=[this]}Object.assign(jN.prototype,{isExternal(){return 1===this[XN].length},getScriptStack(){return this[XN]}});const kN=jN;i.add("X3DScriptingContext","x_ite/Browser/Scripting/X3DScriptingContext",kN);const zN=kN,GN=Symbol(),HN=Symbol(),qN=Symbol();function YN(){this[GN]=!1,this[HN]=new Map,this[qN]=new Map}Object.assign(YN.prototype,{initialize(){this.setShading(this.getBrowserOptions().getShading())},getShadingLanguageVersion(){const e=this.getContext();return e.getParameter(e.SHADING_LANGUAGE_VERSION)},getMaxVertexUniformVectors(){const e=this.getContext();return e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS)},getMaxFragmentUniformVectors(){const e=this.getContext();return e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS)},getMaxVertexAttribs(){const e=this.getContext();return e.getParameter(e.MAX_VERTEX_ATTRIBS)},getMaxVaryingVectors(){const e=this.getContext();return e.getParameter(e.MAX_VARYING_VECTORS)},getWireframe(){return this[GN]},getPrimitiveMode(e){return this[HN].get(e)},getShaders(){return this[qN]},setShading(e){const t=this.getContext();switch(e){case Ol.POINT:this[GN]=!1,this[HN].set(t.POINTS,t.POINTS),this[HN].set(t.LINES,t.POINTS),this[HN].set(t.TRIANGLES,t.POINTS);break;case Ol.WIREFRAME:this[GN]=!0,this[HN].set(t.POINTS,t.POINTS),this[HN].set(t.LINES,t.LINES),this[HN].set(t.TRIANGLES,t.LINE_LOOP);break;default:this[GN]=!1,this[HN].set(t.POINTS,t.POINTS),this[HN].set(t.LINES,t.LINES),this[HN].set(t.TRIANGLES,t.TRIANGLES)}},createShader(e,t,i=t,n=[],r=[],s=[]){this.getBrowserOption("Debug")&&console.info(`Initializing ${e}Shader`);const o=this.getContext().getVersion(),a=new Kw(this.getPrivateScene());a._url.push(encodeURI(t.startsWith("data:")?t:"data:x-shader/x-vertex,"+kw.vertex[o][t])),a.setPrivate(!0),a.setName(`${e}VertexShader`),a.setOptions(n),a.setup();const l=new Kw(this.getPrivateScene());l._type="FRAGMENT",l._url.push(encodeURI(i.startsWith("data:")?i:"data:x-shader/x-fragment,"+kw.fragment[o][i])),l.setPrivate(!0),l.setName(`${e}FragmentShader`),l.setOptions(n),l.setup();const u=new L_(this.getPrivateScene());return u._language="GLSL",u._parts.push(a),u._parts.push(l),u.setPrivate(!0),u.setName(`${e}Shader`),u.setUniformNames(r),u.setTransformFeedbackVaryings(s),u.setup(),u}});const WN=YN;i.add("X3DShadersContext","x_ite/Browser/Shaders/X3DShadersContext",WN);const $N=WN,JN=Symbol(),KN=Symbol(),ZN=Symbol(),QN=Symbol(),eI=Symbol(),tI=Symbol(),iI=Symbol(),nI=Symbol(),rI=Symbol();function sI(){this[KN]=[]}Object.assign(sI.prototype,{getDefaultAppearance(){return this[ZN]=new db(this.getPrivateScene()),this[ZN].setPrivate(!0),this[ZN].setup(),this.getDefaultAppearance=function(){return this[ZN]},Object.defineProperty(this,"getDefaultAppearance",{enumerable:!1}),this[ZN]},getLineStippleScale(){return 1/(32*this.getPixelsPerPoint())},getDefaultPointProperties(){return this[QN]=new Rb(this.getPrivateScene()),this[QN].setPrivate(!0),this[QN].setup(),this.getDefaultPointProperties=function(){return this[QN]},Object.defineProperty(this,"getDefaultPointProperties",{enumerable:!1}),this[QN]},getDefaultLineProperties(){return this[eI]=new _b(this.getPrivateScene()),this[eI]._applied=!1,this[eI].setPrivate(!0),this[eI].setup(),this.getDefaultLineProperties=function(){return this[eI]},Object.defineProperty(this,"getDefaultLineProperties",{enumerable:!1}),this[eI]},getDefaultMaterial(){return this[tI]=new Hb(this.getPrivateScene()),this[tI].setPrivate(!0),this[tI].setup(),this.getDefaultMaterial=function(){return this[tI]},Object.defineProperty(this,"getDefaultMaterial",{enumerable:!1}),this[tI]},getLinetypeTexture(){return this[JN]=new ru(this.getPrivateScene()),this[JN]._url[0]=so.getLinetypeURL(),this[JN]._textureProperties=this.getLineFillTextureProperties(),this[JN].setPrivate(!0),this[JN].setup(),this.getLinetypeTexture=function(){return this[JN]},Object.defineProperty(this,"getLinetypeTexture",{enumerable:!1}),this[JN]},getHatchStyleTexture(e){let t=this[KN][e];return t||(t=this[KN][e]=new ru(this.getPrivateScene()),t._url[0]=so.getHatchingURL(e),t._textureProperties=this.getLineFillTextureProperties(),t.setPrivate(!0),t.setup(),t)},getLineFillTextureProperties(){return this[iI]=new sv(this.getPrivateScene()),this[iI]._minificationFilter="NEAREST_PIXEL",this[iI]._magnificationFilter="NEAREST_PIXEL",this[iI]._textureCompression="DEFAULT",this[iI].setPrivate(!0),this[iI].setup(),this.getLineFillTextureProperties=function(){return this[iI]},Object.defineProperty(this,"getLineFillTextureProperties",{enumerable:!1}),this[iI]},getLineTransformShader(){return this[nI]=this.createShader("LineTransform","LineTransform","LineTransform",[],["viewport","modelViewProjectionMatrix","invModelViewProjectionMatrix","scale"],["coordIndex0","lineStipple0","fogDepth0","color0","normal0","vertex0","coordIndex1","lineStipple1","fogDepth1","color1","normal1","vertex1","coordIndex2","lineStipple2","fogDepth2","color2","normal2","vertex2"]),this.getLineTransformShader=function(){return this[nI]},Object.defineProperty(this,"getLineTransformShader",{enumerable:!1}),this[nI]},getLineTransformFeedback(){const e=this.getContext();return this[rI]=e.createTransformFeedback(),this.getLineTransformFeedback=function(){return this[rI]},Object.defineProperty(this,"getLineTransformFeedback",{enumerable:!1}),this[rI]}});const oI=sI;i.add("X3DShapeContext","x_ite/Browser/Shape/X3DShapeContext",oI);const aI=oI,lI=Symbol(),uI=Symbol();function hI(){}Object.assign(hI.prototype,{getAudioContext(){return this[lI]=new AudioContext,this.startAudioElement(this[lI],"resume"),this.getAudioContext=function(){return this[lI]},Object.defineProperty(this,"getAudioContext",{enumerable:!1}),this[lI]},getDefaultPeriodicWave(){return this[uI]=new oT(this.getPrivateScene()),this[uI].setPrivate(!0),this[uI].setup(),this.getDefaultPeriodicWave=function(){return this[uI]},Object.defineProperty(this,"getDefaultPeriodicWave",{enumerable:!1}),this[uI]},startAudioElement(e,t="play"){e[t]().catch((()=>{const i=`X3DSoundContext-${I.getId(e)}`,n=["blur","click","contextmenu","dblclick","focus","keydown","keyup","mousedown","mouseup","pointerup","touchend"].map((e=>`${e}.${i}`));this.getElement().on(n.join(" "),(n=>{e[t]().then((()=>this.getElement().off(`.${i}`))).catch(Function.prototype)}))}))}});const dI=hI;i.add("X3DSoundContext","x_ite/Browser/Sound/X3DSoundContext",dI);const cI=dI;var pI=n(328);const gI=class{constructor(e,t,i){this.gl=e,this.libktx=null,this.initialized=this.init(e,t,i)}async init(e,t,i){this.libktx=await t({preinitializedWebGLContext:e},i),this.libktx.GL.makeContextCurrent(this.libktx.GL.createContext(null,{majorVersion:e.getVersion()}))}transcode(e){if(!e.needsTranscoding)return;const{gl:t,libktx:i}=this,n=!!t.getExtension("WEBGL_compressed_texture_astc"),r=!!t.getExtension("WEBGL_compressed_texture_etc1"),s=!!t.getExtension("WEBGL_compressed_texture_s3tc"),o=!!t.getExtension("EXT_texture_compression_bptc"),a=!!t.getExtension("WEBGL_compressed_texture_pvrtc")||!!t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");if(n)var l=i.TranscodeTarget.ASTC_4x4_RGBA;else if(o)l=i.TranscodeTarget.BC7_RGBA;else if(s)l=i.TranscodeTarget.BC1_OR_3;else if(a)l=i.TranscodeTarget.PVRTC1_4_RGBA;else if(r)l=i.TranscodeTarget.ETC;else l=i.TranscodeTarget.RGBA8888;e.transcodeBasis(l,0)!==i.ErrorCode.SUCCESS&&console.warn("Texture transcode failed. See console for details.")}async loadKTXFromURL(e,t=!0){const i=await fetch(e,{cache:t?"default":"reload"});if(!i.ok)throw new Error("Couldn't fetch KTX image.");return this.loadKTXFromBuffer(await i.arrayBuffer())}async loadKTXFromBuffer(e){await this.initialized;const t=new Uint8Array(pI.ungzip(e)),i=new this.libktx.ktxTexture(t);this.transcode(i);const n=i.glUpload(),r=n.texture;if(!r)throw new Error("Could not load KTX data");return r.baseWidth=i.baseWidth,r.baseHeight=i.baseHeight,r.baseDepth=i.baseDepth??1,r.numComponents=i.numComponents,r.target=n.target,i.delete(),r}};i.add("KTXDecoder","x_ite/Browser/Texturing/KTXDecoder",gI);const fI=gI,mI=Symbol(),_I=Symbol(),xI=Symbol(),yI=Symbol(),wI=Symbol(),bI=Symbol(),SI=Symbol(),TI=Symbol(),vI=Symbol(),OI=Symbol(),EI=Symbol(),CI=Symbol(),NI=Symbol(),II=Symbol(),FI=Symbol();function MI(){const e=this.getContext(),t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this[mI]=t>8?4:2}Object.assign(MI.prototype,{initialize(){const e=this.getContext();e.pixelStorei(e.UNPACK_ALIGNMENT,1);const t=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);this[_I]=[...Array(t).keys()].reverse(),this[xI]=[this[_I].pop()],this[yI]=[this[_I].pop()],this[wI]=[this[_I].pop()];const i=new Uint8Array([255,255,255,255]);this[vI]=e.createTexture(),e.activeTexture(e.TEXTURE0+this[xI][0]),e.bindTexture(e.TEXTURE_2D,this[vI]),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,i),e.getVersion()>=2&&(this[OI]=e.createTexture(),e.activeTexture(e.TEXTURE0+this[yI][0]),e.bindTexture(e.TEXTURE_3D,this[OI]),e.texImage3D(e.TEXTURE_3D,0,e.RGBA,1,1,1,0,e.RGBA,e.UNSIGNED_BYTE,i)),this[EI]=e.createTexture(),e.activeTexture(e.TEXTURE0+this[wI][0]),e.bindTexture(e.TEXTURE_CUBE_MAP,this[EI]),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_Z,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,i),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,i),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_X,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,i),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,i),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_Y,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,i),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,i),this.resetTextureUnits(),this.setTextureQuality(this.getBrowserOptions().getTextureQuality())},getMaxTextures(){return this[mI]},getMaxTextureTransforms:()=>4,getMaxTexCoords:()=>4,getMinTextureSize:()=>16,getMaxTextureSize(){const e=this.getContext();return e.getParameter(e.MAX_TEXTURE_SIZE)},getMaxCombinedTextureUnits(){const e=this.getContext();return e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS)},popTexture2DUnit(){return this[bI]>0?(--this[bI],this[xI].pop()):this[_I].pop()},pushTexture2DUnit(e){void 0!==e&&(++this[bI],this[xI].push(e))},getTexture2DUnit(){if(this[bI]>0)return this[xI][--this[bI]];const e=this[_I].pop();return void 0!==e&&this[xI].push(e),e},getTexture3DUnit(){if(this[SI]>0)return this[yI][--this[SI]];const e=this[_I].pop();return void 0!==e&&this[yI].push(e),e},popTextureCubeUnit(){return this[TI]>0?(--this[TI],this[wI].pop()):this[_I].pop()},pushTextureCubeUnit(e){void 0!==e&&(++this[TI],this[wI].push(e))},getTextureCubeUnit(){if(this[TI]>0)return this[wI][--this[TI]];const e=this[_I].pop();return void 0!==e&&this[wI].push(e),e},getTextureUnit(e){switch(e){case 1:case 2:return this.getTexture2DUnit();case 3:return this.getTexture3DUnit();case 4:return this.getTextureCubeUnit()}},resetTextureUnits(){this[bI]=this[xI].length,this[SI]=this[yI].length,this[TI]=this[wI].length},getDefaultTexture2DUnit(){return this[xI][0]},getDefaultTexture3DUnit(){return this[yI][0]},getDefaultTextureCubeUnit(){return this[wI][0]},getTextureMemory:()=>NaN,getDefaultTexture2D(){return this[vI]},getDefaultTexture3D(){return this[OI]},getDefaultTextureCube(){return this[EI]},getDefaultTextureProperties(){return this[CI]=new sv(this.getPrivateScene()),this[CI]._generateMipMaps=!0,this[CI]._minificationFilter="NICEST",this[CI]._magnificationFilter="NICEST",this[CI].setup(),this.getDefaultTextureProperties=function(){return this[CI]},Object.defineProperty(this,"getDefaultTextureProperties",{enumerable:!1}),this[CI]},getDefaultTextureTransform(){return this[NI]=new dv(this.getPrivateScene()),this[NI].setPrivate(!0),this[NI].setup(),this.getDefaultTextureTransform=function(){return this[NI]},Object.defineProperty(this,"getDefaultTextureTransform",{enumerable:!1}),this[NI]},getDefaultTextureCoordinate(){return this[II]=new QT(this.getPrivateScene()),this[II].setPrivate(!0),this[II].setup(),this.getDefaultTextureCoordinate=function(){return this[II]},Object.defineProperty(this,"getDefaultTextureCoordinate",{enumerable:!1}),this[II]},setTextureQuality(e){const t=this.getDefaultTextureProperties();switch(e){case Lv.LOW:t._magnificationFilter="AVG_PIXEL",t._minificationFilter="AVG_PIXEL",t._textureCompression="FASTEST",t._generateMipMaps=!0;break;case Lv.MEDIUM:t._magnificationFilter="NICEST",t._minificationFilter="NEAREST_PIXEL_AVG_MIPMAP",t._textureCompression="NICEST",t._generateMipMaps=!0;break;case Lv.HIGH:t._magnificationFilter="NICEST",t._minificationFilter="NICEST",t._textureCompression="NICEST",t._generateMipMaps=!0}},async getKTXDecoder(){return new fI(this.getContext(),await this.getLibKTX(),so.getLibraryURL(""))},async getLibKTX(){if(this[FI])return this[FI];const e=await fetch(so.getLibraryURL("libktx.js")),t=await e.text(),i=await new Function(t)();return this[FI]=i}});const DI=MI;i.add("X3DTexturingContext","x_ite/Browser/Texturing/X3DTexturingContext",DI);const RI=DI,PI=Symbol(),AI=Symbol(),VI=Symbol(),LI=Symbol();function BI(){this[PI]=Date.now()/1e3,this[AI]=60,this[VI]=new Tt(0,0,0),this[LI]=0}Object.assign(BI.prototype,{getCurrentTime(){return this[PI]},getCurrentFrameRate(){return this[AI]},getCurrentSpeed(){return this[LI]},advanceTime:(()=>{const e=new Tt(0,0,0);return function(){const t=Date.now()/1e3,i=t-this[PI];if(this[PI]=t,this[AI]=i?1/i:60,this.getWorld()&&this.getActiveLayer()){const t=this.getActiveLayer().getViewpoint().getCameraSpaceMatrix();e.assign(this[VI]),this[VI].set(t[12],t[13],t[14]),this[LI]=e.subtract(this[VI]).magnitude()*this[AI]}else this[LI]=0}})()});const UI=BI;i.add("X3DTimeContext","x_ite/Browser/Time/X3DTimeContext",UI);const XI=UI,jI=Symbol(),kI=Symbol(),zI=Symbol(),GI=Symbol();function HI(){this[jI]=[],this[kI]=[],this[zI]=[],this[GI]=[]}Object.assign(HI.prototype,{initialize(){},addTaintedField(e,t){this[jI].push(e,t)},addTaintedNode(e){this[zI].push(e)},[Symbol.for("X_ITE.X3DRoutingContext.processEvents")](){do{do{const e=this[jI];this[jI]=this[kI],this[jI].length=0;for(let t=0,i=e.length;t<i;t+=2)e[t].processEvent(e[t+1]);this[kI]=e}while(this[jI].length);do{const e=this[zI];this[zI]=this[GI],this[zI].length=0;for(const t of e)t.processEvent();this[GI]=e}while(!this[jI].length&&this[zI].length)}while(this[jI].length)},dispose(){}});const qI=HI;i.add("X3DRoutingContext","x_ite/Routing/X3DRoutingContext",qI);const YI=qI;function WI(e=[]){return $.call(this,Array.from(e,(e=>[e.typeName,e])),Function)}Object.assign(Object.setPrototypeOf(WI.prototype,$.prototype),{add(e,t){d.addNode(t),$.prototype.add.call(this,e,t)}});for(const e of Object.keys(WI.prototype))Object.defineProperty(WI.prototype,e,{enumerable:!1});Object.defineProperties(WI,{typeName:{value:"AbstractNodesArray",enumerable:!0}});const $I=WI;i.add("AbstractNodesArray","x_ite/Configuration/AbstractNodesArray",$I);const JI=$I,KI=new JI;i.add("AbstractNodes","x_ite/Configuration/AbstractNodes",KI);const ZI=KI;function QI(e=[]){return $.call(this,Array.from(e,(e=>[e.typeName,e])),Function)}Object.assign(Object.setPrototypeOf(QI.prototype,$.prototype),{add(e,t){d.addNode(t),Qn.addConcreteNode(t),$.prototype.add.call(this,e,t)},update(e,t,i){d.addNode(i),Qn.addConcreteNode(i),$.prototype.update.call(this,e,t,i)}});for(const e of Object.keys(QI.prototype))Object.defineProperty(QI.prototype,e,{enumerable:!1});Object.defineProperties(QI,{typeName:{value:"ConcreteNodesArray",enumerable:!0}});const eF=QI;i.add("ConcreteNodesArray","x_ite/Configuration/ConcreteNodesArray",eF);const tF=eF,iF=new tF;i.add("ConcreteNodes","x_ite/Configuration/ConcreteNodes",iF);const nF=iF,rF=Symbol(),sF=Symbol(),oF=Symbol(),aF=Symbol(),lF=Symbol(),uF=Symbol(),hF=Symbol(),dF=Symbol(),cF=Symbol(),pF=Symbol(),gF=Symbol(),fF=Symbol.for("X_ITE.X3DRoutingContext.processEvents"),mF=new Set,_F=[];function xF(e){pr.call(this,this),YI.call(this),zN.call(this),dE.call(this,e),qC.call(this),RI.call(this),$N.call(this),UN.call(this),aI.call(this),AE.call(this),ME.call(this),TN.call(this),AC.call(this),UE.call(this),fE.call(this),HE.call(this),eN.call(this),cI.call(this),XI.call(this),mF.add(this);for(const e of _F)e.call(this);this.addChildObjects(d.outputOnly,"initialized",new Gi,d.outputOnly,"shutdown",new Gi,d.outputOnly,"prepareEvents",new Gi,d.outputOnly,"timeEvents",new Gi,d.outputOnly,"sensorEvents",new Gi,d.outputOnly,"displayEvents",new Gi,d.outputOnly,"finishedEvents",new Gi),this[sF]=!1,this[uF]=0,this[lF]=this[aF].bind(this),this[hF]=new $a,this[dF]=new $a,this[cF]=new $a,this[pF]=new $a,this[gF]=new $a}Object.assign(Object.setPrototypeOf(xF.prototype,pr.prototype),dE.prototype,fE.prototype,ME.prototype,AE.prototype,UE.prototype,HE.prototype,AC.prototype,qC.prototype,eN.prototype,TN.prototype,UN.prototype,YI.prototype,zN.prototype,$N.prototype,aI.prototype,cI.prototype,RI.prototype,XI.prototype,{initialize(){pr.prototype.initialize?.call(this),YI.prototype.initialize?.call(this),zN.prototype.initialize?.call(this),dE.prototype.initialize?.call(this),qC.prototype.initialize?.call(this),RI.prototype.initialize?.call(this),$N.prototype.initialize?.call(this),UN.prototype.initialize?.call(this),aI.prototype.initialize?.call(this),AE.prototype.initialize?.call(this),ME.prototype.initialize?.call(this),TN.prototype.initialize?.call(this),AC.prototype.initialize?.call(this),UE.prototype.initialize?.call(this),fE.prototype.initialize?.call(this),HE.prototype.initialize?.call(this),eN.prototype.initialize?.call(this),cI.prototype.initialize?.call(this),XI.prototype.initialize?.call(this);for(const e of _F)e.prototype.initialize?.call(this)},initialized(){return this._initialized},shutdown(){return this._shutdown},prepareEvents(){return this._prepareEvents},timeEvents(){return this._timeEvents},sensorEvents(){return this._sensorEvents},displayEvents(){return this._displayEvents},finishedEvents(){return this._finishedEvents},getBrowser(){return this},getWorld(){return this[rF]},getExecutionContext(){return this[rF].getExecutionContext()},setExecutionContext(e){this[rF]=new sh(e),this[rF].setup()},addBrowserEvent(){this[sF]||(this[sF]=!0,requestAnimationFrame(this[lF]))},[oF](e){return e>this[uF]?(this[uF]=e,this[sF]=!1,!1):(requestAnimationFrame(this[lF]),!0)},[aF](e){this[oF](e)||(this[hF].stop(),this[dF].start(),this.advanceTime(),this.addTaintedField(this._prepareEvents),this[fF](),this.addTaintedField(this._timeEvents),this[fF](),this[cF].start(),this[rF].traverse(Ma.CAMERA),this[cF].stop(),this[pF].start(),this.getCollisionCount()&&this[rF].traverse(Ma.COLLISION),this[pF].stop(),this.addTaintedField(this._sensorEvents),this[fF](),this[gF].start(),this.addTaintedField(this._displayEvents),this[fF](),this.getFrameBuffer().clear(),this[rF].traverse(Ma.DISPLAY),this.addTaintedField(this._finishedEvents),this[fF](),this.getFrameBuffer().blit(),this[gF].stop(),this[dF].stop(),this[hF].start())},getSystemTime(){return this[hF]},getBrowserTime(){return this[dF]},getCameraTime(){return this[cF]},getCollisionTime(){return this[pF]},getDisplayTime(){return this[gF]},dispose(){mF.delete(this);for(const e of _F)e.prototype.dispose?.call(this);XI.prototype.dispose?.call(this),cI.prototype.dispose?.call(this),eN.prototype.dispose?.call(this),HE.prototype.dispose?.call(this),fE.prototype.dispose?.call(this),UE.prototype.dispose?.call(this),AC.prototype.dispose?.call(this),TN.prototype.dispose?.call(this),ME.prototype.dispose?.call(this),AE.prototype.dispose?.call(this),aI.prototype.dispose?.call(this),UN.prototype.dispose?.call(this),$N.prototype.dispose?.call(this),RI.prototype.dispose?.call(this),qC.prototype.dispose?.call(this),dE.prototype.dispose?.call(this),zN.prototype.dispose?.call(this),YI.prototype.dispose?.call(this),pr.prototype.dispose?.call(this)}});for(const e of Object.keys(xF.prototype))Object.defineProperty(xF.prototype,e,{enumerable:!1});Object.assign(xF,{addComponent({name:e,concreteNodes:t,abstractNodes:i,browserContext:n,external:r}){if(t)for(const e of t)nF.add(e.typeName,e);if(i)for(const e of i)ZI.add(e.typeName,e);if(n){_F.push(n);const e=Object.keys(n.prototype).filter((e=>!e.match(/^(?:initialize|dispose)$/))).concat(Object.getOwnPropertySymbols(n.prototype));for(const t of e)Object.defineProperty(xF.prototype,t,{value:n.prototype[t],writable:!0})}for(const e of mF){if(t)for(const i of t)e.addConcreteNode(i);if(i)for(const t of i)e.addAbstractNode(t);n&&(n.call(e),n.prototype.initialize?.call(e),e[fF]())}}});const yF=xF;i.add("X3DBrowserContext","x_ite/Browser/X3DBrowserContext",yF);const wF=yF;let bF=!1;const SF={add({name:e,concreteNodes:t,abstractNodes:i,browserContext:n}){wF.addComponent({name:e,concreteNodes:t,abstractNodes:i,browserContext:n,external:bF})}};SF.add(Jh),SF.add(ud),SF.add(vd),SF.add(kc),SF.add(pp),SF.add(Pp),SF.add(Tg),SF.add(Dg),SF.add(sf),SF.add(bf),SF.add(Yf),SF.add(_m),SF.add(E_),SF.add(tb),SF.add(Yb),SF.add(ST),SF.add(pv),SF.add(fv),bF=!0;const TF=SF;i.add("Components","x_ite/Components",TF);var vF=n(328);const OF=class{constructor(e){this.browser=e,this.rootElement=void 0,this.canvasObserver=new MutationObserver((()=>this.processCanvasMutation(e))),this.canvasObserver.observe(e.getElement()[0],{childList:!0}),this.processCanvasMutation(e)}processCanvasMutation(e){this.processRootElement(e,e.getElement().children("X3D").get(-1))}async processRootElement(e,t){try{if(t===this.rootElement)return;if(this.rootElement=t,t){e.setBrowserLoading(!0),e.addLoadingObject(this);const i=e.createScene();this.parser=new $s(i),this.parser.setInput(t),await new Promise(this.parser.parseIntoScene.bind(this.parser)),e.replaceWorld(i),this.observer=new MutationObserver((e=>{for(const t of e)this.processMutation(t)})),this.observer.observe(t,{attributes:!0,childList:!0,characterData:!1,subtree:!0,attributeOldValue:!0}),this.processInlineElements(t),this.addEventDispatchersAll(t),e.removeLoadingObject(this)}else e.replaceWorld(null)}catch(e){console.error("Error importing document:",e)}}processMutation(e){switch(e.type){case"attributes":this.processAttribute(e,e.target);break;case"childList":for(const t of e.addedNodes)this.processAddedNode(t);for(const t of e.removedNodes)this.processRemovedNode(t)}}processAttribute(e,t){const i=this.parser,n=vF.data(t,"node");if(n){const r=e.attributeName,s=t.attributes.getNamedItem(r);i.nodeAttribute(s,n)}else{const e=t.parentNode,n=vF.data(e,"node");n&&(i.pushExecutionContext(n.getExecutionContext()),i.pushParent(n),i.childElement(t),i.popParent(),i.popExecutionContext())}}processAddedNode(e){if(e.nodeType!==Node.ELEMENT_NODE)return;if("X3D"===e.nodeName)return;if(vF.data(e,"node"))return;const t=e.parentNode,i=this.parser;if(t.nodeName.match(/^(?:Scene|SCENE)$/)){const n=vF.data(t,"node");i.pushExecutionContext(n),i.childElement(e),i.popExecutionContext()}else if(vF.data(t,"node")){const n=vF.data(t,"node"),r=n.getExecutionContext();i.pushExecutionContext(r),i.pushParent(n),i.childElement(e),i.popParent(),i.popExecutionContext()}else{const t=this.browser.currentScene;i.pushExecutionContext(t),i.childElement(e),i.popExecutionContext()}this.processInlineElements(e),this.addEventDispatchers(e),this.addEventDispatchersAll(e)}processRemovedNode(e){const t=vF.data(e,"node");t&&(t.dispose(),vF.data(e,"node",null))}processInlineElements(e){e.nodeName.match(/^(?:Inline|INLINE)$/)&&this.processInlineElement(e);for(const t of e.querySelectorAll("Inline"))this.processInlineElement(t)}processInlineElement(e){const t=vF.data(e,"node");t&&(t._loadState.addInterest("appendInlineChildElement",this,e),this.appendInlineChildElement(e))}appendInlineChildElement(e){const t=vF.data(e,"node");switch(t.checkLoadState()){case d.NOT_STARTED_STATE:case d.FAILED_STATE:for(;e.firstChild;)e.removeChild(e.lastChild);break;case d.COMPLETE_STATE:{for(;e.firstChild;)e.removeChild(e.lastChild);const i=vF.data(t.getInternalScene(),"X3D");i&&e.appendChild(i),this.processInlineElements(i),this.addEventDispatchersAll(i);break}}switch(t.checkLoadState()){case d.COMPLETE_STATE:{const i=new CustomEvent("load",{detail:{node:bi.get(t)}});e.dispatchEvent(i);break}case d.FAILED_STATE:{const i=new CustomEvent("error",{detail:{node:bi.get(t)}});e.dispatchEvent(i);break}}}addEventDispatchersAll(e){const t=e.querySelectorAll("*");for(const e of t)this.addEventDispatchers(e)}addEventDispatchers(e){if("ROUTE"===e.nodeName)return;const t=vF.data(e,"node");if(t){for(const i of t.getPredefinedFields())this.bindFieldCallback(i,e);for(const i of t.getUserDefinedFields())this.bindFieldCallback(i,e)}}bindFieldCallback(e,t){e.isOutput()&&e.addInterest("fieldCallback",this,t)}fieldCallback(e,t){const i=vF.data(e,"node");if(!i)return;const n=new CustomEvent(t.getName(),{detail:{node:bi.get(i),value:t.valueOf()}});e.dispatchEvent(n)}};i.add("DOMIntegration","x_ite/Browser/DOMIntegration",OF);const EF=OF;function CF(e,t,i,n){Object.defineProperties(this,{name:{value:e,enumerable:!0},title:{value:t,enumerable:!0},providerURL:{value:i,enumerable:!0},components:{value:n,enumerable:!0}})}Object.assign(Object.setPrototypeOf(CF.prototype,I.prototype),{toVRMLStream(e){e.string+=e.Indent(),e.string+="PROFILE",e.string+=e.Space(),e.string+=this.name},toXMLStream(e){e.string+=this.name},toJSONStream(e){e.string+=this.name}});for(const e of Object.keys(CF.prototype))Object.defineProperty(CF.prototype,e,{enumerable:!1});Object.defineProperties(CF,{typeName:{value:"ProfileInfo",enumerable:!0}}),Object.defineProperties(CF.prototype,{providerUrl:{get:function(){return this.providerURL}}});const NF=CF;i.add("ProfileInfo","x_ite/Configuration/ProfileInfo",NF);const IF=NF;function FF(e=[]){return $.call(this,Array.from(e,(e=>[e.name,e])),IF)}Object.assign(Object.setPrototypeOf(FF.prototype,$.prototype),{add(e,{title:t,providerURL:i,components:n}){$.prototype.add.call(this,e,new IF(e,t,i,new lO(n)))}});for(const e of Object.keys(FF.prototype))Object.defineProperty(FF.prototype,e,{enumerable:!1});Object.defineProperties(FF,{typeName:{value:"ProfileInfoArray",enumerable:!0}});const MF=FF;i.add("ProfileInfoArray","x_ite/Configuration/ProfileInfoArray",MF);const DF=MF,RF=new lO([]);RF.add("Annotation",{title:"Annotation",level:2,external:!0}),RF.add("CADGeometry",{title:"CAD geometry",level:2,external:!0}),RF.add("Core",{title:"Core",level:2}),RF.add("CubeMapTexturing",{title:"Cube map environmental texturing",level:3,external:!0}),RF.add("DIS",{title:"Distributed interactive simulation",level:2,external:!0}),RF.add("EnvironmentalEffects",{title:"Environmental effects",level:4}),RF.add("EnvironmentalSensor",{title:"Environmental sensor",level:3}),RF.add("EventUtilities",{title:"Event utilities",level:1,external:!0}),RF.add("Followers",{title:"Followers",level:1}),RF.add("Geometry2D",{title:"Geometry2D",level:2,external:!0}),RF.add("Geometry3D",{title:"Geometry3D",level:4}),RF.add("Geospatial",{title:"Geospatial",level:2,external:!0}),RF.add("Grouping",{title:"Grouping",level:3}),RF.add("HAnim",{title:"Humanoid animation (HAnim)",level:3,external:!0}),RF.alias("H-Anim",RF.get("HAnim")),RF.add("Interpolation",{title:"Interpolation",level:5}),RF.add("KeyDeviceSensor",{title:"Key device sensor",level:2,external:!0}),RF.add("Layering",{title:"Layering",level:1}),RF.add("Layout",{title:"Layout",level:2,external:!0,dependencies:["Text"]}),RF.add("Lighting",{title:"Lighting",level:3}),RF.add("Navigation",{title:"Navigation",level:3}),RF.add("Networking",{title:"Networking",level:4}),RF.add("NURBS",{title:"NURBS",level:4,external:!0}),RF.add("ParticleSystems",{title:"Particle systems",level:3,external:!0}),RF.add("Picking",{title:"Picking",level:3,external:!0,dependencies:["RigidBodyPhysics"]}),RF.add("PointingDeviceSensor",{title:"Pointing device sensor",level:1}),RF.add("Shaders",{title:"Programmable shaders",level:1}),RF.add("TextureProjection",{title:"Texture Projection",level:2,external:!0}),RF.alias("TextureProjector",RF.get("TextureProjection")),RF.alias("ProjectiveTextureMapping",RF.get("TextureProjection")),RF.add("Rendering",{title:"Rendering",level:5}),RF.add("RigidBodyPhysics",{title:"Rigid body physics",level:2,external:!0}),RF.add("Scripting",{title:"Scripting",level:1,external:!0}),RF.add("Shape",{title:"Shape",level:4}),RF.add("Sound",{title:"Sound",level:3}),RF.add("Text",{title:"Text",level:1,external:!0}),RF.add("Texturing",{title:"Texturing",level:4}),RF.add("Texturing3D",{title:"Texturing3D",level:2,external:!0}),RF.add("Time",{title:"Time",level:2}),RF.add("VolumeRendering",{title:"Volume rendering",level:4,external:!0,dependencies:["CADGeometry","Texturing3D"]}),RF.add("X_ITE",{title:"X_ITE",level:1,external:!0});const PF=RF;i.add("SupportedComponents","x_ite/Configuration/SupportedComponents",PF);const AF=PF,VF=new DF;VF.add("CADInterchange",{title:"Computer-Aided Design (CAD) interchange",providerURL:so.getProviderURL(),components:[AF.get("CADGeometry"),AF.get("Core"),AF.get("Grouping"),AF.get("Lighting"),AF.get("Navigation"),AF.get("Networking"),AF.get("Rendering"),AF.get("Shaders"),AF.get("Shape"),AF.get("Texturing")]}),VF.add("Core",{title:"Core",providerURL:so.getProviderURL(),components:[AF.get("Core")]}),VF.add("Full",{title:"Full",providerURL:so.getProviderURL(),components:[AF.get("CADGeometry"),AF.get("Core"),AF.get("CubeMapTexturing"),AF.get("DIS"),AF.get("EnvironmentalEffects"),AF.get("EnvironmentalSensor"),AF.get("EventUtilities"),AF.get("Followers"),AF.get("Geometry2D"),AF.get("Geometry3D"),AF.get("Geospatial"),AF.get("Grouping"),AF.get("HAnim"),AF.get("Interpolation"),AF.get("KeyDeviceSensor"),AF.get("Layering"),AF.get("Layout"),AF.get("Lighting"),AF.get("Navigation"),AF.get("Networking"),AF.get("NURBS"),AF.get("ParticleSystems"),AF.get("Picking"),AF.get("PointingDeviceSensor"),AF.get("TextureProjector"),AF.get("Rendering"),AF.get("RigidBodyPhysics"),AF.get("Scripting"),AF.get("Shaders"),AF.get("Shape"),AF.get("Sound"),AF.get("Text"),AF.get("Texturing"),AF.get("Texturing3D"),AF.get("Time"),AF.get("VolumeRendering")]}),VF.add("Immersive",{title:"Immersive",providerURL:so.getProviderURL(),components:[AF.get("Core"),AF.get("EnvironmentalEffects"),AF.get("EnvironmentalSensor"),AF.get("EventUtilities"),AF.get("Geometry2D"),AF.get("Geometry3D"),AF.get("Grouping"),AF.get("Interpolation"),AF.get("KeyDeviceSensor"),AF.get("Lighting"),AF.get("Navigation"),AF.get("Networking"),AF.get("PointingDeviceSensor"),AF.get("Rendering"),AF.get("Scripting"),AF.get("Shape"),AF.get("Sound"),AF.get("Text"),AF.get("Texturing"),AF.get("Time")]}),VF.add("Interactive",{title:"Interactive",providerURL:so.getProviderURL(),components:[AF.get("Core"),AF.get("EnvironmentalEffects"),AF.get("EnvironmentalSensor"),AF.get("EventUtilities"),AF.get("Geometry3D"),AF.get("Grouping"),AF.get("Interpolation"),AF.get("KeyDeviceSensor"),AF.get("Lighting"),AF.get("Navigation"),AF.get("Networking"),AF.get("PointingDeviceSensor"),AF.get("Rendering"),AF.get("Shape"),AF.get("Texturing"),AF.get("Time")]}),VF.add("Interchange",{title:"Interchange",providerURL:so.getProviderURL(),components:[AF.get("Core"),AF.get("EnvironmentalEffects"),AF.get("Geometry3D"),AF.get("Grouping"),AF.get("Interpolation"),AF.get("Lighting"),AF.get("Navigation"),AF.get("Networking"),AF.get("Rendering"),AF.get("Shape"),AF.get("Texturing"),AF.get("Time")]}),VF.add("MedicalInterchange",{title:"Medical interchange",providerURL:so.getProviderURL(),components:[AF.get("Core"),AF.get("EnvironmentalEffects"),AF.get("EventUtilities"),AF.get("Geometry2D"),AF.get("Geometry3D"),AF.get("Grouping"),AF.get("Interpolation"),AF.get("Lighting"),AF.get("Navigation"),AF.get("Networking"),AF.get("Rendering"),AF.get("Shape"),AF.get("Text"),AF.get("Texturing"),AF.get("Texturing3D"),AF.get("Time"),AF.get("VolumeRendering")]}),VF.add("MPEG-4",{title:"MPEG-4 interactive",providerURL:so.getProviderURL(),components:[AF.get("Core"),AF.get("EnvironmentalEffects"),AF.get("EnvironmentalSensor"),AF.get("Geometry3D"),AF.get("Grouping"),AF.get("Interpolation"),AF.get("Lighting"),AF.get("Navigation"),AF.get("Networking"),AF.get("PointingDeviceSensor"),AF.get("Rendering"),AF.get("Shape"),AF.get("Texturing"),AF.get("Time")]});const LF=VF;i.add("SupportedProfiles","x_ite/Configuration/SupportedProfiles",LF);const BF=LF;var UF=n(328);const XF=Symbol(),jF=Symbol(),kF=Symbol(),zF=Symbol(),GF=Symbol(),HF=Symbol(),qF=Symbol(),YF=Symbol(),WF=Symbol(),$F=Symbol.for("X_ITE.X3DRoutingContext.processEvents");function JF(e){if((e=UF(e)).prop("browser"))throw new Error("Couldn't create browser, element has already a browser.");wF.call(this,e),this.addType(d.X3DBrowser),this[jF]=BF.copy(),this[kF]=AF.copy(),this[zF]=nF.copy(),this[GF]=ZI.copy(),this[WF]=document.getElementsByClassName("x_ite-console"),this[YF]=new Map([[d.CONNECTION_ERROR,new Map],[d.BROWSER_EVENT,new Map],[d.INITIALIZED_EVENT,new Map],[d.SHUTDOWN_EVENT,new Map],[d.INITIALIZED_ERROR,new Map]]),this.setup()}Object.assign(Object.setPrototypeOf(JF.prototype,wF.prototype),{initialize(){wF.prototype.initialize.call(this),this.replaceWorld(this.createScene()).catch(Function.prototype),this[XF]=new EF(this),_r.browser(this),this[$F].call(this),this.getInstanceId()>1||this.getBrowserOption("Debug")&&this.print(this.getWelcomeMessage())},getWelcomeMessage(){return`Welcome to ${this.name} X3D Browser v${this.version}:\n   Current Graphics Renderer\n      Name: ${this.getVendor()} ${this.getRenderer()}\n      WebGL version: ${this.getWebGLVersion()}\n      Shading language: ${this.getShadingLanguageVersion()}\n   Rendering Properties\n      Antialiased: ${this.getRenderingProperty("Antialiased")}\n      Max samples: ${this.getMaxSamples()}\n      Depth size: ${this.getDepthSize()} bits\n      Color depth: ${this.getColorDepth()} bits\n      Max clip planes per shape: ${this.getMaxClipPlanes()}\n      Max lights per shape: ${this.getMaxLights()}\n      Max textures per shape: ${this.getMaxTextures()}\n      Max texture size: ${this.getMaxTextureSize()} Ã ${this.getMaxTextureSize()} pixels\n      Texture memory: ${this.getTextureMemory()}\n      Texture units: ${this.getMaxCombinedTextureUnits()}\n      Max vertex uniform vectors: ${this.getMaxVertexUniformVectors()}\n      Max fragment uniform vectors: ${this.getMaxFragmentUniformVectors()}\n      Max vertex attribs: ${this.getMaxVertexAttribs()}\n      Max varying vectors: ${this.getMaxVaryingVectors()}\n`},getName:()=>"X_ITE",getVersion:()=>yr,getDescription(){return this.getNotification()._string.getValue()},setDescription(e){this.getNotification()._string=e},getWorldURL(){return this.currentScene.worldURL},getProfile(e){e=String(e);const t=this[jF].get(e);if(t)return t;throw Error(`Profile '${e}' is not supported.`)},addSupportedProfile:function(e){this[jF].add(e.name,e)},updateSupportedProfile:function(e){this[jF].update(e.name,e.name,e)},removeSupportedProfile(e){return this[jF].remove(String(e))},getSupportedProfile(e){const t=this[jF].get(String(e));if(t)return t;throw new Error(`Supported profile '${e}' does not exists.`)},getSupportedProfiles(){return this[jF]},getComponent(e,t){e=String(e),t|=0;const i=this[kF].get(e);if(i)return new sO(i.name,g.clamp(t||i.level,1,i.level),i.title,i.providerURL,i.external,i.dependencies);throw Error(`Component '${e}' at level '${t}' is not supported.`)},addSupportedComponent(e){this[kF].add(e.name,e)},updateSupportedComponent(e){this[kF].update(e.name,e.name,e)},removeSupportedComponent(e){this[kF].remove(String(e))},getSupportedComponent(e){const t=this[kF].get(String(e));if(t)return t;throw new Error(`Supported component '${e}' does not exists.`)},getSupportedComponents(){return this[kF]},loadComponents:(()=>{function e(e,i){return Promise.all(e.map((e=>t.call(this,e,i))))}async function t({name:t,providerURL:i,external:r,dependencies:s},o){if(!o.has(t)&&(o.add(t),await e.call(this,s.map((e=>this[kF].get(e))),o),r))switch(no.ENVIRONMENT){case"NODE":n.g.require(n.g.require("url").fileURLToPath(i));break;case"BROWSER":case"MODULE":await import(i)}}return function(...t){const i=[];for(const e of t)e instanceof IF?i.push(...e.components):e instanceof lO?i.push(...e):e instanceof sO?i.push(e):"string"==typeof e&&i.push(this[kF].get(e));return e.call(this,i,new Set)}})(),addConcreteNode(e){this[zF].add(e.typeName,e)},updateConcreteNode(e){this[zF].update(e.typeName,e.typeName,e)},removeConcreteNode(e){this[zF].remove(String(e))},getConcreteNode(e){const t=this[zF].get(String(e));if(t)return t;throw new Error(`Concrete node '${e}' does not exists.`)},getConcreteNodes(){return this[zF]},addAbstractNode(e){this[GF].add(e.typeName,e)},updateAbstractNode(e){this[GF].update(e.typeName,e.typeName,e)},removeAbstractNode(e){this[GF].remove(String(e))},getAbstractNode(e){const t=this[GF].get(String(e));if(t)return t;throw new Error(`Abstract node '${e}' does not exists.`)},getAbstractNodes(){return this[GF]},createScene(e,...t){const i=new PO(this);if(arguments.length){if(!(e instanceof IF))throw new Error("Couldn't create scene: profile must be of type ProfileInfo.");i.setProfile(e);for(const e of t){if(!(e instanceof sO))throw new Error("Couldn't create scene: component must be of type ComponentInfo.");i.addComponent(e)}}return i.setup(),i},replaceWorld(e){return new Promise(((t,i)=>{if(this[qF]?.abort(),this[HF]?.("Replacing world aborted."),this[HF]=i,this.initialized().getValue()&&(this.getExecutionContext().setLive(!1),this.shutdown().processInterests(),this.callBrowserCallbacks(d.SHUTDOWN_EVENT),this.callBrowserEventHandler("shutdown")),e instanceof $n.MFNode){const t=e;e=this.createScene();for(const i of t.filter((e=>e)))e.getLive().addInterest("setLive",i.getValue().getExecutionContext());e.setRootNodes(t)}e instanceof PO||(e=this.createScene()),e.getExecutionContext().getLive().removeInterest("setLive",e),e.setExecutionContext(e),this.setDescription(""),this.setBrowserLoading(!0),this._loadCount.addInterest("checkLoadCount",this,t);for(const t of e.getLoadingObjects())this.addLoadingObject(t);this.setExecutionContext(e),this.getWorld().bindBindables(),e.setLive(this.isLive())}))},checkLoadCount(e,t){t.getValue()||(t.removeInterest("checkLoadCount",this),this.setBrowserLoading(!1),this.initialized().set(this.getCurrentTime()),this.initialized().processInterests(),this.callBrowserCallbacks(d.INITIALIZED_EVENT),this.callBrowserEventHandler("initialized load"),e())},createVrmlFromString(e){const t=this.isExternal(),i=this.currentScene,n=t?this.getBaseURL():i.getWorldURL(),r=new hh(this.getWorld()).createX3DFromString(n,`#VRML V2.0 utf8\n\n${e}`);return t||(i.getLive().addInterest("setLive",r),r.setExecutionContext(i),r.setLive(i.isLive())),r.rootNodes},createX3DFromString:async function(e){e=String(e);const t=this.isExternal(),i=this.currentScene,n=t?this.getBaseURL():i.getWorldURL(),r=new hh(this.getWorld()),s=await new Promise(((t,i)=>{r.createX3DFromString(n,e,t,i)}));return t||(i.getLive().addInterest("setLive",s),s.setExecutionContext(i),s.setLive(i.isLive())),s},createVrmlFromURL(e,t,i){if(t=Yl(d.X3DNode,t,!1),i=String(i),!(e instanceof $n.MFString))throw new Error("Browser.createVrmlFromURL: url must be of type MFString.");if(!t)throw new Error("Browser.createVrmlFromURL: node must be of type X3DNode.");const n=t.getField(i);if(!n.isInput())throw new Error(`Browser.createVrmlFromURL: event named '${i}' must be a input field.`);if(n.getType()!==d.MFNode)throw new Error(`Browser.createVrmlFromURL: event named '${i}' must be of type MFNode.`);const r=this.currentScene,s=this.isExternal(),o=new hh(this.getWorld());this.addLoadingObject(o),o.createX3DFromURL(e,null,(e=>{this.removeLoadingObject(o),e&&(s||(r.getLive().addInterest("setLive",e),e.setExecutionContext(r),e.setLive(r.isLive())),n.setValue(e.rootNodes))}))},createX3DFromURL(e,t,i){if(3===arguments.length)return this.createVrmlFromURL(e,t,i);if(!(e instanceof $n.MFString))throw new Error("Browser.createX3DFromURL: url must be of type MFString.");return new Promise(((t,i)=>{const n=this.currentScene,r=this.isExternal(),s=new hh(this.getWorld());this.addLoadingObject(s),s.createX3DFromURL(e,null,(e=>{this.removeLoadingObject(s),e?(r||(n.getLive().addInterest("setLive",e),e.setExecutionContext(n),e.setLive(n.isLive())),t(e)):i(new Error("Couldn't load X3D file."))}))}))},loadURL(e,t=new $n.MFString){return new Promise(((i,n)=>{if(!(e instanceof $n.MFString))throw new Error("Browser.loadURL: url must be of type MFString.");if(!(t instanceof $n.MFString))throw new Error("Browser.loadURL: parameter must be of type MFString.");const r=new hh(this.getWorld());r.createX3DFromURL(e,t,(e=>{this[qF]!==r?n(new Error("Loading of X3D file aborted.")):(this.getBrowserOption("SplashScreen")||this.getCanvas().show(),e?(this.addLoadingObject(this),this.replaceWorld(e).then(i).catch(n),this.removeLoadingObject(this),this.removeLoadingObject(r)):(this.callBrowserCallbacks(d.CONNECTION_ERROR),this.callBrowserEventHandler("error"),setTimeout((()=>{this.getSplashScreen().find(".x_ite-private-spinner-text").text(Ev("Failed loading world."))})),n(new Error("Couldn't load X3D file."))))}),(e=>{r.ready=!0,this.changeViewpoint(e),this.removeLoadingObject(r),i()}),((e,t)=>{r.ready=!0,t?window.open(e,t):location=e,this.removeLoadingObject(r),i()})),r.ready||(this[qF]?.abort(),this.setBrowserLoading(!0),this.addLoadingObject(this[qF]=r))}))},addBrowserListener(e,t){},removeBrowserListener(e){},addBrowserCallback(...e){switch(e.length){case 2:{const[t,i]=e;this[YF].forEach((e=>e.set(t,i)));break}case 3:{const[t,i,n]=e;this[YF].get(i).set(t,n);break}}},removeBrowserCallback(e,t){2===arguments.length?this[YF].get(t).delete(e):this[YF].forEach((t=>t.delete(e)))},getBrowserCallbacks(e){return 1===arguments.length?this[YF].get(e):new Map([...this[YF]].flatMap((([e,t])=>[...t])))},callBrowserCallbacks:(()=>{const e=[];return function(t){const i=this[YF].get(t);if(i.size)for(const n of b.values(e,i))n(t)}})(),importDocument(e){const t=this.currentScene,i=this.createScene();this.isExternal()||(t.getLive().addInterest("setLive",i),i.setExecutionContext(t),i.setLive(t.isLive()));const n=new $s(i);return n.setInput(e),new Promise(n.parseIntoScene.bind(n))},importJS(e){const t=this.currentScene,i=this.createScene();this.isExternal()||(t.getLive().addInterest("setLive",i),i.setExecutionContext(t),i.setLive(t.isLive()));const n=new Zs(i);return n.setInput(e),new Promise(n.parseIntoScene.bind(n))},getBrowserProperty(e){return this.getBrowserProperties().getField(e).getValue()},setBrowserOption(e,t){this.getBrowserOptions().getField(e).setValue(t)},getBrowserOption(e){return this.getBrowserOptions().getField(e).getValue()},getRenderingProperty(e){return this.getRenderingProperties().getField(e).getValue()},viewAll(e,t=1){1===arguments.length&&"number"==typeof e&&(t=e),(e=Yl(d.X3DLayerNode,e)??this.getActiveLayer())&&e.viewAll(t,1,this.getBrowserOption("StraightenHorizon"))},firstViewpoint(e){const t=(e=Yl(d.X3DLayerNode,e)??this.getActiveLayer()).getUserViewpoints();t.length&&this.bindViewpoint(e,t[0])},previousViewpoint(e){if(!(e=Yl(d.X3DLayerNode,e)??this.getActiveLayer()))return;const t=e.getUserViewpoints();if(0!==t.length){for(var i=0,n=t.length;i<n&&!t[i]._isBound.getValue();++i);i<t.length?0===i?this.bindViewpoint(e,t.at(-1)):this.bindViewpoint(e,t[i-1]):this.bindViewpoint(e,t.at(-1))}},nextViewpoint(e){if(!(e=Yl(d.X3DLayerNode,e)??this.getActiveLayer()))return;const t=e.getUserViewpoints();if(0!==t.length){for(var i=0,n=t.length;i<n&&!t[i]._isBound.getValue();++i);i<t.length?i===t.length-1?this.bindViewpoint(e,t[0]):this.bindViewpoint(e,t[i+1]):this.bindViewpoint(e,t[0])}},lastViewpoint(e){if(!(e=Yl(d.X3DLayerNode,e)??this.getActiveLayer()))return;const t=e.getUserViewpoints();t.length&&this.bindViewpoint(e,t.at(-1))},changeViewpoint(e,t){if(1===arguments.length&&(t=String(e),e=this.getActiveLayer()),e=Yl(d.X3DLayerNode,e)??this.getActiveLayer())for(const i of e.getViewpoints().get())if(i.getName()===t){this.bindViewpoint(e,i);break}},bindViewpoint(e,t){if(e=Yl(d.X3DLayerNode,e),t=Yl(d.X3DViewpointNode,t),!e)throw new Error("Browser.bindViewpoint: layerNode must be of type X3DLayerNode.");if(!t)throw new Error("Browser.bindViewpoint: viewpointNode must be of type X3DViewpointNode.");t.setVRMLTransition(!0),t._set_bind=!0},addRoute(e,t,i,n){this.currentScene.addRoute(e,t,i,n)},deleteRoute(e,t,i,n){try{const r=this.currentScene.getRoute(e,t,i,n);r&&this.currentScene.deleteRoute(r)}catch(e){console.error(e)}},beginUpdate(){this.setLive(!0),this.getExecutionContext().setLive(!0),this.advanceTime(),this.addBrowserEvent()},endUpdate(){this.setLive(!1),this.getExecutionContext().setLive(!1)},print(...e){const t=e.join(" ");console.log(t);for(const e of this[WF])e.append(document.createTextNode(t))},println(...e){const t=e.join(" ");console.log(t);for(const e of this[WF])e.append(document.createTextNode(`${t}\n`))},toVRMLStream(e){this.currentScene.toVRMLStream(e)},toXMLStream(e){this.currentScene.toXMLStream(e)},toJSONStream(e){this.currentScene.toJSONStream(e)}});for(const e of Object.keys(JF.prototype))Object.defineProperty(JF.prototype,e,{enumerable:!1});Object.defineProperties(JF.prototype,{name:{get:JF.prototype.getName,enumerable:!0},version:{value:yr,enumerable:!0},providerURL:{get:JF.prototype.getProviderURL,enumerable:!0},providerUrl:{get:JF.prototype.getProviderURL,enumerable:!1},currentFrameRate:{get:JF.prototype.getCurrentFrameRate,enumerable:!0},currentSpeed:{get:JF.prototype.getCurrentSpeed,enumerable:!0},description:{get:JF.prototype.getDescription,set:JF.prototype.setDescription,enumerable:!0},baseURL:{get:JF.prototype.getBaseURL,set:JF.prototype.setBaseURL,enumerable:!0},currentScene:{get(){return this.getScriptStack().at(-1).getExecutionContext()},enumerable:!0},supportedProfiles:{get(){return this[jF]},enumerable:!0},supportedComponents:{get(){return this[kF]},enumerable:!0},concreteNodes:{get(){return this[zF]},enumerable:!0},abstractNodes:{get(){return this[GF]},enumerable:!0}}),Object.defineProperties(JF,{typeName:{value:"X3DBrowser",enumerable:!0}}),d.addNode(JF);const KF=JF;i.add("X3DBrowser","x_ite/Browser/X3DBrowser",KF);const ZF=KF;var QF=n(328);class eM extends HTMLElement{constructor(){try{super(),new ZF(this)}catch(e){console.error(e),QF(this.shadowRoot).append(QF("<slot></slot>")).children(".x_ite-private-browser").remove()}}connectedCallback(){this.browser?.connectedCallback()}static get observedAttributes(){return["antialiased","baseURL","baseurl","cache","contentScale","contentscale","contextMenu","contextmenu","debug","multisampling","notifications","oninitialized","onshutdown","orderIndependentTransparency","orderindependenttransparency","splashScreen","splashscreen","src","timings","update","url"]}attributeChangedCallback(e,t,i){this.browser?.attributeChangedCallback(e,t,i)}captureStream(...e){return this.browser?.getCanvas()[0].captureStream(...e)}toBlob(...e){return this.browser?.getCanvas()[0].toBlob(...e)}toDataURL(...e){return this.browser?.getCanvas()[0].toDataURL(...e)}}document.createElement("X3DCanvas");const tM=eM;i.add("X3DCanvasElement","x_ite/X3DCanvasElement",tM);const iM=tM;var nM=n(328),rM=n(583);Object.assign(nM,{decodeText:e=>"string"==typeof e?e:(new TextDecoder).decode(e),ungzip(e){try{return rM.ungzip(e,{to:"raw"}).buffer}catch(t){return e}},toLowerCaseFirst:e=>e[0].toLowerCase()+e.slice(1),try(e,t=!1){try{return e()}catch(e){t&&console.error(e.message)}},enum:(e,t,i)=>e.hasOwnProperty(t)?e[t]:i}),Object.assign(nM.fn,{isInViewport(){const e=nM(this),t=nM(window),i=e.offset().top,n=i+e.outerHeight(),r=t.scrollTop(),s=r+t.height();return n>r&&i<s}});const sM=nM;i.add("jquery","lib/jquery",sM);const oM=n(981);i.add("libtess","lib/libtess",oM);var aM=n(328);const lM=aM.Deferred(),uM=aM.Deferred();let hM=!1;function dM(e,t){return new Promise(((i,n)=>{"function"==typeof e&&lM.done(e),"function"==typeof t&&uM.done(t),lM.done(i),uM.done(n),hM||(hM=!0,aM((()=>{try{_r.elements(aM("X3DCanvas"),ZF),[...aM("x3d-canvas")].every((e=>e.browser))?lM.resolve():uM.resolve(new Error("Couldn't create browser."))}catch(e){_r.error(aM("X3DCanvas"),e),uM.resolve(e)}})))}))}Object.assign(dM,i,i.Fields,{require(e){if(!i.has(e))throw new Error(`Unknown module '${e}'.`);return i.get(e)},noConflict:(()=>{const e=window.hasOwnProperty("X3D"),t=window.X3D;return function(){return window.X3D===dM&&(e?window.X3D=t:delete window.X3D),dM}})(),getBrowser:e=>aM(e||"x3d-canvas, X3DCanvas").prop("browser"),createBrowser(e,t){const i=document.createElement("x3d-canvas");return arguments.length&&i.browser.loadURL(e,t),i}}),Object.assign(dM,{X3DConstants:d,X3DBrowser:ZF,X3DExecutionContext:jh,X3DScene:PO,ComponentInfo:sO,ComponentInfoArray:lO,ProfileInfo:IF,ProfileInfoArray:DF,ConcreteNodesArray:tF,AbstractNodesArray:JI,UnitInfo:dO,UnitInfoArray:gO,NamedNodesArray:os,ImportedNodesArray:ms,X3DImportedNode:ps,ExportedNodesArray:SO,X3DExportedNode:yO,ExternProtoDeclarationArray:xh,ProtoDeclarationArray:bh,X3DExternProtoDeclaration:fh,X3DProtoDeclaration:Bs,X3DProtoDeclarationNode:Es,RouteArray:Dh,X3DRoute:Ih,X3DBaseNode:pr,X3DFieldDefinition:k,FieldDefinitionArray:Z,X3DField:ce,X3DArrayField:Ji,SFColor:$n.SFColor,SFColorRGBA:$n.SFColorRGBA,SFImage:$n.SFImage,SFMatrix3d:$n.SFMatrix3d,SFMatrix3f:$n.SFMatrix3f,SFMatrix4d:$n.SFMatrix4d,SFMatrix4f:$n.SFMatrix4f,SFNode:$n.SFNode,SFRotation:$n.SFRotation,SFVec2d:$n.SFVec2d,SFVec2f:$n.SFVec2f,SFVec3d:$n.SFVec3d,SFVec3f:$n.SFVec3f,SFVec4d:$n.SFVec4d,SFVec4f:$n.SFVec4f,VrmlMatrix:$n.VrmlMatrix,MFBool:$n.MFBool,MFColor:$n.MFColor,MFColorRGBA:$n.MFColorRGBA,MFDouble:$n.MFDouble,MFFloat:$n.MFFloat,MFImage:$n.MFImage,MFInt32:$n.MFInt32,MFMatrix3d:$n.MFMatrix3d,MFMatrix3f:$n.MFMatrix3f,MFMatrix4d:$n.MFMatrix4d,MFMatrix4f:$n.MFMatrix4f,MFNode:$n.MFNode,MFRotation:$n.MFRotation,MFString:$n.MFString,MFTime:$n.MFTime,MFVec2d:$n.MFVec2d,MFVec2f:$n.MFVec2f,MFVec3d:$n.MFVec3d,MFVec3f:$n.MFVec3f,MFVec4d:$n.MFVec4d,MFVec4f:$n.MFVec4f});const cM=dM;(()=>{function e(e){if((e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this[e]}const t=Reflect.getPrototypeOf(Int8Array);for(const i of[Array,String,t])void 0===i.prototype.at&&Object.defineProperty(i.prototype,"at",{value:e,writable:!0,enumerable:!1,configurable:!0})})();const pM=void 0;i.add("shim","shim",pM);window[Symbol.for("X_ITE.X3D-9.1.6")]=cM,customElements.define("x3d-canvas",iM),cM();const gM=cM;i.add("x_ite","x_ite",gM);const fM=gM})();var s=r.Z;export{s as default};